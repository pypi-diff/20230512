# Comparing `tmp/deepchem-2.7.2.dev20230512194842.tar.gz` & `tmp/deepchem-2.7.2.dev20230512194912.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "deepchem-2.7.2.dev20230512194842.tar", last modified: Fri May 12 19:48:42 2023, max compression
+gzip compressed data, was "deepchem-2.7.2.dev20230512194912.tar", last modified: Fri May 12 19:49:12 2023, max compression
```

## Comparing `deepchem-2.7.2.dev20230512194842.tar` & `deepchem-2.7.2.dev20230512194912.tar`

### file list

```diff
@@ -1,290 +1,290 @@
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.704525 deepchem-2.7.2.dev20230512194842/
--rwxr-xr-x   0 runner    (1001) docker     (123)     1047 2023-05-12 19:48:31.000000 deepchem-2.7.2.dev20230512194842/LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)     1072 2023-05-12 19:48:42.704525 deepchem-2.7.2.dev20230512194842/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     7124 2023-05-12 19:48:31.000000 deepchem-2.7.2.dev20230512194842/README.md
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.676524 deepchem-2.7.2.dev20230512194842/deepchem/
--rw-r--r--   0 runner    (1001) docker     (123)      373 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.680524 deepchem-2.7.2.dev20230512194842/deepchem/data/
--rw-r--r--   0 runner    (1001) docker     (123)      939 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/data/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    67894 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/data/data_loader.py
--rw-r--r--   0 runner    (1001) docker     (123)   118009 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/data/datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     7256 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/data/pytorch_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)    12606 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/data/supports.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.680524 deepchem-2.7.2.dev20230512194842/deepchem/dock/
--rw-r--r--   0 runner    (1001) docker     (123)      297 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/dock/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     4910 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/dock/binding_pocket.py
--rw-r--r--   0 runner    (1001) docker     (123)     6105 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/dock/docking.py
--rw-r--r--   0 runner    (1001) docker     (123)    19576 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/dock/pose_generation.py
--rw-r--r--   0 runner    (1001) docker     (123)     6917 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/dock/pose_scoring.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.680524 deepchem-2.7.2.dev20230512194842/deepchem/feat/
--rw-r--r--   0 runner    (1001) docker     (123)     4457 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     7335 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/atomic_conformation.py
--rw-r--r--   0 runner    (1001) docker     (123)    19279 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/base_classes.py
--rw-r--r--   0 runner    (1001) docker     (123)     1904 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/bert_tokenizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     4368 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/binding_pocket_features.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.680524 deepchem-2.7.2.dev20230512194842/deepchem/feat/complex_featurizers/
--rw-r--r--   0 runner    (1001) docker     (123)     1400 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/complex_featurizers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    12898 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/complex_featurizers/complex_atomic_coordinates.py
--rw-r--r--   0 runner    (1001) docker     (123)    10769 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/complex_featurizers/contact_fingerprints.py
--rw-r--r--   0 runner    (1001) docker     (123)    27676 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/complex_featurizers/grid_featurizers.py
--rw-r--r--   0 runner    (1001) docker     (123)    20248 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/complex_featurizers/rdkit_grid_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)    11465 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/complex_featurizers/splif_fingerprints.py
--rw-r--r--   0 runner    (1001) docker     (123)    11743 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/dft_data.py
--rw-r--r--   0 runner    (1001) docker     (123)    21863 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/graph_data.py
--rw-r--r--   0 runner    (1001) docker     (123)    38890 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/graph_features.py
--rw-r--r--   0 runner    (1001) docker     (123)     1396 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/huggingface_featurizer.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.680524 deepchem-2.7.2.dev20230512194842/deepchem/feat/material_featurizers/
--rw-r--r--   0 runner    (1001) docker     (123)      489 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/material_featurizers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     7539 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/material_featurizers/cgcnn_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     3508 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/material_featurizers/element_property_fingerprint.py
--rw-r--r--   0 runner    (1001) docker     (123)     3232 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/material_featurizers/elemnet_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)    28058 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/material_featurizers/lcnn_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     3823 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/material_featurizers/sine_coulomb_matrix.py
--rw-r--r--   0 runner    (1001) docker     (123)    14808 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/mol_graphs.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.684524 deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/
--rw-r--r--   0 runner    (1001) docker     (123)     2073 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2884 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/atomic_coordinates.py
--rw-r--r--   0 runner    (1001) docker     (123)     2376 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/bp_symmetry_function_input.py
--rw-r--r--   0 runner    (1001) docker     (123)     6488 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/circular_fingerprint.py
--rw-r--r--   0 runner    (1001) docker     (123)     9448 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/conformer_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)    10925 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/coulomb_matrices.py
--rw-r--r--   0 runner    (1001) docker     (123)    19123 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/dmpnn_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     7507 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/grover_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     2046 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/maccs_keys_fingerprint.py
--rw-r--r--   0 runner    (1001) docker     (123)     8401 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/mat_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     7587 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/mol2vec_fingerprint.py
--rw-r--r--   0 runner    (1001) docker     (123)    20381 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/mol_graph_conv_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     9346 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/molgan_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     2835 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/mordred_descriptors.py
--rw-r--r--   0 runner    (1001) docker     (123)     6359 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/one_hot_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     2258 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/pubchem_fingerprint.py
--rw-r--r--   0 runner    (1001) docker     (123)     1687 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/raw_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     9855 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/rdkit_descriptors.py
--rw-r--r--   0 runner    (1001) docker     (123)     7280 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/smiles_to_image.py
--rw-r--r--   0 runner    (1001) docker     (123)     5433 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/smiles_to_seq.py
--rw-r--r--   0 runner    (1001) docker     (123)     4313 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/snap_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     3448 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/sparse_matrix_one_hot_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     3909 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/reaction_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     2326 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/roberta_tokenizer.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.684524 deepchem-2.7.2.dev20230512194842/deepchem/feat/sequence_featurizers/
--rw-r--r--   0 runner    (1001) docker     (123)      112 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/sequence_featurizers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     3383 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/sequence_featurizers/position_frequency_matrix_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)    11383 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/smiles_tokenizer.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.684524 deepchem-2.7.2.dev20230512194842/deepchem/feat/vocabulary_builders/
--rw-r--r--   0 runner    (1001) docker     (123)      278 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/vocabulary_builders/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    17291 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/vocabulary_builders/grover_vocab.py
--rw-r--r--   0 runner    (1001) docker     (123)     2315 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/vocabulary_builders/hf_vocab.py
--rw-r--r--   0 runner    (1001) docker     (123)     1116 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/feat/vocabulary_builders/vocabulary_builder.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.684524 deepchem-2.7.2.dev20230512194842/deepchem/hyper/
--rw-r--r--   0 runner    (1001) docker     (123)      260 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/hyper/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     5702 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/hyper/base_classes.py
--rw-r--r--   0 runner    (1001) docker     (123)    17151 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/hyper/gaussian_process.py
--rw-r--r--   0 runner    (1001) docker     (123)    10208 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/hyper/grid_search.py
--rw-r--r--   0 runner    (1001) docker     (123)    12427 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/hyper/random_search.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.684524 deepchem-2.7.2.dev20230512194842/deepchem/metalearning/
--rw-r--r--   0 runner    (1001) docker     (123)      118 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/metalearning/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    10539 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/metalearning/maml.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.684524 deepchem-2.7.2.dev20230512194842/deepchem/metrics/
--rw-r--r--   0 runner    (1001) docker     (123)     2015 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/metrics/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     7715 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/metrics/genomic_metrics.py
--rw-r--r--   0 runner    (1001) docker     (123)    31620 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/metrics/metric.py
--rw-r--r--   0 runner    (1001) docker     (123)     6533 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/metrics/score_function.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.688524 deepchem-2.7.2.dev20230512194842/deepchem/models/
--rw-r--r--   0 runner    (1001) docker     (123)     4780 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/IRV.py
--rw-r--r--   0 runner    (1001) docker     (123)     4365 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    13833 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/atomic_conv.py
--rw-r--r--   0 runner    (1001) docker     (123)     4414 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/callbacks.py
--rw-r--r--   0 runner    (1001) docker     (123)    17354 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/chemnet_layers.py
--rw-r--r--   0 runner    (1001) docker     (123)    15504 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/chemnet_models.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.688524 deepchem-2.7.2.dev20230512194842/deepchem/models/dft/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/dft/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     9553 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/dft/dftxc.py
--rw-r--r--   0 runner    (1001) docker     (123)     9576 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/dft/nnxc.py
--rw-r--r--   0 runner    (1001) docker     (123)     4664 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/dft/scf.py
--rw-r--r--   0 runner    (1001) docker     (123)    23457 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/fcnet.py
--rw-r--r--   0 runner    (1001) docker     (123)    24548 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/gan.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.688524 deepchem-2.7.2.dev20230512194842/deepchem/models/gbdt_models/
--rw-r--r--   0 runner    (1001) docker     (123)       75 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/gbdt_models/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     5921 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/gbdt_models/gbdt_model.py
--rw-r--r--   0 runner    (1001) docker     (123)    57408 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/graph_models.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.688524 deepchem-2.7.2.dev20230512194842/deepchem/models/jax_models/
--rw-r--r--   0 runner    (1001) docker     (123)      133 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/jax_models/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    28179 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/jax_models/jax_model.py
--rw-r--r--   0 runner    (1001) docker     (123)     3408 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/jax_models/layers.py
--rw-r--r--   0 runner    (1001) docker     (123)    17070 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/jax_models/pinns_model.py
--rw-r--r--   0 runner    (1001) docker     (123)    56522 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/keras_model.py
--rw-r--r--   0 runner    (1001) docker     (123)   144759 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/layers.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.688524 deepchem-2.7.2.dev20230512194842/deepchem/models/lightning/
--rw-r--r--   0 runner    (1001) docker     (123)      181 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/lightning/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1742 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/lightning/dc_lightning_dataset_module.py
--rw-r--r--   0 runner    (1001) docker     (123)     2447 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/lightning/dc_lightning_module.py
--rw-r--r--   0 runner    (1001) docker     (123)    55220 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/losses.py
--rw-r--r--   0 runner    (1001) docker     (123)     8256 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/models.py
--rw-r--r--   0 runner    (1001) docker     (123)    13967 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/molgan.py
--rw-r--r--   0 runner    (1001) docker     (123)     5437 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/multitask.py
--rw-r--r--   0 runner    (1001) docker     (123)    10975 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/normalizing_flows.py
--rw-r--r--   0 runner    (1001) docker     (123)    26871 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/optimizers.py
--rw-r--r--   0 runner    (1001) docker     (123)    13095 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/progressive_multitask.py
--rw-r--r--   0 runner    (1001) docker     (123)    17830 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/robust_multitask.py
--rw-r--r--   0 runner    (1001) docker     (123)     4546 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/scscore.py
--rw-r--r--   0 runner    (1001) docker     (123)    25969 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/seqtoseq.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.688524 deepchem-2.7.2.dev20230512194842/deepchem/models/sklearn_models/
--rw-r--r--   0 runner    (1001) docker     (123)       87 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/sklearn_models/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     5679 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/sklearn_models/sklearn_model.py
--rw-r--r--   0 runner    (1001) docker     (123)    10552 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/text_cnn.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.692525 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/
--rw-r--r--   0 runner    (1001) docker     (123)     1956 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     3633 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/attention.py
--rw-r--r--   0 runner    (1001) docker     (123)    12226 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/attentivefp.py
--rw-r--r--   0 runner    (1001) docker     (123)    14455 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/cgcnn.py
--rw-r--r--   0 runner    (1001) docker     (123)     9543 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/cnn.py
--rw-r--r--   0 runner    (1001) docker     (123)    31166 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/dmpnn.py
--rw-r--r--   0 runner    (1001) docker     (123)     7143 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/ferminet.py
--rw-r--r--   0 runner    (1001) docker     (123)    15845 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/gat.py
--rw-r--r--   0 runner    (1001) docker     (123)    14944 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/gcn.py
--rw-r--r--   0 runner    (1001) docker     (123)    51159 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/gnn.py
--rw-r--r--   0 runner    (1001) docker     (123)    37602 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/grover.py
--rw-r--r--   0 runner    (1001) docker     (123)    38432 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/grover_layers.py
--rw-r--r--   0 runner    (1001) docker     (123)    21625 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/hf_models.py
--rw-r--r--   0 runner    (1001) docker     (123)    30077 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/infograph.py
--rw-r--r--   0 runner    (1001) docker     (123)    19215 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/kfac_optimizer.py
--rw-r--r--   0 runner    (1001) docker     (123)   109518 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/layers.py
--rw-r--r--   0 runner    (1001) docker     (123)    18575 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/lcnn.py
--rw-r--r--   0 runner    (1001) docker     (123)    17126 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/mat.py
--rw-r--r--   0 runner    (1001) docker     (123)    11170 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/megnet.py
--rw-r--r--   0 runner    (1001) docker     (123)    18122 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/modular.py
--rw-r--r--   0 runner    (1001) docker     (123)    12074 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/mpnn.py
--rw-r--r--   0 runner    (1001) docker     (123)     4165 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/normalizing_flows_pytorch.py
--rw-r--r--   0 runner    (1001) docker     (123)    12297 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/pagtn.py
--rw-r--r--   0 runner    (1001) docker     (123)     3528 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/readout.py
--rw-r--r--   0 runner    (1001) docker     (123)    52629 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/torch_model.py
--rw-r--r--   0 runner    (1001) docker     (123)     5249 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/models/wandblogger.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.692525 deepchem-2.7.2.dev20230512194842/deepchem/molnet/
--rw-r--r--   0 runner    (1001) docker     (123)     3339 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    11668 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/check_availability.py
--rw-r--r--   0 runner    (1001) docker     (123)     1845 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/defaults.py
--rw-r--r--   0 runner    (1001) docker     (123)    14702 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/dnasim.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.696524 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     5375 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/bace_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)    14202 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/bace_features.py
--rw-r--r--   0 runner    (1001) docker     (123)     5785 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/bbbc_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3604 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/bbbp_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     2623 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/cell_counting_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     4188 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/chembl25_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3706 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/chembl_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)    10252 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/chembl_tasks.py
--rw-r--r--   0 runner    (1001) docker     (123)     2625 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/clearance_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     4245 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/clintox_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3507 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/delaney_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     6957 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/factors_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3523 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/freesolv_dataset.py
--rw-r--r--   0 runner    (1001) docker     (123)     3496 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/hiv_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3437 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/hopv_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     2734 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/hppb_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     6379 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/kaggle_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)   165414 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/kaggle_features.py
--rw-r--r--   0 runner    (1001) docker     (123)     8104 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/kinase_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3318 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/lipo_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     9165 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/load_dataset_template.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.696524 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/material_datasets/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/material_datasets/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     4705 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/material_datasets/load_Pt_NO_surface_adsorbate_energy.py
--rw-r--r--   0 runner    (1001) docker     (123)     4474 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/material_datasets/load_bandgap.py
--rw-r--r--   0 runner    (1001) docker     (123)     4646 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/material_datasets/load_mp_formation_energy.py
--rw-r--r--   0 runner    (1001) docker     (123)     4589 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/material_datasets/load_mp_metallicity.py
--rw-r--r--   0 runner    (1001) docker     (123)     4516 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/material_datasets/load_perovskite.py
--rw-r--r--   0 runner    (1001) docker     (123)     8680 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/molnet_loader.py
--rw-r--r--   0 runner    (1001) docker     (123)     3631 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/muv_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3290 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/nci_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     6927 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/pcba_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     8586 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/pdbbind_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     2549 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/ppb_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     4800 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/qm7_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     5045 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/qm8_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     5697 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/qm9_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3567 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/sampl_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     4640 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/sider_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3140 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/sweetlead_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     2687 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/thermosol_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3530 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/tox21_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)    18900 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/toxcast_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     7662 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/uspto_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     6623 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/uv_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     2036 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/uv_tasks.py
--rw-r--r--   0 runner    (1001) docker     (123)     6517 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/zinc15_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     5319 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/preset_hyper_parameters.py
--rw-r--r--   0 runner    (1001) docker     (123)    13549 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/run_benchmark.py
--rw-r--r--   0 runner    (1001) docker     (123)     4874 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/run_benchmark_low_data.py
--rw-r--r--   0 runner    (1001) docker     (123)    36564 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/molnet/run_benchmark_models.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.700524 deepchem-2.7.2.dev20230512194842/deepchem/rl/
--rw-r--r--   0 runner    (1001) docker     (123)     9312 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/rl/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    23102 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/rl/a2c.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.700524 deepchem-2.7.2.dev20230512194842/deepchem/rl/envs/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/rl/envs/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1773 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/rl/envs/test_tictactoe.py
--rw-r--r--   0 runner    (1001) docker     (123)     3632 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/rl/envs/tictactoe.py
--rw-r--r--   0 runner    (1001) docker     (123)    25262 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/rl/ppo.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.700524 deepchem-2.7.2.dev20230512194842/deepchem/splits/
--rw-r--r--   0 runner    (1001) docker     (123)     1384 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/splits/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    63895 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/splits/splitters.py
--rw-r--r--   0 runner    (1001) docker     (123)     4017 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/splits/task_splitter.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.700524 deepchem-2.7.2.dev20230512194842/deepchem/trans/
--rw-r--r--   0 runner    (1001) docker     (123)     1255 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/trans/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     6571 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/trans/duplicate.py
--rw-r--r--   0 runner    (1001) docker     (123)    91191 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/trans/transformers.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.700524 deepchem-2.7.2.dev20230512194842/deepchem/utils/
--rw-r--r--   0 runner    (1001) docker     (123)     5222 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    10069 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/conformers.py
--rw-r--r--   0 runner    (1001) docker     (123)    13294 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/coordinate_box_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    20923 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/data_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     1840 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/debug_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     3041 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/dftutils.py
--rw-r--r--   0 runner    (1001) docker     (123)    10476 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/docking_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    13528 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/electron_sampler.py
--rw-r--r--   0 runner    (1001) docker     (123)    19454 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/evaluate.py
--rw-r--r--   0 runner    (1001) docker     (123)     6134 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/fake_data_generator.py
--rw-r--r--   0 runner    (1001) docker     (123)    13312 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/fragment_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     3903 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/genomics_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     8259 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/geometry_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     6554 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/grover.py
--rw-r--r--   0 runner    (1001) docker     (123)     3644 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/hash_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    19262 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/molecule_feature_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    17713 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/noncovalent_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    11749 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/pdbqt_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)      572 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/pytorch_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    65677 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/rdkit_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)      552 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/save.py
--rw-r--r--   0 runner    (1001) docker     (123)     6815 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/sequence_utils.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.704525 deepchem-2.7.2.dev20230512194842/deepchem/utils/test/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/test/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     6598 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_coordinate_box_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)      788 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_data_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)      896 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_dftutils.py
--rw-r--r--   0 runner    (1001) docker     (123)     2258 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_docking_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     3309 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_electron_sampler.py
--rw-r--r--   0 runner    (1001) docker     (123)    12977 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_evaluate.py
--rw-r--r--   0 runner    (1001) docker     (123)     2481 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_fake_data_generator.py
--rw-r--r--   0 runner    (1001) docker     (123)     2610 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_fragment_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     4684 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_generator_evaluator.py
--rw-r--r--   0 runner    (1001) docker     (123)     1956 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_genomics_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     3296 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_geometry_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     1523 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_grover.py
--rw-r--r--   0 runner    (1001) docker     (123)     1476 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_hash_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     9115 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_molecule_feature_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     6251 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_noncovalent_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     3922 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_pdbqt_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     9005 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_rdkit_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     2388 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_sequence_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     2859 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_voxel_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)      919 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/typing.py
--rw-r--r--   0 runner    (1001) docker     (123)     1113 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/vina_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     7797 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/deepchem/utils/voxel_utils.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:48:42.676524 deepchem-2.7.2.dev20230512194842/deepchem.egg-info/
--rw-r--r--   0 runner    (1001) docker     (123)     1072 2023-05-12 19:48:42.000000 deepchem-2.7.2.dev20230512194842/deepchem.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)    10437 2023-05-12 19:48:42.000000 deepchem-2.7.2.dev20230512194842/deepchem.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-05-12 19:48:42.000000 deepchem-2.7.2.dev20230512194842/deepchem.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (123)      241 2023-05-12 19:48:42.000000 deepchem-2.7.2.dev20230512194842/deepchem.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (123)        9 2023-05-12 19:48:42.000000 deepchem-2.7.2.dev20230512194842/deepchem.egg-info/top_level.txt
--rw-r--r--   0 runner    (1001) docker     (123)      701 2023-05-12 19:48:42.704525 deepchem-2.7.2.dev20230512194842/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (123)     2662 2023-05-12 19:48:32.000000 deepchem-2.7.2.dev20230512194842/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.830137 deepchem-2.7.2.dev20230512194912/
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1047 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)     1072 2023-05-12 19:49:12.830137 deepchem-2.7.2.dev20230512194912/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     7124 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/README.md
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.794136 deepchem-2.7.2.dev20230512194912/deepchem/
+-rw-r--r--   0 runner    (1001) docker     (123)      373 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.798137 deepchem-2.7.2.dev20230512194912/deepchem/data/
+-rw-r--r--   0 runner    (1001) docker     (123)      939 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/data/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    67894 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/data/data_loader.py
+-rw-r--r--   0 runner    (1001) docker     (123)   118009 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/data/datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7256 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/data/pytorch_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12606 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/data/supports.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.798137 deepchem-2.7.2.dev20230512194912/deepchem/dock/
+-rw-r--r--   0 runner    (1001) docker     (123)      297 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/dock/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4910 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/dock/binding_pocket.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6105 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/dock/docking.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19576 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/dock/pose_generation.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6917 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/dock/pose_scoring.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.798137 deepchem-2.7.2.dev20230512194912/deepchem/feat/
+-rw-r--r--   0 runner    (1001) docker     (123)     4457 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7335 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/atomic_conformation.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19279 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/base_classes.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1904 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/bert_tokenizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4368 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/binding_pocket_features.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.798137 deepchem-2.7.2.dev20230512194912/deepchem/feat/complex_featurizers/
+-rw-r--r--   0 runner    (1001) docker     (123)     1400 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/complex_featurizers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12898 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/complex_featurizers/complex_atomic_coordinates.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10769 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/complex_featurizers/contact_fingerprints.py
+-rw-r--r--   0 runner    (1001) docker     (123)    27676 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/complex_featurizers/grid_featurizers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20248 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/complex_featurizers/rdkit_grid_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11465 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/complex_featurizers/splif_fingerprints.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11743 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/dft_data.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21863 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/graph_data.py
+-rw-r--r--   0 runner    (1001) docker     (123)    38890 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/graph_features.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1396 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/huggingface_featurizer.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.802137 deepchem-2.7.2.dev20230512194912/deepchem/feat/material_featurizers/
+-rw-r--r--   0 runner    (1001) docker     (123)      489 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/material_featurizers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7539 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/material_featurizers/cgcnn_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3508 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/material_featurizers/element_property_fingerprint.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3232 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/material_featurizers/elemnet_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    28058 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/material_featurizers/lcnn_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3823 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/material_featurizers/sine_coulomb_matrix.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14808 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/mol_graphs.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.802137 deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/
+-rw-r--r--   0 runner    (1001) docker     (123)     2073 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2884 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/atomic_coordinates.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2376 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/bp_symmetry_function_input.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6488 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/circular_fingerprint.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9448 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/conformer_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10925 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/coulomb_matrices.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19123 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/dmpnn_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7507 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/grover_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2046 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/maccs_keys_fingerprint.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8401 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/mat_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7587 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/mol2vec_fingerprint.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20381 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/mol_graph_conv_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9346 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/molgan_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2835 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/mordred_descriptors.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6359 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/one_hot_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2258 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/pubchem_fingerprint.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1687 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/raw_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9855 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/rdkit_descriptors.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7280 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/smiles_to_image.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5433 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/smiles_to_seq.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4313 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/snap_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3448 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/sparse_matrix_one_hot_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3909 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/reaction_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2326 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/roberta_tokenizer.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.802137 deepchem-2.7.2.dev20230512194912/deepchem/feat/sequence_featurizers/
+-rw-r--r--   0 runner    (1001) docker     (123)      112 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/sequence_featurizers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3383 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/sequence_featurizers/position_frequency_matrix_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11383 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/smiles_tokenizer.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.802137 deepchem-2.7.2.dev20230512194912/deepchem/feat/vocabulary_builders/
+-rw-r--r--   0 runner    (1001) docker     (123)      278 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/vocabulary_builders/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17291 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/vocabulary_builders/grover_vocab.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2315 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/vocabulary_builders/hf_vocab.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1116 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/feat/vocabulary_builders/vocabulary_builder.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.802137 deepchem-2.7.2.dev20230512194912/deepchem/hyper/
+-rw-r--r--   0 runner    (1001) docker     (123)      260 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/hyper/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5702 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/hyper/base_classes.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17151 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/hyper/gaussian_process.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10208 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/hyper/grid_search.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12427 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/hyper/random_search.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.806137 deepchem-2.7.2.dev20230512194912/deepchem/metalearning/
+-rw-r--r--   0 runner    (1001) docker     (123)      118 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/metalearning/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10539 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/metalearning/maml.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.806137 deepchem-2.7.2.dev20230512194912/deepchem/metrics/
+-rw-r--r--   0 runner    (1001) docker     (123)     2015 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/metrics/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7715 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/metrics/genomic_metrics.py
+-rw-r--r--   0 runner    (1001) docker     (123)    31620 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/metrics/metric.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6533 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/metrics/score_function.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.806137 deepchem-2.7.2.dev20230512194912/deepchem/models/
+-rw-r--r--   0 runner    (1001) docker     (123)     4780 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/IRV.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4365 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13833 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/atomic_conv.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4414 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/callbacks.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17354 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/chemnet_layers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15504 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/chemnet_models.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.806137 deepchem-2.7.2.dev20230512194912/deepchem/models/dft/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/dft/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9553 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/dft/dftxc.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9576 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/dft/nnxc.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4664 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/dft/scf.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23457 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/fcnet.py
+-rw-r--r--   0 runner    (1001) docker     (123)    24548 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/gan.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.806137 deepchem-2.7.2.dev20230512194912/deepchem/models/gbdt_models/
+-rw-r--r--   0 runner    (1001) docker     (123)       75 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/gbdt_models/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5921 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/gbdt_models/gbdt_model.py
+-rw-r--r--   0 runner    (1001) docker     (123)    57408 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/graph_models.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.810137 deepchem-2.7.2.dev20230512194912/deepchem/models/jax_models/
+-rw-r--r--   0 runner    (1001) docker     (123)      133 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/jax_models/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    28179 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/jax_models/jax_model.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3408 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/jax_models/layers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17070 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/jax_models/pinns_model.py
+-rw-r--r--   0 runner    (1001) docker     (123)    56522 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/keras_model.py
+-rw-r--r--   0 runner    (1001) docker     (123)   144759 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/layers.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.810137 deepchem-2.7.2.dev20230512194912/deepchem/models/lightning/
+-rw-r--r--   0 runner    (1001) docker     (123)      181 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/lightning/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1742 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/lightning/dc_lightning_dataset_module.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2447 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/lightning/dc_lightning_module.py
+-rw-r--r--   0 runner    (1001) docker     (123)    55220 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/losses.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8256 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/models.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13967 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/molgan.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5437 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/multitask.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10975 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/normalizing_flows.py
+-rw-r--r--   0 runner    (1001) docker     (123)    26871 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/optimizers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13095 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/progressive_multitask.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17830 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/robust_multitask.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4546 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/scscore.py
+-rw-r--r--   0 runner    (1001) docker     (123)    25969 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/seqtoseq.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.810137 deepchem-2.7.2.dev20230512194912/deepchem/models/sklearn_models/
+-rw-r--r--   0 runner    (1001) docker     (123)       87 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/sklearn_models/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5679 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/sklearn_models/sklearn_model.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10552 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/text_cnn.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.810137 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/
+-rw-r--r--   0 runner    (1001) docker     (123)     1956 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3633 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/attention.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12226 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/attentivefp.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14455 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/cgcnn.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9543 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/cnn.py
+-rw-r--r--   0 runner    (1001) docker     (123)    31166 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/dmpnn.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7143 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/ferminet.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15845 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/gat.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14944 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/gcn.py
+-rw-r--r--   0 runner    (1001) docker     (123)    51159 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/gnn.py
+-rw-r--r--   0 runner    (1001) docker     (123)    37602 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/grover.py
+-rw-r--r--   0 runner    (1001) docker     (123)    38432 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/grover_layers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21625 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/hf_models.py
+-rw-r--r--   0 runner    (1001) docker     (123)    30077 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/infograph.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19215 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/kfac_optimizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)   110013 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/layers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18575 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/lcnn.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17126 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/mat.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11170 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/megnet.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18122 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/modular.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12074 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/mpnn.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4165 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/normalizing_flows_pytorch.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12297 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/pagtn.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3528 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/readout.py
+-rw-r--r--   0 runner    (1001) docker     (123)    52629 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/torch_model.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5249 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/models/wandblogger.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.814137 deepchem-2.7.2.dev20230512194912/deepchem/molnet/
+-rw-r--r--   0 runner    (1001) docker     (123)     3339 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11668 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/check_availability.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1845 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/defaults.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14702 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/dnasim.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.818137 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5375 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/bace_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14202 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/bace_features.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5785 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/bbbc_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3604 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/bbbp_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2623 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/cell_counting_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4188 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/chembl25_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3706 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/chembl_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10252 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/chembl_tasks.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2625 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/clearance_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4245 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/clintox_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3507 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/delaney_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6957 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/factors_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3523 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/freesolv_dataset.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3496 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/hiv_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3437 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/hopv_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2734 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/hppb_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6379 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/kaggle_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)   165414 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/kaggle_features.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8104 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/kinase_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3318 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/lipo_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9165 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/load_dataset_template.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.818137 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/material_datasets/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/material_datasets/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4705 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/material_datasets/load_Pt_NO_surface_adsorbate_energy.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4474 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/material_datasets/load_bandgap.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4646 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/material_datasets/load_mp_formation_energy.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4589 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/material_datasets/load_mp_metallicity.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4516 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/material_datasets/load_perovskite.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8680 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/molnet_loader.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3631 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/muv_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3290 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/nci_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6927 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/pcba_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8586 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/pdbbind_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2549 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/ppb_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4800 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/qm7_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5045 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/qm8_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5697 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/qm9_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3567 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/sampl_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4640 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/sider_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3140 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/sweetlead_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2687 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/thermosol_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3530 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/tox21_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18900 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/toxcast_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7662 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/uspto_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6623 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/uv_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2036 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/uv_tasks.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6517 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/zinc15_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5319 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/preset_hyper_parameters.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13549 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/run_benchmark.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4874 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/run_benchmark_low_data.py
+-rw-r--r--   0 runner    (1001) docker     (123)    36564 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/molnet/run_benchmark_models.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.818137 deepchem-2.7.2.dev20230512194912/deepchem/rl/
+-rw-r--r--   0 runner    (1001) docker     (123)     9312 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/rl/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23102 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/rl/a2c.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.818137 deepchem-2.7.2.dev20230512194912/deepchem/rl/envs/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/rl/envs/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1773 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/rl/envs/test_tictactoe.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3632 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/rl/envs/tictactoe.py
+-rw-r--r--   0 runner    (1001) docker     (123)    25262 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/rl/ppo.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.818137 deepchem-2.7.2.dev20230512194912/deepchem/splits/
+-rw-r--r--   0 runner    (1001) docker     (123)     1384 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/splits/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    63895 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/splits/splitters.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4017 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/splits/task_splitter.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.818137 deepchem-2.7.2.dev20230512194912/deepchem/trans/
+-rw-r--r--   0 runner    (1001) docker     (123)     1255 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/trans/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6571 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/trans/duplicate.py
+-rw-r--r--   0 runner    (1001) docker     (123)    91191 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/trans/transformers.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.822137 deepchem-2.7.2.dev20230512194912/deepchem/utils/
+-rw-r--r--   0 runner    (1001) docker     (123)     5222 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10069 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/conformers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13294 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/coordinate_box_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20923 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/data_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1840 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/debug_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3041 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/dftutils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10476 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/docking_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13528 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/electron_sampler.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19454 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/evaluate.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6134 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/fake_data_generator.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13312 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/fragment_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3903 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/genomics_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8259 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/geometry_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6554 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/grover.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3644 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/hash_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19262 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/molecule_feature_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17713 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/noncovalent_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11749 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/pdbqt_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)      572 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/pytorch_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    65677 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/rdkit_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)      552 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/save.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6815 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/sequence_utils.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.830137 deepchem-2.7.2.dev20230512194912/deepchem/utils/test/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/test/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6598 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_coordinate_box_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)      788 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_data_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)      896 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_dftutils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2258 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_docking_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3309 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_electron_sampler.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12977 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_evaluate.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2481 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_fake_data_generator.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2610 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_fragment_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4684 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_generator_evaluator.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1956 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_genomics_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3296 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_geometry_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1523 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_grover.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1476 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_hash_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9115 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_molecule_feature_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6251 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_noncovalent_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3922 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_pdbqt_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9005 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_rdkit_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2388 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_sequence_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2859 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_voxel_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)      919 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/typing.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1113 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/vina_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7797 2023-05-12 19:49:02.000000 deepchem-2.7.2.dev20230512194912/deepchem/utils/voxel_utils.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-12 19:49:12.798137 deepchem-2.7.2.dev20230512194912/deepchem.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (123)     1072 2023-05-12 19:49:12.000000 deepchem-2.7.2.dev20230512194912/deepchem.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)    10437 2023-05-12 19:49:12.000000 deepchem-2.7.2.dev20230512194912/deepchem.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-05-12 19:49:12.000000 deepchem-2.7.2.dev20230512194912/deepchem.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      241 2023-05-12 19:49:12.000000 deepchem-2.7.2.dev20230512194912/deepchem.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        9 2023-05-12 19:49:12.000000 deepchem-2.7.2.dev20230512194912/deepchem.egg-info/top_level.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      701 2023-05-12 19:49:12.830137 deepchem-2.7.2.dev20230512194912/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (123)     2662 2023-05-12 19:49:03.000000 deepchem-2.7.2.dev20230512194912/setup.py
```

### Comparing `deepchem-2.7.2.dev20230512194842/LICENSE` & `deepchem-2.7.2.dev20230512194912/LICENSE`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/PKG-INFO` & `deepchem-2.7.2.dev20230512194912/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: deepchem
-Version: 2.7.2.dev20230512194842
+Version: 2.7.2.dev20230512194912
 Summary: Deep learning models for drug discovery,         quantum chemistry, and the life sciences.
 Home-page: https://github.com/deepchem/deepchem
 Maintainer: DeepChem contributors
 License: MIT
 Project-URL: Documentation, https://deepchem.readthedocs.io/en/latest/
 Project-URL: Source, https://github.com/deepchem/deepchem
 Keywords: deepchem,chemistry,biology,materials-science,life-science,drug-discovery
```

### Comparing `deepchem-2.7.2.dev20230512194842/README.md` & `deepchem-2.7.2.dev20230512194912/README.md`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/data/__init__.py` & `deepchem-2.7.2.dev20230512194912/deepchem/data/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/data/data_loader.py` & `deepchem-2.7.2.dev20230512194912/deepchem/data/data_loader.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/data/datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/data/datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/data/pytorch_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/data/pytorch_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/data/supports.py` & `deepchem-2.7.2.dev20230512194912/deepchem/data/supports.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/dock/binding_pocket.py` & `deepchem-2.7.2.dev20230512194912/deepchem/dock/binding_pocket.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/dock/docking.py` & `deepchem-2.7.2.dev20230512194912/deepchem/dock/docking.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/dock/pose_generation.py` & `deepchem-2.7.2.dev20230512194912/deepchem/dock/pose_generation.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/dock/pose_scoring.py` & `deepchem-2.7.2.dev20230512194912/deepchem/dock/pose_scoring.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/__init__.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/atomic_conformation.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/atomic_conformation.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/base_classes.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/base_classes.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/bert_tokenizer.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/bert_tokenizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/binding_pocket_features.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/binding_pocket_features.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/complex_featurizers/__init__.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/complex_featurizers/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/complex_featurizers/complex_atomic_coordinates.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/complex_featurizers/complex_atomic_coordinates.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/complex_featurizers/contact_fingerprints.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/complex_featurizers/contact_fingerprints.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/complex_featurizers/grid_featurizers.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/complex_featurizers/grid_featurizers.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/complex_featurizers/rdkit_grid_featurizer.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/complex_featurizers/rdkit_grid_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/complex_featurizers/splif_fingerprints.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/complex_featurizers/splif_fingerprints.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/dft_data.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/dft_data.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/graph_data.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/graph_data.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/graph_features.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/graph_features.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/huggingface_featurizer.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/huggingface_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/material_featurizers/cgcnn_featurizer.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/material_featurizers/cgcnn_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/material_featurizers/element_property_fingerprint.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/material_featurizers/element_property_fingerprint.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/material_featurizers/elemnet_featurizer.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/material_featurizers/elemnet_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/material_featurizers/lcnn_featurizer.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/material_featurizers/lcnn_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/material_featurizers/sine_coulomb_matrix.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/material_featurizers/sine_coulomb_matrix.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/mol_graphs.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/mol_graphs.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/__init__.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/atomic_coordinates.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/atomic_coordinates.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/bp_symmetry_function_input.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/bp_symmetry_function_input.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/circular_fingerprint.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/circular_fingerprint.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/conformer_featurizer.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/conformer_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/coulomb_matrices.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/coulomb_matrices.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/dmpnn_featurizer.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/dmpnn_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/grover_featurizer.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/grover_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/maccs_keys_fingerprint.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/maccs_keys_fingerprint.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/mat_featurizer.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/mat_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/mol2vec_fingerprint.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/mol2vec_fingerprint.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/mol_graph_conv_featurizer.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/mol_graph_conv_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/molgan_featurizer.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/molgan_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/mordred_descriptors.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/mordred_descriptors.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/one_hot_featurizer.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/one_hot_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/pubchem_fingerprint.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/pubchem_fingerprint.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/raw_featurizer.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/raw_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/rdkit_descriptors.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/rdkit_descriptors.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/smiles_to_image.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/smiles_to_image.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/smiles_to_seq.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/smiles_to_seq.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/snap_featurizer.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/snap_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/molecule_featurizers/sparse_matrix_one_hot_featurizer.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/molecule_featurizers/sparse_matrix_one_hot_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/reaction_featurizer.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/reaction_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/roberta_tokenizer.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/roberta_tokenizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/sequence_featurizers/position_frequency_matrix_featurizer.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/sequence_featurizers/position_frequency_matrix_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/smiles_tokenizer.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/smiles_tokenizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/vocabulary_builders/grover_vocab.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/vocabulary_builders/grover_vocab.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/vocabulary_builders/hf_vocab.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/vocabulary_builders/hf_vocab.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/feat/vocabulary_builders/vocabulary_builder.py` & `deepchem-2.7.2.dev20230512194912/deepchem/feat/vocabulary_builders/vocabulary_builder.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/hyper/base_classes.py` & `deepchem-2.7.2.dev20230512194912/deepchem/hyper/base_classes.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/hyper/gaussian_process.py` & `deepchem-2.7.2.dev20230512194912/deepchem/hyper/gaussian_process.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/hyper/grid_search.py` & `deepchem-2.7.2.dev20230512194912/deepchem/hyper/grid_search.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/hyper/random_search.py` & `deepchem-2.7.2.dev20230512194912/deepchem/hyper/random_search.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/metalearning/maml.py` & `deepchem-2.7.2.dev20230512194912/deepchem/metalearning/maml.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/metrics/__init__.py` & `deepchem-2.7.2.dev20230512194912/deepchem/metrics/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/metrics/genomic_metrics.py` & `deepchem-2.7.2.dev20230512194912/deepchem/metrics/genomic_metrics.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/metrics/metric.py` & `deepchem-2.7.2.dev20230512194912/deepchem/metrics/metric.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/metrics/score_function.py` & `deepchem-2.7.2.dev20230512194912/deepchem/metrics/score_function.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/IRV.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/IRV.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/__init__.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/atomic_conv.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/atomic_conv.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/callbacks.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/callbacks.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/chemnet_layers.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/chemnet_layers.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/chemnet_models.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/chemnet_models.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/dft/dftxc.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/dft/dftxc.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/dft/nnxc.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/dft/nnxc.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/dft/scf.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/dft/scf.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/fcnet.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/fcnet.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/gan.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/gan.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/gbdt_models/gbdt_model.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/gbdt_models/gbdt_model.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/graph_models.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/graph_models.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/jax_models/jax_model.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/jax_models/jax_model.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/jax_models/layers.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/jax_models/layers.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/jax_models/pinns_model.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/jax_models/pinns_model.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/keras_model.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/keras_model.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/layers.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/layers.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/lightning/dc_lightning_dataset_module.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/lightning/dc_lightning_dataset_module.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/lightning/dc_lightning_module.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/lightning/dc_lightning_module.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/losses.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/losses.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/models.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/models.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/molgan.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/molgan.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/multitask.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/multitask.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/normalizing_flows.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/normalizing_flows.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/optimizers.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/optimizers.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/progressive_multitask.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/progressive_multitask.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/robust_multitask.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/robust_multitask.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/scscore.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/scscore.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/seqtoseq.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/seqtoseq.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/sklearn_models/sklearn_model.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/sklearn_models/sklearn_model.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/text_cnn.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/text_cnn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/__init__.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/attention.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/attention.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/attentivefp.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/attentivefp.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/cgcnn.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/cgcnn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/cnn.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/cnn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/dmpnn.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/dmpnn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/ferminet.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/ferminet.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/gat.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/gat.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/gcn.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/gcn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/gnn.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/gnn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/grover.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/grover.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/grover_layers.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/grover_layers.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/hf_models.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/hf_models.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/infograph.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/infograph.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/kfac_optimizer.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/kfac_optimizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/layers.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/layers.py`

 * *Files 1% similar despite different names*

```diff
@@ -70,6776 +70,6807 @@
 00000450: 7574 3a20 696e 742c 0a20 2020 2020 2020  ut: int,.       
 00000460: 2020 2020 2020 2020 2020 645f 6869 6464            d_hidd
 00000470: 656e 3a20 4f70 7469 6f6e 616c 5b74 7570  en: Optional[tup
 00000480: 6c65 5d20 3d20 4e6f 6e65 2c0a 2020 2020  le] = None,.    
 00000490: 2020 2020 2020 2020 2020 2020 2064 726f               dro
 000004a0: 706f 7574 3a20 666c 6f61 7420 3d20 302e  pout: float = 0.
 000004b0: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
-000004c0: 2020 2020 6163 7469 7661 7469 6f6e 5f66      activation_f
-000004d0: 6e3a 2055 6e69 6f6e 5b43 616c 6c61 626c  n: Union[Callabl
-000004e0: 652c 2073 7472 5d20 3d20 2772 656c 7527  e, str] = 'relu'
-000004f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00000500: 2020 2073 6b69 705f 636f 6e6e 6563 7469     skip_connecti
-00000510: 6f6e 3a20 626f 6f6c 203d 2046 616c 7365  on: bool = False
-00000520: 293a 0a20 2020 2020 2020 2022 2222 496e  ):.        """In
-00000530: 6974 6961 6c69 7a65 2074 6865 206d 6f64  itialize the mod
-00000540: 656c 2e0a 0a20 2020 2020 2020 2050 6172  el...        Par
-00000550: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
-00000560: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-00000570: 2020 2064 5f69 6e70 7574 3a20 696e 740a     d_input: int.
-00000580: 2020 2020 2020 2020 2020 2020 7468 6520              the 
-00000590: 6469 6d65 6e73 696f 6e20 6f66 2074 6865  dimension of the
-000005a0: 2069 6e70 7574 206c 6179 6572 0a20 2020   input layer.   
-000005b0: 2020 2020 2064 5f6f 7574 7075 743a 2069       d_output: i
-000005c0: 6e74 0a20 2020 2020 2020 2020 2020 2074  nt.            t
-000005d0: 6865 2064 696d 656e 7369 6f6e 206f 6620  he dimension of 
-000005e0: 7468 6520 6f75 7470 7574 206c 6179 6572  the output layer
-000005f0: 0a20 2020 2020 2020 2064 5f68 6964 6465  .        d_hidde
-00000600: 6e3a 2074 7570 6c65 0a20 2020 2020 2020  n: tuple.       
-00000610: 2020 2020 2074 6865 2064 696d 656e 7369       the dimensi
-00000620: 6f6e 7320 6f66 2074 6865 2068 6964 6465  ons of the hidde
-00000630: 6e20 6c61 7965 7273 0a20 2020 2020 2020  n layers.       
-00000640: 2064 726f 706f 7574 3a20 666c 6f61 740a   dropout: float.
-00000650: 2020 2020 2020 2020 2020 2020 7468 6520              the 
-00000660: 6472 6f70 6f75 7420 7072 6f62 6162 696c  dropout probabil
-00000670: 6974 790a 2020 2020 2020 2020 6163 7469  ity.        acti
-00000680: 7661 7469 6f6e 5f66 6e3a 2073 7472 0a20  vation_fn: str. 
-00000690: 2020 2020 2020 2020 2020 2074 6865 2061             the a
-000006a0: 6374 6976 6174 696f 6e20 6675 6e63 7469  ctivation functi
-000006b0: 6f6e 2074 6f20 7573 6520 696e 2074 6865  on to use in the
-000006c0: 2068 6964 6465 6e20 6c61 7965 7273 0a20   hidden layers. 
-000006d0: 2020 2020 2020 2073 6b69 705f 636f 6e6e         skip_conn
-000006e0: 6563 7469 6f6e 3a20 626f 6f6c 0a20 2020  ection: bool.   
-000006f0: 2020 2020 2020 2020 2077 6865 7468 6572           whether
-00000700: 2074 6f20 6164 6420 6120 736b 6970 2063   to add a skip c
-00000710: 6f6e 6e65 6374 696f 6e20 6672 6f6d 2074  onnection from t
-00000720: 6865 2069 6e70 7574 2074 6f20 7468 6520  he input to the 
-00000730: 6f75 7470 7574 0a20 2020 2020 2020 2022  output.        "
-00000740: 2222 0a20 2020 2020 2020 2073 7570 6572  "".        super
-00000750: 284d 756c 7469 6c61 7965 7250 6572 6365  (MultilayerPerce
-00000760: 7074 726f 6e2c 2073 656c 6629 2e5f 5f69  ptron, self).__i
-00000770: 6e69 745f 5f28 290a 2020 2020 2020 2020  nit__().        
-00000780: 7365 6c66 2e64 5f69 6e70 7574 203d 2064  self.d_input = d
-00000790: 5f69 6e70 7574 0a20 2020 2020 2020 2073  _input.        s
-000007a0: 656c 662e 645f 6869 6464 656e 203d 2064  elf.d_hidden = d
-000007b0: 5f68 6964 6465 6e0a 2020 2020 2020 2020  _hidden.        
-000007c0: 7365 6c66 2e64 5f6f 7574 7075 7420 3d20  self.d_output = 
-000007d0: 645f 6f75 7470 7574 0a20 2020 2020 2020  d_output.       
-000007e0: 2073 656c 662e 6472 6f70 6f75 7420 3d20   self.dropout = 
-000007f0: 6e6e 2e44 726f 706f 7574 2864 726f 706f  nn.Dropout(dropo
-00000800: 7574 290a 2020 2020 2020 2020 7365 6c66  ut).        self
-00000810: 2e61 6374 6976 6174 696f 6e5f 666e 203d  .activation_fn =
-00000820: 2067 6574 5f61 6374 6976 6174 696f 6e28   get_activation(
-00000830: 6163 7469 7661 7469 6f6e 5f66 6e29 0a20  activation_fn). 
-00000840: 2020 2020 2020 2073 656c 662e 6d6f 6465         self.mode
-00000850: 6c20 3d20 6e6e 2e53 6571 7565 6e74 6961  l = nn.Sequentia
-00000860: 6c28 2a73 656c 662e 6275 696c 645f 6c61  l(*self.build_la
-00000870: 7965 7273 2829 290a 2020 2020 2020 2020  yers()).        
-00000880: 7365 6c66 2e73 6b69 7020 3d20 6e6e 2e4c  self.skip = nn.L
-00000890: 696e 6561 7228 645f 696e 7075 742c 2064  inear(d_input, d
-000008a0: 5f6f 7574 7075 7429 2069 6620 736b 6970  _output) if skip
-000008b0: 5f63 6f6e 6e65 6374 696f 6e20 656c 7365  _connection else
-000008c0: 204e 6f6e 650a 0a20 2020 2064 6566 2062   None..    def b
-000008d0: 7569 6c64 5f6c 6179 6572 7328 7365 6c66  uild_layers(self
-000008e0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-000008f0: 2020 2020 2020 2042 7569 6c64 2074 6865         Build the
-00000900: 206c 6179 6572 7320 6f66 2074 6865 206d   layers of the m
-00000910: 6f64 656c 2c20 6974 6572 6174 696e 6720  odel, iterating 
-00000920: 7468 726f 7567 6820 7468 6520 6869 6464  through the hidd
-00000930: 656e 2064 696d 656e 7369 6f6e 7320 746f  en dimensions to
-00000940: 2070 726f 6475 6365 2061 206c 6973 7420   produce a list 
-00000950: 6f66 206c 6179 6572 732e 0a20 2020 2020  of layers..     
-00000960: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-00000970: 6c61 7965 725f 6c69 7374 203d 205b 5d0a  layer_list = [].
-00000980: 2020 2020 2020 2020 6c61 7965 725f 6469          layer_di
-00000990: 6d20 3d20 7365 6c66 2e64 5f69 6e70 7574  m = self.d_input
-000009a0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-000009b0: 2e64 5f68 6964 6465 6e20 6973 206e 6f74  .d_hidden is not
-000009c0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000009d0: 2020 2066 6f72 2064 2069 6e20 7365 6c66     for d in self
-000009e0: 2e64 5f68 6964 6465 6e3a 0a20 2020 2020  .d_hidden:.     
-000009f0: 2020 2020 2020 2020 2020 206c 6179 6572             layer
-00000a00: 5f6c 6973 742e 6170 7065 6e64 286e 6e2e  _list.append(nn.
-00000a10: 4c69 6e65 6172 286c 6179 6572 5f64 696d  Linear(layer_dim
-00000a20: 2c20 6429 290a 2020 2020 2020 2020 2020  , d)).          
-00000a30: 2020 2020 2020 6c61 7965 725f 6c69 7374        layer_list
-00000a40: 2e61 7070 656e 6428 7365 6c66 2e64 726f  .append(self.dro
-00000a50: 706f 7574 290a 2020 2020 2020 2020 2020  pout).          
-00000a60: 2020 2020 2020 6c61 7965 725f 6469 6d20        layer_dim 
-00000a70: 3d20 640a 2020 2020 2020 2020 6c61 7965  = d.        laye
-00000a80: 725f 6c69 7374 2e61 7070 656e 6428 6e6e  r_list.append(nn
-00000a90: 2e4c 696e 6561 7228 6c61 7965 725f 6469  .Linear(layer_di
-00000aa0: 6d2c 2073 656c 662e 645f 6f75 7470 7574  m, self.d_output
-00000ab0: 2929 0a20 2020 2020 2020 2072 6574 7572  )).        retur
-00000ac0: 6e20 6c61 7965 725f 6c69 7374 0a0a 2020  n layer_list..  
-00000ad0: 2020 6465 6620 666f 7277 6172 6428 7365    def forward(se
-00000ae0: 6c66 2c20 783a 2054 656e 736f 7229 202d  lf, x: Tensor) -
-00000af0: 3e20 5465 6e73 6f72 3a0a 2020 2020 2020  > Tensor:.      
-00000b00: 2020 2222 2246 6f72 7761 7264 2070 6173    """Forward pas
-00000b10: 7320 6f66 2074 6865 206d 6f64 656c 2e22  s of the model."
-00000b20: 2222 0a20 2020 2020 2020 2069 6e70 7574  "".        input
-00000b30: 203d 2078 0a20 2020 2020 2020 2066 6f72   = x.        for
-00000b40: 206c 6179 6572 2069 6e20 7365 6c66 2e6d   layer in self.m
-00000b50: 6f64 656c 3a0a 2020 2020 2020 2020 2020  odel:.          
-00000b60: 2020 7820 3d20 6c61 7965 7228 7829 0a20    x = layer(x). 
-00000b70: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-00000b80: 696e 7374 616e 6365 286c 6179 6572 2c20  instance(layer, 
-00000b90: 6e6e 2e4c 696e 6561 7229 3a0a 2020 2020  nn.Linear):.    
-00000ba0: 2020 2020 2020 2020 2020 2020 7820 3d20              x = 
-00000bb0: 7365 6c66 2e61 6374 6976 6174 696f 6e5f  self.activation_
-00000bc0: 666e 280a 2020 2020 2020 2020 2020 2020  fn(.            
-00000bd0: 2020 2020 2020 2020 780a 2020 2020 2020          x.      
-00000be0: 2020 2020 2020 2020 2020 2920 2023 2044            )  # D
-00000bf0: 6f6e 6520 6265 6361 7573 6520 6163 7469  one because acti
-00000c00: 7661 7469 6f6e 5f66 6e20 7265 7475 726e  vation_fn return
-00000c10: 7320 6120 746f 7263 682e 6e6e 2e66 756e  s a torch.nn.fun
-00000c20: 6374 696f 6e61 6c0a 2020 2020 2020 2020  ctional.        
-00000c30: 6966 2073 656c 662e 736b 6970 2069 7320  if self.skip is 
-00000c40: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00000c50: 2020 2020 2020 7265 7475 726e 2078 202b        return x +
-00000c60: 2073 656c 662e 736b 6970 2869 6e70 7574   self.skip(input
-00000c70: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00000c80: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00000c90: 726e 2078 0a0a 0a63 6c61 7373 2043 4e4e  rn x...class CNN
-00000ca0: 4d6f 6475 6c65 286e 6e2e 4d6f 6475 6c65  Module(nn.Module
-00000cb0: 293a 0a20 2020 2022 2222 4120 312c 2032  ):.    """A 1, 2
-00000cc0: 2c20 6f72 2033 2064 696d 656e 7369 6f6e  , or 3 dimension
-00000cd0: 616c 2063 6f6e 766f 6c75 7469 6f6e 616c  al convolutional
-00000ce0: 206e 6574 776f 726b 2066 6f72 2065 6974   network for eit
-00000cf0: 6865 7220 7265 6772 6573 7369 6f6e 206f  her regression o
-00000d00: 7220 636c 6173 7369 6669 6361 7469 6f6e  r classification
-00000d10: 2e0a 2020 2020 5468 6520 6e65 7477 6f72  ..    The networ
-00000d20: 6b20 636f 6e73 6973 7473 206f 6620 7468  k consists of th
-00000d30: 6520 666f 6c6c 6f77 696e 6720 7365 7175  e following sequ
-00000d40: 656e 6365 206f 6620 6c61 7965 7273 3a0a  ence of layers:.
-00000d50: 2020 2020 2d20 4120 636f 6e66 6967 7572      - A configur
-00000d60: 6162 6c65 206e 756d 6265 7220 6f66 2063  able number of c
-00000d70: 6f6e 766f 6c75 7469 6f6e 616c 206c 6179  onvolutional lay
-00000d80: 6572 730a 2020 2020 2d20 4120 676c 6f62  ers.    - A glob
-00000d90: 616c 2070 6f6f 6c69 6e67 206c 6179 6572  al pooling layer
-00000da0: 2028 6569 7468 6572 206d 6178 2070 6f6f   (either max poo
-00000db0: 6c20 6f72 2061 7665 7261 6765 2070 6f6f  l or average poo
-00000dc0: 6c29 0a20 2020 202d 2041 2066 696e 616c  l).    - A final
-00000dd0: 2066 756c 6c79 2063 6f6e 6e65 6374 6564   fully connected
-00000de0: 206c 6179 6572 2074 6f20 636f 6d70 7574   layer to comput
-00000df0: 6520 7468 6520 6f75 7470 7574 0a20 2020  e the output.   
-00000e00: 2049 7420 6f70 7469 6f6e 616c 6c79 2063   It optionally c
-00000e10: 616e 2063 6f6d 706f 7365 2074 6865 206d  an compose the m
-00000e20: 6f64 656c 2066 726f 6d20 7072 652d 6163  odel from pre-ac
-00000e30: 7469 7661 7469 6f6e 2072 6573 6964 7561  tivation residua
-00000e40: 6c20 626c 6f63 6b73 2c20 6173 0a20 2020  l blocks, as.   
-00000e50: 2064 6573 6372 6962 6564 2069 6e20 6874   described in ht
-00000e60: 7470 733a 2f2f 6172 7869 762e 6f72 672f  tps://arxiv.org/
-00000e70: 6162 732f 3136 3033 2e30 3530 3237 2c20  abs/1603.05027, 
-00000e80: 7261 7468 6572 2074 6861 6e20 6120 7369  rather than a si
-00000e90: 6d70 6c65 2073 7461 636b 206f 660a 2020  mple stack of.  
-00000ea0: 2020 636f 6e76 6f6c 7574 696f 6e20 6c61    convolution la
-00000eb0: 7965 7273 2e20 2054 6869 7320 6f66 7465  yers.  This ofte
-00000ec0: 6e20 6c65 6164 7320 746f 2065 6173 6965  n leads to easie
-00000ed0: 7220 7472 6169 6e69 6e67 2c20 6573 7065  r training, espe
-00000ee0: 6369 616c 6c79 2077 6865 6e20 7573 696e  cially when usin
-00000ef0: 6720 610a 2020 2020 6c61 7267 6520 6e75  g a.    large nu
-00000f00: 6d62 6572 206f 6620 6c61 7965 7273 2e20  mber of layers. 
-00000f10: 204e 6f74 6520 7468 6174 2072 6573 6964   Note that resid
-00000f20: 7561 6c20 626c 6f63 6b73 2063 616e 206f  ual blocks can o
-00000f30: 6e6c 7920 6265 2075 7365 6420 7768 656e  nly be used when
-00000f40: 0a20 2020 2073 7563 6365 7373 6976 6520  .    successive 
-00000f50: 6c61 7965 7273 2068 6176 6520 7468 6520  layers have the 
-00000f60: 7361 6d65 206f 7574 7075 7420 7368 6170  same output shap
-00000f70: 652e 2020 5768 6572 6576 6572 2074 6865  e.  Wherever the
-00000f80: 206f 7574 7075 7420 7368 6170 6520 6368   output shape ch
-00000f90: 616e 6765 732c 2061 0a20 2020 2073 696d  anges, a.    sim
-00000fa0: 706c 6520 636f 6e76 6f6c 7574 696f 6e20  ple convolution 
-00000fb0: 6c61 7965 7220 7769 6c6c 2062 6520 7573  layer will be us
-00000fc0: 6564 2065 7665 6e20 6966 2072 6573 6964  ed even if resid
-00000fd0: 7561 6c3d 5472 7565 2e0a 2020 2020 4578  ual=True..    Ex
-00000fe0: 616d 706c 6573 0a20 2020 202d 2d2d 2d2d  amples.    -----
-00000ff0: 2d2d 2d0a 2020 2020 3e3e 3e20 6d6f 6465  ---.    >>> mode
-00001000: 6c20 3d20 434e 4e4d 6f64 756c 6528 6e5f  l = CNNModule(n_
-00001010: 7461 736b 733d 352c 206e 5f66 6561 7475  tasks=5, n_featu
-00001020: 7265 733d 382c 2064 696d 733d 322c 206c  res=8, dims=2, l
-00001030: 6179 6572 5f66 696c 7465 7273 3d5b 332c  ayer_filters=[3,
-00001040: 382c 382c 3136 5d2c 206b 6572 6e65 6c5f  8,8,16], kernel_
-00001050: 7369 7a65 3d33 2c20 6e5f 636c 6173 7365  size=3, n_classe
-00001060: 7320 3d20 372c 206d 6f64 653d 2763 6c61  s = 7, mode='cla
-00001070: 7373 6966 6963 6174 696f 6e27 2c20 756e  ssification', un
-00001080: 6365 7274 6169 6e74 793d 4661 6c73 652c  certainty=False,
-00001090: 2070 6164 6469 6e67 3d27 7361 6d65 2729   padding='same')
-000010a0: 0a20 2020 203e 3e3e 2078 203d 2074 6f72  .    >>> x = tor
-000010b0: 6368 2e6f 6e65 7328 322c 2032 3234 2c20  ch.ones(2, 224, 
-000010c0: 3232 342c 2038 290a 2020 2020 3e3e 3e20  224, 8).    >>> 
-000010d0: 7820 3d20 6d6f 6465 6c28 7829 0a20 2020  x = model(x).   
-000010e0: 203e 3e3e 2066 6f72 2074 656e 736f 7220   >>> for tensor 
-000010f0: 696e 2078 3a0a 2020 2020 2e2e 2e20 2020  in x:.    ...   
-00001100: 2070 7269 6e74 2874 656e 736f 722e 7368   print(tensor.sh
-00001110: 6170 6529 0a20 2020 2074 6f72 6368 2e53  ape).    torch.S
-00001120: 697a 6528 5b32 2c20 352c 2037 5d29 0a20  ize([2, 5, 7]). 
-00001130: 2020 2074 6f72 6368 2e53 697a 6528 5b32     torch.Size([2
-00001140: 2c20 352c 2037 5d29 0a20 2020 2022 2222  , 5, 7]).    """
-00001150: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-00001160: 5f5f 2873 656c 662c 0a20 2020 2020 2020  __(self,.       
-00001170: 2020 2020 2020 2020 2020 6e5f 7461 736b            n_task
-00001180: 733a 2069 6e74 2c0a 2020 2020 2020 2020  s: int,.        
-00001190: 2020 2020 2020 2020 206e 5f66 6561 7475           n_featu
-000011a0: 7265 733a 2069 6e74 2c0a 2020 2020 2020  res: int,.      
-000011b0: 2020 2020 2020 2020 2020 2064 696d 733a             dims:
-000011c0: 2069 6e74 2c0a 2020 2020 2020 2020 2020   int,.          
-000011d0: 2020 2020 2020 206c 6179 6572 5f66 696c         layer_fil
-000011e0: 7465 7273 3a20 4c69 7374 5b69 6e74 5d20  ters: List[int] 
-000011f0: 3d20 5b31 3030 5d2c 0a20 2020 2020 2020  = [100],.       
-00001200: 2020 2020 2020 2020 2020 6b65 726e 656c            kernel
-00001210: 5f73 697a 653a 204f 6e65 4f72 4d61 6e79  _size: OneOrMany
-00001220: 5b69 6e74 5d20 3d20 352c 0a20 2020 2020  [int] = 5,.     
-00001230: 2020 2020 2020 2020 2020 2020 7374 7269              stri
-00001240: 6465 733a 204f 6e65 4f72 4d61 6e79 5b69  des: OneOrMany[i
-00001250: 6e74 5d20 3d20 312c 0a20 2020 2020 2020  nt] = 1,.       
-00001260: 2020 2020 2020 2020 2020 7765 6967 6874            weight
-00001270: 5f69 6e69 745f 7374 6464 6576 733a 204f  _init_stddevs: O
-00001280: 6e65 4f72 4d61 6e79 5b66 6c6f 6174 5d20  neOrMany[float] 
-00001290: 3d20 302e 3032 2c0a 2020 2020 2020 2020  = 0.02,.        
-000012a0: 2020 2020 2020 2020 2062 6961 735f 696e           bias_in
-000012b0: 6974 5f63 6f6e 7374 733a 204f 6e65 4f72  it_consts: OneOr
-000012c0: 4d61 6e79 5b66 6c6f 6174 5d20 3d20 312e  Many[float] = 1.
-000012d0: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
-000012e0: 2020 2020 6472 6f70 6f75 7473 3a20 4f6e      dropouts: On
-000012f0: 654f 724d 616e 795b 666c 6f61 745d 203d  eOrMany[float] =
-00001300: 2030 2e35 2c0a 2020 2020 2020 2020 2020   0.5,.          
-00001310: 2020 2020 2020 2061 6374 6976 6174 696f         activatio
-00001320: 6e5f 666e 733a 204f 6e65 4f72 4d61 6e79  n_fns: OneOrMany
-00001330: 5b41 6374 6976 6174 696f 6e46 6e5d 203d  [ActivationFn] =
-00001340: 2027 7265 6c75 272c 0a20 2020 2020 2020   'relu',.       
-00001350: 2020 2020 2020 2020 2020 706f 6f6c 5f74            pool_t
-00001360: 7970 653a 2073 7472 203d 2027 6d61 7827  ype: str = 'max'
-00001370: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00001380: 2020 206d 6f64 653a 2073 7472 203d 2027     mode: str = '
-00001390: 636c 6173 7369 6669 6361 7469 6f6e 272c  classification',
-000013a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000013b0: 2020 6e5f 636c 6173 7365 733a 2069 6e74    n_classes: int
-000013c0: 203d 2032 2c0a 2020 2020 2020 2020 2020   = 2,.          
-000013d0: 2020 2020 2020 2075 6e63 6572 7461 696e         uncertain
-000013e0: 7479 3a20 626f 6f6c 203d 2046 616c 7365  ty: bool = False
-000013f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00001400: 2020 2072 6573 6964 7561 6c3a 2062 6f6f     residual: boo
-00001410: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
-00001420: 2020 2020 2020 2020 2020 2020 7061 6464              padd
-00001430: 696e 673a 2055 6e69 6f6e 5b69 6e74 2c20  ing: Union[int, 
-00001440: 7374 725d 203d 2027 7661 6c69 6427 2920  str] = 'valid') 
-00001450: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00001460: 2022 2222 4372 6561 7465 2061 2043 4e4e   """Create a CNN
-00001470: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
-00001480: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
-00001490: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-000014a0: 206e 5f74 6173 6b73 3a20 696e 740a 2020   n_tasks: int.  
-000014b0: 2020 2020 2020 2020 2020 6e75 6d62 6572            number
-000014c0: 206f 6620 7461 736b 730a 2020 2020 2020   of tasks.      
-000014d0: 2020 6e5f 6665 6174 7572 6573 3a20 696e    n_features: in
-000014e0: 740a 2020 2020 2020 2020 2020 2020 6e75  t.            nu
-000014f0: 6d62 6572 206f 6620 6665 6174 7572 6573  mber of features
-00001500: 0a20 2020 2020 2020 2064 696d 733a 2069  .        dims: i
-00001510: 6e74 0a20 2020 2020 2020 2020 2020 2074  nt.            t
-00001520: 6865 206e 756d 6265 7220 6f66 2064 696d  he number of dim
-00001530: 656e 7369 6f6e 7320 746f 2061 7070 6c79  ensions to apply
-00001540: 2063 6f6e 766f 6c75 7469 6f6e 7320 6f76   convolutions ov
-00001550: 6572 2028 312c 2032 2c20 6f72 2033 290a  er (1, 2, or 3).
-00001560: 2020 2020 2020 2020 6c61 7965 725f 6669          layer_fi
-00001570: 6c74 6572 733a 206c 6973 740a 2020 2020  lters: list.    
-00001580: 2020 2020 2020 2020 7468 6520 6e75 6d62          the numb
-00001590: 6572 206f 6620 6f75 7470 7574 2066 696c  er of output fil
-000015a0: 7465 7273 2066 6f72 2065 6163 6820 636f  ters for each co
-000015b0: 6e76 6f6c 7574 696f 6e61 6c20 6c61 7965  nvolutional laye
-000015c0: 7220 696e 2074 6865 206e 6574 776f 726b  r in the network
-000015d0: 2e0a 2020 2020 2020 2020 2020 2020 5468  ..            Th
-000015e0: 6520 6c65 6e67 7468 206f 6620 7468 6973  e length of this
-000015f0: 206c 6973 7420 6465 7465 726d 696e 6573   list determines
-00001600: 2074 6865 206e 756d 6265 7220 6f66 206c   the number of l
-00001610: 6179 6572 732e 0a20 2020 2020 2020 206b  ayers..        k
-00001620: 6572 6e65 6c5f 7369 7a65 3a20 696e 742c  ernel_size: int,
-00001630: 2074 7570 6c65 2c20 6f72 206c 6973 740a   tuple, or list.
-00001640: 2020 2020 2020 2020 2020 2020 6120 6c69              a li
-00001650: 7374 2067 6976 696e 6720 7468 6520 7368  st giving the sh
-00001660: 6170 6520 6f66 2074 6865 2063 6f6e 766f  ape of the convo
-00001670: 6c75 7469 6f6e 616c 206b 6572 6e65 6c20  lutional kernel 
-00001680: 666f 7220 6561 6368 206c 6179 6572 2e20  for each layer. 
-00001690: 2045 6163 680a 2020 2020 2020 2020 2020   Each.          
-000016a0: 2020 656c 656d 656e 7420 6d61 7920 6265    element may be
-000016b0: 2065 6974 6865 7220 616e 2069 6e74 2028   either an int (
-000016c0: 7573 6520 7468 6520 7361 6d65 206b 6572  use the same ker
-000016d0: 6e65 6c20 7769 6474 6820 666f 7220 6576  nel width for ev
-000016e0: 6572 7920 6469 6d65 6e73 696f 6e29 0a20  ery dimension). 
-000016f0: 2020 2020 2020 2020 2020 206f 7220 6120             or a 
-00001700: 7475 706c 6520 2874 6865 206b 6572 6e65  tuple (the kerne
-00001710: 6c20 7769 6474 6820 616c 6f6e 6720 6561  l width along ea
-00001720: 6368 2064 696d 656e 7369 6f6e 292e 2020  ch dimension).  
-00001730: 416c 7465 726e 6174 6976 656c 7920 7468  Alternatively th
-00001740: 6973 206d 6179 0a20 2020 2020 2020 2020  is may.         
-00001750: 2020 2062 6520 6120 7369 6e67 6c65 2069     be a single i
-00001760: 6e74 206f 7220 7475 706c 6520 696e 7374  nt or tuple inst
-00001770: 6561 6420 6f66 2061 206c 6973 742c 2069  ead of a list, i
-00001780: 6e20 7768 6963 6820 6361 7365 2074 6865  n which case the
-00001790: 2073 616d 6520 6b65 726e 656c 0a20 2020   same kernel.   
-000017a0: 2020 2020 2020 2020 2073 6861 7065 2069           shape i
-000017b0: 7320 7573 6564 2066 6f72 2065 7665 7279  s used for every
-000017c0: 206c 6179 6572 2e0a 2020 2020 2020 2020   layer..        
-000017d0: 7374 7269 6465 733a 2069 6e74 2c20 7475  strides: int, tu
-000017e0: 706c 652c 206f 7220 6c69 7374 0a20 2020  ple, or list.   
-000017f0: 2020 2020 2020 2020 2061 206c 6973 7420           a list 
-00001800: 6769 7669 6e67 2074 6865 2073 7472 6964  giving the strid
-00001810: 6520 6265 7477 6565 6e20 6170 706c 6963  e between applic
-00001820: 6174 696f 6e73 206f 6620 7468 6520 206b  ations of the  k
-00001830: 6572 6e65 6c20 666f 7220 6561 6368 206c  ernel for each l
-00001840: 6179 6572 2e0a 2020 2020 2020 2020 2020  ayer..          
-00001850: 2020 4561 6368 2065 6c65 6d65 6e74 206d    Each element m
-00001860: 6179 2062 6520 6569 7468 6572 2061 6e20  ay be either an 
-00001870: 696e 7420 2875 7365 2074 6865 2073 616d  int (use the sam
-00001880: 6520 7374 7269 6465 2066 6f72 2065 7665  e stride for eve
-00001890: 7279 2064 696d 656e 7369 6f6e 290a 2020  ry dimension).  
-000018a0: 2020 2020 2020 2020 2020 6f72 2061 2074            or a t
-000018b0: 7570 6c65 2028 7468 6520 7374 7269 6465  uple (the stride
-000018c0: 2061 6c6f 6e67 2065 6163 6820 6469 6d65   along each dime
-000018d0: 6e73 696f 6e29 2e20 2041 6c74 6572 6e61  nsion).  Alterna
-000018e0: 7469 7665 6c79 2074 6869 7320 6d61 7920  tively this may 
-000018f0: 6265 2061 0a20 2020 2020 2020 2020 2020  be a.           
-00001900: 2073 696e 676c 6520 696e 7420 6f72 2074   single int or t
-00001910: 7570 6c65 2069 6e73 7465 6164 206f 6620  uple instead of 
-00001920: 6120 6c69 7374 2c20 696e 2077 6869 6368  a list, in which
-00001930: 2063 6173 6520 7468 6520 7361 6d65 2073   case the same s
-00001940: 7472 6964 6520 6973 0a20 2020 2020 2020  tride is.       
-00001950: 2020 2020 2075 7365 6420 666f 7220 6576       used for ev
-00001960: 6572 7920 6c61 7965 722e 0a20 2020 2020  ery layer..     
-00001970: 2020 2077 6569 6768 745f 696e 6974 5f73     weight_init_s
-00001980: 7464 6465 7673 3a20 6c69 7374 206f 7220  tddevs: list or 
-00001990: 666c 6f61 740a 2020 2020 2020 2020 2020  float.          
-000019a0: 2020 7468 6520 7374 616e 6461 7264 2064    the standard d
-000019b0: 6576 6961 7469 6f6e 206f 6620 7468 6520  eviation of the 
-000019c0: 6469 7374 7269 6275 7469 6f6e 2074 6f20  distribution to 
-000019d0: 7573 6520 666f 7220 7765 6967 6874 2069  use for weight i
-000019e0: 6e69 7469 616c 697a 6174 696f 6e0a 2020  nitialization.  
-000019f0: 2020 2020 2020 2020 2020 6f66 2065 6163            of eac
-00001a00: 6820 6c61 7965 722e 2020 5468 6520 6c65  h layer.  The le
-00001a10: 6e67 7468 206f 6620 7468 6973 206c 6973  ngth of this lis
-00001a20: 7420 7368 6f75 6c64 2065 7175 616c 206c  t should equal l
-00001a30: 656e 286c 6179 6572 5f66 696c 7465 7273  en(layer_filters
-00001a40: 292b 312c 0a20 2020 2020 2020 2020 2020  )+1,.           
-00001a50: 2077 6865 7265 2074 6865 2066 696e 616c   where the final
-00001a60: 2065 6c65 6d65 6e74 2063 6f72 7265 7370   element corresp
-00001a70: 6f6e 6473 2074 6f20 7468 6520 6465 6e73  onds to the dens
-00001a80: 6520 6c61 7965 722e 2020 416c 7465 726e  e layer.  Altern
-00001a90: 6174 6976 656c 7920 7468 6973 0a20 2020  atively this.   
-00001aa0: 2020 2020 2020 2020 206d 6179 2062 6520           may be 
-00001ab0: 6120 7369 6e67 6c65 2076 616c 7565 2069  a single value i
-00001ac0: 6e73 7465 6164 206f 6620 6120 6c69 7374  nstead of a list
-00001ad0: 2c20 696e 2077 6869 6368 2063 6173 6520  , in which case 
-00001ae0: 7468 6520 7361 6d65 2076 616c 7565 2069  the same value i
-00001af0: 7320 7573 6564 0a20 2020 2020 2020 2020  s used.         
-00001b00: 2020 2066 6f72 2065 7665 7279 206c 6179     for every lay
-00001b10: 6572 2e0a 2020 2020 2020 2020 6269 6173  er..        bias
-00001b20: 5f69 6e69 745f 636f 6e73 7473 3a20 6c69  _init_consts: li
-00001b30: 7374 206f 7220 666c 6f61 740a 2020 2020  st or float.    
-00001b40: 2020 2020 2020 2020 7468 6520 7661 6c75          the valu
-00001b50: 6520 746f 2069 6e69 7469 616c 697a 6520  e to initialize 
-00001b60: 7468 6520 6269 6173 6573 2069 6e20 6561  the biases in ea
-00001b70: 6368 206c 6179 6572 2074 6f2e 2020 5468  ch layer to.  Th
-00001b80: 6520 6c65 6e67 7468 206f 6620 7468 6973  e length of this
-00001b90: 0a20 2020 2020 2020 2020 2020 206c 6973  .            lis
-00001ba0: 7420 7368 6f75 6c64 2065 7175 616c 206c  t should equal l
-00001bb0: 656e 286c 6179 6572 5f66 696c 7465 7273  en(layer_filters
-00001bc0: 292b 312c 2077 6865 7265 2074 6865 2066  )+1, where the f
-00001bd0: 696e 616c 2065 6c65 6d65 6e74 2063 6f72  inal element cor
-00001be0: 7265 7370 6f6e 6473 0a20 2020 2020 2020  responds.       
-00001bf0: 2020 2020 2074 6f20 7468 6520 6465 6e73       to the dens
-00001c00: 6520 6c61 7965 722e 2020 416c 7465 726e  e layer.  Altern
-00001c10: 6174 6976 656c 7920 7468 6973 206d 6179  atively this may
-00001c20: 2062 6520 6120 7369 6e67 6c65 2076 616c   be a single val
-00001c30: 7565 2069 6e73 7465 6164 206f 6620 610a  ue instead of a.
-00001c40: 2020 2020 2020 2020 2020 2020 6c69 7374              list
-00001c50: 2c20 696e 2077 6869 6368 2063 6173 6520  , in which case 
-00001c60: 7468 6520 7361 6d65 2076 616c 7565 2069  the same value i
-00001c70: 7320 7573 6564 2066 6f72 2065 7665 7279  s used for every
-00001c80: 206c 6179 6572 2e0a 2020 2020 2020 2020   layer..        
-00001c90: 6472 6f70 6f75 7473 3a20 6c69 7374 206f  dropouts: list o
-00001ca0: 7220 666c 6f61 740a 2020 2020 2020 2020  r float.        
-00001cb0: 2020 2020 7468 6520 6472 6f70 6f75 7420      the dropout 
-00001cc0: 7072 6f62 6162 696c 6974 7920 746f 2075  probability to u
-00001cd0: 7365 2066 6f72 2065 6163 6820 6c61 7965  se for each laye
-00001ce0: 722e 2020 5468 6520 6c65 6e67 7468 206f  r.  The length o
-00001cf0: 6620 7468 6973 206c 6973 7420 7368 6f75  f this list shou
-00001d00: 6c64 2065 7175 616c 206c 656e 286c 6179  ld equal len(lay
-00001d10: 6572 5f66 696c 7465 7273 292e 0a20 2020  er_filters)..   
-00001d20: 2020 2020 2020 2020 2041 6c74 6572 6e61           Alterna
-00001d30: 7469 7665 6c79 2074 6869 7320 6d61 7920  tively this may 
-00001d40: 6265 2061 2073 696e 676c 6520 7661 6c75  be a single valu
-00001d50: 6520 696e 7374 6561 6420 6f66 2061 206c  e instead of a l
-00001d60: 6973 742c 2069 6e20 7768 6963 6820 6361  ist, in which ca
-00001d70: 7365 2074 6865 2073 616d 6520 7661 6c75  se the same valu
-00001d80: 6520 6973 2075 7365 6420 666f 7220 6576  e is used for ev
-00001d90: 6572 7920 6c61 7965 720a 2020 2020 2020  ery layer.      
-00001da0: 2020 6163 7469 7661 7469 6f6e 5f66 6e73    activation_fns
-00001db0: 3a20 7374 7220 6f72 206c 6973 740a 2020  : str or list.  
-00001dc0: 2020 2020 2020 2020 2020 7468 6520 746f            the to
-00001dd0: 7263 6820 6163 7469 7661 7469 6f6e 2066  rch activation f
-00001de0: 756e 6374 696f 6e20 746f 2061 7070 6c79  unction to apply
-00001df0: 2074 6f20 6561 6368 206c 6179 6572 2e20   to each layer. 
-00001e00: 5468 6520 6c65 6e67 7468 206f 6620 7468  The length of th
-00001e10: 6973 206c 6973 7420 7368 6f75 6c64 2065  is list should e
-00001e20: 7175 616c 0a20 2020 2020 2020 2020 2020  qual.           
-00001e30: 206c 656e 286c 6179 6572 5f66 696c 7465   len(layer_filte
-00001e40: 7273 292e 2020 416c 7465 726e 6174 6976  rs).  Alternativ
-00001e50: 656c 7920 7468 6973 206d 6179 2062 6520  ely this may be 
-00001e60: 6120 7369 6e67 6c65 2076 616c 7565 2069  a single value i
-00001e70: 6e73 7465 6164 206f 6620 6120 6c69 7374  nstead of a list
-00001e80: 2c20 696e 2077 6869 6368 2063 6173 6520  , in which case 
-00001e90: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
-00001ea0: 7361 6d65 2076 616c 7565 2069 7320 7573  same value is us
-00001eb0: 6564 2066 6f72 2065 7665 7279 206c 6179  ed for every lay
-00001ec0: 6572 2c20 2772 656c 7527 2062 7920 6465  er, 'relu' by de
-00001ed0: 6661 756c 740a 2020 2020 2020 2020 706f  fault.        po
-00001ee0: 6f6c 5f74 7970 653a 2073 7472 0a20 2020  ol_type: str.   
-00001ef0: 2020 2020 2020 2020 2074 6865 2074 7970           the typ
-00001f00: 6520 6f66 2070 6f6f 6c69 6e67 206c 6179  e of pooling lay
-00001f10: 6572 2074 6f20 7573 652c 2065 6974 6865  er to use, eithe
-00001f20: 7220 276d 6178 2720 6f72 2027 6176 6572  r 'max' or 'aver
-00001f30: 6167 6527 0a20 2020 2020 2020 206d 6f64  age'.        mod
-00001f40: 653a 2073 7472 0a20 2020 2020 2020 2020  e: str.         
-00001f50: 2020 2045 6974 6865 7220 2763 6c61 7373     Either 'class
-00001f60: 6966 6963 6174 696f 6e27 206f 7220 2772  ification' or 'r
-00001f70: 6567 7265 7373 696f 6e27 0a20 2020 2020  egression'.     
-00001f80: 2020 206e 5f63 6c61 7373 6573 3a20 696e     n_classes: in
-00001f90: 740a 2020 2020 2020 2020 2020 2020 7468  t.            th
-00001fa0: 6520 6e75 6d62 6572 206f 6620 636c 6173  e number of clas
-00001fb0: 7365 7320 746f 2070 7265 6469 6374 2028  ses to predict (
-00001fc0: 6f6e 6c79 2075 7365 6420 696e 2063 6c61  only used in cla
-00001fd0: 7373 6966 6963 6174 696f 6e20 6d6f 6465  ssification mode
-00001fe0: 290a 2020 2020 2020 2020 756e 6365 7274  ).        uncert
-00001ff0: 6169 6e74 793a 2062 6f6f 6c0a 2020 2020  ainty: bool.    
-00002000: 2020 2020 2020 2020 6966 2054 7275 652c          if True,
-00002010: 2069 6e63 6c75 6465 2065 7874 7261 206f   include extra o
-00002020: 7574 7075 7473 2061 6e64 206c 6f73 7320  utputs and loss 
-00002030: 7465 726d 7320 746f 2065 6e61 626c 6520  terms to enable 
-00002040: 7468 6520 756e 6365 7274 6169 6e74 790a  the uncertainty.
-00002050: 2020 2020 2020 2020 2020 2020 696e 206f              in o
-00002060: 7574 7075 7473 2074 6f20 6265 2070 7265  utputs to be pre
-00002070: 6469 6374 6564 0a20 2020 2020 2020 2072  dicted.        r
-00002080: 6573 6964 7561 6c3a 2062 6f6f 6c0a 2020  esidual: bool.  
-00002090: 2020 2020 2020 2020 2020 6966 2054 7275            if Tru
-000020a0: 652c 2074 6865 206d 6f64 656c 2077 696c  e, the model wil
-000020b0: 6c20 6265 2063 6f6d 706f 7365 6420 6f66  l be composed of
-000020c0: 2070 7265 2d61 6374 6976 6174 696f 6e20   pre-activation 
-000020d0: 7265 7369 6475 616c 2062 6c6f 636b 7320  residual blocks 
-000020e0: 696e 7374 6561 640a 2020 2020 2020 2020  instead.        
-000020f0: 2020 2020 6f66 2061 2073 696d 706c 6520      of a simple 
-00002100: 7374 6163 6b20 6f66 2063 6f6e 766f 6c75  stack of convolu
-00002110: 7469 6f6e 616c 206c 6179 6572 732e 0a20  tional layers.. 
-00002120: 2020 2020 2020 2070 6164 6469 6e67 3a20         padding: 
-00002130: 7374 722c 2069 6e74 206f 7220 7475 706c  str, int or tupl
-00002140: 650a 2020 2020 2020 2020 2020 2020 7468  e.            th
-00002150: 6520 7061 6464 696e 6720 746f 2075 7365  e padding to use
-00002160: 2066 6f72 2063 6f6e 766f 6c75 7469 6f6e   for convolution
-00002170: 616c 206c 6179 6572 732c 2065 6974 6865  al layers, eithe
-00002180: 7220 2776 616c 6964 2720 6f72 2027 7361  r 'valid' or 'sa
-00002190: 6d65 270a 2020 2020 2020 2020 2222 220a  me'.        """.
-000021a0: 0a20 2020 2020 2020 2073 7570 6572 2843  .        super(C
-000021b0: 4e4e 4d6f 6475 6c65 2c20 7365 6c66 292e  NNModule, self).
-000021c0: 5f5f 696e 6974 5f5f 2829 0a0a 2020 2020  __init__()..    
-000021d0: 2020 2020 6966 2064 696d 7320 6e6f 7420      if dims not 
-000021e0: 696e 2028 312c 2032 2c20 3329 3a0a 2020  in (1, 2, 3):.  
-000021f0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00002200: 5661 6c75 6545 7272 6f72 2827 4e75 6d62  ValueError('Numb
-00002210: 6572 206f 6620 6469 6d65 6e73 696f 6e73  er of dimensions
-00002220: 206d 7573 7420 6265 2031 2c20 3220 6f72   must be 1, 2 or
-00002230: 2033 2729 0a0a 2020 2020 2020 2020 6966   3')..        if
-00002240: 206d 6f64 6520 6e6f 7420 696e 205b 2763   mode not in ['c
-00002250: 6c61 7373 6966 6963 6174 696f 6e27 2c20  lassification', 
-00002260: 2772 6567 7265 7373 696f 6e27 5d3a 0a20  'regression']:. 
-00002270: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00002280: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-00002290: 2020 2020 2020 2020 2020 2020 2022 6d6f               "mo
-000022a0: 6465 206d 7573 7420 6265 2065 6974 6865  de must be eithe
-000022b0: 7220 2763 6c61 7373 6966 6963 6174 696f  r 'classificatio
-000022c0: 6e27 206f 7220 2772 6567 7265 7373 696f  n' or 'regressio
-000022d0: 6e27 2229 0a0a 2020 2020 2020 2020 7365  n'")..        se
-000022e0: 6c66 2e6e 5f74 6173 6b73 203d 206e 5f74  lf.n_tasks = n_t
-000022f0: 6173 6b73 0a20 2020 2020 2020 2073 656c  asks.        sel
-00002300: 662e 6e5f 6665 6174 7572 6573 203d 206e  f.n_features = n
-00002310: 5f66 6561 7475 7265 730a 2020 2020 2020  _features.      
-00002320: 2020 7365 6c66 2e64 696d 7320 3d20 6469    self.dims = di
-00002330: 6d73 0a20 2020 2020 2020 2073 656c 662e  ms.        self.
-00002340: 6d6f 6465 203d 206d 6f64 650a 2020 2020  mode = mode.    
-00002350: 2020 2020 7365 6c66 2e6e 5f63 6c61 7373      self.n_class
-00002360: 6573 203d 206e 5f63 6c61 7373 6573 0a20  es = n_classes. 
-00002370: 2020 2020 2020 2073 656c 662e 756e 6365         self.unce
-00002380: 7274 6169 6e74 7920 3d20 756e 6365 7274  rtainty = uncert
-00002390: 6169 6e74 790a 2020 2020 2020 2020 7365  ainty.        se
-000023a0: 6c66 2e6d 6f64 6520 3d20 6d6f 6465 0a20  lf.mode = mode. 
-000023b0: 2020 2020 2020 2073 656c 662e 6c61 7965         self.laye
-000023c0: 725f 6669 6c74 6572 7320 3d20 6c61 7965  r_filters = laye
-000023d0: 725f 6669 6c74 6572 730a 2020 2020 2020  r_filters.      
-000023e0: 2020 7365 6c66 2e72 6573 6964 7561 6c20    self.residual 
-000023f0: 3d20 7265 7369 6475 616c 0a0a 2020 2020  = residual..    
-00002400: 2020 2020 6e5f 6c61 7965 7273 203d 206c      n_layers = l
-00002410: 656e 286c 6179 6572 5f66 696c 7465 7273  en(layer_filters
-00002420: 290a 0a20 2020 2020 2020 2023 2050 7954  )..        # PyT
-00002430: 6f72 6368 206c 6179 6572 7320 7265 7175  orch layers requ
-00002440: 6972 6520 696e 7075 7420 616e 6420 6f75  ire input and ou
-00002450: 7470 7574 2063 6861 6e6e 656c 7320 6173  tput channels as
-00002460: 2070 6172 616d 6574 6572 0a20 2020 2020   parameter.     
-00002470: 2020 2023 2069 6620 6f6e 6c79 206f 6e65     # if only one
-00002480: 206c 6179 6572 2074 6f20 6d61 6b65 2074   layer to make t
-00002490: 6865 206d 6f64 656c 2063 7265 6174 696e  he model creatin
-000024a0: 6720 6c6f 6f70 2062 656c 6f77 2077 6f72  g loop below wor
-000024b0: 6b2c 206d 756c 7469 706c 7920 6c61 7965  k, multiply laye
-000024c0: 725f 6669 6c74 6572 7320 7775 7467 2032  r_filters wutg 2
-000024d0: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-000024e0: 6c61 7965 725f 6669 6c74 6572 7329 203d  layer_filters) =
-000024f0: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
-00002500: 206c 6179 6572 5f66 696c 7465 7273 203d   layer_filters =
-00002510: 206c 6179 6572 5f66 696c 7465 7273 202a   layer_filters *
-00002520: 2032 0a0a 2020 2020 2020 2020 6966 206e   2..        if n
-00002530: 6f74 2069 7369 6e73 7461 6e63 6528 6b65  ot isinstance(ke
-00002540: 726e 656c 5f73 697a 652c 2053 6571 7565  rnel_size, Seque
-00002550: 6e63 6543 6f6c 6c65 6374 696f 6e29 3a0a  nceCollection):.
-00002560: 2020 2020 2020 2020 2020 2020 6b65 726e              kern
-00002570: 656c 5f73 697a 6520 3d20 5b6b 6572 6e65  el_size = [kerne
-00002580: 6c5f 7369 7a65 5d20 2a20 6e5f 6c61 7965  l_size] * n_laye
-00002590: 7273 0a20 2020 2020 2020 2069 6620 6e6f  rs.        if no
-000025a0: 7420 6973 696e 7374 616e 6365 2873 7472  t isinstance(str
-000025b0: 6964 6573 2c20 5365 7175 656e 6365 436f  ides, SequenceCo
-000025c0: 6c6c 6563 7469 6f6e 293a 0a20 2020 2020  llection):.     
-000025d0: 2020 2020 2020 2073 7472 6964 6573 203d         strides =
-000025e0: 205b 7374 7269 6465 735d 202a 206e 5f6c   [strides] * n_l
-000025f0: 6179 6572 730a 2020 2020 2020 2020 6966  ayers.        if
-00002600: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-00002610: 6472 6f70 6f75 7473 2c20 5365 7175 656e  dropouts, Sequen
-00002620: 6365 436f 6c6c 6563 7469 6f6e 293a 0a20  ceCollection):. 
-00002630: 2020 2020 2020 2020 2020 2064 726f 706f             dropo
-00002640: 7574 7320 3d20 5b64 726f 706f 7574 735d  uts = [dropouts]
-00002650: 202a 206e 5f6c 6179 6572 730a 2020 2020   * n_layers.    
-00002660: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00002670: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-00002680: 2020 2061 6374 6976 6174 696f 6e5f 666e     activation_fn
-00002690: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-000026a0: 2020 2073 7472 2920 6f72 206e 6f74 2069     str) or not i
-000026b0: 7369 6e73 7461 6e63 6528 6163 7469 7661  sinstance(activa
-000026c0: 7469 6f6e 5f66 6e73 2c20 5365 7175 656e  tion_fns, Sequen
-000026d0: 6365 436f 6c6c 6563 7469 6f6e 293a 0a20  ceCollection):. 
-000026e0: 2020 2020 2020 2020 2020 2061 6374 6976             activ
-000026f0: 6174 696f 6e5f 666e 7320 3d20 5b61 6374  ation_fns = [act
-00002700: 6976 6174 696f 6e5f 666e 735d 202a 206e  ivation_fns] * n
-00002710: 5f6c 6179 6572 730a 2020 2020 2020 2020  _layers.        
-00002720: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-00002730: 6528 7765 6967 6874 5f69 6e69 745f 7374  e(weight_init_st
-00002740: 6464 6576 732c 2053 6571 7565 6e63 6543  ddevs, SequenceC
-00002750: 6f6c 6c65 6374 696f 6e29 3a0a 2020 2020  ollection):.    
-00002760: 2020 2020 2020 2020 7765 6967 6874 5f69          weight_i
-00002770: 6e69 745f 7374 6464 6576 7320 3d20 5b77  nit_stddevs = [w
-00002780: 6569 6768 745f 696e 6974 5f73 7464 6465  eight_init_stdde
-00002790: 7673 5d20 2a20 6e5f 6c61 7965 7273 0a20  vs] * n_layers. 
-000027a0: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
-000027b0: 696e 7374 616e 6365 2862 6961 735f 696e  instance(bias_in
-000027c0: 6974 5f63 6f6e 7374 732c 2053 6571 7565  it_consts, Seque
-000027d0: 6e63 6543 6f6c 6c65 6374 696f 6e29 3a0a  nceCollection):.
-000027e0: 2020 2020 2020 2020 2020 2020 6269 6173              bias
-000027f0: 5f69 6e69 745f 636f 6e73 7473 203d 205b  _init_consts = [
-00002800: 6269 6173 5f69 6e69 745f 636f 6e73 7473  bias_init_consts
-00002810: 5d20 2a20 6e5f 6c61 7965 7273 0a0a 2020  ] * n_layers..  
-00002820: 2020 2020 2020 7365 6c66 2e61 6374 6976        self.activ
-00002830: 6174 696f 6e5f 666e 7320 3d20 5b67 6574  ation_fns = [get
-00002840: 5f61 6374 6976 6174 696f 6e28 6629 2066  _activation(f) f
-00002850: 6f72 2066 2069 6e20 6163 7469 7661 7469  or f in activati
-00002860: 6f6e 5f66 6e73 5d0a 2020 2020 2020 2020  on_fns].        
-00002870: 7365 6c66 2e64 726f 706f 7574 7320 3d20  self.dropouts = 
-00002880: 6472 6f70 6f75 7473 0a0a 2020 2020 2020  dropouts..      
-00002890: 2020 6966 2075 6e63 6572 7461 696e 7479    if uncertainty
-000028a0: 3a0a 0a20 2020 2020 2020 2020 2020 2069  :..            i
-000028b0: 6620 6d6f 6465 2021 3d20 2772 6567 7265  f mode != 'regre
-000028c0: 7373 696f 6e27 3a0a 2020 2020 2020 2020  ssion':.        
-000028d0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-000028e0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-000028f0: 2020 2020 2020 2020 2020 2020 2020 2255                "U
-00002900: 6e63 6572 7461 696e 7479 2069 7320 6f6e  ncertainty is on
-00002910: 6c79 2073 7570 706f 7274 6564 2069 6e20  ly supported in 
-00002920: 7265 6772 6573 7369 6f6e 206d 6f64 6522  regression mode"
-00002930: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00002940: 6620 616e 7928 6420 3d3d 2030 2e30 2066  f any(d == 0.0 f
-00002950: 6f72 2064 2069 6e20 6472 6f70 6f75 7473  or d in dropouts
-00002960: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00002970: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00002980: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-00002990: 2020 2020 2020 2020 2027 4472 6f70 6f75           'Dropou
-000029a0: 7420 6d75 7374 2062 6520 696e 636c 7564  t must be includ
-000029b0: 6564 2069 6e20 6576 6572 7920 6c61 7965  ed in every laye
-000029c0: 7220 746f 2070 7265 6469 6374 2075 6e63  r to predict unc
-000029d0: 6572 7461 696e 7479 270a 2020 2020 2020  ertainty'.      
-000029e0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-000029f0: 2020 2020 2023 2050 7974 686f 6e20 7475       # Python tu
-00002a00: 706c 6573 2075 7365 2030 2062 6173 6564  ples use 0 based
-00002a10: 2069 6e64 6578 696e 672c 2064 696d 7320   indexing, dims 
-00002a20: 6465 6669 6e65 7320 6e75 6d62 6572 206f  defines number o
-00002a30: 6620 6469 6d65 6e73 696f 6e20 666f 7220  f dimension for 
-00002a40: 636f 6e76 6f6c 7574 696f 6e61 6c20 6f70  convolutional op
-00002a50: 6572 6174 696f 6e0a 2020 2020 2020 2020  eration.        
-00002a60: 436f 6e76 4c61 7965 7220 3d20 286e 6e2e  ConvLayer = (nn.
-00002a70: 436f 6e76 3164 2c20 6e6e 2e43 6f6e 7632  Conv1d, nn.Conv2
-00002a80: 642c 206e 6e2e 436f 6e76 3364 295b 7365  d, nn.Conv3d)[se
-00002a90: 6c66 2e64 696d 7320 2d20 315d 0a0a 2020  lf.dims - 1]..  
-00002aa0: 2020 2020 2020 6966 2070 6f6f 6c5f 7479        if pool_ty
-00002ab0: 7065 203d 3d20 2761 7665 7261 6765 273a  pe == 'average':
-00002ac0: 0a20 2020 2020 2020 2020 2020 2050 6f6f  .            Poo
-00002ad0: 6c4c 6179 6572 203d 2028 462e 6176 675f  lLayer = (F.avg_
-00002ae0: 706f 6f6c 3164 2c20 462e 6176 675f 706f  pool1d, F.avg_po
-00002af0: 6f6c 3264 2c0a 2020 2020 2020 2020 2020  ol2d,.          
-00002b00: 2020 2020 2020 2020 2020 2020 2020 2046                 F
-00002b10: 2e61 7667 5f70 6f6f 6c33 6429 5b73 656c  .avg_pool3d)[sel
-00002b20: 662e 6469 6d73 202d 2031 5d0a 2020 2020  f.dims - 1].    
-00002b30: 2020 2020 656c 6966 2070 6f6f 6c5f 7479      elif pool_ty
-00002b40: 7065 203d 3d20 276d 6178 273a 0a20 2020  pe == 'max':.   
-00002b50: 2020 2020 2020 2020 2050 6f6f 6c4c 6179           PoolLay
-00002b60: 6572 203d 2028 462e 6d61 785f 706f 6f6c  er = (F.max_pool
-00002b70: 3164 2c20 462e 6d61 785f 706f 6f6c 3264  1d, F.max_pool2d
-00002b80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00002b90: 2020 2020 2020 2020 2020 2046 2e6d 6178             F.max
-00002ba0: 5f70 6f6f 6c33 6429 5b73 656c 662e 6469  _pool3d)[self.di
-00002bb0: 6d73 202d 2031 5d0a 2020 2020 2020 2020  ms - 1].        
-00002bc0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00002bd0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00002be0: 6f72 2822 706f 6f6c 5f74 7970 6520 6d75  or("pool_type mu
-00002bf0: 7374 2062 6520 6569 7468 6572 2027 6176  st be either 'av
-00002c00: 6572 6167 6527 206f 7220 276d 6178 2722  erage' or 'max'"
-00002c10: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00002c20: 506f 6f6c 4c61 7965 7220 3d20 506f 6f6c  PoolLayer = Pool
-00002c30: 4c61 7965 720a 2020 2020 2020 2020 7365  Layer.        se
-00002c40: 6c66 2e6c 6179 6572 7320 3d20 6e6e 2e4d  lf.layers = nn.M
-00002c50: 6f64 756c 654c 6973 7428 290a 0a20 2020  oduleList()..   
-00002c60: 2020 2020 2069 6e5f 7368 6170 6520 3d20       in_shape = 
-00002c70: 6e5f 6665 6174 7572 6573 0a0a 2020 2020  n_features..    
-00002c80: 2020 2020 666f 7220 6f75 745f 7368 6170      for out_shap
-00002c90: 652c 2073 697a 652c 2073 7472 6964 652c  e, size, stride,
-00002ca0: 2077 6569 6768 745f 7374 6464 6576 2c20   weight_stddev, 
-00002cb0: 6269 6173 5f63 6f6e 7374 2069 6e20 7a69  bias_const in zi
-00002cc0: 7028 0a20 2020 2020 2020 2020 2020 2020  p(.             
-00002cd0: 2020 206c 6179 6572 5f66 696c 7465 7273     layer_filters
-00002ce0: 2c20 6b65 726e 656c 5f73 697a 652c 2073  , kernel_size, s
-00002cf0: 7472 6964 6573 2c20 7765 6967 6874 5f69  trides, weight_i
-00002d00: 6e69 745f 7374 6464 6576 732c 0a20 2020  nit_stddevs,.   
-00002d10: 2020 2020 2020 2020 2020 2020 2062 6961               bia
-00002d20: 735f 696e 6974 5f63 6f6e 7374 7329 3a0a  s_init_consts):.
-00002d30: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
-00002d40: 6572 203d 2043 6f6e 764c 6179 6572 2869  er = ConvLayer(i
-00002d50: 6e5f 6368 616e 6e65 6c73 3d69 6e5f 7368  n_channels=in_sh
-00002d60: 6170 652c 0a20 2020 2020 2020 2020 2020  ape,.           
-00002d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002d80: 2020 206f 7574 5f63 6861 6e6e 656c 733d     out_channels=
-00002d90: 6f75 745f 7368 6170 652c 0a20 2020 2020  out_shape,.     
-00002da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002db0: 2020 2020 2020 2020 206b 6572 6e65 6c5f           kernel_
-00002dc0: 7369 7a65 3d73 697a 652c 0a20 2020 2020  size=size,.     
-00002dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002de0: 2020 2020 2020 2020 2073 7472 6964 653d           stride=
-00002df0: 7374 7269 6465 2c0a 2020 2020 2020 2020  stride,.        
-00002e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002e10: 2020 2020 2020 7061 6464 696e 673d 7061        padding=pa
-00002e20: 6464 696e 672c 0a20 2020 2020 2020 2020  dding,.         
-00002e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002e40: 2020 2020 2064 696c 6174 696f 6e3d 312c       dilation=1,
-00002e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002e60: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-00002e70: 726f 7570 733d 312c 0a20 2020 2020 2020  roups=1,.       
-00002e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002e90: 2020 2020 2020 2062 6961 733d 5472 7565         bias=True
-00002ea0: 290a 0a20 2020 2020 2020 2020 2020 206e  )..            n
-00002eb0: 6e2e 696e 6974 2e6e 6f72 6d61 6c5f 286c  n.init.normal_(l
-00002ec0: 6179 6572 2e77 6569 6768 742c 2030 2c20  ayer.weight, 0, 
-00002ed0: 7765 6967 6874 5f73 7464 6465 7629 0a0a  weight_stddev)..
-00002ee0: 2020 2020 2020 2020 2020 2020 2320 696e              # in
-00002ef0: 6974 6961 6c69 7a69 6e67 206c 6179 6572  itializing layer
-00002f00: 2062 6961 7320 7769 7468 206e 6e2e 696e   bias with nn.in
-00002f10: 6974 2067 6976 6573 206d 7970 7920 7479  it gives mypy ty
-00002f20: 7065 6368 6563 6b20 6572 726f 720a 2020  pecheck error.  
-00002f30: 2020 2020 2020 2020 2020 2320 7573 696e            # usin
-00002f40: 6720 7468 6520 666f 6c6c 6f77 696e 6720  g the following 
-00002f50: 776f 726b 6172 6f75 6e64 0a20 2020 2020  workaround.     
-00002f60: 2020 2020 2020 2069 6620 6c61 7965 722e         if layer.
-00002f70: 6269 6173 2069 7320 6e6f 7420 4e6f 6e65  bias is not None
-00002f80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00002f90: 2020 6c61 7965 722e 6269 6173 203d 206e    layer.bias = n
-00002fa0: 6e2e 5061 7261 6d65 7465 7228 0a20 2020  n.Parameter(.   
-00002fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002fc0: 2074 6f72 6368 2e66 756c 6c28 6c61 7965   torch.full(laye
-00002fd0: 722e 6269 6173 2e73 6861 7065 2c20 6269  r.bias.shape, bi
-00002fe0: 6173 5f63 6f6e 7374 2929 0a0a 2020 2020  as_const))..    
-00002ff0: 2020 2020 2020 2020 7365 6c66 2e6c 6179          self.lay
-00003000: 6572 732e 6170 7065 6e64 286c 6179 6572  ers.append(layer
-00003010: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00003020: 6e5f 7368 6170 6520 3d20 6f75 745f 7368  n_shape = out_sh
-00003030: 6170 650a 0a20 2020 2020 2020 2073 656c  ape..        sel
-00003040: 662e 636c 6173 7369 6669 6572 5f66 666e  f.classifier_ffn
-00003050: 203d 206e 6e2e 4c61 7a79 4c69 6e65 6172   = nn.LazyLinear
-00003060: 2873 656c 662e 6e5f 7461 736b 7320 2a20  (self.n_tasks * 
-00003070: 7365 6c66 2e6e 5f63 6c61 7373 6573 290a  self.n_classes).
-00003080: 2020 2020 2020 2020 7365 6c66 2e6f 7574          self.out
-00003090: 7075 745f 6c61 7965 7220 3d20 6e6e 2e4c  put_layer = nn.L
-000030a0: 617a 794c 696e 6561 7228 7365 6c66 2e6e  azyLinear(self.n
-000030b0: 5f74 6173 6b73 290a 2020 2020 2020 2020  _tasks).        
-000030c0: 7365 6c66 2e75 6e63 6572 7461 696e 7479  self.uncertainty
-000030d0: 5f6c 6179 6572 203d 206e 6e2e 4c61 7a79  _layer = nn.Lazy
-000030e0: 4c69 6e65 6172 2873 656c 662e 6e5f 7461  Linear(self.n_ta
-000030f0: 736b 7329 0a0a 2020 2020 6465 6620 666f  sks)..    def fo
-00003100: 7277 6172 6428 7365 6c66 2c20 696e 7075  rward(self, inpu
-00003110: 7473 3a20 4f6e 654f 724d 616e 795b 746f  ts: OneOrMany[to
-00003120: 7263 682e 5465 6e73 6f72 5d29 202d 3e20  rch.Tensor]) -> 
-00003130: 4c69 7374 5b41 6e79 5d3a 0a20 2020 2020  List[Any]:.     
-00003140: 2020 2022 2222 0a20 2020 2020 2020 2050     """.        P
-00003150: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
-00003160: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-00003170: 2020 2020 2078 3a20 746f 7263 682e 5465       x: torch.Te
-00003180: 6e73 6f72 0a20 2020 2020 2020 2020 2020  nsor.           
-00003190: 2049 6e70 7574 2054 656e 736f 720a 2020   Input Tensor.  
-000031a0: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
-000031b0: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
-000031c0: 2020 2020 2020 746f 7263 682e 5465 6e73        torch.Tens
-000031d0: 6f72 0a20 2020 2020 2020 2020 2020 204f  or.            O
-000031e0: 7574 7075 7420 6173 2070 6572 2075 7365  utput as per use
-000031f0: 2063 6173 6520 3a20 7265 6772 6573 7369   case : regressi
-00003200: 6f6e 2f63 6c61 7373 6966 6963 6174 696f  on/classificatio
-00003210: 6e0a 2020 2020 2020 2020 2222 220a 2020  n.        """.  
-00003220: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00003230: 6e63 6528 696e 7075 7473 2c20 746f 7263  nce(inputs, torc
-00003240: 682e 5465 6e73 6f72 293a 0a20 2020 2020  h.Tensor):.     
-00003250: 2020 2020 2020 2078 2c20 6472 6f70 6f75         x, dropou
-00003260: 745f 7377 6974 6368 203d 2069 6e70 7574  t_switch = input
-00003270: 732c 204e 6f6e 650a 2020 2020 2020 2020  s, None.        
-00003280: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00003290: 2020 782c 2064 726f 706f 7574 5f73 7769    x, dropout_swi
-000032a0: 7463 6820 3d20 696e 7075 7473 0a0a 2020  tch = inputs..  
-000032b0: 2020 2020 2020 7820 3d20 746f 7263 682e        x = torch.
-000032c0: 7472 616e 7370 6f73 6528 782c 2031 2c20  transpose(x, 1, 
-000032d0: 2d31 2920 2023 206e 2068 2077 2063 202d  -1)  # n h w c -
-000032e0: 3e20 6e20 6320 6820 770a 0a20 2020 2020  > n c h w..     
-000032f0: 2020 2070 7265 765f 6c61 7965 7220 3d20     prev_layer = 
-00003300: 780a 0a20 2020 2020 2020 2066 6f72 206c  x..        for l
-00003310: 6179 6572 2c20 6163 7469 7661 7469 6f6e  ayer, activation
-00003320: 5f66 6e2c 2064 726f 706f 7574 2069 6e20  _fn, dropout in 
-00003330: 7a69 7028 7365 6c66 2e6c 6179 6572 732c  zip(self.layers,
-00003340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003370: 2020 7365 6c66 2e61 6374 6976 6174 696f    self.activatio
-00003380: 6e5f 666e 732c 0a20 2020 2020 2020 2020  n_fns,.         
-00003390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000033a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000033b0: 2020 2020 2020 2020 7365 6c66 2e64 726f          self.dro
-000033c0: 706f 7574 7329 3a0a 2020 2020 2020 2020  pouts):.        
-000033d0: 2020 2020 7820 3d20 6c61 7965 7228 7829      x = layer(x)
-000033e0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-000033f0: 2064 726f 706f 7574 203e 2030 2e20 616e   dropout > 0. an
-00003400: 6420 6472 6f70 6f75 745f 7377 6974 6368  d dropout_switch
-00003410: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00003420: 2020 7820 3d20 462e 6472 6f70 6f75 7428    x = F.dropout(
-00003430: 782c 2064 726f 706f 7574 290a 0a20 2020  x, dropout)..   
-00003440: 2020 2020 2020 2020 2023 2072 6573 6964           # resid
-00003450: 7561 6c20 626c 6f63 6b73 2063 616e 206f  ual blocks can o
-00003460: 6e6c 7920 6265 2075 7365 6420 7768 656e  nly be used when
-00003470: 2073 7563 6365 7373 6976 6520 6c61 7965   successive laye
-00003480: 7273 2068 6176 6520 7468 6520 7361 6d65  rs have the same
-00003490: 206f 7574 7075 7420 7368 6170 650a 2020   output shape.  
-000034a0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-000034b0: 662e 7265 7369 6475 616c 2061 6e64 2078  f.residual and x
-000034c0: 2e73 6861 7065 5b31 5d20 3d3d 2070 7265  .shape[1] == pre
-000034d0: 765f 6c61 7965 722e 7368 6170 655b 315d  v_layer.shape[1]
-000034e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000034f0: 2020 7820 3d20 7820 2b20 7072 6576 5f6c    x = x + prev_l
-00003500: 6179 6572 0a0a 2020 2020 2020 2020 2020  ayer..          
-00003510: 2020 6966 2061 6374 6976 6174 696f 6e5f    if activation_
-00003520: 666e 2069 7320 6e6f 7420 4e6f 6e65 3a0a  fn is not None:.
+000004c0: 2020 2020 6261 7463 685f 6e6f 726d 3a20      batch_norm: 
+000004d0: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
+000004e0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+000004f0: 6174 6368 5f6e 6f72 6d5f 6d6f 6d65 6e74  atch_norm_moment
+00000500: 756d 3a20 666c 6f61 7420 3d20 302e 312c  um: float = 0.1,
+00000510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000520: 2020 6163 7469 7661 7469 6f6e 5f66 6e3a    activation_fn:
+00000530: 2055 6e69 6f6e 5b43 616c 6c61 626c 652c   Union[Callable,
+00000540: 2073 7472 5d20 3d20 2772 656c 7527 2c0a   str] = 'relu',.
+00000550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000560: 2073 6b69 705f 636f 6e6e 6563 7469 6f6e   skip_connection
+00000570: 3a20 626f 6f6c 203d 2046 616c 7365 293a  : bool = False):
+00000580: 0a20 2020 2020 2020 2022 2222 496e 6974  .        """Init
+00000590: 6961 6c69 7a65 2074 6865 206d 6f64 656c  ialize the model
+000005a0: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+000005b0: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+000005c0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+000005d0: 2064 5f69 6e70 7574 3a20 696e 740a 2020   d_input: int.  
+000005e0: 2020 2020 2020 2020 2020 7468 6520 6469            the di
+000005f0: 6d65 6e73 696f 6e20 6f66 2074 6865 2069  mension of the i
+00000600: 6e70 7574 206c 6179 6572 0a20 2020 2020  nput layer.     
+00000610: 2020 2064 5f6f 7574 7075 743a 2069 6e74     d_output: int
+00000620: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+00000630: 2064 696d 656e 7369 6f6e 206f 6620 7468   dimension of th
+00000640: 6520 6f75 7470 7574 206c 6179 6572 0a20  e output layer. 
+00000650: 2020 2020 2020 2064 5f68 6964 6465 6e3a         d_hidden:
+00000660: 2074 7570 6c65 0a20 2020 2020 2020 2020   tuple.         
+00000670: 2020 2074 6865 2064 696d 656e 7369 6f6e     the dimension
+00000680: 7320 6f66 2074 6865 2068 6964 6465 6e20  s of the hidden 
+00000690: 6c61 7965 7273 0a20 2020 2020 2020 2064  layers.        d
+000006a0: 726f 706f 7574 3a20 666c 6f61 740a 2020  ropout: float.  
+000006b0: 2020 2020 2020 2020 2020 7468 6520 6472            the dr
+000006c0: 6f70 6f75 7420 7072 6f62 6162 696c 6974  opout probabilit
+000006d0: 790a 2020 2020 2020 2020 6261 7463 685f  y.        batch_
+000006e0: 6e6f 726d 3a20 626f 6f6c 0a20 2020 2020  norm: bool.     
+000006f0: 2020 2020 2020 2077 6865 7468 6572 2074         whether t
+00000700: 6f20 7573 6520 6261 7463 6820 6e6f 726d  o use batch norm
+00000710: 616c 697a 6174 696f 6e0a 2020 2020 2020  alization.      
+00000720: 2020 6261 7463 685f 6e6f 726d 5f6d 6f6d    batch_norm_mom
+00000730: 656e 7475 6d3a 2066 6c6f 6174 0a20 2020  entum: float.   
+00000740: 2020 2020 2020 2020 2074 6865 206d 6f6d           the mom
+00000750: 656e 7475 6d20 666f 7220 6261 7463 6820  entum for batch 
+00000760: 6e6f 726d 616c 697a 6174 696f 6e0a 2020  normalization.  
+00000770: 2020 2020 2020 6163 7469 7661 7469 6f6e        activation
+00000780: 5f66 6e3a 2073 7472 0a20 2020 2020 2020  _fn: str.       
+00000790: 2020 2020 2074 6865 2061 6374 6976 6174       the activat
+000007a0: 696f 6e20 6675 6e63 7469 6f6e 2074 6f20  ion function to 
+000007b0: 7573 6520 696e 2074 6865 2068 6964 6465  use in the hidde
+000007c0: 6e20 6c61 7965 7273 0a20 2020 2020 2020  n layers.       
+000007d0: 2073 6b69 705f 636f 6e6e 6563 7469 6f6e   skip_connection
+000007e0: 3a20 626f 6f6c 0a20 2020 2020 2020 2020  : bool.         
+000007f0: 2020 2077 6865 7468 6572 2074 6f20 6164     whether to ad
+00000800: 6420 6120 736b 6970 2063 6f6e 6e65 6374  d a skip connect
+00000810: 696f 6e20 6672 6f6d 2074 6865 2069 6e70  ion from the inp
+00000820: 7574 2074 6f20 7468 6520 6f75 7470 7574  ut to the output
+00000830: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00000840: 2020 2020 2073 7570 6572 284d 756c 7469       super(Multi
+00000850: 6c61 7965 7250 6572 6365 7074 726f 6e2c  layerPerceptron,
+00000860: 2073 656c 6629 2e5f 5f69 6e69 745f 5f28   self).__init__(
+00000870: 290a 2020 2020 2020 2020 7365 6c66 2e64  ).        self.d
+00000880: 5f69 6e70 7574 203d 2064 5f69 6e70 7574  _input = d_input
+00000890: 0a20 2020 2020 2020 2073 656c 662e 645f  .        self.d_
+000008a0: 6869 6464 656e 203d 2064 5f68 6964 6465  hidden = d_hidde
+000008b0: 6e0a 2020 2020 2020 2020 7365 6c66 2e64  n.        self.d
+000008c0: 5f6f 7574 7075 7420 3d20 645f 6f75 7470  _output = d_outp
+000008d0: 7574 0a20 2020 2020 2020 2073 656c 662e  ut.        self.
+000008e0: 6472 6f70 6f75 7420 3d20 6e6e 2e44 726f  dropout = nn.Dro
+000008f0: 706f 7574 2864 726f 706f 7574 290a 2020  pout(dropout).  
+00000900: 2020 2020 2020 7365 6c66 2e62 6174 6368        self.batch
+00000910: 5f6e 6f72 6d20 3d20 6261 7463 685f 6e6f  _norm = batch_no
+00000920: 726d 0a20 2020 2020 2020 2073 656c 662e  rm.        self.
+00000930: 6261 7463 685f 6e6f 726d 5f6d 6f6d 656e  batch_norm_momen
+00000940: 7475 6d20 3d20 6261 7463 685f 6e6f 726d  tum = batch_norm
+00000950: 5f6d 6f6d 656e 7475 6d0a 2020 2020 2020  _momentum.      
+00000960: 2020 7365 6c66 2e61 6374 6976 6174 696f    self.activatio
+00000970: 6e5f 666e 203d 2067 6574 5f61 6374 6976  n_fn = get_activ
+00000980: 6174 696f 6e28 6163 7469 7661 7469 6f6e  ation(activation
+00000990: 5f66 6e29 0a20 2020 2020 2020 2073 656c  _fn).        sel
+000009a0: 662e 6d6f 6465 6c20 3d20 6e6e 2e53 6571  f.model = nn.Seq
+000009b0: 7565 6e74 6961 6c28 2a73 656c 662e 6275  uential(*self.bu
+000009c0: 696c 645f 6c61 7965 7273 2829 290a 2020  ild_layers()).  
+000009d0: 2020 2020 2020 7365 6c66 2e73 6b69 7020        self.skip 
+000009e0: 3d20 6e6e 2e4c 696e 6561 7228 645f 696e  = nn.Linear(d_in
+000009f0: 7075 742c 2064 5f6f 7574 7075 7429 2069  put, d_output) i
+00000a00: 6620 736b 6970 5f63 6f6e 6e65 6374 696f  f skip_connectio
+00000a10: 6e20 656c 7365 204e 6f6e 650a 0a20 2020  n else None..   
+00000a20: 2064 6566 2062 7569 6c64 5f6c 6179 6572   def build_layer
+00000a30: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+00000a40: 2022 2222 0a20 2020 2020 2020 2042 7569   """.        Bui
+00000a50: 6c64 2074 6865 206c 6179 6572 7320 6f66  ld the layers of
+00000a60: 2074 6865 206d 6f64 656c 2c20 6974 6572   the model, iter
+00000a70: 6174 696e 6720 7468 726f 7567 6820 7468  ating through th
+00000a80: 6520 6869 6464 656e 2064 696d 656e 7369  e hidden dimensi
+00000a90: 6f6e 7320 746f 2070 726f 6475 6365 2061  ons to produce a
+00000aa0: 206c 6973 7420 6f66 206c 6179 6572 732e   list of layers.
+00000ab0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+00000ac0: 2020 2020 2020 6c61 7965 725f 6c69 7374        layer_list
+00000ad0: 203d 205b 5d0a 2020 2020 2020 2020 6c61   = [].        la
+00000ae0: 7965 725f 6469 6d20 3d20 7365 6c66 2e64  yer_dim = self.d
+00000af0: 5f69 6e70 7574 0a20 2020 2020 2020 2069  _input.        i
+00000b00: 6620 7365 6c66 2e64 5f68 6964 6465 6e20  f self.d_hidden 
+00000b10: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00000b20: 2020 2020 2020 2020 2066 6f72 2064 2069           for d i
+00000b30: 6e20 7365 6c66 2e64 5f68 6964 6465 6e3a  n self.d_hidden:
+00000b40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000b50: 206c 6179 6572 5f6c 6973 742e 6170 7065   layer_list.appe
+00000b60: 6e64 286e 6e2e 4c69 6e65 6172 286c 6179  nd(nn.Linear(lay
+00000b70: 6572 5f64 696d 2c20 6429 290a 2020 2020  er_dim, d)).    
+00000b80: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+00000b90: 725f 6c69 7374 2e61 7070 656e 6428 7365  r_list.append(se
+00000ba0: 6c66 2e64 726f 706f 7574 290a 2020 2020  lf.dropout).    
+00000bb0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00000bc0: 656c 662e 6261 7463 685f 6e6f 726d 3a0a  elf.batch_norm:.
+00000bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000be0: 2020 2020 6c61 7965 725f 6c69 7374 2e61      layer_list.a
+00000bf0: 7070 656e 6428 0a20 2020 2020 2020 2020  ppend(.         
+00000c00: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00000c10: 6e2e 4261 7463 684e 6f72 6d31 6428 642c  n.BatchNorm1d(d,
+00000c20: 206d 6f6d 656e 7475 6d3d 7365 6c66 2e62   momentum=self.b
+00000c30: 6174 6368 5f6e 6f72 6d5f 6d6f 6d65 6e74  atch_norm_moment
+00000c40: 756d 2929 0a20 2020 2020 2020 2020 2020  um)).           
+00000c50: 2020 2020 206c 6179 6572 5f64 696d 203d       layer_dim =
+00000c60: 2064 0a20 2020 2020 2020 206c 6179 6572   d.        layer
+00000c70: 5f6c 6973 742e 6170 7065 6e64 286e 6e2e  _list.append(nn.
+00000c80: 4c69 6e65 6172 286c 6179 6572 5f64 696d  Linear(layer_dim
+00000c90: 2c20 7365 6c66 2e64 5f6f 7574 7075 7429  , self.d_output)
+00000ca0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00000cb0: 206c 6179 6572 5f6c 6973 740a 0a20 2020   layer_list..   
+00000cc0: 2064 6566 2066 6f72 7761 7264 2873 656c   def forward(sel
+00000cd0: 662c 2078 3a20 5465 6e73 6f72 2920 2d3e  f, x: Tensor) ->
+00000ce0: 2054 656e 736f 723a 0a20 2020 2020 2020   Tensor:.       
+00000cf0: 2022 2222 466f 7277 6172 6420 7061 7373   """Forward pass
+00000d00: 206f 6620 7468 6520 6d6f 6465 6c2e 2222   of the model.""
+00000d10: 220a 2020 2020 2020 2020 696e 7075 7420  ".        input 
+00000d20: 3d20 780a 2020 2020 2020 2020 666f 7220  = x.        for 
+00000d30: 6c61 7965 7220 696e 2073 656c 662e 6d6f  layer in self.mo
+00000d40: 6465 6c3a 0a20 2020 2020 2020 2020 2020  del:.           
+00000d50: 2078 203d 206c 6179 6572 2878 290a 2020   x = layer(x).  
+00000d60: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+00000d70: 6e73 7461 6e63 6528 6c61 7965 722c 206e  nstance(layer, n
+00000d80: 6e2e 4c69 6e65 6172 293a 0a20 2020 2020  n.Linear):.     
+00000d90: 2020 2020 2020 2020 2020 2078 203d 2073             x = s
+00000da0: 656c 662e 6163 7469 7661 7469 6f6e 5f66  elf.activation_f
+00000db0: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+00000dc0: 2020 2020 2020 2078 0a20 2020 2020 2020         x.       
+00000dd0: 2020 2020 2020 2020 2029 2020 2320 446f           )  # Do
+00000de0: 6e65 2062 6563 6175 7365 2061 6374 6976  ne because activ
+00000df0: 6174 696f 6e5f 666e 2072 6574 7572 6e73  ation_fn returns
+00000e00: 2061 2074 6f72 6368 2e6e 6e2e 6675 6e63   a torch.nn.func
+00000e10: 7469 6f6e 616c 0a20 2020 2020 2020 2069  tional.        i
+00000e20: 6620 7365 6c66 2e73 6b69 7020 6973 206e  f self.skip is n
+00000e30: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00000e40: 2020 2020 2072 6574 7572 6e20 7820 2b20       return x + 
+00000e50: 7365 6c66 2e73 6b69 7028 696e 7075 7429  self.skip(input)
+00000e60: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00000e70: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00000e80: 6e20 780a 0a0a 636c 6173 7320 434e 4e4d  n x...class CNNM
+00000e90: 6f64 756c 6528 6e6e 2e4d 6f64 756c 6529  odule(nn.Module)
+00000ea0: 3a0a 2020 2020 2222 2241 2031 2c20 322c  :.    """A 1, 2,
+00000eb0: 206f 7220 3320 6469 6d65 6e73 696f 6e61   or 3 dimensiona
+00000ec0: 6c20 636f 6e76 6f6c 7574 696f 6e61 6c20  l convolutional 
+00000ed0: 6e65 7477 6f72 6b20 666f 7220 6569 7468  network for eith
+00000ee0: 6572 2072 6567 7265 7373 696f 6e20 6f72  er regression or
+00000ef0: 2063 6c61 7373 6966 6963 6174 696f 6e2e   classification.
+00000f00: 0a20 2020 2054 6865 206e 6574 776f 726b  .    The network
+00000f10: 2063 6f6e 7369 7374 7320 6f66 2074 6865   consists of the
+00000f20: 2066 6f6c 6c6f 7769 6e67 2073 6571 7565   following seque
+00000f30: 6e63 6520 6f66 206c 6179 6572 733a 0a20  nce of layers:. 
+00000f40: 2020 202d 2041 2063 6f6e 6669 6775 7261     - A configura
+00000f50: 626c 6520 6e75 6d62 6572 206f 6620 636f  ble number of co
+00000f60: 6e76 6f6c 7574 696f 6e61 6c20 6c61 7965  nvolutional laye
+00000f70: 7273 0a20 2020 202d 2041 2067 6c6f 6261  rs.    - A globa
+00000f80: 6c20 706f 6f6c 696e 6720 6c61 7965 7220  l pooling layer 
+00000f90: 2865 6974 6865 7220 6d61 7820 706f 6f6c  (either max pool
+00000fa0: 206f 7220 6176 6572 6167 6520 706f 6f6c   or average pool
+00000fb0: 290a 2020 2020 2d20 4120 6669 6e61 6c20  ).    - A final 
+00000fc0: 6675 6c6c 7920 636f 6e6e 6563 7465 6420  fully connected 
+00000fd0: 6c61 7965 7220 746f 2063 6f6d 7075 7465  layer to compute
+00000fe0: 2074 6865 206f 7574 7075 740a 2020 2020   the output.    
+00000ff0: 4974 206f 7074 696f 6e61 6c6c 7920 6361  It optionally ca
+00001000: 6e20 636f 6d70 6f73 6520 7468 6520 6d6f  n compose the mo
+00001010: 6465 6c20 6672 6f6d 2070 7265 2d61 6374  del from pre-act
+00001020: 6976 6174 696f 6e20 7265 7369 6475 616c  ivation residual
+00001030: 2062 6c6f 636b 732c 2061 730a 2020 2020   blocks, as.    
+00001040: 6465 7363 7269 6265 6420 696e 2068 7474  described in htt
+00001050: 7073 3a2f 2f61 7278 6976 2e6f 7267 2f61  ps://arxiv.org/a
+00001060: 6273 2f31 3630 332e 3035 3032 372c 2072  bs/1603.05027, r
+00001070: 6174 6865 7220 7468 616e 2061 2073 696d  ather than a sim
+00001080: 706c 6520 7374 6163 6b20 6f66 0a20 2020  ple stack of.   
+00001090: 2063 6f6e 766f 6c75 7469 6f6e 206c 6179   convolution lay
+000010a0: 6572 732e 2020 5468 6973 206f 6674 656e  ers.  This often
+000010b0: 206c 6561 6473 2074 6f20 6561 7369 6572   leads to easier
+000010c0: 2074 7261 696e 696e 672c 2065 7370 6563   training, espec
+000010d0: 6961 6c6c 7920 7768 656e 2075 7369 6e67  ially when using
+000010e0: 2061 0a20 2020 206c 6172 6765 206e 756d   a.    large num
+000010f0: 6265 7220 6f66 206c 6179 6572 732e 2020  ber of layers.  
+00001100: 4e6f 7465 2074 6861 7420 7265 7369 6475  Note that residu
+00001110: 616c 2062 6c6f 636b 7320 6361 6e20 6f6e  al blocks can on
+00001120: 6c79 2062 6520 7573 6564 2077 6865 6e0a  ly be used when.
+00001130: 2020 2020 7375 6363 6573 7369 7665 206c      successive l
+00001140: 6179 6572 7320 6861 7665 2074 6865 2073  ayers have the s
+00001150: 616d 6520 6f75 7470 7574 2073 6861 7065  ame output shape
+00001160: 2e20 2057 6865 7265 7665 7220 7468 6520  .  Wherever the 
+00001170: 6f75 7470 7574 2073 6861 7065 2063 6861  output shape cha
+00001180: 6e67 6573 2c20 610a 2020 2020 7369 6d70  nges, a.    simp
+00001190: 6c65 2063 6f6e 766f 6c75 7469 6f6e 206c  le convolution l
+000011a0: 6179 6572 2077 696c 6c20 6265 2075 7365  ayer will be use
+000011b0: 6420 6576 656e 2069 6620 7265 7369 6475  d even if residu
+000011c0: 616c 3d54 7275 652e 0a20 2020 2045 7861  al=True..    Exa
+000011d0: 6d70 6c65 730a 2020 2020 2d2d 2d2d 2d2d  mples.    ------
+000011e0: 2d2d 0a20 2020 203e 3e3e 206d 6f64 656c  --.    >>> model
+000011f0: 203d 2043 4e4e 4d6f 6475 6c65 286e 5f74   = CNNModule(n_t
+00001200: 6173 6b73 3d35 2c20 6e5f 6665 6174 7572  asks=5, n_featur
+00001210: 6573 3d38 2c20 6469 6d73 3d32 2c20 6c61  es=8, dims=2, la
+00001220: 7965 725f 6669 6c74 6572 733d 5b33 2c38  yer_filters=[3,8
+00001230: 2c38 2c31 365d 2c20 6b65 726e 656c 5f73  ,8,16], kernel_s
+00001240: 697a 653d 332c 206e 5f63 6c61 7373 6573  ize=3, n_classes
+00001250: 203d 2037 2c20 6d6f 6465 3d27 636c 6173   = 7, mode='clas
+00001260: 7369 6669 6361 7469 6f6e 272c 2075 6e63  sification', unc
+00001270: 6572 7461 696e 7479 3d46 616c 7365 2c20  ertainty=False, 
+00001280: 7061 6464 696e 673d 2773 616d 6527 290a  padding='same').
+00001290: 2020 2020 3e3e 3e20 7820 3d20 746f 7263      >>> x = torc
+000012a0: 682e 6f6e 6573 2832 2c20 3232 342c 2032  h.ones(2, 224, 2
+000012b0: 3234 2c20 3829 0a20 2020 203e 3e3e 2078  24, 8).    >>> x
+000012c0: 203d 206d 6f64 656c 2878 290a 2020 2020   = model(x).    
+000012d0: 3e3e 3e20 666f 7220 7465 6e73 6f72 2069  >>> for tensor i
+000012e0: 6e20 783a 0a20 2020 202e 2e2e 2020 2020  n x:.    ...    
+000012f0: 7072 696e 7428 7465 6e73 6f72 2e73 6861  print(tensor.sha
+00001300: 7065 290a 2020 2020 746f 7263 682e 5369  pe).    torch.Si
+00001310: 7a65 285b 322c 2035 2c20 375d 290a 2020  ze([2, 5, 7]).  
+00001320: 2020 746f 7263 682e 5369 7a65 285b 322c    torch.Size([2,
+00001330: 2035 2c20 375d 290a 2020 2020 2222 220a   5, 7]).    """.
+00001340: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+00001350: 5f28 7365 6c66 2c0a 2020 2020 2020 2020  _(self,.        
+00001360: 2020 2020 2020 2020 206e 5f74 6173 6b73           n_tasks
+00001370: 3a20 696e 742c 0a20 2020 2020 2020 2020  : int,.         
+00001380: 2020 2020 2020 2020 6e5f 6665 6174 7572          n_featur
+00001390: 6573 3a20 696e 742c 0a20 2020 2020 2020  es: int,.       
+000013a0: 2020 2020 2020 2020 2020 6469 6d73 3a20            dims: 
+000013b0: 696e 742c 0a20 2020 2020 2020 2020 2020  int,.           
+000013c0: 2020 2020 2020 6c61 7965 725f 6669 6c74        layer_filt
+000013d0: 6572 733a 204c 6973 745b 696e 745d 203d  ers: List[int] =
+000013e0: 205b 3130 305d 2c0a 2020 2020 2020 2020   [100],.        
+000013f0: 2020 2020 2020 2020 206b 6572 6e65 6c5f           kernel_
+00001400: 7369 7a65 3a20 4f6e 654f 724d 616e 795b  size: OneOrMany[
+00001410: 696e 745d 203d 2035 2c0a 2020 2020 2020  int] = 5,.      
+00001420: 2020 2020 2020 2020 2020 2073 7472 6964             strid
+00001430: 6573 3a20 4f6e 654f 724d 616e 795b 696e  es: OneOrMany[in
+00001440: 745d 203d 2031 2c0a 2020 2020 2020 2020  t] = 1,.        
+00001450: 2020 2020 2020 2020 2077 6569 6768 745f           weight_
+00001460: 696e 6974 5f73 7464 6465 7673 3a20 4f6e  init_stddevs: On
+00001470: 654f 724d 616e 795b 666c 6f61 745d 203d  eOrMany[float] =
+00001480: 2030 2e30 322c 0a20 2020 2020 2020 2020   0.02,.         
+00001490: 2020 2020 2020 2020 6269 6173 5f69 6e69          bias_ini
+000014a0: 745f 636f 6e73 7473 3a20 4f6e 654f 724d  t_consts: OneOrM
+000014b0: 616e 795b 666c 6f61 745d 203d 2031 2e30  any[float] = 1.0
+000014c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000014d0: 2020 2064 726f 706f 7574 733a 204f 6e65     dropouts: One
+000014e0: 4f72 4d61 6e79 5b66 6c6f 6174 5d20 3d20  OrMany[float] = 
+000014f0: 302e 352c 0a20 2020 2020 2020 2020 2020  0.5,.           
+00001500: 2020 2020 2020 6163 7469 7661 7469 6f6e        activation
+00001510: 5f66 6e73 3a20 4f6e 654f 724d 616e 795b  _fns: OneOrMany[
+00001520: 4163 7469 7661 7469 6f6e 466e 5d20 3d20  ActivationFn] = 
+00001530: 2772 656c 7527 2c0a 2020 2020 2020 2020  'relu',.        
+00001540: 2020 2020 2020 2020 2070 6f6f 6c5f 7479           pool_ty
+00001550: 7065 3a20 7374 7220 3d20 276d 6178 272c  pe: str = 'max',
+00001560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001570: 2020 6d6f 6465 3a20 7374 7220 3d20 2763    mode: str = 'c
+00001580: 6c61 7373 6966 6963 6174 696f 6e27 2c0a  lassification',.
+00001590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000015a0: 206e 5f63 6c61 7373 6573 3a20 696e 7420   n_classes: int 
+000015b0: 3d20 322c 0a20 2020 2020 2020 2020 2020  = 2,.           
+000015c0: 2020 2020 2020 756e 6365 7274 6169 6e74        uncertaint
+000015d0: 793a 2062 6f6f 6c20 3d20 4661 6c73 652c  y: bool = False,
+000015e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000015f0: 2020 7265 7369 6475 616c 3a20 626f 6f6c    residual: bool
+00001600: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
+00001610: 2020 2020 2020 2020 2020 2070 6164 6469             paddi
+00001620: 6e67 3a20 556e 696f 6e5b 696e 742c 2073  ng: Union[int, s
+00001630: 7472 5d20 3d20 2776 616c 6964 2729 202d  tr] = 'valid') -
+00001640: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00001650: 2222 2243 7265 6174 6520 6120 434e 4e2e  """Create a CNN.
+00001660: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
+00001670: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
+00001680: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00001690: 6e5f 7461 736b 733a 2069 6e74 0a20 2020  n_tasks: int.   
+000016a0: 2020 2020 2020 2020 206e 756d 6265 7220           number 
+000016b0: 6f66 2074 6173 6b73 0a20 2020 2020 2020  of tasks.       
+000016c0: 206e 5f66 6561 7475 7265 733a 2069 6e74   n_features: int
+000016d0: 0a20 2020 2020 2020 2020 2020 206e 756d  .            num
+000016e0: 6265 7220 6f66 2066 6561 7475 7265 730a  ber of features.
+000016f0: 2020 2020 2020 2020 6469 6d73 3a20 696e          dims: in
+00001700: 740a 2020 2020 2020 2020 2020 2020 7468  t.            th
+00001710: 6520 6e75 6d62 6572 206f 6620 6469 6d65  e number of dime
+00001720: 6e73 696f 6e73 2074 6f20 6170 706c 7920  nsions to apply 
+00001730: 636f 6e76 6f6c 7574 696f 6e73 206f 7665  convolutions ove
+00001740: 7220 2831 2c20 322c 206f 7220 3329 0a20  r (1, 2, or 3). 
+00001750: 2020 2020 2020 206c 6179 6572 5f66 696c         layer_fil
+00001760: 7465 7273 3a20 6c69 7374 0a20 2020 2020  ters: list.     
+00001770: 2020 2020 2020 2074 6865 206e 756d 6265         the numbe
+00001780: 7220 6f66 206f 7574 7075 7420 6669 6c74  r of output filt
+00001790: 6572 7320 666f 7220 6561 6368 2063 6f6e  ers for each con
+000017a0: 766f 6c75 7469 6f6e 616c 206c 6179 6572  volutional layer
+000017b0: 2069 6e20 7468 6520 6e65 7477 6f72 6b2e   in the network.
+000017c0: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
+000017d0: 206c 656e 6774 6820 6f66 2074 6869 7320   length of this 
+000017e0: 6c69 7374 2064 6574 6572 6d69 6e65 7320  list determines 
+000017f0: 7468 6520 6e75 6d62 6572 206f 6620 6c61  the number of la
+00001800: 7965 7273 2e0a 2020 2020 2020 2020 6b65  yers..        ke
+00001810: 726e 656c 5f73 697a 653a 2069 6e74 2c20  rnel_size: int, 
+00001820: 7475 706c 652c 206f 7220 6c69 7374 0a20  tuple, or list. 
+00001830: 2020 2020 2020 2020 2020 2061 206c 6973             a lis
+00001840: 7420 6769 7669 6e67 2074 6865 2073 6861  t giving the sha
+00001850: 7065 206f 6620 7468 6520 636f 6e76 6f6c  pe of the convol
+00001860: 7574 696f 6e61 6c20 6b65 726e 656c 2066  utional kernel f
+00001870: 6f72 2065 6163 6820 6c61 7965 722e 2020  or each layer.  
+00001880: 4561 6368 0a20 2020 2020 2020 2020 2020  Each.           
+00001890: 2065 6c65 6d65 6e74 206d 6179 2062 6520   element may be 
+000018a0: 6569 7468 6572 2061 6e20 696e 7420 2875  either an int (u
+000018b0: 7365 2074 6865 2073 616d 6520 6b65 726e  se the same kern
+000018c0: 656c 2077 6964 7468 2066 6f72 2065 7665  el width for eve
+000018d0: 7279 2064 696d 656e 7369 6f6e 290a 2020  ry dimension).  
+000018e0: 2020 2020 2020 2020 2020 6f72 2061 2074            or a t
+000018f0: 7570 6c65 2028 7468 6520 6b65 726e 656c  uple (the kernel
+00001900: 2077 6964 7468 2061 6c6f 6e67 2065 6163   width along eac
+00001910: 6820 6469 6d65 6e73 696f 6e29 2e20 2041  h dimension).  A
+00001920: 6c74 6572 6e61 7469 7665 6c79 2074 6869  lternatively thi
+00001930: 7320 6d61 790a 2020 2020 2020 2020 2020  s may.          
+00001940: 2020 6265 2061 2073 696e 676c 6520 696e    be a single in
+00001950: 7420 6f72 2074 7570 6c65 2069 6e73 7465  t or tuple inste
+00001960: 6164 206f 6620 6120 6c69 7374 2c20 696e  ad of a list, in
+00001970: 2077 6869 6368 2063 6173 6520 7468 6520   which case the 
+00001980: 7361 6d65 206b 6572 6e65 6c0a 2020 2020  same kernel.    
+00001990: 2020 2020 2020 2020 7368 6170 6520 6973          shape is
+000019a0: 2075 7365 6420 666f 7220 6576 6572 7920   used for every 
+000019b0: 6c61 7965 722e 0a20 2020 2020 2020 2073  layer..        s
+000019c0: 7472 6964 6573 3a20 696e 742c 2074 7570  trides: int, tup
+000019d0: 6c65 2c20 6f72 206c 6973 740a 2020 2020  le, or list.    
+000019e0: 2020 2020 2020 2020 6120 6c69 7374 2067          a list g
+000019f0: 6976 696e 6720 7468 6520 7374 7269 6465  iving the stride
+00001a00: 2062 6574 7765 656e 2061 7070 6c69 6361   between applica
+00001a10: 7469 6f6e 7320 6f66 2074 6865 2020 6b65  tions of the  ke
+00001a20: 726e 656c 2066 6f72 2065 6163 6820 6c61  rnel for each la
+00001a30: 7965 722e 0a20 2020 2020 2020 2020 2020  yer..           
+00001a40: 2045 6163 6820 656c 656d 656e 7420 6d61   Each element ma
+00001a50: 7920 6265 2065 6974 6865 7220 616e 2069  y be either an i
+00001a60: 6e74 2028 7573 6520 7468 6520 7361 6d65  nt (use the same
+00001a70: 2073 7472 6964 6520 666f 7220 6576 6572   stride for ever
+00001a80: 7920 6469 6d65 6e73 696f 6e29 0a20 2020  y dimension).   
+00001a90: 2020 2020 2020 2020 206f 7220 6120 7475           or a tu
+00001aa0: 706c 6520 2874 6865 2073 7472 6964 6520  ple (the stride 
+00001ab0: 616c 6f6e 6720 6561 6368 2064 696d 656e  along each dimen
+00001ac0: 7369 6f6e 292e 2020 416c 7465 726e 6174  sion).  Alternat
+00001ad0: 6976 656c 7920 7468 6973 206d 6179 2062  ively this may b
+00001ae0: 6520 610a 2020 2020 2020 2020 2020 2020  e a.            
+00001af0: 7369 6e67 6c65 2069 6e74 206f 7220 7475  single int or tu
+00001b00: 706c 6520 696e 7374 6561 6420 6f66 2061  ple instead of a
+00001b10: 206c 6973 742c 2069 6e20 7768 6963 6820   list, in which 
+00001b20: 6361 7365 2074 6865 2073 616d 6520 7374  case the same st
+00001b30: 7269 6465 2069 730a 2020 2020 2020 2020  ride is.        
+00001b40: 2020 2020 7573 6564 2066 6f72 2065 7665      used for eve
+00001b50: 7279 206c 6179 6572 2e0a 2020 2020 2020  ry layer..      
+00001b60: 2020 7765 6967 6874 5f69 6e69 745f 7374    weight_init_st
+00001b70: 6464 6576 733a 206c 6973 7420 6f72 2066  ddevs: list or f
+00001b80: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
+00001b90: 2074 6865 2073 7461 6e64 6172 6420 6465   the standard de
+00001ba0: 7669 6174 696f 6e20 6f66 2074 6865 2064  viation of the d
+00001bb0: 6973 7472 6962 7574 696f 6e20 746f 2075  istribution to u
+00001bc0: 7365 2066 6f72 2077 6569 6768 7420 696e  se for weight in
+00001bd0: 6974 6961 6c69 7a61 7469 6f6e 0a20 2020  itialization.   
+00001be0: 2020 2020 2020 2020 206f 6620 6561 6368           of each
+00001bf0: 206c 6179 6572 2e20 2054 6865 206c 656e   layer.  The len
+00001c00: 6774 6820 6f66 2074 6869 7320 6c69 7374  gth of this list
+00001c10: 2073 686f 756c 6420 6571 7561 6c20 6c65   should equal le
+00001c20: 6e28 6c61 7965 725f 6669 6c74 6572 7329  n(layer_filters)
+00001c30: 2b31 2c0a 2020 2020 2020 2020 2020 2020  +1,.            
+00001c40: 7768 6572 6520 7468 6520 6669 6e61 6c20  where the final 
+00001c50: 656c 656d 656e 7420 636f 7272 6573 706f  element correspo
+00001c60: 6e64 7320 746f 2074 6865 2064 656e 7365  nds to the dense
+00001c70: 206c 6179 6572 2e20 2041 6c74 6572 6e61   layer.  Alterna
+00001c80: 7469 7665 6c79 2074 6869 730a 2020 2020  tively this.    
+00001c90: 2020 2020 2020 2020 6d61 7920 6265 2061          may be a
+00001ca0: 2073 696e 676c 6520 7661 6c75 6520 696e   single value in
+00001cb0: 7374 6561 6420 6f66 2061 206c 6973 742c  stead of a list,
+00001cc0: 2069 6e20 7768 6963 6820 6361 7365 2074   in which case t
+00001cd0: 6865 2073 616d 6520 7661 6c75 6520 6973  he same value is
+00001ce0: 2075 7365 640a 2020 2020 2020 2020 2020   used.          
+00001cf0: 2020 666f 7220 6576 6572 7920 6c61 7965    for every laye
+00001d00: 722e 0a20 2020 2020 2020 2062 6961 735f  r..        bias_
+00001d10: 696e 6974 5f63 6f6e 7374 733a 206c 6973  init_consts: lis
+00001d20: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
+00001d30: 2020 2020 2020 2074 6865 2076 616c 7565         the value
+00001d40: 2074 6f20 696e 6974 6961 6c69 7a65 2074   to initialize t
+00001d50: 6865 2062 6961 7365 7320 696e 2065 6163  he biases in eac
+00001d60: 6820 6c61 7965 7220 746f 2e20 2054 6865  h layer to.  The
+00001d70: 206c 656e 6774 6820 6f66 2074 6869 730a   length of this.
+00001d80: 2020 2020 2020 2020 2020 2020 6c69 7374              list
+00001d90: 2073 686f 756c 6420 6571 7561 6c20 6c65   should equal le
+00001da0: 6e28 6c61 7965 725f 6669 6c74 6572 7329  n(layer_filters)
+00001db0: 2b31 2c20 7768 6572 6520 7468 6520 6669  +1, where the fi
+00001dc0: 6e61 6c20 656c 656d 656e 7420 636f 7272  nal element corr
+00001dd0: 6573 706f 6e64 730a 2020 2020 2020 2020  esponds.        
+00001de0: 2020 2020 746f 2074 6865 2064 656e 7365      to the dense
+00001df0: 206c 6179 6572 2e20 2041 6c74 6572 6e61   layer.  Alterna
+00001e00: 7469 7665 6c79 2074 6869 7320 6d61 7920  tively this may 
+00001e10: 6265 2061 2073 696e 676c 6520 7661 6c75  be a single valu
+00001e20: 6520 696e 7374 6561 6420 6f66 2061 0a20  e instead of a. 
+00001e30: 2020 2020 2020 2020 2020 206c 6973 742c             list,
+00001e40: 2069 6e20 7768 6963 6820 6361 7365 2074   in which case t
+00001e50: 6865 2073 616d 6520 7661 6c75 6520 6973  he same value is
+00001e60: 2075 7365 6420 666f 7220 6576 6572 7920   used for every 
+00001e70: 6c61 7965 722e 0a20 2020 2020 2020 2064  layer..        d
+00001e80: 726f 706f 7574 733a 206c 6973 7420 6f72  ropouts: list or
+00001e90: 2066 6c6f 6174 0a20 2020 2020 2020 2020   float.         
+00001ea0: 2020 2074 6865 2064 726f 706f 7574 2070     the dropout p
+00001eb0: 726f 6261 6269 6c69 7479 2074 6f20 7573  robability to us
+00001ec0: 6520 666f 7220 6561 6368 206c 6179 6572  e for each layer
+00001ed0: 2e20 2054 6865 206c 656e 6774 6820 6f66  .  The length of
+00001ee0: 2074 6869 7320 6c69 7374 2073 686f 756c   this list shoul
+00001ef0: 6420 6571 7561 6c20 6c65 6e28 6c61 7965  d equal len(laye
+00001f00: 725f 6669 6c74 6572 7329 2e0a 2020 2020  r_filters)..    
+00001f10: 2020 2020 2020 2020 416c 7465 726e 6174          Alternat
+00001f20: 6976 656c 7920 7468 6973 206d 6179 2062  ively this may b
+00001f30: 6520 6120 7369 6e67 6c65 2076 616c 7565  e a single value
+00001f40: 2069 6e73 7465 6164 206f 6620 6120 6c69   instead of a li
+00001f50: 7374 2c20 696e 2077 6869 6368 2063 6173  st, in which cas
+00001f60: 6520 7468 6520 7361 6d65 2076 616c 7565  e the same value
+00001f70: 2069 7320 7573 6564 2066 6f72 2065 7665   is used for eve
+00001f80: 7279 206c 6179 6572 0a20 2020 2020 2020  ry layer.       
+00001f90: 2061 6374 6976 6174 696f 6e5f 666e 733a   activation_fns:
+00001fa0: 2073 7472 206f 7220 6c69 7374 0a20 2020   str or list.   
+00001fb0: 2020 2020 2020 2020 2074 6865 2074 6f72           the tor
+00001fc0: 6368 2061 6374 6976 6174 696f 6e20 6675  ch activation fu
+00001fd0: 6e63 7469 6f6e 2074 6f20 6170 706c 7920  nction to apply 
+00001fe0: 746f 2065 6163 6820 6c61 7965 722e 2054  to each layer. T
+00001ff0: 6865 206c 656e 6774 6820 6f66 2074 6869  he length of thi
+00002000: 7320 6c69 7374 2073 686f 756c 6420 6571  s list should eq
+00002010: 7561 6c0a 2020 2020 2020 2020 2020 2020  ual.            
+00002020: 6c65 6e28 6c61 7965 725f 6669 6c74 6572  len(layer_filter
+00002030: 7329 2e20 2041 6c74 6572 6e61 7469 7665  s).  Alternative
+00002040: 6c79 2074 6869 7320 6d61 7920 6265 2061  ly this may be a
+00002050: 2073 696e 676c 6520 7661 6c75 6520 696e   single value in
+00002060: 7374 6561 6420 6f66 2061 206c 6973 742c  stead of a list,
+00002070: 2069 6e20 7768 6963 6820 6361 7365 2074   in which case t
+00002080: 6865 0a20 2020 2020 2020 2020 2020 2073  he.            s
+00002090: 616d 6520 7661 6c75 6520 6973 2075 7365  ame value is use
+000020a0: 6420 666f 7220 6576 6572 7920 6c61 7965  d for every laye
+000020b0: 722c 2027 7265 6c75 2720 6279 2064 6566  r, 'relu' by def
+000020c0: 6175 6c74 0a20 2020 2020 2020 2070 6f6f  ault.        poo
+000020d0: 6c5f 7479 7065 3a20 7374 720a 2020 2020  l_type: str.    
+000020e0: 2020 2020 2020 2020 7468 6520 7479 7065          the type
+000020f0: 206f 6620 706f 6f6c 696e 6720 6c61 7965   of pooling laye
+00002100: 7220 746f 2075 7365 2c20 6569 7468 6572  r to use, either
+00002110: 2027 6d61 7827 206f 7220 2761 7665 7261   'max' or 'avera
+00002120: 6765 270a 2020 2020 2020 2020 6d6f 6465  ge'.        mode
+00002130: 3a20 7374 720a 2020 2020 2020 2020 2020  : str.          
+00002140: 2020 4569 7468 6572 2027 636c 6173 7369    Either 'classi
+00002150: 6669 6361 7469 6f6e 2720 6f72 2027 7265  fication' or 're
+00002160: 6772 6573 7369 6f6e 270a 2020 2020 2020  gression'.      
+00002170: 2020 6e5f 636c 6173 7365 733a 2069 6e74    n_classes: int
+00002180: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+00002190: 206e 756d 6265 7220 6f66 2063 6c61 7373   number of class
+000021a0: 6573 2074 6f20 7072 6564 6963 7420 286f  es to predict (o
+000021b0: 6e6c 7920 7573 6564 2069 6e20 636c 6173  nly used in clas
+000021c0: 7369 6669 6361 7469 6f6e 206d 6f64 6529  sification mode)
+000021d0: 0a20 2020 2020 2020 2075 6e63 6572 7461  .        uncerta
+000021e0: 696e 7479 3a20 626f 6f6c 0a20 2020 2020  inty: bool.     
+000021f0: 2020 2020 2020 2069 6620 5472 7565 2c20         if True, 
+00002200: 696e 636c 7564 6520 6578 7472 6120 6f75  include extra ou
+00002210: 7470 7574 7320 616e 6420 6c6f 7373 2074  tputs and loss t
+00002220: 6572 6d73 2074 6f20 656e 6162 6c65 2074  erms to enable t
+00002230: 6865 2075 6e63 6572 7461 696e 7479 0a20  he uncertainty. 
+00002240: 2020 2020 2020 2020 2020 2069 6e20 6f75             in ou
+00002250: 7470 7574 7320 746f 2062 6520 7072 6564  tputs to be pred
+00002260: 6963 7465 640a 2020 2020 2020 2020 7265  icted.        re
+00002270: 7369 6475 616c 3a20 626f 6f6c 0a20 2020  sidual: bool.   
+00002280: 2020 2020 2020 2020 2069 6620 5472 7565           if True
+00002290: 2c20 7468 6520 6d6f 6465 6c20 7769 6c6c  , the model will
+000022a0: 2062 6520 636f 6d70 6f73 6564 206f 6620   be composed of 
+000022b0: 7072 652d 6163 7469 7661 7469 6f6e 2072  pre-activation r
+000022c0: 6573 6964 7561 6c20 626c 6f63 6b73 2069  esidual blocks i
+000022d0: 6e73 7465 6164 0a20 2020 2020 2020 2020  nstead.         
+000022e0: 2020 206f 6620 6120 7369 6d70 6c65 2073     of a simple s
+000022f0: 7461 636b 206f 6620 636f 6e76 6f6c 7574  tack of convolut
+00002300: 696f 6e61 6c20 6c61 7965 7273 2e0a 2020  ional layers..  
+00002310: 2020 2020 2020 7061 6464 696e 673a 2073        padding: s
+00002320: 7472 2c20 696e 7420 6f72 2074 7570 6c65  tr, int or tuple
+00002330: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+00002340: 2070 6164 6469 6e67 2074 6f20 7573 6520   padding to use 
+00002350: 666f 7220 636f 6e76 6f6c 7574 696f 6e61  for convolutiona
+00002360: 6c20 6c61 7965 7273 2c20 6569 7468 6572  l layers, either
+00002370: 2027 7661 6c69 6427 206f 7220 2773 616d   'valid' or 'sam
+00002380: 6527 0a20 2020 2020 2020 2022 2222 0a0a  e'.        """..
+00002390: 2020 2020 2020 2020 7375 7065 7228 434e          super(CN
+000023a0: 4e4d 6f64 756c 652c 2073 656c 6629 2e5f  NModule, self)._
+000023b0: 5f69 6e69 745f 5f28 290a 0a20 2020 2020  _init__()..     
+000023c0: 2020 2069 6620 6469 6d73 206e 6f74 2069     if dims not i
+000023d0: 6e20 2831 2c20 322c 2033 293a 0a20 2020  n (1, 2, 3):.   
+000023e0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+000023f0: 616c 7565 4572 726f 7228 274e 756d 6265  alueError('Numbe
+00002400: 7220 6f66 2064 696d 656e 7369 6f6e 7320  r of dimensions 
+00002410: 6d75 7374 2062 6520 312c 2032 206f 7220  must be 1, 2 or 
+00002420: 3327 290a 0a20 2020 2020 2020 2069 6620  3')..        if 
+00002430: 6d6f 6465 206e 6f74 2069 6e20 5b27 636c  mode not in ['cl
+00002440: 6173 7369 6669 6361 7469 6f6e 272c 2027  assification', '
+00002450: 7265 6772 6573 7369 6f6e 275d 3a0a 2020  regression']:.  
+00002460: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00002470: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+00002480: 2020 2020 2020 2020 2020 2020 226d 6f64              "mod
+00002490: 6520 6d75 7374 2062 6520 6569 7468 6572  e must be either
+000024a0: 2027 636c 6173 7369 6669 6361 7469 6f6e   'classification
+000024b0: 2720 6f72 2027 7265 6772 6573 7369 6f6e  ' or 'regression
+000024c0: 2722 290a 0a20 2020 2020 2020 2073 656c  '")..        sel
+000024d0: 662e 6e5f 7461 736b 7320 3d20 6e5f 7461  f.n_tasks = n_ta
+000024e0: 736b 730a 2020 2020 2020 2020 7365 6c66  sks.        self
+000024f0: 2e6e 5f66 6561 7475 7265 7320 3d20 6e5f  .n_features = n_
+00002500: 6665 6174 7572 6573 0a20 2020 2020 2020  features.       
+00002510: 2073 656c 662e 6469 6d73 203d 2064 696d   self.dims = dim
+00002520: 730a 2020 2020 2020 2020 7365 6c66 2e6d  s.        self.m
+00002530: 6f64 6520 3d20 6d6f 6465 0a20 2020 2020  ode = mode.     
+00002540: 2020 2073 656c 662e 6e5f 636c 6173 7365     self.n_classe
+00002550: 7320 3d20 6e5f 636c 6173 7365 730a 2020  s = n_classes.  
+00002560: 2020 2020 2020 7365 6c66 2e75 6e63 6572        self.uncer
+00002570: 7461 696e 7479 203d 2075 6e63 6572 7461  tainty = uncerta
+00002580: 696e 7479 0a20 2020 2020 2020 2073 656c  inty.        sel
+00002590: 662e 6d6f 6465 203d 206d 6f64 650a 2020  f.mode = mode.  
+000025a0: 2020 2020 2020 7365 6c66 2e6c 6179 6572        self.layer
+000025b0: 5f66 696c 7465 7273 203d 206c 6179 6572  _filters = layer
+000025c0: 5f66 696c 7465 7273 0a20 2020 2020 2020  _filters.       
+000025d0: 2073 656c 662e 7265 7369 6475 616c 203d   self.residual =
+000025e0: 2072 6573 6964 7561 6c0a 0a20 2020 2020   residual..     
+000025f0: 2020 206e 5f6c 6179 6572 7320 3d20 6c65     n_layers = le
+00002600: 6e28 6c61 7965 725f 6669 6c74 6572 7329  n(layer_filters)
+00002610: 0a0a 2020 2020 2020 2020 2320 5079 546f  ..        # PyTo
+00002620: 7263 6820 6c61 7965 7273 2072 6571 7569  rch layers requi
+00002630: 7265 2069 6e70 7574 2061 6e64 206f 7574  re input and out
+00002640: 7075 7420 6368 616e 6e65 6c73 2061 7320  put channels as 
+00002650: 7061 7261 6d65 7465 720a 2020 2020 2020  parameter.      
+00002660: 2020 2320 6966 206f 6e6c 7920 6f6e 6520    # if only one 
+00002670: 6c61 7965 7220 746f 206d 616b 6520 7468  layer to make th
+00002680: 6520 6d6f 6465 6c20 6372 6561 7469 6e67  e model creating
+00002690: 206c 6f6f 7020 6265 6c6f 7720 776f 726b   loop below work
+000026a0: 2c20 6d75 6c74 6970 6c79 206c 6179 6572  , multiply layer
+000026b0: 5f66 696c 7465 7273 2077 7574 6720 320a  _filters wutg 2.
+000026c0: 2020 2020 2020 2020 6966 206c 656e 286c          if len(l
+000026d0: 6179 6572 5f66 696c 7465 7273 2920 3d3d  ayer_filters) ==
+000026e0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+000026f0: 6c61 7965 725f 6669 6c74 6572 7320 3d20  layer_filters = 
+00002700: 6c61 7965 725f 6669 6c74 6572 7320 2a20  layer_filters * 
+00002710: 320a 0a20 2020 2020 2020 2069 6620 6e6f  2..        if no
+00002720: 7420 6973 696e 7374 616e 6365 286b 6572  t isinstance(ker
+00002730: 6e65 6c5f 7369 7a65 2c20 5365 7175 656e  nel_size, Sequen
+00002740: 6365 436f 6c6c 6563 7469 6f6e 293a 0a20  ceCollection):. 
+00002750: 2020 2020 2020 2020 2020 206b 6572 6e65             kerne
+00002760: 6c5f 7369 7a65 203d 205b 6b65 726e 656c  l_size = [kernel
+00002770: 5f73 697a 655d 202a 206e 5f6c 6179 6572  _size] * n_layer
+00002780: 730a 2020 2020 2020 2020 6966 206e 6f74  s.        if not
+00002790: 2069 7369 6e73 7461 6e63 6528 7374 7269   isinstance(stri
+000027a0: 6465 732c 2053 6571 7565 6e63 6543 6f6c  des, SequenceCol
+000027b0: 6c65 6374 696f 6e29 3a0a 2020 2020 2020  lection):.      
+000027c0: 2020 2020 2020 7374 7269 6465 7320 3d20        strides = 
+000027d0: 5b73 7472 6964 6573 5d20 2a20 6e5f 6c61  [strides] * n_la
+000027e0: 7965 7273 0a20 2020 2020 2020 2069 6620  yers.        if 
+000027f0: 6e6f 7420 6973 696e 7374 616e 6365 2864  not isinstance(d
+00002800: 726f 706f 7574 732c 2053 6571 7565 6e63  ropouts, Sequenc
+00002810: 6543 6f6c 6c65 6374 696f 6e29 3a0a 2020  eCollection):.  
+00002820: 2020 2020 2020 2020 2020 6472 6f70 6f75            dropou
+00002830: 7473 203d 205b 6472 6f70 6f75 7473 5d20  ts = [dropouts] 
+00002840: 2a20 6e5f 6c61 7965 7273 0a20 2020 2020  * n_layers.     
+00002850: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00002860: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00002870: 2020 6163 7469 7661 7469 6f6e 5f66 6e73    activation_fns
+00002880: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00002890: 2020 7374 7229 206f 7220 6e6f 7420 6973    str) or not is
+000028a0: 696e 7374 616e 6365 2861 6374 6976 6174  instance(activat
+000028b0: 696f 6e5f 666e 732c 2053 6571 7565 6e63  ion_fns, Sequenc
+000028c0: 6543 6f6c 6c65 6374 696f 6e29 3a0a 2020  eCollection):.  
+000028d0: 2020 2020 2020 2020 2020 6163 7469 7661            activa
+000028e0: 7469 6f6e 5f66 6e73 203d 205b 6163 7469  tion_fns = [acti
+000028f0: 7661 7469 6f6e 5f66 6e73 5d20 2a20 6e5f  vation_fns] * n_
+00002900: 6c61 7965 7273 0a20 2020 2020 2020 2069  layers.        i
+00002910: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
+00002920: 2877 6569 6768 745f 696e 6974 5f73 7464  (weight_init_std
+00002930: 6465 7673 2c20 5365 7175 656e 6365 436f  devs, SequenceCo
+00002940: 6c6c 6563 7469 6f6e 293a 0a20 2020 2020  llection):.     
+00002950: 2020 2020 2020 2077 6569 6768 745f 696e         weight_in
+00002960: 6974 5f73 7464 6465 7673 203d 205b 7765  it_stddevs = [we
+00002970: 6967 6874 5f69 6e69 745f 7374 6464 6576  ight_init_stddev
+00002980: 735d 202a 206e 5f6c 6179 6572 730a 2020  s] * n_layers.  
+00002990: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+000029a0: 6e73 7461 6e63 6528 6269 6173 5f69 6e69  nstance(bias_ini
+000029b0: 745f 636f 6e73 7473 2c20 5365 7175 656e  t_consts, Sequen
+000029c0: 6365 436f 6c6c 6563 7469 6f6e 293a 0a20  ceCollection):. 
+000029d0: 2020 2020 2020 2020 2020 2062 6961 735f             bias_
+000029e0: 696e 6974 5f63 6f6e 7374 7320 3d20 5b62  init_consts = [b
+000029f0: 6961 735f 696e 6974 5f63 6f6e 7374 735d  ias_init_consts]
+00002a00: 202a 206e 5f6c 6179 6572 730a 0a20 2020   * n_layers..   
+00002a10: 2020 2020 2073 656c 662e 6163 7469 7661       self.activa
+00002a20: 7469 6f6e 5f66 6e73 203d 205b 6765 745f  tion_fns = [get_
+00002a30: 6163 7469 7661 7469 6f6e 2866 2920 666f  activation(f) fo
+00002a40: 7220 6620 696e 2061 6374 6976 6174 696f  r f in activatio
+00002a50: 6e5f 666e 735d 0a20 2020 2020 2020 2073  n_fns].        s
+00002a60: 656c 662e 6472 6f70 6f75 7473 203d 2064  elf.dropouts = d
+00002a70: 726f 706f 7574 730a 0a20 2020 2020 2020  ropouts..       
+00002a80: 2069 6620 756e 6365 7274 6169 6e74 793a   if uncertainty:
+00002a90: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00002aa0: 206d 6f64 6520 213d 2027 7265 6772 6573   mode != 'regres
+00002ab0: 7369 6f6e 273a 0a20 2020 2020 2020 2020  sion':.         
+00002ac0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00002ad0: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
+00002ae0: 2020 2020 2020 2020 2020 2020 2022 556e               "Un
+00002af0: 6365 7274 6169 6e74 7920 6973 206f 6e6c  certainty is onl
+00002b00: 7920 7375 7070 6f72 7465 6420 696e 2072  y supported in r
+00002b10: 6567 7265 7373 696f 6e20 6d6f 6465 2229  egression mode")
+00002b20: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00002b30: 2061 6e79 2864 203d 3d20 302e 3020 666f   any(d == 0.0 fo
+00002b40: 7220 6420 696e 2064 726f 706f 7574 7329  r d in dropouts)
+00002b50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00002b60: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00002b70: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+00002b80: 2020 2020 2020 2020 2744 726f 706f 7574          'Dropout
+00002b90: 206d 7573 7420 6265 2069 6e63 6c75 6465   must be include
+00002ba0: 6420 696e 2065 7665 7279 206c 6179 6572  d in every layer
+00002bb0: 2074 6f20 7072 6564 6963 7420 756e 6365   to predict unce
+00002bc0: 7274 6169 6e74 7927 0a20 2020 2020 2020  rtainty'.       
+00002bd0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00002be0: 2020 2020 2320 5079 7468 6f6e 2074 7570      # Python tup
+00002bf0: 6c65 7320 7573 6520 3020 6261 7365 6420  les use 0 based 
+00002c00: 696e 6465 7869 6e67 2c20 6469 6d73 2064  indexing, dims d
+00002c10: 6566 696e 6573 206e 756d 6265 7220 6f66  efines number of
+00002c20: 2064 696d 656e 7369 6f6e 2066 6f72 2063   dimension for c
+00002c30: 6f6e 766f 6c75 7469 6f6e 616c 206f 7065  onvolutional ope
+00002c40: 7261 7469 6f6e 0a20 2020 2020 2020 2043  ration.        C
+00002c50: 6f6e 764c 6179 6572 203d 2028 6e6e 2e43  onvLayer = (nn.C
+00002c60: 6f6e 7631 642c 206e 6e2e 436f 6e76 3264  onv1d, nn.Conv2d
+00002c70: 2c20 6e6e 2e43 6f6e 7633 6429 5b73 656c  , nn.Conv3d)[sel
+00002c80: 662e 6469 6d73 202d 2031 5d0a 0a20 2020  f.dims - 1]..   
+00002c90: 2020 2020 2069 6620 706f 6f6c 5f74 7970       if pool_typ
+00002ca0: 6520 3d3d 2027 6176 6572 6167 6527 3a0a  e == 'average':.
+00002cb0: 2020 2020 2020 2020 2020 2020 506f 6f6c              Pool
+00002cc0: 4c61 7965 7220 3d20 2846 2e61 7667 5f70  Layer = (F.avg_p
+00002cd0: 6f6f 6c31 642c 2046 2e61 7667 5f70 6f6f  ool1d, F.avg_poo
+00002ce0: 6c32 642c 0a20 2020 2020 2020 2020 2020  l2d,.           
+00002cf0: 2020 2020 2020 2020 2020 2020 2020 462e                F.
+00002d00: 6176 675f 706f 6f6c 3364 295b 7365 6c66  avg_pool3d)[self
+00002d10: 2e64 696d 7320 2d20 315d 0a20 2020 2020  .dims - 1].     
+00002d20: 2020 2065 6c69 6620 706f 6f6c 5f74 7970     elif pool_typ
+00002d30: 6520 3d3d 2027 6d61 7827 3a0a 2020 2020  e == 'max':.    
+00002d40: 2020 2020 2020 2020 506f 6f6c 4c61 7965          PoolLaye
+00002d50: 7220 3d20 2846 2e6d 6178 5f70 6f6f 6c31  r = (F.max_pool1
+00002d60: 642c 2046 2e6d 6178 5f70 6f6f 6c32 642c  d, F.max_pool2d,
+00002d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002d80: 2020 2020 2020 2020 2020 462e 6d61 785f            F.max_
+00002d90: 706f 6f6c 3364 295b 7365 6c66 2e64 696d  pool3d)[self.dim
+00002da0: 7320 2d20 315d 0a20 2020 2020 2020 2065  s - 1].        e
+00002db0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00002dc0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00002dd0: 7228 2270 6f6f 6c5f 7479 7065 206d 7573  r("pool_type mus
+00002de0: 7420 6265 2065 6974 6865 7220 2761 7665  t be either 'ave
+00002df0: 7261 6765 2720 6f72 2027 6d61 7827 2229  rage' or 'max'")
+00002e00: 0a0a 2020 2020 2020 2020 7365 6c66 2e50  ..        self.P
+00002e10: 6f6f 6c4c 6179 6572 203d 2050 6f6f 6c4c  oolLayer = PoolL
+00002e20: 6179 6572 0a20 2020 2020 2020 2073 656c  ayer.        sel
+00002e30: 662e 6c61 7965 7273 203d 206e 6e2e 4d6f  f.layers = nn.Mo
+00002e40: 6475 6c65 4c69 7374 2829 0a0a 2020 2020  duleList()..    
+00002e50: 2020 2020 696e 5f73 6861 7065 203d 206e      in_shape = n
+00002e60: 5f66 6561 7475 7265 730a 0a20 2020 2020  _features..     
+00002e70: 2020 2066 6f72 206f 7574 5f73 6861 7065     for out_shape
+00002e80: 2c20 7369 7a65 2c20 7374 7269 6465 2c20  , size, stride, 
+00002e90: 7765 6967 6874 5f73 7464 6465 762c 2062  weight_stddev, b
+00002ea0: 6961 735f 636f 6e73 7420 696e 207a 6970  ias_const in zip
+00002eb0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00002ec0: 2020 6c61 7965 725f 6669 6c74 6572 732c    layer_filters,
+00002ed0: 206b 6572 6e65 6c5f 7369 7a65 2c20 7374   kernel_size, st
+00002ee0: 7269 6465 732c 2077 6569 6768 745f 696e  rides, weight_in
+00002ef0: 6974 5f73 7464 6465 7673 2c0a 2020 2020  it_stddevs,.    
+00002f00: 2020 2020 2020 2020 2020 2020 6269 6173              bias
+00002f10: 5f69 6e69 745f 636f 6e73 7473 293a 0a0a  _init_consts):..
+00002f20: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+00002f30: 7220 3d20 436f 6e76 4c61 7965 7228 696e  r = ConvLayer(in
+00002f40: 5f63 6861 6e6e 656c 733d 696e 5f73 6861  _channels=in_sha
+00002f50: 7065 2c0a 2020 2020 2020 2020 2020 2020  pe,.            
+00002f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002f70: 2020 6f75 745f 6368 616e 6e65 6c73 3d6f    out_channels=o
+00002f80: 7574 5f73 6861 7065 2c0a 2020 2020 2020  ut_shape,.      
+00002f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002fa0: 2020 2020 2020 2020 6b65 726e 656c 5f73          kernel_s
+00002fb0: 697a 653d 7369 7a65 2c0a 2020 2020 2020  ize=size,.      
+00002fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002fd0: 2020 2020 2020 2020 7374 7269 6465 3d73          stride=s
+00002fe0: 7472 6964 652c 0a20 2020 2020 2020 2020  tride,.         
+00002ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003000: 2020 2020 2070 6164 6469 6e67 3d70 6164       padding=pad
+00003010: 6469 6e67 2c0a 2020 2020 2020 2020 2020  ding,.          
+00003020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003030: 2020 2020 6469 6c61 7469 6f6e 3d31 2c0a      dilation=1,.
+00003040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003050: 2020 2020 2020 2020 2020 2020 2020 6772                gr
+00003060: 6f75 7073 3d31 2c0a 2020 2020 2020 2020  oups=1,.        
+00003070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003080: 2020 2020 2020 6269 6173 3d54 7275 6529        bias=True)
+00003090: 0a0a 2020 2020 2020 2020 2020 2020 6e6e  ..            nn
+000030a0: 2e69 6e69 742e 6e6f 726d 616c 5f28 6c61  .init.normal_(la
+000030b0: 7965 722e 7765 6967 6874 2c20 302c 2077  yer.weight, 0, w
+000030c0: 6569 6768 745f 7374 6464 6576 290a 0a20  eight_stddev).. 
+000030d0: 2020 2020 2020 2020 2020 2023 2069 6e69             # ini
+000030e0: 7469 616c 697a 696e 6720 6c61 7965 7220  tializing layer 
+000030f0: 6269 6173 2077 6974 6820 6e6e 2e69 6e69  bias with nn.ini
+00003100: 7420 6769 7665 7320 6d79 7079 2074 7970  t gives mypy typ
+00003110: 6563 6865 636b 2065 7272 6f72 0a20 2020  echeck error.   
+00003120: 2020 2020 2020 2020 2023 2075 7369 6e67           # using
+00003130: 2074 6865 2066 6f6c 6c6f 7769 6e67 2077   the following w
+00003140: 6f72 6b61 726f 756e 640a 2020 2020 2020  orkaround.      
+00003150: 2020 2020 2020 6966 206c 6179 6572 2e62        if layer.b
+00003160: 6961 7320 6973 206e 6f74 204e 6f6e 653a  ias is not None:
+00003170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003180: 206c 6179 6572 2e62 6961 7320 3d20 6e6e   layer.bias = nn
+00003190: 2e50 6172 616d 6574 6572 280a 2020 2020  .Parameter(.    
+000031a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000031b0: 746f 7263 682e 6675 6c6c 286c 6179 6572  torch.full(layer
+000031c0: 2e62 6961 732e 7368 6170 652c 2062 6961  .bias.shape, bia
+000031d0: 735f 636f 6e73 7429 290a 0a20 2020 2020  s_const))..     
+000031e0: 2020 2020 2020 2073 656c 662e 6c61 7965         self.laye
+000031f0: 7273 2e61 7070 656e 6428 6c61 7965 7229  rs.append(layer)
+00003200: 0a0a 2020 2020 2020 2020 2020 2020 696e  ..            in
+00003210: 5f73 6861 7065 203d 206f 7574 5f73 6861  _shape = out_sha
+00003220: 7065 0a0a 2020 2020 2020 2020 7365 6c66  pe..        self
+00003230: 2e63 6c61 7373 6966 6965 725f 6666 6e20  .classifier_ffn 
+00003240: 3d20 6e6e 2e4c 617a 794c 696e 6561 7228  = nn.LazyLinear(
+00003250: 7365 6c66 2e6e 5f74 6173 6b73 202a 2073  self.n_tasks * s
+00003260: 656c 662e 6e5f 636c 6173 7365 7329 0a20  elf.n_classes). 
+00003270: 2020 2020 2020 2073 656c 662e 6f75 7470         self.outp
+00003280: 7574 5f6c 6179 6572 203d 206e 6e2e 4c61  ut_layer = nn.La
+00003290: 7a79 4c69 6e65 6172 2873 656c 662e 6e5f  zyLinear(self.n_
+000032a0: 7461 736b 7329 0a20 2020 2020 2020 2073  tasks).        s
+000032b0: 656c 662e 756e 6365 7274 6169 6e74 795f  elf.uncertainty_
+000032c0: 6c61 7965 7220 3d20 6e6e 2e4c 617a 794c  layer = nn.LazyL
+000032d0: 696e 6561 7228 7365 6c66 2e6e 5f74 6173  inear(self.n_tas
+000032e0: 6b73 290a 0a20 2020 2064 6566 2066 6f72  ks)..    def for
+000032f0: 7761 7264 2873 656c 662c 2069 6e70 7574  ward(self, input
+00003300: 733a 204f 6e65 4f72 4d61 6e79 5b74 6f72  s: OneOrMany[tor
+00003310: 6368 2e54 656e 736f 725d 2920 2d3e 204c  ch.Tensor]) -> L
+00003320: 6973 745b 416e 795d 3a0a 2020 2020 2020  ist[Any]:.      
+00003330: 2020 2222 220a 2020 2020 2020 2020 5061    """.        Pa
+00003340: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+00003350: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00003360: 2020 2020 783a 2074 6f72 6368 2e54 656e      x: torch.Ten
+00003370: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
+00003380: 496e 7075 7420 5465 6e73 6f72 0a20 2020  Input Tensor.   
+00003390: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
+000033a0: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
+000033b0: 2020 2020 2074 6f72 6368 2e54 656e 736f       torch.Tenso
+000033c0: 720a 2020 2020 2020 2020 2020 2020 4f75  r.            Ou
+000033d0: 7470 7574 2061 7320 7065 7220 7573 6520  tput as per use 
+000033e0: 6361 7365 203a 2072 6567 7265 7373 696f  case : regressio
+000033f0: 6e2f 636c 6173 7369 6669 6361 7469 6f6e  n/classification
+00003400: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00003410: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+00003420: 6365 2869 6e70 7574 732c 2074 6f72 6368  ce(inputs, torch
+00003430: 2e54 656e 736f 7229 3a0a 2020 2020 2020  .Tensor):.      
+00003440: 2020 2020 2020 782c 2064 726f 706f 7574        x, dropout
+00003450: 5f73 7769 7463 6820 3d20 696e 7075 7473  _switch = inputs
+00003460: 2c20 4e6f 6e65 0a20 2020 2020 2020 2065  , None.        e
+00003470: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00003480: 2078 2c20 6472 6f70 6f75 745f 7377 6974   x, dropout_swit
+00003490: 6368 203d 2069 6e70 7574 730a 0a20 2020  ch = inputs..   
+000034a0: 2020 2020 2078 203d 2074 6f72 6368 2e74       x = torch.t
+000034b0: 7261 6e73 706f 7365 2878 2c20 312c 202d  ranspose(x, 1, -
+000034c0: 3129 2020 2320 6e20 6820 7720 6320 2d3e  1)  # n h w c ->
+000034d0: 206e 2063 2068 2077 0a0a 2020 2020 2020   n c h w..      
+000034e0: 2020 7072 6576 5f6c 6179 6572 203d 2078    prev_layer = x
+000034f0: 0a0a 2020 2020 2020 2020 666f 7220 6c61  ..        for la
+00003500: 7965 722c 2061 6374 6976 6174 696f 6e5f  yer, activation_
+00003510: 666e 2c20 6472 6f70 6f75 7420 696e 207a  fn, dropout in z
+00003520: 6970 2873 656c 662e 6c61 7965 7273 2c0a  ip(self.layers,.
 00003530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003540: 7820 3d20 6163 7469 7661 7469 6f6e 5f66  x = activation_f
-00003550: 6e28 7829 0a0a 2020 2020 2020 2020 2020  n(x)..          
-00003560: 2020 7072 6576 5f6c 6179 6572 203d 2078    prev_layer = x
-00003570: 0a0a 2020 2020 2020 2020 7820 3d20 7365  ..        x = se
-00003580: 6c66 2e50 6f6f 6c4c 6179 6572 2878 2c20  lf.PoolLayer(x, 
-00003590: 6b65 726e 656c 5f73 697a 653d 782e 7369  kernel_size=x.si
-000035a0: 7a65 2829 5b32 3a5d 290a 0a20 2020 2020  ze()[2:])..     
-000035b0: 2020 206f 7574 7075 7473 203d 205b 5d0a     outputs = [].
-000035c0: 2020 2020 2020 2020 6261 7463 685f 7369          batch_si
-000035d0: 7a65 203d 2078 2e73 6861 7065 5b30 5d0a  ze = x.shape[0].
-000035e0: 0a20 2020 2020 2020 2078 203d 2074 6f72  .        x = tor
-000035f0: 6368 2e72 6573 6861 7065 2878 2c20 2862  ch.reshape(x, (b
-00003600: 6174 6368 5f73 697a 652c 202d 3129 290a  atch_size, -1)).
-00003610: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00003620: 2e6d 6f64 6520 3d3d 2022 636c 6173 7369  .mode == "classi
-00003630: 6669 6361 7469 6f6e 223a 0a0a 2020 2020  fication":..    
-00003640: 2020 2020 2020 2020 6c6f 6769 7473 203d          logits =
-00003650: 2073 656c 662e 636c 6173 7369 6669 6572   self.classifier
-00003660: 5f66 666e 2878 290a 2020 2020 2020 2020  _ffn(x).        
-00003670: 2020 2020 6c6f 6769 7473 203d 206c 6f67      logits = log
-00003680: 6974 732e 7669 6577 2862 6174 6368 5f73  its.view(batch_s
-00003690: 697a 652c 2073 656c 662e 6e5f 7461 736b  ize, self.n_task
-000036a0: 732c 2073 656c 662e 6e5f 636c 6173 7365  s, self.n_classe
-000036b0: 7329 0a20 2020 2020 2020 2020 2020 206f  s).            o
-000036c0: 7574 7075 7420 3d20 462e 736f 6674 6d61  utput = F.softma
-000036d0: 7828 6c6f 6769 7473 2c20 6469 6d3d 3229  x(logits, dim=2)
-000036e0: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-000036f0: 7075 7473 203d 205b 6f75 7470 7574 2c20  puts = [output, 
-00003700: 6c6f 6769 7473 5d0a 0a20 2020 2020 2020  logits]..       
-00003710: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00003720: 2020 206f 7574 7075 7420 3d20 7365 6c66     output = self
-00003730: 2e6f 7574 7075 745f 6c61 7965 7228 7829  .output_layer(x)
-00003740: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-00003750: 7075 7420 3d20 6f75 7470 7574 2e76 6965  put = output.vie
-00003760: 7728 6261 7463 685f 7369 7a65 2c20 7365  w(batch_size, se
-00003770: 6c66 2e6e 5f74 6173 6b73 290a 0a20 2020  lf.n_tasks)..   
-00003780: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00003790: 2e75 6e63 6572 7461 696e 7479 3a0a 2020  .uncertainty:.  
-000037a0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-000037b0: 675f 7661 7220 3d20 7365 6c66 2e75 6e63  g_var = self.unc
-000037c0: 6572 7461 696e 7479 5f6c 6179 6572 2878  ertainty_layer(x
-000037d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000037e0: 2020 6c6f 675f 7661 7220 3d20 6c6f 675f    log_var = log_
-000037f0: 7661 722e 7669 6577 2862 6174 6368 5f73  var.view(batch_s
-00003800: 697a 652c 2073 656c 662e 6e5f 7461 736b  ize, self.n_task
-00003810: 732c 2031 290a 2020 2020 2020 2020 2020  s, 1).          
-00003820: 2020 2020 2020 7661 7220 3d20 746f 7263        var = torc
-00003830: 682e 6578 7028 6c6f 675f 7661 7229 0a20  h.exp(log_var). 
-00003840: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00003850: 7574 7075 7473 203d 205b 6f75 7470 7574  utputs = [output
-00003860: 2c20 7661 722c 206f 7574 7075 742c 206c  , var, output, l
-00003870: 6f67 5f76 6172 5d0a 2020 2020 2020 2020  og_var].        
-00003880: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00003890: 2020 2020 2020 2020 2020 6f75 7470 7574            output
-000038a0: 7320 3d20 5b6f 7574 7075 745d 0a0a 2020  s = [output]..  
-000038b0: 2020 2020 2020 7265 7475 726e 206f 7574        return out
-000038c0: 7075 7473 0a0a 0a63 6c61 7373 2053 6361  puts...class Sca
-000038d0: 6c65 4e6f 726d 286e 6e2e 4d6f 6475 6c65  leNorm(nn.Module
-000038e0: 293a 0a20 2020 2022 2222 4170 706c 7920  ):.    """Apply 
-000038f0: 5363 616c 6520 4e6f 726d 616c 697a 6174  Scale Normalizat
-00003900: 696f 6e20 746f 2069 6e70 7574 2e0a 0a20  ion to input... 
-00003910: 2020 2054 6865 2053 6361 6c65 4e6f 726d     The ScaleNorm
-00003920: 206c 6179 6572 2066 6972 7374 2063 6f6d   layer first com
-00003930: 7075 7465 7320 7468 6520 7371 7561 7265  putes the square
-00003940: 2072 6f6f 7420 6f66 2074 6865 2073 6361   root of the sca
-00003950: 6c65 2c20 7468 656e 2063 6f6d 7075 7465  le, then compute
-00003960: 7320 7468 6520 6d61 7472 6978 2f76 6563  s the matrix/vec
-00003970: 746f 7220 6e6f 726d 206f 6620 7468 6520  tor norm of the 
-00003980: 696e 7075 7420 7465 6e73 6f72 2e0a 2020  input tensor..  
-00003990: 2020 5468 6520 6e6f 726d 2076 616c 7565    The norm value
-000039a0: 2069 7320 6361 6c63 756c 6174 6564 2061   is calculated a
-000039b0: 7320 6073 7172 7428 7363 616c 6529 202f  s `sqrt(scale) /
-000039c0: 206d 6174 7269 7820 6e6f 726d 602e 0a20   matrix norm`.. 
-000039d0: 2020 2046 696e 616c 6c79 2c20 7468 6520     Finally, the 
-000039e0: 7265 7375 6c74 2069 7320 7265 7475 726e  result is return
-000039f0: 6564 2061 7320 6069 6e70 7574 5f74 656e  ed as `input_ten
-00003a00: 736f 7220 2a20 6e6f 726d 2076 616c 7565  sor * norm value
-00003a10: 602e 0a0a 2020 2020 5468 6973 206c 6179  `...    This lay
-00003a20: 6572 2063 616e 2062 6520 7573 6564 2069  er can be used i
-00003a30: 6e73 7465 6164 206f 6620 4c61 7965 724e  nstead of LayerN
-00003a40: 6f72 6d20 7768 656e 2061 2073 6361 6c65  orm when a scale
-00003a50: 6420 7665 7273 696f 6e20 6f66 2074 6865  d version of the
-00003a60: 206e 6f72 6d20 6973 2072 6571 7569 7265   norm is require
-00003a70: 642e 0a20 2020 2049 6e73 7465 6164 206f  d..    Instead o
-00003a80: 6620 7065 7266 6f72 6d69 6e67 2074 6865  f performing the
-00003a90: 2073 6361 6c69 6e67 206f 7065 7261 7469   scaling operati
-00003aa0: 6f6e 2028 6073 6361 6c65 202f 206e 6f72  on (`scale / nor
-00003ab0: 6d60 2920 696e 2061 206c 616d 6264 612d  m`) in a lambda-
-00003ac0: 6c69 6b65 206c 6179 6572 2c20 7765 2061  like layer, we a
-00003ad0: 7265 2064 6566 696e 696e 6720 6974 2077  re defining it w
-00003ae0: 6974 6869 6e20 7468 6973 206c 6179 6572  ithin this layer
-00003af0: 2074 6f20 6d61 6b65 2070 726f 746f 7479   to make prototy
-00003b00: 7069 6e67 206d 6f72 6520 6566 6669 6369  ping more effici
-00003b10: 656e 742e 0a0a 2020 2020 5265 6665 7265  ent...    Refere
-00003b20: 6e63 6573 0a20 2020 202d 2d2d 2d2d 2d2d  nces.    -------
-00003b30: 2d2d 2d0a 2020 2020 2e2e 205b 315d 204c  ---.    .. [1] L
-00003b40: 756b 6173 7a20 4d61 7a69 6172 6b61 2065  ukasz Maziarka e
-00003b50: 7420 616c 2e20 224d 6f6c 6563 756c 6520  t al. "Molecule 
-00003b60: 4174 7465 6e74 696f 6e20 5472 616e 7366  Attention Transf
-00003b70: 6f72 6d65 7222 2047 7261 7068 2052 6570  ormer" Graph Rep
-00003b80: 7265 7365 6e74 6174 696f 6e20 4c65 6172  resentation Lear
-00003b90: 6e69 6e67 2077 6f72 6b73 686f 7020 616e  ning workshop an
-00003ba0: 6420 4d61 6368 696e 6520 4c65 6172 6e69  d Machine Learni
-00003bb0: 6e67 2061 6e64 2074 6865 2050 6879 7369  ng and the Physi
-00003bc0: 6361 6c20 5363 6965 6e63 6573 2077 6f72  cal Sciences wor
-00003bd0: 6b73 686f 7020 6174 204e 6575 7249 5053  kshop at NeurIPS
-00003be0: 2032 3031 392e 2032 3032 302e 2068 7474   2019. 2020. htt
-00003bf0: 7073 3a2f 2f61 7278 6976 2e6f 7267 2f61  ps://arxiv.org/a
-00003c00: 6273 2f32 3030 322e 3038 3236 340a 0a20  bs/2002.08264.. 
-00003c10: 2020 2045 7861 6d70 6c65 730a 2020 2020     Examples.    
-00003c20: 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e 3e3e  --------.    >>>
-00003c30: 2066 726f 6d20 6465 6570 6368 656d 2e6d   from deepchem.m
-00003c40: 6f64 656c 732e 746f 7263 685f 6d6f 6465  odels.torch_mode
-00003c50: 6c73 2e6c 6179 6572 7320 696d 706f 7274  ls.layers import
-00003c60: 2053 6361 6c65 4e6f 726d 0a20 2020 203e   ScaleNorm.    >
-00003c70: 3e3e 2073 6361 6c65 203d 2030 2e33 350a  >> scale = 0.35.
-00003c80: 2020 2020 3e3e 3e20 6c61 7965 7220 3d20      >>> layer = 
-00003c90: 5363 616c 654e 6f72 6d28 7363 616c 6529  ScaleNorm(scale)
-00003ca0: 0a20 2020 203e 3e3e 2069 6e70 7574 5f74  .    >>> input_t
-00003cb0: 656e 736f 7220 3d20 746f 7263 682e 7465  ensor = torch.te
-00003cc0: 6e73 6f72 285b 5b31 2e32 3639 2c20 3339  nsor([[1.269, 39
-00003cd0: 2e33 365d 2c20 5b30 2e30 3039 3138 2c20  .36], [0.00918, 
-00003ce0: 2d39 2e31 325d 5d29 0a20 2020 203e 3e3e  -9.12]]).    >>>
-00003cf0: 206f 7574 7075 745f 7465 6e73 6f72 203d   output_tensor =
-00003d00: 206c 6179 6572 2869 6e70 7574 5f74 656e   layer(input_ten
-00003d10: 736f 7229 0a20 2020 2022 2222 0a0a 2020  sor).    """..  
-00003d20: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-00003d30: 656c 662c 2073 6361 6c65 3a20 666c 6f61  elf, scale: floa
-00003d40: 742c 2065 7073 3a20 666c 6f61 7420 3d20  t, eps: float = 
-00003d50: 3165 2d35 293a 0a20 2020 2020 2020 2022  1e-5):.        "
-00003d60: 2222 496e 6974 6961 6c69 7a65 2061 2053  ""Initialize a S
-00003d70: 6361 6c65 4e6f 726d 206c 6179 6572 2e0a  caleNorm layer..
-00003d80: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-00003d90: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-00003da0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2073  ------.        s
-00003db0: 6361 6c65 3a20 666c 6f61 740a 2020 2020  cale: float.    
-00003dc0: 2020 2020 2020 2020 5363 616c 6520 6d61          Scale ma
-00003dd0: 676e 6974 7564 652e 0a20 2020 2020 2020  gnitude..       
-00003de0: 2065 7073 3a20 666c 6f61 740a 2020 2020   eps: float.    
-00003df0: 2020 2020 2020 2020 4570 7369 6c6f 6e20          Epsilon 
-00003e00: 7661 6c75 652e 2044 6566 6175 6c74 203d  value. Default =
-00003e10: 2031 652d 352e 0a20 2020 2020 2020 2022   1e-5..        "
-00003e20: 2222 0a20 2020 2020 2020 2073 7570 6572  "".        super
-00003e30: 2853 6361 6c65 4e6f 726d 2c20 7365 6c66  (ScaleNorm, self
-00003e40: 292e 5f5f 696e 6974 5f5f 2829 0a20 2020  ).__init__().   
-00003e50: 2020 2020 2073 656c 662e 7363 616c 6520       self.scale 
-00003e60: 3d20 6e6e 2e50 6172 616d 6574 6572 2874  = nn.Parameter(t
-00003e70: 6f72 6368 2e74 656e 736f 7228 6d61 7468  orch.tensor(math
-00003e80: 2e73 7172 7428 7363 616c 6529 2929 0a20  .sqrt(scale))). 
-00003e90: 2020 2020 2020 2073 656c 662e 6570 7320         self.eps 
-00003ea0: 3d20 6570 730a 0a20 2020 2064 6566 2066  = eps..    def f
-00003eb0: 6f72 7761 7264 2873 656c 662c 2078 3a20  orward(self, x: 
-00003ec0: 746f 7263 682e 5465 6e73 6f72 2920 2d3e  torch.Tensor) ->
-00003ed0: 2074 6f72 6368 2e54 656e 736f 723a 0a20   torch.Tensor:. 
-00003ee0: 2020 2020 2020 206e 6f72 6d20 3d20 7365         norm = se
-00003ef0: 6c66 2e73 6361 6c65 202f 2074 6f72 6368  lf.scale / torch
-00003f00: 2e6e 6f72 6d28 782c 2064 696d 3d2d 312c  .norm(x, dim=-1,
-00003f10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003f30: 2020 2020 2020 2020 6b65 6570 6469 6d3d          keepdim=
-00003f40: 5472 7565 292e 636c 616d 7028 6d69 6e3d  True).clamp(min=
-00003f50: 7365 6c66 2e65 7073 290a 2020 2020 2020  self.eps).      
-00003f60: 2020 7265 7475 726e 2078 202a 206e 6f72    return x * nor
-00003f70: 6d0a 0a0a 636c 6173 7320 4d75 6c74 6948  m...class MultiH
-00003f80: 6561 6465 644d 4154 4174 7465 6e74 696f  eadedMATAttentio
-00003f90: 6e28 6e6e 2e4d 6f64 756c 6529 3a0a 2020  n(nn.Module):.  
-00003fa0: 2020 2222 2246 6972 7374 2063 6f6e 7374    """First const
-00003fb0: 7275 6374 7320 616e 2061 7474 656e 7469  ructs an attenti
-00003fc0: 6f6e 206c 6179 6572 2074 6169 6c6f 7265  on layer tailore
-00003fd0: 6420 746f 2074 6865 204d 6f6c 6563 756c  d to the Molecul
-00003fe0: 6172 2041 7474 656e 7469 6f6e 2054 7261  ar Attention Tra
-00003ff0: 6e73 666f 726d 6572 205b 315d 5f20 616e  nsformer [1]_ an
-00004000: 6420 7468 656e 2063 6f6e 7665 7274 7320  d then converts 
-00004010: 6974 2069 6e74 6f20 4d75 6c74 692d 4865  it into Multi-He
-00004020: 6164 6564 2041 7474 656e 7469 6f6e 2e0a  aded Attention..
-00004030: 0a20 2020 2049 6e20 4d75 6c74 692d 4865  .    In Multi-He
-00004040: 6164 6564 2061 7474 656e 7469 6f6e 2074  aded attention t
-00004050: 6865 2061 7474 656e 7469 6f6e 206d 6563  he attention mec
-00004060: 6861 6e69 736d 206d 756c 7469 706c 6520  hanism multiple 
-00004070: 7469 6d65 7320 7061 7261 6c6c 656c 7920  times parallely 
-00004080: 7468 726f 7567 6820 7468 6520 6d75 6c74  through the mult
-00004090: 6970 6c65 2061 7474 656e 7469 6f6e 2068  iple attention h
-000040a0: 6561 6473 2e0a 2020 2020 5468 7573 2c20  eads..    Thus, 
-000040b0: 6469 6666 6572 656e 7420 7375 6273 6571  different subseq
-000040c0: 7565 6e63 6573 206f 6620 6120 6769 7665  uences of a give
-000040d0: 6e20 7365 7175 656e 6365 7320 6361 6e20  n sequences can 
-000040e0: 6265 2070 726f 6365 7373 6564 2064 6966  be processed dif
-000040f0: 6665 7265 6e74 6c79 2e0a 2020 2020 5468  ferently..    Th
-00004100: 6520 7175 6572 792c 206b 6579 2061 6e64  e query, key and
-00004110: 2076 616c 7565 2070 6172 616d 6574 6572   value parameter
-00004120: 7320 6172 6520 7370 6c69 7420 6d75 6c74  s are split mult
-00004130: 6970 6c65 2077 6179 7320 616e 6420 6561  iple ways and ea
-00004140: 6368 2073 706c 6974 2069 7320 7061 7373  ch split is pass
-00004150: 6564 2073 6570 6172 6174 656c 7920 7468  ed separately th
-00004160: 726f 7567 6820 6120 6469 6666 6572 656e  rough a differen
-00004170: 7420 6174 7465 6e74 696f 6e20 6865 6164  t attention head
-00004180: 2e0a 2020 2020 5265 6665 7265 6e63 6573  ..    References
-00004190: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
-000041a0: 2020 2020 2e2e 205b 315d 204c 756b 6173      .. [1] Lukas
-000041b0: 7a20 4d61 7a69 6172 6b61 2065 7420 616c  z Maziarka et al
-000041c0: 2e20 224d 6f6c 6563 756c 6520 4174 7465  . "Molecule Atte
-000041d0: 6e74 696f 6e20 5472 616e 7366 6f72 6d65  ntion Transforme
-000041e0: 7222 2047 7261 7068 2052 6570 7265 7365  r" Graph Represe
-000041f0: 6e74 6174 696f 6e20 4c65 6172 6e69 6e67  ntation Learning
-00004200: 2077 6f72 6b73 686f 7020 616e 6420 4d61   workshop and Ma
-00004210: 6368 696e 6520 4c65 6172 6e69 6e67 2061  chine Learning a
-00004220: 6e64 2074 6865 2050 6879 7369 6361 6c20  nd the Physical 
-00004230: 5363 6965 6e63 6573 2077 6f72 6b73 686f  Sciences worksho
-00004240: 7020 6174 204e 6575 7249 5053 2032 3031  p at NeurIPS 201
-00004250: 392e 2032 3032 302e 2068 7474 7073 3a2f  9. 2020. https:/
-00004260: 2f61 7278 6976 2e6f 7267 2f61 6273 2f32  /arxiv.org/abs/2
-00004270: 3030 322e 3038 3236 340a 2020 2020 4578  002.08264.    Ex
-00004280: 616d 706c 6573 0a20 2020 202d 2d2d 2d2d  amples.    -----
-00004290: 2d2d 2d0a 2020 2020 3e3e 3e20 6672 6f6d  ---.    >>> from
-000042a0: 2064 6565 7063 6865 6d2e 6d6f 6465 6c73   deepchem.models
-000042b0: 2e74 6f72 6368 5f6d 6f64 656c 732e 6c61  .torch_models.la
-000042c0: 7965 7273 2069 6d70 6f72 7420 4d75 6c74  yers import Mult
-000042d0: 6948 6561 6465 644d 4154 4174 7465 6e74  iHeadedMATAttent
-000042e0: 696f 6e2c 204d 4154 456d 6265 6464 696e  ion, MATEmbeddin
-000042f0: 670a 2020 2020 3e3e 3e20 696d 706f 7274  g.    >>> import
-00004300: 2064 6565 7063 6865 6d20 6173 2064 630a   deepchem as dc.
-00004310: 2020 2020 3e3e 3e20 696d 706f 7274 2074      >>> import t
-00004320: 6f72 6368 0a20 2020 203e 3e3e 2069 6e70  orch.    >>> inp
-00004330: 7574 5f73 6d69 6c65 203d 2022 4343 220a  ut_smile = "CC".
-00004340: 2020 2020 3e3e 3e20 6665 6174 203d 2064      >>> feat = d
-00004350: 632e 6665 6174 2e4d 4154 4665 6174 7572  c.feat.MATFeatur
-00004360: 697a 6572 2829 0a20 2020 203e 3e3e 2069  izer().    >>> i
-00004370: 6e70 7574 5f73 6d69 6c65 203d 2022 4343  nput_smile = "CC
-00004380: 220a 2020 2020 3e3e 3e20 6f75 7420 3d20  ".    >>> out = 
-00004390: 6665 6174 2e66 6561 7475 7269 7a65 2869  feat.featurize(i
-000043a0: 6e70 7574 5f73 6d69 6c65 290a 2020 2020  nput_smile).    
-000043b0: 3e3e 3e20 6e6f 6465 203d 2074 6f72 6368  >>> node = torch
-000043c0: 2e74 656e 736f 7228 6f75 745b 305d 2e6e  .tensor(out[0].n
-000043d0: 6f64 655f 6665 6174 7572 6573 292e 666c  ode_features).fl
-000043e0: 6f61 7428 292e 756e 7371 7565 657a 6528  oat().unsqueeze(
-000043f0: 3029 0a20 2020 203e 3e3e 2061 646a 203d  0).    >>> adj =
-00004400: 2074 6f72 6368 2e74 656e 736f 7228 6f75   torch.tensor(ou
-00004410: 745b 305d 2e61 646a 6163 656e 6379 5f6d  t[0].adjacency_m
-00004420: 6174 7269 7829 2e66 6c6f 6174 2829 2e75  atrix).float().u
-00004430: 6e73 7175 6565 7a65 2830 290a 2020 2020  nsqueeze(0).    
-00004440: 3e3e 3e20 6469 7374 203d 2074 6f72 6368  >>> dist = torch
-00004450: 2e74 656e 736f 7228 6f75 745b 305d 2e64  .tensor(out[0].d
-00004460: 6973 7461 6e63 655f 6d61 7472 6978 292e  istance_matrix).
-00004470: 666c 6f61 7428 292e 756e 7371 7565 657a  float().unsqueez
-00004480: 6528 3029 0a20 2020 203e 3e3e 206d 6173  e(0).    >>> mas
-00004490: 6b20 3d20 746f 7263 682e 7375 6d28 746f  k = torch.sum(to
-000044a0: 7263 682e 6162 7328 6e6f 6465 292c 2064  rch.abs(node), d
-000044b0: 696d 3d2d 3129 2021 3d20 300a 2020 2020  im=-1) != 0.    
-000044c0: 3e3e 3e20 6c61 7965 7220 3d20 4d75 6c74  >>> layer = Mult
-000044d0: 6948 6561 6465 644d 4154 4174 7465 6e74  iHeadedMATAttent
-000044e0: 696f 6e28 0a20 2020 202e 2e2e 2020 2020  ion(.    ...    
-000044f0: 6469 7374 5f6b 6572 6e65 6c3d 2773 6f66  dist_kernel='sof
-00004500: 746d 6178 272c 0a20 2020 202e 2e2e 2020  tmax',.    ...  
-00004510: 2020 6c61 6d62 6461 5f61 7474 656e 7469    lambda_attenti
-00004520: 6f6e 3d30 2e33 332c 0a20 2020 202e 2e2e  on=0.33,.    ...
-00004530: 2020 2020 6c61 6d62 6461 5f64 6973 7461      lambda_dista
-00004540: 6e63 653d 302e 3333 2c0a 2020 2020 2e2e  nce=0.33,.    ..
-00004550: 2e20 2020 2068 3d31 362c 0a20 2020 202e  .    h=16,.    .
-00004560: 2e2e 2020 2020 6873 697a 653d 3130 3234  ..    hsize=1024
-00004570: 2c0a 2020 2020 2e2e 2e20 2020 2064 726f  ,.    ...    dro
-00004580: 706f 7574 5f70 3d30 2e30 290a 2020 2020  pout_p=0.0).    
-00004590: 3e3e 3e20 6f70 203d 204d 4154 456d 6265  >>> op = MATEmbe
-000045a0: 6464 696e 6728 2928 6e6f 6465 290a 2020  dding()(node).  
-000045b0: 2020 3e3e 3e20 6f75 7470 7574 203d 206c    >>> output = l
-000045c0: 6179 6572 286f 702c 206f 702c 206f 702c  ayer(op, op, op,
-000045d0: 206d 6173 6b2c 2061 646a 2c20 6469 7374   mask, adj, dist
-000045e0: 290a 2020 2020 2222 220a 0a20 2020 2064  ).    """..    d
-000045f0: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-00004600: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00004610: 2020 2064 6973 745f 6b65 726e 656c 3a20     dist_kernel: 
-00004620: 7374 7220 3d20 2773 6f66 746d 6178 272c  str = 'softmax',
-00004630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004640: 2020 6c61 6d62 6461 5f61 7474 656e 7469    lambda_attenti
-00004650: 6f6e 3a20 666c 6f61 7420 3d20 302e 3333  on: float = 0.33
-00004660: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00004670: 2020 206c 616d 6264 615f 6469 7374 616e     lambda_distan
-00004680: 6365 3a20 666c 6f61 7420 3d20 302e 3333  ce: float = 0.33
-00004690: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000046a0: 2020 2068 3a20 696e 7420 3d20 3136 2c0a     h: int = 16,.
-000046b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000046c0: 2068 7369 7a65 3a20 696e 7420 3d20 3130   hsize: int = 10
-000046d0: 3234 2c0a 2020 2020 2020 2020 2020 2020  24,.            
-000046e0: 2020 2020 2064 726f 706f 7574 5f70 3a20       dropout_p: 
-000046f0: 666c 6f61 7420 3d20 302e 302c 0a20 2020  float = 0.0,.   
-00004700: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
-00004710: 7470 7574 5f62 6961 733a 2062 6f6f 6c20  tput_bias: bool 
-00004720: 3d20 5472 7565 293a 0a20 2020 2020 2020  = True):.       
-00004730: 2022 2222 496e 6974 6961 6c69 7a65 2061   """Initialize a
-00004740: 206d 756c 7469 2d68 6561 6465 6420 6174   multi-headed at
-00004750: 7465 6e74 696f 6e20 6c61 7965 722e 0a20  tention layer.. 
-00004760: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-00004770: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00004780: 2d2d 2d2d 0a20 2020 2020 2020 2064 6973  ----.        dis
-00004790: 745f 6b65 726e 656c 3a20 7374 720a 2020  t_kernel: str.  
-000047a0: 2020 2020 2020 2020 2020 4b65 726e 656c            Kernel
-000047b0: 2061 6374 6976 6174 696f 6e20 746f 2062   activation to b
-000047c0: 6520 7573 6564 2e20 4361 6e20 6265 2065  e used. Can be e
-000047d0: 6974 6865 7220 2773 6f66 746d 6178 2720  ither 'softmax' 
-000047e0: 666f 7220 736f 6674 6d61 7820 6f72 2027  for softmax or '
-000047f0: 6578 7027 2066 6f72 2065 7870 6f6e 656e  exp' for exponen
-00004800: 7469 616c 2e0a 2020 2020 2020 2020 6c61  tial..        la
-00004810: 6d62 6461 5f61 7474 656e 7469 6f6e 3a20  mbda_attention: 
-00004820: 666c 6f61 740a 2020 2020 2020 2020 2020  float.          
-00004830: 2020 436f 6e73 7461 6e74 2074 6f20 6265    Constant to be
-00004840: 206d 756c 7469 706c 6965 6420 7769 7468   multiplied with
-00004850: 2074 6865 2061 7474 656e 7469 6f6e 206d   the attention m
-00004860: 6174 7269 782e 0a20 2020 2020 2020 206c  atrix..        l
-00004870: 616d 6264 615f 6469 7374 616e 6365 3a20  ambda_distance: 
-00004880: 666c 6f61 740a 2020 2020 2020 2020 2020  float.          
-00004890: 2020 436f 6e73 7461 6e74 2074 6f20 6265    Constant to be
-000048a0: 206d 756c 7469 706c 6965 6420 7769 7468   multiplied with
-000048b0: 2074 6865 2064 6973 7461 6e63 6520 6d61   the distance ma
-000048c0: 7472 6978 2e0a 2020 2020 2020 2020 683a  trix..        h:
-000048d0: 2069 6e74 0a20 2020 2020 2020 2020 2020   int.           
-000048e0: 204e 756d 6265 7220 6f66 2061 7474 656e   Number of atten
-000048f0: 7469 6f6e 2068 6561 6473 2e0a 2020 2020  tion heads..    
-00004900: 2020 2020 6873 697a 653a 2069 6e74 0a20      hsize: int. 
-00004910: 2020 2020 2020 2020 2020 2053 697a 6520             Size 
-00004920: 6f66 2064 656e 7365 206c 6179 6572 2e0a  of dense layer..
-00004930: 2020 2020 2020 2020 6472 6f70 6f75 745f          dropout_
-00004940: 703a 2066 6c6f 6174 0a20 2020 2020 2020  p: float.       
-00004950: 2020 2020 2044 726f 706f 7574 2070 726f       Dropout pro
-00004960: 6261 6269 6c69 7479 2e0a 2020 2020 2020  bability..      
-00004970: 2020 6f75 7470 7574 5f62 6961 733a 2062    output_bias: b
-00004980: 6f6f 6c0a 2020 2020 2020 2020 2020 2020  ool.            
-00004990: 4966 2054 7275 652c 2064 656e 7365 206c  If True, dense l
-000049a0: 6179 6572 7320 7769 6c6c 2075 7365 2062  ayers will use b
-000049b0: 6961 7320 7665 6374 6f72 732e 0a20 2020  ias vectors..   
-000049c0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000049d0: 2073 7570 6572 2829 2e5f 5f69 6e69 745f   super().__init_
-000049e0: 5f28 290a 2020 2020 2020 2020 6966 2064  _().        if d
-000049f0: 6973 745f 6b65 726e 656c 203d 3d20 2273  ist_kernel == "s
-00004a00: 6f66 746d 6178 223a 0a20 2020 2020 2020  oftmax":.       
-00004a10: 2020 2020 2073 656c 662e 6469 7374 5f6b       self.dist_k
-00004a20: 6572 6e65 6c20 3d20 6c61 6d62 6461 2078  ernel = lambda x
-00004a30: 3a20 746f 7263 682e 736f 6674 6d61 7828  : torch.softmax(
-00004a40: 2d78 2c20 6469 6d3d 2d31 290a 2020 2020  -x, dim=-1).    
-00004a50: 2020 2020 656c 6966 2064 6973 745f 6b65      elif dist_ke
-00004a60: 726e 656c 203d 3d20 2265 7870 223a 0a20  rnel == "exp":. 
-00004a70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00004a80: 6469 7374 5f6b 6572 6e65 6c20 3d20 6c61  dist_kernel = la
-00004a90: 6d62 6461 2078 3a20 746f 7263 682e 6578  mbda x: torch.ex
-00004aa0: 7028 2d78 290a 2020 2020 2020 2020 7365  p(-x).        se
-00004ab0: 6c66 2e6c 616d 6264 615f 6174 7465 6e74  lf.lambda_attent
-00004ac0: 696f 6e20 3d20 6c61 6d62 6461 5f61 7474  ion = lambda_att
-00004ad0: 656e 7469 6f6e 0a20 2020 2020 2020 2073  ention.        s
-00004ae0: 656c 662e 6c61 6d62 6461 5f64 6973 7461  elf.lambda_dista
-00004af0: 6e63 6520 3d20 6c61 6d62 6461 5f64 6973  nce = lambda_dis
-00004b00: 7461 6e63 650a 2020 2020 2020 2020 7365  tance.        se
-00004b10: 6c66 2e6c 616d 6264 615f 6164 6a61 6365  lf.lambda_adjace
-00004b20: 6e63 7920 3d20 312e 3020 2d20 7365 6c66  ncy = 1.0 - self
-00004b30: 2e6c 616d 6264 615f 6174 7465 6e74 696f  .lambda_attentio
-00004b40: 6e20 2d20 7365 6c66 2e6c 616d 6264 615f  n - self.lambda_
-00004b50: 6469 7374 616e 6365 0a20 2020 2020 2020  distance.       
-00004b60: 2073 656c 662e 645f 6b20 3d20 6873 697a   self.d_k = hsiz
-00004b70: 6520 2f2f 2068 0a20 2020 2020 2020 2073  e // h.        s
-00004b80: 656c 662e 6820 3d20 680a 2020 2020 2020  elf.h = h.      
-00004b90: 2020 6c69 6e65 6172 5f6c 6179 6572 203d    linear_layer =
-00004ba0: 206e 6e2e 4c69 6e65 6172 2868 7369 7a65   nn.Linear(hsize
-00004bb0: 2c20 6873 697a 6529 0a20 2020 2020 2020  , hsize).       
-00004bc0: 2073 656c 662e 6c69 6e65 6172 5f6c 6179   self.linear_lay
-00004bd0: 6572 7320 3d20 6e6e 2e4d 6f64 756c 654c  ers = nn.ModuleL
-00004be0: 6973 7428 5b6c 696e 6561 725f 6c61 7965  ist([linear_laye
-00004bf0: 7220 666f 7220 5f20 696e 2072 616e 6765  r for _ in range
-00004c00: 2833 295d 290a 2020 2020 2020 2020 7365  (3)]).        se
-00004c10: 6c66 2e64 726f 706f 7574 5f70 203d 206e  lf.dropout_p = n
-00004c20: 6e2e 4472 6f70 6f75 7428 6472 6f70 6f75  n.Dropout(dropou
-00004c30: 745f 7029 0a20 2020 2020 2020 2073 656c  t_p).        sel
-00004c40: 662e 6f75 7470 7574 5f6c 696e 6561 7220  f.output_linear 
-00004c50: 3d20 6e6e 2e4c 696e 6561 7228 6873 697a  = nn.Linear(hsiz
-00004c60: 652c 2068 7369 7a65 2c20 6f75 7470 7574  e, hsize, output
-00004c70: 5f62 6961 7329 0a0a 2020 2020 6465 6620  _bias)..    def 
-00004c80: 5f73 696e 676c 655f 6174 7465 6e74 696f  _single_attentio
-00004c90: 6e28 0a20 2020 2020 2020 2020 2020 2073  n(.            s
-00004ca0: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
-00004cb0: 2071 7565 7279 3a20 746f 7263 682e 5465   query: torch.Te
-00004cc0: 6e73 6f72 2c0a 2020 2020 2020 2020 2020  nsor,.          
-00004cd0: 2020 6b65 793a 2074 6f72 6368 2e54 656e    key: torch.Ten
-00004ce0: 736f 722c 0a20 2020 2020 2020 2020 2020  sor,.           
-00004cf0: 2076 616c 7565 3a20 746f 7263 682e 5465   value: torch.Te
-00004d00: 6e73 6f72 2c0a 2020 2020 2020 2020 2020  nsor,.          
-00004d10: 2020 6d61 736b 3a20 746f 7263 682e 5465    mask: torch.Te
-00004d20: 6e73 6f72 2c0a 2020 2020 2020 2020 2020  nsor,.          
-00004d30: 2020 6164 6a5f 6d61 7472 6978 3a20 746f    adj_matrix: to
-00004d40: 7263 682e 5465 6e73 6f72 2c0a 2020 2020  rch.Tensor,.    
-00004d50: 2020 2020 2020 2020 6469 7374 616e 6365          distance
-00004d60: 5f6d 6174 7269 783a 2074 6f72 6368 2e54  _matrix: torch.T
-00004d70: 656e 736f 722c 0a20 2020 2020 2020 2020  ensor,.         
-00004d80: 2020 2064 726f 706f 7574 5f70 3a20 666c     dropout_p: fl
-00004d90: 6f61 7420 3d20 302e 302c 0a20 2020 2020  oat = 0.0,.     
-00004da0: 2020 2020 2020 2065 7073 3a20 666c 6f61         eps: floa
-00004db0: 7420 3d20 3165 2d36 2c0a 2020 2020 2020  t = 1e-6,.      
-00004dc0: 2020 2020 2020 696e 663a 2066 6c6f 6174        inf: float
-00004dd0: 203d 2031 6531 3229 202d 3e20 5475 706c   = 1e12) -> Tupl
-00004de0: 655b 746f 7263 682e 5465 6e73 6f72 2c20  e[torch.Tensor, 
-00004df0: 746f 7263 682e 5465 6e73 6f72 5d3a 0a20  torch.Tensor]:. 
-00004e00: 2020 2020 2020 2022 2222 4465 6669 6e69         """Defini
-00004e10: 6e67 2061 6e64 2063 6f6d 7075 7469 6e67  ng and computing
-00004e20: 206f 7574 7075 7420 666f 7220 6120 7369   output for a si
-00004e30: 6e67 6c65 204d 4154 2061 7474 656e 7469  ngle MAT attenti
-00004e40: 6f6e 206c 6179 6572 2e0a 2020 2020 2020  on layer..      
-00004e50: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00004e60: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-00004e70: 2020 2020 2020 2020 7175 6572 793a 2074          query: t
-00004e80: 6f72 6368 2e54 656e 736f 720a 2020 2020  orch.Tensor.    
-00004e90: 2020 2020 2020 2020 5374 616e 6461 7264          Standard
-00004ea0: 2071 7565 7279 2070 6172 616d 6574 6572   query parameter
-00004eb0: 2066 6f72 2061 7474 656e 7469 6f6e 2e0a   for attention..
-00004ec0: 2020 2020 2020 2020 6b65 793a 2074 6f72          key: tor
-00004ed0: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
-00004ee0: 2020 2020 2020 5374 616e 6461 7264 206b        Standard k
-00004ef0: 6579 2070 6172 616d 6574 6572 2066 6f72  ey parameter for
-00004f00: 2061 7474 656e 7469 6f6e 2e0a 2020 2020   attention..    
-00004f10: 2020 2020 7661 6c75 653a 2074 6f72 6368      value: torch
-00004f20: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
-00004f30: 2020 2020 5374 616e 6461 7264 2076 616c      Standard val
-00004f40: 7565 2070 6172 616d 6574 6572 2066 6f72  ue parameter for
-00004f50: 2061 7474 656e 7469 6f6e 2e0a 2020 2020   attention..    
-00004f60: 2020 2020 6d61 736b 3a20 746f 7263 682e      mask: torch.
-00004f70: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
-00004f80: 2020 204d 6173 6b73 206f 7574 2070 6164     Masks out pad
-00004f90: 6469 6e67 2076 616c 7565 7320 736f 2074  ding values so t
-00004fa0: 6861 7420 7468 6579 2061 7265 206e 6f74  hat they are not
-00004fb0: 2074 616b 656e 2069 6e74 6f20 6163 636f   taken into acco
-00004fc0: 756e 7420 7768 656e 2063 6f6d 7075 7469  unt when computi
-00004fd0: 6e67 2074 6865 2061 7474 656e 7469 6f6e  ng the attention
-00004fe0: 2073 636f 7265 2e0a 2020 2020 2020 2020   score..        
-00004ff0: 6164 6a5f 6d61 7472 6978 3a20 746f 7263  adj_matrix: torc
-00005000: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
-00005010: 2020 2020 2041 646a 6163 656e 6379 206d       Adjacency m
-00005020: 6174 7269 7820 6f66 2074 6865 2069 6e70  atrix of the inp
-00005030: 7574 206d 6f6c 6563 756c 652c 2072 6574  ut molecule, ret
-00005040: 7572 6e65 6420 6672 6f6d 2064 632e 6665  urned from dc.fe
-00005050: 6174 2e4d 4154 4665 6174 7572 697a 6572  at.MATFeaturizer
-00005060: 2829 0a20 2020 2020 2020 2064 6973 745f  ().        dist_
-00005070: 6d61 7472 6978 3a20 746f 7263 682e 5465  matrix: torch.Te
-00005080: 6e73 6f72 0a20 2020 2020 2020 2020 2020  nsor.           
-00005090: 2044 6973 7461 6e63 6520 6d61 7472 6978   Distance matrix
-000050a0: 206f 6620 7468 6520 696e 7075 7420 6d6f   of the input mo
-000050b0: 6c65 6375 6c65 2c20 7265 7475 726e 6564  lecule, returned
-000050c0: 2066 726f 6d20 6463 2e66 6561 742e 4d41   from dc.feat.MA
-000050d0: 5446 6561 7475 7269 7a65 7228 290a 2020  TFeaturizer().  
-000050e0: 2020 2020 2020 6472 6f70 6f75 745f 703a        dropout_p:
-000050f0: 2066 6c6f 6174 0a20 2020 2020 2020 2020   float.         
-00005100: 2020 2044 726f 706f 7574 2070 726f 6261     Dropout proba
-00005110: 6269 6c69 7479 2e0a 2020 2020 2020 2020  bility..        
-00005120: 6570 733a 2066 6c6f 6174 0a20 2020 2020  eps: float.     
-00005130: 2020 2020 2020 2045 7073 696c 6f6e 2076         Epsilon v
-00005140: 616c 7565 0a20 2020 2020 2020 2069 6e66  alue.        inf
-00005150: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
-00005160: 2020 2020 5661 6c75 6520 6f66 2069 6e66      Value of inf
-00005170: 696e 6974 7920 746f 2062 6520 7573 6564  inity to be used
-00005180: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00005190: 2020 2020 2020 645f 6b20 3d20 7175 6572        d_k = quer
-000051a0: 792e 7369 7a65 282d 3129 0a0a 2020 2020  y.size(-1)..    
-000051b0: 2020 2020 7363 6f72 6573 203d 2074 6f72      scores = tor
-000051c0: 6368 2e6d 6174 6d75 6c28 7175 6572 792c  ch.matmul(query,
-000051d0: 206b 6579 2e74 7261 6e73 706f 7365 282d   key.transpose(-
-000051e0: 322c 202d 3129 2920 2f20 6d61 7468 2e73  2, -1)) / math.s
-000051f0: 7172 7428 645f 6b29 0a0a 2020 2020 2020  qrt(d_k)..      
-00005200: 2020 6966 206d 6173 6b20 6973 206e 6f74    if mask is not
-00005210: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00005220: 2020 2073 636f 7265 7320 3d20 7363 6f72     scores = scor
-00005230: 6573 2e6d 6173 6b65 645f 6669 6c6c 280a  es.masked_fill(.
-00005240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005250: 6d61 736b 2e75 6e73 7175 6565 7a65 2831  mask.unsqueeze(1
-00005260: 292e 7265 7065 6174 2831 2c20 7175 6572  ).repeat(1, quer
-00005270: 792e 7368 6170 655b 315d 2c20 7175 6572  y.shape[1], quer
-00005280: 792e 7368 6170 655b 325d 2c0a 2020 2020  y.shape[2],.    
-00005290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000052a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000052b0: 2020 2020 2031 2920 3d3d 2030 2c20 2d69       1) == 0, -i
-000052c0: 6e66 290a 2020 2020 2020 2020 705f 6174  nf).        p_at
-000052d0: 746e 203d 2046 2e73 6f66 746d 6178 2873  tn = F.softmax(s
-000052e0: 636f 7265 732c 2064 696d 3d2d 3129 0a0a  cores, dim=-1)..
-000052f0: 2020 2020 2020 2020 6164 6a5f 6d61 7472          adj_matr
-00005300: 6978 203d 2061 646a 5f6d 6174 7269 7820  ix = adj_matrix 
-00005310: 2f20 280a 2020 2020 2020 2020 2020 2020  / (.            
-00005320: 746f 7263 682e 7375 6d28 746f 7263 682e  torch.sum(torch.
-00005330: 7465 6e73 6f72 2861 646a 5f6d 6174 7269  tensor(adj_matri
-00005340: 7829 2c20 6469 6d3d 2d31 292e 756e 7371  x), dim=-1).unsq
-00005350: 7565 657a 6528 3229 202b 2065 7073 290a  ueeze(2) + eps).
-00005360: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-00005370: 6164 6a5f 6d61 7472 6978 2e73 6861 7065  adj_matrix.shape
-00005380: 2920 3c3d 2033 3a0a 2020 2020 2020 2020  ) <= 3:.        
-00005390: 2020 2020 705f 6164 6a20 3d20 6164 6a5f      p_adj = adj_
-000053a0: 6d61 7472 6978 2e75 6e73 7175 6565 7a65  matrix.unsqueeze
-000053b0: 2831 292e 7265 7065 6174 2831 2c20 7175  (1).repeat(1, qu
-000053c0: 6572 792e 7368 6170 655b 315d 2c20 312c  ery.shape[1], 1,
-000053d0: 2031 290a 2020 2020 2020 2020 656c 7365   1).        else
-000053e0: 3a0a 2020 2020 2020 2020 2020 2020 705f  :.            p_
-000053f0: 6164 6a20 3d20 6164 6a5f 6d61 7472 6978  adj = adj_matrix
-00005400: 2e72 6570 6561 7428 312c 2071 7565 7279  .repeat(1, query
-00005410: 2e73 6861 7065 5b31 5d2c 2031 2c20 3129  .shape[1], 1, 1)
-00005420: 0a0a 2020 2020 2020 2020 6469 7374 616e  ..        distan
-00005430: 6365 5f6d 6174 7269 7820 3d20 746f 7263  ce_matrix = torc
-00005440: 682e 7465 6e73 6f72 2864 6973 7461 6e63  h.tensor(distanc
-00005450: 655f 6d61 7472 6978 292e 7371 7565 657a  e_matrix).squeez
-00005460: 6528 292e 6d61 736b 6564 5f66 696c 6c28  e().masked_fill(
-00005470: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
-00005480: 6b2e 7265 7065 6174 2831 2c20 6d61 736b  k.repeat(1, mask
-00005490: 2e73 6861 7065 5b2d 315d 2c20 3129 203d  .shape[-1], 1) =
-000054a0: 3d20 302c 206e 702e 696e 6629 0a0a 2020  = 0, np.inf)..  
-000054b0: 2020 2020 2020 6469 7374 616e 6365 5f6d        distance_m
-000054c0: 6174 7269 7820 3d20 7365 6c66 2e64 6973  atrix = self.dis
-000054d0: 745f 6b65 726e 656c 2864 6973 7461 6e63  t_kernel(distanc
-000054e0: 655f 6d61 7472 6978 290a 0a20 2020 2020  e_matrix)..     
-000054f0: 2020 2070 5f64 6973 7420 3d20 6469 7374     p_dist = dist
-00005500: 616e 6365 5f6d 6174 7269 782e 756e 7371  ance_matrix.unsq
-00005510: 7565 657a 6528 3129 2e72 6570 6561 7428  ueeze(1).repeat(
-00005520: 312c 2071 7565 7279 2e73 6861 7065 5b31  1, query.shape[1
-00005530: 5d2c 2031 2c20 3129 0a0a 2020 2020 2020  ], 1, 1)..      
-00005540: 2020 705f 7765 6967 6874 6564 203d 2073    p_weighted = s
-00005550: 656c 662e 6c61 6d62 6461 5f61 7474 656e  elf.lambda_atten
-00005560: 7469 6f6e 202a 2070 5f61 7474 6e20 2b20  tion * p_attn + 
-00005570: 7365 6c66 2e6c 616d 6264 615f 6469 7374  self.lambda_dist
-00005580: 616e 6365 202a 2070 5f64 6973 7420 2b20  ance * p_dist + 
-00005590: 7365 6c66 2e6c 616d 6264 615f 6164 6a61  self.lambda_adja
-000055a0: 6365 6e63 7920 2a20 705f 6164 6a0a 2020  cency * p_adj.  
-000055b0: 2020 2020 2020 705f 7765 6967 6874 6564        p_weighted
-000055c0: 203d 2073 656c 662e 6472 6f70 6f75 745f   = self.dropout_
-000055d0: 7028 705f 7765 6967 6874 6564 290a 0a20  p(p_weighted).. 
-000055e0: 2020 2020 2020 2072 6574 7572 6e20 746f         return to
-000055f0: 7263 682e 6d61 746d 756c 2870 5f77 6569  rch.matmul(p_wei
-00005600: 6768 7465 642e 666c 6f61 7428 292c 2076  ghted.float(), v
-00005610: 616c 7565 2e66 6c6f 6174 2829 292c 2070  alue.float()), p
-00005620: 5f61 7474 6e0a 0a20 2020 2064 6566 2066  _attn..    def f
-00005630: 6f72 7761 7264 2873 656c 662c 0a20 2020  orward(self,.   
-00005640: 2020 2020 2020 2020 2020 2020 2071 7565               que
-00005650: 7279 3a20 746f 7263 682e 5465 6e73 6f72  ry: torch.Tensor
-00005660: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00005670: 2020 6b65 793a 2074 6f72 6368 2e54 656e    key: torch.Ten
-00005680: 736f 722c 0a20 2020 2020 2020 2020 2020  sor,.           
-00005690: 2020 2020 2076 616c 7565 3a20 746f 7263       value: torc
-000056a0: 682e 5465 6e73 6f72 2c0a 2020 2020 2020  h.Tensor,.      
-000056b0: 2020 2020 2020 2020 2020 6d61 736b 3a20            mask: 
-000056c0: 746f 7263 682e 5465 6e73 6f72 2c0a 2020  torch.Tensor,.  
-000056d0: 2020 2020 2020 2020 2020 2020 2020 6164                ad
-000056e0: 6a5f 6d61 7472 6978 3a20 746f 7263 682e  j_matrix: torch.
-000056f0: 5465 6e73 6f72 2c0a 2020 2020 2020 2020  Tensor,.        
-00005700: 2020 2020 2020 2020 6469 7374 616e 6365          distance
-00005710: 5f6d 6174 7269 783a 2074 6f72 6368 2e54  _matrix: torch.T
-00005720: 656e 736f 722c 0a20 2020 2020 2020 2020  ensor,.         
-00005730: 2020 2020 2020 2064 726f 706f 7574 5f70         dropout_p
-00005740: 3a20 666c 6f61 7420 3d20 302e 302c 0a20  : float = 0.0,. 
-00005750: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00005760: 7073 3a20 666c 6f61 7420 3d20 3165 2d36  ps: float = 1e-6
-00005770: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00005780: 2020 696e 663a 2066 6c6f 6174 203d 2031    inf: float = 1
-00005790: 6531 3229 202d 3e20 746f 7263 682e 5465  e12) -> torch.Te
-000057a0: 6e73 6f72 3a0a 2020 2020 2020 2020 2222  nsor:.        ""
-000057b0: 224f 7574 7075 7420 636f 6d70 7574 6174  "Output computat
-000057c0: 696f 6e20 666f 7220 7468 6520 4d75 6c74  ion for the Mult
-000057d0: 6948 6561 6465 6441 7474 656e 7469 6f6e  iHeadedAttention
-000057e0: 206c 6179 6572 2e0a 2020 2020 2020 2020   layer..        
-000057f0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-00005800: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00005810: 2020 2020 2020 7175 6572 793a 2074 6f72        query: tor
-00005820: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
-00005830: 2020 2020 2020 5374 616e 6461 7264 2071        Standard q
-00005840: 7565 7279 2070 6172 616d 6574 6572 2066  uery parameter f
-00005850: 6f72 2061 7474 656e 7469 6f6e 2e0a 2020  or attention..  
-00005860: 2020 2020 2020 6b65 793a 2074 6f72 6368        key: torch
-00005870: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
-00005880: 2020 2020 5374 616e 6461 7264 206b 6579      Standard key
-00005890: 2070 6172 616d 6574 6572 2066 6f72 2061   parameter for a
-000058a0: 7474 656e 7469 6f6e 2e0a 2020 2020 2020  ttention..      
-000058b0: 2020 7661 6c75 653a 2074 6f72 6368 2e54    value: torch.T
-000058c0: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
-000058d0: 2020 5374 616e 6461 7264 2076 616c 7565    Standard value
-000058e0: 2070 6172 616d 6574 6572 2066 6f72 2061   parameter for a
-000058f0: 7474 656e 7469 6f6e 2e0a 2020 2020 2020  ttention..      
-00005900: 2020 6d61 736b 3a20 746f 7263 682e 5465    mask: torch.Te
-00005910: 6e73 6f72 0a20 2020 2020 2020 2020 2020  nsor.           
-00005920: 204d 6173 6b73 206f 7574 2070 6164 6469   Masks out paddi
-00005930: 6e67 2076 616c 7565 7320 736f 2074 6861  ng values so tha
-00005940: 7420 7468 6579 2061 7265 206e 6f74 2074  t they are not t
-00005950: 616b 656e 2069 6e74 6f20 6163 636f 756e  aken into accoun
-00005960: 7420 7768 656e 2063 6f6d 7075 7469 6e67  t when computing
-00005970: 2074 6865 2061 7474 656e 7469 6f6e 2073   the attention s
-00005980: 636f 7265 2e0a 2020 2020 2020 2020 6164  core..        ad
-00005990: 6a5f 6d61 7472 6978 3a20 746f 7263 682e  j_matrix: torch.
-000059a0: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
-000059b0: 2020 2041 646a 6163 656e 6379 206d 6174     Adjacency mat
-000059c0: 7269 7820 6f66 2074 6865 2069 6e70 7574  rix of the input
-000059d0: 206d 6f6c 6563 756c 652c 2072 6574 7572   molecule, retur
-000059e0: 6e65 6420 6672 6f6d 2064 632e 6665 6174  ned from dc.feat
-000059f0: 2e4d 4154 4665 6174 7572 697a 6572 2829  .MATFeaturizer()
-00005a00: 0a20 2020 2020 2020 2064 6973 745f 6d61  .        dist_ma
-00005a10: 7472 6978 3a20 746f 7263 682e 5465 6e73  trix: torch.Tens
-00005a20: 6f72 0a20 2020 2020 2020 2020 2020 2044  or.            D
-00005a30: 6973 7461 6e63 6520 6d61 7472 6978 206f  istance matrix o
-00005a40: 6620 7468 6520 696e 7075 7420 6d6f 6c65  f the input mole
-00005a50: 6375 6c65 2c20 7265 7475 726e 6564 2066  cule, returned f
-00005a60: 726f 6d20 6463 2e66 6561 742e 4d41 5446  rom dc.feat.MATF
-00005a70: 6561 7475 7269 7a65 7228 290a 2020 2020  eaturizer().    
-00005a80: 2020 2020 6472 6f70 6f75 745f 703a 2066      dropout_p: f
-00005a90: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
-00005aa0: 2044 726f 706f 7574 2070 726f 6261 6269   Dropout probabi
-00005ab0: 6c69 7479 2e0a 2020 2020 2020 2020 6570  lity..        ep
-00005ac0: 733a 2066 6c6f 6174 0a20 2020 2020 2020  s: float.       
-00005ad0: 2020 2020 2045 7073 696c 6f6e 2076 616c       Epsilon val
-00005ae0: 7565 0a20 2020 2020 2020 2069 6e66 3a20  ue.        inf: 
-00005af0: 666c 6f61 740a 2020 2020 2020 2020 2020  float.          
-00005b00: 2020 5661 6c75 6520 6f66 2069 6e66 696e    Value of infin
-00005b10: 6974 7920 746f 2062 6520 7573 6564 2e0a  ity to be used..
-00005b20: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00005b30: 2020 2020 6966 206d 6173 6b20 6973 206e      if mask is n
-00005b40: 6f74 204e 6f6e 6520 616e 6420 6c65 6e28  ot None and len(
-00005b50: 6d61 736b 2e73 6861 7065 2920 3c3d 2032  mask.shape) <= 2
-00005b60: 3a0a 2020 2020 2020 2020 2020 2020 6d61  :.            ma
-00005b70: 736b 203d 206d 6173 6b2e 756e 7371 7565  sk = mask.unsque
-00005b80: 657a 6528 3129 0a0a 2020 2020 2020 2020  eze(1)..        
-00005b90: 6261 7463 685f 7369 7a65 203d 2071 7565  batch_size = que
-00005ba0: 7279 2e73 697a 6528 3029 0a20 2020 2020  ry.size(0).     
-00005bb0: 2020 2071 7565 7279 2c20 6b65 792c 2076     query, key, v
-00005bc0: 616c 7565 203d 205b 0a20 2020 2020 2020  alue = [.       
-00005bd0: 2020 2020 206c 6179 6572 2878 292e 7669       layer(x).vi
-00005be0: 6577 2862 6174 6368 5f73 697a 652c 202d  ew(batch_size, -
-00005bf0: 312c 2073 656c 662e 682c 2073 656c 662e  1, self.h, self.
-00005c00: 645f 6b29 2e74 7261 6e73 706f 7365 2831  d_k).transpose(1
-00005c10: 2c20 3229 0a20 2020 2020 2020 2020 2020  , 2).           
-00005c20: 2066 6f72 206c 6179 6572 2c20 7820 696e   for layer, x in
-00005c30: 207a 6970 2873 656c 662e 6c69 6e65 6172   zip(self.linear
-00005c40: 5f6c 6179 6572 732c 2028 7175 6572 792c  _layers, (query,
-00005c50: 206b 6579 2c20 7661 6c75 6529 290a 2020   key, value)).  
-00005c60: 2020 2020 2020 5d0a 0a20 2020 2020 2020        ]..       
-00005c70: 2078 2c20 5f20 3d20 7365 6c66 2e5f 7369   x, _ = self._si
-00005c80: 6e67 6c65 5f61 7474 656e 7469 6f6e 2871  ngle_attention(q
-00005c90: 7565 7279 2c20 6b65 792c 2076 616c 7565  uery, key, value
-00005ca0: 2c20 6d61 736b 2c20 6164 6a5f 6d61 7472  , mask, adj_matr
-00005cb0: 6978 2c0a 2020 2020 2020 2020 2020 2020  ix,.            
-00005cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005cd0: 2020 2020 2020 2020 2020 6469 7374 616e            distan
-00005ce0: 6365 5f6d 6174 7269 782c 2064 726f 706f  ce_matrix, dropo
-00005cf0: 7574 5f70 2c20 6570 732c 2069 6e66 290a  ut_p, eps, inf).
-00005d00: 2020 2020 2020 2020 7820 3d20 782e 7472          x = x.tr
-00005d10: 616e 7370 6f73 6528 312c 2032 292e 636f  anspose(1, 2).co
-00005d20: 6e74 6967 756f 7573 2829 2e76 6965 7728  ntiguous().view(
-00005d30: 6261 7463 685f 7369 7a65 2c20 2d31 2c0a  batch_size, -1,.
-00005d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005d70: 7365 6c66 2e68 202a 2073 656c 662e 645f  self.h * self.d_
-00005d80: 6b29 0a0a 2020 2020 2020 2020 7265 7475  k)..        retu
-00005d90: 726e 2073 656c 662e 6f75 7470 7574 5f6c  rn self.output_l
-00005da0: 696e 6561 7228 7829 0a0a 0a63 6c61 7373  inear(x)...class
-00005db0: 204d 4154 456e 636f 6465 724c 6179 6572   MATEncoderLayer
-00005dc0: 286e 6e2e 4d6f 6475 6c65 293a 0a20 2020  (nn.Module):.   
-00005dd0: 2022 2222 456e 636f 6465 7220 6c61 7965   """Encoder laye
-00005de0: 7220 666f 7220 7573 6520 696e 2074 6865  r for use in the
-00005df0: 204d 6f6c 6563 756c 6172 2041 7474 656e   Molecular Atten
-00005e00: 7469 6f6e 2054 7261 6e73 666f 726d 6572  tion Transformer
-00005e10: 205b 315d 5f2e 0a0a 2020 2020 5468 6520   [1]_...    The 
-00005e20: 4d41 5445 6e63 6f64 6572 206c 6179 6572  MATEncoder layer
-00005e30: 2070 7269 6d61 7269 6c79 2063 6f6e 7369   primarily consi
-00005e40: 7374 7320 6f66 2061 2073 656c 662d 6174  sts of a self-at
-00005e50: 7465 6e74 696f 6e20 6c61 7965 7220 284d  tention layer (M
-00005e60: 756c 7469 4865 6164 6564 4d41 5441 7474  ultiHeadedMATAtt
-00005e70: 656e 7469 6f6e 2920 616e 6420 6120 6665  ention) and a fe
-00005e80: 6564 2d66 6f72 7761 7264 206c 6179 6572  ed-forward layer
-00005e90: 2028 506f 7369 7469 6f6e 7769 7365 4665   (PositionwiseFe
-00005ea0: 6564 466f 7277 6172 6429 2e0a 2020 2020  edForward)..    
-00005eb0: 5468 6973 206c 6179 6572 2063 616e 2062  This layer can b
-00005ec0: 6520 7374 6163 6b65 6420 6d75 6c74 6970  e stacked multip
-00005ed0: 6c65 2074 696d 6573 2074 6f20 666f 726d  le times to form
-00005ee0: 2061 6e20 656e 636f 6465 722e 0a0a 2020   an encoder...  
-00005ef0: 2020 5265 6665 7265 6e63 6573 0a20 2020    References.   
-00005f00: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-00005f10: 2e2e 205b 315d 204c 756b 6173 7a20 4d61  .. [1] Lukasz Ma
-00005f20: 7a69 6172 6b61 2065 7420 616c 2e20 224d  ziarka et al. "M
-00005f30: 6f6c 6563 756c 6520 4174 7465 6e74 696f  olecule Attentio
-00005f40: 6e20 5472 616e 7366 6f72 6d65 7222 2047  n Transformer" G
-00005f50: 7261 7068 2052 6570 7265 7365 6e74 6174  raph Representat
-00005f60: 696f 6e20 4c65 6172 6e69 6e67 2077 6f72  ion Learning wor
-00005f70: 6b73 686f 7020 616e 6420 4d61 6368 696e  kshop and Machin
-00005f80: 6520 4c65 6172 6e69 6e67 2061 6e64 2074  e Learning and t
-00005f90: 6865 2050 6879 7369 6361 6c20 5363 6965  he Physical Scie
-00005fa0: 6e63 6573 2077 6f72 6b73 686f 7020 6174  nces workshop at
-00005fb0: 204e 6575 7249 5053 2032 3031 392e 2032   NeurIPS 2019. 2
-00005fc0: 3032 302e 2068 7474 7073 3a2f 2f61 7278  020. https://arx
-00005fd0: 6976 2e6f 7267 2f61 6273 2f32 3030 322e  iv.org/abs/2002.
-00005fe0: 3038 3236 340a 0a20 2020 2045 7861 6d70  08264..    Examp
-00005ff0: 6c65 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  les.    --------
-00006000: 0a20 2020 203e 3e3e 2066 726f 6d20 7264  .    >>> from rd
-00006010: 6b69 7420 696d 706f 7274 2043 6865 6d0a  kit import Chem.
-00006020: 2020 2020 3e3e 3e20 696d 706f 7274 2074      >>> import t
-00006030: 6f72 6368 0a20 2020 203e 3e3e 2069 6d70  orch.    >>> imp
-00006040: 6f72 7420 6465 6570 6368 656d 0a20 2020  ort deepchem.   
-00006050: 203e 3e3e 2066 726f 6d20 6465 6570 6368   >>> from deepch
-00006060: 656d 2e6d 6f64 656c 732e 746f 7263 685f  em.models.torch_
-00006070: 6d6f 6465 6c73 2e6c 6179 6572 7320 696d  models.layers im
-00006080: 706f 7274 204d 4154 456d 6265 6464 696e  port MATEmbeddin
-00006090: 672c 204d 4154 456e 636f 6465 724c 6179  g, MATEncoderLay
-000060a0: 6572 0a20 2020 203e 3e3e 2069 6e70 7574  er.    >>> input
-000060b0: 5f73 6d69 6c65 203d 2022 4343 220a 2020  _smile = "CC".  
-000060c0: 2020 3e3e 3e20 6665 6174 203d 2064 6565    >>> feat = dee
-000060d0: 7063 6865 6d2e 6665 6174 2e4d 4154 4665  pchem.feat.MATFe
-000060e0: 6174 7572 697a 6572 2829 0a20 2020 203e  aturizer().    >
-000060f0: 3e3e 206f 7574 203d 2066 6561 742e 6665  >> out = feat.fe
-00006100: 6174 7572 697a 6528 696e 7075 745f 736d  aturize(input_sm
-00006110: 696c 6529 0a20 2020 203e 3e3e 206e 6f64  ile).    >>> nod
-00006120: 6520 3d20 746f 7263 682e 7465 6e73 6f72  e = torch.tensor
-00006130: 286f 7574 5b30 5d2e 6e6f 6465 5f66 6561  (out[0].node_fea
-00006140: 7475 7265 7329 2e66 6c6f 6174 2829 2e75  tures).float().u
-00006150: 6e73 7175 6565 7a65 2830 290a 2020 2020  nsqueeze(0).    
-00006160: 3e3e 3e20 6164 6a20 3d20 746f 7263 682e  >>> adj = torch.
-00006170: 7465 6e73 6f72 286f 7574 5b30 5d2e 6164  tensor(out[0].ad
-00006180: 6a61 6365 6e63 795f 6d61 7472 6978 292e  jacency_matrix).
-00006190: 666c 6f61 7428 292e 756e 7371 7565 657a  float().unsqueez
-000061a0: 6528 3029 0a20 2020 203e 3e3e 2064 6973  e(0).    >>> dis
-000061b0: 7420 3d20 746f 7263 682e 7465 6e73 6f72  t = torch.tensor
-000061c0: 286f 7574 5b30 5d2e 6469 7374 616e 6365  (out[0].distance
-000061d0: 5f6d 6174 7269 7829 2e66 6c6f 6174 2829  _matrix).float()
-000061e0: 2e75 6e73 7175 6565 7a65 2830 290a 2020  .unsqueeze(0).  
-000061f0: 2020 3e3e 3e20 6d61 736b 203d 2074 6f72    >>> mask = tor
-00006200: 6368 2e73 756d 2874 6f72 6368 2e61 6273  ch.sum(torch.abs
-00006210: 286e 6f64 6529 2c20 6469 6d3d 2d31 2920  (node), dim=-1) 
-00006220: 213d 2030 0a20 2020 203e 3e3e 206c 6179  != 0.    >>> lay
-00006230: 6572 203d 204d 4154 456e 636f 6465 724c  er = MATEncoderL
-00006240: 6179 6572 2829 0a20 2020 203e 3e3e 206f  ayer().    >>> o
-00006250: 7020 3d20 4d41 5445 6d62 6564 6469 6e67  p = MATEmbedding
-00006260: 2829 286e 6f64 6529 0a20 2020 203e 3e3e  ()(node).    >>>
-00006270: 206f 7574 7075 7420 3d20 6c61 7965 7228   output = layer(
-00006280: 6f70 2c20 6d61 736b 2c20 6164 6a2c 2064  op, mask, adj, d
-00006290: 6973 7429 0a20 2020 2022 2222 0a0a 2020  ist).    """..  
-000062a0: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-000062b0: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
-000062c0: 2020 2020 2020 6469 7374 5f6b 6572 6e65        dist_kerne
-000062d0: 6c3a 2073 7472 203d 2027 736f 6674 6d61  l: str = 'softma
-000062e0: 7827 2c0a 2020 2020 2020 2020 2020 2020  x',.            
-000062f0: 2020 2020 206c 616d 6264 615f 6174 7465       lambda_atte
-00006300: 6e74 696f 6e3a 2066 6c6f 6174 203d 2030  ntion: float = 0
-00006310: 2e33 332c 0a20 2020 2020 2020 2020 2020  .33,.           
-00006320: 2020 2020 2020 6c61 6d62 6461 5f64 6973        lambda_dis
-00006330: 7461 6e63 653a 2066 6c6f 6174 203d 2030  tance: float = 0
-00006340: 2e33 332c 0a20 2020 2020 2020 2020 2020  .33,.           
-00006350: 2020 2020 2020 683a 2069 6e74 203d 2031        h: int = 1
-00006360: 362c 0a20 2020 2020 2020 2020 2020 2020  6,.             
-00006370: 2020 2020 7361 5f68 7369 7a65 3a20 696e      sa_hsize: in
-00006380: 7420 3d20 3130 3234 2c0a 2020 2020 2020  t = 1024,.      
-00006390: 2020 2020 2020 2020 2020 2073 615f 6472             sa_dr
-000063a0: 6f70 6f75 745f 703a 2066 6c6f 6174 203d  opout_p: float =
-000063b0: 2030 2e30 2c0a 2020 2020 2020 2020 2020   0.0,.          
-000063c0: 2020 2020 2020 206f 7574 7075 745f 6269         output_bi
-000063d0: 6173 3a20 626f 6f6c 203d 2054 7275 652c  as: bool = True,
-000063e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000063f0: 2020 645f 696e 7075 743a 2069 6e74 203d    d_input: int =
-00006400: 2031 3032 342c 0a20 2020 2020 2020 2020   1024,.         
-00006410: 2020 2020 2020 2020 645f 6869 6464 656e          d_hidden
-00006420: 3a20 696e 7420 3d20 3130 3234 2c0a 2020  : int = 1024,.  
-00006430: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00006440: 5f6f 7574 7075 743a 2069 6e74 203d 2031  _output: int = 1
-00006450: 3032 342c 0a20 2020 2020 2020 2020 2020  024,.           
-00006460: 2020 2020 2020 6163 7469 7661 7469 6f6e        activation
-00006470: 3a20 7374 7220 3d20 276c 6561 6b79 7265  : str = 'leakyre
-00006480: 6c75 272c 0a20 2020 2020 2020 2020 2020  lu',.           
-00006490: 2020 2020 2020 6e5f 6c61 7965 7273 3a20        n_layers: 
-000064a0: 696e 7420 3d20 312c 0a20 2020 2020 2020  int = 1,.       
-000064b0: 2020 2020 2020 2020 2020 6666 5f64 726f            ff_dro
-000064c0: 706f 7574 5f70 3a20 666c 6f61 7420 3d20  pout_p: float = 
-000064d0: 302e 302c 0a20 2020 2020 2020 2020 2020  0.0,.           
-000064e0: 2020 2020 2020 656e 636f 6465 725f 6873        encoder_hs
-000064f0: 697a 653a 2069 6e74 203d 2031 3032 342c  ize: int = 1024,
-00006500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006510: 2020 656e 636f 6465 725f 6472 6f70 6f75    encoder_dropou
-00006520: 745f 703a 2066 6c6f 6174 203d 2030 2e30  t_p: float = 0.0
-00006530: 293a 0a20 2020 2020 2020 2022 2222 496e  ):.        """In
-00006540: 6974 6961 6c69 7a65 2061 204d 4154 456e  itialize a MATEn
-00006550: 636f 6465 7220 6c61 7965 722e 0a0a 2020  coder layer...  
-00006560: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-00006570: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00006580: 2d2d 2d0a 2020 2020 2020 2020 6469 7374  ---.        dist
-00006590: 5f6b 6572 6e65 6c3a 2073 7472 0a20 2020  _kernel: str.   
-000065a0: 2020 2020 2020 2020 204b 6572 6e65 6c20           Kernel 
-000065b0: 6163 7469 7661 7469 6f6e 2074 6f20 6265  activation to be
-000065c0: 2075 7365 642e 2043 616e 2062 6520 6569   used. Can be ei
-000065d0: 7468 6572 2027 736f 6674 6d61 7827 2066  ther 'softmax' f
-000065e0: 6f72 2073 6f66 746d 6178 206f 7220 2765  or softmax or 'e
-000065f0: 7870 2720 666f 7220 6578 706f 6e65 6e74  xp' for exponent
-00006600: 6961 6c2c 2066 6f72 2074 6865 2073 656c  ial, for the sel
-00006610: 662d 6174 7465 6e74 696f 6e20 6c61 7965  f-attention laye
-00006620: 722e 0a20 2020 2020 2020 206c 616d 6264  r..        lambd
-00006630: 615f 6174 7465 6e74 696f 6e3a 2066 6c6f  a_attention: flo
-00006640: 6174 0a20 2020 2020 2020 2020 2020 2043  at.            C
-00006650: 6f6e 7374 616e 7420 746f 2062 6520 6d75  onstant to be mu
-00006660: 6c74 6970 6c69 6564 2077 6974 6820 7468  ltiplied with th
-00006670: 6520 6174 7465 6e74 696f 6e20 6d61 7472  e attention matr
-00006680: 6978 2069 6e20 7468 6520 7365 6c66 2d61  ix in the self-a
-00006690: 7474 656e 7469 6f6e 206c 6179 6572 2e0a  ttention layer..
-000066a0: 2020 2020 2020 2020 6c61 6d62 6461 5f64          lambda_d
-000066b0: 6973 7461 6e63 653a 2066 6c6f 6174 0a20  istance: float. 
-000066c0: 2020 2020 2020 2020 2020 2043 6f6e 7374             Const
-000066d0: 616e 7420 746f 2062 6520 6d75 6c74 6970  ant to be multip
-000066e0: 6c69 6564 2077 6974 6820 7468 6520 6469  lied with the di
-000066f0: 7374 616e 6365 206d 6174 7269 7820 696e  stance matrix in
-00006700: 2074 6865 2073 656c 662d 6174 7465 6e74   the self-attent
-00006710: 696f 6e20 6c61 7965 722e 0a20 2020 2020  ion layer..     
-00006720: 2020 2068 3a20 696e 740a 2020 2020 2020     h: int.      
-00006730: 2020 2020 2020 4e75 6d62 6572 206f 6620        Number of 
-00006740: 6174 7465 6e74 696f 6e20 6865 6164 7320  attention heads 
-00006750: 666f 7220 7468 6520 7365 6c66 2d61 7474  for the self-att
-00006760: 656e 7469 6f6e 206c 6179 6572 2e0a 2020  ention layer..  
-00006770: 2020 2020 2020 7361 5f68 7369 7a65 3a20        sa_hsize: 
-00006780: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
-00006790: 5369 7a65 206f 6620 6465 6e73 6520 6c61  Size of dense la
-000067a0: 7965 7220 696e 2074 6865 2073 656c 662d  yer in the self-
-000067b0: 6174 7465 6e74 696f 6e20 6c61 7965 722e  attention layer.
-000067c0: 0a20 2020 2020 2020 2073 615f 6472 6f70  .        sa_drop
-000067d0: 6f75 745f 703a 2066 6c6f 6174 0a20 2020  out_p: float.   
-000067e0: 2020 2020 2020 2020 2044 726f 706f 7574           Dropout
-000067f0: 2070 726f 6261 6269 6c69 7479 2066 6f72   probability for
-00006800: 2074 6865 2073 656c 662d 6174 7465 6e74   the self-attent
-00006810: 696f 6e20 6c61 7965 722e 0a20 2020 2020  ion layer..     
-00006820: 2020 206f 7574 7075 745f 6269 6173 3a20     output_bias: 
-00006830: 626f 6f6c 0a20 2020 2020 2020 2020 2020  bool.           
-00006840: 2049 6620 5472 7565 2c20 6465 6e73 6520   If True, dense 
-00006850: 6c61 7965 7273 2077 696c 6c20 7573 6520  layers will use 
-00006860: 6269 6173 2076 6563 746f 7273 2069 6e20  bias vectors in 
-00006870: 7468 6520 7365 6c66 2d61 7474 656e 7469  the self-attenti
-00006880: 6f6e 206c 6179 6572 2e0a 2020 2020 2020  on layer..      
-00006890: 2020 645f 696e 7075 743a 2069 6e74 0a20    d_input: int. 
-000068a0: 2020 2020 2020 2020 2020 2053 697a 6520             Size 
-000068b0: 6f66 2069 6e70 7574 206c 6179 6572 2069  of input layer i
-000068c0: 6e20 7468 6520 6665 6564 2d66 6f72 7761  n the feed-forwa
-000068d0: 7264 206c 6179 6572 2e0a 2020 2020 2020  rd layer..      
-000068e0: 2020 645f 6869 6464 656e 3a20 696e 740a    d_hidden: int.
-000068f0: 2020 2020 2020 2020 2020 2020 5369 7a65              Size
-00006900: 206f 6620 6869 6464 656e 206c 6179 6572   of hidden layer
-00006910: 2069 6e20 7468 6520 6665 6564 2d66 6f72   in the feed-for
-00006920: 7761 7264 206c 6179 6572 2e0a 2020 2020  ward layer..    
-00006930: 2020 2020 645f 6f75 7470 7574 3a20 696e      d_output: in
-00006940: 740a 2020 2020 2020 2020 2020 2020 5369  t.            Si
-00006950: 7a65 206f 6620 6f75 7470 7574 206c 6179  ze of output lay
-00006960: 6572 2069 6e20 7468 6520 6665 6564 2d66  er in the feed-f
-00006970: 6f72 7761 7264 206c 6179 6572 2e0a 2020  orward layer..  
-00006980: 2020 2020 2020 6163 7469 7661 7469 6f6e        activation
-00006990: 3a20 7374 720a 2020 2020 2020 2020 2020  : str.          
-000069a0: 2020 4163 7469 7661 7469 6f6e 2066 756e    Activation fun
-000069b0: 6374 696f 6e20 746f 2062 6520 7573 6564  ction to be used
-000069c0: 2069 6e20 7468 6520 6665 6564 2d66 6f72   in the feed-for
-000069d0: 7761 7264 206c 6179 6572 2e0a 2020 2020  ward layer..    
-000069e0: 2020 2020 2020 2020 4361 6e20 6368 6f6f          Can choo
-000069f0: 7365 2062 6574 7765 656e 2027 7265 6c75  se between 'relu
-00006a00: 2720 666f 7220 5265 4c55 2c20 276c 6561  ' for ReLU, 'lea
-00006a10: 6b79 7265 6c75 2720 666f 7220 4c65 616b  kyrelu' for Leak
-00006a20: 7952 654c 552c 2027 7072 656c 7527 2066  yReLU, 'prelu' f
-00006a30: 6f72 2050 5265 4c55 2c0a 2020 2020 2020  or PReLU,.      
-00006a40: 2020 2020 2020 2774 616e 6827 2066 6f72        'tanh' for
-00006a50: 2054 616e 482c 2027 7365 6c75 2720 666f   TanH, 'selu' fo
-00006a60: 7220 5345 4c55 2c20 2765 6c75 2720 666f  r SELU, 'elu' fo
-00006a70: 7220 454c 5520 616e 6420 276c 696e 6561  r ELU and 'linea
-00006a80: 7227 2066 6f72 206c 696e 6561 7220 6163  r' for linear ac
-00006a90: 7469 7661 7469 6f6e 2e0a 2020 2020 2020  tivation..      
-00006aa0: 2020 6e5f 6c61 7965 7273 3a20 696e 740a    n_layers: int.
-00006ab0: 2020 2020 2020 2020 2020 2020 4e75 6d62              Numb
-00006ac0: 6572 206f 6620 6c61 7965 7273 2069 6e20  er of layers in 
-00006ad0: 7468 6520 6665 6564 2d66 6f72 7761 7264  the feed-forward
-00006ae0: 206c 6179 6572 2e0a 2020 2020 2020 2020   layer..        
-00006af0: 6472 6f70 6f75 745f 703a 2066 6c6f 6174  dropout_p: float
-00006b00: 0a20 2020 2020 2020 2020 2020 2044 726f  .            Dro
-00006b10: 706f 7574 2070 726f 6261 6269 6c69 7479  pout probability
-00006b20: 2069 6e20 7468 6520 6665 6565 642d 666f   in the feeed-fo
-00006b30: 7277 6172 6420 6c61 7965 722e 0a20 2020  rward layer..   
-00006b40: 2020 2020 2065 6e63 6f64 6572 5f68 7369       encoder_hsi
-00006b50: 7a65 3a20 696e 740a 2020 2020 2020 2020  ze: int.        
-00006b60: 2020 2020 5369 7a65 206f 6620 4465 6e73      Size of Dens
-00006b70: 6520 6c61 7965 7220 666f 7220 7468 6520  e layer for the 
-00006b80: 656e 636f 6465 7220 6974 7365 6c66 2e0a  encoder itself..
-00006b90: 2020 2020 2020 2020 656e 636f 6465 725f          encoder_
-00006ba0: 6472 6f70 6f75 745f 703a 2066 6c6f 6174  dropout_p: float
-00006bb0: 0a20 2020 2020 2020 2020 2020 2044 726f  .            Dro
-00006bc0: 706f 7574 2070 726f 6261 6269 6c69 7479  pout probability
-00006bd0: 2066 6f72 2063 6f6e 6e65 6374 696f 6e73   for connections
-00006be0: 2069 6e20 7468 6520 656e 636f 6465 7220   in the encoder 
-00006bf0: 6c61 7965 722e 0a20 2020 2020 2020 2022  layer..        "
-00006c00: 2222 0a20 2020 2020 2020 2073 7570 6572  "".        super
-00006c10: 284d 4154 456e 636f 6465 724c 6179 6572  (MATEncoderLayer
-00006c20: 2c20 7365 6c66 292e 5f5f 696e 6974 5f5f  , self).__init__
-00006c30: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-00006c40: 7365 6c66 5f61 7474 6e20 3d20 4d75 6c74  self_attn = Mult
-00006c50: 6948 6561 6465 644d 4154 4174 7465 6e74  iHeadedMATAttent
-00006c60: 696f 6e28 6469 7374 5f6b 6572 6e65 6c2c  ion(dist_kernel,
-00006c70: 206c 616d 6264 615f 6174 7465 6e74 696f   lambda_attentio
-00006c80: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-00006c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006cb0: 2020 2020 6c61 6d62 6461 5f64 6973 7461      lambda_dista
-00006cc0: 6e63 652c 2068 2c20 7361 5f68 7369 7a65  nce, h, sa_hsize
-00006cd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00006ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006d00: 2020 2073 615f 6472 6f70 6f75 745f 702c     sa_dropout_p,
-00006d10: 206f 7574 7075 745f 6269 6173 290a 2020   output_bias).  
-00006d20: 2020 2020 2020 7365 6c66 2e66 6565 645f        self.feed_
-00006d30: 666f 7277 6172 6420 3d20 506f 7369 7469  forward = Positi
-00006d40: 6f6e 7769 7365 4665 6564 466f 7277 6172  onwiseFeedForwar
-00006d50: 6428 645f 696e 7075 742c 2064 5f68 6964  d(d_input, d_hid
-00006d60: 6465 6e2c 2064 5f6f 7574 7075 742c 0a20  den, d_output,. 
-00006d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006da0: 2020 2061 6374 6976 6174 696f 6e2c 206e     activation, n
-00006db0: 5f6c 6179 6572 732c 0a20 2020 2020 2020  _layers,.       
-00006dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006de0: 2020 2020 2020 2020 2020 2020 2066 665f               ff_
-00006df0: 6472 6f70 6f75 745f 7029 0a20 2020 2020  dropout_p).     
-00006e00: 2020 206c 6179 6572 203d 2053 7562 6c61     layer = Subla
-00006e10: 7965 7243 6f6e 6e65 6374 696f 6e28 7369  yerConnection(si
-00006e20: 7a65 3d65 6e63 6f64 6572 5f68 7369 7a65  ze=encoder_hsize
-00006e30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00006e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006e50: 2020 2020 2064 726f 706f 7574 5f70 3d65       dropout_p=e
-00006e60: 6e63 6f64 6572 5f64 726f 706f 7574 5f70  ncoder_dropout_p
-00006e70: 290a 2020 2020 2020 2020 7365 6c66 2e73  ).        self.s
-00006e80: 7562 6c61 7965 7220 3d20 6e6e 2e4d 6f64  ublayer = nn.Mod
-00006e90: 756c 654c 6973 7428 5b6c 6179 6572 2066  uleList([layer f
-00006ea0: 6f72 205f 2069 6e20 7261 6e67 6528 3229  or _ in range(2)
-00006eb0: 5d29 0a20 2020 2020 2020 2073 656c 662e  ]).        self.
-00006ec0: 7369 7a65 203d 2065 6e63 6f64 6572 5f68  size = encoder_h
-00006ed0: 7369 7a65 0a0a 2020 2020 6465 6620 666f  size..    def fo
-00006ee0: 7277 6172 6428 7365 6c66 2c0a 2020 2020  rward(self,.    
-00006ef0: 2020 2020 2020 2020 2020 2020 783a 2074              x: t
-00006f00: 6f72 6368 2e54 656e 736f 722c 0a20 2020  orch.Tensor,.   
-00006f10: 2020 2020 2020 2020 2020 2020 206d 6173               mas
-00006f20: 6b3a 2074 6f72 6368 2e54 656e 736f 722c  k: torch.Tensor,
-00006f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006f40: 2061 646a 5f6d 6174 7269 783a 2074 6f72   adj_matrix: tor
-00006f50: 6368 2e54 656e 736f 722c 0a20 2020 2020  ch.Tensor,.     
-00006f60: 2020 2020 2020 2020 2020 2064 6973 7461             dista
-00006f70: 6e63 655f 6d61 7472 6978 3a20 746f 7263  nce_matrix: torc
-00006f80: 682e 5465 6e73 6f72 2c0a 2020 2020 2020  h.Tensor,.      
-00006f90: 2020 2020 2020 2020 2020 7361 5f64 726f            sa_dro
-00006fa0: 706f 7574 5f70 3a20 666c 6f61 7420 3d20  pout_p: float = 
-00006fb0: 302e 3029 202d 3e20 746f 7263 682e 5465  0.0) -> torch.Te
-00006fc0: 6e73 6f72 3a0a 2020 2020 2020 2020 2222  nsor:.        ""
-00006fd0: 224f 7574 7075 7420 636f 6d70 7574 6174  "Output computat
-00006fe0: 696f 6e20 666f 7220 7468 6520 4d41 5445  ion for the MATE
-00006ff0: 6e63 6f64 6572 206c 6179 6572 2e0a 0a20  ncoder layer... 
-00007000: 2020 2020 2020 2049 6e20 7468 6520 4d41         In the MA
-00007010: 5445 6e63 6f64 6572 4c61 7965 7220 696e  TEncoderLayer in
-00007020: 7469 616c 697a 6174 696f 6e2c 2073 656c  tialization, sel
-00007030: 662e 7375 626c 6179 6572 2069 7320 6465  f.sublayer is de
-00007040: 6669 6e65 6420 6173 2061 6e20 6e6e 2e4d  fined as an nn.M
-00007050: 6f64 756c 654c 6973 7420 6f66 2032 206c  oduleList of 2 l
-00007060: 6179 6572 732e 2057 6520 7769 6c6c 2062  ayers. We will b
-00007070: 6520 7061 7373 696e 6720 6f75 7220 636f  e passing our co
-00007080: 6d70 7574 6174 696f 6e20 7468 726f 7567  mputation throug
-00007090: 6820 7468 6573 6520 6c61 7965 7273 2073  h these layers s
-000070a0: 6571 7565 6e74 6961 6c6c 792e 0a20 2020  equentially..   
-000070b0: 2020 2020 206e 6e2e 4d6f 6475 6c65 4c69       nn.ModuleLi
-000070c0: 7374 2069 7320 7375 6273 6372 6970 7461  st is subscripta
-000070d0: 626c 6520 616e 6420 7468 7573 2077 6520  ble and thus we 
-000070e0: 6361 6e20 6163 6365 7373 2069 7420 6173  can access it as
-000070f0: 2073 656c 662e 7375 626c 6179 6572 5b30   self.sublayer[0
-00007100: 5d2c 2066 6f72 2065 7861 6d70 6c65 2e0a  ], for example..
-00007110: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-00007120: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-00007130: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2078  ------.        x
-00007140: 3a20 746f 7263 682e 5465 6e73 6f72 0a20  : torch.Tensor. 
-00007150: 2020 2020 2020 2020 2020 2049 6e70 7574             Input
-00007160: 2074 656e 736f 722e 0a20 2020 2020 2020   tensor..       
-00007170: 206d 6173 6b3a 2074 6f72 6368 2e54 656e   mask: torch.Ten
-00007180: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
-00007190: 4d61 736b 7320 6f75 7420 7061 6464 696e  Masks out paddin
-000071a0: 6720 7661 6c75 6573 2073 6f20 7468 6174  g values so that
-000071b0: 2074 6865 7920 6172 6520 6e6f 7420 7461   they are not ta
-000071c0: 6b65 6e20 696e 746f 2061 6363 6f75 6e74  ken into account
-000071d0: 2077 6865 6e20 636f 6d70 7574 696e 6720   when computing 
-000071e0: 7468 6520 6174 7465 6e74 696f 6e20 7363  the attention sc
-000071f0: 6f72 652e 0a20 2020 2020 2020 2061 646a  ore..        adj
-00007200: 5f6d 6174 7269 783a 2074 6f72 6368 2e54  _matrix: torch.T
-00007210: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
-00007220: 2020 4164 6a61 6365 6e63 7920 6d61 7472    Adjacency matr
-00007230: 6978 206f 6620 6120 6d6f 6c65 6375 6c65  ix of a molecule
-00007240: 2e0a 2020 2020 2020 2020 6469 7374 616e  ..        distan
-00007250: 6365 5f6d 6174 7269 783a 2074 6f72 6368  ce_matrix: torch
-00007260: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
-00007270: 2020 2020 4469 7374 616e 6365 206d 6174      Distance mat
-00007280: 7269 7820 6f66 2061 206d 6f6c 6563 756c  rix of a molecul
-00007290: 652e 0a20 2020 2020 2020 2073 615f 6472  e..        sa_dr
-000072a0: 6f70 6f75 745f 703a 2066 6c6f 6174 0a20  opout_p: float. 
-000072b0: 2020 2020 2020 2020 2020 2044 726f 706f             Dropo
-000072c0: 7574 2070 726f 6261 6269 6c69 7479 2066  ut probability f
-000072d0: 6f72 2074 6865 2073 656c 662d 6174 7465  or the self-atte
-000072e0: 6e74 696f 6e20 6c61 7965 7220 284d 756c  ntion layer (Mul
-000072f0: 7469 4865 6164 6564 4d41 5441 7474 656e  tiHeadedMATAtten
-00007300: 7469 6f6e 292e 0a20 2020 2020 2020 2022  tion)..        "
-00007310: 2222 0a20 2020 2020 2020 2078 203d 2073  "".        x = s
-00007320: 656c 662e 7375 626c 6179 6572 5b30 5d28  elf.sublayer[0](
-00007330: 782c 0a20 2020 2020 2020 2020 2020 2020  x,.             
-00007340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007350: 7365 6c66 2e73 656c 665f 6174 746e 2878  self.self_attn(x
-00007360: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00007370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007380: 2020 2020 2020 2020 2020 2020 2020 782c                x,
-00007390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000073a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000073b0: 2020 2020 2020 2020 2020 2020 2078 2c0a               x,.
-000073c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000073d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000073e0: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
-000073f0: 3d6d 6173 6b2c 0a20 2020 2020 2020 2020  =mask,.         
-00007400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007420: 2020 2064 726f 706f 7574 5f70 3d73 615f     dropout_p=sa_
-00007430: 6472 6f70 6f75 745f 702c 0a20 2020 2020  dropout_p,.     
-00007440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007460: 2020 2020 2020 2061 646a 5f6d 6174 7269         adj_matri
-00007470: 783d 6164 6a5f 6d61 7472 6978 2c0a 2020  x=adj_matrix,.  
-00007480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000074a0: 2020 2020 2020 2020 2020 6469 7374 616e            distan
-000074b0: 6365 5f6d 6174 7269 783d 6469 7374 616e  ce_matrix=distan
-000074c0: 6365 5f6d 6174 7269 7829 290a 2020 2020  ce_matrix)).    
-000074d0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-000074e0: 7375 626c 6179 6572 5b31 5d28 782c 2073  sublayer[1](x, s
-000074f0: 656c 662e 6665 6564 5f66 6f72 7761 7264  elf.feed_forward
-00007500: 2878 2929 0a0a 0a63 6c61 7373 2053 7562  (x))...class Sub
-00007510: 6c61 7965 7243 6f6e 6e65 6374 696f 6e28  layerConnection(
-00007520: 6e6e 2e4d 6f64 756c 6529 3a0a 2020 2020  nn.Module):.    
-00007530: 2222 2253 7562 6c61 7965 7243 6f6e 6e65  """SublayerConne
-00007540: 6374 696f 6e20 6c61 7965 7220 6261 7365  ction layer base
-00007550: 6420 6f6e 2074 6865 2070 6170 6572 2060  d on the paper `
-00007560: 4174 7465 6e74 696f 6e20 4973 2041 6c6c  Attention Is All
-00007570: 2059 6f75 204e 6565 6420 3c68 7474 7073   You Need <https
-00007580: 3a2f 2f61 7278 6976 2e6f 7267 2f61 6273  ://arxiv.org/abs
-00007590: 2f31 3730 362e 3033 3736 323e 605f 2e0a  /1706.03762>`_..
-000075a0: 0a20 2020 2054 6865 2053 7562 6c61 7965  .    The Sublaye
-000075b0: 7243 6f6e 6e65 6374 696f 6e20 6e6f 726d  rConnection norm
-000075c0: 616c 697a 6573 2061 6e64 2061 6464 7320  alizes and adds 
-000075d0: 6472 6f70 6f75 7420 746f 206f 7574 7075  dropout to outpu
-000075e0: 7420 7465 6e73 6f72 206f 6620 616e 2061  t tensor of an a
-000075f0: 7262 6974 6172 7920 6c61 7965 722e 0a20  rbitary layer.. 
-00007600: 2020 2049 7420 6675 7274 6865 7220 6164     It further ad
-00007610: 6473 2061 2072 6573 6964 7561 6c20 6c61  ds a residual la
-00007620: 7965 7220 636f 6e6e 6563 7469 6f6e 2062  yer connection b
-00007630: 6574 7765 656e 2074 6865 2069 6e70 7574  etween the input
-00007640: 206f 6620 7468 6520 6172 6269 7461 7279   of the arbitary
-00007650: 206c 6179 6572 2061 6e64 2074 6865 2064   layer and the d
-00007660: 726f 706f 7574 2d61 646a 7573 7465 6420  ropout-adjusted 
-00007670: 6c61 7965 7220 6f75 7470 7574 2e0a 0a20  layer output... 
-00007680: 2020 2045 7861 6d70 6c65 730a 2020 2020     Examples.    
-00007690: 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e 3e3e  --------.    >>>
-000076a0: 2066 726f 6d20 6465 6570 6368 656d 2e6d   from deepchem.m
-000076b0: 6f64 656c 732e 746f 7263 685f 6d6f 6465  odels.torch_mode
-000076c0: 6c73 2e6c 6179 6572 7320 696d 706f 7274  ls.layers import
-000076d0: 2053 7562 6c61 7965 7243 6f6e 6e65 6374   SublayerConnect
-000076e0: 696f 6e0a 2020 2020 3e3e 3e20 7363 616c  ion.    >>> scal
-000076f0: 6520 3d20 302e 3335 0a20 2020 203e 3e3e  e = 0.35.    >>>
-00007700: 206c 6179 6572 203d 2053 7562 6c61 7965   layer = Sublaye
-00007710: 7243 6f6e 6e65 6374 696f 6e28 322c 2030  rConnection(2, 0
-00007720: 2e29 0a20 2020 203e 3e3e 2069 6e70 7574  .).    >>> input
-00007730: 5f61 7220 3d20 746f 7263 682e 7465 6e73  _ar = torch.tens
-00007740: 6f72 285b 5b31 2e2c 2032 2e5d 2c20 5b35  or([[1., 2.], [5
-00007750: 2e2c 2036 2e5d 5d29 0a20 2020 203e 3e3e  ., 6.]]).    >>>
-00007760: 206f 7574 7075 7420 3d20 6c61 7965 7228   output = layer(
-00007770: 696e 7075 745f 6172 2c20 696e 7075 745f  input_ar, input_
-00007780: 6172 290a 2020 2222 220a 0a20 2020 2064  ar).  """..    d
-00007790: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-000077a0: 2c20 7369 7a65 3a20 696e 742c 2064 726f  , size: int, dro
-000077b0: 706f 7574 5f70 3a20 666c 6f61 7420 3d20  pout_p: float = 
-000077c0: 302e 3029 3a0a 2020 2020 2020 2020 2222  0.0):.        ""
-000077d0: 2249 6e69 7469 616c 697a 6520 6120 5375  "Initialize a Su
-000077e0: 626c 6179 6572 436f 6e6e 6563 7469 6f6e  blayerConnection
-000077f0: 204c 6179 6572 2e0a 0a20 2020 2020 2020   Layer...       
-00007800: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00007810: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00007820: 2020 2020 2020 2073 697a 653a 2069 6e74         size: int
-00007830: 0a20 2020 2020 2020 2020 2020 2053 697a  .            Siz
-00007840: 6520 6f66 206c 6179 6572 2e0a 2020 2020  e of layer..    
-00007850: 2020 2020 6472 6f70 6f75 745f 703a 2066      dropout_p: f
-00007860: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
-00007870: 2044 726f 706f 7574 2070 726f 6261 6269   Dropout probabi
-00007880: 6c69 7479 2e0a 2020 2020 2020 2020 2222  lity..        ""
-00007890: 220a 2020 2020 2020 2020 7375 7065 7228  ".        super(
-000078a0: 5375 626c 6179 6572 436f 6e6e 6563 7469  SublayerConnecti
-000078b0: 6f6e 2c20 7365 6c66 292e 5f5f 696e 6974  on, self).__init
-000078c0: 5f5f 2829 0a20 2020 2020 2020 2073 656c  __().        sel
-000078d0: 662e 6e6f 726d 203d 206e 6e2e 4c61 7965  f.norm = nn.Laye
-000078e0: 724e 6f72 6d28 7369 7a65 290a 2020 2020  rNorm(size).    
-000078f0: 2020 2020 7365 6c66 2e64 726f 706f 7574      self.dropout
-00007900: 5f70 203d 206e 6e2e 4472 6f70 6f75 7428  _p = nn.Dropout(
-00007910: 6472 6f70 6f75 745f 7029 0a0a 2020 2020  dropout_p)..    
-00007920: 6465 6620 666f 7277 6172 6428 7365 6c66  def forward(self
-00007930: 2c20 783a 2074 6f72 6368 2e54 656e 736f  , x: torch.Tenso
-00007940: 722c 206f 7574 7075 743a 2074 6f72 6368  r, output: torch
-00007950: 2e54 656e 736f 7229 202d 3e20 746f 7263  .Tensor) -> torc
-00007960: 682e 5465 6e73 6f72 3a0a 2020 2020 2020  h.Tensor:.      
-00007970: 2020 2222 224f 7574 7075 7420 636f 6d70    """Output comp
-00007980: 7574 6174 696f 6e20 666f 7220 7468 6520  utation for the 
-00007990: 5375 626c 6179 6572 436f 6e6e 6563 7469  SublayerConnecti
-000079a0: 6f6e 206c 6179 6572 2e0a 0a20 2020 2020  on layer...     
-000079b0: 2020 2054 616b 6573 2061 6e20 696e 7075     Takes an inpu
-000079c0: 7420 7465 6e73 6f72 2078 2c20 7468 656e  t tensor x, then
-000079d0: 2061 6464 7320 7468 6520 6472 6f70 6f75   adds the dropou
-000079e0: 742d 6164 6a75 7374 6564 2073 7562 6c61  t-adjusted subla
-000079f0: 7965 7220 6f75 7470 7574 2066 6f72 206e  yer output for n
-00007a00: 6f72 6d61 6c69 7a65 6420 7820 746f 2069  ormalized x to i
-00007a10: 742e 0a20 2020 2020 2020 2054 6869 7320  t..        This 
-00007a20: 6973 2064 6f6e 6520 746f 2061 6464 2061  is done to add a
-00007a30: 2072 6573 6964 7561 6c20 636f 6e6e 6563   residual connec
-00007a40: 7469 6f6e 2066 6f6c 6c6f 7765 6420 6279  tion followed by
-00007a50: 204c 6179 6572 4e6f 726d 2e0a 0a20 2020   LayerNorm...   
-00007a60: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-00007a70: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00007a80: 2d2d 0a20 2020 2020 2020 2078 3a20 746f  --.        x: to
-00007a90: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
-00007aa0: 2020 2020 2020 2049 6e70 7574 2074 656e         Input ten
-00007ab0: 736f 722e 0a20 2020 2020 2020 206f 7574  sor..        out
-00007ac0: 7075 743a 2074 6f72 6368 2e54 656e 736f  put: torch.Tenso
-00007ad0: 720a 2020 2020 2020 2020 2020 2020 4c61  r.            La
-00007ae0: 7965 7220 7768 6f73 6520 6e6f 726d 616c  yer whose normal
-00007af0: 697a 6564 206f 7574 7075 7420 7769 6c6c  ized output will
-00007b00: 2062 6520 6164 6465 6420 746f 2078 2e0a   be added to x..
-00007b10: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00007b20: 2020 2020 6966 2078 2069 7320 4e6f 6e65      if x is None
-00007b30: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00007b40: 7475 726e 2073 656c 662e 6472 6f70 6f75  turn self.dropou
-00007b50: 745f 7028 7365 6c66 2e6e 6f72 6d28 6f75  t_p(self.norm(ou
-00007b60: 7470 7574 2929 0a20 2020 2020 2020 2072  tput)).        r
-00007b70: 6574 7572 6e20 7820 2b20 7365 6c66 2e64  eturn x + self.d
-00007b80: 726f 706f 7574 5f70 2873 656c 662e 6e6f  ropout_p(self.no
-00007b90: 726d 286f 7574 7075 7429 290a 0a0a 636c  rm(output))...cl
-00007ba0: 6173 7320 506f 7369 7469 6f6e 7769 7365  ass Positionwise
-00007bb0: 4665 6564 466f 7277 6172 6428 6e6e 2e4d  FeedForward(nn.M
-00007bc0: 6f64 756c 6529 3a0a 2020 2020 2222 2250  odule):.    """P
-00007bd0: 6f73 6974 696f 6e77 6973 6546 6565 6446  ositionwiseFeedF
-00007be0: 6f72 7761 7264 2069 7320 6120 6c61 7965  orward is a laye
-00007bf0: 7220 7573 6564 2074 6f20 6465 6669 6e65  r used to define
-00007c00: 2074 6865 2070 6f73 6974 696f 6e2d 7769   the position-wi
-00007c10: 7365 2066 6565 642d 666f 7277 6172 6420  se feed-forward 
-00007c20: 2846 464e 2920 616c 676f 7269 7468 6d20  (FFN) algorithm 
-00007c30: 666f 7220 7468 6520 4d6f 6c65 6375 6c61  for the Molecula
-00007c40: 7220 4174 7465 6e74 696f 6e20 5472 616e  r Attention Tran
-00007c50: 7366 6f72 6d65 7220 5b31 5d5f 0a0a 2020  sformer [1]_..  
-00007c60: 2020 4561 6368 206c 6179 6572 2069 6e20    Each layer in 
-00007c70: 7468 6520 4d41 5420 656e 636f 6465 7220  the MAT encoder 
-00007c80: 636f 6e74 6169 6e73 2061 2066 756c 6c79  contains a fully
-00007c90: 2063 6f6e 6e65 6374 6564 2066 6565 642d   connected feed-
-00007ca0: 666f 7277 6172 6420 6e65 7477 6f72 6b20  forward network 
-00007cb0: 7768 6963 6820 6170 706c 6965 7320 7477  which applies tw
-00007cc0: 6f20 6c69 6e65 6172 2074 7261 6e73 666f  o linear transfo
-00007cd0: 726d 6174 696f 6e73 2061 6e64 2074 6865  rmations and the
-00007ce0: 2067 6976 656e 2061 6374 6976 6174 696f   given activatio
-00007cf0: 6e20 6675 6e63 7469 6f6e 2e0a 2020 2020  n function..    
-00007d00: 5468 6973 2069 7320 646f 6e65 2069 6e20  This is done in 
-00007d10: 6164 6469 7469 6f6e 2074 6f20 7468 6520  addition to the 
-00007d20: 5375 626c 6179 6572 436f 6e6e 6563 7469  SublayerConnecti
-00007d30: 6f6e 206d 6f64 756c 652e 0a0a 2020 2020  on module...    
-00007d40: 4e6f 7465 3a20 5468 6973 206d 6f64 6966  Note: This modif
-00007d50: 6965 6420 7665 7273 696f 6e20 6f66 2060  ied version of `
-00007d60: 506f 7369 7469 6f6e 7769 7365 4665 6564  PositionwiseFeed
-00007d70: 466f 7277 6172 6460 2063 6c61 7373 2063  Forward` class c
-00007d80: 6f6e 7461 696e 7320 6064 726f 706f 7574  ontains `dropout
-00007d90: 5f61 745f 696e 7075 745f 6e6f 5f61 6374  _at_input_no_act
-00007da0: 6020 636f 6e64 6974 696f 6e20 746f 2066  ` condition to f
-00007db0: 6163 696c 6974 6174 6520 6974 7320 7573  acilitate its us
-00007dc0: 6520 696e 2064 6566 696e 696e 670a 2020  e in defining.  
-00007dd0: 2020 2020 2020 7468 6520 6665 6564 2d66        the feed-f
-00007de0: 6f72 7761 7264 2028 4646 4e29 2061 6c67  orward (FFN) alg
-00007df0: 6f72 6974 686d 2066 6f72 2074 6865 2044  orithm for the D
-00007e00: 6972 6563 7465 6420 4d65 7373 6167 6520  irected Message 
-00007e10: 5061 7373 696e 6720 4e65 7572 616c 204e  Passing Neural N
-00007e20: 6574 776f 726b 2028 442d 4d50 4e4e 2920  etwork (D-MPNN) 
-00007e30: 5b32 5d5f 0a0a 2020 2020 5265 6665 7265  [2]_..    Refere
-00007e40: 6e63 6573 0a20 2020 202d 2d2d 2d2d 2d2d  nces.    -------
-00007e50: 2d2d 2d0a 2020 2020 2e2e 205b 315d 204c  ---.    .. [1] L
-00007e60: 756b 6173 7a20 4d61 7a69 6172 6b61 2065  ukasz Maziarka e
-00007e70: 7420 616c 2e20 224d 6f6c 6563 756c 6520  t al. "Molecule 
-00007e80: 4174 7465 6e74 696f 6e20 5472 616e 7366  Attention Transf
-00007e90: 6f72 6d65 7222 2047 7261 7068 2052 6570  ormer" Graph Rep
-00007ea0: 7265 7365 6e74 6174 696f 6e20 4c65 6172  resentation Lear
-00007eb0: 6e69 6e67 2077 6f72 6b73 686f 7020 616e  ning workshop an
-00007ec0: 6420 4d61 6368 696e 6520 4c65 6172 6e69  d Machine Learni
-00007ed0: 6e67 2061 6e64 2074 6865 2050 6879 7369  ng and the Physi
-00007ee0: 6361 6c20 5363 6965 6e63 6573 2077 6f72  cal Sciences wor
-00007ef0: 6b73 686f 7020 6174 204e 6575 7249 5053  kshop at NeurIPS
-00007f00: 2032 3031 392e 2032 3032 302e 2068 7474   2019. 2020. htt
-00007f10: 7073 3a2f 2f61 7278 6976 2e6f 7267 2f61  ps://arxiv.org/a
-00007f20: 6273 2f32 3030 322e 3038 3236 340a 2020  bs/2002.08264.  
-00007f30: 2020 2e2e 205b 325d 2041 6e61 6c79 7a69    .. [2] Analyzi
-00007f40: 6e67 204c 6561 726e 6564 204d 6f6c 6563  ng Learned Molec
-00007f50: 756c 6172 2052 6570 7265 7365 6e74 6174  ular Representat
-00007f60: 696f 6e73 2066 6f72 2050 726f 7065 7274  ions for Propert
-00007f70: 7920 5072 6564 6963 7469 6f6e 2068 7474  y Prediction htt
-00007f80: 7073 3a2f 2f61 7278 6976 2e6f 7267 2f70  ps://arxiv.org/p
-00007f90: 6466 2f31 3930 342e 3031 3536 312e 7064  df/1904.01561.pd
-00007fa0: 660a 0a20 2020 2045 7861 6d70 6c65 730a  f..    Examples.
-00007fb0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-00007fc0: 203e 3e3e 2066 726f 6d20 6465 6570 6368   >>> from deepch
-00007fd0: 656d 2e6d 6f64 656c 732e 746f 7263 685f  em.models.torch_
-00007fe0: 6d6f 6465 6c73 2e6c 6179 6572 7320 696d  models.layers im
-00007ff0: 706f 7274 2050 6f73 6974 696f 6e77 6973  port Positionwis
-00008000: 6546 6565 6446 6f72 7761 7264 0a20 2020  eFeedForward.   
-00008010: 203e 3e3e 2066 6565 645f 6677 645f 6c61   >>> feed_fwd_la
-00008020: 7965 7220 3d20 506f 7369 7469 6f6e 7769  yer = Positionwi
-00008030: 7365 4665 6564 466f 7277 6172 6428 645f  seFeedForward(d_
-00008040: 696e 7075 7420 3d20 322c 2064 5f68 6964  input = 2, d_hid
-00008050: 6465 6e20 3d20 322c 2064 5f6f 7574 7075  den = 2, d_outpu
-00008060: 7420 3d20 322c 2061 6374 6976 6174 696f  t = 2, activatio
-00008070: 6e20 3d20 2772 656c 7527 2c20 6e5f 6c61  n = 'relu', n_la
-00008080: 7965 7273 203d 2031 2c20 6472 6f70 6f75  yers = 1, dropou
-00008090: 745f 7020 3d20 302e 3129 0a20 2020 203e  t_p = 0.1).    >
-000080a0: 3e3e 2069 6e70 7574 5f74 656e 736f 7220  >> input_tensor 
-000080b0: 3d20 746f 7263 682e 7465 6e73 6f72 285b  = torch.tensor([
-000080c0: 5b31 2e2c 2032 2e5d 2c20 5b35 2e2c 2036  [1., 2.], [5., 6
-000080d0: 2e5d 5d29 0a20 2020 203e 3e3e 206f 7574  .]]).    >>> out
-000080e0: 7075 745f 7465 6e73 6f72 203d 2066 6565  put_tensor = fee
-000080f0: 645f 6677 645f 6c61 7965 7228 696e 7075  d_fwd_layer(inpu
-00008100: 745f 7465 6e73 6f72 290a 2020 2222 220a  t_tensor).  """.
-00008110: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-00008120: 5f28 7365 6c66 2c0a 2020 2020 2020 2020  _(self,.        
-00008130: 2020 2020 2020 2020 2064 5f69 6e70 7574           d_input
-00008140: 3a20 696e 7420 3d20 3130 3234 2c0a 2020  : int = 1024,.  
-00008150: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00008160: 5f68 6964 6465 6e3a 2069 6e74 203d 2031  _hidden: int = 1
-00008170: 3032 342c 0a20 2020 2020 2020 2020 2020  024,.           
-00008180: 2020 2020 2020 645f 6f75 7470 7574 3a20        d_output: 
-00008190: 696e 7420 3d20 3130 3234 2c0a 2020 2020  int = 1024,.    
-000081a0: 2020 2020 2020 2020 2020 2020 2061 6374               act
-000081b0: 6976 6174 696f 6e3a 2073 7472 203d 2027  ivation: str = '
-000081c0: 6c65 616b 7972 656c 7527 2c0a 2020 2020  leakyrelu',.    
-000081d0: 2020 2020 2020 2020 2020 2020 206e 5f6c               n_l
-000081e0: 6179 6572 733a 2069 6e74 203d 2031 2c0a  ayers: int = 1,.
-000081f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008200: 2064 726f 706f 7574 5f70 3a20 666c 6f61   dropout_p: floa
-00008210: 7420 3d20 302e 302c 0a20 2020 2020 2020  t = 0.0,.       
-00008220: 2020 2020 2020 2020 2020 6472 6f70 6f75            dropou
-00008230: 745f 6174 5f69 6e70 7574 5f6e 6f5f 6163  t_at_input_no_ac
-00008240: 743a 2062 6f6f 6c20 3d20 4661 6c73 6529  t: bool = False)
-00008250: 3a0a 2020 2020 2020 2020 2222 2249 6e69  :.        """Ini
-00008260: 7469 616c 697a 6520 6120 506f 7369 7469  tialize a Positi
-00008270: 6f6e 7769 7365 4665 6564 466f 7277 6172  onwiseFeedForwar
-00008280: 6420 6c61 7965 722e 0a0a 2020 2020 2020  d layer...      
-00008290: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-000082a0: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-000082b0: 2020 2020 2020 2020 645f 696e 7075 743a          d_input:
-000082c0: 2069 6e74 0a20 2020 2020 2020 2020 2020   int.           
-000082d0: 2053 697a 6520 6f66 2069 6e70 7574 206c   Size of input l
-000082e0: 6179 6572 2e0a 2020 2020 2020 2020 645f  ayer..        d_
-000082f0: 6869 6464 656e 3a20 696e 7420 2873 616d  hidden: int (sam
-00008300: 6520 6173 2064 5f69 6e70 7574 2069 6620  e as d_input if 
-00008310: 645f 6f75 7470 7574 203d 2030 290a 2020  d_output = 0).  
-00008320: 2020 2020 2020 2020 2020 5369 7a65 206f            Size o
-00008330: 6620 6869 6464 656e 206c 6179 6572 2e0a  f hidden layer..
-00008340: 2020 2020 2020 2020 645f 6f75 7470 7574          d_output
-00008350: 3a20 696e 7420 2873 616d 6520 6173 2064  : int (same as d
-00008360: 5f69 6e70 7574 2069 6620 645f 6f75 7470  _input if d_outp
-00008370: 7574 203d 2030 290a 2020 2020 2020 2020  ut = 0).        
-00008380: 2020 2020 5369 7a65 206f 6620 6f75 7470      Size of outp
-00008390: 7574 206c 6179 6572 2e0a 2020 2020 2020  ut layer..      
-000083a0: 2020 6163 7469 7661 7469 6f6e 3a20 7374    activation: st
-000083b0: 720a 2020 2020 2020 2020 2020 2020 4163  r.            Ac
-000083c0: 7469 7661 7469 6f6e 2066 756e 6374 696f  tivation functio
-000083d0: 6e20 746f 2062 6520 7573 6564 2e20 4361  n to be used. Ca
-000083e0: 6e20 6368 6f6f 7365 2062 6574 7765 656e  n choose between
-000083f0: 2027 7265 6c75 2720 666f 7220 5265 4c55   'relu' for ReLU
-00008400: 2c20 276c 6561 6b79 7265 6c75 2720 666f  , 'leakyrelu' fo
-00008410: 7220 4c65 616b 7952 654c 552c 2027 7072  r LeakyReLU, 'pr
-00008420: 656c 7527 2066 6f72 2050 5265 4c55 2c0a  elu' for PReLU,.
-00008430: 2020 2020 2020 2020 2020 2020 2774 616e              'tan
-00008440: 6827 2066 6f72 2054 616e 482c 2027 7365  h' for TanH, 'se
-00008450: 6c75 2720 666f 7220 5345 4c55 2c20 2765  lu' for SELU, 'e
-00008460: 6c75 2720 666f 7220 454c 5520 616e 6420  lu' for ELU and 
-00008470: 276c 696e 6561 7227 2066 6f72 206c 696e  'linear' for lin
-00008480: 6561 7220 6163 7469 7661 7469 6f6e 2e0a  ear activation..
-00008490: 2020 2020 2020 2020 6e5f 6c61 7965 7273          n_layers
-000084a0: 3a20 696e 740a 2020 2020 2020 2020 2020  : int.          
-000084b0: 2020 4e75 6d62 6572 206f 6620 6c61 7965    Number of laye
-000084c0: 7273 2e0a 2020 2020 2020 2020 6472 6f70  rs..        drop
-000084d0: 6f75 745f 703a 2066 6c6f 6174 0a20 2020  out_p: float.   
-000084e0: 2020 2020 2020 2020 2044 726f 706f 7574           Dropout
-000084f0: 2070 726f 6261 6269 6c69 7479 2e0a 2020   probability..  
-00008500: 2020 2020 2020 6472 6f70 6f75 745f 6174        dropout_at
-00008510: 5f69 6e70 7574 5f6e 6f5f 6163 743a 2062  _input_no_act: b
-00008520: 6f6f 6c0a 2020 2020 2020 2020 2020 2020  ool.            
-00008530: 4966 2074 7275 652c 2064 726f 706f 7574  If true, dropout
-00008540: 2069 7320 6170 706c 6965 6420 6f6e 2074   is applied on t
-00008550: 6865 2069 6e70 7574 2074 656e 736f 722e  he input tensor.
-00008560: 2046 6f72 2073 696e 676c 6520 6c61 7965   For single laye
-00008570: 722c 2069 7420 6973 206e 6f74 2070 6173  r, it is not pas
-00008580: 7365 6420 746f 2061 6e20 6163 7469 7661  sed to an activa
-00008590: 7469 6f6e 2066 756e 6374 696f 6e2e 0a20  tion function.. 
-000085a0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000085b0: 2020 2073 7570 6572 2850 6f73 6974 696f     super(Positio
-000085c0: 6e77 6973 6546 6565 6446 6f72 7761 7264  nwiseFeedForward
-000085d0: 2c20 7365 6c66 292e 5f5f 696e 6974 5f5f  , self).__init__
-000085e0: 2829 0a0a 2020 2020 2020 2020 7365 6c66  ()..        self
-000085f0: 2e64 726f 706f 7574 5f61 745f 696e 7075  .dropout_at_inpu
-00008600: 745f 6e6f 5f61 6374 3a20 626f 6f6c 203d  t_no_act: bool =
-00008610: 2064 726f 706f 7574 5f61 745f 696e 7075   dropout_at_inpu
-00008620: 745f 6e6f 5f61 6374 0a0a 2020 2020 2020  t_no_act..      
-00008630: 2020 6966 2061 6374 6976 6174 696f 6e20    if activation 
-00008640: 3d3d 2027 7265 6c75 273a 0a20 2020 2020  == 'relu':.     
-00008650: 2020 2020 2020 2073 656c 662e 6163 7469         self.acti
-00008660: 7661 7469 6f6e 3a20 416e 7920 3d20 6e6e  vation: Any = nn
-00008670: 2e52 654c 5528 290a 0a20 2020 2020 2020  .ReLU()..       
-00008680: 2065 6c69 6620 6163 7469 7661 7469 6f6e   elif activation
-00008690: 203d 3d20 276c 6561 6b79 7265 6c75 273a   == 'leakyrelu':
-000086a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000086b0: 662e 6163 7469 7661 7469 6f6e 203d 206e  f.activation = n
-000086c0: 6e2e 4c65 616b 7952 654c 5528 302e 3129  n.LeakyReLU(0.1)
-000086d0: 0a0a 2020 2020 2020 2020 656c 6966 2061  ..        elif a
-000086e0: 6374 6976 6174 696f 6e20 3d3d 2027 7072  ctivation == 'pr
-000086f0: 656c 7527 3a0a 2020 2020 2020 2020 2020  elu':.          
-00008700: 2020 7365 6c66 2e61 6374 6976 6174 696f    self.activatio
-00008710: 6e20 3d20 6e6e 2e50 5265 4c55 2829 0a0a  n = nn.PReLU()..
-00008720: 2020 2020 2020 2020 656c 6966 2061 6374          elif act
-00008730: 6976 6174 696f 6e20 3d3d 2027 7461 6e68  ivation == 'tanh
-00008740: 273a 0a20 2020 2020 2020 2020 2020 2073  ':.            s
-00008750: 656c 662e 6163 7469 7661 7469 6f6e 203d  elf.activation =
-00008760: 206e 6e2e 5461 6e68 2829 0a0a 2020 2020   nn.Tanh()..    
-00008770: 2020 2020 656c 6966 2061 6374 6976 6174      elif activat
-00008780: 696f 6e20 3d3d 2027 7365 6c75 273a 0a20  ion == 'selu':. 
-00008790: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000087a0: 6163 7469 7661 7469 6f6e 203d 206e 6e2e  activation = nn.
-000087b0: 5345 4c55 2829 0a0a 2020 2020 2020 2020  SELU()..        
-000087c0: 656c 6966 2061 6374 6976 6174 696f 6e20  elif activation 
-000087d0: 3d3d 2027 656c 7527 3a0a 2020 2020 2020  == 'elu':.      
-000087e0: 2020 2020 2020 7365 6c66 2e61 6374 6976        self.activ
-000087f0: 6174 696f 6e20 3d20 6e6e 2e45 4c55 2829  ation = nn.ELU()
-00008800: 0a0a 2020 2020 2020 2020 656c 6966 2061  ..        elif a
-00008810: 6374 6976 6174 696f 6e20 3d3d 2022 6c69  ctivation == "li
-00008820: 6e65 6172 223a 0a20 2020 2020 2020 2020  near":.         
-00008830: 2020 2073 656c 662e 6163 7469 7661 7469     self.activati
-00008840: 6f6e 203d 206c 616d 6264 6120 783a 2078  on = lambda x: x
-00008850: 0a0a 2020 2020 2020 2020 7365 6c66 2e6e  ..        self.n
-00008860: 5f6c 6179 6572 733a 2069 6e74 203d 206e  _layers: int = n
-00008870: 5f6c 6179 6572 730a 2020 2020 2020 2020  _layers.        
-00008880: 645f 6f75 7470 7574 203d 2064 5f6f 7574  d_output = d_out
-00008890: 7075 7420 6966 2064 5f6f 7574 7075 7420  put if d_output 
-000088a0: 213d 2030 2065 6c73 6520 645f 696e 7075  != 0 else d_inpu
-000088b0: 740a 2020 2020 2020 2020 645f 6869 6464  t.        d_hidd
-000088c0: 656e 203d 2064 5f68 6964 6465 6e20 6966  en = d_hidden if
-000088d0: 2064 5f68 6964 6465 6e20 213d 2030 2065   d_hidden != 0 e
-000088e0: 6c73 6520 645f 696e 7075 740a 0a20 2020  lse d_input..   
-000088f0: 2020 2020 2069 6620 6e5f 6c61 7965 7273       if n_layers
-00008900: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
-00008910: 2020 2073 656c 662e 6c69 6e65 6172 733a     self.linears:
-00008920: 2041 6e79 203d 205b 6e6e 2e4c 696e 6561   Any = [nn.Linea
-00008930: 7228 645f 696e 7075 742c 2064 5f6f 7574  r(d_input, d_out
-00008940: 7075 7429 5d0a 0a20 2020 2020 2020 2065  put)]..        e
-00008950: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00008960: 2073 656c 662e 6c69 6e65 6172 7320 3d20   self.linears = 
-00008970: 5b6e 6e2e 4c69 6e65 6172 2864 5f69 6e70  [nn.Linear(d_inp
-00008980: 7574 2c20 645f 6869 6464 656e 295d 202b  ut, d_hidden)] +
-00008990: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-000089a0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-000089b0: 6e6e 2e4c 696e 6561 7228 645f 6869 6464  nn.Linear(d_hidd
-000089c0: 656e 2c20 645f 6869 6464 656e 2920 666f  en, d_hidden) fo
-000089d0: 7220 5f20 696e 2072 616e 6765 286e 5f6c  r _ in range(n_l
-000089e0: 6179 6572 7320 2d20 3229 5d20 2b20 5c0a  ayers - 2)] + \.
-000089f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008a00: 2020 2020 2020 2020 2020 2020 5b6e 6e2e              [nn.
-00008a10: 4c69 6e65 6172 2864 5f68 6964 6465 6e2c  Linear(d_hidden,
-00008a20: 2064 5f6f 7574 7075 7429 5d0a 0a20 2020   d_output)]..   
-00008a30: 2020 2020 2073 656c 662e 6c69 6e65 6172       self.linear
-00008a40: 7320 3d20 6e6e 2e4d 6f64 756c 654c 6973  s = nn.ModuleLis
-00008a50: 7428 7365 6c66 2e6c 696e 6561 7273 290a  t(self.linears).
-00008a60: 2020 2020 2020 2020 6472 6f70 6f75 745f          dropout_
-00008a70: 6c61 7965 7220 3d20 6e6e 2e44 726f 706f  layer = nn.Dropo
-00008a80: 7574 2864 726f 706f 7574 5f70 290a 2020  ut(dropout_p).  
-00008a90: 2020 2020 2020 7365 6c66 2e64 726f 706f        self.dropo
-00008aa0: 7574 5f70 203d 206e 6e2e 4d6f 6475 6c65  ut_p = nn.Module
-00008ab0: 4c69 7374 285b 6472 6f70 6f75 745f 6c61  List([dropout_la
-00008ac0: 7965 7220 666f 7220 5f20 696e 2072 616e  yer for _ in ran
-00008ad0: 6765 286e 5f6c 6179 6572 7329 5d29 0a0a  ge(n_layers)])..
-00008ae0: 2020 2020 6465 6620 666f 7277 6172 6428      def forward(
-00008af0: 7365 6c66 2c20 783a 2074 6f72 6368 2e54  self, x: torch.T
-00008b00: 656e 736f 7229 202d 3e20 746f 7263 682e  ensor) -> torch.
-00008b10: 5465 6e73 6f72 3a0a 2020 2020 2020 2020  Tensor:.        
-00008b20: 2222 224f 7574 7075 7420 436f 6d70 7574  """Output Comput
-00008b30: 6174 696f 6e20 666f 7220 7468 6520 506f  ation for the Po
-00008b40: 7369 7469 6f6e 7769 7365 4665 6564 466f  sitionwiseFeedFo
-00008b50: 7277 6172 6420 6c61 7965 722e 0a0a 2020  rward layer...  
-00008b60: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-00008b70: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00008b80: 2d2d 2d0a 2020 2020 2020 2020 783a 2074  ---.        x: t
-00008b90: 6f72 6368 2e54 656e 736f 720a 2020 2020  orch.Tensor.    
-00008ba0: 2020 2020 2020 2020 496e 7075 7420 7465          Input te
-00008bb0: 6e73 6f72 2e0a 2020 2020 2020 2020 2222  nsor..        ""
-00008bc0: 220a 2020 2020 2020 2020 6966 206e 6f74  ".        if not
-00008bd0: 2073 656c 662e 6e5f 6c61 7965 7273 3a0a   self.n_layers:.
-00008be0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00008bf0: 726e 2078 0a0a 2020 2020 2020 2020 6966  rn x..        if
-00008c00: 2073 656c 662e 6e5f 6c61 7965 7273 203d   self.n_layers =
-00008c10: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
-00008c20: 2069 6620 7365 6c66 2e64 726f 706f 7574   if self.dropout
-00008c30: 5f61 745f 696e 7075 745f 6e6f 5f61 6374  _at_input_no_act
-00008c40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00008c50: 2020 7265 7475 726e 2073 656c 662e 6c69    return self.li
-00008c60: 6e65 6172 735b 305d 2873 656c 662e 6472  nears[0](self.dr
-00008c70: 6f70 6f75 745f 705b 305d 2878 2929 0a20  opout_p[0](x)). 
-00008c80: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00008c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008ca0: 2072 6574 7572 6e20 7365 6c66 2e64 726f   return self.dro
-00008cb0: 706f 7574 5f70 5b30 5d28 7365 6c66 2e61  pout_p[0](self.a
-00008cc0: 6374 6976 6174 696f 6e28 7365 6c66 2e6c  ctivation(self.l
-00008cd0: 696e 6561 7273 5b30 5d28 7829 2929 0a0a  inears[0](x)))..
-00008ce0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00008cf0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00008d00: 662e 6472 6f70 6f75 745f 6174 5f69 6e70  f.dropout_at_inp
-00008d10: 7574 5f6e 6f5f 6163 743a 0a20 2020 2020  ut_no_act:.     
-00008d20: 2020 2020 2020 2020 2020 2078 203d 2073             x = s
-00008d30: 656c 662e 6472 6f70 6f75 745f 705b 305d  elf.dropout_p[0]
-00008d40: 2878 290a 2020 2020 2020 2020 2020 2020  (x).            
-00008d50: 666f 7220 6920 696e 2072 616e 6765 2873  for i in range(s
-00008d60: 656c 662e 6e5f 6c61 7965 7273 202d 2031  elf.n_layers - 1
-00008d70: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00008d80: 2020 2078 203d 2073 656c 662e 6472 6f70     x = self.drop
-00008d90: 6f75 745f 705b 695d 2873 656c 662e 6163  out_p[i](self.ac
-00008da0: 7469 7661 7469 6f6e 2873 656c 662e 6c69  tivation(self.li
-00008db0: 6e65 6172 735b 695d 2878 2929 290a 2020  nears[i](x))).  
-00008dc0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00008dd0: 2073 656c 662e 6c69 6e65 6172 735b 2d31   self.linears[-1
-00008de0: 5d28 7829 0a0a 0a63 6c61 7373 204d 4154  ](x)...class MAT
-00008df0: 456d 6265 6464 696e 6728 6e6e 2e4d 6f64  Embedding(nn.Mod
-00008e00: 756c 6529 3a0a 2020 2020 2222 2245 6d62  ule):.    """Emb
-00008e10: 6564 6469 6e67 206c 6179 6572 2074 6f20  edding layer to 
-00008e20: 6372 6561 7465 2065 6d62 6564 6469 6e67  create embedding
-00008e30: 2066 6f72 2069 6e70 7574 732e 0a0a 2020   for inputs...  
-00008e40: 2020 496e 2061 6e20 656d 6265 6464 696e    In an embeddin
-00008e50: 6720 6c61 7965 722c 2069 6e70 7574 2069  g layer, input i
-00008e60: 7320 7461 6b65 6e20 616e 6420 636f 6e76  s taken and conv
-00008e70: 6572 7465 6420 746f 2061 2076 6563 746f  erted to a vecto
-00008e80: 7220 7265 7072 6573 656e 7461 7469 6f6e  r representation
-00008e90: 2066 6f72 2065 6163 6820 696e 7075 742e   for each input.
-00008ea0: 0a20 2020 2049 6e20 7468 6520 4d41 5445  .    In the MATE
-00008eb0: 6d62 6564 6469 6e67 206c 6179 6572 2c20  mbedding layer, 
-00008ec0: 616e 2069 6e70 7574 2074 656e 736f 7220  an input tensor 
-00008ed0: 6973 2070 726f 6365 7373 6564 2074 6872  is processed thr
-00008ee0: 6f75 6768 2061 2064 726f 706f 7574 2d61  ough a dropout-a
-00008ef0: 646a 7573 7465 6420 6c69 6e65 6172 206c  djusted linear l
-00008f00: 6179 6572 2061 6e64 2074 6865 2072 6573  ayer and the res
-00008f10: 756c 7461 6e74 2076 6563 746f 7220 6973  ultant vector is
-00008f20: 2072 6574 7572 6e65 642e 0a0a 2020 2020   returned...    
-00008f30: 5265 6665 7265 6e63 6573 0a20 2020 202d  References.    -
-00008f40: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2e2e  ---------.    ..
-00008f50: 205b 315d 204c 756b 6173 7a20 4d61 7a69   [1] Lukasz Mazi
-00008f60: 6172 6b61 2065 7420 616c 2e20 224d 6f6c  arka et al. "Mol
-00008f70: 6563 756c 6520 4174 7465 6e74 696f 6e20  ecule Attention 
-00008f80: 5472 616e 7366 6f72 6d65 7222 2047 7261  Transformer" Gra
-00008f90: 7068 2052 6570 7265 7365 6e74 6174 696f  ph Representatio
-00008fa0: 6e20 4c65 6172 6e69 6e67 2077 6f72 6b73  n Learning works
-00008fb0: 686f 7020 616e 6420 4d61 6368 696e 6520  hop and Machine 
-00008fc0: 4c65 6172 6e69 6e67 2061 6e64 2074 6865  Learning and the
-00008fd0: 2050 6879 7369 6361 6c20 5363 6965 6e63   Physical Scienc
-00008fe0: 6573 2077 6f72 6b73 686f 7020 6174 204e  es workshop at N
-00008ff0: 6575 7249 5053 2032 3031 392e 2032 3032  eurIPS 2019. 202
-00009000: 302e 2068 7474 7073 3a2f 2f61 7278 6976  0. https://arxiv
-00009010: 2e6f 7267 2f61 6273 2f32 3030 322e 3038  .org/abs/2002.08
-00009020: 3236 340a 0a20 2020 2045 7861 6d70 6c65  264..    Example
-00009030: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20  s.    --------. 
-00009040: 2020 203e 3e3e 2066 726f 6d20 6465 6570     >>> from deep
-00009050: 6368 656d 2e6d 6f64 656c 732e 746f 7263  chem.models.torc
-00009060: 685f 6d6f 6465 6c73 2e6c 6179 6572 7320  h_models.layers 
-00009070: 696d 706f 7274 204d 4154 456d 6265 6464  import MATEmbedd
-00009080: 696e 670a 2020 2020 3e3e 3e20 6c61 7965  ing.    >>> laye
-00009090: 7220 3d20 4d41 5445 6d62 6564 6469 6e67  r = MATEmbedding
-000090a0: 2864 5f69 6e70 7574 203d 2033 2c20 645f  (d_input = 3, d_
-000090b0: 6f75 7470 7574 203d 2033 2c20 6472 6f70  output = 3, drop
-000090c0: 6f75 745f 7020 3d20 302e 3229 0a20 2020  out_p = 0.2).   
-000090d0: 203e 3e3e 2069 6e70 7574 5f74 656e 736f   >>> input_tenso
-000090e0: 7220 3d20 746f 7263 682e 7465 6e73 6f72  r = torch.tensor
-000090f0: 285b 312e 2c20 322e 2c20 332e 5d29 0a20  ([1., 2., 3.]). 
-00009100: 2020 203e 3e3e 206f 7574 7075 7420 3d20     >>> output = 
-00009110: 6c61 7965 7228 696e 7075 745f 7465 6e73  layer(input_tens
-00009120: 6f72 290a 2020 2020 2222 220a 0a20 2020  or).    """..   
-00009130: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-00009140: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
-00009150: 2020 2020 2064 5f69 6e70 7574 3a20 696e       d_input: in
-00009160: 7420 3d20 3336 2c0a 2020 2020 2020 2020  t = 36,.        
-00009170: 2020 2020 2020 2020 2064 5f6f 7574 7075           d_outpu
-00009180: 743a 2069 6e74 203d 2031 3032 342c 0a20  t: int = 1024,. 
-00009190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000091a0: 6472 6f70 6f75 745f 703a 2066 6c6f 6174  dropout_p: float
-000091b0: 203d 2030 2e30 293a 0a20 2020 2020 2020   = 0.0):.       
-000091c0: 2022 2222 496e 6974 6961 6c69 7a65 2061   """Initialize a
-000091d0: 204d 4154 456d 6265 6464 696e 6720 6c61   MATEmbedding la
-000091e0: 7965 722e 0a0a 2020 2020 2020 2020 5061  yer...        Pa
-000091f0: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-00009200: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-00009210: 2020 2020 645f 696e 7075 743a 2069 6e74      d_input: int
-00009220: 0a20 2020 2020 2020 2020 2020 2053 697a  .            Siz
-00009230: 6520 6f66 2069 6e70 7574 206c 6179 6572  e of input layer
-00009240: 2e0a 2020 2020 2020 2020 645f 6f75 7470  ..        d_outp
-00009250: 7574 3a20 696e 740a 2020 2020 2020 2020  ut: int.        
-00009260: 2020 2020 5369 7a65 206f 6620 6f75 7470      Size of outp
-00009270: 7574 206c 6179 6572 2e0a 2020 2020 2020  ut layer..      
-00009280: 2020 6472 6f70 6f75 745f 703a 2066 6c6f    dropout_p: flo
-00009290: 6174 0a20 2020 2020 2020 2020 2020 2044  at.            D
-000092a0: 726f 706f 7574 2070 726f 6261 6269 6c69  ropout probabili
-000092b0: 7479 2066 6f72 206c 6179 6572 2e0a 2020  ty for layer..  
-000092c0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000092d0: 2020 7375 7065 7228 4d41 5445 6d62 6564    super(MATEmbed
-000092e0: 6469 6e67 2c20 7365 6c66 292e 5f5f 696e  ding, self).__in
-000092f0: 6974 5f5f 2829 0a20 2020 2020 2020 2073  it__().        s
-00009300: 656c 662e 6c69 6e65 6172 5f75 6e69 7420  elf.linear_unit 
-00009310: 3d20 6e6e 2e4c 696e 6561 7228 645f 696e  = nn.Linear(d_in
-00009320: 7075 742c 2064 5f6f 7574 7075 7429 0a20  put, d_output). 
-00009330: 2020 2020 2020 2073 656c 662e 6472 6f70         self.drop
-00009340: 6f75 7420 3d20 6e6e 2e44 726f 706f 7574  out = nn.Dropout
-00009350: 2864 726f 706f 7574 5f70 290a 0a20 2020  (dropout_p)..   
-00009360: 2064 6566 2066 6f72 7761 7264 2873 656c   def forward(sel
-00009370: 662c 2078 3a20 746f 7263 682e 5465 6e73  f, x: torch.Tens
-00009380: 6f72 2920 2d3e 2074 6f72 6368 2e54 656e  or) -> torch.Ten
-00009390: 736f 723a 0a20 2020 2020 2020 2022 2222  sor:.        """
-000093a0: 436f 6d70 7574 6174 696f 6e20 666f 7220  Computation for 
-000093b0: 7468 6520 4d41 5445 6d62 6564 6469 6e67  the MATEmbedding
-000093c0: 206c 6179 6572 2e0a 0a20 2020 2020 2020   layer...       
-000093d0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-000093e0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-000093f0: 2020 2020 2020 2078 3a20 746f 7263 682e         x: torch.
-00009400: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
-00009410: 2020 2049 6e70 7574 2074 656e 736f 7220     Input tensor 
-00009420: 746f 2062 6520 636f 6e76 6572 7465 6420  to be converted 
-00009430: 696e 746f 2061 2076 6563 746f 722e 0a20  into a vector.. 
-00009440: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00009450: 2020 2072 6574 7572 6e20 7365 6c66 2e64     return self.d
-00009460: 726f 706f 7574 2873 656c 662e 6c69 6e65  ropout(self.line
-00009470: 6172 5f75 6e69 7428 7829 290a 0a0a 636c  ar_unit(x))...cl
-00009480: 6173 7320 4d41 5447 656e 6572 6174 6f72  ass MATGenerator
-00009490: 286e 6e2e 4d6f 6475 6c65 293a 0a20 2020  (nn.Module):.   
-000094a0: 2022 2222 4d41 5447 656e 6572 6174 6f72   """MATGenerator
-000094b0: 2064 6566 696e 6573 2074 6865 206c 696e   defines the lin
-000094c0: 6561 7220 616e 6420 736f 6674 6d61 7820  ear and softmax 
-000094d0: 6765 6e65 7261 746f 7220 7374 6570 2066  generator step f
-000094e0: 6f72 2074 6865 204d 6f6c 6563 756c 6172  or the Molecular
-000094f0: 2041 7474 656e 7469 6f6e 2054 7261 6e73   Attention Trans
-00009500: 666f 726d 6572 205b 315d 5f2e 0a0a 2020  former [1]_...  
-00009510: 2020 496e 2074 6865 204d 4154 4765 6e65    In the MATGene
-00009520: 7261 746f 722c 2061 2047 656e 6572 6174  rator, a Generat
-00009530: 6f72 2069 7320 6465 6669 6e65 6420 7768  or is defined wh
-00009540: 6963 6820 7065 7266 6f72 6d73 2074 6865  ich performs the
-00009550: 204c 696e 6561 7220 2b20 536f 6674 6d61   Linear + Softma
-00009560: 7820 6765 6e65 7261 7469 6f6e 2073 7465  x generation ste
-00009570: 702e 0a20 2020 2044 6570 656e 6469 6e67  p..    Depending
-00009580: 206f 6e20 7468 6520 7479 7065 206f 6620   on the type of 
-00009590: 6167 6772 6567 6174 696f 6e20 7365 6c65  aggregation sele
-000095a0: 6374 6564 2c20 7468 6520 6174 7465 6e74  cted, the attent
-000095b0: 696f 6e20 6f75 7470 7574 206c 6179 6572  ion output layer
-000095c0: 2070 6572 666f 726d 7320 6469 6666 6572   performs differ
-000095d0: 656e 7420 6f70 6572 6174 696f 6e73 2e0a  ent operations..
-000095e0: 0a20 2020 2052 6566 6572 656e 6365 730a  .    References.
-000095f0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00009600: 2020 202e 2e20 5b31 5d20 4c75 6b61 737a     .. [1] Lukasz
-00009610: 204d 617a 6961 726b 6120 6574 2061 6c2e   Maziarka et al.
-00009620: 2022 4d6f 6c65 6375 6c65 2041 7474 656e   "Molecule Atten
-00009630: 7469 6f6e 2054 7261 6e73 666f 726d 6572  tion Transformer
-00009640: 2220 4772 6170 6820 5265 7072 6573 656e  " Graph Represen
-00009650: 7461 7469 6f6e 204c 6561 726e 696e 6720  tation Learning 
-00009660: 776f 726b 7368 6f70 2061 6e64 204d 6163  workshop and Mac
-00009670: 6869 6e65 204c 6561 726e 696e 6720 616e  hine Learning an
-00009680: 6420 7468 6520 5068 7973 6963 616c 2053  d the Physical S
-00009690: 6369 656e 6365 7320 776f 726b 7368 6f70  ciences workshop
-000096a0: 2061 7420 4e65 7572 4950 5320 3230 3139   at NeurIPS 2019
-000096b0: 2e20 3230 3230 2e20 6874 7470 733a 2f2f  . 2020. https://
-000096c0: 6172 7869 762e 6f72 672f 6162 732f 3230  arxiv.org/abs/20
-000096d0: 3032 2e30 3832 3634 0a0a 2020 2020 4578  02.08264..    Ex
-000096e0: 616d 706c 6573 0a20 2020 202d 2d2d 2d2d  amples.    -----
-000096f0: 2d2d 2d0a 2020 2020 3e3e 3e20 6672 6f6d  ---.    >>> from
-00009700: 2064 6565 7063 6865 6d2e 6d6f 6465 6c73   deepchem.models
-00009710: 2e74 6f72 6368 5f6d 6f64 656c 732e 6c61  .torch_models.la
-00009720: 7965 7273 2069 6d70 6f72 7420 4d41 5447  yers import MATG
-00009730: 656e 6572 6174 6f72 0a20 2020 203e 3e3e  enerator.    >>>
-00009740: 206c 6179 6572 203d 204d 4154 4765 6e65   layer = MATGene
-00009750: 7261 746f 7228 6873 697a 6520 3d20 332c  rator(hsize = 3,
-00009760: 2061 6767 7265 6761 7469 6f6e 5f74 7970   aggregation_typ
-00009770: 6520 3d20 276d 6561 6e27 2c20 645f 6f75  e = 'mean', d_ou
-00009780: 7470 7574 203d 2031 2c20 6e5f 6c61 7965  tput = 1, n_laye
-00009790: 7273 203d 2031 2c20 6472 6f70 6f75 745f  rs = 1, dropout_
-000097a0: 7020 3d20 302e 332c 2061 7474 6e5f 6869  p = 0.3, attn_hi
-000097b0: 6464 656e 203d 2031 3238 2c20 6174 746e  dden = 128, attn
-000097c0: 5f6f 7574 203d 2034 290a 2020 2020 3e3e  _out = 4).    >>
-000097d0: 3e20 696e 7075 745f 7465 6e73 6f72 203d  > input_tensor =
-000097e0: 2074 6f72 6368 2e74 656e 736f 7228 5b31   torch.tensor([1
-000097f0: 2e2c 2032 2e2c 2033 2e5d 290a 2020 2020  ., 2., 3.]).    
-00009800: 3e3e 3e20 6d61 736b 203d 2074 6f72 6368  >>> mask = torch
-00009810: 2e74 656e 736f 7228 5b31 2e2c 2031 2e2c  .tensor([1., 1.,
-00009820: 2031 2e5d 290a 2020 2020 3e3e 3e20 6f75   1.]).    >>> ou
-00009830: 7470 7574 203d 206c 6179 6572 2869 6e70  tput = layer(inp
-00009840: 7574 5f74 656e 736f 722c 206d 6173 6b29  ut_tensor, mask)
-00009850: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
-00009860: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-00009870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009880: 2020 6873 697a 653a 2069 6e74 203d 2031    hsize: int = 1
-00009890: 3032 342c 0a20 2020 2020 2020 2020 2020  024,.           
-000098a0: 2020 2020 2020 6167 6772 6567 6174 696f        aggregatio
-000098b0: 6e5f 7479 7065 3a20 7374 7220 3d20 276d  n_type: str = 'm
-000098c0: 6561 6e27 2c0a 2020 2020 2020 2020 2020  ean',.          
-000098d0: 2020 2020 2020 2064 5f6f 7574 7075 743a         d_output:
-000098e0: 2069 6e74 203d 2031 2c0a 2020 2020 2020   int = 1,.      
-000098f0: 2020 2020 2020 2020 2020 206e 5f6c 6179             n_lay
-00009900: 6572 733a 2069 6e74 203d 2031 2c0a 2020  ers: int = 1,.  
-00009910: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00009920: 726f 706f 7574 5f70 3a20 666c 6f61 7420  ropout_p: float 
-00009930: 3d20 302e 302c 0a20 2020 2020 2020 2020  = 0.0,.         
-00009940: 2020 2020 2020 2020 6174 746e 5f68 6964          attn_hid
-00009950: 6465 6e3a 2069 6e74 203d 2031 3238 2c0a  den: int = 128,.
-00009960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009970: 2061 7474 6e5f 6f75 743a 2069 6e74 203d   attn_out: int =
-00009980: 2034 293a 0a20 2020 2020 2020 2022 2222   4):.        """
-00009990: 496e 6974 6961 6c69 7a65 2061 204d 4154  Initialize a MAT
-000099a0: 4765 6e65 7261 746f 722e 0a0a 2020 2020  Generator...    
-000099b0: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-000099c0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-000099d0: 2d0a 2020 2020 2020 2020 6873 697a 653a  -.        hsize:
-000099e0: 2069 6e74 0a20 2020 2020 2020 2020 2020   int.           
-000099f0: 2053 697a 6520 6f66 2069 6e70 7574 206c   Size of input l
-00009a00: 6179 6572 2e0a 2020 2020 2020 2020 6167  ayer..        ag
-00009a10: 6772 6567 6174 696f 6e5f 7479 7065 3a20  gregation_type: 
-00009a20: 7374 720a 2020 2020 2020 2020 2020 2020  str.            
-00009a30: 5479 7065 206f 6620 6167 6772 6567 6174  Type of aggregat
-00009a40: 696f 6e20 746f 2062 6520 7573 6564 2e20  ion to be used. 
-00009a50: 4361 6e20 6265 2027 6772 6f76 6572 272c  Can be 'grover',
-00009a60: 2027 6d65 616e 2720 6f72 2027 636f 6e74   'mean' or 'cont
-00009a70: 6578 7475 616c 272e 0a20 2020 2020 2020  extual'..       
-00009a80: 2064 5f6f 7574 7075 743a 2069 6e74 0a20   d_output: int. 
-00009a90: 2020 2020 2020 2020 2020 2053 697a 6520             Size 
-00009aa0: 6f66 206f 7574 7075 7420 6c61 7965 722e  of output layer.
-00009ab0: 0a20 2020 2020 2020 206e 5f6c 6179 6572  .        n_layer
-00009ac0: 733a 2069 6e74 0a20 2020 2020 2020 2020  s: int.         
-00009ad0: 2020 204e 756d 6265 7220 6f66 206c 6179     Number of lay
-00009ae0: 6572 7320 696e 204d 4154 4765 6e65 7261  ers in MATGenera
-00009af0: 746f 722e 0a20 2020 2020 2020 2064 726f  tor..        dro
-00009b00: 706f 7574 5f70 3a20 666c 6f61 740a 2020  pout_p: float.  
-00009b10: 2020 2020 2020 2020 2020 4472 6f70 6f75            Dropou
-00009b20: 7420 7072 6f62 6162 696c 6974 7920 666f  t probability fo
-00009b30: 7220 6c61 7965 722e 0a20 2020 2020 2020  r layer..       
-00009b40: 2061 7474 6e5f 6869 6464 656e 3a20 696e   attn_hidden: in
-00009b50: 740a 2020 2020 2020 2020 2020 2020 5369  t.            Si
-00009b60: 7a65 206f 6620 6869 6464 656e 2061 7474  ze of hidden att
-00009b70: 656e 7469 6f6e 206c 6179 6572 2e0a 2020  ention layer..  
-00009b80: 2020 2020 2020 6174 746e 5f6f 7574 3a20        attn_out: 
-00009b90: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
-00009ba0: 5369 7a65 206f 6620 6f75 7470 7574 2061  Size of output a
-00009bb0: 7474 656e 7469 6f6e 206c 6179 6572 2e0a  ttention layer..
-00009bc0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00009bd0: 2020 2020 7375 7065 7228 4d41 5447 656e      super(MATGen
-00009be0: 6572 6174 6f72 2c20 7365 6c66 292e 5f5f  erator, self).__
-00009bf0: 696e 6974 5f5f 2829 0a0a 2020 2020 2020  init__()..      
-00009c00: 2020 6966 2061 6767 7265 6761 7469 6f6e    if aggregation
-00009c10: 5f74 7970 6520 3d3d 2027 6772 6f76 6572  _type == 'grover
-00009c20: 273a 0a20 2020 2020 2020 2020 2020 2073  ':.            s
-00009c30: 656c 662e 6174 745f 6e65 7420 3d20 6e6e  elf.att_net = nn
-00009c40: 2e53 6571 7565 6e74 6961 6c28 0a20 2020  .Sequential(.   
-00009c50: 2020 2020 2020 2020 2020 2020 206e 6e2e               nn.
-00009c60: 4c69 6e65 6172 2868 7369 7a65 2c20 6174  Linear(hsize, at
-00009c70: 746e 5f68 6964 6465 6e2c 2062 6961 733d  tn_hidden, bias=
-00009c80: 4661 6c73 6529 2c0a 2020 2020 2020 2020  False),.        
-00009c90: 2020 2020 2020 2020 6e6e 2e54 616e 6828          nn.Tanh(
-00009ca0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00009cb0: 2020 206e 6e2e 4c69 6e65 6172 2861 7474     nn.Linear(att
-00009cc0: 6e5f 6869 6464 656e 2c20 6174 746e 5f6f  n_hidden, attn_o
-00009cd0: 7574 2c20 6269 6173 3d46 616c 7365 292c  ut, bias=False),
-00009ce0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00009cf0: 2020 2020 2020 2020 2020 2068 7369 7a65             hsize
-00009d00: 202a 3d20 6174 746e 5f6f 7574 0a0a 2020   *= attn_out..  
-00009d10: 2020 2020 2020 6966 206e 5f6c 6179 6572        if n_layer
-00009d20: 7320 3d3d 2031 3a0a 2020 2020 2020 2020  s == 1:.        
-00009d30: 2020 2020 7365 6c66 2e70 726f 6a3a 2041      self.proj: A
-00009d40: 6e79 203d 206e 6e2e 4c69 6e65 6172 2868  ny = nn.Linear(h
-00009d50: 7369 7a65 2c20 645f 6f75 7470 7574 290a  size, d_output).
-00009d60: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00009d70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00009d80: 7072 6f6a 203d 205b 5d0a 0a20 2020 2020  proj = []..     
-00009d90: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-00009da0: 7261 6e67 6528 6e5f 6c61 7965 7273 202d  range(n_layers -
-00009db0: 2031 293a 0a20 2020 2020 2020 2020 2020   1):.           
-00009dc0: 2020 2020 2073 656c 662e 7072 6f6a 2e61       self.proj.a
-00009dd0: 7070 656e 6428 6e6e 2e4c 696e 6561 7228  ppend(nn.Linear(
-00009de0: 6873 697a 652c 2061 7474 6e5f 6869 6464  hsize, attn_hidd
-00009df0: 656e 2929 0a20 2020 2020 2020 2020 2020  en)).           
-00009e00: 2020 2020 2073 656c 662e 7072 6f6a 2e61       self.proj.a
-00009e10: 7070 656e 6428 6e6e 2e4c 6561 6b79 5265  ppend(nn.LeakyRe
-00009e20: 4c55 286e 6567 6174 6976 655f 736c 6f70  LU(negative_slop
-00009e30: 653d 302e 3129 290a 2020 2020 2020 2020  e=0.1)).        
-00009e40: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
-00009e50: 6a2e 6170 7065 6e64 286e 6e2e 4c61 7965  j.append(nn.Laye
-00009e60: 724e 6f72 6d28 6174 746e 5f68 6964 6465  rNorm(attn_hidde
-00009e70: 6e29 290a 2020 2020 2020 2020 2020 2020  n)).            
-00009e80: 2020 2020 7365 6c66 2e70 726f 6a2e 6170      self.proj.ap
-00009e90: 7065 6e64 286e 6e2e 4472 6f70 6f75 7428  pend(nn.Dropout(
-00009ea0: 6472 6f70 6f75 745f 7029 290a 2020 2020  dropout_p)).    
-00009eb0: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
-00009ec0: 6a2e 6170 7065 6e64 286e 6e2e 4c69 6e65  j.append(nn.Line
-00009ed0: 6172 2861 7474 6e5f 6869 6464 656e 2c20  ar(attn_hidden, 
-00009ee0: 645f 6f75 7470 7574 2929 0a20 2020 2020  d_output)).     
-00009ef0: 2020 2020 2020 2073 656c 662e 7072 6f6a         self.proj
-00009f00: 203d 2074 6f72 6368 2e6e 6e2e 5365 7175   = torch.nn.Sequ
-00009f10: 656e 7469 616c 282a 7365 6c66 2e70 726f  ential(*self.pro
-00009f20: 6a29 0a20 2020 2020 2020 2073 656c 662e  j).        self.
-00009f30: 6167 6772 6567 6174 696f 6e5f 7479 7065  aggregation_type
-00009f40: 203d 2061 6767 7265 6761 7469 6f6e 5f74   = aggregation_t
-00009f50: 7970 650a 0a20 2020 2064 6566 2066 6f72  ype..    def for
-00009f60: 7761 7264 2873 656c 662c 2078 3a20 746f  ward(self, x: to
-00009f70: 7263 682e 5465 6e73 6f72 2c20 6d61 736b  rch.Tensor, mask
-00009f80: 3a20 746f 7263 682e 5465 6e73 6f72 2920  : torch.Tensor) 
-00009f90: 2d3e 2074 6f72 6368 2e54 656e 736f 723a  -> torch.Tensor:
-00009fa0: 0a20 2020 2020 2020 2022 2222 436f 6d70  .        """Comp
-00009fb0: 7574 6174 696f 6e20 666f 7220 7468 6520  utation for the 
-00009fc0: 4d41 5447 656e 6572 6174 6f72 206c 6179  MATGenerator lay
-00009fd0: 6572 2e0a 0a20 2020 2020 2020 2050 6172  er...        Par
-00009fe0: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
-00009ff0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-0000a000: 2020 2078 3a20 746f 7263 682e 5465 6e73     x: torch.Tens
-0000a010: 6f72 0a20 2020 2020 2020 2020 2020 2049  or.            I
-0000a020: 6e70 7574 2074 656e 736f 722e 0a20 2020  nput tensor..   
-0000a030: 2020 2020 206d 6173 6b3a 2074 6f72 6368       mask: torch
-0000a040: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
-0000a050: 2020 2020 4d61 736b 2066 6f72 2070 6164      Mask for pad
-0000a060: 6469 6e67 2073 6f20 7468 6174 2070 6164  ding so that pad
-0000a070: 6465 6420 7661 6c75 6573 2064 6f20 6e6f  ded values do no
-0000a080: 7420 6765 7420 696e 636c 7564 6564 2069  t get included i
-0000a090: 6e20 6174 7465 6e74 696f 6e20 7363 6f72  n attention scor
-0000a0a0: 6520 6361 6c63 756c 6174 696f 6e2e 0a20  e calculation.. 
-0000a0b0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-0000a0c0: 2020 2020 6d61 736b 203d 206d 6173 6b2e      mask = mask.
-0000a0d0: 756e 7371 7565 657a 6528 2d31 292e 666c  unsqueeze(-1).fl
-0000a0e0: 6f61 7428 290a 2020 2020 2020 2020 6f75  oat().        ou
-0000a0f0: 745f 6d61 736b 6564 203d 2078 202a 206d  t_masked = x * m
-0000a100: 6173 6b0a 0a20 2020 2020 2020 2069 6620  ask..        if 
-0000a110: 7365 6c66 2e61 6767 7265 6761 7469 6f6e  self.aggregation
-0000a120: 5f74 7970 6520 3d3d 2027 6d65 616e 273a  _type == 'mean':
-0000a130: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-0000a140: 5f73 756d 203d 206f 7574 5f6d 6173 6b65  _sum = out_maske
-0000a150: 642e 7375 6d28 6469 6d3d 3129 0a20 2020  d.sum(dim=1).   
-0000a160: 2020 2020 2020 2020 206d 6173 6b5f 7375           mask_su
-0000a170: 6d20 3d20 6d61 736b 2e73 756d 2864 696d  m = mask.sum(dim
-0000a180: 3d28 3129 290a 2020 2020 2020 2020 2020  =(1)).          
-0000a190: 2020 6f75 745f 6176 675f 706f 6f6c 696e    out_avg_poolin
-0000a1a0: 6720 3d20 6f75 745f 7375 6d20 2f20 6d61  g = out_sum / ma
-0000a1b0: 736b 5f73 756d 0a0a 2020 2020 2020 2020  sk_sum..        
-0000a1c0: 656c 6966 2073 656c 662e 6167 6772 6567  elif self.aggreg
-0000a1d0: 6174 696f 6e5f 7479 7065 203d 3d20 2767  ation_type == 'g
-0000a1e0: 726f 7665 7227 3a0a 2020 2020 2020 2020  rover':.        
-0000a1f0: 2020 2020 6f75 745f 6174 746e 203d 2073      out_attn = s
-0000a200: 656c 662e 6174 745f 6e65 7428 6f75 745f  elf.att_net(out_
-0000a210: 6d61 736b 6564 290a 2020 2020 2020 2020  masked).        
-0000a220: 2020 2020 6f75 745f 6174 746e 203d 206f      out_attn = o
-0000a230: 7574 5f61 7474 6e2e 6d61 736b 6564 5f66  ut_attn.masked_f
-0000a240: 696c 6c28 6d61 736b 203d 3d20 302c 202d  ill(mask == 0, -
-0000a250: 3165 3929 0a20 2020 2020 2020 2020 2020  1e9).           
-0000a260: 206f 7574 5f61 7474 6e20 3d20 462e 736f   out_attn = F.so
-0000a270: 6674 6d61 7828 6f75 745f 6174 746e 2c20  ftmax(out_attn, 
-0000a280: 6469 6d3d 3129 0a20 2020 2020 2020 2020  dim=1).         
-0000a290: 2020 206f 7574 5f61 7667 5f70 6f6f 6c69     out_avg_pooli
-0000a2a0: 6e67 203d 2074 6f72 6368 2e6d 6174 6d75  ng = torch.matmu
-0000a2b0: 6c28 746f 7263 682e 7472 616e 7370 6f73  l(torch.transpos
-0000a2c0: 6528 6f75 745f 6174 746e 2c20 2d31 2c20  e(out_attn, -1, 
-0000a2d0: 2d32 292c 0a20 2020 2020 2020 2020 2020  -2),.           
-0000a2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a300: 6f75 745f 6d61 736b 6564 290a 2020 2020  out_masked).    
-0000a310: 2020 2020 2020 2020 6f75 745f 6176 675f          out_avg_
-0000a320: 706f 6f6c 696e 6720 3d20 6f75 745f 6176  pooling = out_av
-0000a330: 675f 706f 6f6c 696e 672e 7669 6577 286f  g_pooling.view(o
-0000a340: 7574 5f61 7667 5f70 6f6f 6c69 6e67 2e73  ut_avg_pooling.s
-0000a350: 697a 6528 3029 2c20 2d31 290a 0a20 2020  ize(0), -1)..   
-0000a360: 2020 2020 2065 6c69 6620 7365 6c66 2e61       elif self.a
-0000a370: 6767 7265 6761 7469 6f6e 5f74 7970 6520  ggregation_type 
-0000a380: 3d3d 2027 636f 6e74 6578 7475 616c 273a  == 'contextual':
-0000a390: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-0000a3a0: 5f61 7667 5f70 6f6f 6c69 6e67 203d 2078  _avg_pooling = x
-0000a3b0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0000a3c0: 2073 656c 662e 7072 6f6a 286f 7574 5f61   self.proj(out_a
-0000a3d0: 7667 5f70 6f6f 6c69 6e67 290a 0a0a 636c  vg_pooling)...cl
-0000a3e0: 6173 7320 4772 6170 684e 6574 776f 726b  ass GraphNetwork
-0000a3f0: 2874 6f72 6368 2e6e 6e2e 4d6f 6475 6c65  (torch.nn.Module
-0000a400: 293a 0a20 2020 2022 2222 4772 6170 6820  ):.    """Graph 
-0000a410: 4e65 7477 6f72 6b73 0a0a 2020 2020 4120  Networks..    A 
-0000a420: 4772 6170 6820 4e65 7477 6f72 6b20 5b31  Graph Network [1
-0000a430: 5d5f 2074 616b 6573 2061 2067 7261 7068  ]_ takes a graph
-0000a440: 2061 7320 696e 7075 7420 616e 6420 7265   as input and re
-0000a450: 7475 726e 7320 616e 2075 7064 6174 6564  turns an updated
-0000a460: 2067 7261 7068 0a20 2020 2061 7320 6f75   graph.    as ou
-0000a470: 7470 7574 2e20 5468 6520 6f75 7470 7574  tput. The output
-0000a480: 2067 7261 7068 2068 6173 2073 616d 6520   graph has same 
-0000a490: 7374 7275 6374 7572 6520 6173 2069 6e70  structure as inp
-0000a4a0: 7574 2067 7261 7068 2062 7574 2069 740a  ut graph but it.
-0000a4b0: 2020 2020 6861 7320 7570 6461 7465 6420      has updated 
-0000a4c0: 6e6f 6465 2066 6561 7475 7265 732c 2065  node features, e
-0000a4d0: 6467 6520 6665 6174 7572 6573 2061 6e64  dge features and
-0000a4e0: 2067 6c6f 6261 6c20 7374 6174 6520 6665   global state fe
-0000a4f0: 6174 7572 6573 2e0a 0a20 2020 2050 6172  atures...    Par
-0000a500: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
-0000a510: 2d2d 2d2d 2d2d 0a20 2020 206e 5f6e 6f64  ------.    n_nod
-0000a520: 655f 6665 6174 7572 6573 3a20 696e 740a  e_features: int.
-0000a530: 2020 2020 2020 2020 4e75 6d62 6572 206f          Number o
-0000a540: 6620 6665 6174 7572 6573 2069 6e20 6120  f features in a 
-0000a550: 6e6f 6465 0a20 2020 206e 5f65 6467 655f  node.    n_edge_
-0000a560: 6665 6174 7572 6573 3a20 696e 740a 2020  features: int.  
-0000a570: 2020 2020 2020 4e75 6d62 6572 206f 6620        Number of 
-0000a580: 6665 6174 7572 6573 2069 6e20 6120 6564  features in a ed
-0000a590: 6765 0a20 2020 206e 5f67 6c6f 6261 6c5f  ge.    n_global_
-0000a5a0: 6665 6174 7572 6573 3a20 696e 740a 2020  features: int.  
-0000a5b0: 2020 2020 2020 4e75 6d62 6572 206f 6620        Number of 
-0000a5c0: 676c 6f62 616c 2066 6561 7475 7265 730a  global features.
-0000a5d0: 2020 2020 6973 5f75 6e64 6972 6563 7465      is_undirecte
-0000a5e0: 643a 2062 6f6f 6c2c 206f 7074 696f 6e61  d: bool, optiona
-0000a5f0: 6c20 2864 6566 6175 6c74 2054 7275 6529  l (default True)
-0000a600: 0a20 2020 2020 2020 2044 6972 6563 7465  .        Directe
-0000a610: 6420 6f72 2075 6e64 6972 6563 7465 6420  d or undirected 
-0000a620: 6772 6170 680a 2020 2020 7265 7369 6475  graph.    residu
-0000a630: 616c 5f63 6f6e 6e65 6374 696f 6e3a 2062  al_connection: b
-0000a640: 6f6f 6c2c 206f 7074 696f 6e61 6c20 2864  ool, optional (d
-0000a650: 6566 6175 6c74 2054 7275 6529 0a20 2020  efault True).   
-0000a660: 2020 2020 2049 6620 5472 7565 2c20 7468       If True, th
-0000a670: 6520 6c61 7965 7220 7573 6573 2061 2072  e layer uses a r
-0000a680: 6573 6964 7561 6c20 636f 6e6e 6563 7469  esidual connecti
-0000a690: 6f6e 2064 7572 696e 6720 7472 6169 6e69  on during traini
-0000a6a0: 6e67 0a0a 2020 2020 4578 616d 706c 650a  ng..    Example.
-0000a6b0: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-0000a6c0: 3e3e 3e20 696d 706f 7274 2074 6f72 6368  >>> import torch
-0000a6d0: 0a20 2020 203e 3e3e 2066 726f 6d20 6465  .    >>> from de
-0000a6e0: 6570 6368 656d 2e6d 6f64 656c 732e 746f  epchem.models.to
-0000a6f0: 7263 685f 6d6f 6465 6c73 2e6c 6179 6572  rch_models.layer
-0000a700: 7320 696d 706f 7274 2047 7261 7068 4e65  s import GraphNe
-0000a710: 7477 6f72 6b20 6173 2047 4e0a 2020 2020  twork as GN.    
-0000a720: 3e3e 3e20 6e5f 6e6f 6465 732c 206e 5f6e  >>> n_nodes, n_n
-0000a730: 6f64 655f 6665 6174 7572 6573 203d 2035  ode_features = 5
-0000a740: 2c20 3130 0a20 2020 203e 3e3e 206e 5f65  , 10.    >>> n_e
-0000a750: 6467 6573 2c20 6e5f 6564 6765 5f66 6561  dges, n_edge_fea
-0000a760: 7475 7265 7320 3d20 352c 2032 0a20 2020  tures = 5, 2.   
-0000a770: 203e 3e3e 206e 5f67 6c6f 6261 6c5f 6665   >>> n_global_fe
-0000a780: 6174 7572 6573 203d 2034 0a20 2020 203e  atures = 4.    >
-0000a790: 3e3e 206e 6f64 655f 6665 6174 7572 6573  >> node_features
-0000a7a0: 203d 2074 6f72 6368 2e72 616e 646e 286e   = torch.randn(n
-0000a7b0: 5f6e 6f64 6573 2c20 6e5f 6e6f 6465 5f66  _nodes, n_node_f
-0000a7c0: 6561 7475 7265 7329 0a20 2020 203e 3e3e  eatures).    >>>
-0000a7d0: 2065 6467 655f 6665 6174 7572 6573 203d   edge_features =
-0000a7e0: 2074 6f72 6368 2e72 616e 646e 286e 5f65   torch.randn(n_e
-0000a7f0: 6467 6573 2c20 6e5f 6564 6765 5f66 6561  dges, n_edge_fea
-0000a800: 7475 7265 7329 0a20 2020 203e 3e3e 2065  tures).    >>> e
-0000a810: 6467 655f 696e 6465 7820 3d20 746f 7263  dge_index = torc
-0000a820: 682e 7465 6e73 6f72 285b 5b30 2c20 312c  h.tensor([[0, 1,
-0000a830: 2032 2c20 332c 2034 5d2c 205b 312c 2032   2, 3, 4], [1, 2
-0000a840: 2c20 332c 2034 2c20 305d 5d29 2e6c 6f6e  , 3, 4, 0]]).lon
-0000a850: 6728 290a 2020 2020 3e3e 3e20 676c 6f62  g().    >>> glob
-0000a860: 616c 5f66 6561 7475 7265 7320 3d20 746f  al_features = to
-0000a870: 7263 682e 7261 6e64 6e28 312c 206e 5f67  rch.randn(1, n_g
-0000a880: 6c6f 6261 6c5f 6665 6174 7572 6573 290a  lobal_features).
-0000a890: 2020 2020 3e3e 3e20 676e 203d 2047 4e28      >>> gn = GN(
-0000a8a0: 6e5f 6e6f 6465 5f66 6561 7475 7265 733d  n_node_features=
-0000a8b0: 6e5f 6e6f 6465 5f66 6561 7475 7265 732c  n_node_features,
-0000a8c0: 206e 5f65 6467 655f 6665 6174 7572 6573   n_edge_features
-0000a8d0: 3d6e 5f65 6467 655f 6665 6174 7572 6573  =n_edge_features
-0000a8e0: 2c20 6e5f 676c 6f62 616c 5f66 6561 7475  , n_global_featu
-0000a8f0: 7265 733d 6e5f 676c 6f62 616c 5f66 6561  res=n_global_fea
-0000a900: 7475 7265 7329 0a20 2020 203e 3e3e 206e  tures).    >>> n
-0000a910: 6f64 655f 6665 6174 7572 6573 2c20 6564  ode_features, ed
-0000a920: 6765 5f66 6561 7475 7265 732c 2067 6c6f  ge_features, glo
-0000a930: 6261 6c5f 6665 6174 7572 6573 203d 2067  bal_features = g
-0000a940: 6e28 6e6f 6465 5f66 6561 7475 7265 732c  n(node_features,
-0000a950: 2065 6467 655f 696e 6465 782c 2065 6467   edge_index, edg
-0000a960: 655f 6665 6174 7572 6573 2c20 676c 6f62  e_features, glob
-0000a970: 616c 5f66 6561 7475 7265 7329 0a0a 2020  al_features)..  
-0000a980: 2020 5265 6665 7265 6e63 6573 0a20 2020    References.   
-0000a990: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-0000a9a0: 2e2e 205b 315d 2042 6174 7461 676c 6961  .. [1] Battaglia
-0000a9b0: 2065 7420 616c 2c20 5265 6c61 7469 6f6e   et al, Relation
-0000a9c0: 616c 2069 6e64 7563 7469 7665 2062 6961  al inductive bia
-0000a9d0: 7365 732c 2064 6565 7020 6c65 6172 6e69  ses, deep learni
-0000a9e0: 6e67 2c20 616e 6420 6772 6170 6820 6e65  ng, and graph ne
-0000a9f0: 7477 6f72 6b73 2e20 6874 7470 733a 2f2f  tworks. https://
-0000aa00: 6172 7869 762e 6f72 672f 6162 732f 3138  arxiv.org/abs/18
-0000aa10: 3036 2e30 3132 3631 2028 3230 3138 290a  06.01261 (2018).
-0000aa20: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
-0000aa30: 5f69 6e69 745f 5f28 7365 6c66 2c0a 2020  _init__(self,.  
-0000aa40: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0000aa50: 5f6e 6f64 655f 6665 6174 7572 6573 3a20  _node_features: 
-0000aa60: 696e 7420 3d20 3332 2c0a 2020 2020 2020  int = 32,.      
-0000aa70: 2020 2020 2020 2020 2020 206e 5f65 6467             n_edg
-0000aa80: 655f 6665 6174 7572 6573 3a20 696e 7420  e_features: int 
-0000aa90: 3d20 3332 2c0a 2020 2020 2020 2020 2020  = 32,.          
-0000aaa0: 2020 2020 2020 206e 5f67 6c6f 6261 6c5f         n_global_
-0000aab0: 6665 6174 7572 6573 3a20 696e 7420 3d20  features: int = 
-0000aac0: 3332 2c0a 2020 2020 2020 2020 2020 2020  32,.            
-0000aad0: 2020 2020 2069 735f 756e 6469 7265 6374       is_undirect
-0000aae0: 6564 3a20 626f 6f6c 203d 2054 7275 652c  ed: bool = True,
-0000aaf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ab00: 2020 7265 7369 6475 616c 5f63 6f6e 6e65    residual_conne
-0000ab10: 6374 696f 6e3a 2062 6f6f 6c20 3d20 5472  ction: bool = Tr
-0000ab20: 7565 293a 0a20 2020 2020 2020 2073 7570  ue):.        sup
-0000ab30: 6572 2829 2e5f 5f69 6e69 745f 5f28 290a  er().__init__().
-0000ab40: 2020 2020 2020 2020 7365 6c66 2e6e 5f6e          self.n_n
-0000ab50: 6f64 655f 6665 6174 7572 6573 203d 206e  ode_features = n
-0000ab60: 5f6e 6f64 655f 6665 6174 7572 6573 0a20  _node_features. 
-0000ab70: 2020 2020 2020 2073 656c 662e 6e5f 6564         self.n_ed
-0000ab80: 6765 5f66 6561 7475 7265 7320 3d20 6e5f  ge_features = n_
-0000ab90: 6564 6765 5f66 6561 7475 7265 730a 2020  edge_features.  
-0000aba0: 2020 2020 2020 7365 6c66 2e6e 5f67 6c6f        self.n_glo
-0000abb0: 6261 6c5f 6665 6174 7572 6573 203d 206e  bal_features = n
-0000abc0: 5f67 6c6f 6261 6c5f 6665 6174 7572 6573  _global_features
-0000abd0: 0a20 2020 2020 2020 2073 656c 662e 6973  .        self.is
-0000abe0: 5f75 6e64 6972 6563 7465 6420 3d20 6973  _undirected = is
-0000abf0: 5f75 6e64 6972 6563 7465 640a 2020 2020  _undirected.    
-0000ac00: 2020 2020 7365 6c66 2e72 6573 6964 7561      self.residua
-0000ac10: 6c5f 636f 6e6e 6563 7469 6f6e 203d 2072  l_connection = r
-0000ac20: 6573 6964 7561 6c5f 636f 6e6e 6563 7469  esidual_connecti
-0000ac30: 6f6e 0a0a 2020 2020 2020 2020 7365 6c66  on..        self
-0000ac40: 2e65 6467 655f 6d6f 6465 6c73 2c20 7365  .edge_models, se
-0000ac50: 6c66 2e6e 6f64 655f 6d6f 6465 6c73 2c20  lf.node_models, 
-0000ac60: 7365 6c66 2e67 6c6f 6261 6c5f 6d6f 6465  self.global_mode
-0000ac70: 6c73 203d 2074 6f72 6368 2e6e 6e2e 4d6f  ls = torch.nn.Mo
-0000ac80: 6475 6c65 4c69 7374 280a 2020 2020 2020  duleList(.      
-0000ac90: 2020 292c 2074 6f72 6368 2e6e 6e2e 4d6f    ), torch.nn.Mo
-0000aca0: 6475 6c65 4c69 7374 2829 2c20 746f 7263  duleList(), torc
-0000acb0: 682e 6e6e 2e4d 6f64 756c 654c 6973 7428  h.nn.ModuleList(
-0000acc0: 290a 2020 2020 2020 2020 7365 6c66 2e65  ).        self.e
-0000acd0: 6467 655f 6d6f 6465 6c73 2e61 7070 656e  dge_models.appen
-0000ace0: 6428 0a20 2020 2020 2020 2020 2020 206e  d(.            n
-0000acf0: 6e2e 4c69 6e65 6172 2869 6e5f 6665 6174  n.Linear(in_feat
-0000ad00: 7572 6573 3d6e 5f6e 6f64 655f 6665 6174  ures=n_node_feat
-0000ad10: 7572 6573 202a 2032 202b 206e 5f65 6467  ures * 2 + n_edg
-0000ad20: 655f 6665 6174 7572 6573 202b 0a20 2020  e_features +.   
-0000ad30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad40: 2020 206e 5f67 6c6f 6261 6c5f 6665 6174     n_global_feat
-0000ad50: 7572 6573 2c0a 2020 2020 2020 2020 2020  ures,.          
-0000ad60: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
-0000ad70: 6665 6174 7572 6573 3d33 3229 290a 2020  features=32)).  
-0000ad80: 2020 2020 2020 7365 6c66 2e6e 6f64 655f        self.node_
-0000ad90: 6d6f 6465 6c73 2e61 7070 656e 6428 0a20  models.append(. 
-0000ada0: 2020 2020 2020 2020 2020 206e 6e2e 4c69             nn.Li
-0000adb0: 6e65 6172 2869 6e5f 6665 6174 7572 6573  near(in_features
-0000adc0: 3d6e 5f6e 6f64 655f 6665 6174 7572 6573  =n_node_features
-0000add0: 202b 206e 5f65 6467 655f 6665 6174 7572   + n_edge_featur
-0000ade0: 6573 202b 0a20 2020 2020 2020 2020 2020  es +.           
-0000adf0: 2020 2020 2020 2020 2020 206e 5f67 6c6f             n_glo
-0000ae00: 6261 6c5f 6665 6174 7572 6573 2c0a 2020  bal_features,.  
-0000ae10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae20: 2020 2020 6f75 745f 6665 6174 7572 6573      out_features
-0000ae30: 3d33 3229 290a 2020 2020 2020 2020 7365  =32)).        se
-0000ae40: 6c66 2e67 6c6f 6261 6c5f 6d6f 6465 6c73  lf.global_models
-0000ae50: 2e61 7070 656e 6428 0a20 2020 2020 2020  .append(.       
-0000ae60: 2020 2020 206e 6e2e 4c69 6e65 6172 2869       nn.Linear(i
-0000ae70: 6e5f 6665 6174 7572 6573 3d6e 5f6e 6f64  n_features=n_nod
-0000ae80: 655f 6665 6174 7572 6573 202b 206e 5f65  e_features + n_e
-0000ae90: 6467 655f 6665 6174 7572 6573 202b 0a20  dge_features +. 
-0000aea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aeb0: 2020 2020 206e 5f67 6c6f 6261 6c5f 6665       n_global_fe
-0000aec0: 6174 7572 6573 2c0a 2020 2020 2020 2020  atures,.        
-0000aed0: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
-0000aee0: 745f 6665 6174 7572 6573 3d33 3229 290a  t_features=32)).
-0000aef0: 0a20 2020 2020 2020 2023 2055 7365 6420  .        # Used 
-0000af00: 666f 7220 636f 6e76 6572 7469 6e67 2065  for converting e
-0000af10: 6467 6573 2062 6163 6b20 746f 2074 6865  dges back to the
-0000af20: 6972 206f 7269 6769 6e61 6c20 7368 6170  ir original shap
-0000af30: 650a 2020 2020 2020 2020 7365 6c66 2e65  e.        self.e
-0000af40: 6467 655f 6465 6e73 6520 3d20 6e6e 2e4c  dge_dense = nn.L
-0000af50: 696e 6561 7228 696e 5f66 6561 7475 7265  inear(in_feature
-0000af60: 733d 3332 2c0a 2020 2020 2020 2020 2020  s=32,.          
-0000af70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000af80: 2020 2020 2020 2020 2020 6f75 745f 6665            out_fe
-0000af90: 6174 7572 6573 3d6e 5f65 6467 655f 6665  atures=n_edge_fe
-0000afa0: 6174 7572 6573 290a 2020 2020 2020 2020  atures).        
-0000afb0: 7365 6c66 2e6e 6f64 655f 6465 6e73 6520  self.node_dense 
-0000afc0: 3d20 6e6e 2e4c 696e 6561 7228 696e 5f66  = nn.Linear(in_f
-0000afd0: 6561 7475 7265 733d 3332 2c0a 2020 2020  eatures=32,.    
-0000afe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b000: 6f75 745f 6665 6174 7572 6573 3d6e 5f6e  out_features=n_n
-0000b010: 6f64 655f 6665 6174 7572 6573 290a 2020  ode_features).  
-0000b020: 2020 2020 2020 7365 6c66 2e67 6c6f 6261        self.globa
-0000b030: 6c5f 6465 6e73 6520 3d20 6e6e 2e4c 696e  l_dense = nn.Lin
-0000b040: 6561 7228 696e 5f66 6561 7475 7265 733d  ear(in_features=
-0000b050: 3332 2c0a 2020 2020 2020 2020 2020 2020  32,.            
-0000b060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b070: 2020 2020 2020 2020 2020 6f75 745f 6665            out_fe
-0000b080: 6174 7572 6573 3d6e 5f67 6c6f 6261 6c5f  atures=n_global_
-0000b090: 6665 6174 7572 6573 290a 0a20 2020 2064  features)..    d
-0000b0a0: 6566 2072 6573 6574 5f70 6172 616d 6574  ef reset_paramet
-0000b0b0: 6572 7328 7365 6c66 2920 2d3e 204e 6f6e  ers(self) -> Non
-0000b0c0: 653a 0a20 2020 2020 2020 2073 656c 662e  e:.        self.
-0000b0d0: 6564 6765 5f64 656e 7365 2e72 6573 6574  edge_dense.reset
-0000b0e0: 5f70 6172 616d 6574 6572 7328 290a 2020  _parameters().  
-0000b0f0: 2020 2020 2020 7365 6c66 2e6e 6f64 655f        self.node_
-0000b100: 6465 6e73 652e 7265 7365 745f 7061 7261  dense.reset_para
-0000b110: 6d65 7465 7273 2829 0a20 2020 2020 2020  meters().       
-0000b120: 2073 656c 662e 676c 6f62 616c 5f64 656e   self.global_den
-0000b130: 7365 2e72 6573 6574 5f70 6172 616d 6574  se.reset_paramet
-0000b140: 6572 7328 290a 2020 2020 2020 2020 666f  ers().        fo
-0000b150: 7220 6920 696e 2072 616e 6765 2830 2c20  r i in range(0, 
-0000b160: 6c65 6e28 7365 6c66 2e65 6467 655f 6d6f  len(self.edge_mo
-0000b170: 6465 6c73 2929 3a0a 2020 2020 2020 2020  dels)):.        
-0000b180: 2020 2020 7365 6c66 2e65 6467 655f 6d6f      self.edge_mo
-0000b190: 6465 6c73 5b69 5d2e 7265 7365 745f 7061  dels[i].reset_pa
-0000b1a0: 7261 6d65 7465 7273 2829 0a20 2020 2020  rameters().     
-0000b1b0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-0000b1c0: 6528 302c 206c 656e 2873 656c 662e 6e6f  e(0, len(self.no
-0000b1d0: 6465 5f6d 6f64 656c 7329 293a 0a20 2020  de_models)):.   
-0000b1e0: 2020 2020 2020 2020 2073 656c 662e 6e6f           self.no
-0000b1f0: 6465 5f6d 6f64 656c 735b 695d 2e72 6573  de_models[i].res
-0000b200: 6574 5f70 6172 616d 6574 6572 7328 290a  et_parameters().
-0000b210: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-0000b220: 2072 616e 6765 2830 2c20 6c65 6e28 7365   range(0, len(se
-0000b230: 6c66 2e67 6c6f 6261 6c5f 6d6f 6465 6c73  lf.global_models
-0000b240: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-0000b250: 7365 6c66 2e67 6c6f 6261 6c5f 6d6f 6465  self.global_mode
-0000b260: 6c73 5b69 5d2e 7265 7365 745f 7061 7261  ls[i].reset_para
-0000b270: 6d65 7465 7273 2829 0a0a 2020 2020 6465  meters()..    de
-0000b280: 6620 5f75 7064 6174 655f 6564 6765 5f66  f _update_edge_f
-0000b290: 6561 7475 7265 7328 7365 6c66 2c20 6e6f  eatures(self, no
-0000b2a0: 6465 5f66 6561 7475 7265 732c 2065 6467  de_features, edg
-0000b2b0: 655f 696e 6465 782c 2065 6467 655f 6665  e_index, edge_fe
-0000b2c0: 6174 7572 6573 2c0a 2020 2020 2020 2020  atures,.        
-0000b2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b2e0: 2020 2020 2020 676c 6f62 616c 5f66 6561        global_fea
-0000b2f0: 7475 7265 732c 2062 6174 6368 293a 0a20  tures, batch):. 
-0000b300: 2020 2020 2020 2073 7263 5f69 6e64 6578         src_index
-0000b310: 2c20 6473 745f 696e 6465 7820 3d20 6564  , dst_index = ed
-0000b320: 6765 5f69 6e64 6578 0a20 2020 2020 2020  ge_index.       
-0000b330: 206f 7574 203d 2074 6f72 6368 2e63 6174   out = torch.cat
-0000b340: 2828 6e6f 6465 5f66 6561 7475 7265 735b  ((node_features[
-0000b350: 7372 635f 696e 6465 785d 2c20 6e6f 6465  src_index], node
-0000b360: 5f66 6561 7475 7265 735b 6473 745f 696e  _features[dst_in
-0000b370: 6465 785d 2c0a 2020 2020 2020 2020 2020  dex],.          
-0000b380: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000b390: 6467 655f 6665 6174 7572 6573 2c20 676c  dge_features, gl
-0000b3a0: 6f62 616c 5f66 6561 7475 7265 735b 6261  obal_features[ba
-0000b3b0: 7463 685d 292c 0a20 2020 2020 2020 2020  tch]),.         
-0000b3c0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000b3d0: 696d 3d31 290a 2020 2020 2020 2020 6173  im=1).        as
-0000b3e0: 7365 7274 206f 7574 2e73 6861 7065 5b0a  sert out.shape[.
-0000b3f0: 2020 2020 2020 2020 2020 2020 315d 203d              1] =
-0000b400: 3d20 7365 6c66 2e6e 5f6e 6f64 655f 6665  = self.n_node_fe
-0000b410: 6174 7572 6573 202a 2032 202b 2073 656c  atures * 2 + sel
-0000b420: 662e 6e5f 6564 6765 5f66 6561 7475 7265  f.n_edge_feature
-0000b430: 7320 2b20 7365 6c66 2e6e 5f67 6c6f 6261  s + self.n_globa
-0000b440: 6c5f 6665 6174 7572 6573 0a20 2020 2020  l_features.     
-0000b450: 2020 2066 6f72 206d 6f64 656c 2069 6e20     for model in 
-0000b460: 7365 6c66 2e65 6467 655f 6d6f 6465 6c73  self.edge_models
-0000b470: 3a0a 2020 2020 2020 2020 2020 2020 6f75  :.            ou
-0000b480: 7420 3d20 6d6f 6465 6c28 6f75 7429 0a20  t = model(out). 
-0000b490: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000b4a0: 6c66 2e65 6467 655f 6465 6e73 6528 6f75  lf.edge_dense(ou
-0000b4b0: 7429 0a0a 2020 2020 6465 6620 5f75 7064  t)..    def _upd
-0000b4c0: 6174 655f 6e6f 6465 5f66 6561 7475 7265  ate_node_feature
-0000b4d0: 7328 7365 6c66 2c20 6e6f 6465 5f66 6561  s(self, node_fea
-0000b4e0: 7475 7265 732c 2065 6467 655f 696e 6465  tures, edge_inde
-0000b4f0: 782c 2065 6467 655f 6665 6174 7572 6573  x, edge_features
-0000b500: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000b510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b520: 676c 6f62 616c 5f66 6561 7475 7265 732c  global_features,
-0000b530: 2062 6174 6368 293a 0a0a 2020 2020 2020   batch):..      
-0000b540: 2020 7372 635f 696e 6465 782c 2064 7374    src_index, dst
-0000b550: 5f69 6e64 6578 203d 2065 6467 655f 696e  _index = edge_in
-0000b560: 6465 780a 2020 2020 2020 2020 2320 436f  dex.        # Co
-0000b570: 6d70 7574 6520 6d65 616e 2065 6467 6520  mpute mean edge 
-0000b580: 6665 6174 7572 6573 2066 6f72 2065 6163  features for eac
-0000b590: 6820 6e6f 6465 2062 7920 6473 745f 696e  h node by dst_in
-0000b5a0: 6465 7820 2865 6163 6820 6e6f 6465 0a20  dex (each node. 
-0000b5b0: 2020 2020 2020 2023 2072 6563 6569 7665         # receive
-0000b5c0: 7320 696e 666f 726d 6174 696f 6e20 6672  s information fr
-0000b5d0: 6f6d 2065 6467 6573 2077 6869 6368 2068  om edges which h
-0000b5e0: 6176 6520 7468 6174 206e 6f64 6520 6173  ave that node as
-0000b5f0: 2069 7473 2064 6573 7469 6e61 7469 6f6e   its destination
-0000b600: 2c0a 2020 2020 2020 2020 2320 6865 6e63  ,.        # henc
-0000b610: 6520 7468 6520 636f 6d70 7574 6174 696f  e the computatio
-0000b620: 6e20 7573 6573 2064 7374 5f69 6e64 6578  n uses dst_index
-0000b630: 2074 6f20 6167 6772 6567 6174 6520 696e   to aggregate in
-0000b640: 666f 726d 6174 696f 6e29 0a20 2020 2020  formation).     
-0000b650: 2020 2065 6467 655f 6665 6174 7572 6573     edge_features
-0000b660: 5f6d 6561 6e5f 6279 5f6e 6f64 6520 3d20  _mean_by_node = 
-0000b670: 7363 6174 7465 7228 7372 633d 6564 6765  scatter(src=edge
-0000b680: 5f66 6561 7475 7265 732c 0a20 2020 2020  _features,.     
-0000b690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6b0: 2020 2020 2020 2020 696e 6465 783d 6473          index=ds
-0000b6c0: 745f 696e 6465 782c 0a20 2020 2020 2020  t_index,.       
-0000b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6f0: 2020 2020 2020 6469 6d3d 302c 0a20 2020        dim=0,.   
-0000b700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b720: 2020 2020 2020 2020 2020 7265 6475 6365            reduce
-0000b730: 3d27 6d65 616e 2729 0a20 2020 2020 2020  ='mean').       
-0000b740: 206f 7574 203d 2074 6f72 6368 2e63 6174   out = torch.cat
-0000b750: 280a 2020 2020 2020 2020 2020 2020 286e  (.            (n
-0000b760: 6f64 655f 6665 6174 7572 6573 2c20 6564  ode_features, ed
-0000b770: 6765 5f66 6561 7475 7265 735f 6d65 616e  ge_features_mean
-0000b780: 5f62 795f 6e6f 6465 2c20 676c 6f62 616c  _by_node, global
-0000b790: 5f66 6561 7475 7265 735b 6261 7463 685d  _features[batch]
-0000b7a0: 292c 0a20 2020 2020 2020 2020 2020 2064  ),.            d
-0000b7b0: 696d 3d31 290a 2020 2020 2020 2020 666f  im=1).        fo
-0000b7c0: 7220 6d6f 6465 6c20 696e 2073 656c 662e  r model in self.
-0000b7d0: 6e6f 6465 5f6d 6f64 656c 733a 0a20 2020  node_models:.   
-0000b7e0: 2020 2020 2020 2020 206f 7574 203d 206d           out = m
-0000b7f0: 6f64 656c 286f 7574 290a 2020 2020 2020  odel(out).      
-0000b800: 2020 7265 7475 726e 2073 656c 662e 6e6f    return self.no
-0000b810: 6465 5f64 656e 7365 286f 7574 290a 0a20  de_dense(out).. 
-0000b820: 2020 2064 6566 205f 7570 6461 7465 5f67     def _update_g
-0000b830: 6c6f 6261 6c5f 6665 6174 7572 6573 2873  lobal_features(s
-0000b840: 656c 662c 206e 6f64 655f 6665 6174 7572  elf, node_featur
-0000b850: 6573 2c20 6564 6765 5f66 6561 7475 7265  es, edge_feature
-0000b860: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-0000b870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b880: 2020 2067 6c6f 6261 6c5f 6665 6174 7572     global_featur
-0000b890: 6573 2c20 6e6f 6465 5f62 6174 6368 5f6d  es, node_batch_m
-0000b8a0: 6170 2c0a 2020 2020 2020 2020 2020 2020  ap,.            
-0000b8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8c0: 2020 2020 6564 6765 5f62 6174 6368 5f6d      edge_batch_m
-0000b8d0: 6170 293a 0a20 2020 2020 2020 2065 6467  ap):.        edg
-0000b8e0: 655f 6665 6174 7572 6573 5f6d 6561 6e20  e_features_mean 
-0000b8f0: 3d20 7363 6174 7465 7228 7372 633d 6564  = scatter(src=ed
-0000b900: 6765 5f66 6561 7475 7265 732c 0a20 2020  ge_features,.   
-0000b910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b930: 2020 696e 6465 783d 6564 6765 5f62 6174    index=edge_bat
-0000b940: 6368 5f6d 6170 2c0a 2020 2020 2020 2020  ch_map,.        
-0000b950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b960: 2020 2020 2020 2020 2020 2020 2064 696d               dim
-0000b970: 3d30 2c0a 2020 2020 2020 2020 2020 2020  =0,.            
-0000b980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b990: 2020 2020 2020 2020 2072 6564 7563 653d           reduce=
-0000b9a0: 276d 6561 6e27 290a 2020 2020 2020 2020  'mean').        
-0000b9b0: 6e6f 6465 5f66 6561 7475 7265 735f 6d65  node_features_me
-0000b9c0: 616e 203d 2073 6361 7474 6572 2873 7263  an = scatter(src
-0000b9d0: 3d6e 6f64 655f 6665 6174 7572 6573 2c0a  =node_features,.
-0000b9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba00: 2020 2020 2069 6e64 6578 3d6e 6f64 655f       index=node_
-0000ba10: 6261 7463 685f 6d61 702c 0a20 2020 2020  batch_map,.     
-0000ba20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba40: 6469 6d3d 302c 0a20 2020 2020 2020 2020  dim=0,.         
-0000ba50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba60: 2020 2020 2020 2020 2020 2020 7265 6475              redu
-0000ba70: 6365 3d27 6d65 616e 2729 0a20 2020 2020  ce='mean').     
-0000ba80: 2020 206f 7574 203d 2074 6f72 6368 2e63     out = torch.c
-0000ba90: 6174 280a 2020 2020 2020 2020 2020 2020  at(.            
-0000baa0: 2865 6467 655f 6665 6174 7572 6573 5f6d  (edge_features_m
-0000bab0: 6561 6e2c 206e 6f64 655f 6665 6174 7572  ean, node_featur
-0000bac0: 6573 5f6d 6561 6e2c 2067 6c6f 6261 6c5f  es_mean, global_
-0000bad0: 6665 6174 7572 6573 292c 2064 696d 3d31  features), dim=1
-0000bae0: 290a 2020 2020 2020 2020 666f 7220 6d6f  ).        for mo
-0000baf0: 6465 6c20 696e 2073 656c 662e 676c 6f62  del in self.glob
-0000bb00: 616c 5f6d 6f64 656c 733a 0a20 2020 2020  al_models:.     
-0000bb10: 2020 2020 2020 206f 7574 203d 206d 6f64         out = mod
-0000bb20: 656c 286f 7574 290a 2020 2020 2020 2020  el(out).        
-0000bb30: 7265 7475 726e 2073 656c 662e 676c 6f62  return self.glob
-0000bb40: 616c 5f64 656e 7365 286f 7574 290a 0a20  al_dense(out).. 
-0000bb50: 2020 2064 6566 2066 6f72 7761 7264 280a     def forward(.
-0000bb60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000bb70: 2c0a 2020 2020 2020 2020 2020 2020 6e6f  ,.            no
-0000bb80: 6465 5f66 6561 7475 7265 733a 2054 656e  de_features: Ten
-0000bb90: 736f 722c 0a20 2020 2020 2020 2020 2020  sor,.           
-0000bba0: 2065 6467 655f 696e 6465 783a 2054 656e   edge_index: Ten
-0000bbb0: 736f 722c 0a20 2020 2020 2020 2020 2020  sor,.           
-0000bbc0: 2065 6467 655f 6665 6174 7572 6573 3a20   edge_features: 
-0000bbd0: 5465 6e73 6f72 2c0a 2020 2020 2020 2020  Tensor,.        
-0000bbe0: 2020 2020 676c 6f62 616c 5f66 6561 7475      global_featu
-0000bbf0: 7265 733a 2054 656e 736f 722c 0a20 2020  res: Tensor,.   
-0000bc00: 2020 2020 2020 2020 2062 6174 6368 3a20           batch: 
-0000bc10: 4f70 7469 6f6e 616c 5b54 656e 736f 725d  Optional[Tensor]
-0000bc20: 203d 204e 6f6e 6529 202d 3e20 5475 706c   = None) -> Tupl
-0000bc30: 655b 5465 6e73 6f72 2c20 5465 6e73 6f72  e[Tensor, Tensor
-0000bc40: 2c20 5465 6e73 6f72 5d3a 0a20 2020 2020  , Tensor]:.     
-0000bc50: 2020 2022 2222 4f75 7470 7574 2063 6f6d     """Output com
-0000bc60: 7075 7461 7469 6f6e 2066 6f72 2061 2047  putation for a G
-0000bc70: 7261 7068 4e65 7477 6f72 6b0a 0a20 2020  raphNetwork..   
-0000bc80: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-0000bc90: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-0000bca0: 2d2d 0a20 2020 2020 2020 206e 6f64 655f  --.        node_
-0000bcb0: 6665 6174 7572 6573 3a20 746f 7263 682e  features: torch.
-0000bcc0: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
-0000bcd0: 2020 2049 6e70 7574 206e 6f64 6520 6665     Input node fe
-0000bce0: 6174 7572 6573 206f 6620 7368 6170 6520  atures of shape 
-0000bcf0: 3a6d 6174 683a 6028 7c5c 6d61 7468 6361  :math:`(|\mathca
-0000bd00: 6c7b 567d 7c2c 2046 5f6e 2960 0a20 2020  l{V}|, F_n)`.   
-0000bd10: 2020 2020 2065 6467 655f 696e 6465 783a       edge_index:
-0000bd20: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
-0000bd30: 2020 2020 2020 2020 2020 4564 6765 2069            Edge i
-0000bd40: 6e64 6578 6573 206f 6620 7368 6170 6520  ndexes of shape 
-0000bd50: 3a6d 6174 683a 6028 322c 207c 5c6d 6174  :math:`(2, |\mat
-0000bd60: 6863 616c 7b45 7d7c 2960 0a20 2020 2020  hcal{E}|)`.     
-0000bd70: 2020 2065 6467 655f 6665 6174 7572 6573     edge_features
-0000bd80: 3a20 746f 7263 682e 5465 6e73 6f72 0a20  : torch.Tensor. 
-0000bd90: 2020 2020 2020 2020 2020 2045 6467 6520             Edge 
-0000bda0: 6665 6174 7572 6573 206f 6620 7468 6520  features of the 
-0000bdb0: 6772 6170 682c 2073 6861 7065 3a20 3a6d  graph, shape: :m
-0000bdc0: 6174 683a 6028 7c5c 6d61 7468 6361 6c7b  ath:`(|\mathcal{
-0000bdd0: 457d 7c2c 2046 5f65 2960 0a20 2020 2020  E}|, F_e)`.     
-0000bde0: 2020 2067 6c6f 6261 6c5f 6665 6174 7572     global_featur
-0000bdf0: 6573 3a20 746f 7263 682e 5465 6e73 6f72  es: torch.Tensor
-0000be00: 0a20 2020 2020 2020 2020 2020 2047 6c6f  .            Glo
-0000be10: 6261 6c20 6665 6174 7572 6573 206f 6620  bal features of 
-0000be20: 7468 6520 6772 6170 682c 2073 6861 7065  the graph, shape
-0000be30: 3a20 3a6d 6174 683a 6028 465f 672c 2031  : :math:`(F_g, 1
-0000be40: 2960 2077 6865 7265 2c20 3a6d 6174 683a  )` where, :math:
-0000be50: 607c 5c6d 6174 6863 616c 7b56 7d7c 6020  `|\mathcal{V}|` 
-0000be60: 616e 6420 3a6d 6174 683a 607c 5c6d 6174  and :math:`|\mat
-0000be70: 6863 616c 7b45 7d7c 6020 6465 6e6f 7465  hcal{E}|` denote
-0000be80: 7320 7468 6520 6e75 6d62 6572 206f 6620  s the number of 
-0000be90: 6e6f 6465 7320 616e 6420 6564 6765 7320  nodes and edges 
-0000bea0: 696e 2074 6865 2067 7261 7068 2c0a 2020  in the graph,.  
-0000beb0: 2020 2020 2020 2020 2020 3a6d 6174 683a            :math:
-0000bec0: 6046 5f6e 602c 203a 6d61 7468 3a60 465f  `F_n`, :math:`F_
-0000bed0: 6560 2c20 3a6d 6174 683a 6046 5f67 6020  e`, :math:`F_g` 
-0000bee0: 6465 6e6f 7465 7320 7468 6520 6e75 6d62  denotes the numb
-0000bef0: 6572 206f 6620 6e6f 6465 2066 6561 7475  er of node featu
-0000bf00: 7265 732c 2065 6467 6520 6665 6174 7572  res, edge featur
-0000bf10: 6573 2061 6e64 2067 6c6f 6261 6c20 7374  es and global st
-0000bf20: 6174 6520 6665 6174 7572 6573 2072 6573  ate features res
-0000bf30: 7065 6374 6976 656c 792e 0a20 2020 2020  pectively..     
-0000bf40: 2020 2062 6174 6368 3a20 746f 7263 682e     batch: torch.
-0000bf50: 4c6f 6e67 5465 6e73 6f72 2028 6f70 7469  LongTensor (opti
-0000bf60: 6f6e 616c 2c20 6465 6661 756c 743a 204e  onal, default: N
-0000bf70: 6f6e 6529 0a20 2020 2020 2020 2020 2020  one).           
-0000bf80: 2041 2076 6563 746f 7220 7468 6174 206d   A vector that m
-0000bf90: 6170 7320 6561 6368 206e 6f64 6520 746f  aps each node to
-0000bfa0: 2069 7473 2072 6573 7065 6374 6976 6520   its respective 
-0000bfb0: 6772 6170 6820 6964 656e 7469 6669 6572  graph identifier
-0000bfc0: 2e20 5468 6520 6174 7472 6962 7574 6520  . The attribute 
-0000bfd0: 6973 2075 7365 6420 6f6e 6c79 2077 6865  is used only whe
-0000bfe0: 6e20 6d6f 7265 2074 6861 6e20 6f6e 6520  n more than one 
-0000bff0: 6772 6170 6820 6172 6520 6261 7463 6865  graph are batche
-0000c000: 6420 746f 6765 7468 6572 2064 7572 696e  d together durin
-0000c010: 6720 6120 7369 6e67 6c65 2066 6f72 7761  g a single forwa
-0000c020: 7264 2070 6173 732e 0a20 2020 2020 2020  rd pass..       
-0000c030: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-0000c040: 6261 7463 6820 6973 204e 6f6e 653a 0a20  batch is None:. 
-0000c050: 2020 2020 2020 2020 2020 2062 6174 6368             batch
-0000c060: 203d 206e 6f64 655f 6665 6174 7572 6573   = node_features
-0000c070: 2e6e 6577 5f7a 6572 6f73 286e 6f64 655f  .new_zeros(node_
-0000c080: 6665 6174 7572 6573 2e73 697a 6528 3029  features.size(0)
-0000c090: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000c0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c0b0: 2020 2020 2020 2020 2020 2020 2020 6474                dt
-0000c0c0: 7970 653d 746f 7263 682e 696e 7436 3429  ype=torch.int64)
-0000c0d0: 0a0a 2020 2020 2020 2020 6e6f 6465 5f66  ..        node_f
-0000c0e0: 6561 7475 7265 735f 636f 7079 2c20 6564  eatures_copy, ed
-0000c0f0: 6765 5f66 6561 7475 7265 735f 636f 7079  ge_features_copy
-0000c100: 2c20 676c 6f62 616c 5f66 6561 7475 7265  , global_feature
-0000c110: 735f 636f 7079 203d 206e 6f64 655f 6665  s_copy = node_fe
-0000c120: 6174 7572 6573 2c20 6564 6765 5f66 6561  atures, edge_fea
-0000c130: 7475 7265 732c 2067 6c6f 6261 6c5f 6665  tures, global_fe
-0000c140: 6174 7572 6573 0a20 2020 2020 2020 2069  atures.        i
-0000c150: 6620 7365 6c66 2e69 735f 756e 6469 7265  f self.is_undire
-0000c160: 6374 6564 2069 7320 5472 7565 3a0a 2020  cted is True:.  
-0000c170: 2020 2020 2020 2020 2020 2320 686f 6c64            # hold
-0000c180: 696e 6720 6269 2d64 6972 6563 7469 6f6e  ing bi-direction
-0000c190: 616c 2065 6467 6573 2069 6e20 6361 7365  al edges in case
-0000c1a0: 206f 6620 756e 6469 7265 6374 6564 2067   of undirected g
-0000c1b0: 7261 7068 730a 2020 2020 2020 2020 2020  raphs.          
-0000c1c0: 2020 6564 6765 5f69 6e64 6578 203d 2074    edge_index = t
-0000c1d0: 6f72 6368 2e63 6174 2828 6564 6765 5f69  orch.cat((edge_i
-0000c1e0: 6e64 6578 2c20 6564 6765 5f69 6e64 6578  ndex, edge_index
-0000c1f0: 2e66 6c69 7028 5b30 5d29 292c 2064 696d  .flip([0])), dim
-0000c200: 3d31 290a 2020 2020 2020 2020 2020 2020  =1).            
-0000c210: 6564 6765 5f66 6561 7475 7265 735f 6c65  edge_features_le
-0000c220: 6e20 3d20 6564 6765 5f66 6561 7475 7265  n = edge_feature
-0000c230: 732e 7368 6170 655b 305d 0a20 2020 2020  s.shape[0].     
-0000c240: 2020 2020 2020 2065 6467 655f 6665 6174         edge_feat
-0000c250: 7572 6573 203d 2074 6f72 6368 2e63 6174  ures = torch.cat
-0000c260: 2828 6564 6765 5f66 6561 7475 7265 732c  ((edge_features,
-0000c270: 2065 6467 655f 6665 6174 7572 6573 292c   edge_features),
-0000c280: 2064 696d 3d30 290a 2020 2020 2020 2020   dim=0).        
-0000c290: 6564 6765 5f62 6174 6368 5f6d 6170 203d  edge_batch_map =
-0000c2a0: 2062 6174 6368 5b65 6467 655f 696e 6465   batch[edge_inde
-0000c2b0: 785b 305d 5d0a 2020 2020 2020 2020 6564  x[0]].        ed
-0000c2c0: 6765 5f66 6561 7475 7265 7320 3d20 7365  ge_features = se
-0000c2d0: 6c66 2e5f 7570 6461 7465 5f65 6467 655f  lf._update_edge_
-0000c2e0: 6665 6174 7572 6573 286e 6f64 655f 6665  features(node_fe
-0000c2f0: 6174 7572 6573 2c20 6564 6765 5f69 6e64  atures, edge_ind
-0000c300: 6578 2c0a 2020 2020 2020 2020 2020 2020  ex,.            
-0000c310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c330: 2020 2020 2020 2065 6467 655f 6665 6174         edge_feat
-0000c340: 7572 6573 2c0a 2020 2020 2020 2020 2020  ures,.          
-0000c350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c370: 2020 2020 2020 2020 2067 6c6f 6261 6c5f           global_
-0000c380: 6665 6174 7572 6573 2c0a 2020 2020 2020  features,.      
-0000c390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c3b0: 2020 2020 2020 2020 2020 2020 2065 6467               edg
-0000c3c0: 655f 6261 7463 685f 6d61 7029 0a20 2020  e_batch_map).   
-0000c3d0: 2020 2020 206e 6f64 655f 6665 6174 7572       node_featur
-0000c3e0: 6573 203d 2073 656c 662e 5f75 7064 6174  es = self._updat
-0000c3f0: 655f 6e6f 6465 5f66 6561 7475 7265 7328  e_node_features(
-0000c400: 6e6f 6465 5f66 6561 7475 7265 732c 2065  node_features, e
-0000c410: 6467 655f 696e 6465 782c 0a20 2020 2020  dge_index,.     
-0000c420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c440: 2020 2020 2020 2020 2020 2020 2020 6564                ed
-0000c450: 6765 5f66 6561 7475 7265 732c 0a20 2020  ge_features,.   
-0000c460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c490: 676c 6f62 616c 5f66 6561 7475 7265 732c  global_features,
-0000c4a0: 2062 6174 6368 290a 2020 2020 2020 2020   batch).        
-0000c4b0: 676c 6f62 616c 5f66 6561 7475 7265 7320  global_features 
-0000c4c0: 3d20 7365 6c66 2e5f 7570 6461 7465 5f67  = self._update_g
-0000c4d0: 6c6f 6261 6c5f 6665 6174 7572 6573 286e  lobal_features(n
-0000c4e0: 6f64 655f 6665 6174 7572 6573 2c0a 2020  ode_features,.  
-0000c4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003560: 2073 656c 662e 6163 7469 7661 7469 6f6e   self.activation
+00003570: 5f66 6e73 2c0a 2020 2020 2020 2020 2020  _fns,.          
+00003580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000035a0: 2020 2020 2020 2073 656c 662e 6472 6f70         self.drop
+000035b0: 6f75 7473 293a 0a20 2020 2020 2020 2020  outs):.         
+000035c0: 2020 2078 203d 206c 6179 6572 2878 290a     x = layer(x).
+000035d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000035e0: 6472 6f70 6f75 7420 3e20 302e 2061 6e64  dropout > 0. and
+000035f0: 2064 726f 706f 7574 5f73 7769 7463 683a   dropout_switch:
+00003600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003610: 2078 203d 2046 2e64 726f 706f 7574 2878   x = F.dropout(x
+00003620: 2c20 6472 6f70 6f75 7429 0a0a 2020 2020  , dropout)..    
+00003630: 2020 2020 2020 2020 2320 7265 7369 6475          # residu
+00003640: 616c 2062 6c6f 636b 7320 6361 6e20 6f6e  al blocks can on
+00003650: 6c79 2062 6520 7573 6564 2077 6865 6e20  ly be used when 
+00003660: 7375 6363 6573 7369 7665 206c 6179 6572  successive layer
+00003670: 7320 6861 7665 2074 6865 2073 616d 6520  s have the same 
+00003680: 6f75 7470 7574 2073 6861 7065 0a20 2020  output shape.   
+00003690: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+000036a0: 2e72 6573 6964 7561 6c20 616e 6420 782e  .residual and x.
+000036b0: 7368 6170 655b 315d 203d 3d20 7072 6576  shape[1] == prev
+000036c0: 5f6c 6179 6572 2e73 6861 7065 5b31 5d3a  _layer.shape[1]:
+000036d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000036e0: 2078 203d 2078 202b 2070 7265 765f 6c61   x = x + prev_la
+000036f0: 7965 720a 0a20 2020 2020 2020 2020 2020  yer..           
+00003700: 2069 6620 6163 7469 7661 7469 6f6e 5f66   if activation_f
+00003710: 6e20 6973 206e 6f74 204e 6f6e 653a 0a20  n is not None:. 
+00003720: 2020 2020 2020 2020 2020 2020 2020 2078                 x
+00003730: 203d 2061 6374 6976 6174 696f 6e5f 666e   = activation_fn
+00003740: 2878 290a 0a20 2020 2020 2020 2020 2020  (x)..           
+00003750: 2070 7265 765f 6c61 7965 7220 3d20 780a   prev_layer = x.
+00003760: 0a20 2020 2020 2020 2078 203d 2073 656c  .        x = sel
+00003770: 662e 506f 6f6c 4c61 7965 7228 782c 206b  f.PoolLayer(x, k
+00003780: 6572 6e65 6c5f 7369 7a65 3d78 2e73 697a  ernel_size=x.siz
+00003790: 6528 295b 323a 5d29 0a0a 2020 2020 2020  e()[2:])..      
+000037a0: 2020 6f75 7470 7574 7320 3d20 5b5d 0a20    outputs = []. 
+000037b0: 2020 2020 2020 2062 6174 6368 5f73 697a         batch_siz
+000037c0: 6520 3d20 782e 7368 6170 655b 305d 0a0a  e = x.shape[0]..
+000037d0: 2020 2020 2020 2020 7820 3d20 746f 7263          x = torc
+000037e0: 682e 7265 7368 6170 6528 782c 2028 6261  h.reshape(x, (ba
+000037f0: 7463 685f 7369 7a65 2c20 2d31 2929 0a0a  tch_size, -1))..
+00003800: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00003810: 6d6f 6465 203d 3d20 2263 6c61 7373 6966  mode == "classif
+00003820: 6963 6174 696f 6e22 3a0a 0a20 2020 2020  ication":..     
+00003830: 2020 2020 2020 206c 6f67 6974 7320 3d20         logits = 
+00003840: 7365 6c66 2e63 6c61 7373 6966 6965 725f  self.classifier_
+00003850: 6666 6e28 7829 0a20 2020 2020 2020 2020  ffn(x).         
+00003860: 2020 206c 6f67 6974 7320 3d20 6c6f 6769     logits = logi
+00003870: 7473 2e76 6965 7728 6261 7463 685f 7369  ts.view(batch_si
+00003880: 7a65 2c20 7365 6c66 2e6e 5f74 6173 6b73  ze, self.n_tasks
+00003890: 2c20 7365 6c66 2e6e 5f63 6c61 7373 6573  , self.n_classes
+000038a0: 290a 2020 2020 2020 2020 2020 2020 6f75  ).            ou
+000038b0: 7470 7574 203d 2046 2e73 6f66 746d 6178  tput = F.softmax
+000038c0: 286c 6f67 6974 732c 2064 696d 3d32 290a  (logits, dim=2).
+000038d0: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
+000038e0: 7574 7320 3d20 5b6f 7574 7075 742c 206c  uts = [output, l
+000038f0: 6f67 6974 735d 0a0a 2020 2020 2020 2020  ogits]..        
+00003900: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00003910: 2020 6f75 7470 7574 203d 2073 656c 662e    output = self.
+00003920: 6f75 7470 7574 5f6c 6179 6572 2878 290a  output_layer(x).
+00003930: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
+00003940: 7574 203d 206f 7574 7075 742e 7669 6577  ut = output.view
+00003950: 2862 6174 6368 5f73 697a 652c 2073 656c  (batch_size, sel
+00003960: 662e 6e5f 7461 736b 7329 0a0a 2020 2020  f.n_tasks)..    
+00003970: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00003980: 756e 6365 7274 6169 6e74 793a 0a20 2020  uncertainty:.   
+00003990: 2020 2020 2020 2020 2020 2020 206c 6f67               log
+000039a0: 5f76 6172 203d 2073 656c 662e 756e 6365  _var = self.unce
+000039b0: 7274 6169 6e74 795f 6c61 7965 7228 7829  rtainty_layer(x)
+000039c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000039d0: 206c 6f67 5f76 6172 203d 206c 6f67 5f76   log_var = log_v
+000039e0: 6172 2e76 6965 7728 6261 7463 685f 7369  ar.view(batch_si
+000039f0: 7a65 2c20 7365 6c66 2e6e 5f74 6173 6b73  ze, self.n_tasks
+00003a00: 2c20 3129 0a20 2020 2020 2020 2020 2020  , 1).           
+00003a10: 2020 2020 2076 6172 203d 2074 6f72 6368       var = torch
+00003a20: 2e65 7870 286c 6f67 5f76 6172 290a 2020  .exp(log_var).  
+00003a30: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
+00003a40: 7470 7574 7320 3d20 5b6f 7574 7075 742c  tputs = [output,
+00003a50: 2076 6172 2c20 6f75 7470 7574 2c20 6c6f   var, output, lo
+00003a60: 675f 7661 725d 0a20 2020 2020 2020 2020  g_var].         
+00003a70: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00003a80: 2020 2020 2020 2020 206f 7574 7075 7473           outputs
+00003a90: 203d 205b 6f75 7470 7574 5d0a 0a20 2020   = [output]..   
+00003aa0: 2020 2020 2072 6574 7572 6e20 6f75 7470       return outp
+00003ab0: 7574 730a 0a0a 636c 6173 7320 5363 616c  uts...class Scal
+00003ac0: 654e 6f72 6d28 6e6e 2e4d 6f64 756c 6529  eNorm(nn.Module)
+00003ad0: 3a0a 2020 2020 2222 2241 7070 6c79 2053  :.    """Apply S
+00003ae0: 6361 6c65 204e 6f72 6d61 6c69 7a61 7469  cale Normalizati
+00003af0: 6f6e 2074 6f20 696e 7075 742e 0a0a 2020  on to input...  
+00003b00: 2020 5468 6520 5363 616c 654e 6f72 6d20    The ScaleNorm 
+00003b10: 6c61 7965 7220 6669 7273 7420 636f 6d70  layer first comp
+00003b20: 7574 6573 2074 6865 2073 7175 6172 6520  utes the square 
+00003b30: 726f 6f74 206f 6620 7468 6520 7363 616c  root of the scal
+00003b40: 652c 2074 6865 6e20 636f 6d70 7574 6573  e, then computes
+00003b50: 2074 6865 206d 6174 7269 782f 7665 6374   the matrix/vect
+00003b60: 6f72 206e 6f72 6d20 6f66 2074 6865 2069  or norm of the i
+00003b70: 6e70 7574 2074 656e 736f 722e 0a20 2020  nput tensor..   
+00003b80: 2054 6865 206e 6f72 6d20 7661 6c75 6520   The norm value 
+00003b90: 6973 2063 616c 6375 6c61 7465 6420 6173  is calculated as
+00003ba0: 2060 7371 7274 2873 6361 6c65 2920 2f20   `sqrt(scale) / 
+00003bb0: 6d61 7472 6978 206e 6f72 6d60 2e0a 2020  matrix norm`..  
+00003bc0: 2020 4669 6e61 6c6c 792c 2074 6865 2072    Finally, the r
+00003bd0: 6573 756c 7420 6973 2072 6574 7572 6e65  esult is returne
+00003be0: 6420 6173 2060 696e 7075 745f 7465 6e73  d as `input_tens
+00003bf0: 6f72 202a 206e 6f72 6d20 7661 6c75 6560  or * norm value`
+00003c00: 2e0a 0a20 2020 2054 6869 7320 6c61 7965  ...    This laye
+00003c10: 7220 6361 6e20 6265 2075 7365 6420 696e  r can be used in
+00003c20: 7374 6561 6420 6f66 204c 6179 6572 4e6f  stead of LayerNo
+00003c30: 726d 2077 6865 6e20 6120 7363 616c 6564  rm when a scaled
+00003c40: 2076 6572 7369 6f6e 206f 6620 7468 6520   version of the 
+00003c50: 6e6f 726d 2069 7320 7265 7175 6972 6564  norm is required
+00003c60: 2e0a 2020 2020 496e 7374 6561 6420 6f66  ..    Instead of
+00003c70: 2070 6572 666f 726d 696e 6720 7468 6520   performing the 
+00003c80: 7363 616c 696e 6720 6f70 6572 6174 696f  scaling operatio
+00003c90: 6e20 2860 7363 616c 6520 2f20 6e6f 726d  n (`scale / norm
+00003ca0: 6029 2069 6e20 6120 6c61 6d62 6461 2d6c  `) in a lambda-l
+00003cb0: 696b 6520 6c61 7965 722c 2077 6520 6172  ike layer, we ar
+00003cc0: 6520 6465 6669 6e69 6e67 2069 7420 7769  e defining it wi
+00003cd0: 7468 696e 2074 6869 7320 6c61 7965 7220  thin this layer 
+00003ce0: 746f 206d 616b 6520 7072 6f74 6f74 7970  to make prototyp
+00003cf0: 696e 6720 6d6f 7265 2065 6666 6963 6965  ing more efficie
+00003d00: 6e74 2e0a 0a20 2020 2052 6566 6572 656e  nt...    Referen
+00003d10: 6365 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ces.    --------
+00003d20: 2d2d 0a20 2020 202e 2e20 5b31 5d20 4c75  --.    .. [1] Lu
+00003d30: 6b61 737a 204d 617a 6961 726b 6120 6574  kasz Maziarka et
+00003d40: 2061 6c2e 2022 4d6f 6c65 6375 6c65 2041   al. "Molecule A
+00003d50: 7474 656e 7469 6f6e 2054 7261 6e73 666f  ttention Transfo
+00003d60: 726d 6572 2220 4772 6170 6820 5265 7072  rmer" Graph Repr
+00003d70: 6573 656e 7461 7469 6f6e 204c 6561 726e  esentation Learn
+00003d80: 696e 6720 776f 726b 7368 6f70 2061 6e64  ing workshop and
+00003d90: 204d 6163 6869 6e65 204c 6561 726e 696e   Machine Learnin
+00003da0: 6720 616e 6420 7468 6520 5068 7973 6963  g and the Physic
+00003db0: 616c 2053 6369 656e 6365 7320 776f 726b  al Sciences work
+00003dc0: 7368 6f70 2061 7420 4e65 7572 4950 5320  shop at NeurIPS 
+00003dd0: 3230 3139 2e20 3230 3230 2e20 6874 7470  2019. 2020. http
+00003de0: 733a 2f2f 6172 7869 762e 6f72 672f 6162  s://arxiv.org/ab
+00003df0: 732f 3230 3032 2e30 3832 3634 0a0a 2020  s/2002.08264..  
+00003e00: 2020 4578 616d 706c 6573 0a20 2020 202d    Examples.    -
+00003e10: 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20  -------.    >>> 
+00003e20: 6672 6f6d 2064 6565 7063 6865 6d2e 6d6f  from deepchem.mo
+00003e30: 6465 6c73 2e74 6f72 6368 5f6d 6f64 656c  dels.torch_model
+00003e40: 732e 6c61 7965 7273 2069 6d70 6f72 7420  s.layers import 
+00003e50: 5363 616c 654e 6f72 6d0a 2020 2020 3e3e  ScaleNorm.    >>
+00003e60: 3e20 7363 616c 6520 3d20 302e 3335 0a20  > scale = 0.35. 
+00003e70: 2020 203e 3e3e 206c 6179 6572 203d 2053     >>> layer = S
+00003e80: 6361 6c65 4e6f 726d 2873 6361 6c65 290a  caleNorm(scale).
+00003e90: 2020 2020 3e3e 3e20 696e 7075 745f 7465      >>> input_te
+00003ea0: 6e73 6f72 203d 2074 6f72 6368 2e74 656e  nsor = torch.ten
+00003eb0: 736f 7228 5b5b 312e 3236 392c 2033 392e  sor([[1.269, 39.
+00003ec0: 3336 5d2c 205b 302e 3030 3931 382c 202d  36], [0.00918, -
+00003ed0: 392e 3132 5d5d 290a 2020 2020 3e3e 3e20  9.12]]).    >>> 
+00003ee0: 6f75 7470 7574 5f74 656e 736f 7220 3d20  output_tensor = 
+00003ef0: 6c61 7965 7228 696e 7075 745f 7465 6e73  layer(input_tens
+00003f00: 6f72 290a 2020 2020 2222 220a 0a20 2020  or).    """..   
+00003f10: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+00003f20: 6c66 2c20 7363 616c 653a 2066 6c6f 6174  lf, scale: float
+00003f30: 2c20 6570 733a 2066 6c6f 6174 203d 2031  , eps: float = 1
+00003f40: 652d 3529 3a0a 2020 2020 2020 2020 2222  e-5):.        ""
+00003f50: 2249 6e69 7469 616c 697a 6520 6120 5363  "Initialize a Sc
+00003f60: 616c 654e 6f72 6d20 6c61 7965 722e 0a0a  aleNorm layer...
+00003f70: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+00003f80: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+00003f90: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7363  -----.        sc
+00003fa0: 616c 653a 2066 6c6f 6174 0a20 2020 2020  ale: float.     
+00003fb0: 2020 2020 2020 2053 6361 6c65 206d 6167         Scale mag
+00003fc0: 6e69 7475 6465 2e0a 2020 2020 2020 2020  nitude..        
+00003fd0: 6570 733a 2066 6c6f 6174 0a20 2020 2020  eps: float.     
+00003fe0: 2020 2020 2020 2045 7073 696c 6f6e 2076         Epsilon v
+00003ff0: 616c 7565 2e20 4465 6661 756c 7420 3d20  alue. Default = 
+00004000: 3165 2d35 2e0a 2020 2020 2020 2020 2222  1e-5..        ""
+00004010: 220a 2020 2020 2020 2020 7375 7065 7228  ".        super(
+00004020: 5363 616c 654e 6f72 6d2c 2073 656c 6629  ScaleNorm, self)
+00004030: 2e5f 5f69 6e69 745f 5f28 290a 2020 2020  .__init__().    
+00004040: 2020 2020 7365 6c66 2e73 6361 6c65 203d      self.scale =
+00004050: 206e 6e2e 5061 7261 6d65 7465 7228 746f   nn.Parameter(to
+00004060: 7263 682e 7465 6e73 6f72 286d 6174 682e  rch.tensor(math.
+00004070: 7371 7274 2873 6361 6c65 2929 290a 2020  sqrt(scale))).  
+00004080: 2020 2020 2020 7365 6c66 2e65 7073 203d        self.eps =
+00004090: 2065 7073 0a0a 2020 2020 6465 6620 666f   eps..    def fo
+000040a0: 7277 6172 6428 7365 6c66 2c20 783a 2074  rward(self, x: t
+000040b0: 6f72 6368 2e54 656e 736f 7229 202d 3e20  orch.Tensor) -> 
+000040c0: 746f 7263 682e 5465 6e73 6f72 3a0a 2020  torch.Tensor:.  
+000040d0: 2020 2020 2020 6e6f 726d 203d 2073 656c        norm = sel
+000040e0: 662e 7363 616c 6520 2f20 746f 7263 682e  f.scale / torch.
+000040f0: 6e6f 726d 2878 2c20 6469 6d3d 2d31 2c0a  norm(x, dim=-1,.
+00004100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004120: 2020 2020 2020 206b 6565 7064 696d 3d54         keepdim=T
+00004130: 7275 6529 2e63 6c61 6d70 286d 696e 3d73  rue).clamp(min=s
+00004140: 656c 662e 6570 7329 0a20 2020 2020 2020  elf.eps).       
+00004150: 2072 6574 7572 6e20 7820 2a20 6e6f 726d   return x * norm
+00004160: 0a0a 0a63 6c61 7373 204d 756c 7469 4865  ...class MultiHe
+00004170: 6164 6564 4d41 5441 7474 656e 7469 6f6e  adedMATAttention
+00004180: 286e 6e2e 4d6f 6475 6c65 293a 0a20 2020  (nn.Module):.   
+00004190: 2022 2222 4669 7273 7420 636f 6e73 7472   """First constr
+000041a0: 7563 7473 2061 6e20 6174 7465 6e74 696f  ucts an attentio
+000041b0: 6e20 6c61 7965 7220 7461 696c 6f72 6564  n layer tailored
+000041c0: 2074 6f20 7468 6520 4d6f 6c65 6375 6c61   to the Molecula
+000041d0: 7220 4174 7465 6e74 696f 6e20 5472 616e  r Attention Tran
+000041e0: 7366 6f72 6d65 7220 5b31 5d5f 2061 6e64  sformer [1]_ and
+000041f0: 2074 6865 6e20 636f 6e76 6572 7473 2069   then converts i
+00004200: 7420 696e 746f 204d 756c 7469 2d48 6561  t into Multi-Hea
+00004210: 6465 6420 4174 7465 6e74 696f 6e2e 0a0a  ded Attention...
+00004220: 2020 2020 496e 204d 756c 7469 2d48 6561      In Multi-Hea
+00004230: 6465 6420 6174 7465 6e74 696f 6e20 7468  ded attention th
+00004240: 6520 6174 7465 6e74 696f 6e20 6d65 6368  e attention mech
+00004250: 616e 6973 6d20 6d75 6c74 6970 6c65 2074  anism multiple t
+00004260: 696d 6573 2070 6172 616c 6c65 6c79 2074  imes parallely t
+00004270: 6872 6f75 6768 2074 6865 206d 756c 7469  hrough the multi
+00004280: 706c 6520 6174 7465 6e74 696f 6e20 6865  ple attention he
+00004290: 6164 732e 0a20 2020 2054 6875 732c 2064  ads..    Thus, d
+000042a0: 6966 6665 7265 6e74 2073 7562 7365 7175  ifferent subsequ
+000042b0: 656e 6365 7320 6f66 2061 2067 6976 656e  ences of a given
+000042c0: 2073 6571 7565 6e63 6573 2063 616e 2062   sequences can b
+000042d0: 6520 7072 6f63 6573 7365 6420 6469 6666  e processed diff
+000042e0: 6572 656e 746c 792e 0a20 2020 2054 6865  erently..    The
+000042f0: 2071 7565 7279 2c20 6b65 7920 616e 6420   query, key and 
+00004300: 7661 6c75 6520 7061 7261 6d65 7465 7273  value parameters
+00004310: 2061 7265 2073 706c 6974 206d 756c 7469   are split multi
+00004320: 706c 6520 7761 7973 2061 6e64 2065 6163  ple ways and eac
+00004330: 6820 7370 6c69 7420 6973 2070 6173 7365  h split is passe
+00004340: 6420 7365 7061 7261 7465 6c79 2074 6872  d separately thr
+00004350: 6f75 6768 2061 2064 6966 6665 7265 6e74  ough a different
+00004360: 2061 7474 656e 7469 6f6e 2068 6561 642e   attention head.
+00004370: 0a20 2020 2052 6566 6572 656e 6365 730a  .    References.
+00004380: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00004390: 2020 202e 2e20 5b31 5d20 4c75 6b61 737a     .. [1] Lukasz
+000043a0: 204d 617a 6961 726b 6120 6574 2061 6c2e   Maziarka et al.
+000043b0: 2022 4d6f 6c65 6375 6c65 2041 7474 656e   "Molecule Atten
+000043c0: 7469 6f6e 2054 7261 6e73 666f 726d 6572  tion Transformer
+000043d0: 2220 4772 6170 6820 5265 7072 6573 656e  " Graph Represen
+000043e0: 7461 7469 6f6e 204c 6561 726e 696e 6720  tation Learning 
+000043f0: 776f 726b 7368 6f70 2061 6e64 204d 6163  workshop and Mac
+00004400: 6869 6e65 204c 6561 726e 696e 6720 616e  hine Learning an
+00004410: 6420 7468 6520 5068 7973 6963 616c 2053  d the Physical S
+00004420: 6369 656e 6365 7320 776f 726b 7368 6f70  ciences workshop
+00004430: 2061 7420 4e65 7572 4950 5320 3230 3139   at NeurIPS 2019
+00004440: 2e20 3230 3230 2e20 6874 7470 733a 2f2f  . 2020. https://
+00004450: 6172 7869 762e 6f72 672f 6162 732f 3230  arxiv.org/abs/20
+00004460: 3032 2e30 3832 3634 0a20 2020 2045 7861  02.08264.    Exa
+00004470: 6d70 6c65 730a 2020 2020 2d2d 2d2d 2d2d  mples.    ------
+00004480: 2d2d 0a20 2020 203e 3e3e 2066 726f 6d20  --.    >>> from 
+00004490: 6465 6570 6368 656d 2e6d 6f64 656c 732e  deepchem.models.
+000044a0: 746f 7263 685f 6d6f 6465 6c73 2e6c 6179  torch_models.lay
+000044b0: 6572 7320 696d 706f 7274 204d 756c 7469  ers import Multi
+000044c0: 4865 6164 6564 4d41 5441 7474 656e 7469  HeadedMATAttenti
+000044d0: 6f6e 2c20 4d41 5445 6d62 6564 6469 6e67  on, MATEmbedding
+000044e0: 0a20 2020 203e 3e3e 2069 6d70 6f72 7420  .    >>> import 
+000044f0: 6465 6570 6368 656d 2061 7320 6463 0a20  deepchem as dc. 
+00004500: 2020 203e 3e3e 2069 6d70 6f72 7420 746f     >>> import to
+00004510: 7263 680a 2020 2020 3e3e 3e20 696e 7075  rch.    >>> inpu
+00004520: 745f 736d 696c 6520 3d20 2243 4322 0a20  t_smile = "CC". 
+00004530: 2020 203e 3e3e 2066 6561 7420 3d20 6463     >>> feat = dc
+00004540: 2e66 6561 742e 4d41 5446 6561 7475 7269  .feat.MATFeaturi
+00004550: 7a65 7228 290a 2020 2020 3e3e 3e20 696e  zer().    >>> in
+00004560: 7075 745f 736d 696c 6520 3d20 2243 4322  put_smile = "CC"
+00004570: 0a20 2020 203e 3e3e 206f 7574 203d 2066  .    >>> out = f
+00004580: 6561 742e 6665 6174 7572 697a 6528 696e  eat.featurize(in
+00004590: 7075 745f 736d 696c 6529 0a20 2020 203e  put_smile).    >
+000045a0: 3e3e 206e 6f64 6520 3d20 746f 7263 682e  >> node = torch.
+000045b0: 7465 6e73 6f72 286f 7574 5b30 5d2e 6e6f  tensor(out[0].no
+000045c0: 6465 5f66 6561 7475 7265 7329 2e66 6c6f  de_features).flo
+000045d0: 6174 2829 2e75 6e73 7175 6565 7a65 2830  at().unsqueeze(0
+000045e0: 290a 2020 2020 3e3e 3e20 6164 6a20 3d20  ).    >>> adj = 
+000045f0: 746f 7263 682e 7465 6e73 6f72 286f 7574  torch.tensor(out
+00004600: 5b30 5d2e 6164 6a61 6365 6e63 795f 6d61  [0].adjacency_ma
+00004610: 7472 6978 292e 666c 6f61 7428 292e 756e  trix).float().un
+00004620: 7371 7565 657a 6528 3029 0a20 2020 203e  squeeze(0).    >
+00004630: 3e3e 2064 6973 7420 3d20 746f 7263 682e  >> dist = torch.
+00004640: 7465 6e73 6f72 286f 7574 5b30 5d2e 6469  tensor(out[0].di
+00004650: 7374 616e 6365 5f6d 6174 7269 7829 2e66  stance_matrix).f
+00004660: 6c6f 6174 2829 2e75 6e73 7175 6565 7a65  loat().unsqueeze
+00004670: 2830 290a 2020 2020 3e3e 3e20 6d61 736b  (0).    >>> mask
+00004680: 203d 2074 6f72 6368 2e73 756d 2874 6f72   = torch.sum(tor
+00004690: 6368 2e61 6273 286e 6f64 6529 2c20 6469  ch.abs(node), di
+000046a0: 6d3d 2d31 2920 213d 2030 0a20 2020 203e  m=-1) != 0.    >
+000046b0: 3e3e 206c 6179 6572 203d 204d 756c 7469  >> layer = Multi
+000046c0: 4865 6164 6564 4d41 5441 7474 656e 7469  HeadedMATAttenti
+000046d0: 6f6e 280a 2020 2020 2e2e 2e20 2020 2064  on(.    ...    d
+000046e0: 6973 745f 6b65 726e 656c 3d27 736f 6674  ist_kernel='soft
+000046f0: 6d61 7827 2c0a 2020 2020 2e2e 2e20 2020  max',.    ...   
+00004700: 206c 616d 6264 615f 6174 7465 6e74 696f   lambda_attentio
+00004710: 6e3d 302e 3333 2c0a 2020 2020 2e2e 2e20  n=0.33,.    ... 
+00004720: 2020 206c 616d 6264 615f 6469 7374 616e     lambda_distan
+00004730: 6365 3d30 2e33 332c 0a20 2020 202e 2e2e  ce=0.33,.    ...
+00004740: 2020 2020 683d 3136 2c0a 2020 2020 2e2e      h=16,.    ..
+00004750: 2e20 2020 2068 7369 7a65 3d31 3032 342c  .    hsize=1024,
+00004760: 0a20 2020 202e 2e2e 2020 2020 6472 6f70  .    ...    drop
+00004770: 6f75 745f 703d 302e 3029 0a20 2020 203e  out_p=0.0).    >
+00004780: 3e3e 206f 7020 3d20 4d41 5445 6d62 6564  >> op = MATEmbed
+00004790: 6469 6e67 2829 286e 6f64 6529 0a20 2020  ding()(node).   
+000047a0: 203e 3e3e 206f 7574 7075 7420 3d20 6c61   >>> output = la
+000047b0: 7965 7228 6f70 2c20 6f70 2c20 6f70 2c20  yer(op, op, op, 
+000047c0: 6d61 736b 2c20 6164 6a2c 2064 6973 7429  mask, adj, dist)
+000047d0: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
+000047e0: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+000047f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004800: 2020 6469 7374 5f6b 6572 6e65 6c3a 2073    dist_kernel: s
+00004810: 7472 203d 2027 736f 6674 6d61 7827 2c0a  tr = 'softmax',.
+00004820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004830: 206c 616d 6264 615f 6174 7465 6e74 696f   lambda_attentio
+00004840: 6e3a 2066 6c6f 6174 203d 2030 2e33 332c  n: float = 0.33,
+00004850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004860: 2020 6c61 6d62 6461 5f64 6973 7461 6e63    lambda_distanc
+00004870: 653a 2066 6c6f 6174 203d 2030 2e33 332c  e: float = 0.33,
+00004880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004890: 2020 683a 2069 6e74 203d 2031 362c 0a20    h: int = 16,. 
+000048a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000048b0: 6873 697a 653a 2069 6e74 203d 2031 3032  hsize: int = 102
+000048c0: 342c 0a20 2020 2020 2020 2020 2020 2020  4,.             
+000048d0: 2020 2020 6472 6f70 6f75 745f 703a 2066      dropout_p: f
+000048e0: 6c6f 6174 203d 2030 2e30 2c0a 2020 2020  loat = 0.0,.    
+000048f0: 2020 2020 2020 2020 2020 2020 206f 7574               out
+00004900: 7075 745f 6269 6173 3a20 626f 6f6c 203d  put_bias: bool =
+00004910: 2054 7275 6529 3a0a 2020 2020 2020 2020   True):.        
+00004920: 2222 2249 6e69 7469 616c 697a 6520 6120  """Initialize a 
+00004930: 6d75 6c74 692d 6865 6164 6564 2061 7474  multi-headed att
+00004940: 656e 7469 6f6e 206c 6179 6572 2e0a 2020  ention layer..  
+00004950: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+00004960: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00004970: 2d2d 2d0a 2020 2020 2020 2020 6469 7374  ---.        dist
+00004980: 5f6b 6572 6e65 6c3a 2073 7472 0a20 2020  _kernel: str.   
+00004990: 2020 2020 2020 2020 204b 6572 6e65 6c20           Kernel 
+000049a0: 6163 7469 7661 7469 6f6e 2074 6f20 6265  activation to be
+000049b0: 2075 7365 642e 2043 616e 2062 6520 6569   used. Can be ei
+000049c0: 7468 6572 2027 736f 6674 6d61 7827 2066  ther 'softmax' f
+000049d0: 6f72 2073 6f66 746d 6178 206f 7220 2765  or softmax or 'e
+000049e0: 7870 2720 666f 7220 6578 706f 6e65 6e74  xp' for exponent
+000049f0: 6961 6c2e 0a20 2020 2020 2020 206c 616d  ial..        lam
+00004a00: 6264 615f 6174 7465 6e74 696f 6e3a 2066  bda_attention: f
+00004a10: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
+00004a20: 2043 6f6e 7374 616e 7420 746f 2062 6520   Constant to be 
+00004a30: 6d75 6c74 6970 6c69 6564 2077 6974 6820  multiplied with 
+00004a40: 7468 6520 6174 7465 6e74 696f 6e20 6d61  the attention ma
+00004a50: 7472 6978 2e0a 2020 2020 2020 2020 6c61  trix..        la
+00004a60: 6d62 6461 5f64 6973 7461 6e63 653a 2066  mbda_distance: f
+00004a70: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
+00004a80: 2043 6f6e 7374 616e 7420 746f 2062 6520   Constant to be 
+00004a90: 6d75 6c74 6970 6c69 6564 2077 6974 6820  multiplied with 
+00004aa0: 7468 6520 6469 7374 616e 6365 206d 6174  the distance mat
+00004ab0: 7269 782e 0a20 2020 2020 2020 2068 3a20  rix..        h: 
+00004ac0: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
+00004ad0: 4e75 6d62 6572 206f 6620 6174 7465 6e74  Number of attent
+00004ae0: 696f 6e20 6865 6164 732e 0a20 2020 2020  ion heads..     
+00004af0: 2020 2068 7369 7a65 3a20 696e 740a 2020     hsize: int.  
+00004b00: 2020 2020 2020 2020 2020 5369 7a65 206f            Size o
+00004b10: 6620 6465 6e73 6520 6c61 7965 722e 0a20  f dense layer.. 
+00004b20: 2020 2020 2020 2064 726f 706f 7574 5f70         dropout_p
+00004b30: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
+00004b40: 2020 2020 4472 6f70 6f75 7420 7072 6f62      Dropout prob
+00004b50: 6162 696c 6974 792e 0a20 2020 2020 2020  ability..       
+00004b60: 206f 7574 7075 745f 6269 6173 3a20 626f   output_bias: bo
+00004b70: 6f6c 0a20 2020 2020 2020 2020 2020 2049  ol.            I
+00004b80: 6620 5472 7565 2c20 6465 6e73 6520 6c61  f True, dense la
+00004b90: 7965 7273 2077 696c 6c20 7573 6520 6269  yers will use bi
+00004ba0: 6173 2076 6563 746f 7273 2e0a 2020 2020  as vectors..    
+00004bb0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00004bc0: 7375 7065 7228 292e 5f5f 696e 6974 5f5f  super().__init__
+00004bd0: 2829 0a20 2020 2020 2020 2069 6620 6469  ().        if di
+00004be0: 7374 5f6b 6572 6e65 6c20 3d3d 2022 736f  st_kernel == "so
+00004bf0: 6674 6d61 7822 3a0a 2020 2020 2020 2020  ftmax":.        
+00004c00: 2020 2020 7365 6c66 2e64 6973 745f 6b65      self.dist_ke
+00004c10: 726e 656c 203d 206c 616d 6264 6120 783a  rnel = lambda x:
+00004c20: 2074 6f72 6368 2e73 6f66 746d 6178 282d   torch.softmax(-
+00004c30: 782c 2064 696d 3d2d 3129 0a20 2020 2020  x, dim=-1).     
+00004c40: 2020 2065 6c69 6620 6469 7374 5f6b 6572     elif dist_ker
+00004c50: 6e65 6c20 3d3d 2022 6578 7022 3a0a 2020  nel == "exp":.  
+00004c60: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+00004c70: 6973 745f 6b65 726e 656c 203d 206c 616d  ist_kernel = lam
+00004c80: 6264 6120 783a 2074 6f72 6368 2e65 7870  bda x: torch.exp
+00004c90: 282d 7829 0a20 2020 2020 2020 2073 656c  (-x).        sel
+00004ca0: 662e 6c61 6d62 6461 5f61 7474 656e 7469  f.lambda_attenti
+00004cb0: 6f6e 203d 206c 616d 6264 615f 6174 7465  on = lambda_atte
+00004cc0: 6e74 696f 6e0a 2020 2020 2020 2020 7365  ntion.        se
+00004cd0: 6c66 2e6c 616d 6264 615f 6469 7374 616e  lf.lambda_distan
+00004ce0: 6365 203d 206c 616d 6264 615f 6469 7374  ce = lambda_dist
+00004cf0: 616e 6365 0a20 2020 2020 2020 2073 656c  ance.        sel
+00004d00: 662e 6c61 6d62 6461 5f61 646a 6163 656e  f.lambda_adjacen
+00004d10: 6379 203d 2031 2e30 202d 2073 656c 662e  cy = 1.0 - self.
+00004d20: 6c61 6d62 6461 5f61 7474 656e 7469 6f6e  lambda_attention
+00004d30: 202d 2073 656c 662e 6c61 6d62 6461 5f64   - self.lambda_d
+00004d40: 6973 7461 6e63 650a 2020 2020 2020 2020  istance.        
+00004d50: 7365 6c66 2e64 5f6b 203d 2068 7369 7a65  self.d_k = hsize
+00004d60: 202f 2f20 680a 2020 2020 2020 2020 7365   // h.        se
+00004d70: 6c66 2e68 203d 2068 0a20 2020 2020 2020  lf.h = h.       
+00004d80: 206c 696e 6561 725f 6c61 7965 7220 3d20   linear_layer = 
+00004d90: 6e6e 2e4c 696e 6561 7228 6873 697a 652c  nn.Linear(hsize,
+00004da0: 2068 7369 7a65 290a 2020 2020 2020 2020   hsize).        
+00004db0: 7365 6c66 2e6c 696e 6561 725f 6c61 7965  self.linear_laye
+00004dc0: 7273 203d 206e 6e2e 4d6f 6475 6c65 4c69  rs = nn.ModuleLi
+00004dd0: 7374 285b 6c69 6e65 6172 5f6c 6179 6572  st([linear_layer
+00004de0: 2066 6f72 205f 2069 6e20 7261 6e67 6528   for _ in range(
+00004df0: 3329 5d29 0a20 2020 2020 2020 2073 656c  3)]).        sel
+00004e00: 662e 6472 6f70 6f75 745f 7020 3d20 6e6e  f.dropout_p = nn
+00004e10: 2e44 726f 706f 7574 2864 726f 706f 7574  .Dropout(dropout
+00004e20: 5f70 290a 2020 2020 2020 2020 7365 6c66  _p).        self
+00004e30: 2e6f 7574 7075 745f 6c69 6e65 6172 203d  .output_linear =
+00004e40: 206e 6e2e 4c69 6e65 6172 2868 7369 7a65   nn.Linear(hsize
+00004e50: 2c20 6873 697a 652c 206f 7574 7075 745f  , hsize, output_
+00004e60: 6269 6173 290a 0a20 2020 2064 6566 205f  bias)..    def _
+00004e70: 7369 6e67 6c65 5f61 7474 656e 7469 6f6e  single_attention
+00004e80: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+00004e90: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
+00004ea0: 7175 6572 793a 2074 6f72 6368 2e54 656e  query: torch.Ten
+00004eb0: 736f 722c 0a20 2020 2020 2020 2020 2020  sor,.           
+00004ec0: 206b 6579 3a20 746f 7263 682e 5465 6e73   key: torch.Tens
+00004ed0: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
+00004ee0: 7661 6c75 653a 2074 6f72 6368 2e54 656e  value: torch.Ten
+00004ef0: 736f 722c 0a20 2020 2020 2020 2020 2020  sor,.           
+00004f00: 206d 6173 6b3a 2074 6f72 6368 2e54 656e   mask: torch.Ten
+00004f10: 736f 722c 0a20 2020 2020 2020 2020 2020  sor,.           
+00004f20: 2061 646a 5f6d 6174 7269 783a 2074 6f72   adj_matrix: tor
+00004f30: 6368 2e54 656e 736f 722c 0a20 2020 2020  ch.Tensor,.     
+00004f40: 2020 2020 2020 2064 6973 7461 6e63 655f         distance_
+00004f50: 6d61 7472 6978 3a20 746f 7263 682e 5465  matrix: torch.Te
+00004f60: 6e73 6f72 2c0a 2020 2020 2020 2020 2020  nsor,.          
+00004f70: 2020 6472 6f70 6f75 745f 703a 2066 6c6f    dropout_p: flo
+00004f80: 6174 203d 2030 2e30 2c0a 2020 2020 2020  at = 0.0,.      
+00004f90: 2020 2020 2020 6570 733a 2066 6c6f 6174        eps: float
+00004fa0: 203d 2031 652d 362c 0a20 2020 2020 2020   = 1e-6,.       
+00004fb0: 2020 2020 2069 6e66 3a20 666c 6f61 7420       inf: float 
+00004fc0: 3d20 3165 3132 2920 2d3e 2054 7570 6c65  = 1e12) -> Tuple
+00004fd0: 5b74 6f72 6368 2e54 656e 736f 722c 2074  [torch.Tensor, t
+00004fe0: 6f72 6368 2e54 656e 736f 725d 3a0a 2020  orch.Tensor]:.  
+00004ff0: 2020 2020 2020 2222 2244 6566 696e 696e        """Definin
+00005000: 6720 616e 6420 636f 6d70 7574 696e 6720  g and computing 
+00005010: 6f75 7470 7574 2066 6f72 2061 2073 696e  output for a sin
+00005020: 676c 6520 4d41 5420 6174 7465 6e74 696f  gle MAT attentio
+00005030: 6e20 6c61 7965 722e 0a20 2020 2020 2020  n layer..       
+00005040: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00005050: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00005060: 2020 2020 2020 2071 7565 7279 3a20 746f         query: to
+00005070: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
+00005080: 2020 2020 2020 2053 7461 6e64 6172 6420         Standard 
+00005090: 7175 6572 7920 7061 7261 6d65 7465 7220  query parameter 
+000050a0: 666f 7220 6174 7465 6e74 696f 6e2e 0a20  for attention.. 
+000050b0: 2020 2020 2020 206b 6579 3a20 746f 7263         key: torc
+000050c0: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
+000050d0: 2020 2020 2053 7461 6e64 6172 6420 6b65       Standard ke
+000050e0: 7920 7061 7261 6d65 7465 7220 666f 7220  y parameter for 
+000050f0: 6174 7465 6e74 696f 6e2e 0a20 2020 2020  attention..     
+00005100: 2020 2076 616c 7565 3a20 746f 7263 682e     value: torch.
+00005110: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
+00005120: 2020 2053 7461 6e64 6172 6420 7661 6c75     Standard valu
+00005130: 6520 7061 7261 6d65 7465 7220 666f 7220  e parameter for 
+00005140: 6174 7465 6e74 696f 6e2e 0a20 2020 2020  attention..     
+00005150: 2020 206d 6173 6b3a 2074 6f72 6368 2e54     mask: torch.T
+00005160: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
+00005170: 2020 4d61 736b 7320 6f75 7420 7061 6464    Masks out padd
+00005180: 696e 6720 7661 6c75 6573 2073 6f20 7468  ing values so th
+00005190: 6174 2074 6865 7920 6172 6520 6e6f 7420  at they are not 
+000051a0: 7461 6b65 6e20 696e 746f 2061 6363 6f75  taken into accou
+000051b0: 6e74 2077 6865 6e20 636f 6d70 7574 696e  nt when computin
+000051c0: 6720 7468 6520 6174 7465 6e74 696f 6e20  g the attention 
+000051d0: 7363 6f72 652e 0a20 2020 2020 2020 2061  score..        a
+000051e0: 646a 5f6d 6174 7269 783a 2074 6f72 6368  dj_matrix: torch
+000051f0: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
+00005200: 2020 2020 4164 6a61 6365 6e63 7920 6d61      Adjacency ma
+00005210: 7472 6978 206f 6620 7468 6520 696e 7075  trix of the inpu
+00005220: 7420 6d6f 6c65 6375 6c65 2c20 7265 7475  t molecule, retu
+00005230: 726e 6564 2066 726f 6d20 6463 2e66 6561  rned from dc.fea
+00005240: 742e 4d41 5446 6561 7475 7269 7a65 7228  t.MATFeaturizer(
+00005250: 290a 2020 2020 2020 2020 6469 7374 5f6d  ).        dist_m
+00005260: 6174 7269 783a 2074 6f72 6368 2e54 656e  atrix: torch.Ten
+00005270: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
+00005280: 4469 7374 616e 6365 206d 6174 7269 7820  Distance matrix 
+00005290: 6f66 2074 6865 2069 6e70 7574 206d 6f6c  of the input mol
+000052a0: 6563 756c 652c 2072 6574 7572 6e65 6420  ecule, returned 
+000052b0: 6672 6f6d 2064 632e 6665 6174 2e4d 4154  from dc.feat.MAT
+000052c0: 4665 6174 7572 697a 6572 2829 0a20 2020  Featurizer().   
+000052d0: 2020 2020 2064 726f 706f 7574 5f70 3a20       dropout_p: 
+000052e0: 666c 6f61 740a 2020 2020 2020 2020 2020  float.          
+000052f0: 2020 4472 6f70 6f75 7420 7072 6f62 6162    Dropout probab
+00005300: 696c 6974 792e 0a20 2020 2020 2020 2065  ility..        e
+00005310: 7073 3a20 666c 6f61 740a 2020 2020 2020  ps: float.      
+00005320: 2020 2020 2020 4570 7369 6c6f 6e20 7661        Epsilon va
+00005330: 6c75 650a 2020 2020 2020 2020 696e 663a  lue.        inf:
+00005340: 2066 6c6f 6174 0a20 2020 2020 2020 2020   float.         
+00005350: 2020 2056 616c 7565 206f 6620 696e 6669     Value of infi
+00005360: 6e69 7479 2074 6f20 6265 2075 7365 642e  nity to be used.
+00005370: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00005380: 2020 2020 2064 5f6b 203d 2071 7565 7279       d_k = query
+00005390: 2e73 697a 6528 2d31 290a 0a20 2020 2020  .size(-1)..     
+000053a0: 2020 2073 636f 7265 7320 3d20 746f 7263     scores = torc
+000053b0: 682e 6d61 746d 756c 2871 7565 7279 2c20  h.matmul(query, 
+000053c0: 6b65 792e 7472 616e 7370 6f73 6528 2d32  key.transpose(-2
+000053d0: 2c20 2d31 2929 202f 206d 6174 682e 7371  , -1)) / math.sq
+000053e0: 7274 2864 5f6b 290a 0a20 2020 2020 2020  rt(d_k)..       
+000053f0: 2069 6620 6d61 736b 2069 7320 6e6f 7420   if mask is not 
+00005400: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00005410: 2020 7363 6f72 6573 203d 2073 636f 7265    scores = score
+00005420: 732e 6d61 736b 6564 5f66 696c 6c28 0a20  s.masked_fill(. 
+00005430: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00005440: 6173 6b2e 756e 7371 7565 657a 6528 3129  ask.unsqueeze(1)
+00005450: 2e72 6570 6561 7428 312c 2071 7565 7279  .repeat(1, query
+00005460: 2e73 6861 7065 5b31 5d2c 2071 7565 7279  .shape[1], query
+00005470: 2e73 6861 7065 5b32 5d2c 0a20 2020 2020  .shape[2],.     
+00005480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000054a0: 2020 2020 3129 203d 3d20 302c 202d 696e      1) == 0, -in
+000054b0: 6629 0a20 2020 2020 2020 2070 5f61 7474  f).        p_att
+000054c0: 6e20 3d20 462e 736f 6674 6d61 7828 7363  n = F.softmax(sc
+000054d0: 6f72 6573 2c20 6469 6d3d 2d31 290a 0a20  ores, dim=-1).. 
+000054e0: 2020 2020 2020 2061 646a 5f6d 6174 7269         adj_matri
+000054f0: 7820 3d20 6164 6a5f 6d61 7472 6978 202f  x = adj_matrix /
+00005500: 2028 0a20 2020 2020 2020 2020 2020 2074   (.            t
+00005510: 6f72 6368 2e73 756d 2874 6f72 6368 2e74  orch.sum(torch.t
+00005520: 656e 736f 7228 6164 6a5f 6d61 7472 6978  ensor(adj_matrix
+00005530: 292c 2064 696d 3d2d 3129 2e75 6e73 7175  ), dim=-1).unsqu
+00005540: 6565 7a65 2832 2920 2b20 6570 7329 0a0a  eeze(2) + eps)..
+00005550: 2020 2020 2020 2020 6966 206c 656e 2861          if len(a
+00005560: 646a 5f6d 6174 7269 782e 7368 6170 6529  dj_matrix.shape)
+00005570: 203c 3d20 333a 0a20 2020 2020 2020 2020   <= 3:.         
+00005580: 2020 2070 5f61 646a 203d 2061 646a 5f6d     p_adj = adj_m
+00005590: 6174 7269 782e 756e 7371 7565 657a 6528  atrix.unsqueeze(
+000055a0: 3129 2e72 6570 6561 7428 312c 2071 7565  1).repeat(1, que
+000055b0: 7279 2e73 6861 7065 5b31 5d2c 2031 2c20  ry.shape[1], 1, 
+000055c0: 3129 0a20 2020 2020 2020 2065 6c73 653a  1).        else:
+000055d0: 0a20 2020 2020 2020 2020 2020 2070 5f61  .            p_a
+000055e0: 646a 203d 2061 646a 5f6d 6174 7269 782e  dj = adj_matrix.
+000055f0: 7265 7065 6174 2831 2c20 7175 6572 792e  repeat(1, query.
+00005600: 7368 6170 655b 315d 2c20 312c 2031 290a  shape[1], 1, 1).
+00005610: 0a20 2020 2020 2020 2064 6973 7461 6e63  .        distanc
+00005620: 655f 6d61 7472 6978 203d 2074 6f72 6368  e_matrix = torch
+00005630: 2e74 656e 736f 7228 6469 7374 616e 6365  .tensor(distance
+00005640: 5f6d 6174 7269 7829 2e73 7175 6565 7a65  _matrix).squeeze
+00005650: 2829 2e6d 6173 6b65 645f 6669 6c6c 280a  ().masked_fill(.
+00005660: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
+00005670: 2e72 6570 6561 7428 312c 206d 6173 6b2e  .repeat(1, mask.
+00005680: 7368 6170 655b 2d31 5d2c 2031 2920 3d3d  shape[-1], 1) ==
+00005690: 2030 2c20 6e70 2e69 6e66 290a 0a20 2020   0, np.inf)..   
+000056a0: 2020 2020 2064 6973 7461 6e63 655f 6d61       distance_ma
+000056b0: 7472 6978 203d 2073 656c 662e 6469 7374  trix = self.dist
+000056c0: 5f6b 6572 6e65 6c28 6469 7374 616e 6365  _kernel(distance
+000056d0: 5f6d 6174 7269 7829 0a0a 2020 2020 2020  _matrix)..      
+000056e0: 2020 705f 6469 7374 203d 2064 6973 7461    p_dist = dista
+000056f0: 6e63 655f 6d61 7472 6978 2e75 6e73 7175  nce_matrix.unsqu
+00005700: 6565 7a65 2831 292e 7265 7065 6174 2831  eeze(1).repeat(1
+00005710: 2c20 7175 6572 792e 7368 6170 655b 315d  , query.shape[1]
+00005720: 2c20 312c 2031 290a 0a20 2020 2020 2020  , 1, 1)..       
+00005730: 2070 5f77 6569 6768 7465 6420 3d20 7365   p_weighted = se
+00005740: 6c66 2e6c 616d 6264 615f 6174 7465 6e74  lf.lambda_attent
+00005750: 696f 6e20 2a20 705f 6174 746e 202b 2073  ion * p_attn + s
+00005760: 656c 662e 6c61 6d62 6461 5f64 6973 7461  elf.lambda_dista
+00005770: 6e63 6520 2a20 705f 6469 7374 202b 2073  nce * p_dist + s
+00005780: 656c 662e 6c61 6d62 6461 5f61 646a 6163  elf.lambda_adjac
+00005790: 656e 6379 202a 2070 5f61 646a 0a20 2020  ency * p_adj.   
+000057a0: 2020 2020 2070 5f77 6569 6768 7465 6420       p_weighted 
+000057b0: 3d20 7365 6c66 2e64 726f 706f 7574 5f70  = self.dropout_p
+000057c0: 2870 5f77 6569 6768 7465 6429 0a0a 2020  (p_weighted)..  
+000057d0: 2020 2020 2020 7265 7475 726e 2074 6f72        return tor
+000057e0: 6368 2e6d 6174 6d75 6c28 705f 7765 6967  ch.matmul(p_weig
+000057f0: 6874 6564 2e66 6c6f 6174 2829 2c20 7661  hted.float(), va
+00005800: 6c75 652e 666c 6f61 7428 2929 2c20 705f  lue.float()), p_
+00005810: 6174 746e 0a0a 2020 2020 6465 6620 666f  attn..    def fo
+00005820: 7277 6172 6428 7365 6c66 2c0a 2020 2020  rward(self,.    
+00005830: 2020 2020 2020 2020 2020 2020 7175 6572              quer
+00005840: 793a 2074 6f72 6368 2e54 656e 736f 722c  y: torch.Tensor,
+00005850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005860: 206b 6579 3a20 746f 7263 682e 5465 6e73   key: torch.Tens
+00005870: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
+00005880: 2020 2020 7661 6c75 653a 2074 6f72 6368      value: torch
+00005890: 2e54 656e 736f 722c 0a20 2020 2020 2020  .Tensor,.       
+000058a0: 2020 2020 2020 2020 206d 6173 6b3a 2074           mask: t
+000058b0: 6f72 6368 2e54 656e 736f 722c 0a20 2020  orch.Tensor,.   
+000058c0: 2020 2020 2020 2020 2020 2020 2061 646a               adj
+000058d0: 5f6d 6174 7269 783a 2074 6f72 6368 2e54  _matrix: torch.T
+000058e0: 656e 736f 722c 0a20 2020 2020 2020 2020  ensor,.         
+000058f0: 2020 2020 2020 2064 6973 7461 6e63 655f         distance_
+00005900: 6d61 7472 6978 3a20 746f 7263 682e 5465  matrix: torch.Te
+00005910: 6e73 6f72 2c0a 2020 2020 2020 2020 2020  nsor,.          
+00005920: 2020 2020 2020 6472 6f70 6f75 745f 703a        dropout_p:
+00005930: 2066 6c6f 6174 203d 2030 2e30 2c0a 2020   float = 0.0,.  
+00005940: 2020 2020 2020 2020 2020 2020 2020 6570                ep
+00005950: 733a 2066 6c6f 6174 203d 2031 652d 362c  s: float = 1e-6,
+00005960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005970: 2069 6e66 3a20 666c 6f61 7420 3d20 3165   inf: float = 1e
+00005980: 3132 2920 2d3e 2074 6f72 6368 2e54 656e  12) -> torch.Ten
+00005990: 736f 723a 0a20 2020 2020 2020 2022 2222  sor:.        """
+000059a0: 4f75 7470 7574 2063 6f6d 7075 7461 7469  Output computati
+000059b0: 6f6e 2066 6f72 2074 6865 204d 756c 7469  on for the Multi
+000059c0: 4865 6164 6564 4174 7465 6e74 696f 6e20  HeadedAttention 
+000059d0: 6c61 7965 722e 0a20 2020 2020 2020 2050  layer..        P
+000059e0: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+000059f0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+00005a00: 2020 2020 2071 7565 7279 3a20 746f 7263       query: torc
+00005a10: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
+00005a20: 2020 2020 2053 7461 6e64 6172 6420 7175       Standard qu
+00005a30: 6572 7920 7061 7261 6d65 7465 7220 666f  ery parameter fo
+00005a40: 7220 6174 7465 6e74 696f 6e2e 0a20 2020  r attention..   
+00005a50: 2020 2020 206b 6579 3a20 746f 7263 682e       key: torch.
+00005a60: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
+00005a70: 2020 2053 7461 6e64 6172 6420 6b65 7920     Standard key 
+00005a80: 7061 7261 6d65 7465 7220 666f 7220 6174  parameter for at
+00005a90: 7465 6e74 696f 6e2e 0a20 2020 2020 2020  tention..       
+00005aa0: 2076 616c 7565 3a20 746f 7263 682e 5465   value: torch.Te
+00005ab0: 6e73 6f72 0a20 2020 2020 2020 2020 2020  nsor.           
+00005ac0: 2053 7461 6e64 6172 6420 7661 6c75 6520   Standard value 
+00005ad0: 7061 7261 6d65 7465 7220 666f 7220 6174  parameter for at
+00005ae0: 7465 6e74 696f 6e2e 0a20 2020 2020 2020  tention..       
+00005af0: 206d 6173 6b3a 2074 6f72 6368 2e54 656e   mask: torch.Ten
+00005b00: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
+00005b10: 4d61 736b 7320 6f75 7420 7061 6464 696e  Masks out paddin
+00005b20: 6720 7661 6c75 6573 2073 6f20 7468 6174  g values so that
+00005b30: 2074 6865 7920 6172 6520 6e6f 7420 7461   they are not ta
+00005b40: 6b65 6e20 696e 746f 2061 6363 6f75 6e74  ken into account
+00005b50: 2077 6865 6e20 636f 6d70 7574 696e 6720   when computing 
+00005b60: 7468 6520 6174 7465 6e74 696f 6e20 7363  the attention sc
+00005b70: 6f72 652e 0a20 2020 2020 2020 2061 646a  ore..        adj
+00005b80: 5f6d 6174 7269 783a 2074 6f72 6368 2e54  _matrix: torch.T
+00005b90: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
+00005ba0: 2020 4164 6a61 6365 6e63 7920 6d61 7472    Adjacency matr
+00005bb0: 6978 206f 6620 7468 6520 696e 7075 7420  ix of the input 
+00005bc0: 6d6f 6c65 6375 6c65 2c20 7265 7475 726e  molecule, return
+00005bd0: 6564 2066 726f 6d20 6463 2e66 6561 742e  ed from dc.feat.
+00005be0: 4d41 5446 6561 7475 7269 7a65 7228 290a  MATFeaturizer().
+00005bf0: 2020 2020 2020 2020 6469 7374 5f6d 6174          dist_mat
+00005c00: 7269 783a 2074 6f72 6368 2e54 656e 736f  rix: torch.Tenso
+00005c10: 720a 2020 2020 2020 2020 2020 2020 4469  r.            Di
+00005c20: 7374 616e 6365 206d 6174 7269 7820 6f66  stance matrix of
+00005c30: 2074 6865 2069 6e70 7574 206d 6f6c 6563   the input molec
+00005c40: 756c 652c 2072 6574 7572 6e65 6420 6672  ule, returned fr
+00005c50: 6f6d 2064 632e 6665 6174 2e4d 4154 4665  om dc.feat.MATFe
+00005c60: 6174 7572 697a 6572 2829 0a20 2020 2020  aturizer().     
+00005c70: 2020 2064 726f 706f 7574 5f70 3a20 666c     dropout_p: fl
+00005c80: 6f61 740a 2020 2020 2020 2020 2020 2020  oat.            
+00005c90: 4472 6f70 6f75 7420 7072 6f62 6162 696c  Dropout probabil
+00005ca0: 6974 792e 0a20 2020 2020 2020 2065 7073  ity..        eps
+00005cb0: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
+00005cc0: 2020 2020 4570 7369 6c6f 6e20 7661 6c75      Epsilon valu
+00005cd0: 650a 2020 2020 2020 2020 696e 663a 2066  e.        inf: f
+00005ce0: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
+00005cf0: 2056 616c 7565 206f 6620 696e 6669 6e69   Value of infini
+00005d00: 7479 2074 6f20 6265 2075 7365 642e 0a20  ty to be used.. 
+00005d10: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00005d20: 2020 2069 6620 6d61 736b 2069 7320 6e6f     if mask is no
+00005d30: 7420 4e6f 6e65 2061 6e64 206c 656e 286d  t None and len(m
+00005d40: 6173 6b2e 7368 6170 6529 203c 3d20 323a  ask.shape) <= 2:
+00005d50: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
+00005d60: 6b20 3d20 6d61 736b 2e75 6e73 7175 6565  k = mask.unsquee
+00005d70: 7a65 2831 290a 0a20 2020 2020 2020 2062  ze(1)..        b
+00005d80: 6174 6368 5f73 697a 6520 3d20 7175 6572  atch_size = quer
+00005d90: 792e 7369 7a65 2830 290a 2020 2020 2020  y.size(0).      
+00005da0: 2020 7175 6572 792c 206b 6579 2c20 7661    query, key, va
+00005db0: 6c75 6520 3d20 5b0a 2020 2020 2020 2020  lue = [.        
+00005dc0: 2020 2020 6c61 7965 7228 7829 2e76 6965      layer(x).vie
+00005dd0: 7728 6261 7463 685f 7369 7a65 2c20 2d31  w(batch_size, -1
+00005de0: 2c20 7365 6c66 2e68 2c20 7365 6c66 2e64  , self.h, self.d
+00005df0: 5f6b 292e 7472 616e 7370 6f73 6528 312c  _k).transpose(1,
+00005e00: 2032 290a 2020 2020 2020 2020 2020 2020   2).            
+00005e10: 666f 7220 6c61 7965 722c 2078 2069 6e20  for layer, x in 
+00005e20: 7a69 7028 7365 6c66 2e6c 696e 6561 725f  zip(self.linear_
+00005e30: 6c61 7965 7273 2c20 2871 7565 7279 2c20  layers, (query, 
+00005e40: 6b65 792c 2076 616c 7565 2929 0a20 2020  key, value)).   
+00005e50: 2020 2020 205d 0a0a 2020 2020 2020 2020       ]..        
+00005e60: 782c 205f 203d 2073 656c 662e 5f73 696e  x, _ = self._sin
+00005e70: 676c 655f 6174 7465 6e74 696f 6e28 7175  gle_attention(qu
+00005e80: 6572 792c 206b 6579 2c20 7661 6c75 652c  ery, key, value,
+00005e90: 206d 6173 6b2c 2061 646a 5f6d 6174 7269   mask, adj_matri
+00005ea0: 782c 0a20 2020 2020 2020 2020 2020 2020  x,.             
+00005eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005ec0: 2020 2020 2020 2020 2064 6973 7461 6e63           distanc
+00005ed0: 655f 6d61 7472 6978 2c20 6472 6f70 6f75  e_matrix, dropou
+00005ee0: 745f 702c 2065 7073 2c20 696e 6629 0a20  t_p, eps, inf). 
+00005ef0: 2020 2020 2020 2078 203d 2078 2e74 7261         x = x.tra
+00005f00: 6e73 706f 7365 2831 2c20 3229 2e63 6f6e  nspose(1, 2).con
+00005f10: 7469 6775 6f75 7328 292e 7669 6577 2862  tiguous().view(b
+00005f20: 6174 6368 5f73 697a 652c 202d 312c 0a20  atch_size, -1,. 
+00005f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005f50: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00005f60: 656c 662e 6820 2a20 7365 6c66 2e64 5f6b  elf.h * self.d_k
+00005f70: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+00005f80: 6e20 7365 6c66 2e6f 7574 7075 745f 6c69  n self.output_li
+00005f90: 6e65 6172 2878 290a 0a0a 636c 6173 7320  near(x)...class 
+00005fa0: 4d41 5445 6e63 6f64 6572 4c61 7965 7228  MATEncoderLayer(
+00005fb0: 6e6e 2e4d 6f64 756c 6529 3a0a 2020 2020  nn.Module):.    
+00005fc0: 2222 2245 6e63 6f64 6572 206c 6179 6572  """Encoder layer
+00005fd0: 2066 6f72 2075 7365 2069 6e20 7468 6520   for use in the 
+00005fe0: 4d6f 6c65 6375 6c61 7220 4174 7465 6e74  Molecular Attent
+00005ff0: 696f 6e20 5472 616e 7366 6f72 6d65 7220  ion Transformer 
+00006000: 5b31 5d5f 2e0a 0a20 2020 2054 6865 204d  [1]_...    The M
+00006010: 4154 456e 636f 6465 7220 6c61 7965 7220  ATEncoder layer 
+00006020: 7072 696d 6172 696c 7920 636f 6e73 6973  primarily consis
+00006030: 7473 206f 6620 6120 7365 6c66 2d61 7474  ts of a self-att
+00006040: 656e 7469 6f6e 206c 6179 6572 2028 4d75  ention layer (Mu
+00006050: 6c74 6948 6561 6465 644d 4154 4174 7465  ltiHeadedMATAtte
+00006060: 6e74 696f 6e29 2061 6e64 2061 2066 6565  ntion) and a fee
+00006070: 642d 666f 7277 6172 6420 6c61 7965 7220  d-forward layer 
+00006080: 2850 6f73 6974 696f 6e77 6973 6546 6565  (PositionwiseFee
+00006090: 6446 6f72 7761 7264 292e 0a20 2020 2054  dForward)..    T
+000060a0: 6869 7320 6c61 7965 7220 6361 6e20 6265  his layer can be
+000060b0: 2073 7461 636b 6564 206d 756c 7469 706c   stacked multipl
+000060c0: 6520 7469 6d65 7320 746f 2066 6f72 6d20  e times to form 
+000060d0: 616e 2065 6e63 6f64 6572 2e0a 0a20 2020  an encoder...   
+000060e0: 2052 6566 6572 656e 6365 730a 2020 2020   References.    
+000060f0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 202e  ----------.    .
+00006100: 2e20 5b31 5d20 4c75 6b61 737a 204d 617a  . [1] Lukasz Maz
+00006110: 6961 726b 6120 6574 2061 6c2e 2022 4d6f  iarka et al. "Mo
+00006120: 6c65 6375 6c65 2041 7474 656e 7469 6f6e  lecule Attention
+00006130: 2054 7261 6e73 666f 726d 6572 2220 4772   Transformer" Gr
+00006140: 6170 6820 5265 7072 6573 656e 7461 7469  aph Representati
+00006150: 6f6e 204c 6561 726e 696e 6720 776f 726b  on Learning work
+00006160: 7368 6f70 2061 6e64 204d 6163 6869 6e65  shop and Machine
+00006170: 204c 6561 726e 696e 6720 616e 6420 7468   Learning and th
+00006180: 6520 5068 7973 6963 616c 2053 6369 656e  e Physical Scien
+00006190: 6365 7320 776f 726b 7368 6f70 2061 7420  ces workshop at 
+000061a0: 4e65 7572 4950 5320 3230 3139 2e20 3230  NeurIPS 2019. 20
+000061b0: 3230 2e20 6874 7470 733a 2f2f 6172 7869  20. https://arxi
+000061c0: 762e 6f72 672f 6162 732f 3230 3032 2e30  v.org/abs/2002.0
+000061d0: 3832 3634 0a0a 2020 2020 4578 616d 706c  8264..    Exampl
+000061e0: 6573 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a  es.    --------.
+000061f0: 2020 2020 3e3e 3e20 6672 6f6d 2072 646b      >>> from rdk
+00006200: 6974 2069 6d70 6f72 7420 4368 656d 0a20  it import Chem. 
+00006210: 2020 203e 3e3e 2069 6d70 6f72 7420 746f     >>> import to
+00006220: 7263 680a 2020 2020 3e3e 3e20 696d 706f  rch.    >>> impo
+00006230: 7274 2064 6565 7063 6865 6d0a 2020 2020  rt deepchem.    
+00006240: 3e3e 3e20 6672 6f6d 2064 6565 7063 6865  >>> from deepche
+00006250: 6d2e 6d6f 6465 6c73 2e74 6f72 6368 5f6d  m.models.torch_m
+00006260: 6f64 656c 732e 6c61 7965 7273 2069 6d70  odels.layers imp
+00006270: 6f72 7420 4d41 5445 6d62 6564 6469 6e67  ort MATEmbedding
+00006280: 2c20 4d41 5445 6e63 6f64 6572 4c61 7965  , MATEncoderLaye
+00006290: 720a 2020 2020 3e3e 3e20 696e 7075 745f  r.    >>> input_
+000062a0: 736d 696c 6520 3d20 2243 4322 0a20 2020  smile = "CC".   
+000062b0: 203e 3e3e 2066 6561 7420 3d20 6465 6570   >>> feat = deep
+000062c0: 6368 656d 2e66 6561 742e 4d41 5446 6561  chem.feat.MATFea
+000062d0: 7475 7269 7a65 7228 290a 2020 2020 3e3e  turizer().    >>
+000062e0: 3e20 6f75 7420 3d20 6665 6174 2e66 6561  > out = feat.fea
+000062f0: 7475 7269 7a65 2869 6e70 7574 5f73 6d69  turize(input_smi
+00006300: 6c65 290a 2020 2020 3e3e 3e20 6e6f 6465  le).    >>> node
+00006310: 203d 2074 6f72 6368 2e74 656e 736f 7228   = torch.tensor(
+00006320: 6f75 745b 305d 2e6e 6f64 655f 6665 6174  out[0].node_feat
+00006330: 7572 6573 292e 666c 6f61 7428 292e 756e  ures).float().un
+00006340: 7371 7565 657a 6528 3029 0a20 2020 203e  squeeze(0).    >
+00006350: 3e3e 2061 646a 203d 2074 6f72 6368 2e74  >> adj = torch.t
+00006360: 656e 736f 7228 6f75 745b 305d 2e61 646a  ensor(out[0].adj
+00006370: 6163 656e 6379 5f6d 6174 7269 7829 2e66  acency_matrix).f
+00006380: 6c6f 6174 2829 2e75 6e73 7175 6565 7a65  loat().unsqueeze
+00006390: 2830 290a 2020 2020 3e3e 3e20 6469 7374  (0).    >>> dist
+000063a0: 203d 2074 6f72 6368 2e74 656e 736f 7228   = torch.tensor(
+000063b0: 6f75 745b 305d 2e64 6973 7461 6e63 655f  out[0].distance_
+000063c0: 6d61 7472 6978 292e 666c 6f61 7428 292e  matrix).float().
+000063d0: 756e 7371 7565 657a 6528 3029 0a20 2020  unsqueeze(0).   
+000063e0: 203e 3e3e 206d 6173 6b20 3d20 746f 7263   >>> mask = torc
+000063f0: 682e 7375 6d28 746f 7263 682e 6162 7328  h.sum(torch.abs(
+00006400: 6e6f 6465 292c 2064 696d 3d2d 3129 2021  node), dim=-1) !
+00006410: 3d20 300a 2020 2020 3e3e 3e20 6c61 7965  = 0.    >>> laye
+00006420: 7220 3d20 4d41 5445 6e63 6f64 6572 4c61  r = MATEncoderLa
+00006430: 7965 7228 290a 2020 2020 3e3e 3e20 6f70  yer().    >>> op
+00006440: 203d 204d 4154 456d 6265 6464 696e 6728   = MATEmbedding(
+00006450: 2928 6e6f 6465 290a 2020 2020 3e3e 3e20  )(node).    >>> 
+00006460: 6f75 7470 7574 203d 206c 6179 6572 286f  output = layer(o
+00006470: 702c 206d 6173 6b2c 2061 646a 2c20 6469  p, mask, adj, di
+00006480: 7374 290a 2020 2020 2222 220a 0a20 2020  st).    """..   
+00006490: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+000064a0: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
+000064b0: 2020 2020 2064 6973 745f 6b65 726e 656c       dist_kernel
+000064c0: 3a20 7374 7220 3d20 2773 6f66 746d 6178  : str = 'softmax
+000064d0: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+000064e0: 2020 2020 6c61 6d62 6461 5f61 7474 656e      lambda_atten
+000064f0: 7469 6f6e 3a20 666c 6f61 7420 3d20 302e  tion: float = 0.
+00006500: 3333 2c0a 2020 2020 2020 2020 2020 2020  33,.            
+00006510: 2020 2020 206c 616d 6264 615f 6469 7374       lambda_dist
+00006520: 616e 6365 3a20 666c 6f61 7420 3d20 302e  ance: float = 0.
+00006530: 3333 2c0a 2020 2020 2020 2020 2020 2020  33,.            
+00006540: 2020 2020 2068 3a20 696e 7420 3d20 3136       h: int = 16
+00006550: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00006560: 2020 2073 615f 6873 697a 653a 2069 6e74     sa_hsize: int
+00006570: 203d 2031 3032 342c 0a20 2020 2020 2020   = 1024,.       
+00006580: 2020 2020 2020 2020 2020 7361 5f64 726f            sa_dro
+00006590: 706f 7574 5f70 3a20 666c 6f61 7420 3d20  pout_p: float = 
+000065a0: 302e 302c 0a20 2020 2020 2020 2020 2020  0.0,.           
+000065b0: 2020 2020 2020 6f75 7470 7574 5f62 6961        output_bia
+000065c0: 733a 2062 6f6f 6c20 3d20 5472 7565 2c0a  s: bool = True,.
+000065d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000065e0: 2064 5f69 6e70 7574 3a20 696e 7420 3d20   d_input: int = 
+000065f0: 3130 3234 2c0a 2020 2020 2020 2020 2020  1024,.          
+00006600: 2020 2020 2020 2064 5f68 6964 6465 6e3a         d_hidden:
+00006610: 2069 6e74 203d 2031 3032 342c 0a20 2020   int = 1024,.   
+00006620: 2020 2020 2020 2020 2020 2020 2020 645f                d_
+00006630: 6f75 7470 7574 3a20 696e 7420 3d20 3130  output: int = 10
+00006640: 3234 2c0a 2020 2020 2020 2020 2020 2020  24,.            
+00006650: 2020 2020 2061 6374 6976 6174 696f 6e3a       activation:
+00006660: 2073 7472 203d 2027 6c65 616b 7972 656c   str = 'leakyrel
+00006670: 7527 2c0a 2020 2020 2020 2020 2020 2020  u',.            
+00006680: 2020 2020 206e 5f6c 6179 6572 733a 2069       n_layers: i
+00006690: 6e74 203d 2031 2c0a 2020 2020 2020 2020  nt = 1,.        
+000066a0: 2020 2020 2020 2020 2066 665f 6472 6f70           ff_drop
+000066b0: 6f75 745f 703a 2066 6c6f 6174 203d 2030  out_p: float = 0
+000066c0: 2e30 2c0a 2020 2020 2020 2020 2020 2020  .0,.            
+000066d0: 2020 2020 2065 6e63 6f64 6572 5f68 7369       encoder_hsi
+000066e0: 7a65 3a20 696e 7420 3d20 3130 3234 2c0a  ze: int = 1024,.
+000066f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006700: 2065 6e63 6f64 6572 5f64 726f 706f 7574   encoder_dropout
+00006710: 5f70 3a20 666c 6f61 7420 3d20 302e 3029  _p: float = 0.0)
+00006720: 3a0a 2020 2020 2020 2020 2222 2249 6e69  :.        """Ini
+00006730: 7469 616c 697a 6520 6120 4d41 5445 6e63  tialize a MATEnc
+00006740: 6f64 6572 206c 6179 6572 2e0a 0a20 2020  oder layer...   
+00006750: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+00006760: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00006770: 2d2d 0a20 2020 2020 2020 2064 6973 745f  --.        dist_
+00006780: 6b65 726e 656c 3a20 7374 720a 2020 2020  kernel: str.    
+00006790: 2020 2020 2020 2020 4b65 726e 656c 2061          Kernel a
+000067a0: 6374 6976 6174 696f 6e20 746f 2062 6520  ctivation to be 
+000067b0: 7573 6564 2e20 4361 6e20 6265 2065 6974  used. Can be eit
+000067c0: 6865 7220 2773 6f66 746d 6178 2720 666f  her 'softmax' fo
+000067d0: 7220 736f 6674 6d61 7820 6f72 2027 6578  r softmax or 'ex
+000067e0: 7027 2066 6f72 2065 7870 6f6e 656e 7469  p' for exponenti
+000067f0: 616c 2c20 666f 7220 7468 6520 7365 6c66  al, for the self
+00006800: 2d61 7474 656e 7469 6f6e 206c 6179 6572  -attention layer
+00006810: 2e0a 2020 2020 2020 2020 6c61 6d62 6461  ..        lambda
+00006820: 5f61 7474 656e 7469 6f6e 3a20 666c 6f61  _attention: floa
+00006830: 740a 2020 2020 2020 2020 2020 2020 436f  t.            Co
+00006840: 6e73 7461 6e74 2074 6f20 6265 206d 756c  nstant to be mul
+00006850: 7469 706c 6965 6420 7769 7468 2074 6865  tiplied with the
+00006860: 2061 7474 656e 7469 6f6e 206d 6174 7269   attention matri
+00006870: 7820 696e 2074 6865 2073 656c 662d 6174  x in the self-at
+00006880: 7465 6e74 696f 6e20 6c61 7965 722e 0a20  tention layer.. 
+00006890: 2020 2020 2020 206c 616d 6264 615f 6469         lambda_di
+000068a0: 7374 616e 6365 3a20 666c 6f61 740a 2020  stance: float.  
+000068b0: 2020 2020 2020 2020 2020 436f 6e73 7461            Consta
+000068c0: 6e74 2074 6f20 6265 206d 756c 7469 706c  nt to be multipl
+000068d0: 6965 6420 7769 7468 2074 6865 2064 6973  ied with the dis
+000068e0: 7461 6e63 6520 6d61 7472 6978 2069 6e20  tance matrix in 
+000068f0: 7468 6520 7365 6c66 2d61 7474 656e 7469  the self-attenti
+00006900: 6f6e 206c 6179 6572 2e0a 2020 2020 2020  on layer..      
+00006910: 2020 683a 2069 6e74 0a20 2020 2020 2020    h: int.       
+00006920: 2020 2020 204e 756d 6265 7220 6f66 2061       Number of a
+00006930: 7474 656e 7469 6f6e 2068 6561 6473 2066  ttention heads f
+00006940: 6f72 2074 6865 2073 656c 662d 6174 7465  or the self-atte
+00006950: 6e74 696f 6e20 6c61 7965 722e 0a20 2020  ntion layer..   
+00006960: 2020 2020 2073 615f 6873 697a 653a 2069       sa_hsize: i
+00006970: 6e74 0a20 2020 2020 2020 2020 2020 2053  nt.            S
+00006980: 697a 6520 6f66 2064 656e 7365 206c 6179  ize of dense lay
+00006990: 6572 2069 6e20 7468 6520 7365 6c66 2d61  er in the self-a
+000069a0: 7474 656e 7469 6f6e 206c 6179 6572 2e0a  ttention layer..
+000069b0: 2020 2020 2020 2020 7361 5f64 726f 706f          sa_dropo
+000069c0: 7574 5f70 3a20 666c 6f61 740a 2020 2020  ut_p: float.    
+000069d0: 2020 2020 2020 2020 4472 6f70 6f75 7420          Dropout 
+000069e0: 7072 6f62 6162 696c 6974 7920 666f 7220  probability for 
+000069f0: 7468 6520 7365 6c66 2d61 7474 656e 7469  the self-attenti
+00006a00: 6f6e 206c 6179 6572 2e0a 2020 2020 2020  on layer..      
+00006a10: 2020 6f75 7470 7574 5f62 6961 733a 2062    output_bias: b
+00006a20: 6f6f 6c0a 2020 2020 2020 2020 2020 2020  ool.            
+00006a30: 4966 2054 7275 652c 2064 656e 7365 206c  If True, dense l
+00006a40: 6179 6572 7320 7769 6c6c 2075 7365 2062  ayers will use b
+00006a50: 6961 7320 7665 6374 6f72 7320 696e 2074  ias vectors in t
+00006a60: 6865 2073 656c 662d 6174 7465 6e74 696f  he self-attentio
+00006a70: 6e20 6c61 7965 722e 0a20 2020 2020 2020  n layer..       
+00006a80: 2064 5f69 6e70 7574 3a20 696e 740a 2020   d_input: int.  
+00006a90: 2020 2020 2020 2020 2020 5369 7a65 206f            Size o
+00006aa0: 6620 696e 7075 7420 6c61 7965 7220 696e  f input layer in
+00006ab0: 2074 6865 2066 6565 642d 666f 7277 6172   the feed-forwar
+00006ac0: 6420 6c61 7965 722e 0a20 2020 2020 2020  d layer..       
+00006ad0: 2064 5f68 6964 6465 6e3a 2069 6e74 0a20   d_hidden: int. 
+00006ae0: 2020 2020 2020 2020 2020 2053 697a 6520             Size 
+00006af0: 6f66 2068 6964 6465 6e20 6c61 7965 7220  of hidden layer 
+00006b00: 696e 2074 6865 2066 6565 642d 666f 7277  in the feed-forw
+00006b10: 6172 6420 6c61 7965 722e 0a20 2020 2020  ard layer..     
+00006b20: 2020 2064 5f6f 7574 7075 743a 2069 6e74     d_output: int
+00006b30: 0a20 2020 2020 2020 2020 2020 2053 697a  .            Siz
+00006b40: 6520 6f66 206f 7574 7075 7420 6c61 7965  e of output laye
+00006b50: 7220 696e 2074 6865 2066 6565 642d 666f  r in the feed-fo
+00006b60: 7277 6172 6420 6c61 7965 722e 0a20 2020  rward layer..   
+00006b70: 2020 2020 2061 6374 6976 6174 696f 6e3a       activation:
+00006b80: 2073 7472 0a20 2020 2020 2020 2020 2020   str.           
+00006b90: 2041 6374 6976 6174 696f 6e20 6675 6e63   Activation func
+00006ba0: 7469 6f6e 2074 6f20 6265 2075 7365 6420  tion to be used 
+00006bb0: 696e 2074 6865 2066 6565 642d 666f 7277  in the feed-forw
+00006bc0: 6172 6420 6c61 7965 722e 0a20 2020 2020  ard layer..     
+00006bd0: 2020 2020 2020 2043 616e 2063 686f 6f73         Can choos
+00006be0: 6520 6265 7477 6565 6e20 2772 656c 7527  e between 'relu'
+00006bf0: 2066 6f72 2052 654c 552c 2027 6c65 616b   for ReLU, 'leak
+00006c00: 7972 656c 7527 2066 6f72 204c 6561 6b79  yrelu' for Leaky
+00006c10: 5265 4c55 2c20 2770 7265 6c75 2720 666f  ReLU, 'prelu' fo
+00006c20: 7220 5052 654c 552c 0a20 2020 2020 2020  r PReLU,.       
+00006c30: 2020 2020 2027 7461 6e68 2720 666f 7220       'tanh' for 
+00006c40: 5461 6e48 2c20 2773 656c 7527 2066 6f72  TanH, 'selu' for
+00006c50: 2053 454c 552c 2027 656c 7527 2066 6f72   SELU, 'elu' for
+00006c60: 2045 4c55 2061 6e64 2027 6c69 6e65 6172   ELU and 'linear
+00006c70: 2720 666f 7220 6c69 6e65 6172 2061 6374  ' for linear act
+00006c80: 6976 6174 696f 6e2e 0a20 2020 2020 2020  ivation..       
+00006c90: 206e 5f6c 6179 6572 733a 2069 6e74 0a20   n_layers: int. 
+00006ca0: 2020 2020 2020 2020 2020 204e 756d 6265             Numbe
+00006cb0: 7220 6f66 206c 6179 6572 7320 696e 2074  r of layers in t
+00006cc0: 6865 2066 6565 642d 666f 7277 6172 6420  he feed-forward 
+00006cd0: 6c61 7965 722e 0a20 2020 2020 2020 2064  layer..        d
+00006ce0: 726f 706f 7574 5f70 3a20 666c 6f61 740a  ropout_p: float.
+00006cf0: 2020 2020 2020 2020 2020 2020 4472 6f70              Drop
+00006d00: 6f75 7420 7072 6f62 6162 696c 6974 7920  out probability 
+00006d10: 696e 2074 6865 2066 6565 6564 2d66 6f72  in the feeed-for
+00006d20: 7761 7264 206c 6179 6572 2e0a 2020 2020  ward layer..    
+00006d30: 2020 2020 656e 636f 6465 725f 6873 697a      encoder_hsiz
+00006d40: 653a 2069 6e74 0a20 2020 2020 2020 2020  e: int.         
+00006d50: 2020 2053 697a 6520 6f66 2044 656e 7365     Size of Dense
+00006d60: 206c 6179 6572 2066 6f72 2074 6865 2065   layer for the e
+00006d70: 6e63 6f64 6572 2069 7473 656c 662e 0a20  ncoder itself.. 
+00006d80: 2020 2020 2020 2065 6e63 6f64 6572 5f64         encoder_d
+00006d90: 726f 706f 7574 5f70 3a20 666c 6f61 740a  ropout_p: float.
+00006da0: 2020 2020 2020 2020 2020 2020 4472 6f70              Drop
+00006db0: 6f75 7420 7072 6f62 6162 696c 6974 7920  out probability 
+00006dc0: 666f 7220 636f 6e6e 6563 7469 6f6e 7320  for connections 
+00006dd0: 696e 2074 6865 2065 6e63 6f64 6572 206c  in the encoder l
+00006de0: 6179 6572 2e0a 2020 2020 2020 2020 2222  ayer..        ""
+00006df0: 220a 2020 2020 2020 2020 7375 7065 7228  ".        super(
+00006e00: 4d41 5445 6e63 6f64 6572 4c61 7965 722c  MATEncoderLayer,
+00006e10: 2073 656c 6629 2e5f 5f69 6e69 745f 5f28   self).__init__(
+00006e20: 290a 2020 2020 2020 2020 7365 6c66 2e73  ).        self.s
+00006e30: 656c 665f 6174 746e 203d 204d 756c 7469  elf_attn = Multi
+00006e40: 4865 6164 6564 4d41 5441 7474 656e 7469  HeadedMATAttenti
+00006e50: 6f6e 2864 6973 745f 6b65 726e 656c 2c20  on(dist_kernel, 
+00006e60: 6c61 6d62 6461 5f61 7474 656e 7469 6f6e  lambda_attention
+00006e70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00006e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006ea0: 2020 206c 616d 6264 615f 6469 7374 616e     lambda_distan
+00006eb0: 6365 2c20 682c 2073 615f 6873 697a 652c  ce, h, sa_hsize,
+00006ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006ef0: 2020 7361 5f64 726f 706f 7574 5f70 2c20    sa_dropout_p, 
+00006f00: 6f75 7470 7574 5f62 6961 7329 0a20 2020  output_bias).   
+00006f10: 2020 2020 2073 656c 662e 6665 6564 5f66       self.feed_f
+00006f20: 6f72 7761 7264 203d 2050 6f73 6974 696f  orward = Positio
+00006f30: 6e77 6973 6546 6565 6446 6f72 7761 7264  nwiseFeedForward
+00006f40: 2864 5f69 6e70 7574 2c20 645f 6869 6464  (d_input, d_hidd
+00006f50: 656e 2c20 645f 6f75 7470 7574 2c0a 2020  en, d_output,.  
+00006f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f90: 2020 6163 7469 7661 7469 6f6e 2c20 6e5f    activation, n_
+00006fa0: 6c61 7965 7273 2c0a 2020 2020 2020 2020  layers,.        
+00006fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006fd0: 2020 2020 2020 2020 2020 2020 6666 5f64              ff_d
+00006fe0: 726f 706f 7574 5f70 290a 2020 2020 2020  ropout_p).      
+00006ff0: 2020 6c61 7965 7220 3d20 5375 626c 6179    layer = Sublay
+00007000: 6572 436f 6e6e 6563 7469 6f6e 2873 697a  erConnection(siz
+00007010: 653d 656e 636f 6465 725f 6873 697a 652c  e=encoder_hsize,
+00007020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007040: 2020 2020 6472 6f70 6f75 745f 703d 656e      dropout_p=en
+00007050: 636f 6465 725f 6472 6f70 6f75 745f 7029  coder_dropout_p)
+00007060: 0a20 2020 2020 2020 2073 656c 662e 7375  .        self.su
+00007070: 626c 6179 6572 203d 206e 6e2e 4d6f 6475  blayer = nn.Modu
+00007080: 6c65 4c69 7374 285b 6c61 7965 7220 666f  leList([layer fo
+00007090: 7220 5f20 696e 2072 616e 6765 2832 295d  r _ in range(2)]
+000070a0: 290a 2020 2020 2020 2020 7365 6c66 2e73  ).        self.s
+000070b0: 697a 6520 3d20 656e 636f 6465 725f 6873  ize = encoder_hs
+000070c0: 697a 650a 0a20 2020 2064 6566 2066 6f72  ize..    def for
+000070d0: 7761 7264 2873 656c 662c 0a20 2020 2020  ward(self,.     
+000070e0: 2020 2020 2020 2020 2020 2078 3a20 746f             x: to
+000070f0: 7263 682e 5465 6e73 6f72 2c0a 2020 2020  rch.Tensor,.    
+00007100: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
+00007110: 3a20 746f 7263 682e 5465 6e73 6f72 2c0a  : torch.Tensor,.
+00007120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007130: 6164 6a5f 6d61 7472 6978 3a20 746f 7263  adj_matrix: torc
+00007140: 682e 5465 6e73 6f72 2c0a 2020 2020 2020  h.Tensor,.      
+00007150: 2020 2020 2020 2020 2020 6469 7374 616e            distan
+00007160: 6365 5f6d 6174 7269 783a 2074 6f72 6368  ce_matrix: torch
+00007170: 2e54 656e 736f 722c 0a20 2020 2020 2020  .Tensor,.       
+00007180: 2020 2020 2020 2020 2073 615f 6472 6f70           sa_drop
+00007190: 6f75 745f 703a 2066 6c6f 6174 203d 2030  out_p: float = 0
+000071a0: 2e30 2920 2d3e 2074 6f72 6368 2e54 656e  .0) -> torch.Ten
+000071b0: 736f 723a 0a20 2020 2020 2020 2022 2222  sor:.        """
+000071c0: 4f75 7470 7574 2063 6f6d 7075 7461 7469  Output computati
+000071d0: 6f6e 2066 6f72 2074 6865 204d 4154 456e  on for the MATEn
+000071e0: 636f 6465 7220 6c61 7965 722e 0a0a 2020  coder layer...  
+000071f0: 2020 2020 2020 496e 2074 6865 204d 4154        In the MAT
+00007200: 456e 636f 6465 724c 6179 6572 2069 6e74  EncoderLayer int
+00007210: 6961 6c69 7a61 7469 6f6e 2c20 7365 6c66  ialization, self
+00007220: 2e73 7562 6c61 7965 7220 6973 2064 6566  .sublayer is def
+00007230: 696e 6564 2061 7320 616e 206e 6e2e 4d6f  ined as an nn.Mo
+00007240: 6475 6c65 4c69 7374 206f 6620 3220 6c61  duleList of 2 la
+00007250: 7965 7273 2e20 5765 2077 696c 6c20 6265  yers. We will be
+00007260: 2070 6173 7369 6e67 206f 7572 2063 6f6d   passing our com
+00007270: 7075 7461 7469 6f6e 2074 6872 6f75 6768  putation through
+00007280: 2074 6865 7365 206c 6179 6572 7320 7365   these layers se
+00007290: 7175 656e 7469 616c 6c79 2e0a 2020 2020  quentially..    
+000072a0: 2020 2020 6e6e 2e4d 6f64 756c 654c 6973      nn.ModuleLis
+000072b0: 7420 6973 2073 7562 7363 7269 7074 6162  t is subscriptab
+000072c0: 6c65 2061 6e64 2074 6875 7320 7765 2063  le and thus we c
+000072d0: 616e 2061 6363 6573 7320 6974 2061 7320  an access it as 
+000072e0: 7365 6c66 2e73 7562 6c61 7965 725b 305d  self.sublayer[0]
+000072f0: 2c20 666f 7220 6578 616d 706c 652e 0a0a  , for example...
+00007300: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+00007310: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+00007320: 2d2d 2d2d 2d0a 2020 2020 2020 2020 783a  -----.        x:
+00007330: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
+00007340: 2020 2020 2020 2020 2020 496e 7075 7420            Input 
+00007350: 7465 6e73 6f72 2e0a 2020 2020 2020 2020  tensor..        
+00007360: 6d61 736b 3a20 746f 7263 682e 5465 6e73  mask: torch.Tens
+00007370: 6f72 0a20 2020 2020 2020 2020 2020 204d  or.            M
+00007380: 6173 6b73 206f 7574 2070 6164 6469 6e67  asks out padding
+00007390: 2076 616c 7565 7320 736f 2074 6861 7420   values so that 
+000073a0: 7468 6579 2061 7265 206e 6f74 2074 616b  they are not tak
+000073b0: 656e 2069 6e74 6f20 6163 636f 756e 7420  en into account 
+000073c0: 7768 656e 2063 6f6d 7075 7469 6e67 2074  when computing t
+000073d0: 6865 2061 7474 656e 7469 6f6e 2073 636f  he attention sco
+000073e0: 7265 2e0a 2020 2020 2020 2020 6164 6a5f  re..        adj_
+000073f0: 6d61 7472 6978 3a20 746f 7263 682e 5465  matrix: torch.Te
+00007400: 6e73 6f72 0a20 2020 2020 2020 2020 2020  nsor.           
+00007410: 2041 646a 6163 656e 6379 206d 6174 7269   Adjacency matri
+00007420: 7820 6f66 2061 206d 6f6c 6563 756c 652e  x of a molecule.
+00007430: 0a20 2020 2020 2020 2064 6973 7461 6e63  .        distanc
+00007440: 655f 6d61 7472 6978 3a20 746f 7263 682e  e_matrix: torch.
+00007450: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
+00007460: 2020 2044 6973 7461 6e63 6520 6d61 7472     Distance matr
+00007470: 6978 206f 6620 6120 6d6f 6c65 6375 6c65  ix of a molecule
+00007480: 2e0a 2020 2020 2020 2020 7361 5f64 726f  ..        sa_dro
+00007490: 706f 7574 5f70 3a20 666c 6f61 740a 2020  pout_p: float.  
+000074a0: 2020 2020 2020 2020 2020 4472 6f70 6f75            Dropou
+000074b0: 7420 7072 6f62 6162 696c 6974 7920 666f  t probability fo
+000074c0: 7220 7468 6520 7365 6c66 2d61 7474 656e  r the self-atten
+000074d0: 7469 6f6e 206c 6179 6572 2028 4d75 6c74  tion layer (Mult
+000074e0: 6948 6561 6465 644d 4154 4174 7465 6e74  iHeadedMATAttent
+000074f0: 696f 6e29 2e0a 2020 2020 2020 2020 2222  ion)..        ""
+00007500: 220a 2020 2020 2020 2020 7820 3d20 7365  ".        x = se
+00007510: 6c66 2e73 7562 6c61 7965 725b 305d 2878  lf.sublayer[0](x
+00007520: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00007530: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00007540: 656c 662e 7365 6c66 5f61 7474 6e28 782c  elf.self_attn(x,
+00007550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007570: 2020 2020 2020 2020 2020 2020 2078 2c0a               x,.
+00007580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000075a0: 2020 2020 2020 2020 2020 2020 782c 0a20              x,. 
+000075b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000075c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000075d0: 2020 2020 2020 2020 2020 206d 6173 6b3d             mask=
+000075e0: 6d61 736b 2c0a 2020 2020 2020 2020 2020  mask,.          
+000075f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007610: 2020 6472 6f70 6f75 745f 703d 7361 5f64    dropout_p=sa_d
+00007620: 726f 706f 7574 5f70 2c0a 2020 2020 2020  ropout_p,.      
+00007630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007650: 2020 2020 2020 6164 6a5f 6d61 7472 6978        adj_matrix
+00007660: 3d61 646a 5f6d 6174 7269 782c 0a20 2020  =adj_matrix,.   
+00007670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007690: 2020 2020 2020 2020 2064 6973 7461 6e63           distanc
+000076a0: 655f 6d61 7472 6978 3d64 6973 7461 6e63  e_matrix=distanc
+000076b0: 655f 6d61 7472 6978 2929 0a20 2020 2020  e_matrix)).     
+000076c0: 2020 2072 6574 7572 6e20 7365 6c66 2e73     return self.s
+000076d0: 7562 6c61 7965 725b 315d 2878 2c20 7365  ublayer[1](x, se
+000076e0: 6c66 2e66 6565 645f 666f 7277 6172 6428  lf.feed_forward(
+000076f0: 7829 290a 0a0a 636c 6173 7320 5375 626c  x))...class Subl
+00007700: 6179 6572 436f 6e6e 6563 7469 6f6e 286e  ayerConnection(n
+00007710: 6e2e 4d6f 6475 6c65 293a 0a20 2020 2022  n.Module):.    "
+00007720: 2222 5375 626c 6179 6572 436f 6e6e 6563  ""SublayerConnec
+00007730: 7469 6f6e 206c 6179 6572 2062 6173 6564  tion layer based
+00007740: 206f 6e20 7468 6520 7061 7065 7220 6041   on the paper `A
+00007750: 7474 656e 7469 6f6e 2049 7320 416c 6c20  ttention Is All 
+00007760: 596f 7520 4e65 6564 203c 6874 7470 733a  You Need <https:
+00007770: 2f2f 6172 7869 762e 6f72 672f 6162 732f  //arxiv.org/abs/
+00007780: 3137 3036 2e30 3337 3632 3e60 5f2e 0a0a  1706.03762>`_...
+00007790: 2020 2020 5468 6520 5375 626c 6179 6572      The Sublayer
+000077a0: 436f 6e6e 6563 7469 6f6e 206e 6f72 6d61  Connection norma
+000077b0: 6c69 7a65 7320 616e 6420 6164 6473 2064  lizes and adds d
+000077c0: 726f 706f 7574 2074 6f20 6f75 7470 7574  ropout to output
+000077d0: 2074 656e 736f 7220 6f66 2061 6e20 6172   tensor of an ar
+000077e0: 6269 7461 7279 206c 6179 6572 2e0a 2020  bitary layer..  
+000077f0: 2020 4974 2066 7572 7468 6572 2061 6464    It further add
+00007800: 7320 6120 7265 7369 6475 616c 206c 6179  s a residual lay
+00007810: 6572 2063 6f6e 6e65 6374 696f 6e20 6265  er connection be
+00007820: 7477 6565 6e20 7468 6520 696e 7075 7420  tween the input 
+00007830: 6f66 2074 6865 2061 7262 6974 6172 7920  of the arbitary 
+00007840: 6c61 7965 7220 616e 6420 7468 6520 6472  layer and the dr
+00007850: 6f70 6f75 742d 6164 6a75 7374 6564 206c  opout-adjusted l
+00007860: 6179 6572 206f 7574 7075 742e 0a0a 2020  ayer output...  
+00007870: 2020 4578 616d 706c 6573 0a20 2020 202d    Examples.    -
+00007880: 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20  -------.    >>> 
+00007890: 6672 6f6d 2064 6565 7063 6865 6d2e 6d6f  from deepchem.mo
+000078a0: 6465 6c73 2e74 6f72 6368 5f6d 6f64 656c  dels.torch_model
+000078b0: 732e 6c61 7965 7273 2069 6d70 6f72 7420  s.layers import 
+000078c0: 5375 626c 6179 6572 436f 6e6e 6563 7469  SublayerConnecti
+000078d0: 6f6e 0a20 2020 203e 3e3e 2073 6361 6c65  on.    >>> scale
+000078e0: 203d 2030 2e33 350a 2020 2020 3e3e 3e20   = 0.35.    >>> 
+000078f0: 6c61 7965 7220 3d20 5375 626c 6179 6572  layer = Sublayer
+00007900: 436f 6e6e 6563 7469 6f6e 2832 2c20 302e  Connection(2, 0.
+00007910: 290a 2020 2020 3e3e 3e20 696e 7075 745f  ).    >>> input_
+00007920: 6172 203d 2074 6f72 6368 2e74 656e 736f  ar = torch.tenso
+00007930: 7228 5b5b 312e 2c20 322e 5d2c 205b 352e  r([[1., 2.], [5.
+00007940: 2c20 362e 5d5d 290a 2020 2020 3e3e 3e20  , 6.]]).    >>> 
+00007950: 6f75 7470 7574 203d 206c 6179 6572 2869  output = layer(i
+00007960: 6e70 7574 5f61 722c 2069 6e70 7574 5f61  nput_ar, input_a
+00007970: 7229 0a20 2022 2222 0a0a 2020 2020 6465  r).  """..    de
+00007980: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00007990: 2073 697a 653a 2069 6e74 2c20 6472 6f70   size: int, drop
+000079a0: 6f75 745f 703a 2066 6c6f 6174 203d 2030  out_p: float = 0
+000079b0: 2e30 293a 0a20 2020 2020 2020 2022 2222  .0):.        """
+000079c0: 496e 6974 6961 6c69 7a65 2061 2053 7562  Initialize a Sub
+000079d0: 6c61 7965 7243 6f6e 6e65 6374 696f 6e20  layerConnection 
+000079e0: 4c61 7965 722e 0a0a 2020 2020 2020 2020  Layer...        
+000079f0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+00007a00: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+00007a10: 2020 2020 2020 7369 7a65 3a20 696e 740a        size: int.
+00007a20: 2020 2020 2020 2020 2020 2020 5369 7a65              Size
+00007a30: 206f 6620 6c61 7965 722e 0a20 2020 2020   of layer..     
+00007a40: 2020 2064 726f 706f 7574 5f70 3a20 666c     dropout_p: fl
+00007a50: 6f61 740a 2020 2020 2020 2020 2020 2020  oat.            
+00007a60: 4472 6f70 6f75 7420 7072 6f62 6162 696c  Dropout probabil
+00007a70: 6974 792e 0a20 2020 2020 2020 2022 2222  ity..        """
+00007a80: 0a20 2020 2020 2020 2073 7570 6572 2853  .        super(S
+00007a90: 7562 6c61 7965 7243 6f6e 6e65 6374 696f  ublayerConnectio
+00007aa0: 6e2c 2073 656c 6629 2e5f 5f69 6e69 745f  n, self).__init_
+00007ab0: 5f28 290a 2020 2020 2020 2020 7365 6c66  _().        self
+00007ac0: 2e6e 6f72 6d20 3d20 6e6e 2e4c 6179 6572  .norm = nn.Layer
+00007ad0: 4e6f 726d 2873 697a 6529 0a20 2020 2020  Norm(size).     
+00007ae0: 2020 2073 656c 662e 6472 6f70 6f75 745f     self.dropout_
+00007af0: 7020 3d20 6e6e 2e44 726f 706f 7574 2864  p = nn.Dropout(d
+00007b00: 726f 706f 7574 5f70 290a 0a20 2020 2064  ropout_p)..    d
+00007b10: 6566 2066 6f72 7761 7264 2873 656c 662c  ef forward(self,
+00007b20: 2078 3a20 746f 7263 682e 5465 6e73 6f72   x: torch.Tensor
+00007b30: 2c20 6f75 7470 7574 3a20 746f 7263 682e  , output: torch.
+00007b40: 5465 6e73 6f72 2920 2d3e 2074 6f72 6368  Tensor) -> torch
+00007b50: 2e54 656e 736f 723a 0a20 2020 2020 2020  .Tensor:.       
+00007b60: 2022 2222 4f75 7470 7574 2063 6f6d 7075   """Output compu
+00007b70: 7461 7469 6f6e 2066 6f72 2074 6865 2053  tation for the S
+00007b80: 7562 6c61 7965 7243 6f6e 6e65 6374 696f  ublayerConnectio
+00007b90: 6e20 6c61 7965 722e 0a0a 2020 2020 2020  n layer...      
+00007ba0: 2020 5461 6b65 7320 616e 2069 6e70 7574    Takes an input
+00007bb0: 2074 656e 736f 7220 782c 2074 6865 6e20   tensor x, then 
+00007bc0: 6164 6473 2074 6865 2064 726f 706f 7574  adds the dropout
+00007bd0: 2d61 646a 7573 7465 6420 7375 626c 6179  -adjusted sublay
+00007be0: 6572 206f 7574 7075 7420 666f 7220 6e6f  er output for no
+00007bf0: 726d 616c 697a 6564 2078 2074 6f20 6974  rmalized x to it
+00007c00: 2e0a 2020 2020 2020 2020 5468 6973 2069  ..        This i
+00007c10: 7320 646f 6e65 2074 6f20 6164 6420 6120  s done to add a 
+00007c20: 7265 7369 6475 616c 2063 6f6e 6e65 6374  residual connect
+00007c30: 696f 6e20 666f 6c6c 6f77 6564 2062 7920  ion followed by 
+00007c40: 4c61 7965 724e 6f72 6d2e 0a0a 2020 2020  LayerNorm...    
+00007c50: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+00007c60: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+00007c70: 2d0a 2020 2020 2020 2020 783a 2074 6f72  -.        x: tor
+00007c80: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
+00007c90: 2020 2020 2020 496e 7075 7420 7465 6e73        Input tens
+00007ca0: 6f72 2e0a 2020 2020 2020 2020 6f75 7470  or..        outp
+00007cb0: 7574 3a20 746f 7263 682e 5465 6e73 6f72  ut: torch.Tensor
+00007cc0: 0a20 2020 2020 2020 2020 2020 204c 6179  .            Lay
+00007cd0: 6572 2077 686f 7365 206e 6f72 6d61 6c69  er whose normali
+00007ce0: 7a65 6420 6f75 7470 7574 2077 696c 6c20  zed output will 
+00007cf0: 6265 2061 6464 6564 2074 6f20 782e 0a20  be added to x.. 
+00007d00: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00007d10: 2020 2069 6620 7820 6973 204e 6f6e 653a     if x is None:
+00007d20: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00007d30: 7572 6e20 7365 6c66 2e64 726f 706f 7574  urn self.dropout
+00007d40: 5f70 2873 656c 662e 6e6f 726d 286f 7574  _p(self.norm(out
+00007d50: 7075 7429 290a 2020 2020 2020 2020 7265  put)).        re
+00007d60: 7475 726e 2078 202b 2073 656c 662e 6472  turn x + self.dr
+00007d70: 6f70 6f75 745f 7028 7365 6c66 2e6e 6f72  opout_p(self.nor
+00007d80: 6d28 6f75 7470 7574 2929 0a0a 0a63 6c61  m(output))...cla
+00007d90: 7373 2050 6f73 6974 696f 6e77 6973 6546  ss PositionwiseF
+00007da0: 6565 6446 6f72 7761 7264 286e 6e2e 4d6f  eedForward(nn.Mo
+00007db0: 6475 6c65 293a 0a20 2020 2022 2222 506f  dule):.    """Po
+00007dc0: 7369 7469 6f6e 7769 7365 4665 6564 466f  sitionwiseFeedFo
+00007dd0: 7277 6172 6420 6973 2061 206c 6179 6572  rward is a layer
+00007de0: 2075 7365 6420 746f 2064 6566 696e 6520   used to define 
+00007df0: 7468 6520 706f 7369 7469 6f6e 2d77 6973  the position-wis
+00007e00: 6520 6665 6564 2d66 6f72 7761 7264 2028  e feed-forward (
+00007e10: 4646 4e29 2061 6c67 6f72 6974 686d 2066  FFN) algorithm f
+00007e20: 6f72 2074 6865 204d 6f6c 6563 756c 6172  or the Molecular
+00007e30: 2041 7474 656e 7469 6f6e 2054 7261 6e73   Attention Trans
+00007e40: 666f 726d 6572 205b 315d 5f0a 0a20 2020  former [1]_..   
+00007e50: 2045 6163 6820 6c61 7965 7220 696e 2074   Each layer in t
+00007e60: 6865 204d 4154 2065 6e63 6f64 6572 2063  he MAT encoder c
+00007e70: 6f6e 7461 696e 7320 6120 6675 6c6c 7920  ontains a fully 
+00007e80: 636f 6e6e 6563 7465 6420 6665 6564 2d66  connected feed-f
+00007e90: 6f72 7761 7264 206e 6574 776f 726b 2077  orward network w
+00007ea0: 6869 6368 2061 7070 6c69 6573 2074 776f  hich applies two
+00007eb0: 206c 696e 6561 7220 7472 616e 7366 6f72   linear transfor
+00007ec0: 6d61 7469 6f6e 7320 616e 6420 7468 6520  mations and the 
+00007ed0: 6769 7665 6e20 6163 7469 7661 7469 6f6e  given activation
+00007ee0: 2066 756e 6374 696f 6e2e 0a20 2020 2054   function..    T
+00007ef0: 6869 7320 6973 2064 6f6e 6520 696e 2061  his is done in a
+00007f00: 6464 6974 696f 6e20 746f 2074 6865 2053  ddition to the S
+00007f10: 7562 6c61 7965 7243 6f6e 6e65 6374 696f  ublayerConnectio
+00007f20: 6e20 6d6f 6475 6c65 2e0a 0a20 2020 204e  n module...    N
+00007f30: 6f74 653a 2054 6869 7320 6d6f 6469 6669  ote: This modifi
+00007f40: 6564 2076 6572 7369 6f6e 206f 6620 6050  ed version of `P
+00007f50: 6f73 6974 696f 6e77 6973 6546 6565 6446  ositionwiseFeedF
+00007f60: 6f72 7761 7264 6020 636c 6173 7320 636f  orward` class co
+00007f70: 6e74 6169 6e73 2060 6472 6f70 6f75 745f  ntains `dropout_
+00007f80: 6174 5f69 6e70 7574 5f6e 6f5f 6163 7460  at_input_no_act`
+00007f90: 2063 6f6e 6469 7469 6f6e 2074 6f20 6661   condition to fa
+00007fa0: 6369 6c69 7461 7465 2069 7473 2075 7365  cilitate its use
+00007fb0: 2069 6e20 6465 6669 6e69 6e67 0a20 2020   in defining.   
+00007fc0: 2020 2020 2074 6865 2066 6565 642d 666f       the feed-fo
+00007fd0: 7277 6172 6420 2846 464e 2920 616c 676f  rward (FFN) algo
+00007fe0: 7269 7468 6d20 666f 7220 7468 6520 4469  rithm for the Di
+00007ff0: 7265 6374 6564 204d 6573 7361 6765 2050  rected Message P
+00008000: 6173 7369 6e67 204e 6575 7261 6c20 4e65  assing Neural Ne
+00008010: 7477 6f72 6b20 2844 2d4d 504e 4e29 205b  twork (D-MPNN) [
+00008020: 325d 5f0a 0a20 2020 2052 6566 6572 656e  2]_..    Referen
+00008030: 6365 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ces.    --------
+00008040: 2d2d 0a20 2020 202e 2e20 5b31 5d20 4c75  --.    .. [1] Lu
+00008050: 6b61 737a 204d 617a 6961 726b 6120 6574  kasz Maziarka et
+00008060: 2061 6c2e 2022 4d6f 6c65 6375 6c65 2041   al. "Molecule A
+00008070: 7474 656e 7469 6f6e 2054 7261 6e73 666f  ttention Transfo
+00008080: 726d 6572 2220 4772 6170 6820 5265 7072  rmer" Graph Repr
+00008090: 6573 656e 7461 7469 6f6e 204c 6561 726e  esentation Learn
+000080a0: 696e 6720 776f 726b 7368 6f70 2061 6e64  ing workshop and
+000080b0: 204d 6163 6869 6e65 204c 6561 726e 696e   Machine Learnin
+000080c0: 6720 616e 6420 7468 6520 5068 7973 6963  g and the Physic
+000080d0: 616c 2053 6369 656e 6365 7320 776f 726b  al Sciences work
+000080e0: 7368 6f70 2061 7420 4e65 7572 4950 5320  shop at NeurIPS 
+000080f0: 3230 3139 2e20 3230 3230 2e20 6874 7470  2019. 2020. http
+00008100: 733a 2f2f 6172 7869 762e 6f72 672f 6162  s://arxiv.org/ab
+00008110: 732f 3230 3032 2e30 3832 3634 0a20 2020  s/2002.08264.   
+00008120: 202e 2e20 5b32 5d20 416e 616c 797a 696e   .. [2] Analyzin
+00008130: 6720 4c65 6172 6e65 6420 4d6f 6c65 6375  g Learned Molecu
+00008140: 6c61 7220 5265 7072 6573 656e 7461 7469  lar Representati
+00008150: 6f6e 7320 666f 7220 5072 6f70 6572 7479  ons for Property
+00008160: 2050 7265 6469 6374 696f 6e20 6874 7470   Prediction http
+00008170: 733a 2f2f 6172 7869 762e 6f72 672f 7064  s://arxiv.org/pd
+00008180: 662f 3139 3034 2e30 3135 3631 2e70 6466  f/1904.01561.pdf
+00008190: 0a0a 2020 2020 4578 616d 706c 6573 0a20  ..    Examples. 
+000081a0: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+000081b0: 3e3e 3e20 6672 6f6d 2064 6565 7063 6865  >>> from deepche
+000081c0: 6d2e 6d6f 6465 6c73 2e74 6f72 6368 5f6d  m.models.torch_m
+000081d0: 6f64 656c 732e 6c61 7965 7273 2069 6d70  odels.layers imp
+000081e0: 6f72 7420 506f 7369 7469 6f6e 7769 7365  ort Positionwise
+000081f0: 4665 6564 466f 7277 6172 640a 2020 2020  FeedForward.    
+00008200: 3e3e 3e20 6665 6564 5f66 7764 5f6c 6179  >>> feed_fwd_lay
+00008210: 6572 203d 2050 6f73 6974 696f 6e77 6973  er = Positionwis
+00008220: 6546 6565 6446 6f72 7761 7264 2864 5f69  eFeedForward(d_i
+00008230: 6e70 7574 203d 2032 2c20 645f 6869 6464  nput = 2, d_hidd
+00008240: 656e 203d 2032 2c20 645f 6f75 7470 7574  en = 2, d_output
+00008250: 203d 2032 2c20 6163 7469 7661 7469 6f6e   = 2, activation
+00008260: 203d 2027 7265 6c75 272c 206e 5f6c 6179   = 'relu', n_lay
+00008270: 6572 7320 3d20 312c 2064 726f 706f 7574  ers = 1, dropout
+00008280: 5f70 203d 2030 2e31 290a 2020 2020 3e3e  _p = 0.1).    >>
+00008290: 3e20 696e 7075 745f 7465 6e73 6f72 203d  > input_tensor =
+000082a0: 2074 6f72 6368 2e74 656e 736f 7228 5b5b   torch.tensor([[
+000082b0: 312e 2c20 322e 5d2c 205b 352e 2c20 362e  1., 2.], [5., 6.
+000082c0: 5d5d 290a 2020 2020 3e3e 3e20 6f75 7470  ]]).    >>> outp
+000082d0: 7574 5f74 656e 736f 7220 3d20 6665 6564  ut_tensor = feed
+000082e0: 5f66 7764 5f6c 6179 6572 2869 6e70 7574  _fwd_layer(input
+000082f0: 5f74 656e 736f 7229 0a20 2022 2222 0a0a  _tensor).  """..
+00008300: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+00008310: 2873 656c 662c 0a20 2020 2020 2020 2020  (self,.         
+00008320: 2020 2020 2020 2020 645f 696e 7075 743a          d_input:
+00008330: 2069 6e74 203d 2031 3032 342c 0a20 2020   int = 1024,.   
+00008340: 2020 2020 2020 2020 2020 2020 2020 645f                d_
+00008350: 6869 6464 656e 3a20 696e 7420 3d20 3130  hidden: int = 10
+00008360: 3234 2c0a 2020 2020 2020 2020 2020 2020  24,.            
+00008370: 2020 2020 2064 5f6f 7574 7075 743a 2069       d_output: i
+00008380: 6e74 203d 2031 3032 342c 0a20 2020 2020  nt = 1024,.     
+00008390: 2020 2020 2020 2020 2020 2020 6163 7469              acti
+000083a0: 7661 7469 6f6e 3a20 7374 7220 3d20 276c  vation: str = 'l
+000083b0: 6561 6b79 7265 6c75 272c 0a20 2020 2020  eakyrelu',.     
+000083c0: 2020 2020 2020 2020 2020 2020 6e5f 6c61              n_la
+000083d0: 7965 7273 3a20 696e 7420 3d20 312c 0a20  yers: int = 1,. 
+000083e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000083f0: 6472 6f70 6f75 745f 703a 2066 6c6f 6174  dropout_p: float
+00008400: 203d 2030 2e30 2c0a 2020 2020 2020 2020   = 0.0,.        
+00008410: 2020 2020 2020 2020 2064 726f 706f 7574           dropout
+00008420: 5f61 745f 696e 7075 745f 6e6f 5f61 6374  _at_input_no_act
+00008430: 3a20 626f 6f6c 203d 2046 616c 7365 293a  : bool = False):
+00008440: 0a20 2020 2020 2020 2022 2222 496e 6974  .        """Init
+00008450: 6961 6c69 7a65 2061 2050 6f73 6974 696f  ialize a Positio
+00008460: 6e77 6973 6546 6565 6446 6f72 7761 7264  nwiseFeedForward
+00008470: 206c 6179 6572 2e0a 0a20 2020 2020 2020   layer...       
+00008480: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00008490: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+000084a0: 2020 2020 2020 2064 5f69 6e70 7574 3a20         d_input: 
+000084b0: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
+000084c0: 5369 7a65 206f 6620 696e 7075 7420 6c61  Size of input la
+000084d0: 7965 722e 0a20 2020 2020 2020 2064 5f68  yer..        d_h
+000084e0: 6964 6465 6e3a 2069 6e74 2028 7361 6d65  idden: int (same
+000084f0: 2061 7320 645f 696e 7075 7420 6966 2064   as d_input if d
+00008500: 5f6f 7574 7075 7420 3d20 3029 0a20 2020  _output = 0).   
+00008510: 2020 2020 2020 2020 2053 697a 6520 6f66           Size of
+00008520: 2068 6964 6465 6e20 6c61 7965 722e 0a20   hidden layer.. 
+00008530: 2020 2020 2020 2064 5f6f 7574 7075 743a         d_output:
+00008540: 2069 6e74 2028 7361 6d65 2061 7320 645f   int (same as d_
+00008550: 696e 7075 7420 6966 2064 5f6f 7574 7075  input if d_outpu
+00008560: 7420 3d20 3029 0a20 2020 2020 2020 2020  t = 0).         
+00008570: 2020 2053 697a 6520 6f66 206f 7574 7075     Size of outpu
+00008580: 7420 6c61 7965 722e 0a20 2020 2020 2020  t layer..       
+00008590: 2061 6374 6976 6174 696f 6e3a 2073 7472   activation: str
+000085a0: 0a20 2020 2020 2020 2020 2020 2041 6374  .            Act
+000085b0: 6976 6174 696f 6e20 6675 6e63 7469 6f6e  ivation function
+000085c0: 2074 6f20 6265 2075 7365 642e 2043 616e   to be used. Can
+000085d0: 2063 686f 6f73 6520 6265 7477 6565 6e20   choose between 
+000085e0: 2772 656c 7527 2066 6f72 2052 654c 552c  'relu' for ReLU,
+000085f0: 2027 6c65 616b 7972 656c 7527 2066 6f72   'leakyrelu' for
+00008600: 204c 6561 6b79 5265 4c55 2c20 2770 7265   LeakyReLU, 'pre
+00008610: 6c75 2720 666f 7220 5052 654c 552c 0a20  lu' for PReLU,. 
+00008620: 2020 2020 2020 2020 2020 2027 7461 6e68             'tanh
+00008630: 2720 666f 7220 5461 6e48 2c20 2773 656c  ' for TanH, 'sel
+00008640: 7527 2066 6f72 2053 454c 552c 2027 656c  u' for SELU, 'el
+00008650: 7527 2066 6f72 2045 4c55 2061 6e64 2027  u' for ELU and '
+00008660: 6c69 6e65 6172 2720 666f 7220 6c69 6e65  linear' for line
+00008670: 6172 2061 6374 6976 6174 696f 6e2e 0a20  ar activation.. 
+00008680: 2020 2020 2020 206e 5f6c 6179 6572 733a         n_layers:
+00008690: 2069 6e74 0a20 2020 2020 2020 2020 2020   int.           
+000086a0: 204e 756d 6265 7220 6f66 206c 6179 6572   Number of layer
+000086b0: 732e 0a20 2020 2020 2020 2064 726f 706f  s..        dropo
+000086c0: 7574 5f70 3a20 666c 6f61 740a 2020 2020  ut_p: float.    
+000086d0: 2020 2020 2020 2020 4472 6f70 6f75 7420          Dropout 
+000086e0: 7072 6f62 6162 696c 6974 792e 0a20 2020  probability..   
+000086f0: 2020 2020 2064 726f 706f 7574 5f61 745f       dropout_at_
+00008700: 696e 7075 745f 6e6f 5f61 6374 3a20 626f  input_no_act: bo
+00008710: 6f6c 0a20 2020 2020 2020 2020 2020 2049  ol.            I
+00008720: 6620 7472 7565 2c20 6472 6f70 6f75 7420  f true, dropout 
+00008730: 6973 2061 7070 6c69 6564 206f 6e20 7468  is applied on th
+00008740: 6520 696e 7075 7420 7465 6e73 6f72 2e20  e input tensor. 
+00008750: 466f 7220 7369 6e67 6c65 206c 6179 6572  For single layer
+00008760: 2c20 6974 2069 7320 6e6f 7420 7061 7373  , it is not pass
+00008770: 6564 2074 6f20 616e 2061 6374 6976 6174  ed to an activat
+00008780: 696f 6e20 6675 6e63 7469 6f6e 2e0a 2020  ion function..  
+00008790: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000087a0: 2020 7375 7065 7228 506f 7369 7469 6f6e    super(Position
+000087b0: 7769 7365 4665 6564 466f 7277 6172 642c  wiseFeedForward,
+000087c0: 2073 656c 6629 2e5f 5f69 6e69 745f 5f28   self).__init__(
+000087d0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000087e0: 6472 6f70 6f75 745f 6174 5f69 6e70 7574  dropout_at_input
+000087f0: 5f6e 6f5f 6163 743a 2062 6f6f 6c20 3d20  _no_act: bool = 
+00008800: 6472 6f70 6f75 745f 6174 5f69 6e70 7574  dropout_at_input
+00008810: 5f6e 6f5f 6163 740a 0a20 2020 2020 2020  _no_act..       
+00008820: 2069 6620 6163 7469 7661 7469 6f6e 203d   if activation =
+00008830: 3d20 2772 656c 7527 3a0a 2020 2020 2020  = 'relu':.      
+00008840: 2020 2020 2020 7365 6c66 2e61 6374 6976        self.activ
+00008850: 6174 696f 6e3a 2041 6e79 203d 206e 6e2e  ation: Any = nn.
+00008860: 5265 4c55 2829 0a0a 2020 2020 2020 2020  ReLU()..        
+00008870: 656c 6966 2061 6374 6976 6174 696f 6e20  elif activation 
+00008880: 3d3d 2027 6c65 616b 7972 656c 7527 3a0a  == 'leakyrelu':.
+00008890: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000088a0: 2e61 6374 6976 6174 696f 6e20 3d20 6e6e  .activation = nn
+000088b0: 2e4c 6561 6b79 5265 4c55 2830 2e31 290a  .LeakyReLU(0.1).
+000088c0: 0a20 2020 2020 2020 2065 6c69 6620 6163  .        elif ac
+000088d0: 7469 7661 7469 6f6e 203d 3d20 2770 7265  tivation == 'pre
+000088e0: 6c75 273a 0a20 2020 2020 2020 2020 2020  lu':.           
+000088f0: 2073 656c 662e 6163 7469 7661 7469 6f6e   self.activation
+00008900: 203d 206e 6e2e 5052 654c 5528 290a 0a20   = nn.PReLU().. 
+00008910: 2020 2020 2020 2065 6c69 6620 6163 7469         elif acti
+00008920: 7661 7469 6f6e 203d 3d20 2774 616e 6827  vation == 'tanh'
+00008930: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00008940: 6c66 2e61 6374 6976 6174 696f 6e20 3d20  lf.activation = 
+00008950: 6e6e 2e54 616e 6828 290a 0a20 2020 2020  nn.Tanh()..     
+00008960: 2020 2065 6c69 6620 6163 7469 7661 7469     elif activati
+00008970: 6f6e 203d 3d20 2773 656c 7527 3a0a 2020  on == 'selu':.  
+00008980: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00008990: 6374 6976 6174 696f 6e20 3d20 6e6e 2e53  ctivation = nn.S
+000089a0: 454c 5528 290a 0a20 2020 2020 2020 2065  ELU()..        e
+000089b0: 6c69 6620 6163 7469 7661 7469 6f6e 203d  lif activation =
+000089c0: 3d20 2765 6c75 273a 0a20 2020 2020 2020  = 'elu':.       
+000089d0: 2020 2020 2073 656c 662e 6163 7469 7661       self.activa
+000089e0: 7469 6f6e 203d 206e 6e2e 454c 5528 290a  tion = nn.ELU().
+000089f0: 0a20 2020 2020 2020 2065 6c69 6620 6163  .        elif ac
+00008a00: 7469 7661 7469 6f6e 203d 3d20 226c 696e  tivation == "lin
+00008a10: 6561 7222 3a0a 2020 2020 2020 2020 2020  ear":.          
+00008a20: 2020 7365 6c66 2e61 6374 6976 6174 696f    self.activatio
+00008a30: 6e20 3d20 6c61 6d62 6461 2078 3a20 780a  n = lambda x: x.
+00008a40: 0a20 2020 2020 2020 2073 656c 662e 6e5f  .        self.n_
+00008a50: 6c61 7965 7273 3a20 696e 7420 3d20 6e5f  layers: int = n_
+00008a60: 6c61 7965 7273 0a20 2020 2020 2020 2064  layers.        d
+00008a70: 5f6f 7574 7075 7420 3d20 645f 6f75 7470  _output = d_outp
+00008a80: 7574 2069 6620 645f 6f75 7470 7574 2021  ut if d_output !
+00008a90: 3d20 3020 656c 7365 2064 5f69 6e70 7574  = 0 else d_input
+00008aa0: 0a20 2020 2020 2020 2064 5f68 6964 6465  .        d_hidde
+00008ab0: 6e20 3d20 645f 6869 6464 656e 2069 6620  n = d_hidden if 
+00008ac0: 645f 6869 6464 656e 2021 3d20 3020 656c  d_hidden != 0 el
+00008ad0: 7365 2064 5f69 6e70 7574 0a0a 2020 2020  se d_input..    
+00008ae0: 2020 2020 6966 206e 5f6c 6179 6572 7320      if n_layers 
+00008af0: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
+00008b00: 2020 7365 6c66 2e6c 696e 6561 7273 3a20    self.linears: 
+00008b10: 416e 7920 3d20 5b6e 6e2e 4c69 6e65 6172  Any = [nn.Linear
+00008b20: 2864 5f69 6e70 7574 2c20 645f 6f75 7470  (d_input, d_outp
+00008b30: 7574 295d 0a0a 2020 2020 2020 2020 656c  ut)]..        el
+00008b40: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00008b50: 7365 6c66 2e6c 696e 6561 7273 203d 205b  self.linears = [
+00008b60: 6e6e 2e4c 696e 6561 7228 645f 696e 7075  nn.Linear(d_inpu
+00008b70: 742c 2064 5f68 6964 6465 6e29 5d20 2b20  t, d_hidden)] + 
+00008b80: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00008b90: 2020 2020 2020 2020 2020 2020 2020 5b6e                [n
+00008ba0: 6e2e 4c69 6e65 6172 2864 5f68 6964 6465  n.Linear(d_hidde
+00008bb0: 6e2c 2064 5f68 6964 6465 6e29 2066 6f72  n, d_hidden) for
+00008bc0: 205f 2069 6e20 7261 6e67 6528 6e5f 6c61   _ in range(n_la
+00008bd0: 7965 7273 202d 2032 295d 202b 205c 0a20  yers - 2)] + \. 
+00008be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008bf0: 2020 2020 2020 2020 2020 205b 6e6e 2e4c             [nn.L
+00008c00: 696e 6561 7228 645f 6869 6464 656e 2c20  inear(d_hidden, 
+00008c10: 645f 6f75 7470 7574 295d 0a0a 2020 2020  d_output)]..    
+00008c20: 2020 2020 7365 6c66 2e6c 696e 6561 7273      self.linears
+00008c30: 203d 206e 6e2e 4d6f 6475 6c65 4c69 7374   = nn.ModuleList
+00008c40: 2873 656c 662e 6c69 6e65 6172 7329 0a20  (self.linears). 
+00008c50: 2020 2020 2020 2064 726f 706f 7574 5f6c         dropout_l
+00008c60: 6179 6572 203d 206e 6e2e 4472 6f70 6f75  ayer = nn.Dropou
+00008c70: 7428 6472 6f70 6f75 745f 7029 0a20 2020  t(dropout_p).   
+00008c80: 2020 2020 2073 656c 662e 6472 6f70 6f75       self.dropou
+00008c90: 745f 7020 3d20 6e6e 2e4d 6f64 756c 654c  t_p = nn.ModuleL
+00008ca0: 6973 7428 5b64 726f 706f 7574 5f6c 6179  ist([dropout_lay
+00008cb0: 6572 2066 6f72 205f 2069 6e20 7261 6e67  er for _ in rang
+00008cc0: 6528 6e5f 6c61 7965 7273 295d 290a 0a20  e(n_layers)]).. 
+00008cd0: 2020 2064 6566 2066 6f72 7761 7264 2873     def forward(s
+00008ce0: 656c 662c 2078 3a20 746f 7263 682e 5465  elf, x: torch.Te
+00008cf0: 6e73 6f72 2920 2d3e 2074 6f72 6368 2e54  nsor) -> torch.T
+00008d00: 656e 736f 723a 0a20 2020 2020 2020 2022  ensor:.        "
+00008d10: 2222 4f75 7470 7574 2043 6f6d 7075 7461  ""Output Computa
+00008d20: 7469 6f6e 2066 6f72 2074 6865 2050 6f73  tion for the Pos
+00008d30: 6974 696f 6e77 6973 6546 6565 6446 6f72  itionwiseFeedFor
+00008d40: 7761 7264 206c 6179 6572 2e0a 0a20 2020  ward layer...   
+00008d50: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+00008d60: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00008d70: 2d2d 0a20 2020 2020 2020 2078 3a20 746f  --.        x: to
+00008d80: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
+00008d90: 2020 2020 2020 2049 6e70 7574 2074 656e         Input ten
+00008da0: 736f 722e 0a20 2020 2020 2020 2022 2222  sor..        """
+00008db0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00008dc0: 7365 6c66 2e6e 5f6c 6179 6572 733a 0a20  self.n_layers:. 
+00008dd0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00008de0: 6e20 780a 0a20 2020 2020 2020 2069 6620  n x..        if 
+00008df0: 7365 6c66 2e6e 5f6c 6179 6572 7320 3d3d  self.n_layers ==
+00008e00: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+00008e10: 6966 2073 656c 662e 6472 6f70 6f75 745f  if self.dropout_
+00008e20: 6174 5f69 6e70 7574 5f6e 6f5f 6163 743a  at_input_no_act:
+00008e30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008e40: 2072 6574 7572 6e20 7365 6c66 2e6c 696e   return self.lin
+00008e50: 6561 7273 5b30 5d28 7365 6c66 2e64 726f  ears[0](self.dro
+00008e60: 706f 7574 5f70 5b30 5d28 7829 290a 2020  pout_p[0](x)).  
+00008e70: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00008e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008e90: 7265 7475 726e 2073 656c 662e 6472 6f70  return self.drop
+00008ea0: 6f75 745f 705b 305d 2873 656c 662e 6163  out_p[0](self.ac
+00008eb0: 7469 7661 7469 6f6e 2873 656c 662e 6c69  tivation(self.li
+00008ec0: 6e65 6172 735b 305d 2878 2929 290a 0a20  nears[0](x))).. 
+00008ed0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00008ee0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00008ef0: 2e64 726f 706f 7574 5f61 745f 696e 7075  .dropout_at_inpu
+00008f00: 745f 6e6f 5f61 6374 3a0a 2020 2020 2020  t_no_act:.      
+00008f10: 2020 2020 2020 2020 2020 7820 3d20 7365            x = se
+00008f20: 6c66 2e64 726f 706f 7574 5f70 5b30 5d28  lf.dropout_p[0](
+00008f30: 7829 0a20 2020 2020 2020 2020 2020 2066  x).            f
+00008f40: 6f72 2069 2069 6e20 7261 6e67 6528 7365  or i in range(se
+00008f50: 6c66 2e6e 5f6c 6179 6572 7320 2d20 3129  lf.n_layers - 1)
+00008f60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00008f70: 2020 7820 3d20 7365 6c66 2e64 726f 706f    x = self.dropo
+00008f80: 7574 5f70 5b69 5d28 7365 6c66 2e61 6374  ut_p[i](self.act
+00008f90: 6976 6174 696f 6e28 7365 6c66 2e6c 696e  ivation(self.lin
+00008fa0: 6561 7273 5b69 5d28 7829 2929 0a20 2020  ears[i](x))).   
+00008fb0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00008fc0: 7365 6c66 2e6c 696e 6561 7273 5b2d 315d  self.linears[-1]
+00008fd0: 2878 290a 0a0a 636c 6173 7320 4d41 5445  (x)...class MATE
+00008fe0: 6d62 6564 6469 6e67 286e 6e2e 4d6f 6475  mbedding(nn.Modu
+00008ff0: 6c65 293a 0a20 2020 2022 2222 456d 6265  le):.    """Embe
+00009000: 6464 696e 6720 6c61 7965 7220 746f 2063  dding layer to c
+00009010: 7265 6174 6520 656d 6265 6464 696e 6720  reate embedding 
+00009020: 666f 7220 696e 7075 7473 2e0a 0a20 2020  for inputs...   
+00009030: 2049 6e20 616e 2065 6d62 6564 6469 6e67   In an embedding
+00009040: 206c 6179 6572 2c20 696e 7075 7420 6973   layer, input is
+00009050: 2074 616b 656e 2061 6e64 2063 6f6e 7665   taken and conve
+00009060: 7274 6564 2074 6f20 6120 7665 6374 6f72  rted to a vector
+00009070: 2072 6570 7265 7365 6e74 6174 696f 6e20   representation 
+00009080: 666f 7220 6561 6368 2069 6e70 7574 2e0a  for each input..
+00009090: 2020 2020 496e 2074 6865 204d 4154 456d      In the MATEm
+000090a0: 6265 6464 696e 6720 6c61 7965 722c 2061  bedding layer, a
+000090b0: 6e20 696e 7075 7420 7465 6e73 6f72 2069  n input tensor i
+000090c0: 7320 7072 6f63 6573 7365 6420 7468 726f  s processed thro
+000090d0: 7567 6820 6120 6472 6f70 6f75 742d 6164  ugh a dropout-ad
+000090e0: 6a75 7374 6564 206c 696e 6561 7220 6c61  justed linear la
+000090f0: 7965 7220 616e 6420 7468 6520 7265 7375  yer and the resu
+00009100: 6c74 616e 7420 7665 6374 6f72 2069 7320  ltant vector is 
+00009110: 7265 7475 726e 6564 2e0a 0a20 2020 2052  returned...    R
+00009120: 6566 6572 656e 6365 730a 2020 2020 2d2d  eferences.    --
+00009130: 2d2d 2d2d 2d2d 2d2d 0a20 2020 202e 2e20  --------.    .. 
+00009140: 5b31 5d20 4c75 6b61 737a 204d 617a 6961  [1] Lukasz Mazia
+00009150: 726b 6120 6574 2061 6c2e 2022 4d6f 6c65  rka et al. "Mole
+00009160: 6375 6c65 2041 7474 656e 7469 6f6e 2054  cule Attention T
+00009170: 7261 6e73 666f 726d 6572 2220 4772 6170  ransformer" Grap
+00009180: 6820 5265 7072 6573 656e 7461 7469 6f6e  h Representation
+00009190: 204c 6561 726e 696e 6720 776f 726b 7368   Learning worksh
+000091a0: 6f70 2061 6e64 204d 6163 6869 6e65 204c  op and Machine L
+000091b0: 6561 726e 696e 6720 616e 6420 7468 6520  earning and the 
+000091c0: 5068 7973 6963 616c 2053 6369 656e 6365  Physical Science
+000091d0: 7320 776f 726b 7368 6f70 2061 7420 4e65  s workshop at Ne
+000091e0: 7572 4950 5320 3230 3139 2e20 3230 3230  urIPS 2019. 2020
+000091f0: 2e20 6874 7470 733a 2f2f 6172 7869 762e  . https://arxiv.
+00009200: 6f72 672f 6162 732f 3230 3032 2e30 3832  org/abs/2002.082
+00009210: 3634 0a0a 2020 2020 4578 616d 706c 6573  64..    Examples
+00009220: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 2020  .    --------.  
+00009230: 2020 3e3e 3e20 6672 6f6d 2064 6565 7063    >>> from deepc
+00009240: 6865 6d2e 6d6f 6465 6c73 2e74 6f72 6368  hem.models.torch
+00009250: 5f6d 6f64 656c 732e 6c61 7965 7273 2069  _models.layers i
+00009260: 6d70 6f72 7420 4d41 5445 6d62 6564 6469  mport MATEmbeddi
+00009270: 6e67 0a20 2020 203e 3e3e 206c 6179 6572  ng.    >>> layer
+00009280: 203d 204d 4154 456d 6265 6464 696e 6728   = MATEmbedding(
+00009290: 645f 696e 7075 7420 3d20 332c 2064 5f6f  d_input = 3, d_o
+000092a0: 7574 7075 7420 3d20 332c 2064 726f 706f  utput = 3, dropo
+000092b0: 7574 5f70 203d 2030 2e32 290a 2020 2020  ut_p = 0.2).    
+000092c0: 3e3e 3e20 696e 7075 745f 7465 6e73 6f72  >>> input_tensor
+000092d0: 203d 2074 6f72 6368 2e74 656e 736f 7228   = torch.tensor(
+000092e0: 5b31 2e2c 2032 2e2c 2033 2e5d 290a 2020  [1., 2., 3.]).  
+000092f0: 2020 3e3e 3e20 6f75 7470 7574 203d 206c    >>> output = l
+00009300: 6179 6572 2869 6e70 7574 5f74 656e 736f  ayer(input_tenso
+00009310: 7229 0a20 2020 2022 2222 0a0a 2020 2020  r).    """..    
+00009320: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+00009330: 662c 0a20 2020 2020 2020 2020 2020 2020  f,.             
+00009340: 2020 2020 645f 696e 7075 743a 2069 6e74      d_input: int
+00009350: 203d 2033 362c 0a20 2020 2020 2020 2020   = 36,.         
+00009360: 2020 2020 2020 2020 645f 6f75 7470 7574          d_output
+00009370: 3a20 696e 7420 3d20 3130 3234 2c0a 2020  : int = 1024,.  
+00009380: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00009390: 726f 706f 7574 5f70 3a20 666c 6f61 7420  ropout_p: float 
+000093a0: 3d20 302e 3029 3a0a 2020 2020 2020 2020  = 0.0):.        
+000093b0: 2222 2249 6e69 7469 616c 697a 6520 6120  """Initialize a 
+000093c0: 4d41 5445 6d62 6564 6469 6e67 206c 6179  MATEmbedding lay
+000093d0: 6572 2e0a 0a20 2020 2020 2020 2050 6172  er...        Par
+000093e0: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
+000093f0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
+00009400: 2020 2064 5f69 6e70 7574 3a20 696e 740a     d_input: int.
+00009410: 2020 2020 2020 2020 2020 2020 5369 7a65              Size
+00009420: 206f 6620 696e 7075 7420 6c61 7965 722e   of input layer.
+00009430: 0a20 2020 2020 2020 2064 5f6f 7574 7075  .        d_outpu
+00009440: 743a 2069 6e74 0a20 2020 2020 2020 2020  t: int.         
+00009450: 2020 2053 697a 6520 6f66 206f 7574 7075     Size of outpu
+00009460: 7420 6c61 7965 722e 0a20 2020 2020 2020  t layer..       
+00009470: 2064 726f 706f 7574 5f70 3a20 666c 6f61   dropout_p: floa
+00009480: 740a 2020 2020 2020 2020 2020 2020 4472  t.            Dr
+00009490: 6f70 6f75 7420 7072 6f62 6162 696c 6974  opout probabilit
+000094a0: 7920 666f 7220 6c61 7965 722e 0a20 2020  y for layer..   
+000094b0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000094c0: 2073 7570 6572 284d 4154 456d 6265 6464   super(MATEmbedd
+000094d0: 696e 672c 2073 656c 6629 2e5f 5f69 6e69  ing, self).__ini
+000094e0: 745f 5f28 290a 2020 2020 2020 2020 7365  t__().        se
+000094f0: 6c66 2e6c 696e 6561 725f 756e 6974 203d  lf.linear_unit =
+00009500: 206e 6e2e 4c69 6e65 6172 2864 5f69 6e70   nn.Linear(d_inp
+00009510: 7574 2c20 645f 6f75 7470 7574 290a 2020  ut, d_output).  
+00009520: 2020 2020 2020 7365 6c66 2e64 726f 706f        self.dropo
+00009530: 7574 203d 206e 6e2e 4472 6f70 6f75 7428  ut = nn.Dropout(
+00009540: 6472 6f70 6f75 745f 7029 0a0a 2020 2020  dropout_p)..    
+00009550: 6465 6620 666f 7277 6172 6428 7365 6c66  def forward(self
+00009560: 2c20 783a 2074 6f72 6368 2e54 656e 736f  , x: torch.Tenso
+00009570: 7229 202d 3e20 746f 7263 682e 5465 6e73  r) -> torch.Tens
+00009580: 6f72 3a0a 2020 2020 2020 2020 2222 2243  or:.        """C
+00009590: 6f6d 7075 7461 7469 6f6e 2066 6f72 2074  omputation for t
+000095a0: 6865 204d 4154 456d 6265 6464 696e 6720  he MATEmbedding 
+000095b0: 6c61 7965 722e 0a0a 2020 2020 2020 2020  layer...        
+000095c0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+000095d0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+000095e0: 2020 2020 2020 783a 2074 6f72 6368 2e54        x: torch.T
+000095f0: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
+00009600: 2020 496e 7075 7420 7465 6e73 6f72 2074    Input tensor t
+00009610: 6f20 6265 2063 6f6e 7665 7274 6564 2069  o be converted i
+00009620: 6e74 6f20 6120 7665 6374 6f72 2e0a 2020  nto a vector..  
+00009630: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00009640: 2020 7265 7475 726e 2073 656c 662e 6472    return self.dr
+00009650: 6f70 6f75 7428 7365 6c66 2e6c 696e 6561  opout(self.linea
+00009660: 725f 756e 6974 2878 2929 0a0a 0a63 6c61  r_unit(x))...cla
+00009670: 7373 204d 4154 4765 6e65 7261 746f 7228  ss MATGenerator(
+00009680: 6e6e 2e4d 6f64 756c 6529 3a0a 2020 2020  nn.Module):.    
+00009690: 2222 224d 4154 4765 6e65 7261 746f 7220  """MATGenerator 
+000096a0: 6465 6669 6e65 7320 7468 6520 6c69 6e65  defines the line
+000096b0: 6172 2061 6e64 2073 6f66 746d 6178 2067  ar and softmax g
+000096c0: 656e 6572 6174 6f72 2073 7465 7020 666f  enerator step fo
+000096d0: 7220 7468 6520 4d6f 6c65 6375 6c61 7220  r the Molecular 
+000096e0: 4174 7465 6e74 696f 6e20 5472 616e 7366  Attention Transf
+000096f0: 6f72 6d65 7220 5b31 5d5f 2e0a 0a20 2020  ormer [1]_...   
+00009700: 2049 6e20 7468 6520 4d41 5447 656e 6572   In the MATGener
+00009710: 6174 6f72 2c20 6120 4765 6e65 7261 746f  ator, a Generato
+00009720: 7220 6973 2064 6566 696e 6564 2077 6869  r is defined whi
+00009730: 6368 2070 6572 666f 726d 7320 7468 6520  ch performs the 
+00009740: 4c69 6e65 6172 202b 2053 6f66 746d 6178  Linear + Softmax
+00009750: 2067 656e 6572 6174 696f 6e20 7374 6570   generation step
+00009760: 2e0a 2020 2020 4465 7065 6e64 696e 6720  ..    Depending 
+00009770: 6f6e 2074 6865 2074 7970 6520 6f66 2061  on the type of a
+00009780: 6767 7265 6761 7469 6f6e 2073 656c 6563  ggregation selec
+00009790: 7465 642c 2074 6865 2061 7474 656e 7469  ted, the attenti
+000097a0: 6f6e 206f 7574 7075 7420 6c61 7965 7220  on output layer 
+000097b0: 7065 7266 6f72 6d73 2064 6966 6665 7265  performs differe
+000097c0: 6e74 206f 7065 7261 7469 6f6e 732e 0a0a  nt operations...
+000097d0: 2020 2020 5265 6665 7265 6e63 6573 0a20      References. 
+000097e0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+000097f0: 2020 2e2e 205b 315d 204c 756b 6173 7a20    .. [1] Lukasz 
+00009800: 4d61 7a69 6172 6b61 2065 7420 616c 2e20  Maziarka et al. 
+00009810: 224d 6f6c 6563 756c 6520 4174 7465 6e74  "Molecule Attent
+00009820: 696f 6e20 5472 616e 7366 6f72 6d65 7222  ion Transformer"
+00009830: 2047 7261 7068 2052 6570 7265 7365 6e74   Graph Represent
+00009840: 6174 696f 6e20 4c65 6172 6e69 6e67 2077  ation Learning w
+00009850: 6f72 6b73 686f 7020 616e 6420 4d61 6368  orkshop and Mach
+00009860: 696e 6520 4c65 6172 6e69 6e67 2061 6e64  ine Learning and
+00009870: 2074 6865 2050 6879 7369 6361 6c20 5363   the Physical Sc
+00009880: 6965 6e63 6573 2077 6f72 6b73 686f 7020  iences workshop 
+00009890: 6174 204e 6575 7249 5053 2032 3031 392e  at NeurIPS 2019.
+000098a0: 2032 3032 302e 2068 7474 7073 3a2f 2f61   2020. https://a
+000098b0: 7278 6976 2e6f 7267 2f61 6273 2f32 3030  rxiv.org/abs/200
+000098c0: 322e 3038 3236 340a 0a20 2020 2045 7861  2.08264..    Exa
+000098d0: 6d70 6c65 730a 2020 2020 2d2d 2d2d 2d2d  mples.    ------
+000098e0: 2d2d 0a20 2020 203e 3e3e 2066 726f 6d20  --.    >>> from 
+000098f0: 6465 6570 6368 656d 2e6d 6f64 656c 732e  deepchem.models.
+00009900: 746f 7263 685f 6d6f 6465 6c73 2e6c 6179  torch_models.lay
+00009910: 6572 7320 696d 706f 7274 204d 4154 4765  ers import MATGe
+00009920: 6e65 7261 746f 720a 2020 2020 3e3e 3e20  nerator.    >>> 
+00009930: 6c61 7965 7220 3d20 4d41 5447 656e 6572  layer = MATGener
+00009940: 6174 6f72 2868 7369 7a65 203d 2033 2c20  ator(hsize = 3, 
+00009950: 6167 6772 6567 6174 696f 6e5f 7479 7065  aggregation_type
+00009960: 203d 2027 6d65 616e 272c 2064 5f6f 7574   = 'mean', d_out
+00009970: 7075 7420 3d20 312c 206e 5f6c 6179 6572  put = 1, n_layer
+00009980: 7320 3d20 312c 2064 726f 706f 7574 5f70  s = 1, dropout_p
+00009990: 203d 2030 2e33 2c20 6174 746e 5f68 6964   = 0.3, attn_hid
+000099a0: 6465 6e20 3d20 3132 382c 2061 7474 6e5f  den = 128, attn_
+000099b0: 6f75 7420 3d20 3429 0a20 2020 203e 3e3e  out = 4).    >>>
+000099c0: 2069 6e70 7574 5f74 656e 736f 7220 3d20   input_tensor = 
+000099d0: 746f 7263 682e 7465 6e73 6f72 285b 312e  torch.tensor([1.
+000099e0: 2c20 322e 2c20 332e 5d29 0a20 2020 203e  , 2., 3.]).    >
+000099f0: 3e3e 206d 6173 6b20 3d20 746f 7263 682e  >> mask = torch.
+00009a00: 7465 6e73 6f72 285b 312e 2c20 312e 2c20  tensor([1., 1., 
+00009a10: 312e 5d29 0a20 2020 203e 3e3e 206f 7574  1.]).    >>> out
+00009a20: 7075 7420 3d20 6c61 7965 7228 696e 7075  put = layer(inpu
+00009a30: 745f 7465 6e73 6f72 2c20 6d61 736b 290a  t_tensor, mask).
+00009a40: 2020 2020 2222 220a 0a20 2020 2064 6566      """..    def
+00009a50: 205f 5f69 6e69 745f 5f28 7365 6c66 2c0a   __init__(self,.
+00009a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009a70: 2068 7369 7a65 3a20 696e 7420 3d20 3130   hsize: int = 10
+00009a80: 3234 2c0a 2020 2020 2020 2020 2020 2020  24,.            
+00009a90: 2020 2020 2061 6767 7265 6761 7469 6f6e       aggregation
+00009aa0: 5f74 7970 653a 2073 7472 203d 2027 6d65  _type: str = 'me
+00009ab0: 616e 272c 0a20 2020 2020 2020 2020 2020  an',.           
+00009ac0: 2020 2020 2020 645f 6f75 7470 7574 3a20        d_output: 
+00009ad0: 696e 7420 3d20 312c 0a20 2020 2020 2020  int = 1,.       
+00009ae0: 2020 2020 2020 2020 2020 6e5f 6c61 7965            n_laye
+00009af0: 7273 3a20 696e 7420 3d20 312c 0a20 2020  rs: int = 1,.   
+00009b00: 2020 2020 2020 2020 2020 2020 2020 6472                dr
+00009b10: 6f70 6f75 745f 703a 2066 6c6f 6174 203d  opout_p: float =
+00009b20: 2030 2e30 2c0a 2020 2020 2020 2020 2020   0.0,.          
+00009b30: 2020 2020 2020 2061 7474 6e5f 6869 6464         attn_hidd
+00009b40: 656e 3a20 696e 7420 3d20 3132 382c 0a20  en: int = 128,. 
+00009b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009b60: 6174 746e 5f6f 7574 3a20 696e 7420 3d20  attn_out: int = 
+00009b70: 3429 3a0a 2020 2020 2020 2020 2222 2249  4):.        """I
+00009b80: 6e69 7469 616c 697a 6520 6120 4d41 5447  nitialize a MATG
+00009b90: 656e 6572 6174 6f72 2e0a 0a20 2020 2020  enerator...     
+00009ba0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00009bb0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00009bc0: 0a20 2020 2020 2020 2068 7369 7a65 3a20  .        hsize: 
+00009bd0: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
+00009be0: 5369 7a65 206f 6620 696e 7075 7420 6c61  Size of input la
+00009bf0: 7965 722e 0a20 2020 2020 2020 2061 6767  yer..        agg
+00009c00: 7265 6761 7469 6f6e 5f74 7970 653a 2073  regation_type: s
+00009c10: 7472 0a20 2020 2020 2020 2020 2020 2054  tr.            T
+00009c20: 7970 6520 6f66 2061 6767 7265 6761 7469  ype of aggregati
+00009c30: 6f6e 2074 6f20 6265 2075 7365 642e 2043  on to be used. C
+00009c40: 616e 2062 6520 2767 726f 7665 7227 2c20  an be 'grover', 
+00009c50: 276d 6561 6e27 206f 7220 2763 6f6e 7465  'mean' or 'conte
+00009c60: 7874 7561 6c27 2e0a 2020 2020 2020 2020  xtual'..        
+00009c70: 645f 6f75 7470 7574 3a20 696e 740a 2020  d_output: int.  
+00009c80: 2020 2020 2020 2020 2020 5369 7a65 206f            Size o
+00009c90: 6620 6f75 7470 7574 206c 6179 6572 2e0a  f output layer..
+00009ca0: 2020 2020 2020 2020 6e5f 6c61 7965 7273          n_layers
+00009cb0: 3a20 696e 740a 2020 2020 2020 2020 2020  : int.          
+00009cc0: 2020 4e75 6d62 6572 206f 6620 6c61 7965    Number of laye
+00009cd0: 7273 2069 6e20 4d41 5447 656e 6572 6174  rs in MATGenerat
+00009ce0: 6f72 2e0a 2020 2020 2020 2020 6472 6f70  or..        drop
+00009cf0: 6f75 745f 703a 2066 6c6f 6174 0a20 2020  out_p: float.   
+00009d00: 2020 2020 2020 2020 2044 726f 706f 7574           Dropout
+00009d10: 2070 726f 6261 6269 6c69 7479 2066 6f72   probability for
+00009d20: 206c 6179 6572 2e0a 2020 2020 2020 2020   layer..        
+00009d30: 6174 746e 5f68 6964 6465 6e3a 2069 6e74  attn_hidden: int
+00009d40: 0a20 2020 2020 2020 2020 2020 2053 697a  .            Siz
+00009d50: 6520 6f66 2068 6964 6465 6e20 6174 7465  e of hidden atte
+00009d60: 6e74 696f 6e20 6c61 7965 722e 0a20 2020  ntion layer..   
+00009d70: 2020 2020 2061 7474 6e5f 6f75 743a 2069       attn_out: i
+00009d80: 6e74 0a20 2020 2020 2020 2020 2020 2053  nt.            S
+00009d90: 697a 6520 6f66 206f 7574 7075 7420 6174  ize of output at
+00009da0: 7465 6e74 696f 6e20 6c61 7965 722e 0a20  tention layer.. 
+00009db0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00009dc0: 2020 2073 7570 6572 284d 4154 4765 6e65     super(MATGene
+00009dd0: 7261 746f 722c 2073 656c 6629 2e5f 5f69  rator, self).__i
+00009de0: 6e69 745f 5f28 290a 0a20 2020 2020 2020  nit__()..       
+00009df0: 2069 6620 6167 6772 6567 6174 696f 6e5f   if aggregation_
+00009e00: 7479 7065 203d 3d20 2767 726f 7665 7227  type == 'grover'
+00009e10: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00009e20: 6c66 2e61 7474 5f6e 6574 203d 206e 6e2e  lf.att_net = nn.
+00009e30: 5365 7175 656e 7469 616c 280a 2020 2020  Sequential(.    
+00009e40: 2020 2020 2020 2020 2020 2020 6e6e 2e4c              nn.L
+00009e50: 696e 6561 7228 6873 697a 652c 2061 7474  inear(hsize, att
+00009e60: 6e5f 6869 6464 656e 2c20 6269 6173 3d46  n_hidden, bias=F
+00009e70: 616c 7365 292c 0a20 2020 2020 2020 2020  alse),.         
+00009e80: 2020 2020 2020 206e 6e2e 5461 6e68 2829         nn.Tanh()
+00009e90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00009ea0: 2020 6e6e 2e4c 696e 6561 7228 6174 746e    nn.Linear(attn
+00009eb0: 5f68 6964 6465 6e2c 2061 7474 6e5f 6f75  _hidden, attn_ou
+00009ec0: 742c 2062 6961 733d 4661 6c73 6529 2c0a  t, bias=False),.
+00009ed0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00009ee0: 2020 2020 2020 2020 2020 6873 697a 6520            hsize 
+00009ef0: 2a3d 2061 7474 6e5f 6f75 740a 0a20 2020  *= attn_out..   
+00009f00: 2020 2020 2069 6620 6e5f 6c61 7965 7273       if n_layers
+00009f10: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
+00009f20: 2020 2073 656c 662e 7072 6f6a 3a20 416e     self.proj: An
+00009f30: 7920 3d20 6e6e 2e4c 696e 6561 7228 6873  y = nn.Linear(hs
+00009f40: 697a 652c 2064 5f6f 7574 7075 7429 0a0a  ize, d_output)..
+00009f50: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00009f60: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00009f70: 726f 6a20 3d20 5b5d 0a0a 2020 2020 2020  roj = []..      
+00009f80: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+00009f90: 616e 6765 286e 5f6c 6179 6572 7320 2d20  ange(n_layers - 
+00009fa0: 3129 3a0a 2020 2020 2020 2020 2020 2020  1):.            
+00009fb0: 2020 2020 7365 6c66 2e70 726f 6a2e 6170      self.proj.ap
+00009fc0: 7065 6e64 286e 6e2e 4c69 6e65 6172 2868  pend(nn.Linear(h
+00009fd0: 7369 7a65 2c20 6174 746e 5f68 6964 6465  size, attn_hidde
+00009fe0: 6e29 290a 2020 2020 2020 2020 2020 2020  n)).            
+00009ff0: 2020 2020 7365 6c66 2e70 726f 6a2e 6170      self.proj.ap
+0000a000: 7065 6e64 286e 6e2e 4c65 616b 7952 654c  pend(nn.LeakyReL
+0000a010: 5528 6e65 6761 7469 7665 5f73 6c6f 7065  U(negative_slope
+0000a020: 3d30 2e31 2929 0a20 2020 2020 2020 2020  =0.1)).         
+0000a030: 2020 2020 2020 2073 656c 662e 7072 6f6a         self.proj
+0000a040: 2e61 7070 656e 6428 6e6e 2e4c 6179 6572  .append(nn.Layer
+0000a050: 4e6f 726d 2861 7474 6e5f 6869 6464 656e  Norm(attn_hidden
+0000a060: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+0000a070: 2020 2073 656c 662e 7072 6f6a 2e61 7070     self.proj.app
+0000a080: 656e 6428 6e6e 2e44 726f 706f 7574 2864  end(nn.Dropout(d
+0000a090: 726f 706f 7574 5f70 2929 0a20 2020 2020  ropout_p)).     
+0000a0a0: 2020 2020 2020 2073 656c 662e 7072 6f6a         self.proj
+0000a0b0: 2e61 7070 656e 6428 6e6e 2e4c 696e 6561  .append(nn.Linea
+0000a0c0: 7228 6174 746e 5f68 6964 6465 6e2c 2064  r(attn_hidden, d
+0000a0d0: 5f6f 7574 7075 7429 290a 2020 2020 2020  _output)).      
+0000a0e0: 2020 2020 2020 7365 6c66 2e70 726f 6a20        self.proj 
+0000a0f0: 3d20 746f 7263 682e 6e6e 2e53 6571 7565  = torch.nn.Seque
+0000a100: 6e74 6961 6c28 2a73 656c 662e 7072 6f6a  ntial(*self.proj
+0000a110: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000a120: 6767 7265 6761 7469 6f6e 5f74 7970 6520  ggregation_type 
+0000a130: 3d20 6167 6772 6567 6174 696f 6e5f 7479  = aggregation_ty
+0000a140: 7065 0a0a 2020 2020 6465 6620 666f 7277  pe..    def forw
+0000a150: 6172 6428 7365 6c66 2c20 783a 2074 6f72  ard(self, x: tor
+0000a160: 6368 2e54 656e 736f 722c 206d 6173 6b3a  ch.Tensor, mask:
+0000a170: 2074 6f72 6368 2e54 656e 736f 7229 202d   torch.Tensor) -
+0000a180: 3e20 746f 7263 682e 5465 6e73 6f72 3a0a  > torch.Tensor:.
+0000a190: 2020 2020 2020 2020 2222 2243 6f6d 7075          """Compu
+0000a1a0: 7461 7469 6f6e 2066 6f72 2074 6865 204d  tation for the M
+0000a1b0: 4154 4765 6e65 7261 746f 7220 6c61 7965  ATGenerator laye
+0000a1c0: 722e 0a0a 2020 2020 2020 2020 5061 7261  r...        Para
+0000a1d0: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
+0000a1e0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+0000a1f0: 2020 783a 2074 6f72 6368 2e54 656e 736f    x: torch.Tenso
+0000a200: 720a 2020 2020 2020 2020 2020 2020 496e  r.            In
+0000a210: 7075 7420 7465 6e73 6f72 2e0a 2020 2020  put tensor..    
+0000a220: 2020 2020 6d61 736b 3a20 746f 7263 682e      mask: torch.
+0000a230: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
+0000a240: 2020 204d 6173 6b20 666f 7220 7061 6464     Mask for padd
+0000a250: 696e 6720 736f 2074 6861 7420 7061 6464  ing so that padd
+0000a260: 6564 2076 616c 7565 7320 646f 206e 6f74  ed values do not
+0000a270: 2067 6574 2069 6e63 6c75 6465 6420 696e   get included in
+0000a280: 2061 7474 656e 7469 6f6e 2073 636f 7265   attention score
+0000a290: 2063 616c 6375 6c61 7469 6f6e 2e0a 2020   calculation..  
+0000a2a0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+0000a2b0: 2020 206d 6173 6b20 3d20 6d61 736b 2e75     mask = mask.u
+0000a2c0: 6e73 7175 6565 7a65 282d 3129 2e66 6c6f  nsqueeze(-1).flo
+0000a2d0: 6174 2829 0a20 2020 2020 2020 206f 7574  at().        out
+0000a2e0: 5f6d 6173 6b65 6420 3d20 7820 2a20 6d61  _masked = x * ma
+0000a2f0: 736b 0a0a 2020 2020 2020 2020 6966 2073  sk..        if s
+0000a300: 656c 662e 6167 6772 6567 6174 696f 6e5f  elf.aggregation_
+0000a310: 7479 7065 203d 3d20 276d 6561 6e27 3a0a  type == 'mean':.
+0000a320: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
+0000a330: 7375 6d20 3d20 6f75 745f 6d61 736b 6564  sum = out_masked
+0000a340: 2e73 756d 2864 696d 3d31 290a 2020 2020  .sum(dim=1).    
+0000a350: 2020 2020 2020 2020 6d61 736b 5f73 756d          mask_sum
+0000a360: 203d 206d 6173 6b2e 7375 6d28 6469 6d3d   = mask.sum(dim=
+0000a370: 2831 2929 0a20 2020 2020 2020 2020 2020  (1)).           
+0000a380: 206f 7574 5f61 7667 5f70 6f6f 6c69 6e67   out_avg_pooling
+0000a390: 203d 206f 7574 5f73 756d 202f 206d 6173   = out_sum / mas
+0000a3a0: 6b5f 7375 6d0a 0a20 2020 2020 2020 2065  k_sum..        e
+0000a3b0: 6c69 6620 7365 6c66 2e61 6767 7265 6761  lif self.aggrega
+0000a3c0: 7469 6f6e 5f74 7970 6520 3d3d 2027 6772  tion_type == 'gr
+0000a3d0: 6f76 6572 273a 0a20 2020 2020 2020 2020  over':.         
+0000a3e0: 2020 206f 7574 5f61 7474 6e20 3d20 7365     out_attn = se
+0000a3f0: 6c66 2e61 7474 5f6e 6574 286f 7574 5f6d  lf.att_net(out_m
+0000a400: 6173 6b65 6429 0a20 2020 2020 2020 2020  asked).         
+0000a410: 2020 206f 7574 5f61 7474 6e20 3d20 6f75     out_attn = ou
+0000a420: 745f 6174 746e 2e6d 6173 6b65 645f 6669  t_attn.masked_fi
+0000a430: 6c6c 286d 6173 6b20 3d3d 2030 2c20 2d31  ll(mask == 0, -1
+0000a440: 6539 290a 2020 2020 2020 2020 2020 2020  e9).            
+0000a450: 6f75 745f 6174 746e 203d 2046 2e73 6f66  out_attn = F.sof
+0000a460: 746d 6178 286f 7574 5f61 7474 6e2c 2064  tmax(out_attn, d
+0000a470: 696d 3d31 290a 2020 2020 2020 2020 2020  im=1).          
+0000a480: 2020 6f75 745f 6176 675f 706f 6f6c 696e    out_avg_poolin
+0000a490: 6720 3d20 746f 7263 682e 6d61 746d 756c  g = torch.matmul
+0000a4a0: 2874 6f72 6368 2e74 7261 6e73 706f 7365  (torch.transpose
+0000a4b0: 286f 7574 5f61 7474 6e2c 202d 312c 202d  (out_attn, -1, -
+0000a4c0: 3229 2c0a 2020 2020 2020 2020 2020 2020  2),.            
+0000a4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a4e0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0000a4f0: 7574 5f6d 6173 6b65 6429 0a20 2020 2020  ut_masked).     
+0000a500: 2020 2020 2020 206f 7574 5f61 7667 5f70         out_avg_p
+0000a510: 6f6f 6c69 6e67 203d 206f 7574 5f61 7667  ooling = out_avg
+0000a520: 5f70 6f6f 6c69 6e67 2e76 6965 7728 6f75  _pooling.view(ou
+0000a530: 745f 6176 675f 706f 6f6c 696e 672e 7369  t_avg_pooling.si
+0000a540: 7a65 2830 292c 202d 3129 0a0a 2020 2020  ze(0), -1)..    
+0000a550: 2020 2020 656c 6966 2073 656c 662e 6167      elif self.ag
+0000a560: 6772 6567 6174 696f 6e5f 7479 7065 203d  gregation_type =
+0000a570: 3d20 2763 6f6e 7465 7874 7561 6c27 3a0a  = 'contextual':.
+0000a580: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
+0000a590: 6176 675f 706f 6f6c 696e 6720 3d20 780a  avg_pooling = x.
+0000a5a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000a5b0: 7365 6c66 2e70 726f 6a28 6f75 745f 6176  self.proj(out_av
+0000a5c0: 675f 706f 6f6c 696e 6729 0a0a 0a63 6c61  g_pooling)...cla
+0000a5d0: 7373 2047 7261 7068 4e65 7477 6f72 6b28  ss GraphNetwork(
+0000a5e0: 746f 7263 682e 6e6e 2e4d 6f64 756c 6529  torch.nn.Module)
+0000a5f0: 3a0a 2020 2020 2222 2247 7261 7068 204e  :.    """Graph N
+0000a600: 6574 776f 726b 730a 0a20 2020 2041 2047  etworks..    A G
+0000a610: 7261 7068 204e 6574 776f 726b 205b 315d  raph Network [1]
+0000a620: 5f20 7461 6b65 7320 6120 6772 6170 6820  _ takes a graph 
+0000a630: 6173 2069 6e70 7574 2061 6e64 2072 6574  as input and ret
+0000a640: 7572 6e73 2061 6e20 7570 6461 7465 6420  urns an updated 
+0000a650: 6772 6170 680a 2020 2020 6173 206f 7574  graph.    as out
+0000a660: 7075 742e 2054 6865 206f 7574 7075 7420  put. The output 
+0000a670: 6772 6170 6820 6861 7320 7361 6d65 2073  graph has same s
+0000a680: 7472 7563 7475 7265 2061 7320 696e 7075  tructure as inpu
+0000a690: 7420 6772 6170 6820 6275 7420 6974 0a20  t graph but it. 
+0000a6a0: 2020 2068 6173 2075 7064 6174 6564 206e     has updated n
+0000a6b0: 6f64 6520 6665 6174 7572 6573 2c20 6564  ode features, ed
+0000a6c0: 6765 2066 6561 7475 7265 7320 616e 6420  ge features and 
+0000a6d0: 676c 6f62 616c 2073 7461 7465 2066 6561  global state fea
+0000a6e0: 7475 7265 732e 0a0a 2020 2020 5061 7261  tures...    Para
+0000a6f0: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
+0000a700: 2d2d 2d2d 2d0a 2020 2020 6e5f 6e6f 6465  -----.    n_node
+0000a710: 5f66 6561 7475 7265 733a 2069 6e74 0a20  _features: int. 
+0000a720: 2020 2020 2020 204e 756d 6265 7220 6f66         Number of
+0000a730: 2066 6561 7475 7265 7320 696e 2061 206e   features in a n
+0000a740: 6f64 650a 2020 2020 6e5f 6564 6765 5f66  ode.    n_edge_f
+0000a750: 6561 7475 7265 733a 2069 6e74 0a20 2020  eatures: int.   
+0000a760: 2020 2020 204e 756d 6265 7220 6f66 2066       Number of f
+0000a770: 6561 7475 7265 7320 696e 2061 2065 6467  eatures in a edg
+0000a780: 650a 2020 2020 6e5f 676c 6f62 616c 5f66  e.    n_global_f
+0000a790: 6561 7475 7265 733a 2069 6e74 0a20 2020  eatures: int.   
+0000a7a0: 2020 2020 204e 756d 6265 7220 6f66 2067       Number of g
+0000a7b0: 6c6f 6261 6c20 6665 6174 7572 6573 0a20  lobal features. 
+0000a7c0: 2020 2069 735f 756e 6469 7265 6374 6564     is_undirected
+0000a7d0: 3a20 626f 6f6c 2c20 6f70 7469 6f6e 616c  : bool, optional
+0000a7e0: 2028 6465 6661 756c 7420 5472 7565 290a   (default True).
+0000a7f0: 2020 2020 2020 2020 4469 7265 6374 6564          Directed
+0000a800: 206f 7220 756e 6469 7265 6374 6564 2067   or undirected g
+0000a810: 7261 7068 0a20 2020 2072 6573 6964 7561  raph.    residua
+0000a820: 6c5f 636f 6e6e 6563 7469 6f6e 3a20 626f  l_connection: bo
+0000a830: 6f6c 2c20 6f70 7469 6f6e 616c 2028 6465  ol, optional (de
+0000a840: 6661 756c 7420 5472 7565 290a 2020 2020  fault True).    
+0000a850: 2020 2020 4966 2054 7275 652c 2074 6865      If True, the
+0000a860: 206c 6179 6572 2075 7365 7320 6120 7265   layer uses a re
+0000a870: 7369 6475 616c 2063 6f6e 6e65 6374 696f  sidual connectio
+0000a880: 6e20 6475 7269 6e67 2074 7261 696e 696e  n during trainin
+0000a890: 670a 0a20 2020 2045 7861 6d70 6c65 0a20  g..    Example. 
+0000a8a0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 203e     -------.    >
+0000a8b0: 3e3e 2069 6d70 6f72 7420 746f 7263 680a  >> import torch.
+0000a8c0: 2020 2020 3e3e 3e20 6672 6f6d 2064 6565      >>> from dee
+0000a8d0: 7063 6865 6d2e 6d6f 6465 6c73 2e74 6f72  pchem.models.tor
+0000a8e0: 6368 5f6d 6f64 656c 732e 6c61 7965 7273  ch_models.layers
+0000a8f0: 2069 6d70 6f72 7420 4772 6170 684e 6574   import GraphNet
+0000a900: 776f 726b 2061 7320 474e 0a20 2020 203e  work as GN.    >
+0000a910: 3e3e 206e 5f6e 6f64 6573 2c20 6e5f 6e6f  >> n_nodes, n_no
+0000a920: 6465 5f66 6561 7475 7265 7320 3d20 352c  de_features = 5,
+0000a930: 2031 300a 2020 2020 3e3e 3e20 6e5f 6564   10.    >>> n_ed
+0000a940: 6765 732c 206e 5f65 6467 655f 6665 6174  ges, n_edge_feat
+0000a950: 7572 6573 203d 2035 2c20 320a 2020 2020  ures = 5, 2.    
+0000a960: 3e3e 3e20 6e5f 676c 6f62 616c 5f66 6561  >>> n_global_fea
+0000a970: 7475 7265 7320 3d20 340a 2020 2020 3e3e  tures = 4.    >>
+0000a980: 3e20 6e6f 6465 5f66 6561 7475 7265 7320  > node_features 
+0000a990: 3d20 746f 7263 682e 7261 6e64 6e28 6e5f  = torch.randn(n_
+0000a9a0: 6e6f 6465 732c 206e 5f6e 6f64 655f 6665  nodes, n_node_fe
+0000a9b0: 6174 7572 6573 290a 2020 2020 3e3e 3e20  atures).    >>> 
+0000a9c0: 6564 6765 5f66 6561 7475 7265 7320 3d20  edge_features = 
+0000a9d0: 746f 7263 682e 7261 6e64 6e28 6e5f 6564  torch.randn(n_ed
+0000a9e0: 6765 732c 206e 5f65 6467 655f 6665 6174  ges, n_edge_feat
+0000a9f0: 7572 6573 290a 2020 2020 3e3e 3e20 6564  ures).    >>> ed
+0000aa00: 6765 5f69 6e64 6578 203d 2074 6f72 6368  ge_index = torch
+0000aa10: 2e74 656e 736f 7228 5b5b 302c 2031 2c20  .tensor([[0, 1, 
+0000aa20: 322c 2033 2c20 345d 2c20 5b31 2c20 322c  2, 3, 4], [1, 2,
+0000aa30: 2033 2c20 342c 2030 5d5d 292e 6c6f 6e67   3, 4, 0]]).long
+0000aa40: 2829 0a20 2020 203e 3e3e 2067 6c6f 6261  ().    >>> globa
+0000aa50: 6c5f 6665 6174 7572 6573 203d 2074 6f72  l_features = tor
+0000aa60: 6368 2e72 616e 646e 2831 2c20 6e5f 676c  ch.randn(1, n_gl
+0000aa70: 6f62 616c 5f66 6561 7475 7265 7329 0a20  obal_features). 
+0000aa80: 2020 203e 3e3e 2067 6e20 3d20 474e 286e     >>> gn = GN(n
+0000aa90: 5f6e 6f64 655f 6665 6174 7572 6573 3d6e  _node_features=n
+0000aaa0: 5f6e 6f64 655f 6665 6174 7572 6573 2c20  _node_features, 
+0000aab0: 6e5f 6564 6765 5f66 6561 7475 7265 733d  n_edge_features=
+0000aac0: 6e5f 6564 6765 5f66 6561 7475 7265 732c  n_edge_features,
+0000aad0: 206e 5f67 6c6f 6261 6c5f 6665 6174 7572   n_global_featur
+0000aae0: 6573 3d6e 5f67 6c6f 6261 6c5f 6665 6174  es=n_global_feat
+0000aaf0: 7572 6573 290a 2020 2020 3e3e 3e20 6e6f  ures).    >>> no
+0000ab00: 6465 5f66 6561 7475 7265 732c 2065 6467  de_features, edg
+0000ab10: 655f 6665 6174 7572 6573 2c20 676c 6f62  e_features, glob
+0000ab20: 616c 5f66 6561 7475 7265 7320 3d20 676e  al_features = gn
+0000ab30: 286e 6f64 655f 6665 6174 7572 6573 2c20  (node_features, 
+0000ab40: 6564 6765 5f69 6e64 6578 2c20 6564 6765  edge_index, edge
+0000ab50: 5f66 6561 7475 7265 732c 2067 6c6f 6261  _features, globa
+0000ab60: 6c5f 6665 6174 7572 6573 290a 0a20 2020  l_features)..   
+0000ab70: 2052 6566 6572 656e 6365 730a 2020 2020   References.    
+0000ab80: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 202e  ----------.    .
+0000ab90: 2e20 5b31 5d20 4261 7474 6167 6c69 6120  . [1] Battaglia 
+0000aba0: 6574 2061 6c2c 2052 656c 6174 696f 6e61  et al, Relationa
+0000abb0: 6c20 696e 6475 6374 6976 6520 6269 6173  l inductive bias
+0000abc0: 6573 2c20 6465 6570 206c 6561 726e 696e  es, deep learnin
+0000abd0: 672c 2061 6e64 2067 7261 7068 206e 6574  g, and graph net
+0000abe0: 776f 726b 732e 2068 7474 7073 3a2f 2f61  works. https://a
+0000abf0: 7278 6976 2e6f 7267 2f61 6273 2f31 3830  rxiv.org/abs/180
+0000ac00: 362e 3031 3236 3120 2832 3031 3829 0a20  6.01261 (2018). 
+0000ac10: 2022 2222 0a0a 2020 2020 6465 6620 5f5f   """..    def __
+0000ac20: 696e 6974 5f5f 2873 656c 662c 0a20 2020  init__(self,.   
+0000ac30: 2020 2020 2020 2020 2020 2020 2020 6e5f                n_
+0000ac40: 6e6f 6465 5f66 6561 7475 7265 733a 2069  node_features: i
+0000ac50: 6e74 203d 2033 322c 0a20 2020 2020 2020  nt = 32,.       
+0000ac60: 2020 2020 2020 2020 2020 6e5f 6564 6765            n_edge
+0000ac70: 5f66 6561 7475 7265 733a 2069 6e74 203d  _features: int =
+0000ac80: 2033 322c 0a20 2020 2020 2020 2020 2020   32,.           
+0000ac90: 2020 2020 2020 6e5f 676c 6f62 616c 5f66        n_global_f
+0000aca0: 6561 7475 7265 733a 2069 6e74 203d 2033  eatures: int = 3
+0000acb0: 322c 0a20 2020 2020 2020 2020 2020 2020  2,.             
+0000acc0: 2020 2020 6973 5f75 6e64 6972 6563 7465      is_undirecte
+0000acd0: 643a 2062 6f6f 6c20 3d20 5472 7565 2c0a  d: bool = True,.
+0000ace0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000acf0: 2072 6573 6964 7561 6c5f 636f 6e6e 6563   residual_connec
+0000ad00: 7469 6f6e 3a20 626f 6f6c 203d 2054 7275  tion: bool = Tru
+0000ad10: 6529 3a0a 2020 2020 2020 2020 7375 7065  e):.        supe
+0000ad20: 7228 292e 5f5f 696e 6974 5f5f 2829 0a20  r().__init__(). 
+0000ad30: 2020 2020 2020 2073 656c 662e 6e5f 6e6f         self.n_no
+0000ad40: 6465 5f66 6561 7475 7265 7320 3d20 6e5f  de_features = n_
+0000ad50: 6e6f 6465 5f66 6561 7475 7265 730a 2020  node_features.  
+0000ad60: 2020 2020 2020 7365 6c66 2e6e 5f65 6467        self.n_edg
+0000ad70: 655f 6665 6174 7572 6573 203d 206e 5f65  e_features = n_e
+0000ad80: 6467 655f 6665 6174 7572 6573 0a20 2020  dge_features.   
+0000ad90: 2020 2020 2073 656c 662e 6e5f 676c 6f62       self.n_glob
+0000ada0: 616c 5f66 6561 7475 7265 7320 3d20 6e5f  al_features = n_
+0000adb0: 676c 6f62 616c 5f66 6561 7475 7265 730a  global_features.
+0000adc0: 2020 2020 2020 2020 7365 6c66 2e69 735f          self.is_
+0000add0: 756e 6469 7265 6374 6564 203d 2069 735f  undirected = is_
+0000ade0: 756e 6469 7265 6374 6564 0a20 2020 2020  undirected.     
+0000adf0: 2020 2073 656c 662e 7265 7369 6475 616c     self.residual
+0000ae00: 5f63 6f6e 6e65 6374 696f 6e20 3d20 7265  _connection = re
+0000ae10: 7369 6475 616c 5f63 6f6e 6e65 6374 696f  sidual_connectio
+0000ae20: 6e0a 0a20 2020 2020 2020 2073 656c 662e  n..        self.
+0000ae30: 6564 6765 5f6d 6f64 656c 732c 2073 656c  edge_models, sel
+0000ae40: 662e 6e6f 6465 5f6d 6f64 656c 732c 2073  f.node_models, s
+0000ae50: 656c 662e 676c 6f62 616c 5f6d 6f64 656c  elf.global_model
+0000ae60: 7320 3d20 746f 7263 682e 6e6e 2e4d 6f64  s = torch.nn.Mod
+0000ae70: 756c 654c 6973 7428 0a20 2020 2020 2020  uleList(.       
+0000ae80: 2029 2c20 746f 7263 682e 6e6e 2e4d 6f64   ), torch.nn.Mod
+0000ae90: 756c 654c 6973 7428 292c 2074 6f72 6368  uleList(), torch
+0000aea0: 2e6e 6e2e 4d6f 6475 6c65 4c69 7374 2829  .nn.ModuleList()
+0000aeb0: 0a20 2020 2020 2020 2073 656c 662e 6564  .        self.ed
+0000aec0: 6765 5f6d 6f64 656c 732e 6170 7065 6e64  ge_models.append
+0000aed0: 280a 2020 2020 2020 2020 2020 2020 6e6e  (.            nn
+0000aee0: 2e4c 696e 6561 7228 696e 5f66 6561 7475  .Linear(in_featu
+0000aef0: 7265 733d 6e5f 6e6f 6465 5f66 6561 7475  res=n_node_featu
+0000af00: 7265 7320 2a20 3220 2b20 6e5f 6564 6765  res * 2 + n_edge
+0000af10: 5f66 6561 7475 7265 7320 2b0a 2020 2020  _features +.    
+0000af20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000af30: 2020 6e5f 676c 6f62 616c 5f66 6561 7475    n_global_featu
+0000af40: 7265 732c 0a20 2020 2020 2020 2020 2020  res,.           
+0000af50: 2020 2020 2020 2020 2020 206f 7574 5f66             out_f
+0000af60: 6561 7475 7265 733d 3332 2929 0a20 2020  eatures=32)).   
+0000af70: 2020 2020 2073 656c 662e 6e6f 6465 5f6d       self.node_m
+0000af80: 6f64 656c 732e 6170 7065 6e64 280a 2020  odels.append(.  
+0000af90: 2020 2020 2020 2020 2020 6e6e 2e4c 696e            nn.Lin
+0000afa0: 6561 7228 696e 5f66 6561 7475 7265 733d  ear(in_features=
+0000afb0: 6e5f 6e6f 6465 5f66 6561 7475 7265 7320  n_node_features 
+0000afc0: 2b20 6e5f 6564 6765 5f66 6561 7475 7265  + n_edge_feature
+0000afd0: 7320 2b0a 2020 2020 2020 2020 2020 2020  s +.            
+0000afe0: 2020 2020 2020 2020 2020 6e5f 676c 6f62            n_glob
+0000aff0: 616c 5f66 6561 7475 7265 732c 0a20 2020  al_features,.   
+0000b000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b010: 2020 206f 7574 5f66 6561 7475 7265 733d     out_features=
+0000b020: 3332 2929 0a20 2020 2020 2020 2073 656c  32)).        sel
+0000b030: 662e 676c 6f62 616c 5f6d 6f64 656c 732e  f.global_models.
+0000b040: 6170 7065 6e64 280a 2020 2020 2020 2020  append(.        
+0000b050: 2020 2020 6e6e 2e4c 696e 6561 7228 696e      nn.Linear(in
+0000b060: 5f66 6561 7475 7265 733d 6e5f 6e6f 6465  _features=n_node
+0000b070: 5f66 6561 7475 7265 7320 2b20 6e5f 6564  _features + n_ed
+0000b080: 6765 5f66 6561 7475 7265 7320 2b0a 2020  ge_features +.  
+0000b090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b0a0: 2020 2020 6e5f 676c 6f62 616c 5f66 6561      n_global_fea
+0000b0b0: 7475 7265 732c 0a20 2020 2020 2020 2020  tures,.         
+0000b0c0: 2020 2020 2020 2020 2020 2020 206f 7574               out
+0000b0d0: 5f66 6561 7475 7265 733d 3332 2929 0a0a  _features=32))..
+0000b0e0: 2020 2020 2020 2020 2320 5573 6564 2066          # Used f
+0000b0f0: 6f72 2063 6f6e 7665 7274 696e 6720 6564  or converting ed
+0000b100: 6765 7320 6261 636b 2074 6f20 7468 6569  ges back to thei
+0000b110: 7220 6f72 6967 696e 616c 2073 6861 7065  r original shape
+0000b120: 0a20 2020 2020 2020 2073 656c 662e 6564  .        self.ed
+0000b130: 6765 5f64 656e 7365 203d 206e 6e2e 4c69  ge_dense = nn.Li
+0000b140: 6e65 6172 2869 6e5f 6665 6174 7572 6573  near(in_features
+0000b150: 3d33 322c 0a20 2020 2020 2020 2020 2020  =32,.           
+0000b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b170: 2020 2020 2020 2020 206f 7574 5f66 6561           out_fea
+0000b180: 7475 7265 733d 6e5f 6564 6765 5f66 6561  tures=n_edge_fea
+0000b190: 7475 7265 7329 0a20 2020 2020 2020 2073  tures).        s
+0000b1a0: 656c 662e 6e6f 6465 5f64 656e 7365 203d  elf.node_dense =
+0000b1b0: 206e 6e2e 4c69 6e65 6172 2869 6e5f 6665   nn.Linear(in_fe
+0000b1c0: 6174 7572 6573 3d33 322c 0a20 2020 2020  atures=32,.     
+0000b1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b1e0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0000b1f0: 7574 5f66 6561 7475 7265 733d 6e5f 6e6f  ut_features=n_no
+0000b200: 6465 5f66 6561 7475 7265 7329 0a20 2020  de_features).   
+0000b210: 2020 2020 2073 656c 662e 676c 6f62 616c       self.global
+0000b220: 5f64 656e 7365 203d 206e 6e2e 4c69 6e65  _dense = nn.Line
+0000b230: 6172 2869 6e5f 6665 6174 7572 6573 3d33  ar(in_features=3
+0000b240: 322c 0a20 2020 2020 2020 2020 2020 2020  2,.             
+0000b250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b260: 2020 2020 2020 2020 206f 7574 5f66 6561           out_fea
+0000b270: 7475 7265 733d 6e5f 676c 6f62 616c 5f66  tures=n_global_f
+0000b280: 6561 7475 7265 7329 0a0a 2020 2020 6465  eatures)..    de
+0000b290: 6620 7265 7365 745f 7061 7261 6d65 7465  f reset_paramete
+0000b2a0: 7273 2873 656c 6629 202d 3e20 4e6f 6e65  rs(self) -> None
+0000b2b0: 3a0a 2020 2020 2020 2020 7365 6c66 2e65  :.        self.e
+0000b2c0: 6467 655f 6465 6e73 652e 7265 7365 745f  dge_dense.reset_
+0000b2d0: 7061 7261 6d65 7465 7273 2829 0a20 2020  parameters().   
+0000b2e0: 2020 2020 2073 656c 662e 6e6f 6465 5f64       self.node_d
+0000b2f0: 656e 7365 2e72 6573 6574 5f70 6172 616d  ense.reset_param
+0000b300: 6574 6572 7328 290a 2020 2020 2020 2020  eters().        
+0000b310: 7365 6c66 2e67 6c6f 6261 6c5f 6465 6e73  self.global_dens
+0000b320: 652e 7265 7365 745f 7061 7261 6d65 7465  e.reset_paramete
+0000b330: 7273 2829 0a20 2020 2020 2020 2066 6f72  rs().        for
+0000b340: 2069 2069 6e20 7261 6e67 6528 302c 206c   i in range(0, l
+0000b350: 656e 2873 656c 662e 6564 6765 5f6d 6f64  en(self.edge_mod
+0000b360: 656c 7329 293a 0a20 2020 2020 2020 2020  els)):.         
+0000b370: 2020 2073 656c 662e 6564 6765 5f6d 6f64     self.edge_mod
+0000b380: 656c 735b 695d 2e72 6573 6574 5f70 6172  els[i].reset_par
+0000b390: 616d 6574 6572 7328 290a 2020 2020 2020  ameters().      
+0000b3a0: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
+0000b3b0: 2830 2c20 6c65 6e28 7365 6c66 2e6e 6f64  (0, len(self.nod
+0000b3c0: 655f 6d6f 6465 6c73 2929 3a0a 2020 2020  e_models)):.    
+0000b3d0: 2020 2020 2020 2020 7365 6c66 2e6e 6f64          self.nod
+0000b3e0: 655f 6d6f 6465 6c73 5b69 5d2e 7265 7365  e_models[i].rese
+0000b3f0: 745f 7061 7261 6d65 7465 7273 2829 0a20  t_parameters(). 
+0000b400: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
+0000b410: 7261 6e67 6528 302c 206c 656e 2873 656c  range(0, len(sel
+0000b420: 662e 676c 6f62 616c 5f6d 6f64 656c 7329  f.global_models)
+0000b430: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
+0000b440: 656c 662e 676c 6f62 616c 5f6d 6f64 656c  elf.global_model
+0000b450: 735b 695d 2e72 6573 6574 5f70 6172 616d  s[i].reset_param
+0000b460: 6574 6572 7328 290a 0a20 2020 2064 6566  eters()..    def
+0000b470: 205f 7570 6461 7465 5f65 6467 655f 6665   _update_edge_fe
+0000b480: 6174 7572 6573 2873 656c 662c 206e 6f64  atures(self, nod
+0000b490: 655f 6665 6174 7572 6573 2c20 6564 6765  e_features, edge
+0000b4a0: 5f69 6e64 6578 2c20 6564 6765 5f66 6561  _index, edge_fea
+0000b4b0: 7475 7265 732c 0a20 2020 2020 2020 2020  tures,.         
+0000b4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b4d0: 2020 2020 2067 6c6f 6261 6c5f 6665 6174       global_feat
+0000b4e0: 7572 6573 2c20 6261 7463 6829 3a0a 2020  ures, batch):.  
+0000b4f0: 2020 2020 2020 7372 635f 696e 6465 782c        src_index,
+0000b500: 2064 7374 5f69 6e64 6578 203d 2065 6467   dst_index = edg
+0000b510: 655f 696e 6465 780a 2020 2020 2020 2020  e_index.        
+0000b520: 6f75 7420 3d20 746f 7263 682e 6361 7428  out = torch.cat(
+0000b530: 286e 6f64 655f 6665 6174 7572 6573 5b73  (node_features[s
+0000b540: 7263 5f69 6e64 6578 5d2c 206e 6f64 655f  rc_index], node_
+0000b550: 6665 6174 7572 6573 5b64 7374 5f69 6e64  features[dst_ind
+0000b560: 6578 5d2c 0a20 2020 2020 2020 2020 2020  ex],.           
+0000b570: 2020 2020 2020 2020 2020 2020 2020 6564                ed
+0000b580: 6765 5f66 6561 7475 7265 732c 2067 6c6f  ge_features, glo
+0000b590: 6261 6c5f 6665 6174 7572 6573 5b62 6174  bal_features[bat
+0000b5a0: 6368 5d29 2c0a 2020 2020 2020 2020 2020  ch]),.          
+0000b5b0: 2020 2020 2020 2020 2020 2020 2020 6469                di
+0000b5c0: 6d3d 3129 0a20 2020 2020 2020 2061 7373  m=1).        ass
+0000b5d0: 6572 7420 6f75 742e 7368 6170 655b 0a20  ert out.shape[. 
+0000b5e0: 2020 2020 2020 2020 2020 2031 5d20 3d3d             1] ==
+0000b5f0: 2073 656c 662e 6e5f 6e6f 6465 5f66 6561   self.n_node_fea
+0000b600: 7475 7265 7320 2a20 3220 2b20 7365 6c66  tures * 2 + self
+0000b610: 2e6e 5f65 6467 655f 6665 6174 7572 6573  .n_edge_features
+0000b620: 202b 2073 656c 662e 6e5f 676c 6f62 616c   + self.n_global
+0000b630: 5f66 6561 7475 7265 730a 2020 2020 2020  _features.      
+0000b640: 2020 666f 7220 6d6f 6465 6c20 696e 2073    for model in s
+0000b650: 656c 662e 6564 6765 5f6d 6f64 656c 733a  elf.edge_models:
+0000b660: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
+0000b670: 203d 206d 6f64 656c 286f 7574 290a 2020   = model(out).  
+0000b680: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000b690: 662e 6564 6765 5f64 656e 7365 286f 7574  f.edge_dense(out
+0000b6a0: 290a 0a20 2020 2064 6566 205f 7570 6461  )..    def _upda
+0000b6b0: 7465 5f6e 6f64 655f 6665 6174 7572 6573  te_node_features
+0000b6c0: 2873 656c 662c 206e 6f64 655f 6665 6174  (self, node_feat
+0000b6d0: 7572 6573 2c20 6564 6765 5f69 6e64 6578  ures, edge_index
+0000b6e0: 2c20 6564 6765 5f66 6561 7475 7265 732c  , edge_features,
+0000b6f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b700: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+0000b710: 6c6f 6261 6c5f 6665 6174 7572 6573 2c20  lobal_features, 
+0000b720: 6261 7463 6829 3a0a 0a20 2020 2020 2020  batch):..       
+0000b730: 2073 7263 5f69 6e64 6578 2c20 6473 745f   src_index, dst_
+0000b740: 696e 6465 7820 3d20 6564 6765 5f69 6e64  index = edge_ind
+0000b750: 6578 0a20 2020 2020 2020 2023 2043 6f6d  ex.        # Com
+0000b760: 7075 7465 206d 6561 6e20 6564 6765 2066  pute mean edge f
+0000b770: 6561 7475 7265 7320 666f 7220 6561 6368  eatures for each
+0000b780: 206e 6f64 6520 6279 2064 7374 5f69 6e64   node by dst_ind
+0000b790: 6578 2028 6561 6368 206e 6f64 650a 2020  ex (each node.  
+0000b7a0: 2020 2020 2020 2320 7265 6365 6976 6573        # receives
+0000b7b0: 2069 6e66 6f72 6d61 7469 6f6e 2066 726f   information fro
+0000b7c0: 6d20 6564 6765 7320 7768 6963 6820 6861  m edges which ha
+0000b7d0: 7665 2074 6861 7420 6e6f 6465 2061 7320  ve that node as 
+0000b7e0: 6974 7320 6465 7374 696e 6174 696f 6e2c  its destination,
+0000b7f0: 0a20 2020 2020 2020 2023 2068 656e 6365  .        # hence
+0000b800: 2074 6865 2063 6f6d 7075 7461 7469 6f6e   the computation
+0000b810: 2075 7365 7320 6473 745f 696e 6465 7820   uses dst_index 
+0000b820: 746f 2061 6767 7265 6761 7465 2069 6e66  to aggregate inf
+0000b830: 6f72 6d61 7469 6f6e 290a 2020 2020 2020  ormation).      
+0000b840: 2020 6564 6765 5f66 6561 7475 7265 735f    edge_features_
+0000b850: 6d65 616e 5f62 795f 6e6f 6465 203d 2073  mean_by_node = s
+0000b860: 6361 7474 6572 2873 7263 3d65 6467 655f  catter(src=edge_
+0000b870: 6665 6174 7572 6573 2c0a 2020 2020 2020  features,.      
+0000b880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b8a0: 2020 2020 2020 2069 6e64 6578 3d64 7374         index=dst
+0000b8b0: 5f69 6e64 6578 2c0a 2020 2020 2020 2020  _index,.        
+0000b8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b8e0: 2020 2020 2064 696d 3d30 2c0a 2020 2020       dim=0,.    
+0000b8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b910: 2020 2020 2020 2020 2072 6564 7563 653d           reduce=
+0000b920: 276d 6561 6e27 290a 2020 2020 2020 2020  'mean').        
+0000b930: 6f75 7420 3d20 746f 7263 682e 6361 7428  out = torch.cat(
+0000b940: 0a20 2020 2020 2020 2020 2020 2028 6e6f  .            (no
+0000b950: 6465 5f66 6561 7475 7265 732c 2065 6467  de_features, edg
+0000b960: 655f 6665 6174 7572 6573 5f6d 6561 6e5f  e_features_mean_
+0000b970: 6279 5f6e 6f64 652c 2067 6c6f 6261 6c5f  by_node, global_
+0000b980: 6665 6174 7572 6573 5b62 6174 6368 5d29  features[batch])
+0000b990: 2c0a 2020 2020 2020 2020 2020 2020 6469  ,.            di
+0000b9a0: 6d3d 3129 0a20 2020 2020 2020 2066 6f72  m=1).        for
+0000b9b0: 206d 6f64 656c 2069 6e20 7365 6c66 2e6e   model in self.n
+0000b9c0: 6f64 655f 6d6f 6465 6c73 3a0a 2020 2020  ode_models:.    
+0000b9d0: 2020 2020 2020 2020 6f75 7420 3d20 6d6f          out = mo
+0000b9e0: 6465 6c28 6f75 7429 0a20 2020 2020 2020  del(out).       
+0000b9f0: 2072 6574 7572 6e20 7365 6c66 2e6e 6f64   return self.nod
+0000ba00: 655f 6465 6e73 6528 6f75 7429 0a0a 2020  e_dense(out)..  
+0000ba10: 2020 6465 6620 5f75 7064 6174 655f 676c    def _update_gl
+0000ba20: 6f62 616c 5f66 6561 7475 7265 7328 7365  obal_features(se
+0000ba30: 6c66 2c20 6e6f 6465 5f66 6561 7475 7265  lf, node_feature
+0000ba40: 732c 2065 6467 655f 6665 6174 7572 6573  s, edge_features
+0000ba50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000ba60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba70: 2020 676c 6f62 616c 5f66 6561 7475 7265    global_feature
+0000ba80: 732c 206e 6f64 655f 6261 7463 685f 6d61  s, node_batch_ma
+0000ba90: 702c 0a20 2020 2020 2020 2020 2020 2020  p,.             
+0000baa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bab0: 2020 2065 6467 655f 6261 7463 685f 6d61     edge_batch_ma
+0000bac0: 7029 3a0a 2020 2020 2020 2020 6564 6765  p):.        edge
+0000bad0: 5f66 6561 7475 7265 735f 6d65 616e 203d  _features_mean =
+0000bae0: 2073 6361 7474 6572 2873 7263 3d65 6467   scatter(src=edg
+0000baf0: 655f 6665 6174 7572 6573 2c0a 2020 2020  e_features,.    
+0000bb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb20: 2069 6e64 6578 3d65 6467 655f 6261 7463   index=edge_batc
+0000bb30: 685f 6d61 702c 0a20 2020 2020 2020 2020  h_map,.         
+0000bb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb50: 2020 2020 2020 2020 2020 2020 6469 6d3d              dim=
+0000bb60: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
+0000bb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb80: 2020 2020 2020 2020 7265 6475 6365 3d27          reduce='
+0000bb90: 6d65 616e 2729 0a20 2020 2020 2020 206e  mean').        n
+0000bba0: 6f64 655f 6665 6174 7572 6573 5f6d 6561  ode_features_mea
+0000bbb0: 6e20 3d20 7363 6174 7465 7228 7372 633d  n = scatter(src=
+0000bbc0: 6e6f 6465 5f66 6561 7475 7265 732c 0a20  node_features,. 
+0000bbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bbf0: 2020 2020 696e 6465 783d 6e6f 6465 5f62      index=node_b
+0000bc00: 6174 6368 5f6d 6170 2c0a 2020 2020 2020  atch_map,.      
+0000bc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc20: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000bc30: 696d 3d30 2c0a 2020 2020 2020 2020 2020  im=0,.          
+0000bc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc50: 2020 2020 2020 2020 2020 2072 6564 7563             reduc
+0000bc60: 653d 276d 6561 6e27 290a 2020 2020 2020  e='mean').      
+0000bc70: 2020 6f75 7420 3d20 746f 7263 682e 6361    out = torch.ca
+0000bc80: 7428 0a20 2020 2020 2020 2020 2020 2028  t(.            (
+0000bc90: 6564 6765 5f66 6561 7475 7265 735f 6d65  edge_features_me
+0000bca0: 616e 2c20 6e6f 6465 5f66 6561 7475 7265  an, node_feature
+0000bcb0: 735f 6d65 616e 2c20 676c 6f62 616c 5f66  s_mean, global_f
+0000bcc0: 6561 7475 7265 7329 2c20 6469 6d3d 3129  eatures), dim=1)
+0000bcd0: 0a20 2020 2020 2020 2066 6f72 206d 6f64  .        for mod
+0000bce0: 656c 2069 6e20 7365 6c66 2e67 6c6f 6261  el in self.globa
+0000bcf0: 6c5f 6d6f 6465 6c73 3a0a 2020 2020 2020  l_models:.      
+0000bd00: 2020 2020 2020 6f75 7420 3d20 6d6f 6465        out = mode
+0000bd10: 6c28 6f75 7429 0a20 2020 2020 2020 2072  l(out).        r
+0000bd20: 6574 7572 6e20 7365 6c66 2e67 6c6f 6261  eturn self.globa
+0000bd30: 6c5f 6465 6e73 6528 6f75 7429 0a0a 2020  l_dense(out)..  
+0000bd40: 2020 6465 6620 666f 7277 6172 6428 0a20    def forward(. 
+0000bd50: 2020 2020 2020 2020 2020 2073 656c 662c             self,
+0000bd60: 0a20 2020 2020 2020 2020 2020 206e 6f64  .            nod
+0000bd70: 655f 6665 6174 7572 6573 3a20 5465 6e73  e_features: Tens
+0000bd80: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
+0000bd90: 6564 6765 5f69 6e64 6578 3a20 5465 6e73  edge_index: Tens
+0000bda0: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
+0000bdb0: 6564 6765 5f66 6561 7475 7265 733a 2054  edge_features: T
+0000bdc0: 656e 736f 722c 0a20 2020 2020 2020 2020  ensor,.         
+0000bdd0: 2020 2067 6c6f 6261 6c5f 6665 6174 7572     global_featur
+0000bde0: 6573 3a20 5465 6e73 6f72 2c0a 2020 2020  es: Tensor,.    
+0000bdf0: 2020 2020 2020 2020 6261 7463 683a 204f          batch: O
+0000be00: 7074 696f 6e61 6c5b 5465 6e73 6f72 5d20  ptional[Tensor] 
+0000be10: 3d20 4e6f 6e65 2920 2d3e 2054 7570 6c65  = None) -> Tuple
+0000be20: 5b54 656e 736f 722c 2054 656e 736f 722c  [Tensor, Tensor,
+0000be30: 2054 656e 736f 725d 3a0a 2020 2020 2020   Tensor]:.      
+0000be40: 2020 2222 224f 7574 7075 7420 636f 6d70    """Output comp
+0000be50: 7574 6174 696f 6e20 666f 7220 6120 4772  utation for a Gr
+0000be60: 6170 684e 6574 776f 726b 0a0a 2020 2020  aphNetwork..    
+0000be70: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+0000be80: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+0000be90: 2d0a 2020 2020 2020 2020 6e6f 6465 5f66  -.        node_f
+0000bea0: 6561 7475 7265 733a 2074 6f72 6368 2e54  eatures: torch.T
+0000beb0: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
+0000bec0: 2020 496e 7075 7420 6e6f 6465 2066 6561    Input node fea
+0000bed0: 7475 7265 7320 6f66 2073 6861 7065 203a  tures of shape :
+0000bee0: 6d61 7468 3a60 287c 5c6d 6174 6863 616c  math:`(|\mathcal
+0000bef0: 7b56 7d7c 2c20 465f 6e29 600a 2020 2020  {V}|, F_n)`.    
+0000bf00: 2020 2020 6564 6765 5f69 6e64 6578 3a20      edge_index: 
+0000bf10: 746f 7263 682e 5465 6e73 6f72 0a20 2020  torch.Tensor.   
+0000bf20: 2020 2020 2020 2020 2045 6467 6520 696e           Edge in
+0000bf30: 6465 7865 7320 6f66 2073 6861 7065 203a  dexes of shape :
+0000bf40: 6d61 7468 3a60 2832 2c20 7c5c 6d61 7468  math:`(2, |\math
+0000bf50: 6361 6c7b 457d 7c29 600a 2020 2020 2020  cal{E}|)`.      
+0000bf60: 2020 6564 6765 5f66 6561 7475 7265 733a    edge_features:
+0000bf70: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
+0000bf80: 2020 2020 2020 2020 2020 4564 6765 2066            Edge f
+0000bf90: 6561 7475 7265 7320 6f66 2074 6865 2067  eatures of the g
+0000bfa0: 7261 7068 2c20 7368 6170 653a 203a 6d61  raph, shape: :ma
+0000bfb0: 7468 3a60 287c 5c6d 6174 6863 616c 7b45  th:`(|\mathcal{E
+0000bfc0: 7d7c 2c20 465f 6529 600a 2020 2020 2020  }|, F_e)`.      
+0000bfd0: 2020 676c 6f62 616c 5f66 6561 7475 7265    global_feature
+0000bfe0: 733a 2074 6f72 6368 2e54 656e 736f 720a  s: torch.Tensor.
+0000bff0: 2020 2020 2020 2020 2020 2020 476c 6f62              Glob
+0000c000: 616c 2066 6561 7475 7265 7320 6f66 2074  al features of t
+0000c010: 6865 2067 7261 7068 2c20 7368 6170 653a  he graph, shape:
+0000c020: 203a 6d61 7468 3a60 2846 5f67 2c20 3129   :math:`(F_g, 1)
+0000c030: 6020 7768 6572 652c 203a 6d61 7468 3a60  ` where, :math:`
+0000c040: 7c5c 6d61 7468 6361 6c7b 567d 7c60 2061  |\mathcal{V}|` a
+0000c050: 6e64 203a 6d61 7468 3a60 7c5c 6d61 7468  nd :math:`|\math
+0000c060: 6361 6c7b 457d 7c60 2064 656e 6f74 6573  cal{E}|` denotes
+0000c070: 2074 6865 206e 756d 6265 7220 6f66 206e   the number of n
+0000c080: 6f64 6573 2061 6e64 2065 6467 6573 2069  odes and edges i
+0000c090: 6e20 7468 6520 6772 6170 682c 0a20 2020  n the graph,.   
+0000c0a0: 2020 2020 2020 2020 203a 6d61 7468 3a60           :math:`
+0000c0b0: 465f 6e60 2c20 3a6d 6174 683a 6046 5f65  F_n`, :math:`F_e
+0000c0c0: 602c 203a 6d61 7468 3a60 465f 6760 2064  `, :math:`F_g` d
+0000c0d0: 656e 6f74 6573 2074 6865 206e 756d 6265  enotes the numbe
+0000c0e0: 7220 6f66 206e 6f64 6520 6665 6174 7572  r of node featur
+0000c0f0: 6573 2c20 6564 6765 2066 6561 7475 7265  es, edge feature
+0000c100: 7320 616e 6420 676c 6f62 616c 2073 7461  s and global sta
+0000c110: 7465 2066 6561 7475 7265 7320 7265 7370  te features resp
+0000c120: 6563 7469 7665 6c79 2e0a 2020 2020 2020  ectively..      
+0000c130: 2020 6261 7463 683a 2074 6f72 6368 2e4c    batch: torch.L
+0000c140: 6f6e 6754 656e 736f 7220 286f 7074 696f  ongTensor (optio
+0000c150: 6e61 6c2c 2064 6566 6175 6c74 3a20 4e6f  nal, default: No
+0000c160: 6e65 290a 2020 2020 2020 2020 2020 2020  ne).            
+0000c170: 4120 7665 6374 6f72 2074 6861 7420 6d61  A vector that ma
+0000c180: 7073 2065 6163 6820 6e6f 6465 2074 6f20  ps each node to 
+0000c190: 6974 7320 7265 7370 6563 7469 7665 2067  its respective g
+0000c1a0: 7261 7068 2069 6465 6e74 6966 6965 722e  raph identifier.
+0000c1b0: 2054 6865 2061 7474 7269 6275 7465 2069   The attribute i
+0000c1c0: 7320 7573 6564 206f 6e6c 7920 7768 656e  s used only when
+0000c1d0: 206d 6f72 6520 7468 616e 206f 6e65 2067   more than one g
+0000c1e0: 7261 7068 2061 7265 2062 6174 6368 6564  raph are batched
+0000c1f0: 2074 6f67 6574 6865 7220 6475 7269 6e67   together during
+0000c200: 2061 2073 696e 676c 6520 666f 7277 6172   a single forwar
+0000c210: 6420 7061 7373 2e0a 2020 2020 2020 2020  d pass..        
+0000c220: 2222 220a 2020 2020 2020 2020 6966 2062  """.        if b
+0000c230: 6174 6368 2069 7320 4e6f 6e65 3a0a 2020  atch is None:.  
+0000c240: 2020 2020 2020 2020 2020 6261 7463 6820            batch 
+0000c250: 3d20 6e6f 6465 5f66 6561 7475 7265 732e  = node_features.
+0000c260: 6e65 775f 7a65 726f 7328 6e6f 6465 5f66  new_zeros(node_f
+0000c270: 6561 7475 7265 732e 7369 7a65 2830 292c  eatures.size(0),
+0000c280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c2a0: 2020 2020 2020 2020 2020 2020 2064 7479               dty
+0000c2b0: 7065 3d74 6f72 6368 2e69 6e74 3634 290a  pe=torch.int64).
+0000c2c0: 0a20 2020 2020 2020 206e 6f64 655f 6665  .        node_fe
+0000c2d0: 6174 7572 6573 5f63 6f70 792c 2065 6467  atures_copy, edg
+0000c2e0: 655f 6665 6174 7572 6573 5f63 6f70 792c  e_features_copy,
+0000c2f0: 2067 6c6f 6261 6c5f 6665 6174 7572 6573   global_features
+0000c300: 5f63 6f70 7920 3d20 6e6f 6465 5f66 6561  _copy = node_fea
+0000c310: 7475 7265 732c 2065 6467 655f 6665 6174  tures, edge_feat
+0000c320: 7572 6573 2c20 676c 6f62 616c 5f66 6561  ures, global_fea
+0000c330: 7475 7265 730a 2020 2020 2020 2020 6966  tures.        if
+0000c340: 2073 656c 662e 6973 5f75 6e64 6972 6563   self.is_undirec
+0000c350: 7465 6420 6973 2054 7275 653a 0a20 2020  ted is True:.   
+0000c360: 2020 2020 2020 2020 2023 2068 6f6c 6469           # holdi
+0000c370: 6e67 2062 692d 6469 7265 6374 696f 6e61  ng bi-directiona
+0000c380: 6c20 6564 6765 7320 696e 2063 6173 6520  l edges in case 
+0000c390: 6f66 2075 6e64 6972 6563 7465 6420 6772  of undirected gr
+0000c3a0: 6170 6873 0a20 2020 2020 2020 2020 2020  aphs.           
+0000c3b0: 2065 6467 655f 696e 6465 7820 3d20 746f   edge_index = to
+0000c3c0: 7263 682e 6361 7428 2865 6467 655f 696e  rch.cat((edge_in
+0000c3d0: 6465 782c 2065 6467 655f 696e 6465 782e  dex, edge_index.
+0000c3e0: 666c 6970 285b 305d 2929 2c20 6469 6d3d  flip([0])), dim=
+0000c3f0: 3129 0a20 2020 2020 2020 2020 2020 2065  1).            e
+0000c400: 6467 655f 6665 6174 7572 6573 5f6c 656e  dge_features_len
+0000c410: 203d 2065 6467 655f 6665 6174 7572 6573   = edge_features
+0000c420: 2e73 6861 7065 5b30 5d0a 2020 2020 2020  .shape[0].      
+0000c430: 2020 2020 2020 6564 6765 5f66 6561 7475        edge_featu
+0000c440: 7265 7320 3d20 746f 7263 682e 6361 7428  res = torch.cat(
+0000c450: 2865 6467 655f 6665 6174 7572 6573 2c20  (edge_features, 
+0000c460: 6564 6765 5f66 6561 7475 7265 7329 2c20  edge_features), 
+0000c470: 6469 6d3d 3029 0a20 2020 2020 2020 2065  dim=0).        e
+0000c480: 6467 655f 6261 7463 685f 6d61 7020 3d20  dge_batch_map = 
+0000c490: 6261 7463 685b 6564 6765 5f69 6e64 6578  batch[edge_index
+0000c4a0: 5b30 5d5d 0a20 2020 2020 2020 2065 6467  [0]].        edg
+0000c4b0: 655f 6665 6174 7572 6573 203d 2073 656c  e_features = sel
+0000c4c0: 662e 5f75 7064 6174 655f 6564 6765 5f66  f._update_edge_f
+0000c4d0: 6561 7475 7265 7328 6e6f 6465 5f66 6561  eatures(node_fea
+0000c4e0: 7475 7265 732c 2065 6467 655f 696e 6465  tures, edge_inde
+0000c4f0: 782c 0a20 2020 2020 2020 2020 2020 2020  x,.             
 0000c500: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c520: 2020 2020 2065 6467 655f 6665 6174 7572       edge_featur
-0000c530: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
+0000c520: 2020 2020 2020 6564 6765 5f66 6561 7475        edge_featu
+0000c530: 7265 732c 0a20 2020 2020 2020 2020 2020  res,.           
 0000c540: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c560: 2020 2020 2020 2020 2020 2067 6c6f 6261             globa
-0000c570: 6c5f 6665 6174 7572 6573 2c20 6261 7463  l_features, batc
-0000c580: 682c 0a20 2020 2020 2020 2020 2020 2020  h,.             
+0000c560: 2020 2020 2020 2020 676c 6f62 616c 5f66          global_f
+0000c570: 6561 7475 7265 732c 0a20 2020 2020 2020  eatures,.       
+0000c580: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c5b0: 2020 2020 2020 2020 2020 6564 6765 5f62            edge_b
-0000c5c0: 6174 6368 5f6d 6170 290a 0a20 2020 2020  atch_map)..     
-0000c5d0: 2020 2069 6620 7365 6c66 2e69 735f 756e     if self.is_un
-0000c5e0: 6469 7265 6374 6564 2069 7320 5472 7565  directed is True
-0000c5f0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-0000c600: 636f 6f6e 7665 7274 696e 6720 6564 6765  coonverting edge
-0000c610: 2066 6561 7475 7265 7320 746f 2069 7473   features to its
-0000c620: 206f 7269 6769 6e61 6c20 7368 6170 650a   original shape.
-0000c630: 2020 2020 2020 2020 2020 2020 7370 6c69              spli
-0000c640: 7420 3d20 746f 7263 682e 7370 6c69 7428  t = torch.split(
-0000c650: 6564 6765 5f66 6561 7475 7265 732c 0a20  edge_features,. 
+0000c5a0: 2020 2020 2020 2020 2020 2020 6564 6765              edge
+0000c5b0: 5f62 6174 6368 5f6d 6170 290a 2020 2020  _batch_map).    
+0000c5c0: 2020 2020 6e6f 6465 5f66 6561 7475 7265      node_feature
+0000c5d0: 7320 3d20 7365 6c66 2e5f 7570 6461 7465  s = self._update
+0000c5e0: 5f6e 6f64 655f 6665 6174 7572 6573 286e  _node_features(n
+0000c5f0: 6f64 655f 6665 6174 7572 6573 2c20 6564  ode_features, ed
+0000c600: 6765 5f69 6e64 6578 2c0a 2020 2020 2020  ge_index,.      
+0000c610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c630: 2020 2020 2020 2020 2020 2020 2065 6467               edg
+0000c640: 655f 6665 6174 7572 6573 2c0a 2020 2020  e_features,.    
+0000c650: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c670: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-0000c680: 6564 6765 5f66 6561 7475 7265 735f 6c65  edge_features_le
-0000c690: 6e2c 2065 6467 655f 6665 6174 7572 6573  n, edge_features
-0000c6a0: 5f6c 656e 5d29 0a20 2020 2020 2020 2020  _len]).         
-0000c6b0: 2020 2065 6467 655f 6665 6174 7572 6573     edge_features
-0000c6c0: 203d 2028 7370 6c69 745b 305d 202b 2073   = (split[0] + s
-0000c6d0: 706c 6974 5b31 5d29 202f 2032 0a0a 2020  plit[1]) / 2..  
-0000c6e0: 2020 2020 2020 6966 2073 656c 662e 7265        if self.re
-0000c6f0: 7369 6475 616c 5f63 6f6e 6e65 6374 696f  sidual_connectio
-0000c700: 6e3a 0a20 2020 2020 2020 2020 2020 2065  n:.            e
-0000c710: 6467 655f 6665 6174 7572 6573 202b 3d20  dge_features += 
-0000c720: 6564 6765 5f66 6561 7475 7265 735f 636f  edge_features_co
-0000c730: 7079 0a20 2020 2020 2020 2020 2020 206e  py.            n
-0000c740: 6f64 655f 6665 6174 7572 6573 202b 3d20  ode_features += 
-0000c750: 6e6f 6465 5f66 6561 7475 7265 735f 636f  node_features_co
-0000c760: 7079 0a20 2020 2020 2020 2020 2020 2067  py.            g
-0000c770: 6c6f 6261 6c5f 6665 6174 7572 6573 202b  lobal_features +
-0000c780: 3d20 676c 6f62 616c 5f66 6561 7475 7265  = global_feature
-0000c790: 735f 636f 7079 0a0a 2020 2020 2020 2020  s_copy..        
-0000c7a0: 7265 7475 726e 206e 6f64 655f 6665 6174  return node_feat
-0000c7b0: 7572 6573 2c20 6564 6765 5f66 6561 7475  ures, edge_featu
-0000c7c0: 7265 732c 2067 6c6f 6261 6c5f 6665 6174  res, global_feat
-0000c7d0: 7572 6573 0a0a 2020 2020 6465 6620 5f5f  ures..    def __
-0000c7e0: 7265 7072 5f5f 2873 656c 6629 202d 3e20  repr__(self) -> 
-0000c7f0: 7374 723a 0a20 2020 2020 2020 2072 6574  str:.        ret
-0000c800: 7572 6e20 280a 2020 2020 2020 2020 2020  urn (.          
-0000c810: 2020 6627 7b73 656c 662e 5f5f 636c 6173    f'{self.__clas
-0000c820: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d28 6e5f  s__.__name__}(n_
-0000c830: 6e6f 6465 5f66 6561 7475 7265 733d 7b73  node_features={s
-0000c840: 656c 662e 6e5f 6e6f 6465 5f66 6561 7475  elf.n_node_featu
-0000c850: 7265 737d 2c20 6e5f 6564 6765 5f66 6561  res}, n_edge_fea
-0000c860: 7475 7265 733d 7b73 656c 662e 6e5f 6564  tures={self.n_ed
-0000c870: 6765 5f66 6561 7475 7265 737d 2c20 6e5f  ge_features}, n_
-0000c880: 676c 6f62 616c 5f66 6561 7475 7265 733d  global_features=
-0000c890: 7b73 656c 662e 6e5f 676c 6f62 616c 5f66  {self.n_global_f
-0000c8a0: 6561 7475 7265 737d 2c20 6973 5f75 6e64  eatures}, is_und
-0000c8b0: 6972 6563 7465 643d 7b73 656c 662e 6973  irected={self.is
-0000c8c0: 5f75 6e64 6972 6563 7465 647d 2c20 7265  _undirected}, re
-0000c8d0: 7369 6475 616c 5f63 6f6e 6e65 6374 696f  sidual_connectio
-0000c8e0: 6e3d 7b73 656c 662e 7265 7369 6475 616c  n={self.residual
-0000c8f0: 5f63 6f6e 6e65 6374 696f 6e7d 2927 0a20  _connection})'. 
-0000c900: 2020 2020 2020 2029 0a0a 0a63 6c61 7373         )...class
-0000c910: 2041 6666 696e 6528 6e6e 2e4d 6f64 756c   Affine(nn.Modul
-0000c920: 6529 3a0a 2020 2020 2222 2243 6c61 7373  e):.    """Class
-0000c930: 2077 6869 6368 2070 6572 666f 726d 7320   which performs 
-0000c940: 7468 6520 4166 6669 6e65 2074 7261 6e73  the Affine trans
-0000c950: 666f 726d 6174 696f 6e2e 0a0a 2020 2020  formation...    
-0000c960: 5468 6973 2074 7261 6e73 666f 726d 6174  This transformat
-0000c970: 696f 6e20 6973 2062 6173 6564 206f 6e20  ion is based on 
-0000c980: 7468 6520 6166 6669 6e69 7479 206f 6620  the affinity of 
-0000c990: 7468 6520 6261 7365 2064 6973 7472 6962  the base distrib
-0000c9a0: 7574 696f 6e20 7769 7468 0a20 2020 2074  ution with.    t
-0000c9b0: 6865 2074 6172 6765 7420 6469 7374 7269  he target distri
-0000c9c0: 6275 7469 6f6e 2e20 4120 6765 6f6d 6574  bution. A geomet
-0000c9d0: 7269 6320 7472 616e 7366 6f72 6d61 7469  ric transformati
-0000c9e0: 6f6e 2069 7320 6170 706c 6965 6420 7768  on is applied wh
-0000c9f0: 6572 650a 2020 2020 7468 6520 7061 7261  ere.    the para
-0000ca00: 6d65 7465 7273 2070 6572 666f 726d 7320  meters performs 
-0000ca10: 6368 616e 6765 7320 6f6e 2074 6865 2073  changes on the s
-0000ca20: 6361 6c65 2061 6e64 2073 6869 6674 206f  cale and shift o
-0000ca30: 6620 6120 6675 6e63 7469 6f6e 0a20 2020  f a function.   
-0000ca40: 2028 696e 7075 7473 292e 0a0a 2020 2020   (inputs)...    
-0000ca50: 4e6f 726d 616c 697a 696e 6720 466c 6f77  Normalizing Flow
-0000ca60: 2074 7261 6e73 666f 726d 6174 696f 6e73   transformations
-0000ca70: 206d 7573 7420 6265 2062 696a 6563 7469   must be bijecti
-0000ca80: 7665 2069 6e20 6f72 6465 7220 746f 2063  ve in order to c
-0000ca90: 6f6d 7075 7465 0a20 2020 2074 6865 206c  ompute.    the l
-0000caa0: 6f67 6172 6974 686d 206f 6620 6a61 636f  ogarithm of jaco
-0000cab0: 6269 616e 2773 2064 6574 6572 6d69 6e61  bian's determina
-0000cac0: 6e74 2e20 466f 7220 7468 6973 2072 6561  nt. For this rea
-0000cad0: 736f 6e2c 2074 7261 6e73 666f 726d 6174  son, transformat
-0000cae0: 696f 6e73 0a20 2020 206d 7573 7420 7065  ions.    must pe
-0000caf0: 7266 6f72 6d20 6120 666f 7277 6172 6420  rform a forward 
-0000cb00: 616e 6420 696e 7665 7273 6520 7061 7373  and inverse pass
-0000cb10: 2e0a 0a20 2020 2045 7861 6d70 6c65 0a20  ...    Example. 
-0000cb20: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
-0000cb30: 3e3e 3e20 696d 706f 7274 2064 6565 7063  >>> import deepc
-0000cb40: 6865 6d20 6173 2064 630a 2020 2020 3e3e  hem as dc.    >>
-0000cb50: 3e20 6672 6f6d 2064 6565 7063 6865 6d2e  > from deepchem.
-0000cb60: 6d6f 6465 6c73 2e74 6f72 6368 5f6d 6f64  models.torch_mod
-0000cb70: 656c 732e 6c61 7965 7273 2069 6d70 6f72  els.layers impor
-0000cb80: 7420 4166 6669 6e65 0a20 2020 203e 3e3e  t Affine.    >>>
-0000cb90: 2069 6d70 6f72 7420 746f 7263 680a 2020   import torch.  
-0000cba0: 2020 3e3e 3e20 6672 6f6d 2074 6f72 6368    >>> from torch
-0000cbb0: 2e64 6973 7472 6962 7574 696f 6e73 2069  .distributions i
-0000cbc0: 6d70 6f72 7420 4d75 6c74 6976 6172 6961  mport Multivaria
-0000cbd0: 7465 4e6f 726d 616c 0a20 2020 203e 3e3e  teNormal.    >>>
-0000cbe0: 2023 2069 6e69 7469 616c 697a 6520 7468   # initialize th
-0000cbf0: 6520 7472 616e 7366 6f72 6d61 7469 6f6e  e transformation
-0000cc00: 206c 6179 6572 2773 2070 6172 616d 6574   layer's paramet
-0000cc10: 6572 730a 2020 2020 3e3e 3e20 6469 6d20  ers.    >>> dim 
-0000cc20: 3d20 320a 2020 2020 3e3e 3e20 7361 6d70  = 2.    >>> samp
-0000cc30: 6c65 7320 3d20 3936 0a20 2020 203e 3e3e  les = 96.    >>>
-0000cc40: 2074 7261 6e73 666f 726d 7320 3d20 4166   transforms = Af
-0000cc50: 6669 6e65 2864 696d 290a 2020 2020 3e3e  fine(dim).    >>
-0000cc60: 3e20 2320 666f 7277 6172 6420 7061 7373  > # forward pass
-0000cc70: 2062 6173 6564 206f 6e20 6120 6769 7665   based on a give
-0000cc80: 6e20 6469 7374 7269 6275 7469 6f6e 0a20  n distribution. 
-0000cc90: 2020 203e 3e3e 2064 6973 7472 6962 7574     >>> distribut
-0000cca0: 696f 6e20 3d20 4d75 6c74 6976 6172 6961  ion = Multivaria
-0000ccb0: 7465 4e6f 726d 616c 2874 6f72 6368 2e7a  teNormal(torch.z
-0000ccc0: 6572 6f73 2864 696d 292c 2074 6f72 6368  eros(dim), torch
-0000ccd0: 2e65 7965 2864 696d 2929 0a20 2020 203e  .eye(dim)).    >
-0000cce0: 3e3e 2069 6e70 7574 203d 2064 6973 7472  >> input = distr
-0000ccf0: 6962 7574 696f 6e2e 7361 6d70 6c65 2874  ibution.sample(t
-0000cd00: 6f72 6368 2e53 697a 6528 2873 616d 706c  orch.Size((sampl
-0000cd10: 6573 2c20 6469 6d29 2929 0a20 2020 203e  es, dim))).    >
-0000cd20: 3e3e 206c 656e 2874 7261 6e73 666f 726d  >> len(transform
-0000cd30: 732e 666f 7277 6172 6428 696e 7075 7429  s.forward(input)
-0000cd40: 290a 2020 2020 320a 2020 2020 3e3e 3e20  ).    2.    >>> 
-0000cd50: 2320 696e 7665 7273 6520 7061 7373 2062  # inverse pass b
-0000cd60: 6173 6564 206f 6e20 6120 6469 7374 7269  ased on a distri
-0000cd70: 6275 7469 6f6e 0a20 2020 203e 3e3e 206c  bution.    >>> l
-0000cd80: 656e 2874 7261 6e73 666f 726d 732e 696e  en(transforms.in
-0000cd90: 7665 7273 6528 696e 7075 7429 290a 2020  verse(input)).  
-0000cda0: 2020 320a 0a20 2020 2022 2222 0a0a 2020    2..    """..  
-0000cdb0: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-0000cdc0: 656c 662c 2064 696d 3a20 696e 7429 202d  elf, dim: int) -
-0000cdd0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000cde0: 2222 2243 7265 6174 6520 6120 4166 6669  """Create a Affi
-0000cdf0: 6e65 2074 7261 6e73 666f 726d 206c 6179  ne transform lay
-0000ce00: 6572 2e0a 0a20 2020 2020 2020 2050 6172  er...        Par
-0000ce10: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
-0000ce20: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-0000ce30: 2020 2064 696d 3a20 696e 740a 2020 2020     dim: int.    
-0000ce40: 2020 2020 2020 2020 5661 6c75 6520 6f66          Value of
-0000ce50: 2074 6865 204e 7468 2064 696d 656e 7369   the Nth dimensi
-0000ce60: 6f6e 206f 6620 7468 6520 6461 7461 7365  on of the datase
-0000ce70: 742e 0a0a 2020 2020 2020 2020 2222 220a  t...        """.
-0000ce80: 0a20 2020 2020 2020 2073 7570 6572 2829  .        super()
-0000ce90: 2e5f 5f69 6e69 745f 5f28 290a 2020 2020  .__init__().    
-0000cea0: 2020 2020 7365 6c66 2e64 696d 203d 2064      self.dim = d
-0000ceb0: 696d 0a20 2020 2020 2020 2073 656c 662e  im.        self.
-0000cec0: 7363 616c 6520 3d20 6e6e 2e50 6172 616d  scale = nn.Param
-0000ced0: 6574 6572 2874 6f72 6368 2e7a 6572 6f73  eter(torch.zeros
-0000cee0: 2873 656c 662e 6469 6d29 290a 2020 2020  (self.dim)).    
-0000cef0: 2020 2020 7365 6c66 2e73 6869 6674 203d      self.shift =
-0000cf00: 206e 6e2e 5061 7261 6d65 7465 7228 746f   nn.Parameter(to
-0000cf10: 7263 682e 7a65 726f 7328 7365 6c66 2e64  rch.zeros(self.d
-0000cf20: 696d 2929 0a0a 2020 2020 6465 6620 666f  im))..    def fo
-0000cf30: 7277 6172 6428 7365 6c66 2c20 783a 2053  rward(self, x: S
-0000cf40: 6571 7565 6e63 6529 202d 3e20 5475 706c  equence) -> Tupl
-0000cf50: 655b 746f 7263 682e 5465 6e73 6f72 2c20  e[torch.Tensor, 
-0000cf60: 746f 7263 682e 5465 6e73 6f72 5d3a 0a20  torch.Tensor]:. 
-0000cf70: 2020 2020 2020 2022 2222 5065 7266 6f72         """Perfor
-0000cf80: 6d73 2061 2074 7261 6e73 666f 726d 6174  ms a transformat
-0000cf90: 696f 6e20 6265 7477 6565 6e20 7477 6f20  ion between two 
-0000cfa0: 6469 6666 6572 656e 7420 6469 7374 7269  different distri
-0000cfb0: 6275 7469 6f6e 732e 2054 6869 730a 2020  butions. This.  
-0000cfc0: 2020 2020 2020 7061 7274 6963 756c 6172        particular
-0000cfd0: 2074 7261 6e73 666f 726d 6174 696f 6e20   transformation 
-0000cfe0: 7265 7072 6573 656e 7473 2074 6865 2066  represents the f
-0000cff0: 6f6c 6c6f 7769 6e67 2066 756e 6374 696f  ollowing functio
-0000d000: 6e3a 0a20 2020 2020 2020 2079 203d 2078  n:.        y = x
-0000d010: 202a 2065 7870 2861 2920 2b20 622c 2077   * exp(a) + b, w
-0000d020: 6865 7265 2061 2069 7320 7363 616c 6520  here a is scale 
-0000d030: 7061 7261 6d65 7465 7220 616e 6420 6220  parameter and b 
-0000d040: 7065 7266 6f72 6d73 2061 2073 6869 6674  performs a shift
-0000d050: 2e0a 2020 2020 2020 2020 5468 6973 2063  ..        This c
-0000d060: 6c61 7373 2061 6c73 6f20 7265 7475 726e  lass also return
-0000d070: 7320 7468 6520 6c6f 6761 7269 7468 6d20  s the logarithm 
-0000d080: 6f66 2074 6865 206a 6163 6f62 6961 6e73  of the jacobians
-0000d090: 2064 6574 6572 6d69 6e61 6e74 0a20 2020   determinant.   
-0000d0a0: 2020 2020 2077 6869 6368 2069 7320 7573       which is us
-0000d0b0: 6566 756c 2077 6865 6e20 696e 7665 7274  eful when invert
-0000d0c0: 2061 2074 7261 6e73 666f 726d 6174 696f   a transformatio
-0000d0d0: 6e20 616e 6420 636f 6d70 7574 6520 7468  n and compute th
-0000d0e0: 650a 2020 2020 2020 2020 7072 6f62 6162  e.        probab
-0000d0f0: 696c 6974 7920 6f66 2074 6865 2074 7261  ility of the tra
-0000d100: 6e73 666f 726d 6174 696f 6e2e 0a0a 2020  nsformation...  
-0000d110: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-0000d120: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-0000d130: 2d2d 2d0a 2020 2020 2020 2020 7820 3a20  ---.        x : 
-0000d140: 5365 7175 656e 6365 0a20 2020 2020 2020  Sequence.       
-0000d150: 2020 2020 2054 656e 736f 7220 7361 6d70       Tensor samp
-0000d160: 6c65 2077 6974 6820 7468 6520 696e 6974  le with the init
-0000d170: 6961 6c20 6469 7374 7269 6275 7469 6f6e  ial distribution
-0000d180: 2064 6174 6120 7768 6963 6820 7769 6c6c   data which will
-0000d190: 2070 6173 7320 696e 746f 0a20 2020 2020   pass into.     
-0000d1a0: 2020 2020 2020 2074 6865 206e 6f72 6d61         the norma
-0000d1b0: 6c69 7a69 6e67 2066 6c6f 7720 616c 676f  lizing flow algo
-0000d1c0: 7269 7468 6d2e 0a0a 2020 2020 2020 2020  rithm...        
-0000d1d0: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
-0000d1e0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-0000d1f0: 7920 3a20 746f 7263 682e 5465 6e73 6f72  y : torch.Tensor
-0000d200: 0a20 2020 2020 2020 2020 2020 2054 7261  .            Tra
-0000d210: 6e73 666f 726d 6564 2074 656e 736f 7220  nsformed tensor 
-0000d220: 6163 636f 7264 696e 6720 746f 2041 6666  according to Aff
-0000d230: 696e 6520 6c61 7965 7220 7769 7468 2074  ine layer with t
-0000d240: 6865 2073 6861 7065 206f 6620 2778 272e  he shape of 'x'.
-0000d250: 0a20 2020 2020 2020 206c 6f67 5f64 6574  .        log_det
-0000d260: 5f6a 6163 6f62 6961 6e20 3a20 746f 7263  _jacobian : torc
-0000d270: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
-0000d280: 2020 2020 2054 656e 736f 7220 7768 6963       Tensor whic
-0000d290: 6820 7265 7072 6573 656e 7473 2074 6865  h represents the
-0000d2a0: 2069 6e66 6f20 6162 6f75 7420 7468 6520   info about the 
-0000d2b0: 6465 7669 6174 696f 6e20 6f66 2074 6865  deviation of the
-0000d2c0: 2069 6e69 7469 616c 0a20 2020 2020 2020   initial.       
-0000d2d0: 2020 2020 2061 6e64 2074 6172 6765 7420       and target 
-0000d2e0: 6469 7374 7269 6275 7469 6f6e 2e0a 0a20  distribution... 
-0000d2f0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-0000d300: 2020 2020 7920 3d20 746f 7263 682e 6578      y = torch.ex
-0000d310: 7028 7365 6c66 2e73 6361 6c65 2920 2a20  p(self.scale) * 
-0000d320: 7820 2b20 7365 6c66 2e73 6869 6674 0a20  x + self.shift. 
-0000d330: 2020 2020 2020 2064 6574 5f6a 6163 6f62         det_jacob
-0000d340: 6961 6e20 3d20 746f 7263 682e 6578 7028  ian = torch.exp(
-0000d350: 7365 6c66 2e73 6361 6c65 2e73 756d 2829  self.scale.sum()
-0000d360: 290a 2020 2020 2020 2020 6c6f 675f 6465  ).        log_de
-0000d370: 745f 6a61 636f 6269 616e 203d 2074 6f72  t_jacobian = tor
-0000d380: 6368 2e6f 6e65 7328 792e 7368 6170 655b  ch.ones(y.shape[
-0000d390: 305d 2920 2a20 746f 7263 682e 6c6f 6728  0]) * torch.log(
-0000d3a0: 6465 745f 6a61 636f 6269 616e 290a 0a20  det_jacobian).. 
-0000d3b0: 2020 2020 2020 2072 6574 7572 6e20 792c         return y,
-0000d3c0: 206c 6f67 5f64 6574 5f6a 6163 6f62 6961   log_det_jacobia
-0000d3d0: 6e0a 0a20 2020 2064 6566 2069 6e76 6572  n..    def inver
-0000d3e0: 7365 2873 656c 662c 2079 3a20 5365 7175  se(self, y: Sequ
-0000d3f0: 656e 6365 2920 2d3e 2054 7570 6c65 5b74  ence) -> Tuple[t
-0000d400: 6f72 6368 2e54 656e 736f 722c 2074 6f72  orch.Tensor, tor
-0000d410: 6368 2e54 656e 736f 725d 3a0a 2020 2020  ch.Tensor]:.    
-0000d420: 2020 2020 2222 2250 6572 666f 726d 7320      """Performs 
-0000d430: 6120 7472 616e 7366 6f72 6d61 7469 6f6e  a transformation
-0000d440: 2062 6574 7765 656e 2074 776f 2064 6966   between two dif
-0000d450: 6665 7265 6e74 2064 6973 7472 6962 7574  ferent distribut
-0000d460: 696f 6e73 2e0a 2020 2020 2020 2020 5468  ions..        Th
-0000d470: 6973 2074 7261 6e73 666f 726d 6174 696f  is transformatio
-0000d480: 6e20 7265 7072 6573 656e 7473 2074 6865  n represents the
-0000d490: 2062 6163 7761 7264 2070 6173 7320 6f66   bacward pass of
-0000d4a0: 2074 6865 2066 756e 6374 696f 6e0a 2020   the function.  
-0000d4b0: 2020 2020 2020 6d65 6e74 696f 6e20 6265        mention be
-0000d4c0: 666f 7265 2e20 4974 7320 6d61 7468 656d  fore. Its mathem
-0000d4d0: 6174 6963 616c 2072 6570 7265 7365 6e74  atical represent
-0000d4e0: 6174 696f 6e20 6973 2078 203d 2028 7920  ation is x = (y 
-0000d4f0: 2d20 6229 202f 2065 7870 2861 290a 2020  - b) / exp(a).  
-0000d500: 2020 2020 2020 2c20 7768 6572 6520 2261        , where "a
-0000d510: 2220 6973 2073 6361 6c65 2070 6172 616d  " is scale param
-0000d520: 6574 6572 2061 6e64 2022 6222 2070 6572  eter and "b" per
-0000d530: 666f 726d 7320 6120 7368 6966 742e 2054  forms a shift. T
-0000d540: 6869 7320 636c 6173 730a 2020 2020 2020  his class.      
-0000d550: 2020 616c 736f 2072 6574 7572 6e73 2074    also returns t
-0000d560: 6865 206c 6f67 6172 6974 686d 206f 6620  he logarithm of 
-0000d570: 7468 6520 6a61 636f 6269 616e 7320 6465  the jacobians de
-0000d580: 7465 726d 696e 616e 7420 7768 6963 6820  terminant which 
-0000d590: 6973 0a20 2020 2020 2020 2075 7365 6675  is.        usefu
-0000d5a0: 6c20 7768 656e 2069 6e76 6572 7420 6120  l when invert a 
-0000d5b0: 7472 616e 7366 6f72 6d61 7469 6f6e 2061  transformation a
-0000d5c0: 6e64 2063 6f6d 7075 7465 2074 6865 2070  nd compute the p
-0000d5d0: 726f 6261 6269 6c69 7479 206f 660a 2020  robability of.  
-0000d5e0: 2020 2020 2020 7468 6520 7472 616e 7366        the transf
-0000d5f0: 6f72 6d61 7469 6f6e 2e0a 0a20 2020 2020  ormation...     
-0000d600: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-0000d610: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-0000d620: 0a20 2020 2020 2020 2079 203a 2053 6571  .        y : Seq
-0000d630: 7565 6e63 650a 2020 2020 2020 2020 2020  uence.          
-0000d640: 2020 5465 6e73 6f72 2073 616d 706c 6520    Tensor sample 
-0000d650: 7769 7468 2074 7261 6e73 666f 726d 6564  with transformed
-0000d660: 2064 6973 7472 6962 7574 696f 6e20 6461   distribution da
-0000d670: 7461 2077 6869 6368 2077 696c 6c20 6265  ta which will be
-0000d680: 2075 7365 6420 696e 0a20 2020 2020 2020   used in.       
-0000d690: 2020 2020 2074 6865 206e 6f72 6d61 6c69       the normali
-0000d6a0: 7a69 6e67 2061 6c67 6f72 6974 686d 2069  zing algorithm i
-0000d6b0: 6e76 6572 7365 2070 6173 732e 0a0a 2020  nverse pass...  
-0000d6c0: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
-0000d6d0: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
-0000d6e0: 2020 2020 2020 7820 3a20 746f 7263 682e        x : torch.
-0000d6f0: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
-0000d700: 2020 2054 7261 6e73 666f 726d 6564 2074     Transformed t
-0000d710: 656e 736f 7220 6163 636f 7264 696e 6720  ensor according 
-0000d720: 746f 2041 6666 696e 6520 6c61 7965 7220  to Affine layer 
-0000d730: 7769 7468 2074 6865 2073 6861 7065 206f  with the shape o
-0000d740: 6620 2779 272e 0a20 2020 2020 2020 2069  f 'y'..        i
-0000d750: 6e76 6572 7365 5f6c 6f67 5f64 6574 5f6a  nverse_log_det_j
-0000d760: 6163 6f62 6961 6e20 3a20 746f 7263 682e  acobian : torch.
-0000d770: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
-0000d780: 2020 2054 656e 736f 7220 7768 6963 6820     Tensor which 
-0000d790: 7265 7072 6573 656e 7473 2074 6865 2069  represents the i
-0000d7a0: 6e66 6f72 6d61 7469 6f6e 206f 6620 7468  nformation of th
-0000d7b0: 6520 6465 7669 6174 696f 6e20 6f66 2074  e deviation of t
-0000d7c0: 6865 2069 6e69 7469 616c 0a20 2020 2020  he initial.     
-0000d7d0: 2020 2020 2020 2061 6e64 2074 6172 6765         and targe
-0000d7e0: 7420 6469 7374 7269 6275 7469 6f6e 2e0a  t distribution..
-0000d7f0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-0000d800: 2020 2020 2020 7820 3d20 2879 202d 2073        x = (y - s
-0000d810: 656c 662e 7368 6966 7429 202f 2074 6f72  elf.shift) / tor
-0000d820: 6368 2e65 7870 2873 656c 662e 7363 616c  ch.exp(self.scal
-0000d830: 6529 0a20 2020 2020 2020 2064 6574 5f6a  e).        det_j
-0000d840: 6163 6f62 6961 6e20 3d20 3120 2f20 746f  acobian = 1 / to
-0000d850: 7263 682e 6578 7028 7365 6c66 2e73 6361  rch.exp(self.sca
-0000d860: 6c65 2e73 756d 2829 290a 2020 2020 2020  le.sum()).      
-0000d870: 2020 696e 7665 7273 655f 6c6f 675f 6465    inverse_log_de
-0000d880: 745f 6a61 636f 6269 616e 203d 2074 6f72  t_jacobian = tor
-0000d890: 6368 2e6f 6e65 7328 0a20 2020 2020 2020  ch.ones(.       
-0000d8a0: 2020 2020 2078 2e73 6861 7065 5b30 5d29       x.shape[0])
-0000d8b0: 202a 2074 6f72 6368 2e6c 6f67 2864 6574   * torch.log(det
-0000d8c0: 5f6a 6163 6f62 6961 6e29 0a0a 2020 2020  _jacobian)..    
-0000d8d0: 2020 2020 7265 7475 726e 2078 2c20 696e      return x, in
-0000d8e0: 7665 7273 655f 6c6f 675f 6465 745f 6a61  verse_log_det_ja
-0000d8f0: 636f 6269 616e 0a0a 0a63 6c61 7373 2044  cobian...class D
-0000d900: 4d50 4e4e 456e 636f 6465 724c 6179 6572  MPNNEncoderLayer
-0000d910: 286e 6e2e 4d6f 6475 6c65 293a 0a20 2020  (nn.Module):.   
-0000d920: 2022 2222 0a20 2020 2045 6e63 6f64 6572   """.    Encoder
-0000d930: 206c 6179 6572 2066 6f72 2075 7365 2069   layer for use i
-0000d940: 6e20 7468 6520 4469 7265 6374 6564 204d  n the Directed M
-0000d950: 6573 7361 6765 2050 6173 7369 6e67 204e  essage Passing N
-0000d960: 6575 7261 6c20 4e65 7477 6f72 6b20 2844  eural Network (D
-0000d970: 2d4d 504e 4e29 205b 315d 5f2e 0a0a 2020  -MPNN) [1]_...  
-0000d980: 2020 5468 6520 726f 6c65 206f 6620 7468    The role of th
-0000d990: 6520 444d 504e 4e45 6e63 6f64 6572 4c61  e DMPNNEncoderLa
-0000d9a0: 7965 7220 636c 6173 7320 6973 2074 6f20  yer class is to 
-0000d9b0: 6765 6e65 7261 7465 206d 6f6c 6563 756c  generate molecul
-0000d9c0: 6520 656e 636f 6469 6e67 7320 696e 2066  e encodings in f
-0000d9d0: 6f6c 6c6f 7769 6e67 2073 7465 7073 3a0a  ollowing steps:.
-0000d9e0: 0a20 2020 202d 204d 6573 7361 6765 2070  .    - Message p
-0000d9f0: 6173 7369 6e67 2070 6861 7365 0a20 2020  assing phase.   
-0000da00: 202d 2047 6574 206e 6577 2061 746f 6d20   - Get new atom 
-0000da10: 6869 6464 656e 2073 7461 7465 7320 616e  hidden states an
-0000da20: 6420 7265 6164 6f75 7420 7068 6173 650a  d readout phase.
-0000da30: 2020 2020 2d20 436f 6e63 6174 656e 6174      - Concatenat
-0000da40: 6520 7468 6520 676c 6f62 616c 2066 6561  e the global fea
-0000da50: 7475 7265 730a 0a0a 2020 2020 4c65 7420  tures...    Let 
-0000da60: 7468 6520 6469 6167 7261 6d20 6769 7665  the diagram give
-0000da70: 6e20 6265 6c6f 7720 7265 7072 6573 656e  n below represen
-0000da80: 7420 6120 6d6f 6c65 6375 6c65 2063 6f6e  t a molecule con
-0000da90: 7461 696e 696e 6720 3520 6174 6f6d 7320  taining 5 atoms 
-0000daa0: 286e 6f64 6573 2920 616e 6420 3420 626f  (nodes) and 4 bo
-0000dab0: 6e64 7320 2865 6467 6573 293a 2d0a 0a20  nds (edges):-.. 
-0000dac0: 2020 207c 2020 2031 202d 2d2d 2035 0a20     |   1 --- 5. 
-0000dad0: 2020 207c 2020 207c 0a20 2020 207c 2020     |   |.    |  
-0000dae0: 2032 202d 2d2d 2034 0a20 2020 207c 2020   2 --- 4.    |  
-0000daf0: 207c 0a20 2020 207c 2020 2033 0a0a 2020   |.    |   3..  
-0000db00: 2020 4c65 7420 7468 6520 626f 6e64 7320    Let the bonds 
-0000db10: 6672 6f6d 2061 746f 6d73 2031 2d3e 3220  from atoms 1->2 
-0000db20: 282a 2a42 5b31 325d 2a2a 2920 616e 6420  (**B[12]**) and 
-0000db30: 322d 3e31 2028 2a2a 425b 3231 5d2a 2a29  2->1 (**B[21]**)
-0000db40: 2062 6520 636f 6e73 6964 6572 6564 2061   be considered a
-0000db50: 7320 3220 6469 6666 6572 656e 7420 626f  s 2 different bo
-0000db60: 6e64 732e 0a20 2020 2048 656e 6365 2c20  nds..    Hence, 
-0000db70: 6279 2063 6f6e 7369 6465 7269 6e67 2074  by considering t
-0000db80: 6865 2073 616d 6520 666f 7220 616c 6c20  he same for all 
-0000db90: 6174 6f6d 732c 2074 6865 2074 6f74 616c  atoms, the total
-0000dba0: 206e 756d 6265 7220 6f66 2062 6f6e 6473   number of bonds
-0000dbb0: 203d 2038 2e0a 0a20 2020 204c 6574 3a0a   = 8...    Let:.
-0000dbc0: 0a20 2020 202d 202a 2a61 746f 6d20 6665  .    - **atom fe
-0000dbd0: 6174 7572 6573 2a2a 203a 2060 6061 312c  atures** : ``a1,
-0000dbe0: 2061 322c 2061 332c 2061 342c 2061 3560   a2, a3, a4, a5`
-0000dbf0: 600a 2020 2020 2d20 2a2a 6869 6464 656e  `.    - **hidden
-0000dc00: 2073 7461 7465 7320 6f66 2061 746f 6d73   states of atoms
-0000dc10: 2a2a 203a 2060 6068 312c 2068 322c 2068  ** : ``h1, h2, h
-0000dc20: 332c 2068 342c 2068 3560 600a 2020 2020  3, h4, h5``.    
-0000dc30: 2d20 2a2a 626f 6e64 2066 6561 7475 7265  - **bond feature
-0000dc40: 7320 626f 6e64 732a 2a20 3a20 6060 6231  s bonds** : ``b1
-0000dc50: 322c 2062 3231 2c20 6232 332c 2062 3332  2, b21, b23, b32
-0000dc60: 2c20 6232 342c 2062 3432 2c20 6231 352c  , b24, b42, b15,
-0000dc70: 2062 3531 6060 0a20 2020 202d 202a 2a69   b51``.    - **i
-0000dc80: 6e69 7469 616c 2068 6964 6465 6e20 7374  nitial hidden st
-0000dc90: 6174 6573 206f 6620 626f 6e64 732a 2a20  ates of bonds** 
-0000dca0: 3a20 6060 2830 2968 3132 2c20 2830 2968  : ``(0)h12, (0)h
-0000dcb0: 3231 2c20 2830 2968 3233 2c20 2830 2968  21, (0)h23, (0)h
-0000dcc0: 3332 2c20 2830 2968 3234 2c20 2830 2968  32, (0)h24, (0)h
-0000dcd0: 3432 2c20 2830 2968 3135 2c20 2830 2968  42, (0)h15, (0)h
-0000dce0: 3531 6060 0a0a 2020 2020 5468 6520 6869  51``..    The hi
-0000dcf0: 6464 656e 2073 7461 7465 206f 6620 6576  dden state of ev
-0000dd00: 6572 7920 626f 6e64 2069 7320 6120 6675  ery bond is a fu
-0000dd10: 6e63 7469 6f6e 206f 6620 7468 6520 636f  nction of the co
-0000dd20: 6e63 6174 656e 6174 6564 2066 6561 7475  ncatenated featu
-0000dd30: 7265 2076 6563 746f 7220 7768 6963 6820  re vector which 
-0000dd40: 636f 6e74 6169 6e73 0a20 2020 2063 6f6e  contains.    con
-0000dd50: 6361 7465 6e61 7469 6f6e 206f 6620 7468  catenation of th
-0000dd60: 6520 2a2a 6665 6174 7572 6573 206f 6620  e **features of 
-0000dd70: 696e 6974 6961 6c20 6174 6f6d 206f 6620  initial atom of 
-0000dd80: 7468 6520 626f 6e64 2a2a 2061 6e64 202a  the bond** and *
-0000dd90: 2a62 6f6e 6420 6665 6174 7572 6573 2a2a  *bond features**
-0000dda0: 2e0a 0a20 2020 2045 7861 6d70 6c65 3a20  ...    Example: 
-0000ddb0: 6060 2830 2968 3231 203d 2066 756e 6331  ``(0)h21 = func1
-0000ddc0: 2863 6f6e 6361 7428 6132 2c20 6232 3129  (concat(a2, b21)
-0000ddd0: 2960 600a 0a20 2020 202e 2e20 6e6f 7465  )``..    .. note
-0000dde0: 3a3a 0a20 2020 2020 4865 7265 2066 756e  ::.     Here fun
-0000ddf0: 6331 2069 7320 6060 7365 6c66 2e57 5f69  c1 is ``self.W_i
-0000de00: 6060 0a0a 2020 2020 2a2a 5468 6520 4d65  ``..    **The Me
-0000de10: 7373 6167 6520 7061 7373 696e 6720 7068  ssage passing ph
-0000de20: 6173 652a 2a0a 0a20 2020 2054 6865 2067  ase**..    The g
-0000de30: 6f61 6c20 6f66 2074 6865 206d 6573 7361  oal of the messa
-0000de40: 6765 2d70 6173 7369 6e67 2070 6861 7365  ge-passing phase
-0000de50: 2069 7320 746f 2067 656e 6572 6174 6520   is to generate 
-0000de60: 2a2a 6869 6464 656e 2073 7461 7465 7320  **hidden states 
-0000de70: 6f66 2061 6c6c 2074 6865 2061 746f 6d73  of all the atoms
-0000de80: 2069 6e20 7468 6520 6d6f 6c65 6375 6c65   in the molecule
-0000de90: 2a2a 2e0a 0a20 2020 2054 6865 2068 6964  **...    The hid
-0000dea0: 6465 6e20 7374 6174 6520 6f66 2061 6e20  den state of an 
-0000deb0: 6174 6f6d 2069 7320 2a2a 6120 6675 6e63  atom is **a func
-0000dec0: 7469 6f6e 206f 6620 636f 6e63 6174 656e  tion of concaten
-0000ded0: 6174 696f 6e20 6f66 2061 746f 6d20 6665  ation of atom fe
-0000dee0: 6174 7572 6573 2061 6e64 206d 6573 7361  atures and messa
-0000def0: 6765 7320 2861 7420 5420 6465 7074 6829  ges (at T depth)
-0000df00: 2a2a 2e0a 0a20 2020 2041 206d 6573 7361  **...    A messa
-0000df10: 6765 2069 7320 6120 7375 6d20 6f66 202a  ge is a sum of *
-0000df20: 2a68 6964 6465 6e20 7374 6174 6573 206f  *hidden states o
-0000df30: 6620 626f 6e64 7320 636f 6d69 6e67 2074  f bonds coming t
-0000df40: 6f20 7468 6520 6174 6f6d 2028 6174 2054  o the atom (at T
-0000df50: 2064 6570 7468 292a 2a2e 0a0a 2020 2020   depth)**...    
-0000df60: 2e2e 206e 6f74 653a 3a0a 2020 2020 2044  .. note::.     D
-0000df70: 6570 7468 2072 6566 6572 7320 746f 2074  epth refers to t
-0000df80: 6865 206e 756d 6265 7220 6f66 2069 7465  he number of ite
-0000df90: 7261 7469 6f6e 7320 696e 2074 6865 206d  rations in the m
-0000dfa0: 6573 7361 6765 2070 6173 7369 6e67 2070  essage passing p
-0000dfb0: 6861 7365 2028 6865 7265 2c20 5420 6974  hase (here, T it
-0000dfc0: 6572 6174 696f 6e73 292e 2041 6674 6572  erations). After
-0000dfd0: 2065 6163 6820 6974 6572 6174 696f 6e2c   each iteration,
-0000dfe0: 2074 6865 2068 6964 6465 6e20 7374 6174   the hidden stat
-0000dff0: 6573 206f 6620 7468 6520 626f 6e64 7320  es of the bonds 
-0000e000: 6172 6520 7570 6461 7465 642e 0a0a 0a20  are updated.... 
-0000e010: 2020 2045 7861 6d70 6c65 3a0a 2020 2020     Example:.    
-0000e020: 6060 6831 203d 2066 756e 6333 2863 6f6e  ``h1 = func3(con
-0000e030: 6361 7428 6131 2c20 6d31 2929 6060 0a0a  cat(a1, m1))``..
-0000e040: 2020 2020 2e2e 206e 6f74 653a 3a0a 2020      .. note::.  
-0000e050: 2020 2048 6572 6520 6675 6e63 3320 6973     Here func3 is
-0000e060: 2060 6073 656c 662e 575f 6f60 602e 0a0a   ``self.W_o``...
-0000e070: 2020 2020 2060 6d31 6020 7265 6665 7273       `m1` refers
-0000e080: 2074 6f20 7468 6520 6d65 7373 6167 6520   to the message 
-0000e090: 636f 6d69 6e67 2074 6f20 7468 6520 6174  coming to the at
-0000e0a0: 6f6d 2e0a 0a20 2020 2060 606d 3120 3d20  om...    ``m1 = 
-0000e0b0: 2854 2d31 2968 3231 202b 2028 542d 3129  (T-1)h21 + (T-1)
-0000e0c0: 6835 3160 600a 2020 2020 2868 6964 6465  h51``.    (hidde
-0000e0d0: 6e20 7374 6174 6520 6f66 2062 6f6e 6420  n state of bond 
-0000e0e0: 322d 3e31 202b 2068 6964 6465 6e20 7374  2->1 + hidden st
-0000e0f0: 6174 6520 6f66 2062 6f6e 6420 352d 3e31  ate of bond 5->1
-0000e100: 2920 2861 7420 5420 6465 7074 6829 0a0a  ) (at T depth)..
-0000e110: 2020 2020 666f 722c 2064 6570 7468 2054      for, depth T
-0000e120: 203d 2032 3a0a 0a20 2020 202d 2074 6865   = 2:..    - the
-0000e130: 2068 6964 6465 6e20 7374 6174 6573 206f   hidden states o
-0000e140: 6620 7468 6520 626f 6e64 7320 4020 3173  f the bonds @ 1s
-0000e150: 7420 6974 6572 6174 696f 6e20 7769 6c6c  t iteration will
-0000e160: 2062 6520 3d3e 2028 3029 6832 312c 2028   be => (0)h21, (
-0000e170: 3029 6835 310a 2020 2020 2d20 7468 6520  0)h51.    - the 
-0000e180: 6869 6464 656e 2073 7461 7465 7320 6f66  hidden states of
-0000e190: 2074 6865 2062 6f6e 6473 2040 2032 6e64   the bonds @ 2nd
-0000e1a0: 2069 7465 7261 7469 6f6e 2077 696c 6c20   iteration will 
-0000e1b0: 6265 203d 3e20 2831 2968 3231 2c20 2831  be => (1)h21, (1
-0000e1c0: 2968 3531 0a0a 2020 2020 5468 6520 6869  )h51..    The hi
-0000e1d0: 6464 656e 2073 7461 7465 7320 6f66 2074  dden states of t
-0000e1e0: 6865 2062 6f6e 6473 2069 6e20 3173 7420  he bonds in 1st 
-0000e1f0: 6974 6572 6174 696f 6e20 6172 6520 616c  iteration are al
-0000e200: 7265 6164 7920 6b6e 6f77 2e0a 2020 2020  ready know..    
-0000e210: 466f 7220 6869 6464 656e 2073 7461 7465  For hidden state
-0000e220: 7320 6f66 2074 6865 2062 6f6e 6473 2069  s of the bonds i
-0000e230: 6e20 326e 6420 6974 6572 6174 696f 6e2c  n 2nd iteration,
-0000e240: 2077 6520 666f 6c6c 6f77 2074 6865 2063   we follow the c
-0000e250: 7269 7465 7269 6f6e 2074 6861 743a 0a0a  riterion that:..
-0000e260: 2020 2020 2d20 6869 6464 656e 2073 7461      - hidden sta
-0000e270: 7465 206f 6620 7468 6520 626f 6e64 2069  te of the bond i
-0000e280: 7320 6120 6675 6e63 7469 6f6e 206f 6620  s a function of 
-0000e290: 2a2a 696e 6974 6961 6c20 6869 6464 656e  **initial hidden
-0000e2a0: 2073 7461 7465 206f 6620 626f 6e64 2a2a   state of bond**
-0000e2b0: 0a20 2020 2061 6e64 202a 2a6d 6573 7361  .    and **messa
-0000e2c0: 6765 7320 636f 6d69 6e67 2074 6f20 7468  ges coming to th
-0000e2d0: 6174 2062 6f6e 6420 696e 2074 6861 7420  at bond in that 
-0000e2e0: 6974 6572 6174 696f 6e2a 2a0a 0a20 2020  iteration**..   
-0000e2f0: 2045 7861 6d70 6c65 3a0a 2020 2020 6060   Example:.    ``
-0000e300: 2831 2968 3231 203d 2066 756e 6332 2820  (1)h21 = func2( 
-0000e310: 2830 2968 3231 202c 2028 3129 6d32 3120  (0)h21 , (1)m21 
-0000e320: 2960 600a 0a20 2020 202e 2e20 6e6f 7465  )``..    .. note
-0000e330: 3a3a 0a20 2020 2020 4865 7265 2066 756e  ::.     Here fun
-0000e340: 6332 2069 7320 6060 7365 6c66 2e57 5f68  c2 is ``self.W_h
-0000e350: 6060 2e0a 0a20 2020 2020 6028 3129 6d32  ``...     `(1)m2
-0000e360: 3160 2072 6566 6572 7320 746f 2074 6865  1` refers to the
-0000e370: 206d 6573 7361 6765 7320 636f 6d69 6e67   messages coming
-0000e380: 2074 6f20 7468 6174 2062 6f6e 6420 322d   to that bond 2-
-0000e390: 3e31 2069 6e20 7468 6174 2032 6e64 2069  >1 in that 2nd i
-0000e3a0: 7465 7261 7469 6f6e 2e0a 0a20 2020 204d  teration...    M
-0000e3b0: 6573 7361 6765 7320 636f 6d69 6e67 2074  essages coming t
-0000e3c0: 6f20 6120 626f 6e64 2069 6e20 616e 2069  o a bond in an i
-0000e3d0: 7465 7261 7469 6f6e 2069 7320 2a2a 6120  teration is **a 
-0000e3e0: 7375 6d20 6f66 2068 6964 6465 6e20 7374  sum of hidden st
-0000e3f0: 6174 6573 206f 6620 626f 6e64 7320 2866  ates of bonds (f
-0000e400: 726f 6d20 7072 6576 696f 7573 2069 7465  rom previous ite
-0000e410: 7261 7469 6f6e 2920 636f 6d69 6e67 2074  ration) coming t
-0000e420: 6f20 7468 6973 2062 6f6e 642a 2a2e 0a0a  o this bond**...
-0000e430: 2020 2020 4578 616d 706c 653a 0a20 2020      Example:.   
-0000e440: 2060 6028 3129 6d32 3120 3d20 2830 2968   ``(1)m21 = (0)h
-0000e450: 3332 202b 2028 3029 6834 3260 600a 0a20  32 + (0)h42``.. 
-0000e460: 2020 207c 2020 2032 203c 2d2d 2d20 330a     |   2 <--- 3.
-0000e470: 2020 2020 7c20 2020 5e0a 2020 2020 7c20      |   ^.    | 
-0000e480: 2020 7c0a 2020 2020 7c20 2020 340a 0a20    |.    |   4.. 
-0000e490: 2020 202a 2a43 6f6d 7075 7469 6e67 2074     **Computing t
-0000e4a0: 6865 206d 6573 7361 6765 732a 2a0a 0a20  he messages**.. 
-0000e4b0: 2020 202e 2e20 636f 6465 2d62 6c6f 636b     .. code-block
-0000e4c0: 3a3a 2070 7974 686f 6e0a 0a20 2020 2020  :: python..     
-0000e4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e4e0: 2020 2020 2020 2020 4230 2020 2020 2020          B0      
-0000e4f0: 4231 2020 2020 2020 4232 2020 2020 2020  B1      B2      
-0000e500: 4233 2020 2020 2020 4234 2020 2020 2020  B3      B4      
-0000e510: 4235 2020 2020 2020 4236 2020 2020 2020  B5      B6      
-0000e520: 4237 2020 2020 2020 4238 0a20 2020 2020  B7      B8.     
-0000e530: 2020 2066 5f69 6e69 5f61 746f 6d73 5f62     f_ini_atoms_b
-0000e540: 6f6e 6473 203d 205b 2830 2968 3132 2c20  onds = [(0)h12, 
-0000e550: 2830 2968 3231 2c20 2830 2968 3233 2c20  (0)h21, (0)h23, 
-0000e560: 2830 2968 3332 2c20 2830 2968 3234 2c20  (0)h32, (0)h24, 
-0000e570: 2830 2968 3432 2c20 2830 2968 3135 2c20  (0)h42, (0)h15, 
-0000e580: 2830 2968 3531 2c20 6828 2d31 295d 0a0a  (0)h51, h(-1)]..
-0000e590: 0a20 2020 202e 2e20 6e6f 7465 3a3a 0a20  .    .. note::. 
-0000e5a0: 2020 2020 6828 2d31 2920 6973 2061 6e20      h(-1) is an 
-0000e5b0: 656d 7074 7920 6172 7261 7920 6f66 2074  empty array of t
-0000e5c0: 6865 2073 616d 6520 7369 7a65 2061 7320  he same size as 
-0000e5d0: 6f74 6865 7220 6869 6464 656e 2073 7461  other hidden sta
-0000e5e0: 7465 7320 6f66 2062 6f6e 6420 7374 6174  tes of bond stat
-0000e5f0: 6573 2e0a 0a20 2020 202e 2e20 636f 6465  es...    .. code
-0000e600: 2d62 6c6f 636b 3a3a 2070 7974 686f 6e0a  -block:: python.
-0000e610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e620: 2020 2020 2042 3020 2020 2020 2042 3120       B0      B1 
-0000e630: 2020 2020 2042 3220 2020 2020 2042 3320       B2      B3 
-0000e640: 2020 2020 2042 3420 2020 2020 2042 3520       B4      B5 
-0000e650: 2020 2020 2042 3620 2020 2020 2042 3720       B6      B7 
-0000e660: 2020 2020 2020 4238 0a20 2020 2020 2020        B8.       
-0000e670: 206d 6170 7069 6e67 203d 205b 205b 2d31   mapping = [ [-1
-0000e680: 2c42 375d 205b 4233 2c42 355d 205b 4230  ,B7] [B3,B5] [B0
-0000e690: 2c42 355d 205b 2d31 2c2d 315d 205b 4230  ,B5] [-1,-1] [B0
-0000e6a0: 2c42 335d 205b 2d31 2c2d 315d 205b 4231  ,B3] [-1,-1] [B1
-0000e6b0: 2c2d 315d 205b 2d31 2c2d 315d 2020 5b2d  ,-1] [-1,-1]  [-
-0000e6c0: 312c 2d31 5d20 5d0a 0a20 2020 204c 6174  1,-1] ]..    Lat
-0000e6d0: 6572 2c20 7468 6520 656e 636f 6465 7220  er, the encoder 
-0000e6e0: 7769 6c6c 206d 6170 2074 6865 2063 6f6e  will map the con
-0000e6f0: 6361 7465 6e61 7465 6420 6665 6174 7572  catenated featur
-0000e700: 6573 2066 726f 6d20 7468 6520 6060 665f  es from the ``f_
-0000e710: 696e 695f 6174 6f6d 735f 626f 6e64 7360  ini_atoms_bonds`
-0000e720: 600a 2020 2020 746f 2060 606d 6170 7069  `.    to ``mappi
-0000e730: 6e67 6060 2069 6e20 6561 6368 2069 7465  ng`` in each ite
-0000e740: 7261 7469 6f6e 2075 7074 6f20 5474 6820  ration upto Tth 
-0000e750: 6974 6572 6174 696f 6e2e 0a0a 2020 2020  iteration...    
-0000e760: 4e65 7874 2074 6865 2065 6e63 6f64 6572  Next the encoder
-0000e770: 2077 696c 6c20 7375 6d2d 7570 2074 6865   will sum-up the
-0000e780: 2063 6f6e 6361 7420 6665 6174 7572 6573   concat features
-0000e790: 2077 6974 6869 6e20 7361 6d65 2062 6f6e   within same bon
-0000e7a0: 6420 696e 6465 782e 0a0a 2020 2020 2e2e  d index...    ..
-0000e7b0: 2063 6f64 652d 626c 6f63 6b3a 3a20 7079   code-block:: py
-0000e7c0: 7468 6f6e 0a0a 2020 2020 2020 2020 2020  thon..          
-0000e7d0: 2020 2020 2020 2020 2020 2020 2020 2831                (1
-0000e7e0: 296d 3132 2020 2020 2020 2020 2020 2028  )m12           (
-0000e7f0: 3129 6d32 3120 2020 2020 2020 2020 2020  1)m21           
-0000e800: 2831 296d 3233 2020 2020 2020 2020 2020  (1)m23          
-0000e810: 2020 2020 2831 296d 3332 2020 2020 2020      (1)m32      
-0000e820: 2020 2020 2831 296d 3234 2020 2020 2020      (1)m24      
-0000e830: 2020 2020 2028 3129 6d34 3220 2020 2020       (1)m42     
-0000e840: 2020 2020 2020 2831 296d 3135 2020 2020        (1)m15    
-0000e850: 2020 2020 2020 2831 296d 3531 2020 2020        (1)m51    
-0000e860: 2020 2020 2020 2020 6d28 2d31 290a 2020          m(-1).  
-0000e870: 2020 2020 2020 6d65 7373 6167 6520 3d20        message = 
-0000e880: 5b20 5b68 282d 3129 202b 2028 3029 6835  [ [h(-1) + (0)h5
-0000e890: 315d 205b 2830 2968 3332 202b 2028 3029  1] [(0)h32 + (0)
-0000e8a0: 6834 325d 205b 2830 2968 3132 202b 2028  h42] [(0)h12 + (
-0000e8b0: 3029 6834 325d 205b 6828 2d31 2920 2b20  0)h42] [h(-1) + 
-0000e8c0: 6828 2d31 295d 205b 2830 2968 3132 202b  h(-1)] [(0)h12 +
-0000e8d0: 2028 3029 6833 325d 205b 6828 2d31 2920   (0)h32] [h(-1) 
-0000e8e0: 2b20 6828 2d31 295d 205b 2830 2968 3231  + h(-1)] [(0)h21
-0000e8f0: 202b 2068 282d 3129 5d20 5b68 282d 3129   + h(-1)] [h(-1)
-0000e900: 202b 2068 282d 3129 5d20 205b 6828 2d31   + h(-1)]  [h(-1
-0000e910: 2920 2b20 6828 2d31 295d 205d 0a0a 2020  ) + h(-1)] ]..  
-0000e920: 2020 4865 6e63 652c 2074 6869 7320 6973    Hence, this is
-0000e930: 2068 6f77 2065 6e63 6f64 6572 2063 616e   how encoder can
-0000e940: 2067 6574 206d 6573 7361 6765 7320 666f   get messages fo
-0000e950: 7220 6d65 7373 6167 652d 7061 7373 696e  r message-passin
-0000e960: 6720 7374 6570 732e 0a0a 2020 2020 2a2a  g steps...    **
-0000e970: 4765 7420 6e65 7720 6174 6f6d 2068 6964  Get new atom hid
-0000e980: 6465 6e20 7374 6174 6573 2061 6e64 2072  den states and r
-0000e990: 6561 646f 7574 2070 6861 7365 2a2a 0a0a  eadout phase**..
-0000e9a0: 2020 2020 4865 6e63 6520 6e6f 7720 666f      Hence now fo
-0000e9b0: 7220 6831 3a0a 0a20 2020 202e 2e20 636f  r h1:..    .. co
-0000e9c0: 6465 2d62 6c6f 636b 3a3a 2070 7974 686f  de-block:: pytho
-0000e9d0: 6e0a 0a20 2020 2020 2020 2068 3120 3d20  n..        h1 = 
-0000e9e0: 6675 6e63 3328 0a20 2020 2020 2020 2020  func3(.         
-0000e9f0: 2020 2020 2020 2020 2020 2063 6f6e 6361             conca
-0000ea00: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-0000ea10: 2020 2020 2020 2020 2020 2020 6131 2c0a              a1,.
-0000ea20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea30: 2020 2020 2020 2020 205b 0a20 2020 2020           [.     
-0000ea40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea50: 2020 2020 2020 2066 756e 6332 2820 2830         func2( (0
-0000ea60: 2968 3231 202c 2028 3029 6833 3220 2b20  )h21 , (0)h32 + 
-0000ea70: 2830 2968 3432 2029 202b 0a20 2020 2020  (0)h42 ) +.     
-0000ea80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea90: 2020 2020 2020 2066 756e 6332 2820 2830         func2( (0
-0000eaa0: 2968 3531 202c 2030 2020 2020 2020 2020  )h51 , 0        
-0000eab0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000eac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ead0: 2020 5d0a 2020 2020 2020 2020 2020 2020    ].            
-0000eae0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0000eaf0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000eb00: 0a0a 2020 2020 5369 6d69 6c61 726c 792c  ..    Similarly,
-0000eb10: 2068 322c 2068 332c 2068 3420 616e 6420   h2, h3, h4 and 
-0000eb20: 6835 2061 7265 2063 616c 6375 6c61 7465  h5 are calculate
-0000eb30: 642e 0a0a 2020 2020 4e65 7874 2c20 616c  d...    Next, al
-0000eb40: 6c20 6174 6f6d 2068 6964 6465 6e20 7374  l atom hidden st
-0000eb50: 6174 6573 2061 7265 2063 6f6e 6361 7465  ates are concate
-0000eb60: 6e61 7465 6420 746f 206d 616b 6520 6120  nated to make a 
-0000eb70: 6665 6174 7572 6520 7665 6374 6f72 206f  feature vector o
-0000eb80: 6620 7468 6520 6d6f 6c65 6375 6c65 3a0a  f the molecule:.
-0000eb90: 0a20 2020 2060 606d 6f6c 5f65 6e63 6f64  .    ``mol_encod
-0000eba0: 696e 6773 203d 205b 5b68 312c 2068 322c  ings = [[h1, h2,
-0000ebb0: 2068 332c 2068 342c 2068 355d 5d60 600a   h3, h4, h5]]``.
-0000ebc0: 0a20 2020 202a 2a43 6f6e 6361 7465 6e61  .    **Concatena
-0000ebd0: 7465 2074 6865 2067 6c6f 6261 6c20 6665  te the global fe
-0000ebe0: 6174 7572 6573 2a2a 0a0a 2020 2020 4c65  atures**..    Le
-0000ebf0: 742c 0a20 2020 2060 6067 6c6f 6261 6c5f  t,.    ``global_
-0000ec00: 6665 6174 7572 6573 203d 205b 5b67 6631  features = [[gf1
-0000ec10: 2c20 6766 322c 2067 6633 5d5d 6060 0a20  , gf2, gf3]]``. 
-0000ec20: 2020 2054 6869 7320 6172 7261 7920 636f     This array co
-0000ec30: 6e74 6169 6e73 206d 6f6c 6563 756c 6520  ntains molecule 
-0000ec40: 6c65 7665 6c20 6665 6174 7572 6573 2e20  level features. 
-0000ec50: 496e 2063 6173 6520 6f66 2074 6869 7320  In case of this 
-0000ec60: 6578 616d 706c 652c 2069 7420 636f 6e74  example, it cont
-0000ec70: 6169 6e73 2033 2067 6c6f 6261 6c20 6665  ains 3 global fe
-0000ec80: 6174 7572 6573 2e0a 0a20 2020 2048 656e  atures...    Hen
-0000ec90: 6365 2061 6674 6572 2063 6f6e 6361 7465  ce after concate
-0000eca0: 6e61 7469 6f6e 2c0a 0a20 2020 2060 606d  nation,..    ``m
-0000ecb0: 6f6c 5f65 6e63 6f64 696e 6773 203d 205b  ol_encodings = [
-0000ecc0: 5b68 312c 2068 322c 2068 332c 2068 342c  [h1, h2, h3, h4,
-0000ecd0: 2068 352c 2067 6631 2c20 6766 322c 2067   h5, gf1, gf2, g
-0000ece0: 6633 5d5d 6060 0a20 2020 2028 4669 6e61  f3]]``.    (Fina
-0000ecf0: 6c20 6f75 7470 7574 206f 6620 7468 6520  l output of the 
-0000ed00: 656e 636f 6465 7229 0a0a 2020 2020 5265  encoder)..    Re
-0000ed10: 6665 7265 6e63 6573 0a20 2020 202d 2d2d  ferences.    ---
-0000ed20: 2d2d 2d2d 2d2d 2d0a 2020 2020 2e2e 205b  -------.    .. [
-0000ed30: 315d 2041 6e61 6c79 7a69 6e67 204c 6561  1] Analyzing Lea
-0000ed40: 726e 6564 204d 6f6c 6563 756c 6172 2052  rned Molecular R
-0000ed50: 6570 7265 7365 6e74 6174 696f 6e73 2066  epresentations f
-0000ed60: 6f72 2050 726f 7065 7274 7920 5072 6564  or Property Pred
-0000ed70: 6963 7469 6f6e 2068 7474 7073 3a2f 2f61  iction https://a
-0000ed80: 7278 6976 2e6f 7267 2f70 6466 2f31 3930  rxiv.org/pdf/190
-0000ed90: 342e 3031 3536 312e 7064 660a 0a20 2020  4.01561.pdf..   
-0000eda0: 2045 7861 6d70 6c65 730a 2020 2020 2d2d   Examples.    --
-0000edb0: 2d2d 2d2d 2d2d 0a20 2020 203e 3e3e 2066  ------.    >>> f
-0000edc0: 726f 6d20 7264 6b69 7420 696d 706f 7274  rom rdkit import
-0000edd0: 2043 6865 6d0a 2020 2020 3e3e 3e20 696d   Chem.    >>> im
-0000ede0: 706f 7274 2074 6f72 6368 0a20 2020 203e  port torch.    >
-0000edf0: 3e3e 2069 6d70 6f72 7420 6465 6570 6368  >> import deepch
-0000ee00: 656d 2061 7320 6463 0a20 2020 203e 3e3e  em as dc.    >>>
-0000ee10: 2069 6e70 7574 5f73 6d69 6c65 203d 2022   input_smile = "
-0000ee20: 4343 220a 2020 2020 3e3e 3e20 6665 6174  CC".    >>> feat
-0000ee30: 203d 2064 632e 6665 6174 2e44 4d50 4e4e   = dc.feat.DMPNN
-0000ee40: 4665 6174 7572 697a 6572 2866 6561 7475  Featurizer(featu
-0000ee50: 7265 735f 6765 6e65 7261 746f 7273 3d5b  res_generators=[
-0000ee60: 276d 6f72 6761 6e27 5d29 0a20 2020 203e  'morgan']).    >
-0000ee70: 3e3e 2067 7261 7068 203d 2066 6561 742e  >> graph = feat.
-0000ee80: 6665 6174 7572 697a 6528 696e 7075 745f  featurize(input_
-0000ee90: 736d 696c 6529 0a20 2020 203e 3e3e 2066  smile).    >>> f
-0000eea0: 726f 6d20 6465 6570 6368 656d 2e6d 6f64  rom deepchem.mod
-0000eeb0: 656c 732e 746f 7263 685f 6d6f 6465 6c73  els.torch_models
-0000eec0: 2e64 6d70 6e6e 2069 6d70 6f72 7420 5f4d  .dmpnn import _M
-0000eed0: 6170 7065 7244 4d50 4e4e 0a20 2020 203e  apperDMPNN.    >
-0000eee0: 3e3e 206d 6170 7065 7220 3d20 5f4d 6170  >> mapper = _Map
-0000eef0: 7065 7244 4d50 4e4e 2867 7261 7068 5b30  perDMPNN(graph[0
-0000ef00: 5d29 0a20 2020 203e 3e3e 2061 746f 6d5f  ]).    >>> atom_
-0000ef10: 6665 6174 7572 6573 2c20 665f 696e 695f  features, f_ini_
-0000ef20: 6174 6f6d 735f 626f 6e64 732c 2061 746f  atoms_bonds, ato
-0000ef30: 6d5f 746f 5f69 6e63 6f6d 696e 675f 626f  m_to_incoming_bo
-0000ef40: 6e64 732c 206d 6170 7069 6e67 2c20 676c  nds, mapping, gl
-0000ef50: 6f62 616c 5f66 6561 7475 7265 7320 3d20  obal_features = 
-0000ef60: 6d61 7070 6572 2e76 616c 7565 730a 2020  mapper.values.  
-0000ef70: 2020 3e3e 3e20 6174 6f6d 5f66 6561 7475    >>> atom_featu
-0000ef80: 7265 7320 3d20 746f 7263 682e 6672 6f6d  res = torch.from
-0000ef90: 5f6e 756d 7079 2861 746f 6d5f 6665 6174  _numpy(atom_feat
-0000efa0: 7572 6573 292e 666c 6f61 7428 290a 2020  ures).float().  
-0000efb0: 2020 3e3e 3e20 665f 696e 695f 6174 6f6d    >>> f_ini_atom
-0000efc0: 735f 626f 6e64 7320 3d20 746f 7263 682e  s_bonds = torch.
-0000efd0: 6672 6f6d 5f6e 756d 7079 2866 5f69 6e69  from_numpy(f_ini
-0000efe0: 5f61 746f 6d73 5f62 6f6e 6473 292e 666c  _atoms_bonds).fl
-0000eff0: 6f61 7428 290a 2020 2020 3e3e 3e20 6174  oat().    >>> at
-0000f000: 6f6d 5f74 6f5f 696e 636f 6d69 6e67 5f62  om_to_incoming_b
-0000f010: 6f6e 6473 203d 2074 6f72 6368 2e66 726f  onds = torch.fro
-0000f020: 6d5f 6e75 6d70 7928 6174 6f6d 5f74 6f5f  m_numpy(atom_to_
-0000f030: 696e 636f 6d69 6e67 5f62 6f6e 6473 290a  incoming_bonds).
-0000f040: 2020 2020 3e3e 3e20 6d61 7070 696e 6720      >>> mapping 
-0000f050: 3d20 746f 7263 682e 6672 6f6d 5f6e 756d  = torch.from_num
-0000f060: 7079 286d 6170 7069 6e67 290a 2020 2020  py(mapping).    
-0000f070: 3e3e 3e20 676c 6f62 616c 5f66 6561 7475  >>> global_featu
-0000f080: 7265 7320 3d20 746f 7263 682e 6672 6f6d  res = torch.from
-0000f090: 5f6e 756d 7079 2867 6c6f 6261 6c5f 6665  _numpy(global_fe
-0000f0a0: 6174 7572 6573 292e 666c 6f61 7428 290a  atures).float().
-0000f0b0: 2020 2020 3e3e 3e20 6d6f 6c65 6375 6c65      >>> molecule
-0000f0c0: 735f 756e 6261 7463 685f 6b65 7920 3d20  s_unbatch_key = 
-0000f0d0: 6c65 6e28 6174 6f6d 5f66 6561 7475 7265  len(atom_feature
-0000f0e0: 7329 0a20 2020 203e 3e3e 206c 6179 6572  s).    >>> layer
-0000f0f0: 203d 2044 4d50 4e4e 456e 636f 6465 724c   = DMPNNEncoderL
-0000f100: 6179 6572 2864 5f68 6964 6465 6e3d 3229  ayer(d_hidden=2)
-0000f110: 0a20 2020 203e 3e3e 206f 7574 7075 7420  .    >>> output 
-0000f120: 3d20 6c61 7965 7228 6174 6f6d 5f66 6561  = layer(atom_fea
-0000f130: 7475 7265 732c 2066 5f69 6e69 5f61 746f  tures, f_ini_ato
-0000f140: 6d73 5f62 6f6e 6473 2c20 6174 6f6d 5f74  ms_bonds, atom_t
-0000f150: 6f5f 696e 636f 6d69 6e67 5f62 6f6e 6473  o_incoming_bonds
-0000f160: 2c20 6d61 7070 696e 672c 2067 6c6f 6261  , mapping, globa
-0000f170: 6c5f 6665 6174 7572 6573 2c20 6d6f 6c65  l_features, mole
-0000f180: 6375 6c65 735f 756e 6261 7463 685f 6b65  cules_unbatch_ke
-0000f190: 7929 0a20 2020 2022 2222 0a0a 2020 2020  y).    """..    
-0000f1a0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-0000f1b0: 662c 0a20 2020 2020 2020 2020 2020 2020  f,.             
-0000f1c0: 2020 2020 7573 655f 6465 6661 756c 745f      use_default_
-0000f1d0: 6664 696d 3a20 626f 6f6c 203d 2054 7275  fdim: bool = Tru
-0000f1e0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0000f1f0: 2020 2020 6174 6f6d 5f66 6469 6d3a 2069      atom_fdim: i
-0000f200: 6e74 203d 2031 3333 2c0a 2020 2020 2020  nt = 133,.      
-0000f210: 2020 2020 2020 2020 2020 2062 6f6e 645f             bond_
-0000f220: 6664 696d 3a20 696e 7420 3d20 3134 2c0a  fdim: int = 14,.
-0000f230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f240: 2064 5f68 6964 6465 6e3a 2069 6e74 203d   d_hidden: int =
-0000f250: 2033 3030 2c0a 2020 2020 2020 2020 2020   300,.          
-0000f260: 2020 2020 2020 2064 6570 7468 3a20 696e         depth: in
-0000f270: 7420 3d20 332c 0a20 2020 2020 2020 2020  t = 3,.         
-0000f280: 2020 2020 2020 2020 6269 6173 3a20 626f          bias: bo
-0000f290: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-0000f2a0: 2020 2020 2020 2020 2020 2020 2061 6374               act
-0000f2b0: 6976 6174 696f 6e3a 2073 7472 203d 2027  ivation: str = '
-0000f2c0: 7265 6c75 272c 0a20 2020 2020 2020 2020  relu',.         
-0000f2d0: 2020 2020 2020 2020 6472 6f70 6f75 745f          dropout_
-0000f2e0: 703a 2066 6c6f 6174 203d 2030 2e30 2c0a  p: float = 0.0,.
-0000f2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f300: 2061 6767 7265 6761 7469 6f6e 3a20 7374   aggregation: st
-0000f310: 7220 3d20 276d 6561 6e27 2c0a 2020 2020  r = 'mean',.    
-0000f320: 2020 2020 2020 2020 2020 2020 2061 6767               agg
-0000f330: 7265 6761 7469 6f6e 5f6e 6f72 6d3a 2055  regation_norm: U
-0000f340: 6e69 6f6e 5b69 6e74 2c20 666c 6f61 745d  nion[int, float]
-0000f350: 203d 2031 3030 293a 0a20 2020 2020 2020   = 100):.       
-0000f360: 2022 2222 496e 6974 6961 6c69 7a65 2061   """Initialize a
-0000f370: 2044 4d50 4e4e 456e 636f 6465 724c 6179   DMPNNEncoderLay
-0000f380: 6572 206c 6179 6572 2e0a 0a20 2020 2020  er layer...     
-0000f390: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-0000f3a0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-0000f3b0: 0a20 2020 2020 2020 2075 7365 5f64 6566  .        use_def
-0000f3c0: 6175 6c74 5f66 6469 6d3a 2062 6f6f 6c0a  ault_fdim: bool.
-0000f3d0: 2020 2020 2020 2020 2020 2020 4966 2060              If `
-0000f3e0: 6054 7275 6560 602c 2060 6073 656c 662e  `True``, ``self.
-0000f3f0: 6174 6f6d 5f66 6469 6d60 6020 616e 6420  atom_fdim`` and 
-0000f400: 6060 7365 6c66 2e62 6f6e 645f 6664 696d  ``self.bond_fdim
-0000f410: 6060 2061 7265 2069 6e69 7469 616c 697a  `` are initializ
-0000f420: 6564 2075 7369 6e67 2076 616c 7565 7320  ed using values 
-0000f430: 6672 6f6d 2074 6865 2047 7261 7068 436f  from the GraphCo
-0000f440: 6e76 436f 6e73 7461 6e74 7320 636c 6173  nvConstants clas
-0000f450: 732e 2049 6620 6060 4661 6c73 6560 602c  s. If ``False``,
-0000f460: 2060 6073 656c 662e 6174 6f6d 5f66 6469   ``self.atom_fdi
-0000f470: 6d60 6020 616e 6420 6060 7365 6c66 2e62  m`` and ``self.b
-0000f480: 6f6e 645f 6664 696d 6060 2061 7265 2069  ond_fdim`` are i
-0000f490: 6e69 7469 616c 697a 6564 2066 726f 6d20  nitialized from 
-0000f4a0: 7468 6520 7661 6c75 6573 2070 726f 7669  the values provi
-0000f4b0: 6465 642e 0a20 2020 2020 2020 2061 746f  ded..        ato
-0000f4c0: 6d5f 6664 696d 3a20 696e 740a 2020 2020  m_fdim: int.    
-0000f4d0: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
-0000f4e0: 6e20 6f66 2061 746f 6d20 6665 6174 7572  n of atom featur
-0000f4f0: 6520 7665 6374 6f72 2e0a 2020 2020 2020  e vector..      
-0000f500: 2020 626f 6e64 5f66 6469 6d3a 2069 6e74    bond_fdim: int
-0000f510: 0a20 2020 2020 2020 2020 2020 2044 696d  .            Dim
-0000f520: 656e 7369 6f6e 206f 6620 626f 6e64 2066  ension of bond f
-0000f530: 6561 7475 7265 2076 6563 746f 722e 0a20  eature vector.. 
-0000f540: 2020 2020 2020 2064 5f68 6964 6465 6e3a         d_hidden:
-0000f550: 2069 6e74 0a20 2020 2020 2020 2020 2020   int.           
-0000f560: 2053 697a 6520 6f66 2068 6964 6465 6e20   Size of hidden 
-0000f570: 6c61 7965 7220 696e 2074 6865 2065 6e63  layer in the enc
-0000f580: 6f64 6572 206c 6179 6572 2e0a 2020 2020  oder layer..    
-0000f590: 2020 2020 6465 7074 683a 2069 6e74 0a20      depth: int. 
-0000f5a0: 2020 2020 2020 2020 2020 204e 6f20 6f66             No of
-0000f5b0: 206d 6573 7361 6765 2070 6173 7369 6e67   message passing
-0000f5c0: 2073 7465 7073 2e0a 2020 2020 2020 2020   steps..        
-0000f5d0: 6269 6173 3a20 626f 6f6c 0a20 2020 2020  bias: bool.     
-0000f5e0: 2020 2020 2020 2049 6620 6060 5472 7565         If ``True
-0000f5f0: 6060 2c20 6465 6e73 6520 6c61 7965 7273  ``, dense layers
-0000f600: 2077 696c 6c20 7573 6520 6269 6173 2076   will use bias v
-0000f610: 6563 746f 7273 2e0a 2020 2020 2020 2020  ectors..        
-0000f620: 6163 7469 7661 7469 6f6e 3a20 7374 720a  activation: str.
-0000f630: 2020 2020 2020 2020 2020 2020 4163 7469              Acti
-0000f640: 7661 7469 6f6e 2066 756e 6374 696f 6e20  vation function 
-0000f650: 746f 2062 6520 7573 6564 2069 6e20 7468  to be used in th
-0000f660: 6520 656e 636f 6465 7220 6c61 7965 722e  e encoder layer.
-0000f670: 0a20 2020 2020 2020 2020 2020 2043 616e  .            Can
-0000f680: 2063 686f 6f73 6520 6265 7477 6565 6e20   choose between 
-0000f690: 2772 656c 7527 2066 6f72 2052 654c 552c  'relu' for ReLU,
-0000f6a0: 2027 6c65 616b 7972 656c 7527 2066 6f72   'leakyrelu' for
-0000f6b0: 204c 6561 6b79 5265 4c55 2c20 2770 7265   LeakyReLU, 'pre
-0000f6c0: 6c75 2720 666f 7220 5052 654c 552c 0a20  lu' for PReLU,. 
-0000f6d0: 2020 2020 2020 2020 2020 2027 7461 6e68             'tanh
-0000f6e0: 2720 666f 7220 5461 6e48 2c20 2773 656c  ' for TanH, 'sel
-0000f6f0: 7527 2066 6f72 2053 454c 552c 2061 6e64  u' for SELU, and
-0000f700: 2027 656c 7527 2066 6f72 2045 4c55 2e0a   'elu' for ELU..
-0000f710: 2020 2020 2020 2020 6472 6f70 6f75 745f          dropout_
-0000f720: 703a 2066 6c6f 6174 0a20 2020 2020 2020  p: float.       
-0000f730: 2020 2020 2044 726f 706f 7574 2070 726f       Dropout pro
-0000f740: 6261 6269 6c69 7479 2066 6f72 2074 6865  bability for the
-0000f750: 2065 6e63 6f64 6572 206c 6179 6572 2e0a   encoder layer..
-0000f760: 2020 2020 2020 2020 6167 6772 6567 6174          aggregat
-0000f770: 696f 6e3a 2073 7472 0a20 2020 2020 2020  ion: str.       
-0000f780: 2020 2020 2041 6767 7265 6761 7469 6f6e       Aggregation
-0000f790: 2074 7970 6520 746f 2062 6520 7573 6564   type to be used
-0000f7a0: 2069 6e20 7468 6520 656e 636f 6465 7220   in the encoder 
-0000f7b0: 6c61 7965 722e 0a20 2020 2020 2020 2020  layer..         
-0000f7c0: 2020 2043 616e 2063 686f 6f73 6520 6265     Can choose be
-0000f7d0: 7477 6565 6e20 276d 6561 6e27 2c20 2773  tween 'mean', 's
-0000f7e0: 756d 272c 2061 6e64 2027 6e6f 726d 272e  um', and 'norm'.
-0000f7f0: 0a20 2020 2020 2020 2061 6767 7265 6761  .        aggrega
-0000f800: 7469 6f6e 5f6e 6f72 6d3a 2055 6e69 6f6e  tion_norm: Union
-0000f810: 5b69 6e74 2c20 666c 6f61 745d 0a20 2020  [int, float].   
-0000f820: 2020 2020 2020 2020 2056 616c 7565 2072           Value r
-0000f830: 6571 7569 7265 6420 6966 2060 6167 6772  equired if `aggr
-0000f840: 6567 6174 696f 6e60 2074 7970 6520 6973  egation` type is
-0000f850: 2027 6e6f 726d 272e 0a20 2020 2020 2020   'norm'..       
-0000f860: 2022 2222 0a20 2020 2020 2020 2073 7570   """.        sup
-0000f870: 6572 2844 4d50 4e4e 456e 636f 6465 724c  er(DMPNNEncoderL
-0000f880: 6179 6572 2c20 7365 6c66 292e 5f5f 696e  ayer, self).__in
-0000f890: 6974 5f5f 2829 0a0a 2020 2020 2020 2020  it__()..        
-0000f8a0: 6966 2075 7365 5f64 6566 6175 6c74 5f66  if use_default_f
-0000f8b0: 6469 6d3a 0a20 2020 2020 2020 2020 2020  dim:.           
-0000f8c0: 2066 726f 6d20 6465 6570 6368 656d 2e66   from deepchem.f
-0000f8d0: 6561 742e 6d6f 6c65 6375 6c65 5f66 6561  eat.molecule_fea
-0000f8e0: 7475 7269 7a65 7273 2e64 6d70 6e6e 5f66  turizers.dmpnn_f
-0000f8f0: 6561 7475 7269 7a65 7220 696d 706f 7274  eaturizer import
-0000f900: 2047 7261 7068 436f 6e76 436f 6e73 7461   GraphConvConsta
-0000f910: 6e74 730a 2020 2020 2020 2020 2020 2020  nts.            
-0000f920: 7365 6c66 2e61 746f 6d5f 6664 696d 3a20  self.atom_fdim: 
-0000f930: 696e 7420 3d20 4772 6170 6843 6f6e 7643  int = GraphConvC
-0000f940: 6f6e 7374 616e 7473 2e41 544f 4d5f 4644  onstants.ATOM_FD
-0000f950: 494d 0a20 2020 2020 2020 2020 2020 2073  IM.            s
-0000f960: 656c 662e 636f 6e63 6174 5f66 6469 6d3a  elf.concat_fdim:
-0000f970: 2069 6e74 203d 2047 7261 7068 436f 6e76   int = GraphConv
-0000f980: 436f 6e73 7461 6e74 732e 4154 4f4d 5f46  Constants.ATOM_F
-0000f990: 4449 4d20 2b20 4772 6170 6843 6f6e 7643  DIM + GraphConvC
-0000f9a0: 6f6e 7374 616e 7473 2e42 4f4e 445f 4644  onstants.BOND_FD
-0000f9b0: 494d 0a20 2020 2020 2020 2065 6c73 653a  IM.        else:
-0000f9c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000f9d0: 662e 6174 6f6d 5f66 6469 6d20 3d20 6174  f.atom_fdim = at
-0000f9e0: 6f6d 5f66 6469 6d0a 2020 2020 2020 2020  om_fdim.        
-0000f9f0: 2020 2020 7365 6c66 2e63 6f6e 6361 745f      self.concat_
-0000fa00: 6664 696d 203d 2061 746f 6d5f 6664 696d  fdim = atom_fdim
-0000fa10: 202b 2062 6f6e 645f 6664 696d 0a0a 2020   + bond_fdim..  
-0000fa20: 2020 2020 2020 7365 6c66 2e64 6570 7468        self.depth
-0000fa30: 3a20 696e 7420 3d20 6465 7074 680a 2020  : int = depth.  
-0000fa40: 2020 2020 2020 7365 6c66 2e61 6767 7265        self.aggre
-0000fa50: 6761 7469 6f6e 3a20 7374 7220 3d20 6167  gation: str = ag
-0000fa60: 6772 6567 6174 696f 6e0a 2020 2020 2020  gregation.      
-0000fa70: 2020 7365 6c66 2e61 6767 7265 6761 7469    self.aggregati
-0000fa80: 6f6e 5f6e 6f72 6d3a 2055 6e69 6f6e 5b69  on_norm: Union[i
-0000fa90: 6e74 2c20 666c 6f61 745d 203d 2061 6767  nt, float] = agg
-0000faa0: 7265 6761 7469 6f6e 5f6e 6f72 6d0a 0a20  regation_norm.. 
-0000fab0: 2020 2020 2020 2069 6620 6163 7469 7661         if activa
-0000fac0: 7469 6f6e 203d 3d20 2772 656c 7527 3a0a  tion == 'relu':.
-0000fad0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000fae0: 2e61 6374 6976 6174 696f 6e3a 206e 6e2e  .activation: nn.
-0000faf0: 6d6f 6475 6c65 732e 6163 7469 7661 7469  modules.activati
-0000fb00: 6f6e 2e4d 6f64 756c 6520 3d20 6e6e 2e52  on.Module = nn.R
-0000fb10: 654c 5528 290a 0a20 2020 2020 2020 2065  eLU()..        e
-0000fb20: 6c69 6620 6163 7469 7661 7469 6f6e 203d  lif activation =
-0000fb30: 3d20 276c 6561 6b79 7265 6c75 273a 0a20  = 'leakyrelu':. 
-0000fb40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000fb50: 6163 7469 7661 7469 6f6e 203d 206e 6e2e  activation = nn.
-0000fb60: 4c65 616b 7952 654c 5528 302e 3129 0a0a  LeakyReLU(0.1)..
-0000fb70: 2020 2020 2020 2020 656c 6966 2061 6374          elif act
-0000fb80: 6976 6174 696f 6e20 3d3d 2027 7072 656c  ivation == 'prel
-0000fb90: 7527 3a0a 2020 2020 2020 2020 2020 2020  u':.            
-0000fba0: 7365 6c66 2e61 6374 6976 6174 696f 6e20  self.activation 
-0000fbb0: 3d20 6e6e 2e50 5265 4c55 2829 0a0a 2020  = nn.PReLU()..  
-0000fbc0: 2020 2020 2020 656c 6966 2061 6374 6976        elif activ
-0000fbd0: 6174 696f 6e20 3d3d 2027 7461 6e68 273a  ation == 'tanh':
-0000fbe0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000fbf0: 662e 6163 7469 7661 7469 6f6e 203d 206e  f.activation = n
-0000fc00: 6e2e 5461 6e68 2829 0a0a 2020 2020 2020  n.Tanh()..      
-0000fc10: 2020 656c 6966 2061 6374 6976 6174 696f    elif activatio
-0000fc20: 6e20 3d3d 2027 7365 6c75 273a 0a20 2020  n == 'selu':.   
-0000fc30: 2020 2020 2020 2020 2073 656c 662e 6163           self.ac
-0000fc40: 7469 7661 7469 6f6e 203d 206e 6e2e 5345  tivation = nn.SE
-0000fc50: 4c55 2829 0a0a 2020 2020 2020 2020 656c  LU()..        el
-0000fc60: 6966 2061 6374 6976 6174 696f 6e20 3d3d  if activation ==
-0000fc70: 2027 656c 7527 3a0a 2020 2020 2020 2020   'elu':.        
-0000fc80: 2020 2020 7365 6c66 2e61 6374 6976 6174      self.activat
-0000fc90: 696f 6e20 3d20 6e6e 2e45 4c55 2829 0a0a  ion = nn.ELU()..
-0000fca0: 2020 2020 2020 2020 7365 6c66 2e64 726f          self.dro
-0000fcb0: 706f 7574 3a20 6e6e 2e6d 6f64 756c 6573  pout: nn.modules
-0000fcc0: 2e64 726f 706f 7574 2e4d 6f64 756c 6520  .dropout.Module 
-0000fcd0: 3d20 6e6e 2e44 726f 706f 7574 2864 726f  = nn.Dropout(dro
-0000fce0: 706f 7574 5f70 290a 0a20 2020 2020 2020  pout_p)..       
-0000fcf0: 2023 2049 6e70 7574 0a20 2020 2020 2020   # Input.       
-0000fd00: 2073 656c 662e 575f 693a 206e 6e2e 4c69   self.W_i: nn.Li
-0000fd10: 6e65 6172 203d 206e 6e2e 4c69 6e65 6172  near = nn.Linear
-0000fd20: 2873 656c 662e 636f 6e63 6174 5f66 6469  (self.concat_fdi
-0000fd30: 6d2c 2064 5f68 6964 6465 6e2c 2062 6961  m, d_hidden, bia
-0000fd40: 733d 6269 6173 290a 0a20 2020 2020 2020  s=bias)..       
-0000fd50: 2023 2053 6861 7265 6420 7765 6967 6874   # Shared weight
-0000fd60: 206d 6174 7269 7820 6163 726f 7373 2064   matrix across d
-0000fd70: 6570 7468 7320 2864 6566 6175 6c74 293a  epths (default):
-0000fd80: 0a20 2020 2020 2020 2023 2046 6f72 206d  .        # For m
-0000fd90: 6573 7361 6765 7320 6869 6464 656e 2073  essages hidden s
-0000fda0: 7461 7465 730a 2020 2020 2020 2020 7365  tates.        se
-0000fdb0: 6c66 2e57 5f68 3a20 6e6e 2e4c 696e 6561  lf.W_h: nn.Linea
-0000fdc0: 7220 3d20 6e6e 2e4c 696e 6561 7228 645f  r = nn.Linear(d_
-0000fdd0: 6869 6464 656e 2c20 645f 6869 6464 656e  hidden, d_hidden
-0000fde0: 2c20 6269 6173 3d62 6961 7329 0a0a 2020  , bias=bias)..  
-0000fdf0: 2020 2020 2020 2320 466f 7220 6174 6f6d        # For atom
-0000fe00: 2068 6964 6465 6e20 7374 6174 6573 0a20   hidden states. 
-0000fe10: 2020 2020 2020 2073 656c 662e 575f 6f3a         self.W_o:
-0000fe20: 206e 6e2e 4c69 6e65 6172 203d 206e 6e2e   nn.Linear = nn.
-0000fe30: 4c69 6e65 6172 2873 656c 662e 6174 6f6d  Linear(self.atom
-0000fe40: 5f66 6469 6d20 2b20 645f 6869 6464 656e  _fdim + d_hidden
-0000fe50: 2c20 645f 6869 6464 656e 290a 0a20 2020  , d_hidden)..   
-0000fe60: 2064 6566 205f 6765 745f 7570 6461 7465   def _get_update
-0000fe70: 645f 6174 6f6d 735f 6869 6464 656e 5f73  d_atoms_hidden_s
-0000fe80: 7461 7465 280a 2020 2020 2020 2020 2020  tate(.          
-0000fe90: 2020 7365 6c66 2c20 6174 6f6d 5f66 6561    self, atom_fea
-0000fea0: 7475 7265 733a 2074 6f72 6368 2e54 656e  tures: torch.Ten
-0000feb0: 736f 722c 2068 5f6d 6573 7361 6765 3a20  sor, h_message: 
-0000fec0: 746f 7263 682e 5465 6e73 6f72 2c0a 2020  torch.Tensor,.  
-0000fed0: 2020 2020 2020 2020 2020 6174 6f6d 5f74            atom_t
-0000fee0: 6f5f 696e 636f 6d69 6e67 5f62 6f6e 6473  o_incoming_bonds
-0000fef0: 3a20 746f 7263 682e 5465 6e73 6f72 2920  : torch.Tensor) 
-0000ff00: 2d3e 2074 6f72 6368 2e54 656e 736f 723a  -> torch.Tensor:
-0000ff10: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000ff20: 2020 2020 204d 6574 686f 6420 746f 2063       Method to c
-0000ff30: 6f6d 7075 7465 2061 746f 6d20 6869 6464  ompute atom hidd
-0000ff40: 656e 2073 7461 7465 732e 0a0a 2020 2020  en states...    
-0000ff50: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-0000ff60: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-0000ff70: 2d0a 2020 2020 2020 2020 6174 6f6d 5f66  -.        atom_f
-0000ff80: 6561 7475 7265 733a 2074 6f72 6368 2e54  eatures: torch.T
-0000ff90: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
-0000ffa0: 2020 5465 6e73 6f72 2063 6f6e 7461 696e    Tensor contain
-0000ffb0: 696e 6720 6174 6f6d 7320 6665 6174 7572  ing atoms featur
-0000ffc0: 6573 2e0a 2020 2020 2020 2020 685f 6d65  es..        h_me
-0000ffd0: 7373 6167 653a 2074 6f72 6368 2e54 656e  ssage: torch.Ten
-0000ffe0: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
-0000fff0: 5465 6e73 6f72 2063 6f6e 7461 696e 696e  Tensor containin
-00010000: 6720 6869 6464 656e 2073 7461 7465 7320  g hidden states 
-00010010: 6f66 206d 6573 7361 6765 732e 0a20 2020  of messages..   
-00010020: 2020 2020 2061 746f 6d5f 746f 5f69 6e63       atom_to_inc
-00010030: 6f6d 696e 675f 626f 6e64 733a 2074 6f72  oming_bonds: tor
-00010040: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
-00010050: 2020 2020 2020 5465 6e73 6f72 2063 6f6e        Tensor con
-00010060: 7461 696e 696e 6720 6d61 7070 696e 6720  taining mapping 
-00010070: 6672 6f6d 2061 746f 6d20 696e 6465 7820  from atom index 
-00010080: 746f 206c 6973 7420 6f66 2069 6e64 6963  to list of indic
-00010090: 6965 7320 6f66 2069 6e63 6f6d 696e 6720  ies of incoming 
-000100a0: 626f 6e64 732e 0a0a 2020 2020 2020 2020  bonds...        
-000100b0: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
-000100c0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-000100d0: 6174 6f6d 735f 6869 6464 656e 5f73 7461  atoms_hidden_sta
-000100e0: 7465 733a 2074 6f72 6368 2e54 656e 736f  tes: torch.Tenso
-000100f0: 720a 2020 2020 2020 2020 2020 2020 5465  r.            Te
-00010100: 6e73 6f72 2063 6f6e 7461 696e 696e 6720  nsor containing 
-00010110: 6174 6f6d 2068 6964 6465 6e20 7374 6174  atom hidden stat
-00010120: 6573 2e0a 2020 2020 2020 2020 2222 220a  es..        """.
-00010130: 2020 2020 2020 2020 6d65 7373 6167 6573          messages
-00010140: 5f74 6f5f 6174 6f6d 733a 2074 6f72 6368  _to_atoms: torch
-00010150: 2e54 656e 736f 7220 3d20 685f 6d65 7373  .Tensor = h_mess
-00010160: 6167 655b 6174 6f6d 5f74 6f5f 696e 636f  age[atom_to_inco
-00010170: 6d69 6e67 5f62 6f6e 6473 5d2e 7375 6d28  ming_bonds].sum(
-00010180: 0a20 2020 2020 2020 2020 2020 2031 2920  .            1) 
-00010190: 2023 206e 756d 5f61 746f 6d73 2078 2068   # num_atoms x h
-000101a0: 6964 6465 6e5f 7369 7a65 0a20 2020 2020  idden_size.     
-000101b0: 2020 2061 746f 6d73 5f68 6964 6465 6e5f     atoms_hidden_
-000101c0: 7374 6174 6573 3a20 746f 7263 682e 5465  states: torch.Te
-000101d0: 6e73 6f72 203d 2073 656c 662e 575f 6f28  nsor = self.W_o(
-000101e0: 0a20 2020 2020 2020 2020 2020 2074 6f72  .            tor
-000101f0: 6368 2e63 6174 2828 6174 6f6d 5f66 6561  ch.cat((atom_fea
-00010200: 7475 7265 732c 206d 6573 7361 6765 735f  tures, messages_
-00010210: 746f 5f61 746f 6d73 292c 0a20 2020 2020  to_atoms),.     
-00010220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010230: 2031 2929 2020 2320 6e75 6d5f 6174 6f6d   1))  # num_atom
-00010240: 7320 7820 6869 6464 656e 5f73 697a 650a  s x hidden_size.
-00010250: 2020 2020 2020 2020 6174 6f6d 735f 6869          atoms_hi
-00010260: 6464 656e 5f73 7461 7465 7320 3d20 7365  dden_states = se
-00010270: 6c66 2e61 6374 6976 6174 696f 6e28 0a20  lf.activation(. 
-00010280: 2020 2020 2020 2020 2020 2061 746f 6d73             atoms
-00010290: 5f68 6964 6465 6e5f 7374 6174 6573 2920  _hidden_states) 
-000102a0: 2023 206e 756d 5f61 746f 6d73 2078 2068   # num_atoms x h
-000102b0: 6964 6465 6e5f 7369 7a65 0a20 2020 2020  idden_size.     
-000102c0: 2020 2061 746f 6d73 5f68 6964 6465 6e5f     atoms_hidden_
-000102d0: 7374 6174 6573 203d 2073 656c 662e 6472  states = self.dr
-000102e0: 6f70 6f75 7428 0a20 2020 2020 2020 2020  opout(.         
-000102f0: 2020 2061 746f 6d73 5f68 6964 6465 6e5f     atoms_hidden_
-00010300: 7374 6174 6573 2920 2023 206e 756d 5f61  states)  # num_a
-00010310: 746f 6d73 2078 2068 6964 6465 6e5f 7369  toms x hidden_si
-00010320: 7a65 0a20 2020 2020 2020 2072 6574 7572  ze.        retur
-00010330: 6e20 6174 6f6d 735f 6869 6464 656e 5f73  n atoms_hidden_s
-00010340: 7461 7465 7320 2023 206e 756d 5f61 746f  tates  # num_ato
-00010350: 6d73 2078 2068 6964 6465 6e5f 7369 7a65  ms x hidden_size
-00010360: 0a0a 2020 2020 6465 6620 5f72 6561 646f  ..    def _reado
-00010370: 7574 2873 656c 662c 2061 746f 6d73 5f68  ut(self, atoms_h
-00010380: 6964 6465 6e5f 7374 6174 6573 3a20 746f  idden_states: to
-00010390: 7263 682e 5465 6e73 6f72 2c0a 2020 2020  rch.Tensor,.    
-000103a0: 2020 2020 2020 2020 2020 2020 206d 6f6c               mol
-000103b0: 6563 756c 6573 5f75 6e62 6174 6368 5f6b  ecules_unbatch_k
-000103c0: 6579 3a20 4c69 7374 2920 2d3e 2074 6f72  ey: List) -> tor
-000103d0: 6368 2e54 656e 736f 723a 0a20 2020 2020  ch.Tensor:.     
-000103e0: 2020 2022 2222 0a20 2020 2020 2020 204d     """.        M
-000103f0: 6574 686f 6420 746f 2065 7865 6375 7465  ethod to execute
-00010400: 2074 6865 2072 6561 646f 7574 2070 6861   the readout pha
-00010410: 7365 2e20 2863 6f6d 7075 7465 206d 6f6c  se. (compute mol
-00010420: 6563 756c 6573 2065 6e63 6f64 696e 6773  ecules encodings
-00010430: 2066 726f 6d20 6174 6f6d 2068 6964 6465   from atom hidde
-00010440: 6e20 7374 6174 6573 290a 0a20 2020 2020  n states)..     
-00010450: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-00010460: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-00010470: 0a20 2020 2020 2020 2061 746f 6d73 5f68  .        atoms_h
-00010480: 6964 6465 6e5f 7374 6174 6573 3a20 746f  idden_states: to
-00010490: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
-000104a0: 2020 2020 2020 2054 656e 736f 7220 636f         Tensor co
-000104b0: 6e74 6169 6e69 6e67 2061 746f 6d20 6869  ntaining atom hi
-000104c0: 6464 656e 2073 7461 7465 732e 0a20 2020  dden states..   
-000104d0: 2020 2020 206d 6f6c 6563 756c 6573 5f75       molecules_u
-000104e0: 6e62 6174 6368 5f6b 6579 3a20 4c69 7374  nbatch_key: List
-000104f0: 0a20 2020 2020 2020 2020 2020 204c 6973  .            Lis
-00010500: 7420 636f 6e74 6169 6e69 6e67 206e 756d  t containing num
-00010510: 6265 7220 6f66 2061 746f 6d73 2069 6e20  ber of atoms in 
-00010520: 7661 7269 6f75 7320 6d6f 6c65 6375 6c65  various molecule
-00010530: 7320 6f66 2061 2062 6174 6368 0a0a 2020  s of a batch..  
-00010540: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
-00010550: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
-00010560: 2020 2020 2020 6d6f 6c65 6375 6c65 5f68        molecule_h
-00010570: 6964 6465 6e5f 7374 6174 653a 2074 6f72  idden_state: tor
-00010580: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
-00010590: 2020 2020 2020 5465 6e73 6f72 2063 6f6e        Tensor con
-000105a0: 7461 696e 696e 6720 6d6f 6c65 6375 6c65  taining molecule
-000105b0: 2065 6e63 6f64 696e 6773 2e0a 2020 2020   encodings..    
-000105c0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000105d0: 6d6f 6c5f 7665 6373 3a20 4c69 7374 203d  mol_vecs: List =
-000105e0: 205b 5d0a 2020 2020 2020 2020 6174 6f6d   [].        atom
-000105f0: 735f 6869 6464 656e 5f73 7461 7465 735f  s_hidden_states_
-00010600: 7370 6c69 743a 2053 6571 7565 6e63 655b  split: Sequence[
-00010610: 5465 6e73 6f72 5d20 3d20 746f 7263 682e  Tensor] = torch.
-00010620: 7370 6c69 7428 0a20 2020 2020 2020 2020  split(.         
-00010630: 2020 2061 746f 6d73 5f68 6964 6465 6e5f     atoms_hidden_
-00010640: 7374 6174 6573 2c20 6d6f 6c65 6375 6c65  states, molecule
-00010650: 735f 756e 6261 7463 685f 6b65 7929 0a20  s_unbatch_key). 
-00010660: 2020 2020 2020 206d 6f6c 5f76 6563 3a20         mol_vec: 
-00010670: 746f 7263 682e 5465 6e73 6f72 0a20 2020  torch.Tensor.   
-00010680: 2020 2020 2066 6f72 206d 6f6c 5f76 6563       for mol_vec
-00010690: 2069 6e20 6174 6f6d 735f 6869 6464 656e   in atoms_hidden
-000106a0: 5f73 7461 7465 735f 7370 6c69 743a 0a20  _states_split:. 
-000106b0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-000106c0: 6c66 2e61 6767 7265 6761 7469 6f6e 203d  lf.aggregation =
-000106d0: 3d20 276d 6561 6e27 3a0a 2020 2020 2020  = 'mean':.      
-000106e0: 2020 2020 2020 2020 2020 6d6f 6c5f 7665            mol_ve
-000106f0: 6320 3d20 6d6f 6c5f 7665 632e 7375 6d28  c = mol_vec.sum(
-00010700: 6469 6d3d 3029 202f 206c 656e 286d 6f6c  dim=0) / len(mol
-00010710: 5f76 6563 290a 2020 2020 2020 2020 2020  _vec).          
-00010720: 2020 656c 6966 2073 656c 662e 6167 6772    elif self.aggr
-00010730: 6567 6174 696f 6e20 3d3d 2027 7375 6d27  egation == 'sum'
-00010740: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010750: 2020 6d6f 6c5f 7665 6320 3d20 6d6f 6c5f    mol_vec = mol_
-00010760: 7665 632e 7375 6d28 6469 6d3d 3029 0a20  vec.sum(dim=0). 
-00010770: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00010780: 7365 6c66 2e61 6767 7265 6761 7469 6f6e  self.aggregation
-00010790: 203d 3d20 276e 6f72 6d27 3a0a 2020 2020   == 'norm':.    
-000107a0: 2020 2020 2020 2020 2020 2020 6d6f 6c5f              mol_
-000107b0: 7665 6320 3d20 6d6f 6c5f 7665 632e 7375  vec = mol_vec.su
-000107c0: 6d28 6469 6d3d 3029 202f 2073 656c 662e  m(dim=0) / self.
-000107d0: 6167 6772 6567 6174 696f 6e5f 6e6f 726d  aggregation_norm
-000107e0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-000107f0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00010800: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
-00010810: 6f6e 2822 496e 7661 6c69 6420 6167 6772  on("Invalid aggr
-00010820: 6567 6174 696f 6e22 290a 2020 2020 2020  egation").      
-00010830: 2020 2020 2020 6d6f 6c5f 7665 6373 2e61        mol_vecs.a
-00010840: 7070 656e 6428 6d6f 6c5f 7665 6329 0a0a  ppend(mol_vec)..
-00010850: 2020 2020 2020 2020 6d6f 6c65 6375 6c65          molecule
-00010860: 5f68 6964 6465 6e5f 7374 6174 653a 2074  _hidden_state: t
-00010870: 6f72 6368 2e54 656e 736f 7220 3d20 746f  orch.Tensor = to
-00010880: 7263 682e 7374 6163 6b28 6d6f 6c5f 7665  rch.stack(mol_ve
-00010890: 6373 2c20 6469 6d3d 3029 0a20 2020 2020  cs, dim=0).     
-000108a0: 2020 2072 6574 7572 6e20 6d6f 6c65 6375     return molecu
-000108b0: 6c65 5f68 6964 6465 6e5f 7374 6174 6520  le_hidden_state 
-000108c0: 2023 206e 756d 5f6d 6f6c 6563 756c 6573   # num_molecules
-000108d0: 2078 2068 6964 6465 6e5f 7369 7a65 0a0a   x hidden_size..
-000108e0: 2020 2020 6465 6620 666f 7277 6172 6428      def forward(
-000108f0: 7365 6c66 2c20 6174 6f6d 5f66 6561 7475  self, atom_featu
-00010900: 7265 733a 2074 6f72 6368 2e54 656e 736f  res: torch.Tenso
-00010910: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-00010920: 2020 2066 5f69 6e69 5f61 746f 6d73 5f62     f_ini_atoms_b
-00010930: 6f6e 6473 3a20 746f 7263 682e 5465 6e73  onds: torch.Tens
-00010940: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
-00010950: 2020 2020 6174 6f6d 5f74 6f5f 696e 636f      atom_to_inco
-00010960: 6d69 6e67 5f62 6f6e 6473 3a20 746f 7263  ming_bonds: torc
-00010970: 682e 5465 6e73 6f72 2c20 6d61 7070 696e  h.Tensor, mappin
-00010980: 673a 2074 6f72 6368 2e54 656e 736f 722c  g: torch.Tensor,
-00010990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000109a0: 2067 6c6f 6261 6c5f 6665 6174 7572 6573   global_features
-000109b0: 3a20 746f 7263 682e 5465 6e73 6f72 2c0a  : torch.Tensor,.
-000109c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000109d0: 6d6f 6c65 6375 6c65 735f 756e 6261 7463  molecules_unbatc
-000109e0: 685f 6b65 793a 204c 6973 7429 202d 3e20  h_key: List) -> 
-000109f0: 746f 7263 682e 5465 6e73 6f72 3a0a 2020  torch.Tensor:.  
-00010a00: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00010a10: 2020 4f75 7470 7574 2063 6f6d 7075 7461    Output computa
-00010a20: 7469 6f6e 2066 6f72 2074 6865 2044 4d50  tion for the DMP
-00010a30: 4e4e 456e 636f 6465 724c 6179 6572 2e0a  NNEncoderLayer..
-00010a40: 0a20 2020 2020 2020 2053 7465 7073 3a0a  .        Steps:.
-00010a50: 0a20 2020 2020 2020 202d 2047 6574 206f  .        - Get o
-00010a60: 7269 6769 6e61 6c20 626f 6e64 2068 6964  riginal bond hid
-00010a70: 6465 6e20 7374 6174 6573 2066 726f 6d20  den states from 
-00010a80: 636f 6e63 6174 656e 6174 696f 6e20 6f66  concatenation of
-00010a90: 2069 6e69 7469 616c 2061 746f 6d20 616e   initial atom an
-00010aa0: 6420 626f 6e64 2066 6561 7475 7265 732e  d bond features.
-00010ab0: 2028 6060 696e 7075 7460 6029 0a20 2020   (``input``).   
-00010ac0: 2020 2020 202d 2047 6574 2069 6e69 7469       - Get initi
-00010ad0: 616c 206d 6573 7361 6765 7320 6869 6464  al messages hidd
-00010ae0: 656e 2073 7461 7465 732e 2028 6060 6d65  en states. (``me
-00010af0: 7373 6167 6560 6029 0a20 2020 2020 2020  ssage``).       
-00010b00: 202d 2045 7865 6375 7465 206d 6573 7361   - Execute messa
-00010b10: 6765 2070 6173 7369 6e67 2073 7465 7020  ge passing step 
-00010b20: 666f 7220 6060 7365 6c66 2e64 6570 7468  for ``self.depth
-00010b30: 202d 2031 6060 2069 7465 7261 7469 6f6e   - 1`` iteration
-00010b40: 732e 0a20 2020 2020 2020 202d 2047 6574  s..        - Get
-00010b50: 2061 746f 6d20 6869 6464 656e 2073 7461   atom hidden sta
-00010b60: 7465 7320 7573 696e 6720 6174 6f6d 2066  tes using atom f
-00010b70: 6561 7475 7265 7320 616e 6420 6d65 7373  eatures and mess
-00010b80: 6167 6520 6869 6464 656e 2073 7461 7465  age hidden state
-00010b90: 732e 0a20 2020 2020 2020 202d 2047 6574  s..        - Get
-00010ba0: 206d 6f6c 6563 756c 6520 656e 636f 6469   molecule encodi
-00010bb0: 6e67 732e 0a20 2020 2020 2020 202d 2043  ngs..        - C
-00010bc0: 6f6e 6361 7465 6e61 7465 2067 6c6f 6261  oncatenate globa
-00010bd0: 6c20 6d6f 6c65 6375 6c61 7220 6665 6174  l molecular feat
-00010be0: 7572 6573 2061 6e64 206d 6f6c 6563 756c  ures and molecul
-00010bf0: 6520 656e 636f 6469 6e67 732e 0a0a 2020  e encodings...  
-00010c00: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-00010c10: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00010c20: 2d2d 2d0a 2020 2020 2020 2020 6174 6f6d  ---.        atom
-00010c30: 5f66 6561 7475 7265 733a 2074 6f72 6368  _features: torch
-00010c40: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
-00010c50: 2020 2020 5465 6e73 6f72 2063 6f6e 7461      Tensor conta
-00010c60: 696e 696e 6720 6174 6f6d 7320 6665 6174  ining atoms feat
-00010c70: 7572 6573 2e0a 2020 2020 2020 2020 665f  ures..        f_
-00010c80: 696e 695f 6174 6f6d 735f 626f 6e64 733a  ini_atoms_bonds:
-00010c90: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
-00010ca0: 2020 2020 2020 2020 2020 5465 6e73 6f72            Tensor
-00010cb0: 2063 6f6e 7461 696e 696e 6720 636f 6e63   containing conc
-00010cc0: 6174 656e 6174 6564 2066 6561 7475 7265  atenated feature
-00010cd0: 2076 6563 746f 7220 7768 6963 6820 636f   vector which co
-00010ce0: 6e74 6169 6e73 2063 6f6e 6361 7465 6e61  ntains concatena
-00010cf0: 7469 6f6e 206f 6620 696e 6974 6961 6c20  tion of initial 
-00010d00: 6174 6f6d 2061 6e64 2062 6f6e 6420 6665  atom and bond fe
-00010d10: 6174 7572 6573 2e0a 2020 2020 2020 2020  atures..        
-00010d20: 6174 6f6d 5f74 6f5f 696e 636f 6d69 6e67  atom_to_incoming
-00010d30: 5f62 6f6e 6473 3a20 746f 7263 682e 5465  _bonds: torch.Te
-00010d40: 6e73 6f72 0a20 2020 2020 2020 2020 2020  nsor.           
-00010d50: 2054 656e 736f 7220 636f 6e74 6169 6e69   Tensor containi
-00010d60: 6e67 206d 6170 7069 6e67 2066 726f 6d20  ng mapping from 
-00010d70: 6174 6f6d 2069 6e64 6578 2074 6f20 6c69  atom index to li
-00010d80: 7374 206f 6620 696e 6469 6369 6573 206f  st of indicies o
-00010d90: 6620 696e 636f 6d69 6e67 2062 6f6e 6473  f incoming bonds
-00010da0: 2e0a 2020 2020 2020 2020 6d61 7070 696e  ..        mappin
-00010db0: 673a 2074 6f72 6368 2e54 656e 736f 720a  g: torch.Tensor.
-00010dc0: 2020 2020 2020 2020 2020 2020 5465 6e73              Tens
-00010dd0: 6f72 2063 6f6e 7461 696e 696e 6720 7468  or containing th
-00010de0: 6520 6d61 7070 696e 6720 7468 6174 206d  e mapping that m
-00010df0: 6170 7320 626f 6e64 2069 6e64 6578 2074  aps bond index t
-00010e00: 6f20 2761 7272 6179 206f 6620 696e 6469  o 'array of indi
-00010e10: 6365 7320 6f66 2074 6865 2062 6f6e 6473  ces of the bonds
-00010e20: 270a 2020 2020 2020 2020 2020 2020 696e  '.            in
-00010e30: 636f 6d69 6e67 2061 7420 7468 6520 696e  coming at the in
-00010e40: 6974 6961 6c20 6174 6f6d 206f 6620 7468  itial atom of th
-00010e50: 6520 626f 6e64 2028 6578 636c 7564 696e  e bond (excludin
-00010e60: 6720 7468 6520 7265 7665 7273 6520 626f  g the reverse bo
-00010e70: 6e64 7329 2e0a 2020 2020 2020 2020 676c  nds)..        gl
-00010e80: 6f62 616c 5f66 6561 7475 7265 733a 2074  obal_features: t
-00010e90: 6f72 6368 2e54 656e 736f 720a 2020 2020  orch.Tensor.    
-00010ea0: 2020 2020 2020 2020 5465 6e73 6f72 2063          Tensor c
-00010eb0: 6f6e 7461 696e 696e 6720 6d6f 6c65 6375  ontaining molecu
-00010ec0: 6c65 2066 6561 7475 7265 732e 0a20 2020  le features..   
-00010ed0: 2020 2020 206d 6f6c 6563 756c 6573 5f75       molecules_u
-00010ee0: 6e62 6174 6368 5f6b 6579 3a20 4c69 7374  nbatch_key: List
-00010ef0: 0a20 2020 2020 2020 2020 2020 204c 6973  .            Lis
-00010f00: 7420 636f 6e74 6169 6e69 6e67 206e 756d  t containing num
-00010f10: 6265 7220 6f66 2061 746f 6d73 2069 6e20  ber of atoms in 
-00010f20: 7661 7269 6f75 7320 6d6f 6c65 6375 6c65  various molecule
-00010f30: 7320 6f66 2061 2062 6174 6368 0a0a 2020  s of a batch..  
-00010f40: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
-00010f50: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
-00010f60: 2020 2020 2020 6f75 7470 7574 3a20 746f        output: to
-00010f70: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
-00010f80: 2020 2020 2020 2054 656e 736f 7220 636f         Tensor co
-00010f90: 6e74 6169 6e69 6e67 2074 6865 2065 6e63  ntaining the enc
-00010fa0: 6f64 696e 6773 206f 6620 7468 6520 6d6f  odings of the mo
-00010fb0: 6c65 6375 6c65 732e 0a20 2020 2020 2020  lecules..       
-00010fc0: 2022 2222 0a20 2020 2020 2020 2069 6e70   """.        inp
-00010fd0: 7574 3a20 746f 7263 682e 5465 6e73 6f72  ut: torch.Tensor
-00010fe0: 203d 2073 656c 662e 575f 6928 0a20 2020   = self.W_i(.   
-00010ff0: 2020 2020 2020 2020 2066 5f69 6e69 5f61           f_ini_a
-00011000: 746f 6d73 5f62 6f6e 6473 2920 2023 206e  toms_bonds)  # n
-00011010: 756d 5f62 6f6e 6473 2078 2068 6964 6465  um_bonds x hidde
-00011020: 6e5f 7369 7a65 0a20 2020 2020 2020 206d  n_size.        m
-00011030: 6573 7361 6765 3a20 746f 7263 682e 5465  essage: torch.Te
-00011040: 6e73 6f72 203d 2073 656c 662e 6163 7469  nsor = self.acti
-00011050: 7661 7469 6f6e 280a 2020 2020 2020 2020  vation(.        
-00011060: 2020 2020 696e 7075 7429 2020 2320 6e75      input)  # nu
-00011070: 6d5f 626f 6e64 7320 7820 6869 6464 656e  m_bonds x hidden
-00011080: 5f73 697a 650a 0a20 2020 2020 2020 2066  _size..        f
-00011090: 6f72 205f 2069 6e20 7261 6e67 6528 312c  or _ in range(1,
-000110a0: 2073 656c 662e 6465 7074 6829 3a0a 2020   self.depth):.  
-000110b0: 2020 2020 2020 2020 2020 6d65 7373 6167            messag
-000110c0: 6520 3d20 6d65 7373 6167 655b 6d61 7070  e = message[mapp
-000110d0: 696e 675d 2e73 756d 2831 2920 2023 206e  ing].sum(1)  # n
-000110e0: 756d 5f62 6f6e 6473 2078 2068 6964 6465  um_bonds x hidde
-000110f0: 6e5f 7369 7a65 0a20 2020 2020 2020 2020  n_size.         
-00011100: 2020 2068 5f6d 6573 7361 6765 3a20 746f     h_message: to
-00011110: 7263 682e 5465 6e73 6f72 203d 2069 6e70  rch.Tensor = inp
-00011120: 7574 202b 2073 656c 662e 575f 6828 0a20  ut + self.W_h(. 
-00011130: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00011140: 6573 7361 6765 2920 2023 206e 756d 5f62  essage)  # num_b
-00011150: 6f6e 6473 2078 2068 6964 6465 6e5f 7369  onds x hidden_si
-00011160: 7a65 0a20 2020 2020 2020 2020 2020 2068  ze.            h
-00011170: 5f6d 6573 7361 6765 203d 2073 656c 662e  _message = self.
-00011180: 6163 7469 7661 7469 6f6e 2868 5f6d 6573  activation(h_mes
-00011190: 7361 6765 2920 2023 206e 756d 5f62 6f6e  sage)  # num_bon
-000111a0: 6473 2078 2068 6964 6465 6e5f 7369 7a65  ds x hidden_size
-000111b0: 0a20 2020 2020 2020 2020 2020 2068 5f6d  .            h_m
-000111c0: 6573 7361 6765 203d 2073 656c 662e 6472  essage = self.dr
-000111d0: 6f70 6f75 7428 685f 6d65 7373 6167 6529  opout(h_message)
-000111e0: 2020 2320 6e75 6d5f 626f 6e64 7320 7820    # num_bonds x 
-000111f0: 6869 6464 656e 5f73 697a 650a 0a20 2020  hidden_size..   
-00011200: 2020 2020 2023 206e 756d 5f61 746f 6d73       # num_atoms
-00011210: 2078 2068 6964 6465 6e5f 7369 7a65 0a20   x hidden_size. 
-00011220: 2020 2020 2020 2061 746f 6d73 5f68 6964         atoms_hid
-00011230: 6465 6e5f 7374 6174 6573 3a20 746f 7263  den_states: torc
-00011240: 682e 5465 6e73 6f72 203d 2073 656c 662e  h.Tensor = self.
-00011250: 5f67 6574 5f75 7064 6174 6564 5f61 746f  _get_updated_ato
-00011260: 6d73 5f68 6964 6465 6e5f 7374 6174 6528  ms_hidden_state(
-00011270: 0a20 2020 2020 2020 2020 2020 2061 746f  .            ato
-00011280: 6d5f 6665 6174 7572 6573 2c20 685f 6d65  m_features, h_me
-00011290: 7373 6167 652c 2061 746f 6d5f 746f 5f69  ssage, atom_to_i
-000112a0: 6e63 6f6d 696e 675f 626f 6e64 7329 0a0a  ncoming_bonds)..
-000112b0: 2020 2020 2020 2020 2320 6e75 6d5f 6d6f          # num_mo
-000112c0: 6c65 6375 6c65 7320 7820 6869 6464 656e  lecules x hidden
-000112d0: 5f73 697a 650a 2020 2020 2020 2020 6f75  _size.        ou
-000112e0: 7470 7574 3a20 746f 7263 682e 5465 6e73  tput: torch.Tens
-000112f0: 6f72 203d 2073 656c 662e 5f72 6561 646f  or = self._reado
-00011300: 7574 2861 746f 6d73 5f68 6964 6465 6e5f  ut(atoms_hidden_
-00011310: 7374 6174 6573 2c0a 2020 2020 2020 2020  states,.        
-00011320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011340: 2020 2020 206d 6f6c 6563 756c 6573 5f75       molecules_u
-00011350: 6e62 6174 6368 5f6b 6579 290a 0a20 2020  nbatch_key)..   
-00011360: 2020 2020 2023 2063 6f6e 6361 7420 676c       # concat gl
-00011370: 6f62 616c 2066 6561 7475 7265 730a 2020  obal features.  
-00011380: 2020 2020 2020 6966 2067 6c6f 6261 6c5f        if global_
-00011390: 6665 6174 7572 6573 2e73 697a 6528 295b  features.size()[
-000113a0: 305d 2021 3d20 303a 0a20 2020 2020 2020  0] != 0:.       
-000113b0: 2020 2020 2069 6620 6c65 6e28 676c 6f62       if len(glob
-000113c0: 616c 5f66 6561 7475 7265 732e 7368 6170  al_features.shap
-000113d0: 6529 203d 3d20 313a 0a20 2020 2020 2020  e) == 1:.       
-000113e0: 2020 2020 2020 2020 2067 6c6f 6261 6c5f           global_
-000113f0: 6665 6174 7572 6573 203d 2067 6c6f 6261  features = globa
-00011400: 6c5f 6665 6174 7572 6573 2e76 6965 7728  l_features.view(
-00011410: 6c65 6e28 6f75 7470 7574 292c 202d 3129  len(output), -1)
-00011420: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-00011430: 7075 7420 3d20 746f 7263 682e 6361 7428  put = torch.cat(
-00011440: 5b6f 7574 7075 742c 2067 6c6f 6261 6c5f  [output, global_
-00011450: 6665 6174 7572 6573 5d2c 2064 696d 3d31  features], dim=1
-00011460: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-00011470: 6e20 6f75 7470 7574 2020 2320 6e75 6d5f  n output  # num_
-00011480: 6d6f 6c65 6375 6c65 7320 7820 6869 6464  molecules x hidd
-00011490: 656e 5f73 697a 650a 0a0a 636c 6173 7320  en_size...class 
-000114a0: 496e 7465 7261 746f 6d69 634c 3244 6973  InteratomicL2Dis
-000114b0: 7461 6e63 6573 286e 6e2e 4d6f 6475 6c65  tances(nn.Module
-000114c0: 293a 0a20 2020 2022 2222 436f 6d70 7574  ):.    """Comput
-000114d0: 6520 2873 7175 6172 6564 2920 4c32 2044  e (squared) L2 D
-000114e0: 6973 7461 6e63 6573 2062 6574 7765 656e  istances between
-000114f0: 2061 746f 6d73 2067 6976 656e 206e 6569   atoms given nei
-00011500: 6768 626f 7273 2e0a 0a20 2020 2054 6869  ghbors...    Thi
-00011510: 7320 636c 6173 7320 6973 2074 6865 2070  s class is the p
-00011520: 7974 6f72 6368 2069 6d70 6c65 6d65 6e74  ytorch implement
-00011530: 6174 696f 6e20 6f66 2074 6865 206f 7269  ation of the ori
-00011540: 6769 6e61 6c20 496e 7465 7261 746f 6d69  ginal Interatomi
-00011550: 634c 3244 6973 7461 6e63 6573 206c 6179  cL2Distances lay
-00011560: 6572 2069 6d70 6c65 6d65 6e74 6564 2069  er implemented i
-00011570: 6e20 4b65 7261 732e 0a20 2020 2050 6169  n Keras..    Pai
-00011580: 7277 6973 6520 6469 7374 616e 6365 2028  rwise distance (
-00011590: 4c32 2920 6973 2063 616c 6375 6c61 7465  L2) is calculate
-000115a0: 6420 6265 7477 6565 6e20 696e 7075 7420  d between input 
-000115b0: 6174 6f6d 732c 2067 6976 656e 2074 6865  atoms, given the
-000115c0: 206e 756d 6265 7220 6f66 206e 6569 6768   number of neigh
-000115d0: 626f 7273 2074 6f20 636f 6e73 6964 6572  bors to consider
-000115e0: 2c20 616c 6f6e 6720 7769 7468 2074 6865  , along with the
-000115f0: 206e 756d 6265 7220 6f66 2064 6573 6372   number of descr
-00011600: 6970 746f 7273 2066 6f72 2065 7665 7279  iptors for every
-00011610: 2061 746f 6d2e 0a0a 2020 2020 4578 616d   atom...    Exam
-00011620: 706c 6573 0a20 2020 202d 2d2d 2d2d 2d2d  ples.    -------
-00011630: 2d0a 2020 2020 3e3e 3e20 6174 6f6d 7320  -.    >>> atoms 
-00011640: 3d20 350a 2020 2020 3e3e 3e20 6e65 6967  = 5.    >>> neig
-00011650: 6862 6f72 7320 3d20 320a 2020 2020 3e3e  hbors = 2.    >>
-00011660: 3e20 636f 6f72 6473 203d 206e 702e 7261  > coords = np.ra
-00011670: 6e64 6f6d 2e72 616e 6428 6174 6f6d 732c  ndom.rand(atoms,
-00011680: 2033 290a 2020 2020 3e3e 3e20 6e65 6967   3).    >>> neig
-00011690: 6862 6f72 5f6c 6973 7420 3d20 6e70 2e72  hbor_list = np.r
-000116a0: 616e 646f 6d2e 7261 6e64 696e 7428 302c  andom.randint(0,
-000116b0: 2061 746f 6d73 2c20 7369 7a65 3d28 6174   atoms, size=(at
-000116c0: 6f6d 732c 206e 6569 6768 626f 7273 2929  oms, neighbors))
-000116d0: 0a20 2020 203e 3e3e 206c 6179 6572 203d  .    >>> layer =
-000116e0: 2049 6e74 6572 6174 6f6d 6963 4c32 4469   InteratomicL2Di
-000116f0: 7374 616e 6365 7328 6174 6f6d 732c 206e  stances(atoms, n
-00011700: 6569 6768 626f 7273 2c20 3329 0a20 2020  eighbors, 3).   
-00011710: 203e 3e3e 2072 6573 756c 7420 3d20 6e70   >>> result = np
-00011720: 2e61 7272 6179 286c 6179 6572 285b 636f  .array(layer([co
-00011730: 6f72 6473 2c20 6e65 6967 6862 6f72 5f6c  ords, neighbor_l
-00011740: 6973 745d 2929 0a20 2020 203e 3e3e 2072  ist])).    >>> r
-00011750: 6573 756c 742e 7368 6170 650a 2020 2020  esult.shape.    
-00011760: 2835 2c20 3229 0a0a 2020 2020 2222 220a  (5, 2)..    """.
-00011770: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-00011780: 5f28 7365 6c66 2c20 4e5f 6174 6f6d 733a  _(self, N_atoms:
-00011790: 2069 6e74 2c20 4d5f 6e62 7273 3a20 696e   int, M_nbrs: in
-000117a0: 742c 206e 6469 6d3a 2069 6e74 2c20 2a2a  t, ndim: int, **
-000117b0: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
-000117c0: 2022 2222 436f 6e73 7472 7563 746f 7220   """Constructor 
-000117d0: 666f 7220 7468 6973 206c 6179 6572 2e0a  for this layer..
-000117e0: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-000117f0: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-00011800: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 204e  ------.        N
-00011810: 5f61 746f 6d73 3a20 696e 740a 2020 2020  _atoms: int.    
-00011820: 2020 2020 2020 2020 4e75 6d62 6572 206f          Number o
-00011830: 6620 6174 6f6d 7320 696e 2074 6865 2073  f atoms in the s
-00011840: 7973 7465 6d20 746f 7461 6c2e 0a20 2020  ystem total..   
-00011850: 2020 2020 204d 5f6e 6272 733a 2069 6e74       M_nbrs: int
-00011860: 0a20 2020 2020 2020 2020 2020 204e 756d  .            Num
-00011870: 6265 7220 6f66 206e 6569 6768 626f 7273  ber of neighbors
-00011880: 2074 6f20 636f 6e73 6964 6572 2077 6865   to consider whe
-00011890: 6e20 636f 6d70 7574 696e 6720 6469 7374  n computing dist
-000118a0: 616e 6365 732e 0a20 2020 2020 2020 206e  ances..        n
-000118b0: 5f64 696d 3a20 2069 6e74 0a20 2020 2020  _dim:  int.     
-000118c0: 2020 2020 2020 204e 756d 6265 7220 6f66         Number of
-000118d0: 2064 6573 6372 6970 746f 7273 2066 6f72   descriptors for
-000118e0: 2065 6163 6820 6174 6f6d 2e0a 2020 2020   each atom..    
-000118f0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00011900: 7375 7065 7228 496e 7465 7261 746f 6d69  super(Interatomi
-00011910: 634c 3244 6973 7461 6e63 6573 2c20 7365  cL2Distances, se
-00011920: 6c66 292e 5f5f 696e 6974 5f5f 282a 2a6b  lf).__init__(**k
-00011930: 7761 7267 7329 0a20 2020 2020 2020 2073  wargs).        s
-00011940: 656c 662e 4e5f 6174 6f6d 7320 3d20 4e5f  elf.N_atoms = N_
-00011950: 6174 6f6d 730a 2020 2020 2020 2020 7365  atoms.        se
-00011960: 6c66 2e4d 5f6e 6272 7320 3d20 4d5f 6e62  lf.M_nbrs = M_nb
-00011970: 7273 0a20 2020 2020 2020 2073 656c 662e  rs.        self.
-00011980: 6e64 696d 203d 206e 6469 6d0a 0a20 2020  ndim = ndim..   
-00011990: 2064 6566 205f 5f72 6570 725f 5f28 7365   def __repr__(se
-000119a0: 6c66 2920 2d3e 2073 7472 3a0a 2020 2020  lf) -> str:.    
-000119b0: 2020 2020 7265 7475 726e 2028 0a20 2020      return (.   
-000119c0: 2020 2020 2020 2020 2066 277b 7365 6c66           f'{self
-000119d0: 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  .__class__.__nam
-000119e0: 655f 5f7d 284e 5f61 746f 6d73 3d7b 7365  e__}(N_atoms={se
-000119f0: 6c66 2e4e 5f61 746f 6d73 7d2c 204d 5f6e  lf.N_atoms}, M_n
-00011a00: 6272 733d 7b73 656c 662e 4d5f 6e62 7273  brs={self.M_nbrs
-00011a10: 7d2c 206e 6469 6d3d 7b73 656c 662e 6e64  }, ndim={self.nd
-00011a20: 696d 7d29 270a 2020 2020 2020 2020 290a  im})'.        ).
-00011a30: 0a20 2020 2064 6566 2066 6f72 7761 7264  .    def forward
-00011a40: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
-00011a50: 696e 7075 7473 3a20 4c69 7374 5b55 6e69  inputs: List[Uni
-00011a60: 6f6e 5b74 6f72 6368 2e54 656e 736f 722c  on[torch.Tensor,
-00011a70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a90: 2020 4c69 7374 5b55 6e69 6f6e 5b69 6e74    List[Union[int
-00011aa0: 2c20 666c 6f61 745d 5d5d 5d29 202d 3e20  , float]]]]) -> 
-00011ab0: 746f 7263 682e 5465 6e73 6f72 3a0a 2020  torch.Tensor:.  
-00011ac0: 2020 2020 2020 2222 2249 6e76 6f6b 6573        """Invokes
-00011ad0: 2074 6869 7320 6c61 7965 722e 0a0a 2020   this layer...  
-00011ae0: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-00011af0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00011b00: 2d2d 2d0a 2020 2020 2020 2020 696e 7075  ---.        inpu
-00011b10: 7473 3a20 6c69 7374 0a20 2020 2020 2020  ts: list.       
-00011b20: 2020 2020 2053 686f 756c 6420 6265 206f       Should be o
-00011b30: 6620 666f 726d 2060 696e 7075 7473 3d5b  f form `inputs=[
-00011b40: 636f 6f72 6473 2c20 6e62 725f 6c69 7374  coords, nbr_list
-00011b50: 5d60 2077 6865 7265 2060 636f 6f72 6473  ]` where `coords
-00011b60: 6020 6973 2061 0a20 2020 2020 2020 2020  ` is a.         
-00011b70: 2020 2074 656e 736f 7220 6f66 2073 6861     tensor of sha
-00011b80: 7065 2060 284e 6f6e 652c 204e 2c20 3329  pe `(None, N, 3)
-00011b90: 6020 616e 6420 606e 6272 5f6c 6973 7460  ` and `nbr_list`
-00011ba0: 2069 7320 6120 6c69 7374 2e0a 0a20 2020   is a list...   
-00011bb0: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
-00011bc0: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
-00011bd0: 2020 2020 2054 656e 736f 7220 6f66 2073       Tensor of s
-00011be0: 6861 7065 2060 284e 5f61 746f 6d73 2c20  hape `(N_atoms, 
-00011bf0: 4d5f 6e62 7273 2960 2077 6974 6820 696e  M_nbrs)` with in
-00011c00: 7465 7261 746f 6d69 6320 6469 7374 616e  teratomic distan
-00011c10: 6365 732e 0a20 2020 2020 2020 2022 2222  ces..        """
-00011c20: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-00011c30: 696e 7075 7473 2920 213d 2032 3a0a 2020  inputs) != 2:.  
-00011c40: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00011c50: 5661 6c75 6545 7272 6f72 2822 496e 7465  ValueError("Inte
-00011c60: 7261 746f 6d69 6344 6973 7461 6e63 6573  ratomicDistances
-00011c70: 2072 6571 7569 7265 7320 636f 6f72 6473   requires coords
-00011c80: 2c6e 6272 5f6c 6973 7422 290a 2020 2020  ,nbr_list").    
-00011c90: 2020 2020 636f 6f72 6473 2c20 6e62 725f      coords, nbr_
-00011ca0: 6c69 7374 203d 2028 746f 7263 682e 7465  list = (torch.te
-00011cb0: 6e73 6f72 2869 6e70 7574 735b 305d 292c  nsor(inputs[0]),
-00011cc0: 2074 6f72 6368 2e74 656e 736f 7228 696e   torch.tensor(in
-00011cd0: 7075 7473 5b31 5d29 290a 2020 2020 2020  puts[1])).      
-00011ce0: 2020 4e5f 6174 6f6d 732c 204d 5f6e 6272    N_atoms, M_nbr
-00011cf0: 732c 206e 6469 6d20 3d20 7365 6c66 2e4e  s, ndim = self.N
-00011d00: 5f61 746f 6d73 2c20 7365 6c66 2e4d 5f6e  _atoms, self.M_n
-00011d10: 6272 732c 2073 656c 662e 6e64 696d 0a20  brs, self.ndim. 
-00011d20: 2020 2020 2020 2023 2053 6861 7065 2028         # Shape (
-00011d30: 4e5f 6174 6f6d 732c 204d 5f6e 6272 732c  N_atoms, M_nbrs,
-00011d40: 206e 6469 6d29 0a20 2020 2020 2020 206e   ndim).        n
-00011d50: 6272 5f63 6f6f 7264 7320 3d20 636f 6f72  br_coords = coor
-00011d60: 6473 5b6e 6272 5f6c 6973 742e 6c6f 6e67  ds[nbr_list.long
-00011d70: 2829 5d0a 2020 2020 2020 2020 2320 5368  ()].        # Sh
-00011d80: 6170 6520 284e 5f61 746f 6d73 2c20 4d5f  ape (N_atoms, M_
-00011d90: 6e62 7273 2c20 6e64 696d 290a 2020 2020  nbrs, ndim).    
-00011da0: 2020 2020 7469 6c65 645f 636f 6f72 6473      tiled_coords
-00011db0: 203d 2074 6f72 6368 2e74 696c 6528 746f   = torch.tile(to
-00011dc0: 7263 682e 7265 7368 6170 6528 636f 6f72  rch.reshape(coor
-00011dd0: 6473 2c20 284e 5f61 746f 6d73 2c20 312c  ds, (N_atoms, 1,
-00011de0: 206e 6469 6d29 292c 0a20 2020 2020 2020   ndim)),.       
-00011df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011e00: 2020 2020 2020 2020 2020 2028 312c 204d             (1, M
-00011e10: 5f6e 6272 732c 2031 2929 0a20 2020 2020  _nbrs, 1)).     
-00011e20: 2020 2023 2053 6861 7065 2028 4e5f 6174     # Shape (N_at
-00011e30: 6f6d 732c 204d 5f6e 6272 7329 0a20 2020  oms, M_nbrs).   
-00011e40: 2020 2020 2072 6574 7572 6e20 746f 7263       return torc
-00011e50: 682e 7375 6d28 2874 696c 6564 5f63 6f6f  h.sum((tiled_coo
-00011e60: 7264 7320 2d20 6e62 725f 636f 6f72 6473  rds - nbr_coords
-00011e70: 292a 2a32 2c20 6469 6d3d 3229 0a0a 0a63  )**2, dim=2)...c
-00011e80: 6c61 7373 2052 6561 6c4e 5650 4c61 7965  lass RealNVPLaye
-00011e90: 7228 6e6e 2e4d 6f64 756c 6529 3a0a 2020  r(nn.Module):.  
-00011ea0: 2020 2222 2252 6561 6c20 4e56 5020 5472    """Real NVP Tr
-00011eb0: 616e 7366 6f72 6d61 7469 6f6e 204c 6179  ansformation Lay
-00011ec0: 6572 0a0a 2020 2020 5468 6973 2063 6c61  er..    This cla
-00011ed0: 7373 2063 6c61 7373 2069 7320 6120 636f  ss class is a co
-00011ee0: 6e73 7472 7563 746f 7220 7472 616e 7366  nstructor transf
-00011ef0: 6f72 6d61 7469 6f6e 206c 6179 6572 2075  ormation layer u
-00011f00: 7365 6420 6f6e 2061 0a20 2020 204e 6f72  sed on a.    Nor
-00011f10: 6d61 6c69 7a69 6e67 464c 6f77 206d 6f64  malizingFLow mod
-00011f20: 656c 2e20 2054 6865 2052 6561 6c20 4e6f  el.  The Real No
-00011f30: 6e2d 5072 6573 6572 7669 6e67 2d56 6f6c  n-Preserving-Vol
-00011f40: 756d 656e 2028 5265 616c 204e 5650 2920  umen (Real NVP) 
-00011f50: 6973 2061 2074 7970 650a 2020 2020 6f66  is a type.    of
-00011f60: 206e 6f72 6d61 6c69 7a69 6e67 2066 6c6f   normalizing flo
-00011f70: 7720 6c61 7965 7220 7768 6963 6820 6769  w layer which gi
-00011f80: 7665 7320 6164 7661 6e74 6167 6573 206f  ves advantages o
-00011f90: 7665 7220 7468 6973 206d 6169 6e6c 7920  ver this mainly 
-00011fa0: 6265 6361 7573 6520 616e 0a20 2020 2065  because an.    e
-00011fb0: 6173 6520 746f 2063 6f6d 7075 7465 2074  ase to compute t
-00011fc0: 6865 2069 6e76 6572 7365 2070 6173 7320  he inverse pass 
-00011fd0: 5b31 5d5f 2c20 7468 6973 2069 7320 746f  [1]_, this is to
-00011fe0: 206c 6561 726e 2061 2074 6172 6765 740a   learn a target.
-00011ff0: 2020 2020 6469 7374 7269 6275 7469 6f6e      distribution
-00012000: 2e0a 0a20 2020 2045 7861 6d70 6c65 0a20  ...    Example. 
-00012010: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 203e     -------.    >
-00012020: 3e3e 2069 6d70 6f72 7420 746f 7263 680a  >> import torch.
-00012030: 2020 2020 3e3e 3e20 696d 706f 7274 2074      >>> import t
-00012040: 6f72 6368 2e6e 6e20 6173 206e 6e0a 2020  orch.nn as nn.  
-00012050: 2020 3e3e 3e20 6672 6f6d 2074 6f72 6368    >>> from torch
-00012060: 2e64 6973 7472 6962 7574 696f 6e73 2069  .distributions i
-00012070: 6d70 6f72 7420 4d75 6c74 6976 6172 6961  mport Multivaria
-00012080: 7465 4e6f 726d 616c 0a20 2020 203e 3e3e  teNormal.    >>>
-00012090: 2066 726f 6d20 6465 6570 6368 656d 2e6d   from deepchem.m
-000120a0: 6f64 656c 732e 746f 7263 685f 6d6f 6465  odels.torch_mode
-000120b0: 6c73 2e6c 6179 6572 7320 696d 706f 7274  ls.layers import
-000120c0: 2052 6561 6c4e 5650 4c61 7965 720a 2020   RealNVPLayer.  
-000120d0: 2020 3e3e 3e20 6469 6d20 3d20 320a 2020    >>> dim = 2.  
-000120e0: 2020 3e3e 3e20 7361 6d70 6c65 7320 3d20    >>> samples = 
-000120f0: 3936 0a20 2020 203e 3e3e 2064 6174 6120  96.    >>> data 
-00012100: 3d20 4d75 6c74 6976 6172 6961 7465 4e6f  = MultivariateNo
-00012110: 726d 616c 2874 6f72 6368 2e7a 6572 6f73  rmal(torch.zeros
-00012120: 2864 696d 292c 2074 6f72 6368 2e65 7965  (dim), torch.eye
-00012130: 2864 696d 2929 0a20 2020 203e 3e3e 2074  (dim)).    >>> t
-00012140: 656e 736f 7220 3d20 6461 7461 2e73 616d  ensor = data.sam
-00012150: 706c 6528 746f 7263 682e 5369 7a65 2828  ple(torch.Size((
-00012160: 7361 6d70 6c65 732c 2064 696d 2929 290a  samples, dim))).
-00012170: 0a20 2020 203e 3e3e 206c 6179 6572 7320  .    >>> layers 
-00012180: 3d20 340a 2020 2020 3e3e 3e20 6869 6464  = 4.    >>> hidd
-00012190: 656e 5f73 697a 6520 3d20 3136 0a20 2020  en_size = 16.   
-000121a0: 203e 3e3e 206d 6173 6b73 203d 2046 2e6f   >>> masks = F.o
-000121b0: 6e65 5f68 6f74 2874 6f72 6368 2e74 656e  ne_hot(torch.ten
-000121c0: 736f 7228 5b69 2025 2032 2066 6f72 2069  sor([i % 2 for i
-000121d0: 2069 6e20 7261 6e67 6528 6c61 7965 7273   in range(layers
-000121e0: 295d 2929 2e66 6c6f 6174 2829 0a20 2020  )])).float().   
-000121f0: 203e 3e3e 206c 6179 6572 7320 3d20 6e6e   >>> layers = nn
-00012200: 2e4d 6f64 756c 654c 6973 7428 5b52 6561  .ModuleList([Rea
-00012210: 6c4e 5650 4c61 7965 7228 6d61 736b 2c20  lNVPLayer(mask, 
-00012220: 6869 6464 656e 5f73 697a 6529 2066 6f72  hidden_size) for
-00012230: 206d 6173 6b20 696e 206d 6173 6b73 5d29   mask in masks])
-00012240: 0a0a 2020 2020 3e3e 3e20 666f 7220 6c61  ..    >>> for la
-00012250: 7965 7220 696e 206c 6179 6572 733a 0a20  yer in layers:. 
-00012260: 2020 202e 2e2e 2020 205f 2c20 696e 7665     ...   _, inve
-00012270: 7273 655f 6c6f 675f 6465 745f 6a61 636f  rse_log_det_jaco
-00012280: 6269 616e 203d 206c 6179 6572 2e69 6e76  bian = layer.inv
-00012290: 6572 7365 2874 656e 736f 7229 0a20 2020  erse(tensor).   
-000122a0: 202e 2e2e 2020 2069 6e76 6572 7365 5f6c   ...   inverse_l
-000122b0: 6f67 5f64 6574 5f6a 6163 6f62 6961 6e20  og_det_jacobian 
-000122c0: 3d20 696e 7665 7273 655f 6c6f 675f 6465  = inverse_log_de
-000122d0: 745f 6a61 636f 6269 616e 2e64 6574 6163  t_jacobian.detac
-000122e0: 6828 292e 6e75 6d70 7928 290a 2020 2020  h().numpy().    
-000122f0: 3e3e 3e20 6c65 6e28 696e 7665 7273 655f  >>> len(inverse_
-00012300: 6c6f 675f 6465 745f 6a61 636f 6269 616e  log_det_jacobian
-00012310: 290a 2020 2020 3936 0a0a 2020 2020 5265  ).    96..    Re
-00012320: 6665 7265 6e63 6573 0a20 2020 202d 2d2d  ferences.    ---
-00012330: 2d2d 2d2d 2d2d 2d0a 2020 2020 2e2e 205b  -------.    .. [
-00012340: 315d 2053 7469 6d70 6572 2c20 562e 2c20  1] Stimper, V., 
-00012350: 5363 68c3 b66c 6b6f 7066 2c20 422e 2c20  Sch..lkopf, B., 
-00012360: 2620 4865 726e c3a1 6e64 657a 2d4c 6f62  & Hern..ndez-Lob
-00012370: 6174 6f2c 204a 2e20 4d2e 2028 3230 3231  ato, J. M. (2021
-00012380: 292e 2052 6573 616d 706c 696e 6720 4261  ). Resampling Ba
-00012390: 7365 0a20 2020 2044 6973 7472 6962 7574  se.    Distribut
-000123a0: 696f 6e73 206f 6620 4e6f 726d 616c 697a  ions of Normaliz
-000123b0: 696e 6720 466c 6f77 732e 2028 3230 3137  ing Flows. (2017
-000123c0: 292e 2052 6574 7269 6576 6564 2066 726f  ). Retrieved fro
-000123d0: 6d20 6874 7470 3a2f 2f61 7278 6976 2e6f  m http://arxiv.o
-000123e0: 7267 2f61 6273 2f32 3131 302e 3135 3832  rg/abs/2110.1582
-000123f0: 380a 2020 2020 2222 220a 0a20 2020 2064  8.    """..    d
-00012400: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-00012410: 2c20 6d61 736b 3a20 746f 7263 682e 5465  , mask: torch.Te
-00012420: 6e73 6f72 2c20 6869 6464 656e 5f73 697a  nsor, hidden_siz
-00012430: 653a 2069 6e74 2920 2d3e 204e 6f6e 653a  e: int) -> None:
-00012440: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00012450: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-00012460: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00012470: 2d2d 2d0a 2020 2020 2020 2020 6d61 736b  ---.        mask
-00012480: 3a20 746f 7263 682e 5465 6e73 6f72 0a20  : torch.Tensor. 
-00012490: 2020 2020 2020 2020 2020 2054 656e 736f             Tenso
-000124a0: 7220 7769 7468 207a 6572 6f73 2061 6e64  r with zeros and
-000124b0: 206f 6e65 7320 616e 6420 6974 7320 7369   ones and its si
-000124c0: 7a65 2064 6570 656e 6465 206f 6e20 7468  ze depende on th
-000124d0: 6520 6e75 6d62 6572 206f 6620 6c61 7965  e number of laye
-000124e0: 7273 0a20 2020 2020 2020 2020 2020 2061  rs.            a
-000124f0: 6e64 2064 696d 656e 7373 696f 6e73 2074  nd dimenssions t
-00012500: 6865 2075 7365 7220 7265 7175 6573 742e  he user request.
-00012510: 0a20 2020 2020 2020 2068 6964 6465 6e5f  .        hidden_
-00012520: 7369 7a65 3a20 696e 740a 2020 2020 2020  size: int.      
-00012530: 2020 2020 2020 5468 6520 7369 7a65 206f        The size o
-00012540: 6620 7468 6520 6f75 7470 7574 7320 616e  f the outputs an
-00012550: 6420 696e 7075 7473 2075 7365 6420 6f6e  d inputs used on
-00012560: 2074 6865 2069 6e74 6572 6e61 6c20 6e6f   the internal no
-00012570: 6465 7320 6f66 2074 6865 0a20 2020 2020  des of the.     
-00012580: 2020 2020 2020 2074 7261 6e73 666f 726d         transform
-00012590: 6174 696f 6e20 6c61 7965 722e 0a0a 2020  ation layer...  
-000125a0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000125b0: 2020 7375 7065 7228 5265 616c 4e56 504c    super(RealNVPL
-000125c0: 6179 6572 2c20 7365 6c66 292e 5f5f 696e  ayer, self).__in
-000125d0: 6974 5f5f 2829 0a20 2020 2020 2020 2073  it__().        s
-000125e0: 656c 662e 6d61 736b 203d 206e 6e2e 5061  elf.mask = nn.Pa
-000125f0: 7261 6d65 7465 7228 6d61 736b 2c20 7265  rameter(mask, re
-00012600: 7175 6972 6573 5f67 7261 643d 4661 6c73  quires_grad=Fals
-00012610: 6529 0a20 2020 2020 2020 2073 656c 662e  e).        self.
-00012620: 6469 6d20 3d20 6c65 6e28 6d61 736b 290a  dim = len(mask).
-00012630: 0a20 2020 2020 2020 2073 656c 662e 735f  .        self.s_
-00012640: 6675 6e63 203d 206e 6e2e 5365 7175 656e  func = nn.Sequen
-00012650: 7469 616c 280a 2020 2020 2020 2020 2020  tial(.          
-00012660: 2020 6e6e 2e4c 696e 6561 7228 696e 5f66    nn.Linear(in_f
-00012670: 6561 7475 7265 733d 7365 6c66 2e64 696d  eatures=self.dim
-00012680: 2c20 6f75 745f 6665 6174 7572 6573 3d68  , out_features=h
-00012690: 6964 6465 6e5f 7369 7a65 292c 0a20 2020  idden_size),.   
-000126a0: 2020 2020 2020 2020 206e 6e2e 4c65 616b           nn.Leak
-000126b0: 7952 654c 5528 292c 0a20 2020 2020 2020  yReLU(),.       
-000126c0: 2020 2020 206e 6e2e 4c69 6e65 6172 2869       nn.Linear(i
-000126d0: 6e5f 6665 6174 7572 6573 3d68 6964 6465  n_features=hidde
-000126e0: 6e5f 7369 7a65 2c20 6f75 745f 6665 6174  n_size, out_feat
-000126f0: 7572 6573 3d68 6964 6465 6e5f 7369 7a65  ures=hidden_size
-00012700: 292c 0a20 2020 2020 2020 2020 2020 206e  ),.            n
-00012710: 6e2e 4c65 616b 7952 654c 5528 292c 0a20  n.LeakyReLU(),. 
-00012720: 2020 2020 2020 2020 2020 206e 6e2e 4c69             nn.Li
-00012730: 6e65 6172 2869 6e5f 6665 6174 7572 6573  near(in_features
-00012740: 3d68 6964 6465 6e5f 7369 7a65 2c20 6f75  =hidden_size, ou
-00012750: 745f 6665 6174 7572 6573 3d73 656c 662e  t_features=self.
-00012760: 6469 6d29 290a 0a20 2020 2020 2020 2073  dim))..        s
-00012770: 656c 662e 7363 616c 6520 3d20 6e6e 2e50  elf.scale = nn.P
-00012780: 6172 616d 6574 6572 2874 6f72 6368 2e54  arameter(torch.T
-00012790: 656e 736f 7228 7365 6c66 2e64 696d 2929  ensor(self.dim))
-000127a0: 0a0a 2020 2020 2020 2020 7365 6c66 2e74  ..        self.t
-000127b0: 5f66 756e 6320 3d20 6e6e 2e53 6571 7565  _func = nn.Seque
-000127c0: 6e74 6961 6c28 0a20 2020 2020 2020 2020  ntial(.         
-000127d0: 2020 206e 6e2e 4c69 6e65 6172 2869 6e5f     nn.Linear(in_
-000127e0: 6665 6174 7572 6573 3d73 656c 662e 6469  features=self.di
-000127f0: 6d2c 206f 7574 5f66 6561 7475 7265 733d  m, out_features=
-00012800: 6869 6464 656e 5f73 697a 6529 2c0a 2020  hidden_size),.  
-00012810: 2020 2020 2020 2020 2020 6e6e 2e4c 6561            nn.Lea
-00012820: 6b79 5265 4c55 2829 2c0a 2020 2020 2020  kyReLU(),.      
-00012830: 2020 2020 2020 6e6e 2e4c 696e 6561 7228        nn.Linear(
-00012840: 696e 5f66 6561 7475 7265 733d 6869 6464  in_features=hidd
-00012850: 656e 5f73 697a 652c 206f 7574 5f66 6561  en_size, out_fea
-00012860: 7475 7265 733d 6869 6464 656e 5f73 697a  tures=hidden_siz
-00012870: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
-00012880: 6e6e 2e4c 6561 6b79 5265 4c55 2829 2c0a  nn.LeakyReLU(),.
-00012890: 2020 2020 2020 2020 2020 2020 6e6e 2e4c              nn.L
-000128a0: 696e 6561 7228 696e 5f66 6561 7475 7265  inear(in_feature
-000128b0: 733d 6869 6464 656e 5f73 697a 652c 206f  s=hidden_size, o
-000128c0: 7574 5f66 6561 7475 7265 733d 7365 6c66  ut_features=self
-000128d0: 2e64 696d 2929 0a0a 2020 2020 6465 6620  .dim))..    def 
-000128e0: 666f 7277 6172 6428 7365 6c66 2c20 783a  forward(self, x:
-000128f0: 2053 6571 7565 6e63 6529 202d 3e20 5475   Sequence) -> Tu
-00012900: 706c 655b 746f 7263 682e 5465 6e73 6f72  ple[torch.Tensor
-00012910: 2c20 746f 7263 682e 5465 6e73 6f72 5d3a  , torch.Tensor]:
-00012920: 0a20 2020 2020 2020 2022 2222 466f 7277  .        """Forw
-00012930: 6172 6420 7061 7373 2e0a 0a20 2020 2020  ard pass...     
-00012940: 2020 2054 6869 7320 7061 7274 6963 756c     This particul
-00012950: 6172 2074 7261 6e73 666f 726d 6174 696f  ar transformatio
-00012960: 6e20 6973 2072 6570 7265 7365 6e74 6564  n is represented
-00012970: 2062 7920 7468 6520 666f 6c6c 6f77 696e   by the followin
-00012980: 6720 6675 6e63 7469 6f6e 3a0a 2020 2020  g function:.    
-00012990: 2020 2020 7920 3d20 7820 2b20 2831 202d      y = x + (1 -
-000129a0: 2078 2920 2a20 6578 7028 2073 2878 2929   x) * exp( s(x))
-000129b0: 202b 2074 2878 292c 2077 6865 7265 2074   + t(x), where t
-000129c0: 2061 6e64 2073 206e 6565 6473 2061 6e20   and s needs an 
-000129d0: 6163 7469 7661 7469 6f6e 0a20 2020 2020  activation.     
-000129e0: 2020 2066 756e 6374 696f 6e2e 2054 6869     function. Thi
-000129f0: 7320 636c 6173 7320 616c 736f 2072 6574  s class also ret
-00012a00: 7572 6e73 2074 6865 206c 6f67 6172 6974  urns the logarit
-00012a10: 686d 206f 6620 7468 6520 6a61 636f 6269  hm of the jacobi
-00012a20: 616e 730a 2020 2020 2020 2020 6465 7465  ans.        dete
-00012a30: 726d 696e 616e 7420 7768 6963 6820 6973  rminant which is
-00012a40: 2075 7365 6675 6c20 7768 656e 2069 6e76   useful when inv
-00012a50: 6572 7420 6120 7472 616e 7366 6f72 6d61  ert a transforma
-00012a60: 7469 6f6e 2061 6e64 2063 6f6d 7075 7465  tion and compute
-00012a70: 0a20 2020 2020 2020 2074 6865 2070 726f  .        the pro
-00012a80: 6261 6269 6c69 7479 206f 6620 7468 6520  bability of the 
-00012a90: 7472 616e 7366 6f72 6d61 7469 6f6e 2e0a  transformation..
-00012aa0: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-00012ab0: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-00012ac0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2078  ------.        x
-00012ad0: 203a 2053 6571 7565 6e63 650a 2020 2020   : Sequence.    
-00012ae0: 2020 2020 2020 2020 5465 6e73 6f72 2073          Tensor s
-00012af0: 616d 706c 6520 7769 7468 2074 6865 2069  ample with the i
-00012b00: 6e69 7469 616c 2064 6973 7472 6962 7574  nitial distribut
-00012b10: 696f 6e20 6461 7461 2077 6869 6368 2077  ion data which w
-00012b20: 696c 6c20 7061 7373 2069 6e74 6f0a 2020  ill pass into.  
-00012b30: 2020 2020 2020 2020 2020 7468 6520 6e6f            the no
-00012b40: 726d 616c 697a 696e 6720 616c 676f 7269  rmalizing algori
-00012b50: 7468 6d0a 0a20 2020 2020 2020 2052 6574  thm..        Ret
-00012b60: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
-00012b70: 2d2d 2d2d 0a20 2020 2020 2020 2079 203a  ----.        y :
-00012b80: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
-00012b90: 2020 2020 2020 2020 2020 5472 616e 7366            Transf
-00012ba0: 6f72 6d65 6420 7465 6e73 6f72 2061 6363  ormed tensor acc
-00012bb0: 6f72 6469 6e67 2074 6f20 5265 616c 204e  ording to Real N
-00012bc0: 5650 206c 6179 6572 2077 6974 6820 7468  VP layer with th
-00012bd0: 6520 7368 6170 6520 6f66 2027 7827 2e0a  e shape of 'x'..
-00012be0: 2020 2020 2020 2020 6c6f 675f 6465 745f          log_det_
-00012bf0: 6a61 636f 6269 616e 203a 2074 6f72 6368  jacobian : torch
-00012c00: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
-00012c10: 2020 2020 5465 6e73 6f72 2077 6869 6368      Tensor which
-00012c20: 2072 6570 7265 7365 6e74 7320 7468 6520   represents the 
-00012c30: 696e 666f 2061 626f 7574 2074 6865 2064  info about the d
-00012c40: 6576 6961 7469 6f6e 206f 6620 7468 6520  eviation of the 
-00012c50: 696e 6974 6961 6c0a 2020 2020 2020 2020  initial.        
-00012c60: 2020 2020 616e 6420 7461 7267 6574 2064      and target d
-00012c70: 6973 7472 6962 7574 696f 6e2e 0a0a 2020  istribution...  
-00012c80: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00012c90: 2020 785f 6d61 736b 203d 2078 202a 2073    x_mask = x * s
-00012ca0: 656c 662e 6d61 736b 0a20 2020 2020 2020  elf.mask.       
-00012cb0: 2073 203d 2073 656c 662e 735f 6675 6e63   s = self.s_func
-00012cc0: 2878 5f6d 6173 6b29 202a 2073 656c 662e  (x_mask) * self.
-00012cd0: 7363 616c 650a 2020 2020 2020 2020 7420  scale.        t 
-00012ce0: 3d20 7365 6c66 2e74 5f66 756e 6328 785f  = self.t_func(x_
-00012cf0: 6d61 736b 290a 0a20 2020 2020 2020 2079  mask)..        y
-00012d00: 203d 2078 5f6d 6173 6b20 2b20 2831 202d   = x_mask + (1 -
-00012d10: 2073 656c 662e 6d61 736b 2920 2a20 2878   self.mask) * (x
-00012d20: 202a 2074 6f72 6368 2e65 7870 2873 2920   * torch.exp(s) 
-00012d30: 2b20 7429 0a0a 2020 2020 2020 2020 6c6f  + t)..        lo
-00012d40: 675f 6465 745f 6a61 636f 6269 616e 203d  g_det_jacobian =
-00012d50: 2028 2831 202d 2073 656c 662e 6d61 736b   ((1 - self.mask
-00012d60: 2920 2a20 7329 2e73 756d 282d 3129 0a20  ) * s).sum(-1). 
-00012d70: 2020 2020 2020 2072 6574 7572 6e20 792c         return y,
-00012d80: 206c 6f67 5f64 6574 5f6a 6163 6f62 6961   log_det_jacobia
-00012d90: 6e0a 0a20 2020 2064 6566 2069 6e76 6572  n..    def inver
-00012da0: 7365 2873 656c 662c 2079 3a20 5365 7175  se(self, y: Sequ
-00012db0: 656e 6365 2920 2d3e 2054 7570 6c65 5b74  ence) -> Tuple[t
-00012dc0: 6f72 6368 2e54 656e 736f 722c 2074 6f72  orch.Tensor, tor
-00012dd0: 6368 2e54 656e 736f 725d 3a0a 2020 2020  ch.Tensor]:.    
-00012de0: 2020 2020 2222 2220 496e 7665 7273 6520      """ Inverse 
-00012df0: 7061 7373 0a0a 2020 2020 2020 2020 5468  pass..        Th
-00012e00: 6973 2063 6c61 7373 2070 6572 666f 726d  is class perform
-00012e10: 7320 7468 6520 696e 7665 7273 6520 6f66  s the inverse of
-00012e20: 2074 6865 2070 7265 7669 6f75 7320 6d65   the previous me
-00012e30: 7468 6f64 2028 666f 726d 7761 7264 292e  thod (formward).
-00012e40: 0a20 2020 2020 2020 2041 6c73 6f2c 2074  .        Also, t
-00012e50: 6869 7320 6d65 7465 686f 6420 7265 7475  his metehod retu
-00012e60: 726e 7320 7468 6520 6c6f 6761 7269 7468  rns the logarith
-00012e70: 6d20 6f66 2074 6865 206a 6163 6f62 6961  m of the jacobia
-00012e80: 6e73 2064 6574 6572 6d69 6e61 6e74 0a20  ns determinant. 
-00012e90: 2020 2020 2020 2077 6869 6368 2069 7320         which is 
-00012ea0: 7573 6566 756c 2074 6f20 636f 6d70 7574  useful to comput
-00012eb0: 6520 7468 6520 6c65 6172 6e65 6162 6c65  e the learneable
-00012ec0: 2066 6561 7475 7265 7320 6f66 2074 6172   features of tar
-00012ed0: 6765 7420 6469 7374 7269 6275 7469 6f6e  get distribution
-00012ee0: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
-00012ef0: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
-00012f00: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00012f10: 2079 203a 2053 6571 7565 6e63 650a 2020   y : Sequence.  
-00012f20: 2020 2020 2020 2020 2020 5465 6e73 6f72            Tensor
-00012f30: 2073 616d 706c 6520 7769 7468 2074 7261   sample with tra
-00012f40: 6e73 666f 726d 6564 2064 6973 7472 6962  nsformed distrib
-00012f50: 7574 696f 6e20 6461 7461 2077 6869 6368  ution data which
-00012f60: 2077 696c 6c20 6265 2075 7365 6420 696e   will be used in
-00012f70: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
-00012f80: 206e 6f72 6d61 6c69 7a69 6e67 2061 6c67   normalizing alg
-00012f90: 6f72 6974 686d 2069 6e76 6572 7365 2070  orithm inverse p
-00012fa0: 6173 732e 0a0a 2020 2020 2020 2020 5265  ass...        Re
-00012fb0: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
-00012fc0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7820  -----.        x 
-00012fd0: 3a20 746f 7263 682e 5465 6e73 6f72 0a20  : torch.Tensor. 
-00012fe0: 2020 2020 2020 2020 2020 2054 7261 6e73             Trans
-00012ff0: 666f 726d 6564 2074 656e 736f 7220 6163  formed tensor ac
-00013000: 636f 7264 696e 6720 746f 2052 6561 6c20  cording to Real 
-00013010: 4e56 5020 6c61 7965 7220 7769 7468 2074  NVP layer with t
-00013020: 6865 2073 6861 7065 206f 6620 2779 272e  he shape of 'y'.
-00013030: 0a20 2020 2020 2020 2069 6e76 6572 7365  .        inverse
-00013040: 5f6c 6f67 5f64 6574 5f6a 6163 6f62 6961  _log_det_jacobia
-00013050: 6e20 3a20 746f 7263 682e 5465 6e73 6f72  n : torch.Tensor
-00013060: 0a20 2020 2020 2020 2020 2020 2054 656e  .            Ten
-00013070: 736f 7220 7768 6963 6820 7265 7072 6573  sor which repres
-00013080: 656e 7473 2074 6865 2069 6e66 6f72 6d61  ents the informa
-00013090: 7469 6f6e 206f 6620 7468 6520 6465 7669  tion of the devi
-000130a0: 6174 696f 6e20 6f66 2074 6865 2069 6e69  ation of the ini
-000130b0: 7469 616c 0a20 2020 2020 2020 2020 2020  tial.           
-000130c0: 2061 6e64 2074 6172 6765 7420 6469 7374   and target dist
-000130d0: 7269 6275 7469 6f6e 2e0a 0a20 2020 2020  ribution...     
-000130e0: 2020 2022 2222 0a20 2020 2020 2020 2079     """.        y
-000130f0: 5f6d 6173 6b20 3d20 7920 2a20 7365 6c66  _mask = y * self
-00013100: 2e6d 6173 6b0a 2020 2020 2020 2020 7320  .mask.        s 
-00013110: 3d20 7365 6c66 2e73 5f66 756e 6328 795f  = self.s_func(y_
-00013120: 6d61 736b 2920 2a20 7365 6c66 2e73 6361  mask) * self.sca
-00013130: 6c65 0a20 2020 2020 2020 2074 203d 2073  le.        t = s
-00013140: 656c 662e 745f 6675 6e63 2879 5f6d 6173  elf.t_func(y_mas
-00013150: 6b29 0a0a 2020 2020 2020 2020 7820 3d20  k)..        x = 
-00013160: 795f 6d61 736b 202b 2028 3120 2d20 7365  y_mask + (1 - se
-00013170: 6c66 2e6d 6173 6b29 202a 2028 7920 2d20  lf.mask) * (y - 
-00013180: 7429 202a 2074 6f72 6368 2e65 7870 282d  t) * torch.exp(-
-00013190: 7329 0a0a 2020 2020 2020 2020 696e 7665  s)..        inve
-000131a0: 7273 655f 6c6f 675f 6465 745f 6a61 636f  rse_log_det_jaco
-000131b0: 6269 616e 203d 2028 2831 202d 2073 656c  bian = ((1 - sel
-000131c0: 662e 6d61 736b 2920 2a20 2d73 292e 7375  f.mask) * -s).su
-000131d0: 6d28 2d31 290a 0a20 2020 2020 2020 2072  m(-1)..        r
-000131e0: 6574 7572 6e20 782c 2069 6e76 6572 7365  eturn x, inverse
-000131f0: 5f6c 6f67 5f64 6574 5f6a 6163 6f62 6961  _log_det_jacobia
-00013200: 6e0a 0a0a 636c 6173 7320 4e65 6967 6862  n...class Neighb
-00013210: 6f72 4c69 7374 286e 6e2e 4d6f 6475 6c65  orList(nn.Module
-00013220: 293a 0a20 2020 2022 2222 436f 6d70 7574  ):.    """Comput
-00013230: 6573 2061 206e 6569 6768 626f 722d 6c69  es a neighbor-li
-00013240: 7374 2069 6e20 5079 546f 7263 682e 0a0a  st in PyTorch...
-00013250: 2020 2020 4e65 6967 6862 6f72 2d6c 6973      Neighbor-lis
-00013260: 7473 2028 616c 736f 2063 616c 6c65 6420  ts (also called 
-00013270: 5665 726c 6574 204c 6973 7473 2920 6172  Verlet Lists) ar
-00013280: 6520 6120 746f 6f6c 2066 6f72 2067 726f  e a tool for gro
-00013290: 7570 696e 670a 2020 2020 6174 6f6d 7320  uping.    atoms 
-000132a0: 7768 6963 6820 6172 6520 636c 6f73 6520  which are close 
-000132b0: 746f 2065 6163 6820 6f74 6865 7220 7370  to each other sp
-000132c0: 6174 6961 6c6c 792e 2054 6869 7320 6c61  atially. This la
-000132d0: 7965 7220 636f 6d70 7574 6573 2061 0a20  yer computes a. 
-000132e0: 2020 204e 6569 6768 626f 7220 4c69 7374     Neighbor List
-000132f0: 2066 726f 6d20 6120 7072 6f76 6964 6564   from a provided
-00013300: 2074 656e 736f 7220 6f66 2061 746f 6d69   tensor of atomi
-00013310: 6320 636f 6f72 6469 6e61 7465 732e 2059  c coordinates. Y
-00013320: 6f75 2063 616e 0a20 2020 2074 6869 6e6b  ou can.    think
-00013330: 206f 6620 7468 6973 2061 7320 6120 6765   of this as a ge
-00013340: 6e65 7261 6c20 226b 2d6d 6561 6e73 2220  neral "k-means" 
-00013350: 6c61 7965 722c 2062 7574 206f 7074 696d  layer, but optim
-00013360: 697a 6564 2066 6f72 2074 6865 0a20 2020  ized for the.   
-00013370: 2063 6173 6520 606b 3d3d 3360 2e0a 0a20   case `k==3`... 
-00013380: 2020 2045 7861 6d70 6c65 730a 2020 2020     Examples.    
-00013390: 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e 3e3e  --------.    >>>
-000133a0: 204e 5f61 746f 6d73 203d 2035 0a20 2020   N_atoms = 5.   
-000133b0: 203e 3e3e 2073 7461 7274 203d 2030 0a20   >>> start = 0. 
-000133c0: 2020 203e 3e3e 2073 746f 7020 3d20 3132     >>> stop = 12
-000133d0: 0a20 2020 203e 3e3e 206e 6272 5f63 7574  .    >>> nbr_cut
-000133e0: 6f66 6620 3d20 330a 2020 2020 3e3e 3e20  off = 3.    >>> 
-000133f0: 6e64 696d 203d 2033 0a20 2020 203e 3e3e  ndim = 3.    >>>
-00013400: 204d 5f6e 6272 7320 3d20 320a 2020 2020   M_nbrs = 2.    
-00013410: 3e3e 3e20 636f 6f72 6473 203d 2073 7461  >>> coords = sta
-00013420: 7274 202b 206e 702e 7261 6e64 6f6d 2e72  rt + np.random.r
-00013430: 616e 6428 4e5f 6174 6f6d 732c 206e 6469  and(N_atoms, ndi
-00013440: 6d29 202a 2028 7374 6f70 202d 2073 7461  m) * (stop - sta
-00013450: 7274 290a 2020 2020 3e3e 3e20 636f 6f72  rt).    >>> coor
-00013460: 6473 203d 2074 6f72 6368 2e61 735f 7465  ds = torch.as_te
-00013470: 6e73 6f72 2863 6f6f 7264 732c 2064 7479  nsor(coords, dty
-00013480: 7065 3d74 6f72 6368 2e66 6c6f 6174 290a  pe=torch.float).
-00013490: 2020 2020 3e3e 3e20 6c61 7965 7220 3d20      >>> layer = 
-000134a0: 4e65 6967 6862 6f72 4c69 7374 284e 5f61  NeighborList(N_a
-000134b0: 746f 6d73 2c20 4d5f 6e62 7273 2c20 6e64  toms, M_nbrs, nd
-000134c0: 696d 2c20 6e62 725f 6375 746f 6666 2c20  im, nbr_cutoff, 
-000134d0: 7374 6172 742c 0a20 2020 202e 2e2e 2020  start,.    ...  
-000134e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000134f0: 2020 2020 7374 6f70 290a 2020 2020 3e3e      stop).    >>
-00013500: 3e20 7265 7375 6c74 203d 206c 6179 6572  > result = layer
-00013510: 2863 6f6f 7264 7329 0a20 2020 203e 3e3e  (coords).    >>>
-00013520: 2072 6573 756c 742e 7368 6170 650a 2020   result.shape.  
-00013530: 2020 746f 7263 682e 5369 7a65 285b 352c    torch.Size([5,
-00013540: 2032 5d29 0a0a 2020 2020 544f 444f 2872   2])..    TODO(r
-00013550: 6268 6172 6174 6829 3a20 4d61 6b65 2074  bharath): Make t
-00013560: 6869 7320 6c61 7965 7220 7375 7070 6f72  his layer suppor
-00013570: 7420 6261 7463 6869 6e67 2e0a 2020 2020  t batching..    
-00013580: 2222 220a 0a20 2020 2064 6566 205f 5f69  """..    def __i
-00013590: 6e69 745f 5f28 7365 6c66 2c20 4e5f 6174  nit__(self, N_at
-000135a0: 6f6d 733a 2069 6e74 2c20 4d5f 6e62 7273  oms: int, M_nbrs
-000135b0: 3a20 696e 742c 206e 6469 6d3a 2069 6e74  : int, ndim: int
-000135c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000135d0: 2020 206e 6272 5f63 7574 6f66 663a 2055     nbr_cutoff: U
-000135e0: 6e69 6f6e 5b69 6e74 2c0a 2020 2020 2020  nion[int,.      
-000135f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013600: 2020 2020 2020 2020 2020 2020 2066 6c6f               flo
-00013610: 6174 5d2c 2073 7461 7274 3a20 696e 742c  at], start: int,
-00013620: 2073 746f 703a 2069 6e74 2c20 2a2a 6b77   stop: int, **kw
-00013630: 6172 6773 293a 0a20 2020 2020 2020 2022  args):.        "
-00013640: 2222 0a20 2020 2020 2020 2050 6172 616d  "".        Param
-00013650: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
-00013660: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00013670: 204e 5f61 746f 6d73 3a20 696e 740a 2020   N_atoms: int.  
-00013680: 2020 2020 2020 2020 2020 4d61 7869 6d75            Maximu
-00013690: 6d20 6e75 6d62 6572 206f 6620 6174 6f6d  m number of atom
-000136a0: 7320 7468 6973 206c 6179 6572 2077 696c  s this layer wil
-000136b0: 6c20 6e65 6967 6862 6f72 2d6c 6973 742e  l neighbor-list.
-000136c0: 0a20 2020 2020 2020 204d 5f6e 6272 733a  .        M_nbrs:
-000136d0: 2069 6e74 0a20 2020 2020 2020 2020 2020   int.           
-000136e0: 204d 6178 696d 756d 206e 756d 6265 7220   Maximum number 
-000136f0: 6f66 2073 7061 7469 616c 206e 6569 6768  of spatial neigh
-00013700: 626f 7273 2070 6f73 7369 626c 6520 666f  bors possible fo
-00013710: 7220 6174 6f6d 2e0a 2020 2020 2020 2020  r atom..        
-00013720: 6e64 696d 3a20 696e 740a 2020 2020 2020  ndim: int.      
-00013730: 2020 2020 2020 4469 6d65 6e73 696f 6e61        Dimensiona
-00013740: 6c69 7479 206f 6620 7370 6163 6520 6174  lity of space at
-00013750: 6f6d 7320 6c69 7665 2069 6e2e 2028 5479  oms live in. (Ty
-00013760: 7069 6361 6c6c 7920 3344 2c20 6275 7420  pically 3D, but 
-00013770: 736f 6d65 7469 6d65 7320 7769 6c6c 0a20  sometimes will. 
-00013780: 2020 2020 2020 2020 2020 2077 616e 7420             want 
-00013790: 746f 2075 7365 2068 6967 6865 7220 6469  to use higher di
-000137a0: 6d65 6e73 696f 6e61 6c20 6465 7363 7269  mensional descri
-000137b0: 7074 6f72 7320 666f 7220 6174 6f6d 7329  ptors for atoms)
-000137c0: 2e0a 2020 2020 2020 2020 6e62 725f 6375  ..        nbr_cu
-000137d0: 746f 6666 3a20 696e 7420 6f72 2066 6c6f  toff: int or flo
-000137e0: 6174 0a20 2020 2020 2020 2020 2020 204c  at.            L
-000137f0: 656e 6774 6820 696e 2041 6e67 7374 726f  ength in Angstro
-00013800: 6d73 2028 3f29 2061 7420 7768 6963 6820  ms (?) at which 
-00013810: 6174 6f6d 2062 6f78 6573 2061 7265 2067  atom boxes are g
-00013820: 7269 6464 6564 2e0a 2020 2020 2020 2020  ridded..        
-00013830: 7374 6172 743a 2069 6e74 0a20 2020 2020  start: int.     
-00013840: 2020 2020 2020 2053 7461 7274 206f 6620         Start of 
-00013850: 7261 6e67 6520 666f 7220 7468 6520 626f  range for the bo
-00013860: 7820 696e 2077 6869 6368 2074 6865 206c  x in which the l
-00013870: 6f63 6174 696f 6e73 206f 6620 616c 6c20  ocations of all 
-00013880: 6772 6964 2070 6f69 6e74 7320 7769 6c6c  grid points will
-00013890: 2062 6520 6361 6c63 756c 6174 6564 2069   be calculated i
-000138a0: 6e20 6073 656c 662e 6765 745f 6365 6c6c  n `self.get_cell
-000138b0: 7328 2960 2e0a 2020 2020 2020 2020 7374  s()`..        st
-000138c0: 6f70 3a20 696e 740a 2020 2020 2020 2020  op: int.        
-000138d0: 2020 2020 456e 6420 6f66 2072 616e 6765      End of range
-000138e0: 2066 6f72 2074 6865 2062 6f78 2069 6e20   for the box in 
-000138f0: 7768 6963 6820 7468 6520 6c6f 6361 7469  which the locati
-00013900: 6f6e 7320 6f66 2061 6c6c 2067 7269 6420  ons of all grid 
-00013910: 706f 696e 7473 2077 696c 6c20 6265 2063  points will be c
-00013920: 616c 6375 6c61 7465 6420 696e 2060 7365  alculated in `se
-00013930: 6c66 2e67 6574 5f63 656c 6c73 2829 602e  lf.get_cells()`.
-00013940: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00013950: 2020 2020 2073 7570 6572 284e 6569 6768       super(Neigh
-00013960: 626f 724c 6973 742c 2073 656c 6629 2e5f  borList, self)._
-00013970: 5f69 6e69 745f 5f28 2a2a 6b77 6172 6773  _init__(**kwargs
-00013980: 290a 2020 2020 2020 2020 7365 6c66 2e4e  ).        self.N
-00013990: 5f61 746f 6d73 203d 204e 5f61 746f 6d73  _atoms = N_atoms
-000139a0: 0a20 2020 2020 2020 2073 656c 662e 4d5f  .        self.M_
-000139b0: 6e62 7273 203d 204d 5f6e 6272 730a 2020  nbrs = M_nbrs.  
-000139c0: 2020 2020 2020 7365 6c66 2e6e 6469 6d20        self.ndim 
-000139d0: 3d20 6e64 696d 0a20 2020 2020 2020 2023  = ndim.        #
-000139e0: 204e 756d 6265 7220 6f66 2067 7269 6420   Number of grid 
-000139f0: 6365 6c6c 730a 2020 2020 2020 2020 6e5f  cells.        n_
-00013a00: 6365 6c6c 7320 3d20 696e 7428 2828 7374  cells = int(((st
-00013a10: 6f70 202d 2073 7461 7274 2920 2f20 6e62  op - start) / nb
-00013a20: 725f 6375 746f 6666 292a 2a6e 6469 6d29  r_cutoff)**ndim)
-00013a30: 0a20 2020 2020 2020 2073 656c 662e 6e5f  .        self.n_
-00013a40: 6365 6c6c 7320 3d20 6e5f 6365 6c6c 730a  cells = n_cells.
-00013a50: 2020 2020 2020 2020 7365 6c66 2e6e 6272          self.nbr
-00013a60: 5f63 7574 6f66 6620 3d20 6e62 725f 6375  _cutoff = nbr_cu
-00013a70: 746f 6666 0a20 2020 2020 2020 2073 656c  toff.        sel
-00013a80: 662e 7374 6172 7420 3d20 7374 6172 740a  f.start = start.
-00013a90: 2020 2020 2020 2020 7365 6c66 2e73 746f          self.sto
-00013aa0: 7020 3d20 7374 6f70 0a0a 2020 2020 6465  p = stop..    de
-00013ab0: 6620 5f5f 7265 7072 5f5f 2873 656c 6629  f __repr__(self)
-00013ac0: 202d 3e20 7374 723a 0a20 2020 2020 2020   -> str:.       
-00013ad0: 2072 6574 7572 6e20 280a 2020 2020 2020   return (.      
-00013ae0: 2020 2020 2020 6627 7b73 656c 662e 5f5f        f'{self.__
-00013af0: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
-00013b00: 7d28 4e5f 6174 6f6d 733d 7b73 656c 662e  }(N_atoms={self.
-00013b10: 4e5f 6174 6f6d 737d 2c20 4d5f 6e62 7273  N_atoms}, M_nbrs
-00013b20: 3d7b 7365 6c66 2e4d 5f6e 6272 737d 2c20  ={self.M_nbrs}, 
-00013b30: 6e64 696d 3d7b 7365 6c66 2e6e 6469 6d7d  ndim={self.ndim}
-00013b40: 2c20 6e5f 6365 6c6c 733d 7b73 656c 662e  , n_cells={self.
-00013b50: 6e5f 6365 6c6c 737d 2c20 6e62 725f 6375  n_cells}, nbr_cu
-00013b60: 746f 6666 3d7b 7365 6c66 2e6e 6272 5f63  toff={self.nbr_c
-00013b70: 7574 6f66 667d 2c20 7374 6172 743d 7b73  utoff}, start={s
-00013b80: 656c 662e 7374 6172 747d 2c20 7374 6f70  elf.start}, stop
-00013b90: 3d7b 7365 6c66 2e73 746f 707d 2927 0a20  ={self.stop})'. 
-00013ba0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-00013bb0: 6620 666f 7277 6172 6428 7365 6c66 2c20  f forward(self, 
-00013bc0: 696e 7075 7473 3a20 746f 7263 682e 5465  inputs: torch.Te
-00013bd0: 6e73 6f72 2920 2d3e 2074 6f72 6368 2e54  nsor) -> torch.T
-00013be0: 656e 736f 723a 0a20 2020 2020 2020 2022  ensor:.        "
-00013bf0: 2222 496e 766f 6b65 7320 7468 6973 206c  ""Invokes this l
-00013c00: 6179 6572 2e0a 0a20 2020 2020 2020 2050  ayer...        P
-00013c10: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
-00013c20: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-00013c30: 2020 2020 2069 6e70 7574 733a 2074 6f72       inputs: tor
-00013c40: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
-00013c50: 2020 2020 2020 5368 6170 6520 286e 756d        Shape (num
-00013c60: 5f61 746f 6d73 2c20 6e64 696d 290a 0a20  _atoms, ndim).. 
-00013c70: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
-00013c80: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
-00013c90: 2020 2020 2020 206e 6569 6768 626f 725f         neighbor_
-00013ca0: 6c69 7374 3a20 746f 7263 682e 5465 6e73  list: torch.Tens
-00013cb0: 6f72 0a20 2020 2020 2020 2020 2020 2053  or.            S
-00013cc0: 6861 7065 2060 284e 5f61 746f 6d73 2c20  hape `(N_atoms, 
-00013cd0: 4d5f 6e62 7273 2960 0a20 2020 2020 2020  M_nbrs)`.       
-00013ce0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-00013cf0: 6973 696e 7374 616e 6365 2869 6e70 7574  isinstance(input
-00013d00: 732c 2053 6571 7565 6e63 6543 6f6c 6c65  s, SequenceColle
-00013d10: 6374 696f 6e29 3a0a 2020 2020 2020 2020  ction):.        
-00013d20: 2020 2020 6966 206c 656e 2869 6e70 7574      if len(input
-00013d30: 7329 2021 3d20 313a 0a20 2020 2020 2020  s) != 1:.       
-00013d40: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00013d50: 616c 7565 4572 726f 7228 224e 6569 6768  alueError("Neigh
-00013d60: 626f 724c 6973 7420 6361 6e20 6f6e 6c79  borList can only
-00013d70: 2068 6176 6520 6f6e 6520 696e 7075 7422   have one input"
-00013d80: 290a 2020 2020 2020 2020 2020 2020 696e  ).            in
-00013d90: 7075 7473 203d 2069 6e70 7574 735b 305d  puts = inputs[0]
-00013da0: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-00013db0: 696e 7075 7473 2e73 6861 7065 2920 213d  inputs.shape) !=
-00013dc0: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
-00013dd0: 2320 544f 444f 2872 6268 6172 6174 6829  # TODO(rbharath)
-00013de0: 3a20 5375 7070 6f72 7420 6261 7463 6869  : Support batchi
-00013df0: 6e67 0a20 2020 2020 2020 2020 2020 2072  ng.            r
-00013e00: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00013e10: 2250 6172 656e 7420 7465 6e73 6f72 206d  "Parent tensor m
-00013e20: 7573 7420 6265 2028 6e75 6d5f 6174 6f6d  ust be (num_atom
-00013e30: 732c 206e 6475 6d29 2229 0a20 2020 2020  s, ndum)").     
-00013e40: 2020 2072 6574 7572 6e20 7365 6c66 2e63     return self.c
-00013e50: 6f6d 7075 7465 5f6e 6272 5f6c 6973 7428  ompute_nbr_list(
-00013e60: 696e 7075 7473 290a 0a20 2020 2064 6566  inputs)..    def
-00013e70: 2063 6f6d 7075 7465 5f6e 6272 5f6c 6973   compute_nbr_lis
-00013e80: 7428 7365 6c66 2c20 636f 6f72 6473 3a20  t(self, coords: 
-00013e90: 746f 7263 682e 5465 6e73 6f72 2920 2d3e  torch.Tensor) ->
-00013ea0: 2074 6f72 6368 2e54 656e 736f 723a 0a20   torch.Tensor:. 
-00013eb0: 2020 2020 2020 2022 2222 4765 7420 636c         """Get cl
-00013ec0: 6f73 6573 7420 6e65 6967 6862 6f72 7320  osest neighbors 
-00013ed0: 666f 7220 6174 6f6d 732e 0a0a 2020 2020  for atoms...    
-00013ee0: 2020 2020 4e65 6564 7320 746f 2068 616e      Needs to han
-00013ef0: 646c 6520 7061 6464 696e 6720 666f 7220  dle padding for 
-00013f00: 6174 6f6d 7320 7769 7468 206e 6f20 6e65  atoms with no ne
-00013f10: 6967 6862 6f72 732e 0a0a 2020 2020 2020  ighbors...      
-00013f20: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00013f30: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-00013f40: 2020 2020 2020 2020 636f 6f72 6473 3a20          coords: 
-00013f50: 746f 7263 682e 5465 6e73 6f72 0a20 2020  torch.Tensor.   
-00013f60: 2020 2020 2020 2020 2053 6861 7065 2028           Shape (
-00013f70: 4e5f 6174 6f6d 732c 206e 6469 6d29 0a0a  N_atoms, ndim)..
-00013f80: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
-00013f90: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
-00013fa0: 2020 2020 2020 2020 6e62 725f 6c69 7374          nbr_list
-00013fb0: 3a20 746f 7263 682e 5465 6e73 6f72 0a20  : torch.Tensor. 
-00013fc0: 2020 2020 2020 2020 2020 2053 6861 7065             Shape
-00013fd0: 2028 4e5f 6174 6f6d 732c 204d 5f6e 6272   (N_atoms, M_nbr
-00013fe0: 7329 206f 6620 6174 6f6d 2069 6e64 6963  s) of atom indic
-00013ff0: 6573 0a20 2020 2020 2020 2022 2222 0a20  es.        """. 
-00014000: 2020 2020 2020 2023 2053 6861 7065 2028         # Shape (
-00014010: 6e5f 6365 6c6c 732c 206e 6469 6d29 0a20  n_cells, ndim). 
-00014020: 2020 2020 2020 2063 656c 6c73 203d 2073         cells = s
-00014030: 656c 662e 6765 745f 6365 6c6c 7328 290a  elf.get_cells().
-00014040: 0a20 2020 2020 2020 2023 204c 6973 7420  .        # List 
-00014050: 6f66 206c 656e 6774 6820 4e5f 6174 6f6d  of length N_atom
-00014060: 732c 2065 6163 6820 656c 656d 656e 7420  s, each element 
-00014070: 6f66 2064 6966 6665 7265 6e74 206c 656e  of different len
-00014080: 6774 6820 756e 6971 7565 735f 690a 2020  gth uniques_i.  
-00014090: 2020 2020 2020 6e62 7273 203d 2073 656c        nbrs = sel
-000140a0: 662e 6765 745f 6174 6f6d 735f 696e 5f6e  f.get_atoms_in_n
-000140b0: 6272 7328 636f 6f72 6473 2c20 6365 6c6c  brs(coords, cell
-000140c0: 7329 0a20 2020 2020 2020 2070 6164 6469  s).        paddi
-000140d0: 6e67 203d 2074 6f72 6368 2e66 756c 6c28  ng = torch.full(
-000140e0: 2873 656c 662e 4d5f 6e62 7273 2c29 2c20  (self.M_nbrs,), 
-000140f0: 2d31 290a 2020 2020 2020 2020 7061 6464  -1).        padd
-00014100: 6564 5f6e 6272 7320 3d20 5b0a 2020 2020  ed_nbrs = [.    
-00014110: 2020 2020 2020 2020 746f 7263 682e 636f          torch.co
-00014120: 6e63 6174 285b 756e 6971 7565 5f6e 6272  ncat([unique_nbr
-00014130: 732c 2070 6164 6469 6e67 5d2c 2030 2920  s, padding], 0) 
-00014140: 666f 7220 756e 6971 7565 5f6e 6272 7320  for unique_nbrs 
-00014150: 696e 206e 6272 730a 2020 2020 2020 2020  in nbrs.        
-00014160: 5d0a 0a20 2020 2020 2020 2023 204c 6973  ]..        # Lis
-00014170: 7420 6f66 206c 656e 6774 6820 4e5f 6174  t of length N_at
-00014180: 6f6d 732c 2065 6163 6820 656c 656d 656e  oms, each elemen
-00014190: 7420 6f66 2064 6966 6665 7265 6e74 206c  t of different l
-000141a0: 656e 6774 6820 756e 6971 7565 735f 690a  ength uniques_i.
-000141b0: 2020 2020 2020 2020 2320 4c69 7374 206f          # List o
-000141c0: 6620 6c65 6e67 7468 204e 5f61 746f 6d73  f length N_atoms
-000141d0: 2c20 6561 6368 2061 2074 656e 736f 7220  , each a tensor 
-000141e0: 6f66 2073 6861 7065 0a20 2020 2020 2020  of shape.       
-000141f0: 2023 2028 756e 6971 7565 735f 692c 206e   # (uniques_i, n
-00014200: 6469 6d29 0a20 2020 2020 2020 206e 6272  dim).        nbr
-00014210: 5f63 6f6f 7264 7320 3d20 5b0a 2020 2020  _coords = [.    
-00014220: 2020 2020 2020 2020 746f 7263 682e 696e          torch.in
-00014230: 6465 785f 7365 6c65 6374 2863 6f6f 7264  dex_select(coord
-00014240: 732c 2030 2c20 6174 6f6d 5f6e 6272 7329  s, 0, atom_nbrs)
-00014250: 2066 6f72 2061 746f 6d5f 6e62 7273 2069   for atom_nbrs i
-00014260: 6e20 6e62 7273 0a20 2020 2020 2020 205d  n nbrs.        ]
-00014270: 0a0a 2020 2020 2020 2020 2320 4164 6420  ..        # Add 
-00014280: 7068 616e 746f 6d20 6174 6f6d 7320 7468  phantom atoms th
-00014290: 6174 2065 7869 7374 2066 6172 206f 7574  at exist far out
-000142a0: 7369 6465 2074 6865 2062 6f78 0a20 2020  side the box.   
-000142b0: 2020 2020 2063 6f6f 7264 5f70 6164 6469       coord_paddi
-000142c0: 6e67 203d 2074 6f72 6368 2e66 756c 6c28  ng = torch.full(
-000142d0: 2873 656c 662e 4d5f 6e62 7273 2c20 7365  (self.M_nbrs, se
-000142e0: 6c66 2e6e 6469 6d29 2c0a 2020 2020 2020  lf.ndim),.      
-000142f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014300: 2020 2020 2020 2020 2020 2020 2032 202a               2 *
-00014310: 2073 656c 662e 7374 6f70 292e 746f 2874   self.stop).to(t
-00014320: 6f72 6368 2e66 6c6f 6174 290a 2020 2020  orch.float).    
-00014330: 2020 2020 7061 6464 6564 5f6e 6272 5f63      padded_nbr_c
-00014340: 6f6f 7264 7320 3d20 5b0a 2020 2020 2020  oords = [.      
-00014350: 2020 2020 2020 746f 7263 682e 6361 7428        torch.cat(
-00014360: 5b6e 6272 5f63 6f6f 7264 2c20 636f 6f72  [nbr_coord, coor
-00014370: 645f 7061 6464 696e 675d 2c20 3029 2066  d_padding], 0) f
-00014380: 6f72 206e 6272 5f63 6f6f 7264 2069 6e20  or nbr_coord in 
-00014390: 6e62 725f 636f 6f72 6473 0a20 2020 2020  nbr_coords.     
-000143a0: 2020 205d 0a0a 2020 2020 2020 2020 2320     ]..        # 
-000143b0: 4c69 7374 206f 6620 6c65 6e67 7468 204e  List of length N
-000143c0: 5f61 746f 6d73 2c20 6561 6368 206f 6620  _atoms, each of 
-000143d0: 7368 6170 6520 2831 2c20 6e64 696d 290a  shape (1, ndim).
-000143e0: 2020 2020 2020 2020 6174 6f6d 5f63 6f6f          atom_coo
-000143f0: 7264 7320 3d20 746f 7263 682e 7465 6e73  rds = torch.tens
-00014400: 6f72 5f73 706c 6974 2863 6f6f 7264 732c  or_split(coords,
-00014410: 2073 656c 662e 4e5f 6174 6f6d 7329 0a0a   self.N_atoms)..
-00014420: 2020 2020 2020 2020 2320 544f 444f 2872          # TODO(r
-00014430: 6268 6172 6174 6829 3a20 486f 7720 646f  bharath): How do
-00014440: 6573 2064 6973 7461 6e63 6520 6e65 6564  es distance need
-00014450: 2074 6f20 6265 206d 6f64 6966 6965 6420   to be modified 
-00014460: 6865 7265 2074 6f0a 2020 2020 2020 2020  here to.        
-00014470: 2320 6163 636f 756e 7420 666f 7220 7065  # account for pe
-00014480: 7269 6f64 6963 2062 6f75 6e64 6172 7920  riodic boundary 
-00014490: 636f 6e64 6974 696f 6e73 3f0a 2020 2020  conditions?.    
-000144a0: 2020 2020 2320 4c69 7374 206f 6620 6c65      # List of le
-000144b0: 6e67 7468 204e 5f61 746f 6d73 2065 6163  ngth N_atoms eac
-000144c0: 6820 6f66 2073 6861 7065 2028 4d5f 6e62  h of shape (M_nb
-000144d0: 7273 290a 2020 2020 2020 2020 7061 6464  rs).        padd
-000144e0: 6564 5f64 6973 7473 203d 205b 0a20 2020  ed_dists = [.   
-000144f0: 2020 2020 2020 2020 2074 6f72 6368 2e73           torch.s
-00014500: 756d 2828 6174 6f6d 5f63 6f6f 7264 202d  um((atom_coord -
-00014510: 2070 6164 6465 645f 6e62 725f 636f 6f72   padded_nbr_coor
-00014520: 6429 2a2a 322c 2064 696d 3d2d 3129 0a20  d)**2, dim=-1). 
-00014530: 2020 2020 2020 2020 2020 2066 6f72 2028             for (
-00014540: 6174 6f6d 5f63 6f6f 7264 2c0a 2020 2020  atom_coord,.    
-00014550: 2020 2020 2020 2020 2020 2020 2070 6164               pad
-00014560: 6465 645f 6e62 725f 636f 6f72 6429 2069  ded_nbr_coord) i
-00014570: 6e20 7a69 7028 6174 6f6d 5f63 6f6f 7264  n zip(atom_coord
-00014580: 732c 2070 6164 6465 645f 6e62 725f 636f  s, padded_nbr_co
-00014590: 6f72 6473 290a 2020 2020 2020 2020 5d0a  ords).        ].
-000145a0: 0a20 2020 2020 2020 2070 6164 6465 645f  .        padded_
-000145b0: 636c 6f73 6573 745f 6e62 7273 203d 205b  closest_nbrs = [
-000145c0: 0a20 2020 2020 2020 2020 2020 2074 6f72  .            tor
-000145d0: 6368 2e74 6f70 6b28 7061 6464 6564 5f64  ch.topk(padded_d
-000145e0: 6973 742c 206b 3d73 656c 662e 4d5f 6e62  ist, k=self.M_nb
-000145f0: 7273 2c20 6c61 7267 6573 743d 4661 6c73  rs, largest=Fals
-00014600: 6529 5b31 5d0a 2020 2020 2020 2020 2020  e)[1].          
-00014610: 2020 666f 7220 7061 6464 6564 5f64 6973    for padded_dis
-00014620: 7420 696e 2070 6164 6465 645f 6469 7374  t in padded_dist
-00014630: 730a 2020 2020 2020 2020 5d0a 0a20 2020  s.        ]..   
-00014640: 2020 2020 2023 204e 5f61 746f 6d73 2065       # N_atoms e
-00014650: 6c74 7320 6f66 2073 697a 6520 284d 5f6e  lts of size (M_n
-00014660: 6272 732c 2920 6561 6368 0a20 2020 2020  brs,) each.     
-00014670: 2020 2070 6164 6465 645f 6e65 6967 6862     padded_neighb
-00014680: 6f72 5f6c 6973 7420 3d20 5b0a 2020 2020  or_list = [.    
-00014690: 2020 2020 2020 2020 746f 7263 682e 6761          torch.ga
-000146a0: 7468 6572 2870 6164 6465 645f 6174 6f6d  ther(padded_atom
-000146b0: 5f6e 6272 732c 2030 2c20 7061 6464 6564  _nbrs, 0, padded
-000146c0: 5f63 6c6f 7365 7374 5f6e 6272 290a 2020  _closest_nbr).  
-000146d0: 2020 2020 2020 2020 2020 666f 7220 2870            for (p
-000146e0: 6164 6465 645f 6174 6f6d 5f6e 6272 732c  added_atom_nbrs,
-000146f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014700: 2020 7061 6464 6564 5f63 6c6f 7365 7374    padded_closest
-00014710: 5f6e 6272 2920 696e 207a 6970 2870 6164  _nbr) in zip(pad
-00014720: 6465 645f 6e62 7273 2c20 7061 6464 6564  ded_nbrs, padded
-00014730: 5f63 6c6f 7365 7374 5f6e 6272 7329 0a20  _closest_nbrs). 
-00014740: 2020 2020 2020 205d 0a0a 2020 2020 2020         ]..      
-00014750: 2020 6e65 6967 6862 6f72 5f6c 6973 7420    neighbor_list 
-00014760: 3d20 746f 7263 682e 7374 6163 6b28 7061  = torch.stack(pa
-00014770: 6464 6564 5f6e 6569 6768 626f 725f 6c69  dded_neighbor_li
-00014780: 7374 290a 0a20 2020 2020 2020 2072 6574  st)..        ret
-00014790: 7572 6e20 6e65 6967 6862 6f72 5f6c 6973  urn neighbor_lis
-000147a0: 740a 0a20 2020 2064 6566 2067 6574 5f61  t..    def get_a
-000147b0: 746f 6d73 5f69 6e5f 6e62 7273 2873 656c  toms_in_nbrs(sel
-000147c0: 662c 2063 6f6f 7264 733a 2074 6f72 6368  f, coords: torch
-000147d0: 2e54 656e 736f 722c 0a20 2020 2020 2020  .Tensor,.       
-000147e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000147f0: 2020 2063 656c 6c73 3a20 746f 7263 682e     cells: torch.
-00014800: 5465 6e73 6f72 2920 2d3e 204c 6973 745b  Tensor) -> List[
-00014810: 746f 7263 682e 5465 6e73 6f72 5d3a 0a20  torch.Tensor]:. 
-00014820: 2020 2020 2020 2022 2222 4765 7420 7468         """Get th
-00014830: 6520 6174 6f6d 7320 696e 206e 6569 6768  e atoms in neigh
-00014840: 626f 7269 6e67 2063 656c 6c73 2066 6f72  boring cells for
-00014850: 2065 6163 6820 6365 6c6c 732e 0a0a 2020   each cells...  
-00014860: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-00014870: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00014880: 2d2d 2d0a 2020 2020 2020 2020 636f 6f72  ---.        coor
-00014890: 6473 3a20 746f 7263 682e 5465 6e73 6f72  ds: torch.Tensor
-000148a0: 0a20 2020 2020 2020 2020 2020 2053 6861  .            Sha
-000148b0: 7065 2028 4e5f 6174 6f6d 732c 206e 6469  pe (N_atoms, ndi
-000148c0: 6d29 0a20 2020 2020 2020 2063 656c 6c73  m).        cells
-000148d0: 3a20 746f 7263 682e 5465 6e73 6f72 0a0a  : torch.Tensor..
-000148e0: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
-000148f0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
-00014900: 2020 2020 2020 2020 6174 6f6d 735f 696e          atoms_in
-00014910: 5f6e 6272 733a 204c 6973 745b 746f 7263  _nbrs: List[torc
-00014920: 682e 5465 6e73 6f72 5d0a 2020 2020 2020  h.Tensor].      
-00014930: 2020 2020 2020 284e 5f61 746f 6d73 2c20        (N_atoms, 
-00014940: 6e5f 6e62 725f 6365 6c6c 732c 204d 5f6e  n_nbr_cells, M_n
-00014950: 6272 7329 0a20 2020 2020 2020 2022 2222  brs).        """
-00014960: 0a20 2020 2020 2020 2023 2053 6861 7065  .        # Shape
-00014970: 2028 4e5f 6174 6f6d 732c 2031 290a 2020   (N_atoms, 1).  
-00014980: 2020 2020 2020 6365 6c6c 735f 666f 725f        cells_for_
-00014990: 6174 6f6d 7320 3d20 7365 6c66 2e67 6574  atoms = self.get
-000149a0: 5f63 656c 6c73 5f66 6f72 5f61 746f 6d73  _cells_for_atoms
-000149b0: 2863 6f6f 7264 732c 2063 656c 6c73 290a  (coords, cells).
-000149c0: 0a20 2020 2020 2020 2023 2046 696e 6420  .        # Find 
-000149d0: 4d5f 6e62 7273 2061 746f 6d73 2063 6c6f  M_nbrs atoms clo
-000149e0: 7365 7374 2074 6f20 6561 6368 2063 656c  sest to each cel
-000149f0: 6c0a 2020 2020 2020 2020 2320 5368 6170  l.        # Shap
-00014a00: 6520 286e 5f63 656c 6c73 2c20 4d5f 6e62  e (n_cells, M_nb
-00014a10: 7273 290a 2020 2020 2020 2020 636c 6f73  rs).        clos
-00014a20: 6573 745f 6174 6f6d 7320 3d20 7365 6c66  est_atoms = self
-00014a30: 2e67 6574 5f63 6c6f 7365 7374 5f61 746f  .get_closest_ato
-00014a40: 6d73 2863 6f6f 7264 732c 2063 656c 6c73  ms(coords, cells
-00014a50: 290a 0a20 2020 2020 2020 2023 2041 7373  )..        # Ass
-00014a60: 6f63 6961 7465 2065 6163 6820 6365 6c6c  ociate each cell
-00014a70: 2077 6974 6820 6974 7320 6e65 6967 6862   with its neighb
-00014a80: 6f72 2063 656c 6c73 2e20 4173 7375 6d65  or cells. Assume
-00014a90: 7320 7065 7269 6f64 6963 2062 6f75 6e64  s periodic bound
-00014aa0: 6172 790a 2020 2020 2020 2020 2320 636f  ary.        # co
-00014ab0: 6e64 6974 696f 6e73 2c20 736f 2064 6f65  nditions, so doe
-00014ac0: 7320 7772 6170 726f 756e 642e 204f 2863  s wrapround. O(c
-00014ad0: 6f6e 7374 616e 7429 0a20 2020 2020 2020  onstant).       
-00014ae0: 2023 2053 6861 7065 2028 6e5f 6365 6c6c   # Shape (n_cell
-00014af0: 732c 206e 5f6e 6272 5f63 656c 6c73 290a  s, n_nbr_cells).
-00014b00: 2020 2020 2020 2020 6e65 6967 6862 6f72          neighbor
-00014b10: 5f63 656c 6c73 203d 2073 656c 662e 6765  _cells = self.ge
-00014b20: 745f 6e65 6967 6862 6f72 5f63 656c 6c73  t_neighbor_cells
-00014b30: 2863 656c 6c73 290a 0a20 2020 2020 2020  (cells)..       
-00014b40: 2023 2053 6861 7065 2028 4e5f 6174 6f6d   # Shape (N_atom
-00014b50: 732c 206e 5f6e 6272 5f63 656c 6c73 290a  s, n_nbr_cells).
-00014b60: 2020 2020 2020 2020 6e65 6967 6862 6f72          neighbor
-00014b70: 5f63 656c 6c73 203d 2074 6f72 6368 2e73  _cells = torch.s
-00014b80: 7175 6565 7a65 280a 2020 2020 2020 2020  queeze(.        
-00014b90: 2020 2020 746f 7263 682e 696e 6465 785f      torch.index_
-00014ba0: 7365 6c65 6374 286e 6569 6768 626f 725f  select(neighbor_
-00014bb0: 6365 6c6c 732c 2030 2c0a 2020 2020 2020  cells, 0,.      
-00014bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014bd0: 2020 2020 2020 2020 2074 6f72 6368 2e73           torch.s
-00014be0: 7175 6565 7a65 2863 656c 6c73 5f66 6f72  queeze(cells_for
-00014bf0: 5f61 746f 6d73 2929 290a 0a20 2020 2020  _atoms)))..     
-00014c00: 2020 2023 2053 6861 7065 2028 4e5f 6174     # Shape (N_at
-00014c10: 6f6d 732c 206e 5f6e 6272 5f63 656c 6c73  oms, n_nbr_cells
-00014c20: 2c20 4d5f 6e62 7273 290a 2020 2020 2020  , M_nbrs).      
-00014c30: 2020 6174 6f6d 735f 696e 5f6e 6272 7320    atoms_in_nbrs 
-00014c40: 3d20 746f 7263 682e 696e 6465 785f 7365  = torch.index_se
-00014c50: 6c65 6374 2863 6c6f 7365 7374 5f61 746f  lect(closest_ato
-00014c60: 6d73 2c20 302c 0a20 2020 2020 2020 2020  ms, 0,.         
-00014c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c90: 2020 6e65 6967 6862 6f72 5f63 656c 6c73    neighbor_cells
-00014ca0: 2e66 6c61 7474 656e 2829 290a 0a20 2020  .flatten())..   
-00014cb0: 2020 2020 2023 2053 6861 7065 2028 4e5f       # Shape (N_
-00014cc0: 6174 6f6d 732c 206e 5f6e 6272 5f63 656c  atoms, n_nbr_cel
-00014cd0: 6c73 2a4d 5f6e 6272 7329 0a20 2020 2020  ls*M_nbrs).     
-00014ce0: 2020 2061 746f 6d73 5f69 6e5f 6e62 7273     atoms_in_nbrs
-00014cf0: 203d 2074 6f72 6368 2e72 6573 6861 7065   = torch.reshape
-00014d00: 2861 746f 6d73 5f69 6e5f 6e62 7273 2c20  (atoms_in_nbrs, 
-00014d10: 5b73 656c 662e 4e5f 6174 6f6d 732c 202d  [self.N_atoms, -
-00014d20: 315d 290a 0a20 2020 2020 2020 2023 204c  1])..        # L
-00014d30: 6973 7420 6f66 206c 656e 6774 6820 4e5f  ist of length N_
-00014d40: 6174 6f6d 732c 2065 6163 6820 656c 656d  atoms, each elem
-00014d50: 656e 7420 6c65 6e67 7468 2075 6e69 7175  ent length uniqu
-00014d60: 6573 5f69 0a20 2020 2020 2020 206e 6272  es_i.        nbr
-00014d70: 735f 7065 725f 6174 6f6d 203d 2074 6f72  s_per_atom = tor
-00014d80: 6368 2e73 706c 6974 2861 746f 6d73 5f69  ch.split(atoms_i
-00014d90: 6e5f 6e62 7273 2c20 7365 6c66 2e4e 5f61  n_nbrs, self.N_a
-00014da0: 746f 6d73 290a 0a20 2020 2020 2020 2075  toms)..        u
-00014db0: 6e69 7175 6573 203d 205b 0a20 2020 2020  niques = [.     
-00014dc0: 2020 2020 2020 2074 6f72 6368 2e75 6e69         torch.uni
-00014dd0: 7175 6528 6174 6f6d 5f6e 6272 732c 2073  que(atom_nbrs, s
-00014de0: 6f72 7465 643d 4661 6c73 6529 0a20 2020  orted=False).   
-00014df0: 2020 2020 2020 2020 2066 6f72 2061 746f           for ato
-00014e00: 6d5f 6e62 7273 2069 6e20 6e62 7273 5f70  m_nbrs in nbrs_p
-00014e10: 6572 5f61 746f 6d5b 305d 0a20 2020 2020  er_atom[0].     
-00014e20: 2020 205d 0a0a 2020 2020 2020 2020 2320     ]..        # 
-00014e30: 544f 444f 2872 6268 6172 6174 6829 3a20  TODO(rbharath): 
-00014e40: 4652 4147 494c 4521 2055 7365 7320 6661  FRAGILE! Uses fa
-00014e50: 6374 2074 6861 7420 6964 656e 7469 7479  ct that identity
-00014e60: 2073 6565 6d73 2074 6f20 6265 2074 6865   seems to be the
-00014e70: 2066 6972 7374 0a20 2020 2020 2020 2023   first.        #
-00014e80: 2065 6c65 6d65 6e74 2072 656d 6f76 6564   element removed
-00014e90: 2074 6f20 7265 6d6f 7665 2073 656c 6620   to remove self 
-00014ea0: 6672 6f6d 206c 6973 7420 6f66 206e 6569  from list of nei
-00014eb0: 6768 626f 7273 2e20 4e65 6564 2074 6f20  ghbors. Need to 
-00014ec0: 7665 7269 6679 0a20 2020 2020 2020 2023  verify.        #
-00014ed0: 2074 6869 7320 686f 6c64 7320 6d6f 7265   this holds more
-00014ee0: 2062 726f 6164 6c79 206f 7220 636f 6d65   broadly or come
-00014ef0: 2075 7020 7769 7468 2072 6f62 7573 7420   up with robust 
-00014f00: 616c 7465 726e 6174 6976 652e 0a20 2020  alternative..   
-00014f10: 2020 2020 2075 6e69 7175 6573 203d 205b       uniques = [
-00014f20: 756e 6971 7565 5b31 3a5d 2066 6f72 2075  unique[1:] for u
-00014f30: 6e69 7175 6520 696e 2075 6e69 7175 6573  nique in uniques
-00014f40: 5d0a 0a20 2020 2020 2020 2072 6574 7572  ]..        retur
-00014f50: 6e20 756e 6971 7565 730a 0a20 2020 2064  n uniques..    d
-00014f60: 6566 2067 6574 5f63 6c6f 7365 7374 5f61  ef get_closest_a
-00014f70: 746f 6d73 2873 656c 662c 2063 6f6f 7264  toms(self, coord
-00014f80: 733a 2074 6f72 6368 2e54 656e 736f 722c  s: torch.Tensor,
-00014f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014fa0: 2020 2020 2020 2020 2020 2063 656c 6c73             cells
-00014fb0: 3a20 746f 7263 682e 5465 6e73 6f72 2920  : torch.Tensor) 
-00014fc0: 2d3e 2074 6f72 6368 2e54 656e 736f 723a  -> torch.Tensor:
-00014fd0: 0a20 2020 2020 2020 2022 2222 466f 7220  .        """For 
-00014fe0: 6561 6368 2063 656c 6c2c 2066 696e 6420  each cell, find 
-00014ff0: 4d5f 6e62 7273 2063 6c6f 7365 7374 2061  M_nbrs closest a
-00015000: 746f 6d73 2e0a 0a20 2020 2020 2020 204c  toms...        L
-00015010: 6574 204e 5f61 746f 6d73 2062 6520 7468  et N_atoms be th
-00015020: 6520 6e75 6d62 6572 206f 6620 6174 6f6d  e number of atom
-00015030: 732e 0a0a 2020 2020 2020 2020 5061 7261  s...        Para
-00015040: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
-00015050: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-00015060: 2020 636f 6f72 6473 3a20 746f 7263 682e    coords: torch.
-00015070: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
-00015080: 2020 2028 4e5f 6174 6f6d 732c 206e 6469     (N_atoms, ndi
-00015090: 6d29 2073 6861 7065 2e0a 2020 2020 2020  m) shape..      
-000150a0: 2020 6365 6c6c 733a 2074 6f72 6368 2e54    cells: torch.T
-000150b0: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
-000150c0: 2020 286e 5f63 656c 6c73 2c20 6e64 696d    (n_cells, ndim
-000150d0: 2920 7368 6170 652e 0a0a 2020 2020 2020  ) shape...      
-000150e0: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-000150f0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-00015100: 2020 636c 6f73 6573 745f 696e 6473 3a20    closest_inds: 
-00015110: 746f 7263 682e 5465 6e73 6f72 0a20 2020  torch.Tensor.   
-00015120: 2020 2020 2020 2020 204f 6620 7368 6170           Of shap
-00015130: 6520 286e 5f63 656c 6c73 2c20 4d5f 6e62  e (n_cells, M_nb
-00015140: 7273 290a 2020 2020 2020 2020 2222 220a  rs).        """.
-00015150: 2020 2020 2020 2020 4e5f 6174 6f6d 732c          N_atoms,
-00015160: 206e 5f63 656c 6c73 2c20 6e64 696d 2c20   n_cells, ndim, 
-00015170: 4d5f 6e62 7273 203d 2028 7365 6c66 2e4e  M_nbrs = (self.N
-00015180: 5f61 746f 6d73 2c20 7365 6c66 2e6e 5f63  _atoms, self.n_c
-00015190: 656c 6c73 2c20 7365 6c66 2e6e 6469 6d2c  ells, self.ndim,
-000151a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000151b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000151c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000151d0: 4d5f 6e62 7273 290a 2020 2020 2020 2020  M_nbrs).        
-000151e0: 2320 5469 6c65 2062 6f74 6820 6365 6c6c  # Tile both cell
-000151f0: 7320 616e 6420 636f 6f72 6473 2074 6f20  s and coords to 
-00015200: 666f 726d 2061 7272 6179 7320 6f66 2073  form arrays of s
-00015210: 697a 6520 284e 5f61 746f 6d73 2a6e 5f63  ize (N_atoms*n_c
-00015220: 656c 6c73 2c20 6e64 696d 290a 2020 2020  ells, ndim).    
-00015230: 2020 2020 7469 6c65 645f 6365 6c6c 7320      tiled_cells 
-00015240: 3d20 746f 7263 682e 7265 7368 6170 6528  = torch.reshape(
-00015250: 746f 7263 682e 7469 6c65 2863 656c 6c73  torch.tile(cells
-00015260: 2c20 2831 2c20 4e5f 6174 6f6d 7329 292c  , (1, N_atoms)),
-00015270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015290: 2020 2020 2028 4e5f 6174 6f6d 7320 2a20       (N_atoms * 
-000152a0: 6e5f 6365 6c6c 732c 206e 6469 6d29 290a  n_cells, ndim)).
-000152b0: 0a20 2020 2020 2020 2023 2053 6861 7065  .        # Shape
-000152c0: 2028 4e5f 6174 6f6d 732a 6e5f 6365 6c6c   (N_atoms*n_cell
-000152d0: 732c 206e 6469 6d29 2061 6674 6572 2074  s, ndim) after t
-000152e0: 696c 650a 2020 2020 2020 2020 7469 6c65  ile.        tile
-000152f0: 645f 636f 6f72 6473 203d 2074 6f72 6368  d_coords = torch
-00015300: 2e74 696c 6528 636f 6f72 6473 2c20 286e  .tile(coords, (n
-00015310: 5f63 656c 6c73 2c20 3129 290a 0a20 2020  _cells, 1))..   
-00015320: 2020 2020 2023 2053 6861 7065 2028 4e5f       # Shape (N_
-00015330: 6174 6f6d 732a 6e5f 6365 6c6c 7329 0a20  atoms*n_cells). 
-00015340: 2020 2020 2020 2063 6f6f 7264 735f 7665         coords_ve
-00015350: 6320 3d20 746f 7263 682e 7375 6d28 2874  c = torch.sum((t
-00015360: 696c 6564 5f63 6f6f 7264 7320 2d20 7469  iled_coords - ti
-00015370: 6c65 645f 6365 6c6c 7329 2a2a 322c 2064  led_cells)**2, d
-00015380: 696d 3d2d 3129 0a20 2020 2020 2020 2023  im=-1).        #
-00015390: 2053 6861 7065 2028 6e5f 6365 6c6c 732c   Shape (n_cells,
-000153a0: 204e 5f61 746f 6d73 290a 2020 2020 2020   N_atoms).      
-000153b0: 2020 636f 6f72 6473 5f6e 6f72 6d20 3d20    coords_norm = 
-000153c0: 746f 7263 682e 7265 7368 6170 6528 636f  torch.reshape(co
-000153d0: 6f72 6473 5f76 6563 2c20 286e 5f63 656c  ords_vec, (n_cel
-000153e0: 6c73 2c20 4e5f 6174 6f6d 7329 290a 0a20  ls, N_atoms)).. 
-000153f0: 2020 2020 2020 2023 2046 696e 6420 6b20         # Find k 
-00015400: 6174 6f6d 7320 636c 6f73 6573 7420 746f  atoms closest to
-00015410: 2074 6869 7320 6365 6c6c 2e0a 2020 2020   this cell..    
-00015420: 2020 2020 2320 5465 6e73 6f72 206f 6620      # Tensor of 
-00015430: 7368 6170 6520 286e 5f63 656c 6c73 2c20  shape (n_cells, 
-00015440: 4d5f 6e62 7273 290a 2020 2020 2020 2020  M_nbrs).        
-00015450: 636c 6f73 6573 745f 696e 6473 203d 2074  closest_inds = t
-00015460: 6f72 6368 2e74 6f70 6b28 636f 6f72 6473  orch.topk(coords
-00015470: 5f6e 6f72 6d2c 206b 3d4d 5f6e 6272 732c  _norm, k=M_nbrs,
-00015480: 206c 6172 6765 7374 3d46 616c 7365 295b   largest=False)[
-00015490: 315d 0a0a 2020 2020 2020 2020 7265 7475  1]..        retu
-000154a0: 726e 2063 6c6f 7365 7374 5f69 6e64 730a  rn closest_inds.
-000154b0: 0a20 2020 2064 6566 2067 6574 5f63 656c  .    def get_cel
-000154c0: 6c73 5f66 6f72 5f61 746f 6d73 2873 656c  ls_for_atoms(sel
-000154d0: 662c 2063 6f6f 7264 733a 2074 6f72 6368  f, coords: torch
-000154e0: 2e54 656e 736f 722c 0a20 2020 2020 2020  .Tensor,.       
-000154f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015500: 2020 2020 2063 656c 6c73 3a20 746f 7263       cells: torc
-00015510: 682e 5465 6e73 6f72 2920 2d3e 2074 6f72  h.Tensor) -> tor
-00015520: 6368 2e54 656e 736f 723a 0a20 2020 2020  ch.Tensor:.     
-00015530: 2020 2022 2222 436f 6d70 7574 6520 7468     """Compute th
-00015540: 6520 6365 6c6c 7320 6561 6368 2061 746f  e cells each ato
-00015550: 6d20 6265 6c6f 6e67 7320 746f 2e0a 0a20  m belongs to... 
-00015560: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-00015570: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00015580: 2d2d 2d2d 0a20 2020 2020 2020 2063 6f6f  ----.        coo
-00015590: 7264 733a 2074 6f72 6368 2e54 656e 736f  rds: torch.Tenso
-000155a0: 720a 2020 2020 2020 2020 2020 2020 5368  r.            Sh
-000155b0: 6170 6520 284e 5f61 746f 6d73 2c20 6e64  ape (N_atoms, nd
-000155c0: 696d 290a 2020 2020 2020 2020 6365 6c6c  im).        cell
-000155d0: 733a 2074 6f72 6368 2e54 656e 736f 720a  s: torch.Tensor.
-000155e0: 2020 2020 2020 2020 2020 2020 286e 5f63              (n_c
-000155f0: 656c 6c73 2c20 6e64 696d 2920 7368 6170  ells, ndim) shap
-00015600: 652e 0a20 2020 2020 2020 2052 6574 7572  e..        Retur
-00015610: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
-00015620: 2d2d 0a20 2020 2020 2020 2063 656c 6c73  --.        cells
-00015630: 5f66 6f72 5f61 746f 6d73 3a20 746f 7263  _for_atoms: torc
-00015640: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
-00015650: 2020 2020 2053 6861 7065 2028 4e5f 6174       Shape (N_at
-00015660: 6f6d 732c 2031 290a 2020 2020 2020 2020  oms, 1).        
-00015670: 2222 220a 2020 2020 2020 2020 4e5f 6174  """.        N_at
-00015680: 6f6d 732c 206e 5f63 656c 6c73 2c20 6e64  oms, n_cells, nd
-00015690: 696d 203d 2073 656c 662e 4e5f 6174 6f6d  im = self.N_atom
-000156a0: 732c 2073 656c 662e 6e5f 6365 6c6c 732c  s, self.n_cells,
-000156b0: 2073 656c 662e 6e64 696d 0a20 2020 2020   self.ndim.     
-000156c0: 2020 206e 5f63 656c 6c73 203d 2069 6e74     n_cells = int
-000156d0: 286e 5f63 656c 6c73 290a 2020 2020 2020  (n_cells).      
-000156e0: 2020 2320 5469 6c65 2062 6f74 6820 6365    # Tile both ce
-000156f0: 6c6c 7320 616e 6420 636f 6f72 6473 2074  lls and coords t
-00015700: 6f20 666f 726d 2061 7272 6179 7320 6f66  o form arrays of
-00015710: 2073 697a 6520 284e 5f61 746f 6d73 2a6e   size (N_atoms*n
-00015720: 5f63 656c 6c73 2c20 6e64 696d 290a 2020  _cells, ndim).  
-00015730: 2020 2020 2020 7469 6c65 645f 6365 6c6c        tiled_cell
-00015740: 7320 3d20 746f 7263 682e 7469 6c65 2863  s = torch.tile(c
-00015750: 656c 6c73 2c20 284e 5f61 746f 6d73 2c20  ells, (N_atoms, 
-00015760: 3129 290a 0a20 2020 2020 2020 2023 2053  1))..        # S
-00015770: 6861 7065 2028 4e5f 6174 6f6d 732a 6e5f  hape (N_atoms*n_
-00015780: 6365 6c6c 732c 2031 2920 6166 7465 7220  cells, 1) after 
-00015790: 7469 6c65 0a20 2020 2020 2020 2074 696c  tile.        til
-000157a0: 6564 5f63 6f6f 7264 7320 3d20 746f 7263  ed_coords = torc
-000157b0: 682e 7265 7368 6170 6528 746f 7263 682e  h.reshape(torch.
-000157c0: 7469 6c65 2863 6f6f 7264 732c 2028 312c  tile(coords, (1,
-000157d0: 206e 5f63 656c 6c73 2929 2c0a 2020 2020   n_cells)),.    
-000157e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000157f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015800: 2028 6e5f 6365 6c6c 7320 2a20 4e5f 6174   (n_cells * N_at
-00015810: 6f6d 732c 206e 6469 6d29 290a 2020 2020  oms, ndim)).    
-00015820: 2020 2020 636f 6f72 6473 5f76 6563 203d      coords_vec =
-00015830: 2074 6f72 6368 2e73 756d 2828 7469 6c65   torch.sum((tile
-00015840: 645f 636f 6f72 6473 202d 2074 696c 6564  d_coords - tiled
-00015850: 5f63 656c 6c73 292a 2a32 2c20 6469 6d3d  _cells)**2, dim=
-00015860: 2d31 290a 2020 2020 2020 2020 636f 6f72  -1).        coor
-00015870: 6473 5f6e 6f72 6d20 3d20 746f 7263 682e  ds_norm = torch.
-00015880: 7265 7368 6170 6528 636f 6f72 6473 5f76  reshape(coords_v
-00015890: 6563 2c20 284e 5f61 746f 6d73 2c20 6e5f  ec, (N_atoms, n_
-000158a0: 6365 6c6c 7329 290a 0a20 2020 2020 2020  cells))..       
-000158b0: 2063 6c6f 7365 7374 5f69 6e64 7320 3d20   closest_inds = 
-000158c0: 746f 7263 682e 746f 706b 2863 6f6f 7264  torch.topk(coord
-000158d0: 735f 6e6f 726d 2c20 6b3d 312c 206c 6172  s_norm, k=1, lar
-000158e0: 6765 7374 3d46 616c 7365 295b 315d 0a0a  gest=False)[1]..
-000158f0: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-00015900: 6c6f 7365 7374 5f69 6e64 730a 0a20 2020  losest_inds..   
-00015910: 2064 6566 205f 6765 745f 6e75 6d5f 6e62   def _get_num_nb
-00015920: 7273 2873 656c 6629 202d 3e20 696e 743a  rs(self) -> int:
-00015930: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
-00015940: 6e75 6d62 6572 206f 6620 6e65 6967 6862  number of neighb
-00015950: 6f72 7320 696e 2063 7572 7265 6e74 2064  ors in current d
-00015960: 696d 656e 7369 6f6e 616c 6974 7920 7370  imensionality sp
-00015970: 6163 652e 2222 220a 2020 2020 2020 2020  ace.""".        
-00015980: 7265 7475 726e 2033 2a2a 7365 6c66 2e6e  return 3**self.n
-00015990: 6469 6d0a 0a20 2020 2064 6566 2067 6574  dim..    def get
-000159a0: 5f6e 6569 6768 626f 725f 6365 6c6c 7328  _neighbor_cells(
-000159b0: 7365 6c66 2c20 6365 6c6c 733a 2074 6f72  self, cells: tor
-000159c0: 6368 2e54 656e 736f 7229 202d 3e20 746f  ch.Tensor) -> to
-000159d0: 7263 682e 5465 6e73 6f72 3a0a 2020 2020  rch.Tensor:.    
-000159e0: 2020 2020 2222 2243 6f6d 7075 7465 206e      """Compute n
-000159f0: 6569 6768 626f 7273 206f 6620 6365 6c6c  eighbors of cell
-00015a00: 7320 696e 2067 7269 642e 0a0a 2020 2020  s in grid...    
-00015a10: 2020 2020 2320 544f 444f 2872 6268 6172      # TODO(rbhar
-00015a20: 6174 6829 3a20 446f 2077 6520 6e65 6564  ath): Do we need
-00015a30: 2074 6f20 6861 6e64 6c65 2070 6572 696f   to handle perio
-00015a40: 6469 6320 626f 756e 6461 7279 2063 6f6e  dic boundary con
-00015a50: 6469 7469 6f6e 730a 2020 2020 2020 2020  ditions.        
-00015a60: 7072 6f70 6572 6c79 2068 6572 653f 0a20  properly here?. 
-00015a70: 2020 2020 2020 2023 2054 4f44 4f28 7262         # TODO(rb
-00015a80: 6861 7261 7468 293a 2054 6869 7320 646f  harath): This do
-00015a90: 6573 6e27 7420 6861 6e64 6c65 2062 6f75  esn't handle bou
-00015aa0: 6e64 6172 6965 7320 7765 6c6c 2e20 5765  ndaries well. We
-00015ab0: 2068 6172 642d 636f 6465 0a20 2020 2020   hard-code.     
-00015ac0: 2020 2023 206c 6f6f 6b69 6e67 2066 6f72     # looking for
-00015ad0: 206e 5f6e 6272 5f63 656c 6c73 206e 6569   n_nbr_cells nei
-00015ae0: 6768 626f 7273 2c20 7768 6963 6820 6973  ghbors, which is
-00015af0: 6e27 7420 7269 6768 7420 666f 7220 626f  n't right for bo
-00015b00: 756e 6461 7279 2063 656c 6c73 2069 6e0a  undary cells in.
-00015b10: 2020 2020 2020 2020 2320 7468 6520 6375          # the cu
-00015b20: 6265 2e0a 0a20 2020 2020 2020 2050 6172  be...        Par
-00015b30: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
-00015b40: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-00015b50: 2020 2063 656c 6c73 3a20 746f 7263 682e     cells: torch.
-00015b60: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
-00015b70: 2020 2028 6e5f 6365 6c6c 732c 206e 6469     (n_cells, ndi
-00015b80: 6d29 2073 6861 7065 2e0a 2020 2020 2020  m) shape..      
-00015b90: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-00015ba0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-00015bb0: 2020 6e62 725f 6365 6c6c 733a 2074 6f72    nbr_cells: tor
-00015bc0: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
-00015bd0: 2020 2020 2020 286e 5f63 656c 6c73 2c20        (n_cells, 
-00015be0: 6e5f 6e62 725f 6365 6c6c 7329 0a20 2020  n_nbr_cells).   
-00015bf0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00015c00: 206e 6469 6d2c 206e 5f63 656c 6c73 203d   ndim, n_cells =
-00015c10: 2073 656c 662e 6e64 696d 2c20 7365 6c66   self.ndim, self
-00015c20: 2e6e 5f63 656c 6c73 0a20 2020 2020 2020  .n_cells.       
-00015c30: 206e 5f6e 6272 5f63 656c 6c73 203d 2073   n_nbr_cells = s
-00015c40: 656c 662e 5f67 6574 5f6e 756d 5f6e 6272  elf._get_num_nbr
-00015c50: 7328 290a 2020 2020 2020 2020 2320 5469  s().        # Ti
-00015c60: 6c65 2063 656c 6c73 2074 6f20 666f 726d  le cells to form
-00015c70: 2061 7272 6179 7320 6f66 2073 697a 6520   arrays of size 
-00015c80: 286e 5f63 656c 6c73 2a6e 5f63 656c 6c73  (n_cells*n_cells
-00015c90: 2c20 6e64 696d 290a 2020 2020 2020 2020  , ndim).        
-00015ca0: 2320 5477 6f20 7469 6c69 6e67 7320 2861  # Two tilings (a
-00015cb0: 2c20 622c 2063 2c20 612c 2062 2c20 632c  , b, c, a, b, c,
-00015cc0: 202e 2e2e 2920 7673 2e20 2861 2c20 612c   ...) vs. (a, a,
-00015cd0: 2061 2c20 622c 2062 2c20 622c 2065 7463   a, b, b, b, etc
-00015ce0: 2e29 0a20 2020 2020 2020 2023 2054 696c  .).        # Til
-00015cf0: 6520 2861 2c20 612c 2061 2c20 622c 2062  e (a, a, a, b, b
-00015d00: 2c20 622c 2065 7463 2e29 0a20 2020 2020  , b, etc.).     
-00015d10: 2020 2074 696c 6564 5f63 656e 7465 7273     tiled_centers
-00015d20: 203d 2074 6f72 6368 2e72 6573 6861 7065   = torch.reshape
-00015d30: 2874 6f72 6368 2e74 696c 6528 6365 6c6c  (torch.tile(cell
-00015d40: 732c 2028 312c 206e 5f63 656c 6c73 2929  s, (1, n_cells))
-00015d50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00015d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015d70: 2020 2020 2020 2020 286e 5f63 656c 6c73          (n_cells
-00015d80: 202a 206e 5f63 656c 6c73 2c20 6e64 696d   * n_cells, ndim
-00015d90: 2929 0a20 2020 2020 2020 2023 2054 696c  )).        # Til
-00015da0: 6520 2861 2c20 622c 2063 2c20 612c 2062  e (a, b, c, a, b
-00015db0: 2c20 632c 202e 2e2e 290a 2020 2020 2020  , c, ...).      
-00015dc0: 2020 7469 6c65 645f 6365 6c6c 7320 3d20    tiled_cells = 
-00015dd0: 746f 7263 682e 7469 6c65 2863 656c 6c73  torch.tile(cells
-00015de0: 2c20 286e 5f63 656c 6c73 2c20 3129 290a  , (n_cells, 1)).
-00015df0: 0a20 2020 2020 2020 2063 6f6f 7264 735f  .        coords_
-00015e00: 7665 6320 3d20 746f 7263 682e 7375 6d28  vec = torch.sum(
-00015e10: 2874 696c 6564 5f63 656e 7465 7273 202d  (tiled_centers -
-00015e20: 2074 696c 6564 5f63 656c 6c73 292a 2a32   tiled_cells)**2
-00015e30: 2c20 6469 6d3d 2d31 290a 2020 2020 2020  , dim=-1).      
-00015e40: 2020 636f 6f72 6473 5f6e 6f72 6d20 3d20    coords_norm = 
-00015e50: 746f 7263 682e 7265 7368 6170 6528 636f  torch.reshape(co
-00015e60: 6f72 6473 5f76 6563 2c20 286e 5f63 656c  ords_vec, (n_cel
-00015e70: 6c73 2c20 6e5f 6365 6c6c 7329 290a 2020  ls, n_cells)).  
-00015e80: 2020 2020 2020 636c 6f73 6573 745f 696e        closest_in
-00015e90: 6473 203d 2074 6f72 6368 2e74 6f70 6b28  ds = torch.topk(
-00015ea0: 636f 6f72 6473 5f6e 6f72 6d2c 206b 3d6e  coords_norm, k=n
-00015eb0: 5f6e 6272 5f63 656c 6c73 2c20 6c61 7267  _nbr_cells, larg
-00015ec0: 6573 743d 4661 6c73 6529 5b31 5d0a 0a20  est=False)[1].. 
-00015ed0: 2020 2020 2020 2072 6574 7572 6e20 636c         return cl
-00015ee0: 6f73 6573 745f 696e 6473 0a0a 2020 2020  osest_inds..    
-00015ef0: 6465 6620 6765 745f 6365 6c6c 7328 7365  def get_cells(se
-00015f00: 6c66 2920 2d3e 2074 6f72 6368 2e54 656e  lf) -> torch.Ten
-00015f10: 736f 723a 0a20 2020 2020 2020 2022 2222  sor:.        """
-00015f20: 5265 7475 726e 7320 7468 6520 6c6f 6361  Returns the loca
-00015f30: 7469 6f6e 7320 6f66 2061 6c6c 2067 7269  tions of all gri
-00015f40: 6420 706f 696e 7473 2069 6e20 626f 782e  d points in box.
-00015f50: 0a0a 2020 2020 2020 2020 5375 7070 6f73  ..        Suppos
-00015f60: 6520 7374 6172 7420 6973 202d 3130 2041  e start is -10 A
-00015f70: 6e67 7374 726f 6d2c 2073 746f 7020 6973  ngstrom, stop is
-00015f80: 2031 3020 416e 6773 7472 6f6d 2c20 6e62   10 Angstrom, nb
-00015f90: 725f 6375 746f 6666 2069 7320 312e 0a20  r_cutoff is 1.. 
-00015fa0: 2020 2020 2020 2054 6865 6e20 776f 756c         Then woul
-00015fb0: 6420 7265 7475 726e 2061 206c 6973 7420  d return a list 
-00015fc0: 6f66 206c 656e 6774 6820 3230 5e33 2077  of length 20^3 w
-00015fd0: 686f 7365 2065 6e74 7269 6573 2077 6f75  hose entries wou
-00015fe0: 6c64 2062 650a 2020 2020 2020 2020 5b28  ld be.        [(
-00015ff0: 2d31 302c 202d 3130 2c20 2d31 3029 2c20  -10, -10, -10), 
-00016000: 282d 3130 2c20 2d31 302c 202d 3929 2c20  (-10, -10, -9), 
-00016010: 2e2e 2e2c 2028 392c 2039 2c20 3929 5d0a  ..., (9, 9, 9)].
-00016020: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00016030: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00016040: 0a20 2020 2020 2020 2063 656c 6c73 3a20  .        cells: 
-00016050: 746f 7263 682e 5465 6e73 6f72 0a20 2020  torch.Tensor.   
-00016060: 2020 2020 2020 2028 6e5f 6365 6c6c 732c         (n_cells,
-00016070: 206e 6469 6d29 2073 6861 7065 2e0a 2020   ndim) shape..  
-00016080: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00016090: 2020 7374 6172 742c 2073 746f 702c 206e    start, stop, n
-000160a0: 6272 5f63 7574 6f66 6620 3d20 7365 6c66  br_cutoff = self
-000160b0: 2e73 7461 7274 2c20 7365 6c66 2e73 746f  .start, self.sto
-000160c0: 702c 2073 656c 662e 6e62 725f 6375 746f  p, self.nbr_cuto
-000160d0: 6666 0a20 2020 2020 2020 206d 6573 685f  ff.        mesh_
-000160e0: 6172 6773 203d 205b 0a20 2020 2020 2020  args = [.       
-000160f0: 2020 2020 2074 6f72 6368 2e61 7261 6e67       torch.arang
-00016100: 6528 7374 6172 742c 2073 746f 702c 206e  e(start, stop, n
-00016110: 6272 5f63 7574 6f66 6629 2066 6f72 205f  br_cutoff) for _
-00016120: 2069 6e20 7261 6e67 6528 7365 6c66 2e6e   in range(self.n
-00016130: 6469 6d29 0a20 2020 2020 2020 205d 0a20  dim).        ]. 
-00016140: 2020 2020 2020 2072 6574 7572 6e20 746f         return to
-00016150: 7263 682e 7265 7368 6170 6528 0a20 2020  rch.reshape(.   
-00016160: 2020 2020 2020 2020 2074 6f72 6368 2e70           torch.p
-00016170: 6572 6d75 7465 280a 2020 2020 2020 2020  ermute(.        
-00016180: 2020 2020 2020 2020 746f 7263 682e 7374          torch.st
-00016190: 6163 6b28 746f 7263 682e 6d65 7368 6772  ack(torch.meshgr
-000161a0: 6964 282a 6d65 7368 5f61 7267 732c 2069  id(*mesh_args, i
-000161b0: 6e64 6578 696e 673d 2778 7927 2929 2c0a  ndexing='xy')),.
-000161c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000161d0: 7475 706c 6528 7261 6e67 6528 7365 6c66  tuple(range(self
-000161e0: 2e6e 6469 6d2c 202d 312c 202d 3129 2929  .ndim, -1, -1)))
-000161f0: 2c0a 2020 2020 2020 2020 2020 2020 2873  ,.            (s
-00016200: 656c 662e 6e5f 6365 6c6c 732c 2073 656c  elf.n_cells, sel
-00016210: 662e 6e64 696d 2929 2e74 6f28 746f 7263  f.ndim)).to(torc
-00016220: 682e 666c 6f61 7429 0a0a 0a63 6c61 7373  h.float)...class
-00016230: 204c 5354 4d53 7465 7028 6e6e 2e4d 6f64   LSTMStep(nn.Mod
-00016240: 756c 6529 3a0a 2020 2020 2222 224c 6179  ule):.    """Lay
-00016250: 6572 2074 6861 7420 7065 7266 6f72 6d73  er that performs
-00016260: 2061 2073 696e 676c 6520 7374 6570 204c   a single step L
-00016270: 5354 4d20 7570 6461 7465 2e0a 0a20 2020  STM update...   
-00016280: 2054 6869 7320 6973 2074 6865 2054 6f72   This is the Tor
-00016290: 6368 2065 7175 6976 616c 656e 7420 6f66  ch equivalent of
-000162a0: 2074 6865 206f 7269 6769 6e61 6c20 696d   the original im
-000162b0: 706c 656d 656e 7461 7469 6f6e 2075 7369  plementation usi
-000162c0: 6e67 204b 6572 6173 2e0a 2020 2020 2222  ng Keras..    ""
-000162d0: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
-000162e0: 745f 5f28 7365 6c66 2c0a 2020 2020 2020  t__(self,.      
-000162f0: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
-00016300: 745f 6469 6d2c 0a20 2020 2020 2020 2020  t_dim,.         
-00016310: 2020 2020 2020 2020 696e 7075 745f 6469          input_di
-00016320: 6d2c 0a20 2020 2020 2020 2020 2020 2020  m,.             
-00016330: 2020 2020 696e 6974 5f66 6e3d 2778 6176      init_fn='xav
-00016340: 6965 725f 756e 6966 6f72 6d5f 272c 0a20  ier_uniform_',. 
-00016350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016360: 696e 6e65 725f 696e 6974 5f66 6e3d 276f  inner_init_fn='o
-00016370: 7274 686f 676f 6e61 6c5f 272c 0a20 2020  rthogonal_',.   
-00016380: 2020 2020 2020 2020 2020 2020 2020 6163                ac
-00016390: 7469 7661 7469 6f6e 5f66 6e3d 2774 616e  tivation_fn='tan
-000163a0: 6827 2c0a 2020 2020 2020 2020 2020 2020  h',.            
-000163b0: 2020 2020 2069 6e6e 6572 5f61 6374 6976       inner_activ
-000163c0: 6174 696f 6e5f 666e 3d27 6861 7264 7369  ation_fn='hardsi
-000163d0: 676d 6f69 6427 2c0a 2020 2020 2020 2020  gmoid',.        
-000163e0: 2020 2020 2020 2020 202a 2a6b 7761 7267           **kwarg
-000163f0: 7329 3a0a 2020 2020 2020 2020 2222 220a  s):.        """.
-00016400: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-00016410: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-00016420: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6f75  -----.        ou
-00016430: 7470 7574 5f64 696d 3a20 696e 740a 2020  tput_dim: int.  
-00016440: 2020 2020 2020 2020 2020 4469 6d65 6e73            Dimens
-00016450: 696f 6e61 6c69 7479 206f 6620 6f75 7470  ionality of outp
-00016460: 7574 2076 6563 746f 7273 2e0a 2020 2020  ut vectors..    
-00016470: 2020 2020 696e 7075 745f 6469 6d3a 2069      input_dim: i
-00016480: 6e74 0a20 2020 2020 2020 2020 2020 2044  nt.            D
-00016490: 696d 656e 7369 6f6e 616c 6974 7920 6f66  imensionality of
-000164a0: 2069 6e70 7574 2076 6563 746f 7273 2e0a   input vectors..
-000164b0: 2020 2020 2020 2020 696e 6974 5f66 6e3a          init_fn:
-000164c0: 2073 7472 0a20 2020 2020 2020 2020 2020   str.           
-000164d0: 2050 7954 6f72 6368 2069 6e69 7469 616c   PyTorch initial
-000164e0: 697a 6174 696f 6e20 746f 2075 7365 2066  ization to use f
-000164f0: 6f72 2057 2e0a 2020 2020 2020 2020 696e  or W..        in
-00016500: 6e65 725f 696e 6974 5f66 6e3a 2073 7472  ner_init_fn: str
-00016510: 0a20 2020 2020 2020 2020 2020 2050 7954  .            PyT
-00016520: 6f72 6368 2069 6e69 7469 616c 697a 6174  orch initializat
-00016530: 696f 6e20 746f 2075 7365 2066 6f72 2055  ion to use for U
-00016540: 2e0a 2020 2020 2020 2020 6163 7469 7661  ..        activa
-00016550: 7469 6f6e 5f66 6e3a 2073 7472 0a20 2020  tion_fn: str.   
-00016560: 2020 2020 2020 2020 2050 7954 6f72 6368           PyTorch
-00016570: 2061 6374 6976 6174 696f 6e20 746f 2075   activation to u
-00016580: 7365 2066 6f72 206f 7574 7075 742e 0a20  se for output.. 
-00016590: 2020 2020 2020 2069 6e6e 6572 5f61 6374         inner_act
-000165a0: 6976 6174 696f 6e5f 666e 3a20 7374 720a  ivation_fn: str.
-000165b0: 2020 2020 2020 2020 2020 2020 5079 546f              PyTo
-000165c0: 7263 6820 6163 7469 7661 7469 6f6e 2074  rch activation t
-000165d0: 6f20 7573 6520 666f 7220 696e 6e65 7220  o use for inner 
-000165e0: 7374 6570 732e 0a20 2020 2020 2020 2022  steps..        "
-000165f0: 2222 0a0a 2020 2020 2020 2020 7375 7065  ""..        supe
-00016600: 7228 4c53 544d 5374 6570 2c20 7365 6c66  r(LSTMStep, self
-00016610: 292e 5f5f 696e 6974 5f5f 282a 2a6b 7761  ).__init__(**kwa
-00016620: 7267 7329 0a20 2020 2020 2020 2073 656c  rgs).        sel
-00016630: 662e 696e 6974 203d 2069 6e69 745f 666e  f.init = init_fn
-00016640: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
-00016650: 6e65 725f 696e 6974 203d 2069 6e6e 6572  ner_init = inner
-00016660: 5f69 6e69 745f 666e 0a20 2020 2020 2020  _init_fn.       
-00016670: 2073 656c 662e 6f75 7470 7574 5f64 696d   self.output_dim
-00016680: 203d 206f 7574 7075 745f 6469 6d0a 2020   = output_dim.  
-00016690: 2020 2020 2020 2320 4e6f 206f 7468 6572        # No other
-000166a0: 2066 6f72 6765 7420 6269 6173 6573 2073   forget biases s
-000166b0: 7570 706f 7274 6564 2072 6967 6874 206e  upported right n
-000166c0: 6f77 2e0a 2020 2020 2020 2020 7365 6c66  ow..        self
-000166d0: 2e61 6374 6976 6174 696f 6e20 3d20 6163  .activation = ac
-000166e0: 7469 7661 7469 6f6e 5f66 6e0a 2020 2020  tivation_fn.    
-000166f0: 2020 2020 7365 6c66 2e69 6e6e 6572 5f61      self.inner_a
-00016700: 6374 6976 6174 696f 6e20 3d20 696e 6e65  ctivation = inne
-00016710: 725f 6163 7469 7661 7469 6f6e 5f66 6e0a  r_activation_fn.
-00016720: 2020 2020 2020 2020 7365 6c66 2e61 6374          self.act
-00016730: 6976 6174 696f 6e5f 666e 203d 2067 6574  ivation_fn = get
-00016740: 5f61 6374 6976 6174 696f 6e28 6163 7469  _activation(acti
-00016750: 7661 7469 6f6e 5f66 6e29 0a20 2020 2020  vation_fn).     
-00016760: 2020 2073 656c 662e 696e 6e65 725f 6163     self.inner_ac
-00016770: 7469 7661 7469 6f6e 5f66 6e20 3d20 6765  tivation_fn = ge
-00016780: 745f 6163 7469 7661 7469 6f6e 2869 6e6e  t_activation(inn
-00016790: 6572 5f61 6374 6976 6174 696f 6e5f 666e  er_activation_fn
-000167a0: 290a 2020 2020 2020 2020 7365 6c66 2e69  ).        self.i
-000167b0: 6e70 7574 5f64 696d 203d 2069 6e70 7574  nput_dim = input
-000167c0: 5f64 696d 0a20 2020 2020 2020 2073 656c  _dim.        sel
-000167d0: 662e 6275 696c 6428 290a 0a20 2020 2064  f.build()..    d
-000167e0: 6566 2067 6574 5f63 6f6e 6669 6728 7365  ef get_config(se
-000167f0: 6c66 293a 0a20 2020 2020 2020 2063 6f6e  lf):.        con
-00016800: 6669 6720 3d20 7375 7065 7228 4c53 544d  fig = super(LSTM
-00016810: 5374 6570 2c20 7365 6c66 292e 6765 745f  Step, self).get_
-00016820: 636f 6e66 6967 2829 0a20 2020 2020 2020  config().       
-00016830: 2063 6f6e 6669 675b 276f 7574 7075 745f   config['output_
-00016840: 6469 6d27 5d20 3d20 7365 6c66 2e6f 7574  dim'] = self.out
-00016850: 7075 745f 6469 6d0a 2020 2020 2020 2020  put_dim.        
-00016860: 636f 6e66 6967 5b27 696e 7075 745f 6469  config['input_di
-00016870: 6d27 5d20 3d20 7365 6c66 2e69 6e70 7574  m'] = self.input
-00016880: 5f64 696d 0a20 2020 2020 2020 2063 6f6e  _dim.        con
-00016890: 6669 675b 2769 6e69 745f 666e 275d 203d  fig['init_fn'] =
-000168a0: 2073 656c 662e 696e 6974 0a20 2020 2020   self.init.     
-000168b0: 2020 2063 6f6e 6669 675b 2769 6e6e 6572     config['inner
-000168c0: 5f69 6e69 745f 666e 275d 203d 2073 656c  _init_fn'] = sel
-000168d0: 662e 696e 6e65 725f 696e 6974 0a20 2020  f.inner_init.   
-000168e0: 2020 2020 2063 6f6e 6669 675b 2761 6374       config['act
-000168f0: 6976 6174 696f 6e5f 666e 275d 203d 2073  ivation_fn'] = s
-00016900: 656c 662e 6163 7469 7661 7469 6f6e 0a20  elf.activation. 
-00016910: 2020 2020 2020 2063 6f6e 6669 675b 2769         config['i
-00016920: 6e6e 6572 5f61 6374 6976 6174 696f 6e5f  nner_activation_
-00016930: 666e 275d 203d 2073 656c 662e 696e 6e65  fn'] = self.inne
-00016940: 725f 6163 7469 7661 7469 6f6e 0a20 2020  r_activation.   
-00016950: 2020 2020 2072 6574 7572 6e20 636f 6e66       return conf
-00016960: 6967 0a0a 2020 2020 6465 6620 6765 745f  ig..    def get_
-00016970: 696e 6974 6961 6c5f 7374 6174 6573 2873  initial_states(s
-00016980: 656c 662c 2069 6e70 7574 5f73 6861 7065  elf, input_shape
-00016990: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-000169a0: 6e20 5b74 6f72 6368 2e7a 6572 6f73 2869  n [torch.zeros(i
-000169b0: 6e70 7574 5f73 6861 7065 292c 2074 6f72  nput_shape), tor
-000169c0: 6368 2e7a 6572 6f73 2869 6e70 7574 5f73  ch.zeros(input_s
-000169d0: 6861 7065 295d 0a0a 2020 2020 6465 6620  hape)]..    def 
-000169e0: 6275 696c 6428 7365 6c66 293a 0a20 2020  build(self):.   
-000169f0: 2020 2020 2022 2222 436f 6e73 7472 7563       """Construc
-00016a00: 7473 206c 6561 726e 6162 6c65 2077 6569  ts learnable wei
-00016a10: 6768 7473 2066 6f72 2074 6869 7320 6c61  ghts for this la
-00016a20: 7965 722e 2222 220a 2020 2020 2020 2020  yer.""".        
-00016a30: 696e 6974 203d 2067 6574 6174 7472 2869  init = getattr(i
-00016a40: 6e69 7469 616c 697a 6572 732c 2073 656c  nitializers, sel
-00016a50: 662e 696e 6974 290a 2020 2020 2020 2020  f.init).        
-00016a60: 696e 6e65 725f 696e 6974 203d 2067 6574  inner_init = get
-00016a70: 6174 7472 2869 6e69 7469 616c 697a 6572  attr(initializer
-00016a80: 732c 2073 656c 662e 696e 6e65 725f 696e  s, self.inner_in
-00016a90: 6974 290a 2020 2020 2020 2020 7365 6c66  it).        self
-00016aa0: 2e57 203d 2069 6e69 7428 746f 7263 682e  .W = init(torch.
-00016ab0: 656d 7074 7928 7365 6c66 2e69 6e70 7574  empty(self.input
-00016ac0: 5f64 696d 2c20 3420 2a20 7365 6c66 2e6f  _dim, 4 * self.o
-00016ad0: 7574 7075 745f 6469 6d29 290a 2020 2020  utput_dim)).    
-00016ae0: 2020 2020 7365 6c66 2e55 203d 2069 6e6e      self.U = inn
-00016af0: 6572 5f69 6e69 7428 746f 7263 682e 656d  er_init(torch.em
-00016b00: 7074 7928 7365 6c66 2e6f 7574 7075 745f  pty(self.output_
-00016b10: 6469 6d2c 2034 202a 2073 656c 662e 6f75  dim, 4 * self.ou
-00016b20: 7470 7574 5f64 696d 2929 0a0a 2020 2020  tput_dim))..    
-00016b30: 2020 2020 7365 6c66 2e62 203d 2074 6f72      self.b = tor
-00016b40: 6368 2e74 656e 736f 7228 6e70 2e68 7374  ch.tensor(np.hst
-00016b50: 6163 6b28 0a20 2020 2020 2020 2020 2020  ack(.           
-00016b60: 2028 6e70 2e7a 6572 6f73 2873 656c 662e   (np.zeros(self.
-00016b70: 6f75 7470 7574 5f64 696d 292c 206e 702e  output_dim), np.
-00016b80: 6f6e 6573 2873 656c 662e 6f75 7470 7574  ones(self.output
-00016b90: 5f64 696d 292c 0a20 2020 2020 2020 2020  _dim),.         
-00016ba0: 2020 2020 6e70 2e7a 6572 6f73 2873 656c      np.zeros(sel
-00016bb0: 662e 6f75 7470 7574 5f64 696d 292c 206e  f.output_dim), n
-00016bc0: 702e 7a65 726f 7328 7365 6c66 2e6f 7574  p.zeros(self.out
-00016bd0: 7075 745f 6469 6d29 2929 2c0a 2020 2020  put_dim))),.    
-00016be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016bf0: 2020 2020 2020 2020 2020 6474 7970 653d            dtype=
-00016c00: 746f 7263 682e 666c 6f61 7433 3229 0a0a  torch.float32)..
-00016c10: 2020 2020 6465 6620 666f 7277 6172 6428      def forward(
-00016c20: 7365 6c66 2c20 696e 7075 7473 293a 0a20  self, inputs):. 
-00016c30: 2020 2020 2020 2022 2222 4578 6563 7574         """Execut
-00016c40: 6520 7468 6973 206c 6179 6572 206f 6e20  e this layer on 
-00016c50: 696e 7075 7420 7465 6e73 6f72 732e 0a0a  input tensors...
-00016c60: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-00016c70: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-00016c80: 2d2d 2d2d 2d0a 2020 2020 2020 2020 696e  -----.        in
-00016c90: 7075 7473 3a20 6c69 7374 0a20 2020 2020  puts: list.     
-00016ca0: 2020 2020 2020 204c 6973 7420 6f66 2074         List of t
-00016cb0: 6872 6565 2074 656e 736f 7273 2028 782c  hree tensors (x,
-00016cc0: 2068 5f74 6d31 2c20 635f 746d 3129 2e20   h_tm1, c_tm1). 
-00016cd0: 685f 746d 3120 6d65 616e 7320 2268 2c20  h_tm1 means "h, 
-00016ce0: 742d 3122 2e0a 0a20 2020 2020 2020 2052  t-1"...        R
-00016cf0: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
-00016d00: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 206c  ------.        l
-00016d10: 6973 740a 2020 2020 2020 2020 2020 2020  ist.            
-00016d20: 5265 7475 726e 7320 682c 205b 682c 2063  Returns h, [h, c
-00016d30: 5d0a 2020 2020 2020 2020 2222 220a 2020  ].        """.  
-00016d40: 2020 2020 2020 782c 2068 5f74 6d31 2c20        x, h_tm1, 
-00016d50: 635f 746d 3120 3d20 696e 7075 7473 0a20  c_tm1 = inputs. 
-00016d60: 2020 2020 2020 2078 2c20 685f 746d 312c         x, h_tm1,
-00016d70: 2063 5f74 6d31 203d 2074 6f72 6368 2e74   c_tm1 = torch.t
-00016d80: 656e 736f 7228 7829 2c20 746f 7263 682e  ensor(x), torch.
-00016d90: 7465 6e73 6f72 2868 5f74 6d31 292c 2074  tensor(h_tm1), t
-00016da0: 6f72 6368 2e74 656e 736f 7228 0a20 2020  orch.tensor(.   
-00016db0: 2020 2020 2020 2020 2063 5f74 6d31 290a           c_tm1).
-00016dc0: 0a20 2020 2020 2020 207a 203d 2074 6f72  .        z = tor
-00016dd0: 6368 2e6d 6174 6d75 6c28 782c 2073 656c  ch.matmul(x, sel
-00016de0: 662e 5729 202b 2074 6f72 6368 2e6d 6174  f.W) + torch.mat
-00016df0: 6d75 6c28 685f 746d 312c 2073 656c 662e  mul(h_tm1, self.
-00016e00: 5529 202b 2073 656c 662e 620a 0a20 2020  U) + self.b..   
-00016e10: 2020 2020 207a 3020 3d20 7a5b 3a2c 203a       z0 = z[:, :
-00016e20: 7365 6c66 2e6f 7574 7075 745f 6469 6d5d  self.output_dim]
-00016e30: 0a20 2020 2020 2020 207a 3120 3d20 7a5b  .        z1 = z[
-00016e40: 3a2c 2073 656c 662e 6f75 7470 7574 5f64  :, self.output_d
-00016e50: 696d 3a32 202a 2073 656c 662e 6f75 7470  im:2 * self.outp
-00016e60: 7574 5f64 696d 5d0a 2020 2020 2020 2020  ut_dim].        
-00016e70: 7a32 203d 207a 5b3a 2c20 3220 2a20 7365  z2 = z[:, 2 * se
-00016e80: 6c66 2e6f 7574 7075 745f 6469 6d3a 3320  lf.output_dim:3 
-00016e90: 2a20 7365 6c66 2e6f 7574 7075 745f 6469  * self.output_di
-00016ea0: 6d5d 0a20 2020 2020 2020 207a 3320 3d20  m].        z3 = 
-00016eb0: 7a5b 3a2c 2033 202a 2073 656c 662e 6f75  z[:, 3 * self.ou
-00016ec0: 7470 7574 5f64 696d 3a5d 0a0a 2020 2020  tput_dim:]..    
-00016ed0: 2020 2020 6920 3d20 7365 6c66 2e69 6e6e      i = self.inn
-00016ee0: 6572 5f61 6374 6976 6174 696f 6e5f 666e  er_activation_fn
-00016ef0: 287a 3029 0a20 2020 2020 2020 2066 203d  (z0).        f =
-00016f00: 2073 656c 662e 696e 6e65 725f 6163 7469   self.inner_acti
-00016f10: 7661 7469 6f6e 5f66 6e28 7a31 290a 2020  vation_fn(z1).  
-00016f20: 2020 2020 2020 6320 3d20 6620 2a20 635f        c = f * c_
-00016f30: 746d 3120 2b20 6920 2a20 7365 6c66 2e61  tm1 + i * self.a
-00016f40: 6374 6976 6174 696f 6e5f 666e 287a 3229  ctivation_fn(z2)
-00016f50: 0a20 2020 2020 2020 206f 203d 2073 656c  .        o = sel
-00016f60: 662e 696e 6e65 725f 6163 7469 7661 7469  f.inner_activati
-00016f70: 6f6e 5f66 6e28 7a33 290a 0a20 2020 2020  on_fn(z3)..     
-00016f80: 2020 2068 203d 206f 202a 2073 656c 662e     h = o * self.
-00016f90: 6163 7469 7661 7469 6f6e 5f66 6e28 6329  activation_fn(c)
-00016fa0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00016fb0: 682c 205b 682c 2063 5d0a 0a0a 636c 6173  h, [h, c]...clas
-00016fc0: 7320 4174 6f6d 6963 436f 6e76 6f6c 7574  s AtomicConvolut
-00016fd0: 696f 6e28 6e6e 2e4d 6f64 756c 6529 3a0a  ion(nn.Module):.
-00016fe0: 2020 2020 2222 2249 6d70 6c65 6d65 6e74      """Implement
-00016ff0: 7320 7468 6520 4174 6f6d 6963 2043 6f6e  s the Atomic Con
-00017000: 766f 6c75 7469 6f6e 616c 2074 7261 6e73  volutional trans
-00017010: 666f 726d 2c20 696e 7472 6f64 7563 6564  form, introduced
-00017020: 2069 6e0a 0a20 2020 2047 6f6d 6573 2c20   in..    Gomes, 
-00017030: 4a6f 7365 7068 2c20 6574 2061 6c2e 2022  Joseph, et al. "
-00017040: 4174 6f6d 6963 2063 6f6e 766f 6c75 7469  Atomic convoluti
-00017050: 6f6e 616c 206e 6574 776f 726b 7320 666f  onal networks fo
-00017060: 7220 7072 6564 6963 7469 6e67 0a20 2020  r predicting.   
-00017070: 2070 726f 7465 696e 2d6c 6967 616e 6420   protein-ligand 
-00017080: 6269 6e64 696e 6720 6166 6669 6e69 7479  binding affinity
-00017090: 2e22 2061 7258 6976 2070 7265 7072 696e  ." arXiv preprin
-000170a0: 7420 6172 5869 763a 3137 3033 2e31 3036  t arXiv:1703.106
-000170b0: 3033 0a20 2020 2028 3230 3137 292e 0a0a  03.    (2017)...
-000170c0: 2020 2020 4174 2061 2068 6967 6820 6c65      At a high le
-000170d0: 7665 6c2c 2074 6869 7320 7472 616e 7366  vel, this transf
-000170e0: 6f72 6d20 7065 7266 6f72 6d73 2061 2067  orm performs a g
-000170f0: 7261 7068 2063 6f6e 766f 6c75 7469 6f6e  raph convolution
-00017100: 0a20 2020 206f 6e20 7468 6520 6e65 6172  .    on the near
-00017110: 6573 7420 6e65 6967 6862 6f72 7320 6772  est neighbors gr
-00017120: 6170 6820 696e 2033 4420 7370 6163 652e  aph in 3D space.
-00017130: 0a0a 2020 2020 4578 616d 706c 6573 0a20  ..    Examples. 
-00017140: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
-00017150: 3e3e 3e20 6261 7463 685f 7369 7a65 203d  >>> batch_size =
-00017160: 2034 0a20 2020 203e 3e3e 206d 6178 5f61   4.    >>> max_a
-00017170: 746f 6d73 203d 2035 0a20 2020 203e 3e3e  toms = 5.    >>>
-00017180: 206d 6178 5f6e 6569 6768 626f 7273 203d   max_neighbors =
-00017190: 2032 0a20 2020 203e 3e3e 2064 696d 656e   2.    >>> dimen
-000171a0: 7369 6f6e 7320 3d20 330a 2020 2020 3e3e  sions = 3.    >>
-000171b0: 3e20 7261 6469 616c 5f70 6172 616d 7320  > radial_params 
-000171c0: 3d20 746f 7263 682e 7465 6e73 6f72 285b  = torch.tensor([
-000171d0: 5b35 2e30 2c20 322e 302c 2030 2e35 5d2c  [5.0, 2.0, 0.5],
-000171e0: 205b 3130 2e30 2c20 322e 302c 2030 2e35   [10.0, 2.0, 0.5
-000171f0: 5d2c 0a20 2020 202e 2e2e 2020 2020 2020  ],.    ...      
-00017200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017210: 2020 2020 2020 2020 205b 352e 302c 2031           [5.0, 1
-00017220: 2e30 2c20 302e 325d 5d29 0a20 2020 203e  .0, 0.2]]).    >
-00017230: 3e3e 2069 6e70 7574 3120 3d20 6e70 2e72  >> input1 = np.r
-00017240: 616e 646f 6d2e 7261 6e64 2862 6174 6368  andom.rand(batch
-00017250: 5f73 697a 652c 206d 6178 5f61 746f 6d73  _size, max_atoms
-00017260: 2c20 6469 6d65 6e73 696f 6e73 292e 6173  , dimensions).as
-00017270: 7479 7065 286e 702e 666c 6f61 7433 3229  type(np.float32)
-00017280: 0a20 2020 203e 3e3e 2069 6e70 7574 3220  .    >>> input2 
-00017290: 3d20 6e70 2e72 616e 646f 6d2e 7261 6e64  = np.random.rand
-000172a0: 696e 7428 6d61 785f 6174 6f6d 732c 0a20  int(max_atoms,. 
-000172b0: 2020 202e 2e2e 2020 2020 2020 2020 2020     ...          
-000172c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000172d0: 2020 7369 7a65 3d28 6261 7463 685f 7369    size=(batch_si
-000172e0: 7a65 2c20 6d61 785f 6174 6f6d 732c 206d  ze, max_atoms, m
-000172f0: 6178 5f6e 6569 6768 626f 7273 2929 0a20  ax_neighbors)). 
-00017300: 2020 203e 3e3e 2069 6e70 7574 3320 3d20     >>> input3 = 
-00017310: 6e70 2e72 616e 646f 6d2e 7261 6e64 696e  np.random.randin
-00017320: 7428 312c 2031 302c 2073 697a 653d 2862  t(1, 10, size=(b
-00017330: 6174 6368 5f73 697a 652c 206d 6178 5f61  atch_size, max_a
-00017340: 746f 6d73 2c20 6d61 785f 6e65 6967 6862  toms, max_neighb
-00017350: 6f72 7329 290a 2020 2020 3e3e 3e20 6c61  ors)).    >>> la
-00017360: 7965 7220 3d20 4174 6f6d 6963 436f 6e76  yer = AtomicConv
-00017370: 6f6c 7574 696f 6e28 7261 6469 616c 5f70  olution(radial_p
-00017380: 6172 616d 733d 7261 6469 616c 5f70 6172  arams=radial_par
-00017390: 616d 7329 0a20 2020 203e 3e3e 2072 6573  ams).    >>> res
-000173a0: 756c 7420 3d20 6c61 7965 7228 5b69 6e70  ult = layer([inp
-000173b0: 7574 312c 2069 6e70 7574 322c 2069 6e70  ut1, input2, inp
-000173c0: 7574 335d 290a 2020 2020 3e3e 3e20 7265  ut3]).    >>> re
-000173d0: 7375 6c74 2e73 6861 7065 0a20 2020 2074  sult.shape.    t
-000173e0: 6f72 6368 2e53 697a 6528 5b34 2c20 352c  orch.Size([4, 5,
-000173f0: 2033 5d29 0a20 2020 2022 2222 0a0a 2020   3]).    """..  
-00017400: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-00017410: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
-00017420: 2020 2020 2020 6174 6f6d 5f74 7970 6573        atom_types
-00017430: 3a20 4f70 7469 6f6e 616c 5b55 6e69 6f6e  : Optional[Union
-00017440: 5b41 7272 6179 4c69 6b65 2c20 746f 7263  [ArrayLike, torc
-00017450: 682e 5465 6e73 6f72 5d5d 203d 204e 6f6e  h.Tensor]] = Non
-00017460: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00017470: 2020 2020 7261 6469 616c 5f70 6172 616d      radial_param
-00017480: 733a 2055 6e69 6f6e 5b41 7272 6179 4c69  s: Union[ArrayLi
-00017490: 6b65 2c20 746f 7263 682e 5465 6e73 6f72  ke, torch.Tensor
-000174a0: 5d20 3d20 6c69 7374 2829 2c0a 2020 2020  ] = list(),.    
-000174b0: 2020 2020 2020 2020 2020 2020 2062 6f78               box
-000174c0: 5f73 697a 653a 204f 7074 696f 6e61 6c5b  _size: Optional[
-000174d0: 556e 696f 6e5b 4172 7261 794c 696b 652c  Union[ArrayLike,
-000174e0: 2074 6f72 6368 2e54 656e 736f 725d 5d20   torch.Tensor]] 
-000174f0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00017500: 2020 2020 2020 2020 202a 2a6b 7761 7267           **kwarg
-00017510: 7329 3a0a 2020 2020 2020 2020 2222 2249  s):.        """I
-00017520: 6e69 7469 616c 697a 6520 7468 6973 206c  nitialize this l
-00017530: 6179 6572 2e0a 0a20 2020 2020 2020 2050  ayer...        P
-00017540: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
-00017550: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-00017560: 2020 2020 2061 746f 6d5f 7479 7065 7320       atom_types 
-00017570: 3a20 556e 696f 6e5b 4172 7261 794c 696b  : Union[ArrayLik
-00017580: 652c 2074 6f72 6368 2e54 656e 736f 725d  e, torch.Tensor]
-00017590: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-000175a0: 2020 2020 2020 204c 6973 7420 6f66 2061         List of a
-000175b0: 746f 6d20 7479 7065 732e 0a20 2020 2020  tom types..     
-000175c0: 2020 2072 6164 6961 6c5f 7061 7261 6d73     radial_params
-000175d0: 203a 2055 6e69 6f6e 5b41 7272 6179 4c69   : Union[ArrayLi
-000175e0: 6b65 2c20 746f 7263 682e 5465 6e73 6f72  ke, torch.Tensor
-000175f0: 5d2c 206f 7074 696f 6e61 6c0a 2020 2020  ], optional.    
-00017600: 2020 2020 2020 2020 4c69 7374 206f 6620          List of 
-00017610: 7261 6469 616c 2070 6172 616d 732e 0a20  radial params.. 
-00017620: 2020 2020 2020 2062 6f78 5f73 697a 6520         box_size 
-00017630: 3a20 556e 696f 6e5b 4172 7261 794c 696b  : Union[ArrayLik
-00017640: 652c 2074 6f72 6368 2e54 656e 736f 725d  e, torch.Tensor]
-00017650: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-00017660: 2020 2020 2020 204c 656e 6774 6820 6d75         Length mu
-00017670: 7374 2062 6520 6571 7561 6c20 746f 2074  st be equal to t
-00017680: 6865 206e 756d 6265 7220 6f66 2066 6561  he number of fea
-00017690: 7475 7265 732e 0a20 2020 2020 2020 2022  tures..        "
-000176a0: 2222 0a0a 2020 2020 2020 2020 7375 7065  ""..        supe
-000176b0: 7228 4174 6f6d 6963 436f 6e76 6f6c 7574  r(AtomicConvolut
-000176c0: 696f 6e2c 2073 656c 6629 2e5f 5f69 6e69  ion, self).__ini
-000176d0: 745f 5f28 2a2a 6b77 6172 6773 290a 2020  t__(**kwargs).  
-000176e0: 2020 2020 2020 7365 6c66 2e61 746f 6d5f        self.atom_
-000176f0: 7479 7065 7320 3d20 6174 6f6d 5f74 7970  types = atom_typ
-00017700: 6573 0a20 2020 2020 2020 2073 656c 662e  es.        self.
-00017710: 7261 6469 616c 5f70 6172 616d 7320 3d20  radial_params = 
-00017720: 7261 6469 616c 5f70 6172 616d 730a 0a20  radial_params.. 
-00017730: 2020 2020 2020 2069 6620 626f 785f 7369         if box_si
-00017740: 7a65 2069 7320 4e6f 6e65 206f 7220 6973  ze is None or is
-00017750: 696e 7374 616e 6365 2862 6f78 5f73 697a  instance(box_siz
-00017760: 652c 2074 6f72 6368 2e54 656e 736f 7229  e, torch.Tensor)
-00017770: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00017780: 6c66 2e62 6f78 5f73 697a 6520 3d20 626f  lf.box_size = bo
-00017790: 785f 7369 7a65 0a20 2020 2020 2020 2065  x_size.        e
-000177a0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000177b0: 2073 656c 662e 626f 785f 7369 7a65 203d   self.box_size =
-000177c0: 2074 6f72 6368 2e74 656e 736f 7228 626f   torch.tensor(bo
-000177d0: 785f 7369 7a65 290a 0a20 2020 2020 2020  x_size)..       
-000177e0: 2076 6172 7320 3d20 5b5d 0a20 2020 2020   vars = [].     
-000177f0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-00017800: 6528 3329 3a0a 2020 2020 2020 2020 2020  e(3):.          
-00017810: 2020 7661 6c20 3d20 6e70 2e61 7272 6179    val = np.array
-00017820: 285b 705b 695d 2066 6f72 2070 2069 6e20  ([p[i] for p in 
-00017830: 7365 6c66 2e72 6164 6961 6c5f 7061 7261  self.radial_para
-00017840: 6d73 5d29 2e72 6573 6861 7065 280a 2020  ms]).reshape(.  
-00017850: 2020 2020 2020 2020 2020 2020 2020 282d                (-
-00017860: 312c 2031 2c20 312c 2031 2929 0a20 2020  1, 1, 1, 1)).   
-00017870: 2020 2020 2020 2020 2076 6172 732e 6170           vars.ap
-00017880: 7065 6e64 2874 6f72 6368 2e74 656e 736f  pend(torch.tenso
-00017890: 7228 7661 6c2c 2064 7479 7065 3d74 6f72  r(val, dtype=tor
-000178a0: 6368 2e66 6c6f 6174 2929 0a20 2020 2020  ch.float)).     
-000178b0: 2020 2073 656c 662e 7263 203d 206e 6e2e     self.rc = nn.
-000178c0: 5061 7261 6d65 7465 7228 7661 7273 5b30  Parameter(vars[0
-000178d0: 5d29 0a20 2020 2020 2020 2073 656c 662e  ]).        self.
-000178e0: 7273 203d 206e 6e2e 5061 7261 6d65 7465  rs = nn.Paramete
-000178f0: 7228 7661 7273 5b31 5d29 0a20 2020 2020  r(vars[1]).     
-00017900: 2020 2073 656c 662e 7265 203d 206e 6e2e     self.re = nn.
-00017910: 5061 7261 6d65 7465 7228 7661 7273 5b32  Parameter(vars[2
-00017920: 5d29 0a0a 2020 2020 6465 6620 5f5f 7265  ])..    def __re
-00017930: 7072 5f5f 2873 656c 6629 3a0a 2020 2020  pr__(self):.    
-00017940: 2020 2020 7265 7475 726e 2028 0a20 2020      return (.   
-00017950: 2020 2020 2020 2020 2066 277b 7365 6c66           f'{self
-00017960: 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  .__class__.__nam
-00017970: 655f 5f7d 2861 746f 6d5f 7479 7065 733d  e__}(atom_types=
-00017980: 7b73 656c 662e 6174 6f6d 5f74 7970 6573  {self.atom_types
-00017990: 7d2c 2072 6164 6961 6c5f 7061 7261 6d73  }, radial_params
-000179a0: 3d7b 7365 6c66 2e72 6164 6961 6c5f 7061  ={self.radial_pa
-000179b0: 7261 6d73 7d2c 2062 6f78 5f73 697a 653d  rams}, box_size=
-000179c0: 7b73 656c 662e 626f 785f 7369 7a65 7d2c  {self.box_size},
-000179d0: 2072 633d 7b73 656c 662e 7263 7d2c 2072   rc={self.rc}, r
-000179e0: 733d 7b73 656c 662e 7273 7d2c 2072 653d  s={self.rs}, re=
-000179f0: 7b73 656c 662e 7265 7d29 270a 2020 2020  {self.re})'.    
-00017a00: 2020 2020 290a 0a20 2020 2064 6566 2066      )..    def f
-00017a10: 6f72 7761 7264 280a 2020 2020 2020 2020  orward(.        
-00017a20: 2020 2020 7365 6c66 2c20 696e 7075 7473      self, inputs
-00017a30: 3a20 5365 7175 656e 6365 5b55 6e69 6f6e  : Sequence[Union
-00017a40: 5b41 7272 6179 4c69 6b65 2c0a 2020 2020  [ArrayLike,.    
-00017a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017a70: 2020 2020 2074 6f72 6368 2e54 656e 736f       torch.Tenso
-00017a80: 725d 5d29 202d 3e20 746f 7263 682e 5465  r]]) -> torch.Te
-00017a90: 6e73 6f72 3a0a 2020 2020 2020 2020 2222  nsor:.        ""
-00017aa0: 2249 6e76 6f6b 6520 7468 6973 206c 6179  "Invoke this lay
-00017ab0: 6572 2e0a 0a20 2020 2020 2020 2042 2c20  er...        B, 
-00017ac0: 4e2c 204d 2c20 642c 206c 203d 2062 6174  N, M, d, l = bat
-00017ad0: 6368 5f73 697a 652c 206d 6178 5f6e 756d  ch_size, max_num
-00017ae0: 5f61 746f 6d73 2c20 6d61 785f 6e75 6d5f  _atoms, max_num_
-00017af0: 6e65 6967 6862 6f72 732c 206e 756d 5f66  neighbors, num_f
-00017b00: 6561 7475 7265 732c 206c 656e 2872 6164  eatures, len(rad
-00017b10: 6961 6c5f 7061 7261 6d73 2920 2a20 6c65  ial_params) * le
-00017b20: 6e28 6174 6f6d 5f74 7970 6573 290a 0a20  n(atom_types).. 
-00017b30: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-00017b40: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00017b50: 2d2d 2d2d 0a20 2020 2020 2020 2069 6e70  ----.        inp
-00017b60: 7574 733a 2053 6571 7565 6e63 655b 556e  uts: Sequence[Un
-00017b70: 696f 6e5b 4172 7261 794c 696b 652c 2074  ion[ArrayLike, t
-00017b80: 6f72 6368 2e54 656e 736f 725d 5d0a 2020  orch.Tensor]].  
-00017b90: 2020 2020 2020 2020 2020 4669 7273 7420            First 
-00017ba0: 696e 7075 7420 6172 6520 7468 6520 636f  input are the co
-00017bb0: 6f72 6469 6e61 7465 732f 6665 6174 7572  ordinates/featur
-00017bc0: 6573 2c20 6f66 2073 6861 7065 2028 422c  es, of shape (B,
-00017bd0: 204e 2c20 6429 0a20 2020 2020 2020 2020   N, d).         
-00017be0: 2020 2053 6563 6f6e 6420 696e 7075 7420     Second input 
-00017bf0: 6973 2074 6865 206e 6569 6768 626f 7220  is the neighbor 
-00017c00: 6c69 7374 2c20 6f66 2073 6861 7065 2028  list, of shape (
-00017c10: 422c 204e 2c20 4d29 0a20 2020 2020 2020  B, N, M).       
-00017c20: 2020 2020 2054 6869 7264 2069 6e70 7574       Third input
-00017c30: 2061 7265 2074 6865 2061 746f 6d69 6320   are the atomic 
-00017c40: 6e75 6d62 6572 7320 6f66 206e 6569 6768  numbers of neigh
-00017c50: 626f 7220 6174 6f6d 732c 206f 6620 7368  bor atoms, of sh
-00017c60: 6170 6520 2842 2c20 4e2c 204d 290a 0a20  ape (B, N, M).. 
-00017c70: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
-00017c80: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
-00017c90: 2020 2020 2020 2074 6f72 6368 2e54 656e         torch.Ten
-00017ca0: 736f 7220 6f66 2073 6861 7065 2028 422c  sor of shape (B,
-00017cb0: 204e 2c20 6c29 0a20 2020 2020 2020 2020   N, l).         
-00017cc0: 2020 204f 7574 7075 7420 6f66 2061 746f     Output of ato
-00017cd0: 6d69 6320 636f 6e76 6f6c 7574 696f 6e20  mic convolution 
-00017ce0: 6c61 7965 722e 0a0a 2020 2020 2020 2020  layer...        
-00017cf0: 5261 6973 6573 0a20 2020 2020 2020 202d  Raises.        -
-00017d00: 2d2d 2d2d 2d0a 2020 2020 2020 2020 5661  -----.        Va
-00017d10: 6c75 6545 7272 6f72 0a20 2020 2020 2020  lueError.       
-00017d20: 2020 2020 2057 6865 6e20 7468 6520 6c65       When the le
-00017d30: 6e67 7468 206f 6620 6069 6e70 7574 7360  ngth of `inputs`
-00017d40: 2069 7320 6e6f 7420 6571 7561 6c20 746f   is not equal to
-00017d50: 2033 2e0a 2020 2020 2020 2020 2222 220a   3..        """.
-00017d60: 2020 2020 2020 2020 6966 206c 656e 2869          if len(i
-00017d70: 6e70 7574 7329 2021 3d20 333a 0a20 2020  nputs) != 3:.   
-00017d80: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00017d90: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-00017da0: 2020 2020 2020 2020 2020 2066 2260 696e             f"`in
-00017db0: 7075 7473 6020 6861 7320 746f 2062 6520  puts` has to be 
-00017dc0: 6f66 206c 656e 6774 6820 332c 2067 6f74  of length 3, got
-00017dd0: 3a20 7b6c 656e 2869 6e70 7574 7329 7d22  : {len(inputs)}"
-00017de0: 290a 0a20 2020 2020 2020 2058 203d 2074  )..        X = t
-00017df0: 6f72 6368 2e74 656e 736f 7228 696e 7075  orch.tensor(inpu
-00017e00: 7473 5b30 5d29 0a20 2020 2020 2020 204e  ts[0]).        N
-00017e10: 6272 7320 3d20 746f 7263 682e 7465 6e73  brs = torch.tens
-00017e20: 6f72 2869 6e70 7574 735b 315d 2c20 6474  or(inputs[1], dt
-00017e30: 7970 653d 746f 7263 682e 696e 7436 3429  ype=torch.int64)
-00017e40: 0a20 2020 2020 2020 204e 6272 735f 5a20  .        Nbrs_Z 
-00017e50: 3d20 746f 7263 682e 7465 6e73 6f72 2869  = torch.tensor(i
-00017e60: 6e70 7574 735b 325d 290a 0a20 2020 2020  nputs[2])..     
-00017e70: 2020 2042 2c20 4e2c 2064 203d 2058 2e73     B, N, d = X.s
-00017e80: 6861 7065 0a20 2020 2020 2020 204d 203d  hape.        M =
-00017e90: 204e 6272 732e 7368 6170 655b 2d31 5d0a   Nbrs.shape[-1].
-00017ea0: 0a20 2020 2020 2020 2044 203d 2073 656c  .        D = sel
-00017eb0: 662e 6469 7374 616e 6365 5f74 656e 736f  f.distance_tenso
-00017ec0: 7228 582c 204e 6272 732c 2073 656c 662e  r(X, Nbrs, self.
-00017ed0: 626f 785f 7369 7a65 2c20 422c 204e 2c20  box_size, B, N, 
-00017ee0: 4d2c 2064 290a 2020 2020 2020 2020 5220  M, d).        R 
-00017ef0: 3d20 7365 6c66 2e64 6973 7461 6e63 655f  = self.distance_
-00017f00: 6d61 7472 6978 2844 290a 2020 2020 2020  matrix(D).      
-00017f10: 2020 5220 3d20 746f 7263 682e 756e 7371    R = torch.unsq
-00017f20: 7565 657a 6528 522c 2030 290a 2020 2020  ueeze(R, 0).    
-00017f30: 2020 2020 7273 6620 3d20 7365 6c66 2e72      rsf = self.r
-00017f40: 6164 6961 6c5f 7379 6d6d 6574 7279 5f66  adial_symmetry_f
-00017f50: 756e 6374 696f 6e28 522c 2073 656c 662e  unction(R, self.
-00017f60: 7263 2c20 7365 6c66 2e72 732c 2073 656c  rc, self.rs, sel
-00017f70: 662e 7265 290a 0a20 2020 2020 2020 2069  f.re)..        i
-00017f80: 6620 6e6f 7420 7365 6c66 2e61 746f 6d5f  f not self.atom_
-00017f90: 7479 7065 733a 0a20 2020 2020 2020 2020  types:.         
-00017fa0: 2020 2063 6f6e 6420 3d20 746f 7263 682e     cond = torch.
-00017fb0: 6e6f 745f 6571 7561 6c28 4e62 7273 5f5a  not_equal(Nbrs_Z
-00017fc0: 2c20 3029 2e74 6f28 746f 7263 682e 666c  , 0).to(torch.fl
-00017fd0: 6f61 7429 2e72 6573 6861 7065 280a 2020  oat).reshape(.  
-00017fe0: 2020 2020 2020 2020 2020 2020 2020 2831                (1
-00017ff0: 2c20 2d31 2c20 4e2c 204d 2929 0a20 2020  , -1, N, M)).   
-00018000: 2020 2020 2020 2020 206c 6179 6572 203d           layer =
-00018010: 2074 6f72 6368 2e73 756d 2863 6f6e 6420   torch.sum(cond 
-00018020: 2a20 7273 662c 2033 290a 2020 2020 2020  * rsf, 3).      
-00018030: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00018040: 2020 2020 2320 5375 6d20 7468 6520 7061      # Sum the pa
-00018050: 6972 7769 7365 2d69 6e74 6572 6163 7469  irwise-interacti
-00018060: 6f6e 7320 6265 7477 6565 6e20 6174 6f6d  ons between atom
-00018070: 7320 7468 6174 2061 7265 206f 6620 6061  s that are of `a
-00018080: 746f 6d5f 7479 7065 6020 616e 6420 6974  tom_type` and it
-00018090: 7320 6e65 6967 6862 6f72 7320 666f 7220  s neighbors for 
-000180a0: 6561 6368 2061 746f 6d20 7479 7065 2069  each atom type i
-000180b0: 6e20 6061 746f 6d5f 7479 7065 7360 2e0a  n `atom_types`..
-000180c0: 2020 2020 2020 2020 2020 2020 7379 6d6d              symm
-000180d0: 6574 7269 6573 203d 205b 5d0a 2020 2020  etries = [].    
-000180e0: 2020 2020 2020 2020 666f 7220 6174 6f6d          for atom
-000180f0: 5f74 7970 6520 696e 2073 656c 662e 6174  _type in self.at
-00018100: 6f6d 5f74 7970 6573 3a0a 2020 2020 2020  om_types:.      
-00018110: 2020 2020 2020 2020 2020 636f 6e64 203d            cond =
-00018120: 2074 6f72 6368 2e65 7128 4e62 7273 5f5a   torch.eq(Nbrs_Z
-00018130: 2c20 6174 6f6d 5f74 7970 6529 2e74 6f28  , atom_type).to(
-00018140: 746f 7263 682e 666c 6f61 7429 2e72 6573  torch.float).res
-00018150: 6861 7065 280a 2020 2020 2020 2020 2020  hape(.          
-00018160: 2020 2020 2020 2020 2020 2831 2c20 2d31            (1, -1
-00018170: 2c20 4e2c 204d 2929 0a20 2020 2020 2020  , N, M)).       
-00018180: 2020 2020 2020 2020 2073 796d 6d65 7472           symmetr
-00018190: 6965 732e 6170 7065 6e64 2874 6f72 6368  ies.append(torch
-000181a0: 2e73 756d 2863 6f6e 6420 2a20 7273 662c  .sum(cond * rsf,
-000181b0: 2033 2929 0a20 2020 2020 2020 2020 2020   3)).           
-000181c0: 206c 6179 6572 203d 2074 6f72 6368 2e63   layer = torch.c
-000181d0: 6f6e 6361 7428 7379 6d6d 6574 7269 6573  oncat(symmetries
-000181e0: 2c20 3029 0a0a 2020 2020 2020 2020 6c61  , 0)..        la
-000181f0: 7965 7220 3d20 746f 7263 682e 7065 726d  yer = torch.perm
-00018200: 7574 6528 6c61 7965 722c 205b 312c 2032  ute(layer, [1, 2
-00018210: 2c20 305d 290a 2020 2020 2020 2020 7661  , 0]).        va
-00018220: 722c 206d 6561 6e20 3d20 746f 7263 682e  r, mean = torch.
-00018230: 7661 725f 6d65 616e 286c 6179 6572 2c20  var_mean(layer, 
-00018240: 5b30 2c20 325d 290a 2020 2020 2020 2020  [0, 2]).        
-00018250: 7661 722c 206d 6561 6e20 3d20 7661 722e  var, mean = var.
-00018260: 6465 7461 6368 2829 2c20 6d65 616e 2e64  detach(), mean.d
-00018270: 6574 6163 6828 290a 0a20 2020 2020 2020  etach()..       
-00018280: 2072 6574 7572 6e20 462e 6261 7463 685f   return F.batch_
-00018290: 6e6f 726d 286c 6179 6572 2c20 6d65 616e  norm(layer, mean
-000182a0: 2c20 7661 7229 0a0a 2020 2020 6465 6620  , var)..    def 
-000182b0: 6469 7374 616e 6365 5f74 656e 736f 7228  distance_tensor(
-000182c0: 7365 6c66 2c20 583a 2074 6f72 6368 2e54  self, X: torch.T
-000182d0: 656e 736f 722c 204e 6272 733a 2074 6f72  ensor, Nbrs: tor
-000182e0: 6368 2e54 656e 736f 722c 0a20 2020 2020  ch.Tensor,.     
-000182f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018300: 2020 2062 6f78 5f73 697a 653a 2055 6e69     box_size: Uni
-00018310: 6f6e 5b74 6f72 6368 2e54 656e 736f 722c  on[torch.Tensor,
-00018320: 204e 6f6e 655d 2c20 423a 2069 6e74 2c20   None], B: int, 
-00018330: 4e3a 2069 6e74 2c0a 2020 2020 2020 2020  N: int,.        
-00018340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018350: 4d3a 2069 6e74 2c20 643a 2069 6e74 2920  M: int, d: int) 
-00018360: 2d3e 2074 6f72 6368 2e54 656e 736f 723a  -> torch.Tensor:
-00018370: 0a20 2020 2020 2020 2022 2222 4361 6c63  .        """Calc
-00018380: 756c 6174 6520 6469 7374 616e 6365 2074  ulate distance t
-00018390: 656e 736f 7220 666f 7220 6120 6261 7463  ensor for a batc
-000183a0: 6820 6f66 206d 6f6c 6563 756c 6573 2e0a  h of molecules..
-000183b0: 0a20 2020 2020 2020 2042 2c20 4e2c 204d  .        B, N, M
-000183c0: 2c20 6420 3d20 6261 7463 685f 7369 7a65  , d = batch_size
-000183d0: 2c20 6d61 785f 6e75 6d5f 6174 6f6d 732c  , max_num_atoms,
-000183e0: 206d 6178 5f6e 756d 5f6e 6569 6768 626f   max_num_neighbo
-000183f0: 7273 2c20 6e75 6d5f 6665 6174 7572 6573  rs, num_features
-00018400: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-00018410: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-00018420: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00018430: 5820 3a20 746f 7263 682e 5465 6e73 6f72  X : torch.Tensor
-00018440: 206f 6620 7368 6170 6520 2842 2c20 4e2c   of shape (B, N,
-00018450: 2064 290a 2020 2020 2020 2020 2020 2020   d).            
-00018460: 436f 6f72 6469 6e61 7465 732f 6665 6174  Coordinates/feat
-00018470: 7572 6573 2e0a 2020 2020 2020 2020 4e62  ures..        Nb
-00018480: 7273 203a 2074 6f72 6368 2e54 656e 736f  rs : torch.Tenso
-00018490: 7220 6f66 2073 6861 7065 2028 422c 204e  r of shape (B, N
-000184a0: 2c20 4d29 0a20 2020 2020 2020 2020 2020  , M).           
-000184b0: 204e 6569 6768 626f 7220 6c69 7374 2e0a   Neighbor list..
-000184c0: 2020 2020 2020 2020 626f 785f 7369 7a65          box_size
-000184d0: 203a 2074 6f72 6368 2e54 656e 736f 720a   : torch.Tensor.
-000184e0: 2020 2020 2020 2020 2020 2020 4c65 6e67              Leng
-000184f0: 7468 206d 7573 7420 6265 2065 7175 616c  th must be equal
-00018500: 2074 6f20 6064 602e 0a20 2020 2020 2020   to `d`..       
-00018510: 2042 203a 2069 6e74 0a20 2020 2020 2020   B : int.       
-00018520: 2020 2020 2042 6174 6368 2073 697a 650a       Batch size.
-00018530: 2020 2020 2020 2020 4e20 3a20 696e 740a          N : int.
-00018540: 2020 2020 2020 2020 2020 2020 4d61 7869              Maxi
-00018550: 6d75 6d20 6e75 6d62 6572 206f 6620 6174  mum number of at
-00018560: 6f6d 730a 2020 2020 2020 2020 4d20 3a20  oms.        M : 
-00018570: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
-00018580: 4d61 7869 6d75 6d20 6e75 6d62 6572 206f  Maximum number o
-00018590: 6620 6e65 6967 6862 6f72 730a 2020 2020  f neighbors.    
-000185a0: 2020 2020 6420 3a20 696e 740a 2020 2020      d : int.    
-000185b0: 2020 2020 2020 2020 4e75 6d62 6572 206f          Number o
-000185c0: 6620 6665 6174 7572 6573 0a0a 2020 2020  f features..    
-000185d0: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-000185e0: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-000185f0: 2020 2020 746f 7263 682e 5465 6e73 6f72      torch.Tensor
-00018600: 206f 6620 7368 6170 6520 2842 2c20 4e2c   of shape (B, N,
-00018610: 204d 2c20 6429 0a20 2020 2020 2020 2020   M, d).         
-00018620: 2020 2043 6f6f 7264 696e 6174 6573 2f66     Coordinates/f
-00018630: 6561 7475 7265 7320 6469 7374 616e 6365  eatures distance
-00018640: 2074 656e 736f 722e 0a0a 2020 2020 2020   tensor...      
-00018650: 2020 5261 6973 6573 0a20 2020 2020 2020    Raises.       
-00018660: 202d 2d2d 2d2d 2d0a 2020 2020 2020 2020   ------.        
-00018670: 5661 6c75 6545 7272 6f72 0a20 2020 2020  ValueError.     
-00018680: 2020 2020 2020 2057 6865 6e20 7468 6520         When the 
-00018690: 6c65 6e67 7468 206f 6620 6062 6f78 5f73  length of `box_s
-000186a0: 697a 6560 2069 7320 6e6f 7420 6571 7561  ize` is not equa
-000186b0: 6c20 746f 2060 6460 2e0a 2020 2020 2020  l to `d`..      
-000186c0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
-000186d0: 2062 6f78 5f73 697a 6520 6973 206e 6f74   box_size is not
-000186e0: 204e 6f6e 6520 616e 6420 6c65 6e28 626f   None and len(bo
-000186f0: 785f 7369 7a65 2920 213d 2064 3a0a 2020  x_size) != d:.  
-00018700: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00018710: 5661 6c75 6545 7272 6f72 2822 4c65 6e67  ValueError("Leng
-00018720: 7468 206f 6620 6062 6f78 5f73 697a 6560  th of `box_size`
-00018730: 206d 7573 7420 6265 2065 7175 616c 2074   must be equal t
-00018740: 6f20 6064 6022 290a 0a20 2020 2020 2020  o `d`")..       
-00018750: 2066 6c61 745f 6e65 6967 6862 6f72 7320   flat_neighbors 
-00018760: 3d20 746f 7263 682e 7265 7368 6170 6528  = torch.reshape(
-00018770: 4e62 7273 2c20 282d 312c 204e 202a 204d  Nbrs, (-1, N * M
-00018780: 2929 0a20 2020 2020 2020 206e 6569 6768  )).        neigh
-00018790: 626f 725f 636f 6f72 6473 203d 2074 6f72  bor_coords = tor
-000187a0: 6368 2e73 7461 636b 280a 2020 2020 2020  ch.stack(.      
-000187b0: 2020 2020 2020 5b58 5b62 2c20 666c 6174        [X[b, flat
-000187c0: 5f6e 6569 6768 626f 7273 5b62 5d5d 2066  _neighbors[b]] f
-000187d0: 6f72 2062 2069 6e20 7261 6e67 6528 4229  or b in range(B)
-000187e0: 5d29 0a20 2020 2020 2020 206e 6569 6768  ]).        neigh
-000187f0: 626f 725f 636f 6f72 6473 203d 2074 6f72  bor_coords = tor
-00018800: 6368 2e72 6573 6861 7065 286e 6569 6768  ch.reshape(neigh
-00018810: 626f 725f 636f 6f72 6473 2c20 282d 312c  bor_coords, (-1,
-00018820: 204e 2c20 4d2c 2064 2929 0a20 2020 2020   N, M, d)).     
-00018830: 2020 2044 203d 206e 6569 6768 626f 725f     D = neighbor_
-00018840: 636f 6f72 6473 202d 2074 6f72 6368 2e75  coords - torch.u
-00018850: 6e73 7175 6565 7a65 2858 2c20 3229 0a20  nsqueeze(X, 2). 
-00018860: 2020 2020 2020 2069 6620 626f 785f 7369         if box_si
-00018870: 7a65 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ze is not None:.
-00018880: 2020 2020 2020 2020 2020 2020 626f 785f              box_
-00018890: 7369 7a65 203d 2074 6f72 6368 2e72 6573  size = torch.res
-000188a0: 6861 7065 2862 6f78 5f73 697a 652c 2028  hape(box_size, (
-000188b0: 312c 2031 2c20 312c 2064 2929 0a20 2020  1, 1, 1, d)).   
-000188c0: 2020 2020 2020 2020 2044 202d 3d20 746f           D -= to
-000188d0: 7263 682e 726f 756e 6428 4420 2f20 626f  rch.round(D / bo
-000188e0: 785f 7369 7a65 2920 2a20 626f 785f 7369  x_size) * box_si
-000188f0: 7a65 0a0a 2020 2020 2020 2020 7265 7475  ze..        retu
-00018900: 726e 2044 0a0a 2020 2020 6465 6620 6469  rn D..    def di
-00018910: 7374 616e 6365 5f6d 6174 7269 7828 7365  stance_matrix(se
-00018920: 6c66 2c20 443a 2074 6f72 6368 2e54 656e  lf, D: torch.Ten
-00018930: 736f 7229 202d 3e20 746f 7263 682e 5465  sor) -> torch.Te
-00018940: 6e73 6f72 3a0a 2020 2020 2020 2020 2222  nsor:.        ""
-00018950: 2243 616c 6375 6c61 7465 2061 2064 6973  "Calculate a dis
-00018960: 7461 6e63 6520 6d61 7472 6978 2c20 6769  tance matrix, gi
-00018970: 7665 6e20 6120 6469 7374 616e 6365 2074  ven a distance t
-00018980: 656e 736f 722e 0a0a 2020 2020 2020 2020  ensor...        
-00018990: 422c 204e 2c20 4d2c 2064 203d 2062 6174  B, N, M, d = bat
-000189a0: 6368 5f73 697a 652c 206d 6178 5f6e 756d  ch_size, max_num
-000189b0: 5f61 746f 6d73 2c20 6d61 785f 6e75 6d5f  _atoms, max_num_
-000189c0: 6e65 6967 6862 6f72 732c 206e 756d 5f66  neighbors, num_f
-000189d0: 6561 7475 7265 730a 0a20 2020 2020 2020  eatures..       
-000189e0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-000189f0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00018a00: 2020 2020 2020 2044 203a 2074 6f72 6368         D : torch
-00018a10: 2e54 656e 736f 7220 6f66 2073 6861 7065  .Tensor of shape
-00018a20: 2028 422c 204e 2c20 4d2c 2064 290a 2020   (B, N, M, d).  
-00018a30: 2020 2020 2020 2020 2020 4469 7374 616e            Distan
-00018a40: 6365 2074 656e 736f 720a 0a20 2020 2020  ce tensor..     
-00018a50: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
-00018a60: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
-00018a70: 2020 2074 6f72 6368 2e54 656e 736f 7220     torch.Tensor 
-00018a80: 6f66 2073 6861 7065 2028 422c 204e 2c20  of shape (B, N, 
-00018a90: 4d29 0a20 2020 2020 2020 2020 2020 2044  M).            D
-00018aa0: 6973 7461 6e63 6520 6d61 7472 6978 2e0a  istance matrix..
-00018ab0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00018ac0: 2020 2020 7265 7475 726e 2074 6f72 6368      return torch
-00018ad0: 2e73 7172 7428 746f 7263 682e 7375 6d28  .sqrt(torch.sum(
-00018ae0: 746f 7263 682e 6d75 6c28 442c 2044 292c  torch.mul(D, D),
-00018af0: 2033 2929 0a0a 2020 2020 6465 6620 6761   3))..    def ga
-00018b00: 7573 7369 616e 5f64 6973 7461 6e63 655f  ussian_distance_
-00018b10: 6d61 7472 6978 2873 656c 662c 2052 3a20  matrix(self, R: 
-00018b20: 746f 7263 682e 5465 6e73 6f72 2c20 7273  torch.Tensor, rs
-00018b30: 3a20 746f 7263 682e 5465 6e73 6f72 2c0a  : torch.Tensor,.
-00018b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018b60: 2072 653a 2074 6f72 6368 2e54 656e 736f   re: torch.Tenso
-00018b70: 7229 202d 3e20 746f 7263 682e 5465 6e73  r) -> torch.Tens
-00018b80: 6f72 3a0a 2020 2020 2020 2020 2222 2243  or:.        """C
-00018b90: 616c 6375 6c61 7465 2061 2047 6175 7373  alculate a Gauss
-00018ba0: 6961 6e20 6469 7374 616e 6365 206d 6174  ian distance mat
-00018bb0: 7269 782e 0a0a 2020 2020 2020 2020 422c  rix...        B,
-00018bc0: 204e 2c20 4d2c 206c 203d 2062 6174 6368   N, M, l = batch
-00018bd0: 5f73 697a 652c 206d 6178 5f6e 756d 5f61  _size, max_num_a
-00018be0: 746f 6d73 2c20 6d61 785f 6e75 6d5f 6e65  toms, max_num_ne
-00018bf0: 6967 6862 6f72 732c 206c 656e 2872 6164  ighbors, len(rad
-00018c00: 6961 6c5f 7061 7261 6d73 290a 0a20 2020  ial_params)..   
-00018c10: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-00018c20: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00018c30: 2d2d 0a20 2020 2020 2020 2052 203a 2074  --.        R : t
-00018c40: 6f72 6368 2e54 656e 736f 7220 6f66 2073  orch.Tensor of s
-00018c50: 6861 7065 2028 422c 204e 2c20 4d29 0a20  hape (B, N, M). 
-00018c60: 2020 2020 2020 2020 2020 2044 6973 7461             Dista
-00018c70: 6e63 6520 6d61 7472 6978 2e0a 2020 2020  nce matrix..    
-00018c80: 2020 2020 7273 203a 2074 6f72 6368 2e54      rs : torch.T
-00018c90: 656e 736f 7220 6f66 2073 6861 7065 2028  ensor of shape (
-00018ca0: 6c2c 2031 2c20 312c 2031 290a 2020 2020  l, 1, 1, 1).    
-00018cb0: 2020 2020 2020 2020 4761 7573 7369 616e          Gaussian
-00018cc0: 2064 6973 7461 6e63 6520 6d61 7472 6978   distance matrix
-00018cd0: 206d 6561 6e2e 0a20 2020 2020 2020 2072   mean..        r
-00018ce0: 6520 3a20 746f 7263 682e 5465 6e73 6f72  e : torch.Tensor
-00018cf0: 206f 6620 7368 6170 6520 286c 2c20 312c   of shape (l, 1,
-00018d00: 2031 2c20 3129 0a20 2020 2020 2020 2020   1, 1).         
-00018d10: 2020 2047 6175 7373 6961 6e20 6469 7374     Gaussian dist
-00018d20: 616e 6365 206d 6174 7269 7820 7769 6474  ance matrix widt
-00018d30: 682e 0a0a 2020 2020 2020 2020 5265 7475  h...        Retu
-00018d40: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
-00018d50: 2d2d 2d0a 2020 2020 2020 2020 746f 7263  ---.        torc
-00018d60: 682e 5465 6e73 6f72 206f 6620 7368 6170  h.Tensor of shap
-00018d70: 6520 2842 2c20 4e2c 204d 290a 2020 2020  e (B, N, M).    
-00018d80: 2020 2020 2020 2020 4761 7573 7369 616e          Gaussian
-00018d90: 2064 6973 7461 6e63 6520 6d61 7472 6978   distance matrix
-00018da0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00018db0: 2020 2020 2020 7265 7475 726e 2074 6f72        return tor
-00018dc0: 6368 2e65 7870 282d 7265 202a 2028 5220  ch.exp(-re * (R 
-00018dd0: 2d20 7273 292a 2a32 290a 0a20 2020 2064  - rs)**2)..    d
-00018de0: 6566 2072 6164 6961 6c5f 6375 746f 6666  ef radial_cutoff
-00018df0: 2873 656c 662c 2052 3a20 746f 7263 682e  (self, R: torch.
-00018e00: 5465 6e73 6f72 2c20 7263 3a20 746f 7263  Tensor, rc: torc
-00018e10: 682e 5465 6e73 6f72 2920 2d3e 2074 6f72  h.Tensor) -> tor
-00018e20: 6368 2e54 656e 736f 723a 0a20 2020 2020  ch.Tensor:.     
-00018e30: 2020 2022 2222 4361 6c63 756c 6174 6520     """Calculate 
-00018e40: 6120 7261 6469 616c 2063 7574 2d6f 6666  a radial cut-off
-00018e50: 206d 6174 7269 782e 0a0a 2020 2020 2020   matrix...      
-00018e60: 2020 422c 204e 2c20 4d2c 206c 203d 2062    B, N, M, l = b
-00018e70: 6174 6368 5f73 697a 652c 206d 6178 5f6e  atch_size, max_n
-00018e80: 756d 5f61 746f 6d73 2c20 6d61 785f 6e75  um_atoms, max_nu
-00018e90: 6d5f 6e65 6967 6862 6f72 732c 206c 656e  m_neighbors, len
-00018ea0: 2872 6164 6961 6c5f 7061 7261 6d73 290a  (radial_params).
-00018eb0: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-00018ec0: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-00018ed0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2052  ------.        R
-00018ee0: 203a 2074 6f72 6368 2e54 656e 736f 7220   : torch.Tensor 
-00018ef0: 6f66 2073 6861 7065 2028 422c 204e 2c20  of shape (B, N, 
-00018f00: 4d29 0a20 2020 2020 2020 2020 2020 2044  M).            D
-00018f10: 6973 7461 6e63 6520 6d61 7472 6978 2e0a  istance matrix..
-00018f20: 2020 2020 2020 2020 7263 203a 2074 6f72          rc : tor
-00018f30: 6368 2e54 656e 736f 7220 6f66 2073 6861  ch.Tensor of sha
-00018f40: 7065 2028 6c2c 2031 2c20 312c 2031 290a  pe (l, 1, 1, 1).
-00018f50: 2020 2020 2020 2020 2020 2020 496e 7465              Inte
-00018f60: 7261 6374 696f 6e20 6375 746f 6666 2028  raction cutoff (
-00018f70: 696e 2061 6e67 7374 726f 6d29 2e0a 0a20  in angstrom)... 
-00018f80: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
-00018f90: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
-00018fa0: 2020 2020 2020 2074 6f72 6368 2e54 656e         torch.Ten
-00018fb0: 736f 7220 6f66 2073 6861 7065 2028 422c  sor of shape (B,
-00018fc0: 204e 2c20 4d29 0a20 2020 2020 2020 2020   N, M).         
-00018fd0: 2020 2052 6164 6961 6c20 6375 746f 6666     Radial cutoff
-00018fe0: 206d 6174 7269 782e 0a20 2020 2020 2020   matrix..       
-00018ff0: 2022 2222 0a20 2020 2020 2020 2054 203d   """.        T =
-00019000: 2030 2e35 202a 2028 746f 7263 682e 636f   0.5 * (torch.co
-00019010: 7328 6e70 2e70 6920 2a20 5220 2f20 7263  s(np.pi * R / rc
-00019020: 2920 2b20 3129 0a20 2020 2020 2020 2045  ) + 1).        E
-00019030: 203d 2074 6f72 6368 2e7a 6572 6f73 5f6c   = torch.zeros_l
-00019040: 696b 6528 5429 0a20 2020 2020 2020 2063  ike(T).        c
-00019050: 6f6e 6420 3d20 746f 7263 682e 6c65 7373  ond = torch.less
-00019060: 5f65 7175 616c 2852 2c20 7263 290a 2020  _equal(R, rc).  
-00019070: 2020 2020 2020 4643 203d 2074 6f72 6368        FC = torch
-00019080: 2e77 6865 7265 2863 6f6e 642c 2054 2c20  .where(cond, T, 
-00019090: 4529 0a0a 2020 2020 2020 2020 7265 7475  E)..        retu
-000190a0: 726e 2046 430a 0a20 2020 2064 6566 2072  rn FC..    def r
-000190b0: 6164 6961 6c5f 7379 6d6d 6574 7279 5f66  adial_symmetry_f
-000190c0: 756e 6374 696f 6e28 7365 6c66 2c20 523a  unction(self, R:
-000190d0: 2074 6f72 6368 2e54 656e 736f 722c 2072   torch.Tensor, r
-000190e0: 633a 2074 6f72 6368 2e54 656e 736f 722c  c: torch.Tensor,
-000190f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019110: 2020 7273 3a20 746f 7263 682e 5465 6e73    rs: torch.Tens
-00019120: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
-00019130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019140: 2020 2020 2072 653a 2074 6f72 6368 2e54       re: torch.T
-00019150: 656e 736f 7229 202d 3e20 746f 7263 682e  ensor) -> torch.
-00019160: 5465 6e73 6f72 3a0a 2020 2020 2020 2020  Tensor:.        
-00019170: 2222 2243 616c 6375 6c61 7465 2061 2072  """Calculate a r
-00019180: 6164 6961 6c20 7379 6d6d 6574 7279 2066  adial symmetry f
-00019190: 756e 6374 696f 6e2e 0a0a 2020 2020 2020  unction...      
-000191a0: 2020 422c 204e 2c20 4d2c 206c 203d 2062    B, N, M, l = b
-000191b0: 6174 6368 5f73 697a 652c 206d 6178 5f6e  atch_size, max_n
-000191c0: 756d 5f61 746f 6d73 2c20 6d61 785f 6e75  um_atoms, max_nu
-000191d0: 6d5f 6e65 6967 6862 6f72 732c 206c 656e  m_neighbors, len
-000191e0: 2872 6164 6961 6c5f 7061 7261 6d73 290a  (radial_params).
-000191f0: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-00019200: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-00019210: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2052  ------.        R
-00019220: 203a 2074 6f72 6368 2e54 656e 736f 7220   : torch.Tensor 
-00019230: 6f66 2073 6861 7065 2028 422c 204e 2c20  of shape (B, N, 
-00019240: 4d29 0a20 2020 2020 2020 2020 2020 2044  M).            D
-00019250: 6973 7461 6e63 6520 6d61 7472 6978 2e0a  istance matrix..
-00019260: 2020 2020 2020 2020 7263 203a 2074 6f72          rc : tor
-00019270: 6368 2e54 656e 736f 7220 6f66 2073 6861  ch.Tensor of sha
-00019280: 7065 2028 6c2c 2031 2c20 312c 2031 290a  pe (l, 1, 1, 1).
-00019290: 2020 2020 2020 2020 2020 2020 496e 7465              Inte
-000192a0: 7261 6374 696f 6e20 6375 746f 6666 2028  raction cutoff (
-000192b0: 696e 2061 6e67 7374 726f 6d29 2e0a 2020  in angstrom)..  
-000192c0: 2020 2020 2020 7273 203a 2074 6f72 6368        rs : torch
-000192d0: 2e54 656e 736f 7220 6f66 2073 6861 7065  .Tensor of shape
-000192e0: 2028 6c2c 2031 2c20 312c 2031 290a 2020   (l, 1, 1, 1).  
-000192f0: 2020 2020 2020 2020 2020 4761 7573 7369            Gaussi
-00019300: 616e 2064 6973 7461 6e63 6520 6d61 7472  an distance matr
-00019310: 6978 206d 6561 6e2e 0a20 2020 2020 2020  ix mean..       
-00019320: 2072 6520 3a20 746f 7263 682e 5465 6e73   re : torch.Tens
-00019330: 6f72 206f 6620 7368 6170 6520 286c 2c20  or of shape (l, 
-00019340: 312c 2031 2c20 3129 0a20 2020 2020 2020  1, 1, 1).       
-00019350: 2020 2020 2047 6175 7373 6961 6e20 6469       Gaussian di
-00019360: 7374 616e 6365 206d 6174 7269 7820 7769  stance matrix wi
-00019370: 6474 682e 0a20 2020 2020 2020 2052 6574  dth..        Ret
-00019380: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
-00019390: 2d2d 2d2d 0a20 2020 2020 2020 2074 6f72  ----.        tor
-000193a0: 6368 2e54 656e 736f 7220 6f66 2073 6861  ch.Tensor of sha
-000193b0: 7065 2028 422c 204e 2c20 4d29 0a20 2020  pe (B, N, M).   
-000193c0: 2020 2020 2020 2020 2050 7265 2d73 756d           Pre-sum
-000193d0: 6d61 7469 6f6e 2072 6164 6961 6c20 7379  mation radial sy
-000193e0: 6d6d 6574 7279 2066 756e 6374 696f 6e2e  mmetry function.
-000193f0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00019400: 2020 2020 204b 203d 2073 656c 662e 6761       K = self.ga
-00019410: 7573 7369 616e 5f64 6973 7461 6e63 655f  ussian_distance_
-00019420: 6d61 7472 6978 2852 2c20 7273 2c20 7265  matrix(R, rs, re
-00019430: 290a 2020 2020 2020 2020 4643 203d 2073  ).        FC = s
-00019440: 656c 662e 7261 6469 616c 5f63 7574 6f66  elf.radial_cutof
-00019450: 6628 522c 2072 6329 0a0a 2020 2020 2020  f(R, rc)..      
-00019460: 2020 7265 7475 726e 2074 6f72 6368 2e6d    return torch.m
-00019470: 756c 284b 2c20 4643 290a 0a0a 636c 6173  ul(K, FC)...clas
-00019480: 7320 436f 6d62 696e 654d 6561 6e53 7464  s CombineMeanStd
-00019490: 286e 6e2e 4d6f 6475 6c65 293a 0a20 2020  (nn.Module):.   
-000194a0: 2022 2222 4765 6e65 7261 7465 2047 6175   """Generate Gau
-000194b0: 7373 6961 6e20 6e6f 6973 652e 0a0a 2020  ssian noise...  
-000194c0: 2020 5468 6973 2069 7320 7468 6520 546f    This is the To
-000194d0: 7263 6820 6571 7569 7661 6c65 6e74 206f  rch equivalent o
-000194e0: 6620 7468 6520 6f72 6967 696e 616c 2069  f the original i
-000194f0: 6d70 6c65 6d65 6e74 6174 696f 6e20 7573  mplementation us
-00019500: 696e 6720 4b65 7261 732e 0a20 2020 2022  ing Keras..    "
-00019510: 2222 0a0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
-00019520: 6974 5f5f 2873 656c 662c 0a20 2020 2020  it__(self,.     
-00019530: 2020 2020 2020 2020 2020 2020 7472 6169              trai
-00019540: 6e69 6e67 5f6f 6e6c 793a 2062 6f6f 6c20  ning_only: bool 
-00019550: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
-00019560: 2020 2020 2020 2020 2020 6e6f 6973 655f            noise_
-00019570: 6570 7369 6c6f 6e3a 2066 6c6f 6174 203d  epsilon: float =
-00019580: 2031 2e30 2c0a 2020 2020 2020 2020 2020   1.0,.          
-00019590: 2020 2020 2020 202a 2a6b 7761 7267 7329         **kwargs)
-000195a0: 3a0a 2020 2020 2020 2020 2222 2243 7265  :.        """Cre
-000195b0: 6174 6520 6120 436f 6d62 696e 654d 6561  ate a CombineMea
-000195c0: 6e53 7464 206c 6179 6572 2e0a 0a20 2020  nStd layer...   
-000195d0: 2020 2020 2054 6869 7320 6c61 7965 7220       This layer 
-000195e0: 7368 6f75 6c64 2068 6176 6520 7477 6f20  should have two 
-000195f0: 696e 7075 7473 2077 6974 6820 7468 6520  inputs with the 
-00019600: 7361 6d65 2073 6861 7065 2c20 616e 6420  same shape, and 
-00019610: 6974 730a 2020 2020 2020 2020 6f75 7470  its.        outp
-00019620: 7574 2061 6c73 6f20 6861 7320 7468 6520  ut also has the 
-00019630: 7361 6d65 2073 6861 7065 2e20 2045 6163  same shape.  Eac
-00019640: 6820 656c 656d 656e 7420 6f66 2074 6865  h element of the
-00019650: 206f 7574 7075 7420 6973 2061 0a20 2020   output is a.   
-00019660: 2020 2020 2047 6175 7373 6961 6e20 6469       Gaussian di
-00019670: 7374 7269 6275 7465 6420 7261 6e64 6f6d  stributed random
-00019680: 206e 756d 6265 7220 7768 6f73 6520 6d65   number whose me
-00019690: 616e 2069 7320 7468 6520 636f 7272 6573  an is the corres
-000196a0: 706f 6e64 696e 670a 2020 2020 2020 2020  ponding.        
-000196b0: 656c 656d 656e 7420 6f66 2074 6865 2066  element of the f
-000196c0: 6972 7374 2069 6e70 7574 2c20 616e 6420  irst input, and 
-000196d0: 7768 6f73 6520 7374 616e 6461 7264 2064  whose standard d
-000196e0: 6576 6961 7469 6f6e 2069 7320 7468 650a  eviation is the.
-000196f0: 2020 2020 2020 2020 636f 7272 6573 706f          correspo
-00019700: 6e64 696e 6720 656c 656d 656e 7420 6f66  nding element of
-00019710: 2074 6865 2073 6563 6f6e 6420 696e 7075   the second inpu
-00019720: 742e 0a0a 2020 2020 2020 2020 5061 7261  t...        Para
-00019730: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
-00019740: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-00019750: 2020 7472 6169 6e69 6e67 5f6f 6e6c 793a    training_only:
-00019760: 2062 6f6f 6c2c 206f 7074 696f 6e61 6c20   bool, optional 
-00019770: 2864 6566 6175 6c74 2046 616c 7365 292e  (default False).
-00019780: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00019790: 5472 7565 2c20 6e6f 6973 6520 6973 206f  True, noise is o
-000197a0: 6e6c 7920 6765 6e65 7261 7465 6420 6475  nly generated du
-000197b0: 7269 6e67 2074 7261 696e 696e 672e 2020  ring training.  
-000197c0: 4475 7269 6e67 0a20 2020 2020 2020 2020  During.         
-000197d0: 2020 2070 7265 6469 6374 696f 6e2c 2074     prediction, t
-000197e0: 6865 206f 7574 7075 7420 6973 2073 696d  he output is sim
-000197f0: 706c 7920 6571 7561 6c20 746f 2074 6865  ply equal to the
-00019800: 2066 6972 7374 2069 6e70 7574 2028 7468   first input (th
-00019810: 6174 0a20 2020 2020 2020 2020 2020 2069  at.            i
-00019820: 732c 2074 6865 206d 6561 6e20 6f66 2074  s, the mean of t
-00019830: 6865 2064 6973 7472 6962 7574 696f 6e20  he distribution 
-00019840: 7573 6564 2064 7572 696e 6720 7472 6169  used during trai
-00019850: 6e69 6e67 292e 0a20 2020 2020 2020 206e  ning)..        n
-00019860: 6f69 7365 5f65 7073 696c 6f6e 3a20 666c  oise_epsilon: fl
-00019870: 6f61 742c 206f 7074 696f 6e61 6c20 2864  oat, optional (d
-00019880: 6566 6175 6c74 2031 2e30 292e 0a20 2020  efault 1.0)..   
-00019890: 2020 2020 2020 2020 2054 6865 206e 6f69           The noi
-000198a0: 7365 2069 7320 7363 616c 6564 2062 7920  se is scaled by 
-000198b0: 7468 6973 2066 6163 746f 720a 2020 2020  this factor.    
-000198c0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000198d0: 7375 7065 7228 436f 6d62 696e 654d 6561  super(CombineMea
-000198e0: 6e53 7464 2c20 7365 6c66 292e 5f5f 696e  nStd, self).__in
-000198f0: 6974 5f5f 282a 2a6b 7761 7267 7329 0a20  it__(**kwargs). 
-00019900: 2020 2020 2020 2073 656c 662e 7472 6169         self.trai
-00019910: 6e69 6e67 5f6f 6e6c 7920 3d20 7472 6169  ning_only = trai
-00019920: 6e69 6e67 5f6f 6e6c 790a 2020 2020 2020  ning_only.      
-00019930: 2020 7365 6c66 2e6e 6f69 7365 5f65 7073    self.noise_eps
-00019940: 696c 6f6e 203d 206e 6f69 7365 5f65 7073  ilon = noise_eps
-00019950: 696c 6f6e 0a0a 2020 2020 6465 6620 5f5f  ilon..    def __
-00019960: 7265 7072 5f5f 2873 656c 6629 202d 3e20  repr__(self) -> 
-00019970: 7374 723a 0a20 2020 2020 2020 2072 6574  str:.        ret
-00019980: 7572 6e20 280a 2020 2020 2020 2020 2020  urn (.          
-00019990: 2020 6627 7b73 656c 662e 5f5f 636c 6173    f'{self.__clas
-000199a0: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d28 7472  s__.__name__}(tr
-000199b0: 6169 6e69 6e67 5f6f 6e6c 793d 7b73 656c  aining_only={sel
-000199c0: 662e 7472 6169 6e69 6e67 5f6f 6e6c 797d  f.training_only}
-000199d0: 2c20 6e6f 6973 655f 6570 7369 6c6f 6e3d  , noise_epsilon=
-000199e0: 7b73 656c 662e 6e6f 6973 655f 6570 7369  {self.noise_epsi
-000199f0: 6c6f 6e7d 2927 0a20 2020 2020 2020 2029  lon})'.        )
-00019a00: 0a0a 2020 2020 6465 6620 666f 7277 6172  ..    def forwar
-00019a10: 6428 7365 6c66 2c0a 2020 2020 2020 2020  d(self,.        
-00019a20: 2020 2020 2020 2020 696e 7075 7473 3a20          inputs: 
-00019a30: 5365 7175 656e 6365 5b41 7272 6179 4c69  Sequence[ArrayLi
-00019a40: 6b65 5d2c 0a20 2020 2020 2020 2020 2020  ke],.           
-00019a50: 2020 2020 2074 7261 696e 696e 673a 2062       training: b
-00019a60: 6f6f 6c20 3d20 5472 7565 2920 2d3e 2074  ool = True) -> t
-00019a70: 6f72 6368 2e54 656e 736f 723a 0a20 2020  orch.Tensor:.   
-00019a80: 2020 2020 2022 2222 496e 766f 6b65 2074       """Invoke t
-00019a90: 6869 7320 6c61 7965 722e 0a0a 2020 2020  his layer...    
-00019aa0: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-00019ab0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-00019ac0: 2d0a 2020 2020 2020 2020 696e 7075 7473  -.        inputs
-00019ad0: 3a20 5365 7175 656e 6365 5b41 7272 6179  : Sequence[Array
-00019ae0: 4c69 6b65 5d0a 2020 2020 2020 2020 2020  Like].          
-00019af0: 2020 4669 7273 7420 656c 656d 656e 7420    First element 
-00019b00: 6172 6520 7468 6520 6d65 616e 7320 666f  are the means fo
-00019b10: 7220 7468 6520 7261 6e64 6f6d 2067 656e  r the random gen
-00019b20: 6572 6174 6564 206e 756d 6265 7273 2e0a  erated numbers..
-00019b30: 2020 2020 2020 2020 2020 2020 5365 636f              Seco
-00019b40: 6e64 2065 6c65 6d65 6e74 2061 7265 2074  nd element are t
-00019b50: 6865 2073 7461 6e64 6172 6420 6465 7669  he standard devi
-00019b60: 6174 696f 6e73 2066 6f72 2074 6865 2072  ations for the r
-00019b70: 616e 646f 6d20 6765 6e65 7261 7465 6420  andom generated 
-00019b80: 6e75 6d62 6572 732e 0a20 2020 2020 2020  numbers..       
-00019b90: 2074 7261 696e 696e 673a 2062 6f6f 6c2c   training: bool,
-00019ba0: 206f 7074 696f 6e61 6c20 2864 6566 6175   optional (defau
-00019bb0: 6c74 2054 7275 6529 2e0a 2020 2020 2020  lt True)..      
-00019bc0: 2020 2020 2020 5370 6563 6966 6965 7320        Specifies 
-00019bd0: 7768 6574 6865 7220 746f 2067 656e 6572  whether to gener
-00019be0: 6174 6520 6e6f 6973 652e 0a20 2020 2020  ate noise..     
-00019bf0: 2020 2020 2020 204e 6f69 7365 2069 7320         Noise is 
-00019c00: 6f6e 6c79 2061 6464 6564 2077 6865 6e20  only added when 
-00019c10: 7472 6169 6e69 6e67 2e0a 0a20 2020 2020  training...     
-00019c20: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
-00019c30: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
-00019c40: 2020 2054 656e 736f 7220 6f66 2047 6175     Tensor of Gau
-00019c50: 7373 6961 6e20 6469 7374 7269 6275 7465  ssian distribute
-00019c60: 6420 7261 6e64 6f6d 206e 756d 6265 7273  d random numbers
-00019c70: 3a20 746f 7263 682e 5465 6e73 6f72 0a20  : torch.Tensor. 
-00019c80: 2020 2020 2020 2020 2020 2053 616d 6520             Same 
-00019c90: 7368 6170 6520 6173 2074 6865 206d 6561  shape as the mea
-00019ca0: 6e73 2061 6e64 2073 7461 6e64 6172 6420  ns and standard 
-00019cb0: 6465 7669 6174 696f 6e73 2066 726f 6d20  deviations from 
-00019cc0: 6069 6e70 7574 7360 2e0a 2020 2020 2020  `inputs`..      
-00019cd0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
-00019ce0: 206c 656e 2869 6e70 7574 7329 2021 3d20   len(inputs) != 
-00019cf0: 323a 0a20 2020 2020 2020 2020 2020 2072  2:.            r
-00019d00: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00019d10: 224d 7573 7420 6861 7665 2074 776f 2069  "Must have two i
-00019d20: 6e5f 6c61 7965 7273 2229 0a0a 2020 2020  n_layers")..    
-00019d30: 2020 2020 6d65 616e 5f70 6172 656e 742c      mean_parent,
-00019d40: 2073 7464 5f70 6172 656e 7420 3d20 746f   std_parent = to
-00019d50: 7263 682e 7465 6e73 6f72 2869 6e70 7574  rch.tensor(input
-00019d60: 735b 305d 292c 2074 6f72 6368 2e74 656e  s[0]), torch.ten
-00019d70: 736f 7228 0a20 2020 2020 2020 2020 2020  sor(.           
-00019d80: 2069 6e70 7574 735b 315d 290a 2020 2020   inputs[1]).    
-00019d90: 2020 2020 6e6f 6973 655f 7363 616c 6520      noise_scale 
-00019da0: 3d20 746f 7263 682e 7465 6e73 6f72 2874  = torch.tensor(t
-00019db0: 7261 696e 696e 6720 6f72 0a20 2020 2020  raining or.     
-00019dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019dd0: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
-00019de0: 7420 7365 6c66 2e74 7261 696e 696e 675f  t self.training_
-00019df0: 6f6e 6c79 292e 746f 2874 6f72 6368 2e66  only).to(torch.f
-00019e00: 6c6f 6174 290a 2020 2020 2020 2020 7361  loat).        sa
-00019e10: 6d70 6c65 5f6e 6f69 7365 203d 2074 6f72  mple_noise = tor
-00019e20: 6368 2e6e 6f72 6d61 6c28 302e 302c 2073  ch.normal(0.0, s
-00019e30: 656c 662e 6e6f 6973 655f 6570 7369 6c6f  elf.noise_epsilo
-00019e40: 6e2c 206d 6561 6e5f 7061 7265 6e74 2e73  n, mean_parent.s
-00019e50: 6861 7065 290a 2020 2020 2020 2020 7265  hape).        re
-00019e60: 7475 726e 206d 6561 6e5f 7061 7265 6e74  turn mean_parent
-00019e70: 202b 206e 6f69 7365 5f73 6361 6c65 202a   + noise_scale *
-00019e80: 2073 7464 5f70 6172 656e 7420 2a20 7361   std_parent * sa
-00019e90: 6d70 6c65 5f6e 6f69 7365 0a0a 0a63 6c61  mple_noise...cla
-00019ea0: 7373 2047 6174 6564 5265 6375 7272 656e  ss GatedRecurren
-00019eb0: 7455 6e69 7428 6e6e 2e4d 6f64 756c 6529  tUnit(nn.Module)
-00019ec0: 3a0a 2020 2020 2222 2220 5375 626d 6f64  :.    """ Submod
-00019ed0: 756c 6520 666f 7220 4d65 7373 6167 6520  ule for Message 
-00019ee0: 5061 7373 696e 6720 2222 220a 0a20 2020  Passing """..   
-00019ef0: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-00019f00: 6c66 2c20 6e5f 6869 6464 656e 3d31 3030  lf, n_hidden=100
-00019f10: 2c20 696e 6974 3d27 7861 7669 6572 5f75  , init='xavier_u
-00019f20: 6e69 666f 726d 5f27 2c20 2a2a 6b77 6172  niform_', **kwar
-00019f30: 6773 293a 0a20 2020 2020 2020 2073 7570  gs):.        sup
-00019f40: 6572 2847 6174 6564 5265 6375 7272 656e  er(GatedRecurren
-00019f50: 7455 6e69 742c 2073 656c 6629 2e5f 5f69  tUnit, self).__i
-00019f60: 6e69 745f 5f28 2a2a 6b77 6172 6773 290a  nit__(**kwargs).
-00019f70: 2020 2020 2020 2020 7365 6c66 2e6e 5f68          self.n_h
-00019f80: 6964 6465 6e20 3d20 6e5f 6869 6464 656e  idden = n_hidden
-00019f90: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
-00019fa0: 6974 203d 2069 6e69 740a 2020 2020 2020  it = init.      
-00019fb0: 2020 696e 6974 203d 2067 6574 6174 7472    init = getattr
-00019fc0: 2869 6e69 7469 616c 697a 6572 732c 2073  (initializers, s
-00019fd0: 656c 662e 696e 6974 290a 2020 2020 2020  elf.init).      
-00019fe0: 2020 7365 6c66 2e57 7a20 3d20 696e 6974    self.Wz = init
-00019ff0: 2874 6f72 6368 2e65 6d70 7479 286e 5f68  (torch.empty(n_h
-0001a000: 6964 6465 6e2c 206e 5f68 6964 6465 6e29  idden, n_hidden)
-0001a010: 290a 2020 2020 2020 2020 7365 6c66 2e57  ).        self.W
-0001a020: 7220 3d20 696e 6974 2874 6f72 6368 2e65  r = init(torch.e
-0001a030: 6d70 7479 286e 5f68 6964 6465 6e2c 206e  mpty(n_hidden, n
-0001a040: 5f68 6964 6465 6e29 290a 2020 2020 2020  _hidden)).      
-0001a050: 2020 7365 6c66 2e57 6820 3d20 696e 6974    self.Wh = init
-0001a060: 2874 6f72 6368 2e65 6d70 7479 286e 5f68  (torch.empty(n_h
-0001a070: 6964 6465 6e2c 206e 5f68 6964 6465 6e29  idden, n_hidden)
-0001a080: 290a 2020 2020 2020 2020 7365 6c66 2e55  ).        self.U
-0001a090: 7a20 3d20 696e 6974 2874 6f72 6368 2e65  z = init(torch.e
-0001a0a0: 6d70 7479 286e 5f68 6964 6465 6e2c 206e  mpty(n_hidden, n
-0001a0b0: 5f68 6964 6465 6e29 290a 2020 2020 2020  _hidden)).      
-0001a0c0: 2020 7365 6c66 2e55 7220 3d20 696e 6974    self.Ur = init
-0001a0d0: 2874 6f72 6368 2e65 6d70 7479 286e 5f68  (torch.empty(n_h
-0001a0e0: 6964 6465 6e2c 206e 5f68 6964 6465 6e29  idden, n_hidden)
-0001a0f0: 290a 2020 2020 2020 2020 7365 6c66 2e55  ).        self.U
-0001a100: 6820 3d20 696e 6974 2874 6f72 6368 2e65  h = init(torch.e
-0001a110: 6d70 7479 286e 5f68 6964 6465 6e2c 206e  mpty(n_hidden, n
-0001a120: 5f68 6964 6465 6e29 290a 2020 2020 2020  _hidden)).      
-0001a130: 2020 7365 6c66 2e62 7a20 3d20 746f 7263    self.bz = torc
-0001a140: 682e 7a65 726f 7328 286e 5f68 6964 6465  h.zeros((n_hidde
-0001a150: 6e2c 2929 0a20 2020 2020 2020 2073 656c  n,)).        sel
-0001a160: 662e 6272 203d 2074 6f72 6368 2e7a 6572  f.br = torch.zer
-0001a170: 6f73 2828 6e5f 6869 6464 656e 2c29 290a  os((n_hidden,)).
-0001a180: 2020 2020 2020 2020 7365 6c66 2e62 6820          self.bh 
-0001a190: 3d20 746f 7263 682e 7a65 726f 7328 286e  = torch.zeros((n
-0001a1a0: 5f68 6964 6465 6e2c 2929 0a0a 2020 2020  _hidden,))..    
-0001a1b0: 6465 6620 666f 7277 6172 6428 7365 6c66  def forward(self
-0001a1c0: 2c20 696e 7075 7473 293a 0a20 2020 2020  , inputs):.     
-0001a1d0: 2020 2073 6967 6d6f 6964 203d 2067 6574     sigmoid = get
-0001a1e0: 5f61 6374 6976 6174 696f 6e28 2773 6967  _activation('sig
-0001a1f0: 6d6f 6964 2729 0a20 2020 2020 2020 2074  moid').        t
-0001a200: 616e 6820 3d20 6765 745f 6163 7469 7661  anh = get_activa
-0001a210: 7469 6f6e 2827 7461 6e68 2729 0a20 2020  tion('tanh').   
-0001a220: 2020 2020 2068 5f74 6d31 2c20 7820 3d20       h_tm1, x = 
-0001a230: 696e 7075 7473 0a20 2020 2020 2020 207a  inputs.        z
-0001a240: 203d 2073 6967 6d6f 6964 280a 2020 2020   = sigmoid(.    
-0001a250: 2020 2020 2020 2020 746f 7263 682e 6d61          torch.ma
-0001a260: 746d 756c 2878 2c20 7365 6c66 2e57 7a29  tmul(x, self.Wz)
-0001a270: 202b 2074 6f72 6368 2e6d 6174 6d75 6c28   + torch.matmul(
-0001a280: 685f 746d 312c 2073 656c 662e 557a 2920  h_tm1, self.Uz) 
-0001a290: 2b20 7365 6c66 2e62 7a29 0a20 2020 2020  + self.bz).     
-0001a2a0: 2020 2072 203d 2073 6967 6d6f 6964 280a     r = sigmoid(.
-0001a2b0: 2020 2020 2020 2020 2020 2020 746f 7263              torc
-0001a2c0: 682e 6d61 746d 756c 2878 2c20 7365 6c66  h.matmul(x, self
-0001a2d0: 2e57 7229 202b 2074 6f72 6368 2e6d 6174  .Wr) + torch.mat
-0001a2e0: 6d75 6c28 685f 746d 312c 2073 656c 662e  mul(h_tm1, self.
-0001a2f0: 5572 2920 2b20 7365 6c66 2e62 7229 0a20  Ur) + self.br). 
-0001a300: 2020 2020 2020 2068 203d 2028 3120 2d20         h = (1 - 
-0001a310: 7a29 202a 2074 616e 6828 0a20 2020 2020  z) * tanh(.     
-0001a320: 2020 2020 2020 2074 6f72 6368 2e6d 6174         torch.mat
-0001a330: 6d75 6c28 782c 2073 656c 662e 5768 2920  mul(x, self.Wh) 
-0001a340: 2b20 746f 7263 682e 6d61 746d 756c 2868  + torch.matmul(h
-0001a350: 5f74 6d31 202a 2072 2c20 7365 6c66 2e55  _tm1 * r, self.U
-0001a360: 6829 202b 0a20 2020 2020 2020 2020 2020  h) +.           
-0001a370: 2073 656c 662e 6268 2920 2b20 7a20 2a20   self.bh) + z * 
-0001a380: 780a 2020 2020 2020 2020 7265 7475 726e  x.        return
-0001a390: 2068 0a0a 0a63 6c61 7373 2057 6569 6768   h...class Weigh
-0001a3a0: 7465 644c 696e 6561 7243 6f6d 626f 286e  tedLinearCombo(n
-0001a3b0: 6e2e 4d6f 6475 6c65 293a 0a20 2020 2022  n.Module):.    "
-0001a3c0: 2222 436f 6d70 7574 6520 6120 7765 6967  ""Compute a weig
-0001a3d0: 6874 6564 206c 696e 6561 7220 636f 6d62  hted linear comb
-0001a3e0: 696e 6174 696f 6e20 6f66 2069 6e70 7574  ination of input
-0001a3f0: 206c 6179 6572 732c 2077 6865 7265 2074   layers, where t
-0001a400: 6865 2077 6569 6768 7420 7661 7269 6162  he weight variab
-0001a410: 6c65 7320 6172 6520 7472 6169 6e65 642e  les are trained.
-0001a420: 0a0a 2020 2020 4578 616d 706c 6573 0a20  ..    Examples. 
-0001a430: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
-0001a440: 3e3e 3e20 696e 7075 7431 203d 206e 702e  >>> input1 = np.
-0001a450: 7261 6e64 6f6d 2e72 616e 6428 352c 2031  random.rand(5, 1
-0001a460: 3029 2e61 7374 7970 6528 6e70 2e66 6c6f  0).astype(np.flo
-0001a470: 6174 3332 290a 2020 2020 3e3e 3e20 696e  at32).    >>> in
-0001a480: 7075 7432 203d 206e 702e 7261 6e64 6f6d  put2 = np.random
-0001a490: 2e72 616e 6428 352c 2031 3029 2e61 7374  .rand(5, 10).ast
-0001a4a0: 7970 6528 6e70 2e66 6c6f 6174 3332 290a  ype(np.float32).
-0001a4b0: 2020 2020 3e3e 3e20 6c61 7965 7220 3d20      >>> layer = 
-0001a4c0: 5765 6967 6874 6564 4c69 6e65 6172 436f  WeightedLinearCo
-0001a4d0: 6d62 6f28 6c65 6e28 5b69 6e70 7574 312c  mbo(len([input1,
-0001a4e0: 2069 6e70 7574 325d 2929 0a20 2020 203e   input2])).    >
-0001a4f0: 3e3e 2072 6573 756c 7420 3d20 6c61 7965  >> result = laye
-0001a500: 7228 5b69 6e70 7574 312c 2069 6e70 7574  r([input1, input
-0001a510: 325d 290a 2020 2020 3e3e 3e20 7265 7375  2]).    >>> resu
-0001a520: 6c74 2e73 6861 7065 0a20 2020 2074 6f72  lt.shape.    tor
-0001a530: 6368 2e53 697a 6528 5b35 2c20 3130 5d29  ch.Size([5, 10])
-0001a540: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
-0001a550: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-0001a560: 206e 756d 5f69 6e70 7574 733a 2069 6e74   num_inputs: int
-0001a570: 2c20 7374 643a 2066 6c6f 6174 203d 2030  , std: float = 0
-0001a580: 2e33 2c20 2a2a 6b77 6172 6773 293a 0a20  .3, **kwargs):. 
-0001a590: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-0001a5a0: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-0001a5b0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-0001a5c0: 2d0a 2020 2020 2020 2020 6e75 6d5f 696e  -.        num_in
-0001a5d0: 7075 7473 3a20 696e 740a 2020 2020 2020  puts: int.      
-0001a5e0: 2020 2020 2020 4e75 6d62 6572 206f 6620        Number of 
-0001a5f0: 696e 7075 7473 2067 6976 656e 2074 6f20  inputs given to 
-0001a600: 6073 656c 662e 666f 7277 6172 6428 2960  `self.forward()`
-0001a610: 0a20 2020 2020 2020 2020 2020 2054 6869  .            Thi
-0001a620: 7320 6973 2075 7365 6420 746f 2069 6e69  s is used to ini
-0001a630: 7469 616c 697a 6520 7468 6520 636f 7272  tialize the corr
-0001a640: 6563 7420 616d 6f75 6e74 206f 6620 7765  ect amount of we
-0001a650: 6967 6874 2076 6172 6961 626c 6573 2074  ight variables t
-0001a660: 6f20 6265 2074 7261 696e 6564 2e0a 2020  o be trained..  
-0001a670: 2020 2020 2020 7374 643a 2066 6c6f 6174        std: float
-0001a680: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
-0001a690: 2073 7461 6e64 6172 6420 6465 7669 6174   standard deviat
-0001a6a0: 696f 6e20 666f 7220 7468 6520 6e6f 726d  ion for the norm
-0001a6b0: 616c 2064 6973 7472 6962 7574 696f 6e20  al distribution 
-0001a6c0: 7468 6174 2069 7320 7573 6564 2074 6f20  that is used to 
-0001a6d0: 696e 6974 6961 6c69 7a65 2074 6865 2074  initialize the t
-0001a6e0: 7261 696e 6162 6c65 2077 6569 6768 7473  rainable weights
-0001a6f0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-0001a700: 2020 2020 2020 7375 7065 7228 5765 6967        super(Weig
-0001a710: 6874 6564 4c69 6e65 6172 436f 6d62 6f2c  htedLinearCombo,
-0001a720: 2073 656c 6629 2e5f 5f69 6e69 745f 5f28   self).__init__(
-0001a730: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
-0001a740: 2020 7365 6c66 2e6e 756d 5f69 6e70 7574    self.num_input
-0001a750: 7320 3d20 6e75 6d5f 696e 7075 7473 0a20  s = num_inputs. 
-0001a760: 2020 2020 2020 2073 656c 662e 7374 6420         self.std 
-0001a770: 3d20 7374 640a 2020 2020 2020 2020 7365  = std.        se
-0001a780: 6c66 2e69 6e70 7574 5f77 6569 6768 7473  lf.input_weights
-0001a790: 203d 206e 6e2e 5061 7261 6d65 7465 7228   = nn.Parameter(
-0001a7a0: 746f 7263 682e 656d 7074 7928 7365 6c66  torch.empty(self
-0001a7b0: 2e6e 756d 5f69 6e70 7574 7329 290a 2020  .num_inputs)).  
-0001a7c0: 2020 2020 2020 6e6e 2e69 6e69 742e 6e6f        nn.init.no
-0001a7d0: 726d 616c 5f28 7365 6c66 2e69 6e70 7574  rmal_(self.input
-0001a7e0: 5f77 6569 6768 7473 2c20 7374 643d 7374  _weights, std=st
-0001a7f0: 6429 0a0a 2020 2020 6465 6620 5f5f 7265  d)..    def __re
-0001a800: 7072 5f5f 2873 656c 6629 3a0a 2020 2020  pr__(self):.    
-0001a810: 2020 2020 7265 7475 726e 2028 0a20 2020      return (.   
-0001a820: 2020 2020 2020 2020 2066 277b 7365 6c66           f'{self
-0001a830: 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  .__class__.__nam
-0001a840: 655f 5f7d 286e 756d 5f69 6e70 7574 733d  e__}(num_inputs=
-0001a850: 7b73 656c 662e 6e75 6d5f 696e 7075 7473  {self.num_inputs
-0001a860: 7d2c 2073 7464 3d7b 7365 6c66 2e73 7464  }, std={self.std
-0001a870: 7d2c 2069 6e70 7574 5f77 6569 6768 7473  }, input_weights
-0001a880: 3d7b 7365 6c66 2e69 6e70 7574 5f77 6569  ={self.input_wei
-0001a890: 6768 7473 7d29 270a 2020 2020 2020 2020  ghts})'.        
-0001a8a0: 290a 0a20 2020 2064 6566 2066 6f72 7761  )..    def forwa
-0001a8b0: 7264 280a 2020 2020 2020 2020 7365 6c66  rd(.        self
-0001a8c0: 2c20 696e 7075 7473 3a20 5365 7175 656e  , inputs: Sequen
-0001a8d0: 6365 5b55 6e69 6f6e 5b41 7272 6179 4c69  ce[Union[ArrayLi
-0001a8e0: 6b65 2c0a 2020 2020 2020 2020 2020 2020  ke,.            
-0001a8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a900: 2020 2020 2020 2020 2074 6f72 6368 2e54           torch.T
-0001a910: 656e 736f 725d 5d29 202d 3e20 4f70 7469  ensor]]) -> Opti
-0001a920: 6f6e 616c 5b74 6f72 6368 2e54 656e 736f  onal[torch.Tenso
-0001a930: 725d 3a0a 2020 2020 2020 2020 2222 220a  r]:.        """.
-0001a940: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-0001a950: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-0001a960: 2d2d 2d2d 2d0a 2020 2020 2020 2020 696e  -----.        in
-0001a970: 7075 7473 3a20 5365 7175 656e 6365 5b55  puts: Sequence[U
-0001a980: 6e69 6f6e 5b41 7272 6179 4c69 6b65 2c20  nion[ArrayLike, 
-0001a990: 746f 7263 682e 5465 6e73 6f72 5d5d 0a20  torch.Tensor]]. 
-0001a9a0: 2020 2020 2020 2020 2020 2054 6865 2069             The i
-0001a9b0: 6e69 7469 616c 2069 6e70 7574 206c 6179  nitial input lay
-0001a9c0: 6572 732e 0a20 2020 2020 2020 2020 2020  ers..           
-0001a9d0: 2054 6865 206c 656e 6774 6820 6d75 7374   The length must
-0001a9e0: 2062 6520 7468 6520 7361 6d65 2061 7320   be the same as 
-0001a9f0: 6073 656c 662e 6e75 6d5f 696e 7075 7473  `self.num_inputs
-0001aa00: 602e 0a0a 2020 2020 2020 2020 5265 7475  `...        Retu
-0001aa10: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
-0001aa20: 2d2d 2d0a 2020 2020 2020 2020 6f75 745f  ---.        out_
-0001aa30: 7465 6e73 6f72 3a20 746f 7263 682e 5465  tensor: torch.Te
-0001aa40: 6e73 6f72 206f 7220 4e6f 6e65 0a20 2020  nsor or None.   
-0001aa50: 2020 2020 2020 2020 2054 6865 2074 656e           The ten
-0001aa60: 736f 7220 636f 6e74 6169 6e69 6e67 2074  sor containing t
-0001aa70: 6865 2077 6569 6768 7465 6420 6c69 6e65  he weighted line
-0001aa80: 6172 2063 6f6d 6269 6e61 7469 6f6e 2e0a  ar combination..
-0001aa90: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001aaa0: 2020 2020 6f75 745f 7465 6e73 6f72 203d      out_tensor =
-0001aab0: 204e 6f6e 650a 2020 2020 2020 2020 666f   None.        fo
-0001aac0: 7220 696e 5f74 656e 736f 722c 2077 2069  r in_tensor, w i
-0001aad0: 6e20 7a69 7028 696e 7075 7473 2c20 7365  n zip(inputs, se
-0001aae0: 6c66 2e69 6e70 7574 5f77 6569 6768 7473  lf.input_weights
-0001aaf0: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-0001ab00: 6e5f 7465 6e73 6f72 203d 2074 6f72 6368  n_tensor = torch
-0001ab10: 2e46 6c6f 6174 5465 6e73 6f72 2869 6e5f  .FloatTensor(in_
-0001ab20: 7465 6e73 6f72 290a 2020 2020 2020 2020  tensor).        
-0001ab30: 2020 2020 6966 206f 7574 5f74 656e 736f      if out_tenso
-0001ab40: 7220 6973 204e 6f6e 653a 0a20 2020 2020  r is None:.     
-0001ab50: 2020 2020 2020 2020 2020 206f 7574 5f74             out_t
-0001ab60: 656e 736f 7220 3d20 7720 2a20 696e 5f74  ensor = w * in_t
-0001ab70: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
-0001ab80: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001ab90: 2020 2020 2020 2020 6f75 745f 7465 6e73          out_tens
-0001aba0: 6f72 202b 3d20 7720 2a20 696e 5f74 656e  or += w * in_ten
-0001abb0: 736f 720a 2020 2020 2020 2020 7265 7475  sor.        retu
-0001abc0: 726e 206f 7574 5f74 656e 736f 720a       rn out_tensor.
+0000c670: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+0000c680: 6c6f 6261 6c5f 6665 6174 7572 6573 2c20  lobal_features, 
+0000c690: 6261 7463 6829 0a20 2020 2020 2020 2067  batch).        g
+0000c6a0: 6c6f 6261 6c5f 6665 6174 7572 6573 203d  lobal_features =
+0000c6b0: 2073 656c 662e 5f75 7064 6174 655f 676c   self._update_gl
+0000c6c0: 6f62 616c 5f66 6561 7475 7265 7328 6e6f  obal_features(no
+0000c6d0: 6465 5f66 6561 7475 7265 732c 0a20 2020  de_features,.   
+0000c6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c710: 2020 2020 6564 6765 5f66 6561 7475 7265      edge_feature
+0000c720: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+0000c730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c750: 2020 2020 2020 2020 2020 676c 6f62 616c            global
+0000c760: 5f66 6561 7475 7265 732c 2062 6174 6368  _features, batch
+0000c770: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000c780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c7a0: 2020 2020 2020 2020 2065 6467 655f 6261           edge_ba
+0000c7b0: 7463 685f 6d61 7029 0a0a 2020 2020 2020  tch_map)..      
+0000c7c0: 2020 6966 2073 656c 662e 6973 5f75 6e64    if self.is_und
+0000c7d0: 6972 6563 7465 6420 6973 2054 7275 653a  irected is True:
+0000c7e0: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
+0000c7f0: 6f6f 6e76 6572 7469 6e67 2065 6467 6520  oonverting edge 
+0000c800: 6665 6174 7572 6573 2074 6f20 6974 7320  features to its 
+0000c810: 6f72 6967 696e 616c 2073 6861 7065 0a20  original shape. 
+0000c820: 2020 2020 2020 2020 2020 2073 706c 6974             split
+0000c830: 203d 2074 6f72 6368 2e73 706c 6974 2865   = torch.split(e
+0000c840: 6467 655f 6665 6174 7572 6573 2c0a 2020  dge_features,.  
+0000c850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c860: 2020 2020 2020 2020 2020 2020 2020 5b65                [e
+0000c870: 6467 655f 6665 6174 7572 6573 5f6c 656e  dge_features_len
+0000c880: 2c20 6564 6765 5f66 6561 7475 7265 735f  , edge_features_
+0000c890: 6c65 6e5d 290a 2020 2020 2020 2020 2020  len]).          
+0000c8a0: 2020 6564 6765 5f66 6561 7475 7265 7320    edge_features 
+0000c8b0: 3d20 2873 706c 6974 5b30 5d20 2b20 7370  = (split[0] + sp
+0000c8c0: 6c69 745b 315d 2920 2f20 320a 0a20 2020  lit[1]) / 2..   
+0000c8d0: 2020 2020 2069 6620 7365 6c66 2e72 6573       if self.res
+0000c8e0: 6964 7561 6c5f 636f 6e6e 6563 7469 6f6e  idual_connection
+0000c8f0: 3a0a 2020 2020 2020 2020 2020 2020 6564  :.            ed
+0000c900: 6765 5f66 6561 7475 7265 7320 2b3d 2065  ge_features += e
+0000c910: 6467 655f 6665 6174 7572 6573 5f63 6f70  dge_features_cop
+0000c920: 790a 2020 2020 2020 2020 2020 2020 6e6f  y.            no
+0000c930: 6465 5f66 6561 7475 7265 7320 2b3d 206e  de_features += n
+0000c940: 6f64 655f 6665 6174 7572 6573 5f63 6f70  ode_features_cop
+0000c950: 790a 2020 2020 2020 2020 2020 2020 676c  y.            gl
+0000c960: 6f62 616c 5f66 6561 7475 7265 7320 2b3d  obal_features +=
+0000c970: 2067 6c6f 6261 6c5f 6665 6174 7572 6573   global_features
+0000c980: 5f63 6f70 790a 0a20 2020 2020 2020 2072  _copy..        r
+0000c990: 6574 7572 6e20 6e6f 6465 5f66 6561 7475  eturn node_featu
+0000c9a0: 7265 732c 2065 6467 655f 6665 6174 7572  res, edge_featur
+0000c9b0: 6573 2c20 676c 6f62 616c 5f66 6561 7475  es, global_featu
+0000c9c0: 7265 730a 0a20 2020 2064 6566 205f 5f72  res..    def __r
+0000c9d0: 6570 725f 5f28 7365 6c66 2920 2d3e 2073  epr__(self) -> s
+0000c9e0: 7472 3a0a 2020 2020 2020 2020 7265 7475  tr:.        retu
+0000c9f0: 726e 2028 0a20 2020 2020 2020 2020 2020  rn (.           
+0000ca00: 2066 277b 7365 6c66 2e5f 5f63 6c61 7373   f'{self.__class
+0000ca10: 5f5f 2e5f 5f6e 616d 655f 5f7d 286e 5f6e  __.__name__}(n_n
+0000ca20: 6f64 655f 6665 6174 7572 6573 3d7b 7365  ode_features={se
+0000ca30: 6c66 2e6e 5f6e 6f64 655f 6665 6174 7572  lf.n_node_featur
+0000ca40: 6573 7d2c 206e 5f65 6467 655f 6665 6174  es}, n_edge_feat
+0000ca50: 7572 6573 3d7b 7365 6c66 2e6e 5f65 6467  ures={self.n_edg
+0000ca60: 655f 6665 6174 7572 6573 7d2c 206e 5f67  e_features}, n_g
+0000ca70: 6c6f 6261 6c5f 6665 6174 7572 6573 3d7b  lobal_features={
+0000ca80: 7365 6c66 2e6e 5f67 6c6f 6261 6c5f 6665  self.n_global_fe
+0000ca90: 6174 7572 6573 7d2c 2069 735f 756e 6469  atures}, is_undi
+0000caa0: 7265 6374 6564 3d7b 7365 6c66 2e69 735f  rected={self.is_
+0000cab0: 756e 6469 7265 6374 6564 7d2c 2072 6573  undirected}, res
+0000cac0: 6964 7561 6c5f 636f 6e6e 6563 7469 6f6e  idual_connection
+0000cad0: 3d7b 7365 6c66 2e72 6573 6964 7561 6c5f  ={self.residual_
+0000cae0: 636f 6e6e 6563 7469 6f6e 7d29 270a 2020  connection})'.  
+0000caf0: 2020 2020 2020 290a 0a0a 636c 6173 7320        )...class 
+0000cb00: 4166 6669 6e65 286e 6e2e 4d6f 6475 6c65  Affine(nn.Module
+0000cb10: 293a 0a20 2020 2022 2222 436c 6173 7320  ):.    """Class 
+0000cb20: 7768 6963 6820 7065 7266 6f72 6d73 2074  which performs t
+0000cb30: 6865 2041 6666 696e 6520 7472 616e 7366  he Affine transf
+0000cb40: 6f72 6d61 7469 6f6e 2e0a 0a20 2020 2054  ormation...    T
+0000cb50: 6869 7320 7472 616e 7366 6f72 6d61 7469  his transformati
+0000cb60: 6f6e 2069 7320 6261 7365 6420 6f6e 2074  on is based on t
+0000cb70: 6865 2061 6666 696e 6974 7920 6f66 2074  he affinity of t
+0000cb80: 6865 2062 6173 6520 6469 7374 7269 6275  he base distribu
+0000cb90: 7469 6f6e 2077 6974 680a 2020 2020 7468  tion with.    th
+0000cba0: 6520 7461 7267 6574 2064 6973 7472 6962  e target distrib
+0000cbb0: 7574 696f 6e2e 2041 2067 656f 6d65 7472  ution. A geometr
+0000cbc0: 6963 2074 7261 6e73 666f 726d 6174 696f  ic transformatio
+0000cbd0: 6e20 6973 2061 7070 6c69 6564 2077 6865  n is applied whe
+0000cbe0: 7265 0a20 2020 2074 6865 2070 6172 616d  re.    the param
+0000cbf0: 6574 6572 7320 7065 7266 6f72 6d73 2063  eters performs c
+0000cc00: 6861 6e67 6573 206f 6e20 7468 6520 7363  hanges on the sc
+0000cc10: 616c 6520 616e 6420 7368 6966 7420 6f66  ale and shift of
+0000cc20: 2061 2066 756e 6374 696f 6e0a 2020 2020   a function.    
+0000cc30: 2869 6e70 7574 7329 2e0a 0a20 2020 204e  (inputs)...    N
+0000cc40: 6f72 6d61 6c69 7a69 6e67 2046 6c6f 7720  ormalizing Flow 
+0000cc50: 7472 616e 7366 6f72 6d61 7469 6f6e 7320  transformations 
+0000cc60: 6d75 7374 2062 6520 6269 6a65 6374 6976  must be bijectiv
+0000cc70: 6520 696e 206f 7264 6572 2074 6f20 636f  e in order to co
+0000cc80: 6d70 7574 650a 2020 2020 7468 6520 6c6f  mpute.    the lo
+0000cc90: 6761 7269 7468 6d20 6f66 206a 6163 6f62  garithm of jacob
+0000cca0: 6961 6e27 7320 6465 7465 726d 696e 616e  ian's determinan
+0000ccb0: 742e 2046 6f72 2074 6869 7320 7265 6173  t. For this reas
+0000ccc0: 6f6e 2c20 7472 616e 7366 6f72 6d61 7469  on, transformati
+0000ccd0: 6f6e 730a 2020 2020 6d75 7374 2070 6572  ons.    must per
+0000cce0: 666f 726d 2061 2066 6f72 7761 7264 2061  form a forward a
+0000ccf0: 6e64 2069 6e76 6572 7365 2070 6173 732e  nd inverse pass.
+0000cd00: 0a0a 2020 2020 4578 616d 706c 650a 2020  ..    Example.  
+0000cd10: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e    --------.    >
+0000cd20: 3e3e 2069 6d70 6f72 7420 6465 6570 6368  >> import deepch
+0000cd30: 656d 2061 7320 6463 0a20 2020 203e 3e3e  em as dc.    >>>
+0000cd40: 2066 726f 6d20 6465 6570 6368 656d 2e6d   from deepchem.m
+0000cd50: 6f64 656c 732e 746f 7263 685f 6d6f 6465  odels.torch_mode
+0000cd60: 6c73 2e6c 6179 6572 7320 696d 706f 7274  ls.layers import
+0000cd70: 2041 6666 696e 650a 2020 2020 3e3e 3e20   Affine.    >>> 
+0000cd80: 696d 706f 7274 2074 6f72 6368 0a20 2020  import torch.   
+0000cd90: 203e 3e3e 2066 726f 6d20 746f 7263 682e   >>> from torch.
+0000cda0: 6469 7374 7269 6275 7469 6f6e 7320 696d  distributions im
+0000cdb0: 706f 7274 204d 756c 7469 7661 7269 6174  port Multivariat
+0000cdc0: 654e 6f72 6d61 6c0a 2020 2020 3e3e 3e20  eNormal.    >>> 
+0000cdd0: 2320 696e 6974 6961 6c69 7a65 2074 6865  # initialize the
+0000cde0: 2074 7261 6e73 666f 726d 6174 696f 6e20   transformation 
+0000cdf0: 6c61 7965 7227 7320 7061 7261 6d65 7465  layer's paramete
+0000ce00: 7273 0a20 2020 203e 3e3e 2064 696d 203d  rs.    >>> dim =
+0000ce10: 2032 0a20 2020 203e 3e3e 2073 616d 706c   2.    >>> sampl
+0000ce20: 6573 203d 2039 360a 2020 2020 3e3e 3e20  es = 96.    >>> 
+0000ce30: 7472 616e 7366 6f72 6d73 203d 2041 6666  transforms = Aff
+0000ce40: 696e 6528 6469 6d29 0a20 2020 203e 3e3e  ine(dim).    >>>
+0000ce50: 2023 2066 6f72 7761 7264 2070 6173 7320   # forward pass 
+0000ce60: 6261 7365 6420 6f6e 2061 2067 6976 656e  based on a given
+0000ce70: 2064 6973 7472 6962 7574 696f 6e0a 2020   distribution.  
+0000ce80: 2020 3e3e 3e20 6469 7374 7269 6275 7469    >>> distributi
+0000ce90: 6f6e 203d 204d 756c 7469 7661 7269 6174  on = Multivariat
+0000cea0: 654e 6f72 6d61 6c28 746f 7263 682e 7a65  eNormal(torch.ze
+0000ceb0: 726f 7328 6469 6d29 2c20 746f 7263 682e  ros(dim), torch.
+0000cec0: 6579 6528 6469 6d29 290a 2020 2020 3e3e  eye(dim)).    >>
+0000ced0: 3e20 696e 7075 7420 3d20 6469 7374 7269  > input = distri
+0000cee0: 6275 7469 6f6e 2e73 616d 706c 6528 746f  bution.sample(to
+0000cef0: 7263 682e 5369 7a65 2828 7361 6d70 6c65  rch.Size((sample
+0000cf00: 732c 2064 696d 2929 290a 2020 2020 3e3e  s, dim))).    >>
+0000cf10: 3e20 6c65 6e28 7472 616e 7366 6f72 6d73  > len(transforms
+0000cf20: 2e66 6f72 7761 7264 2869 6e70 7574 2929  .forward(input))
+0000cf30: 0a20 2020 2032 0a20 2020 203e 3e3e 2023  .    2.    >>> #
+0000cf40: 2069 6e76 6572 7365 2070 6173 7320 6261   inverse pass ba
+0000cf50: 7365 6420 6f6e 2061 2064 6973 7472 6962  sed on a distrib
+0000cf60: 7574 696f 6e0a 2020 2020 3e3e 3e20 6c65  ution.    >>> le
+0000cf70: 6e28 7472 616e 7366 6f72 6d73 2e69 6e76  n(transforms.inv
+0000cf80: 6572 7365 2869 6e70 7574 2929 0a20 2020  erse(input)).   
+0000cf90: 2032 0a0a 2020 2020 2222 220a 0a20 2020   2..    """..   
+0000cfa0: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+0000cfb0: 6c66 2c20 6469 6d3a 2069 6e74 2920 2d3e  lf, dim: int) ->
+0000cfc0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+0000cfd0: 2222 4372 6561 7465 2061 2041 6666 696e  ""Create a Affin
+0000cfe0: 6520 7472 616e 7366 6f72 6d20 6c61 7965  e transform laye
+0000cff0: 722e 0a0a 2020 2020 2020 2020 5061 7261  r...        Para
+0000d000: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
+0000d010: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+0000d020: 2020 6469 6d3a 2069 6e74 0a20 2020 2020    dim: int.     
+0000d030: 2020 2020 2020 2056 616c 7565 206f 6620         Value of 
+0000d040: 7468 6520 4e74 6820 6469 6d65 6e73 696f  the Nth dimensio
+0000d050: 6e20 6f66 2074 6865 2064 6174 6173 6574  n of the dataset
+0000d060: 2e0a 0a20 2020 2020 2020 2022 2222 0a0a  ...        """..
+0000d070: 2020 2020 2020 2020 7375 7065 7228 292e          super().
+0000d080: 5f5f 696e 6974 5f5f 2829 0a20 2020 2020  __init__().     
+0000d090: 2020 2073 656c 662e 6469 6d20 3d20 6469     self.dim = di
+0000d0a0: 6d0a 2020 2020 2020 2020 7365 6c66 2e73  m.        self.s
+0000d0b0: 6361 6c65 203d 206e 6e2e 5061 7261 6d65  cale = nn.Parame
+0000d0c0: 7465 7228 746f 7263 682e 7a65 726f 7328  ter(torch.zeros(
+0000d0d0: 7365 6c66 2e64 696d 2929 0a20 2020 2020  self.dim)).     
+0000d0e0: 2020 2073 656c 662e 7368 6966 7420 3d20     self.shift = 
+0000d0f0: 6e6e 2e50 6172 616d 6574 6572 2874 6f72  nn.Parameter(tor
+0000d100: 6368 2e7a 6572 6f73 2873 656c 662e 6469  ch.zeros(self.di
+0000d110: 6d29 290a 0a20 2020 2064 6566 2066 6f72  m))..    def for
+0000d120: 7761 7264 2873 656c 662c 2078 3a20 5365  ward(self, x: Se
+0000d130: 7175 656e 6365 2920 2d3e 2054 7570 6c65  quence) -> Tuple
+0000d140: 5b74 6f72 6368 2e54 656e 736f 722c 2074  [torch.Tensor, t
+0000d150: 6f72 6368 2e54 656e 736f 725d 3a0a 2020  orch.Tensor]:.  
+0000d160: 2020 2020 2020 2222 2250 6572 666f 726d        """Perform
+0000d170: 7320 6120 7472 616e 7366 6f72 6d61 7469  s a transformati
+0000d180: 6f6e 2062 6574 7765 656e 2074 776f 2064  on between two d
+0000d190: 6966 6665 7265 6e74 2064 6973 7472 6962  ifferent distrib
+0000d1a0: 7574 696f 6e73 2e20 5468 6973 0a20 2020  utions. This.   
+0000d1b0: 2020 2020 2070 6172 7469 6375 6c61 7220       particular 
+0000d1c0: 7472 616e 7366 6f72 6d61 7469 6f6e 2072  transformation r
+0000d1d0: 6570 7265 7365 6e74 7320 7468 6520 666f  epresents the fo
+0000d1e0: 6c6c 6f77 696e 6720 6675 6e63 7469 6f6e  llowing function
+0000d1f0: 3a0a 2020 2020 2020 2020 7920 3d20 7820  :.        y = x 
+0000d200: 2a20 6578 7028 6129 202b 2062 2c20 7768  * exp(a) + b, wh
+0000d210: 6572 6520 6120 6973 2073 6361 6c65 2070  ere a is scale p
+0000d220: 6172 616d 6574 6572 2061 6e64 2062 2070  arameter and b p
+0000d230: 6572 666f 726d 7320 6120 7368 6966 742e  erforms a shift.
+0000d240: 0a20 2020 2020 2020 2054 6869 7320 636c  .        This cl
+0000d250: 6173 7320 616c 736f 2072 6574 7572 6e73  ass also returns
+0000d260: 2074 6865 206c 6f67 6172 6974 686d 206f   the logarithm o
+0000d270: 6620 7468 6520 6a61 636f 6269 616e 7320  f the jacobians 
+0000d280: 6465 7465 726d 696e 616e 740a 2020 2020  determinant.    
+0000d290: 2020 2020 7768 6963 6820 6973 2075 7365      which is use
+0000d2a0: 6675 6c20 7768 656e 2069 6e76 6572 7420  ful when invert 
+0000d2b0: 6120 7472 616e 7366 6f72 6d61 7469 6f6e  a transformation
+0000d2c0: 2061 6e64 2063 6f6d 7075 7465 2074 6865   and compute the
+0000d2d0: 0a20 2020 2020 2020 2070 726f 6261 6269  .        probabi
+0000d2e0: 6c69 7479 206f 6620 7468 6520 7472 616e  lity of the tran
+0000d2f0: 7366 6f72 6d61 7469 6f6e 2e0a 0a20 2020  sformation...   
+0000d300: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+0000d310: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+0000d320: 2d2d 0a20 2020 2020 2020 2078 203a 2053  --.        x : S
+0000d330: 6571 7565 6e63 650a 2020 2020 2020 2020  equence.        
+0000d340: 2020 2020 5465 6e73 6f72 2073 616d 706c      Tensor sampl
+0000d350: 6520 7769 7468 2074 6865 2069 6e69 7469  e with the initi
+0000d360: 616c 2064 6973 7472 6962 7574 696f 6e20  al distribution 
+0000d370: 6461 7461 2077 6869 6368 2077 696c 6c20  data which will 
+0000d380: 7061 7373 2069 6e74 6f0a 2020 2020 2020  pass into.      
+0000d390: 2020 2020 2020 7468 6520 6e6f 726d 616c        the normal
+0000d3a0: 697a 696e 6720 666c 6f77 2061 6c67 6f72  izing flow algor
+0000d3b0: 6974 686d 2e0a 0a20 2020 2020 2020 2052  ithm...        R
+0000d3c0: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
+0000d3d0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2079  ------.        y
+0000d3e0: 203a 2074 6f72 6368 2e54 656e 736f 720a   : torch.Tensor.
+0000d3f0: 2020 2020 2020 2020 2020 2020 5472 616e              Tran
+0000d400: 7366 6f72 6d65 6420 7465 6e73 6f72 2061  sformed tensor a
+0000d410: 6363 6f72 6469 6e67 2074 6f20 4166 6669  ccording to Affi
+0000d420: 6e65 206c 6179 6572 2077 6974 6820 7468  ne layer with th
+0000d430: 6520 7368 6170 6520 6f66 2027 7827 2e0a  e shape of 'x'..
+0000d440: 2020 2020 2020 2020 6c6f 675f 6465 745f          log_det_
+0000d450: 6a61 636f 6269 616e 203a 2074 6f72 6368  jacobian : torch
+0000d460: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
+0000d470: 2020 2020 5465 6e73 6f72 2077 6869 6368      Tensor which
+0000d480: 2072 6570 7265 7365 6e74 7320 7468 6520   represents the 
+0000d490: 696e 666f 2061 626f 7574 2074 6865 2064  info about the d
+0000d4a0: 6576 6961 7469 6f6e 206f 6620 7468 6520  eviation of the 
+0000d4b0: 696e 6974 6961 6c0a 2020 2020 2020 2020  initial.        
+0000d4c0: 2020 2020 616e 6420 7461 7267 6574 2064      and target d
+0000d4d0: 6973 7472 6962 7574 696f 6e2e 0a0a 2020  istribution...  
+0000d4e0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+0000d4f0: 2020 2079 203d 2074 6f72 6368 2e65 7870     y = torch.exp
+0000d500: 2873 656c 662e 7363 616c 6529 202a 2078  (self.scale) * x
+0000d510: 202b 2073 656c 662e 7368 6966 740a 2020   + self.shift.  
+0000d520: 2020 2020 2020 6465 745f 6a61 636f 6269        det_jacobi
+0000d530: 616e 203d 2074 6f72 6368 2e65 7870 2873  an = torch.exp(s
+0000d540: 656c 662e 7363 616c 652e 7375 6d28 2929  elf.scale.sum())
+0000d550: 0a20 2020 2020 2020 206c 6f67 5f64 6574  .        log_det
+0000d560: 5f6a 6163 6f62 6961 6e20 3d20 746f 7263  _jacobian = torc
+0000d570: 682e 6f6e 6573 2879 2e73 6861 7065 5b30  h.ones(y.shape[0
+0000d580: 5d29 202a 2074 6f72 6368 2e6c 6f67 2864  ]) * torch.log(d
+0000d590: 6574 5f6a 6163 6f62 6961 6e29 0a0a 2020  et_jacobian)..  
+0000d5a0: 2020 2020 2020 7265 7475 726e 2079 2c20        return y, 
+0000d5b0: 6c6f 675f 6465 745f 6a61 636f 6269 616e  log_det_jacobian
+0000d5c0: 0a0a 2020 2020 6465 6620 696e 7665 7273  ..    def invers
+0000d5d0: 6528 7365 6c66 2c20 793a 2053 6571 7565  e(self, y: Seque
+0000d5e0: 6e63 6529 202d 3e20 5475 706c 655b 746f  nce) -> Tuple[to
+0000d5f0: 7263 682e 5465 6e73 6f72 2c20 746f 7263  rch.Tensor, torc
+0000d600: 682e 5465 6e73 6f72 5d3a 0a20 2020 2020  h.Tensor]:.     
+0000d610: 2020 2022 2222 5065 7266 6f72 6d73 2061     """Performs a
+0000d620: 2074 7261 6e73 666f 726d 6174 696f 6e20   transformation 
+0000d630: 6265 7477 6565 6e20 7477 6f20 6469 6666  between two diff
+0000d640: 6572 656e 7420 6469 7374 7269 6275 7469  erent distributi
+0000d650: 6f6e 732e 0a20 2020 2020 2020 2054 6869  ons..        Thi
+0000d660: 7320 7472 616e 7366 6f72 6d61 7469 6f6e  s transformation
+0000d670: 2072 6570 7265 7365 6e74 7320 7468 6520   represents the 
+0000d680: 6261 6377 6172 6420 7061 7373 206f 6620  bacward pass of 
+0000d690: 7468 6520 6675 6e63 7469 6f6e 0a20 2020  the function.   
+0000d6a0: 2020 2020 206d 656e 7469 6f6e 2062 6566       mention bef
+0000d6b0: 6f72 652e 2049 7473 206d 6174 6865 6d61  ore. Its mathema
+0000d6c0: 7469 6361 6c20 7265 7072 6573 656e 7461  tical representa
+0000d6d0: 7469 6f6e 2069 7320 7820 3d20 2879 202d  tion is x = (y -
+0000d6e0: 2062 2920 2f20 6578 7028 6129 0a20 2020   b) / exp(a).   
+0000d6f0: 2020 2020 202c 2077 6865 7265 2022 6122       , where "a"
+0000d700: 2069 7320 7363 616c 6520 7061 7261 6d65   is scale parame
+0000d710: 7465 7220 616e 6420 2262 2220 7065 7266  ter and "b" perf
+0000d720: 6f72 6d73 2061 2073 6869 6674 2e20 5468  orms a shift. Th
+0000d730: 6973 2063 6c61 7373 0a20 2020 2020 2020  is class.       
+0000d740: 2061 6c73 6f20 7265 7475 726e 7320 7468   also returns th
+0000d750: 6520 6c6f 6761 7269 7468 6d20 6f66 2074  e logarithm of t
+0000d760: 6865 206a 6163 6f62 6961 6e73 2064 6574  he jacobians det
+0000d770: 6572 6d69 6e61 6e74 2077 6869 6368 2069  erminant which i
+0000d780: 730a 2020 2020 2020 2020 7573 6566 756c  s.        useful
+0000d790: 2077 6865 6e20 696e 7665 7274 2061 2074   when invert a t
+0000d7a0: 7261 6e73 666f 726d 6174 696f 6e20 616e  ransformation an
+0000d7b0: 6420 636f 6d70 7574 6520 7468 6520 7072  d compute the pr
+0000d7c0: 6f62 6162 696c 6974 7920 6f66 0a20 2020  obability of.   
+0000d7d0: 2020 2020 2074 6865 2074 7261 6e73 666f       the transfo
+0000d7e0: 726d 6174 696f 6e2e 0a0a 2020 2020 2020  rmation...      
+0000d7f0: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+0000d800: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+0000d810: 2020 2020 2020 2020 7920 3a20 5365 7175          y : Sequ
+0000d820: 656e 6365 0a20 2020 2020 2020 2020 2020  ence.           
+0000d830: 2054 656e 736f 7220 7361 6d70 6c65 2077   Tensor sample w
+0000d840: 6974 6820 7472 616e 7366 6f72 6d65 6420  ith transformed 
+0000d850: 6469 7374 7269 6275 7469 6f6e 2064 6174  distribution dat
+0000d860: 6120 7768 6963 6820 7769 6c6c 2062 6520  a which will be 
+0000d870: 7573 6564 2069 6e0a 2020 2020 2020 2020  used in.        
+0000d880: 2020 2020 7468 6520 6e6f 726d 616c 697a      the normaliz
+0000d890: 696e 6720 616c 676f 7269 7468 6d20 696e  ing algorithm in
+0000d8a0: 7665 7273 6520 7061 7373 2e0a 0a20 2020  verse pass...   
+0000d8b0: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
+0000d8c0: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
+0000d8d0: 2020 2020 2078 203a 2074 6f72 6368 2e54       x : torch.T
+0000d8e0: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
+0000d8f0: 2020 5472 616e 7366 6f72 6d65 6420 7465    Transformed te
+0000d900: 6e73 6f72 2061 6363 6f72 6469 6e67 2074  nsor according t
+0000d910: 6f20 4166 6669 6e65 206c 6179 6572 2077  o Affine layer w
+0000d920: 6974 6820 7468 6520 7368 6170 6520 6f66  ith the shape of
+0000d930: 2027 7927 2e0a 2020 2020 2020 2020 696e   'y'..        in
+0000d940: 7665 7273 655f 6c6f 675f 6465 745f 6a61  verse_log_det_ja
+0000d950: 636f 6269 616e 203a 2074 6f72 6368 2e54  cobian : torch.T
+0000d960: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
+0000d970: 2020 5465 6e73 6f72 2077 6869 6368 2072    Tensor which r
+0000d980: 6570 7265 7365 6e74 7320 7468 6520 696e  epresents the in
+0000d990: 666f 726d 6174 696f 6e20 6f66 2074 6865  formation of the
+0000d9a0: 2064 6576 6961 7469 6f6e 206f 6620 7468   deviation of th
+0000d9b0: 6520 696e 6974 6961 6c0a 2020 2020 2020  e initial.      
+0000d9c0: 2020 2020 2020 616e 6420 7461 7267 6574        and target
+0000d9d0: 2064 6973 7472 6962 7574 696f 6e2e 0a0a   distribution...
+0000d9e0: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+0000d9f0: 2020 2020 2078 203d 2028 7920 2d20 7365       x = (y - se
+0000da00: 6c66 2e73 6869 6674 2920 2f20 746f 7263  lf.shift) / torc
+0000da10: 682e 6578 7028 7365 6c66 2e73 6361 6c65  h.exp(self.scale
+0000da20: 290a 2020 2020 2020 2020 6465 745f 6a61  ).        det_ja
+0000da30: 636f 6269 616e 203d 2031 202f 2074 6f72  cobian = 1 / tor
+0000da40: 6368 2e65 7870 2873 656c 662e 7363 616c  ch.exp(self.scal
+0000da50: 652e 7375 6d28 2929 0a20 2020 2020 2020  e.sum()).       
+0000da60: 2069 6e76 6572 7365 5f6c 6f67 5f64 6574   inverse_log_det
+0000da70: 5f6a 6163 6f62 6961 6e20 3d20 746f 7263  _jacobian = torc
+0000da80: 682e 6f6e 6573 280a 2020 2020 2020 2020  h.ones(.        
+0000da90: 2020 2020 782e 7368 6170 655b 305d 2920      x.shape[0]) 
+0000daa0: 2a20 746f 7263 682e 6c6f 6728 6465 745f  * torch.log(det_
+0000dab0: 6a61 636f 6269 616e 290a 0a20 2020 2020  jacobian)..     
+0000dac0: 2020 2072 6574 7572 6e20 782c 2069 6e76     return x, inv
+0000dad0: 6572 7365 5f6c 6f67 5f64 6574 5f6a 6163  erse_log_det_jac
+0000dae0: 6f62 6961 6e0a 0a0a 636c 6173 7320 444d  obian...class DM
+0000daf0: 504e 4e45 6e63 6f64 6572 4c61 7965 7228  PNNEncoderLayer(
+0000db00: 6e6e 2e4d 6f64 756c 6529 3a0a 2020 2020  nn.Module):.    
+0000db10: 2222 220a 2020 2020 456e 636f 6465 7220  """.    Encoder 
+0000db20: 6c61 7965 7220 666f 7220 7573 6520 696e  layer for use in
+0000db30: 2074 6865 2044 6972 6563 7465 6420 4d65   the Directed Me
+0000db40: 7373 6167 6520 5061 7373 696e 6720 4e65  ssage Passing Ne
+0000db50: 7572 616c 204e 6574 776f 726b 2028 442d  ural Network (D-
+0000db60: 4d50 4e4e 2920 5b31 5d5f 2e0a 0a20 2020  MPNN) [1]_...   
+0000db70: 2054 6865 2072 6f6c 6520 6f66 2074 6865   The role of the
+0000db80: 2044 4d50 4e4e 456e 636f 6465 724c 6179   DMPNNEncoderLay
+0000db90: 6572 2063 6c61 7373 2069 7320 746f 2067  er class is to g
+0000dba0: 656e 6572 6174 6520 6d6f 6c65 6375 6c65  enerate molecule
+0000dbb0: 2065 6e63 6f64 696e 6773 2069 6e20 666f   encodings in fo
+0000dbc0: 6c6c 6f77 696e 6720 7374 6570 733a 0a0a  llowing steps:..
+0000dbd0: 2020 2020 2d20 4d65 7373 6167 6520 7061      - Message pa
+0000dbe0: 7373 696e 6720 7068 6173 650a 2020 2020  ssing phase.    
+0000dbf0: 2d20 4765 7420 6e65 7720 6174 6f6d 2068  - Get new atom h
+0000dc00: 6964 6465 6e20 7374 6174 6573 2061 6e64  idden states and
+0000dc10: 2072 6561 646f 7574 2070 6861 7365 0a20   readout phase. 
+0000dc20: 2020 202d 2043 6f6e 6361 7465 6e61 7465     - Concatenate
+0000dc30: 2074 6865 2067 6c6f 6261 6c20 6665 6174   the global feat
+0000dc40: 7572 6573 0a0a 0a20 2020 204c 6574 2074  ures...    Let t
+0000dc50: 6865 2064 6961 6772 616d 2067 6976 656e  he diagram given
+0000dc60: 2062 656c 6f77 2072 6570 7265 7365 6e74   below represent
+0000dc70: 2061 206d 6f6c 6563 756c 6520 636f 6e74   a molecule cont
+0000dc80: 6169 6e69 6e67 2035 2061 746f 6d73 2028  aining 5 atoms (
+0000dc90: 6e6f 6465 7329 2061 6e64 2034 2062 6f6e  nodes) and 4 bon
+0000dca0: 6473 2028 6564 6765 7329 3a2d 0a0a 2020  ds (edges):-..  
+0000dcb0: 2020 7c20 2020 3120 2d2d 2d20 350a 2020    |   1 --- 5.  
+0000dcc0: 2020 7c20 2020 7c0a 2020 2020 7c20 2020    |   |.    |   
+0000dcd0: 3220 2d2d 2d20 340a 2020 2020 7c20 2020  2 --- 4.    |   
+0000dce0: 7c0a 2020 2020 7c20 2020 330a 0a20 2020  |.    |   3..   
+0000dcf0: 204c 6574 2074 6865 2062 6f6e 6473 2066   Let the bonds f
+0000dd00: 726f 6d20 6174 6f6d 7320 312d 3e32 2028  rom atoms 1->2 (
+0000dd10: 2a2a 425b 3132 5d2a 2a29 2061 6e64 2032  **B[12]**) and 2
+0000dd20: 2d3e 3120 282a 2a42 5b32 315d 2a2a 2920  ->1 (**B[21]**) 
+0000dd30: 6265 2063 6f6e 7369 6465 7265 6420 6173  be considered as
+0000dd40: 2032 2064 6966 6665 7265 6e74 2062 6f6e   2 different bon
+0000dd50: 6473 2e0a 2020 2020 4865 6e63 652c 2062  ds..    Hence, b
+0000dd60: 7920 636f 6e73 6964 6572 696e 6720 7468  y considering th
+0000dd70: 6520 7361 6d65 2066 6f72 2061 6c6c 2061  e same for all a
+0000dd80: 746f 6d73 2c20 7468 6520 746f 7461 6c20  toms, the total 
+0000dd90: 6e75 6d62 6572 206f 6620 626f 6e64 7320  number of bonds 
+0000dda0: 3d20 382e 0a0a 2020 2020 4c65 743a 0a0a  = 8...    Let:..
+0000ddb0: 2020 2020 2d20 2a2a 6174 6f6d 2066 6561      - **atom fea
+0000ddc0: 7475 7265 732a 2a20 3a20 6060 6131 2c20  tures** : ``a1, 
+0000ddd0: 6132 2c20 6133 2c20 6134 2c20 6135 6060  a2, a3, a4, a5``
+0000dde0: 0a20 2020 202d 202a 2a68 6964 6465 6e20  .    - **hidden 
+0000ddf0: 7374 6174 6573 206f 6620 6174 6f6d 732a  states of atoms*
+0000de00: 2a20 3a20 6060 6831 2c20 6832 2c20 6833  * : ``h1, h2, h3
+0000de10: 2c20 6834 2c20 6835 6060 0a20 2020 202d  , h4, h5``.    -
+0000de20: 202a 2a62 6f6e 6420 6665 6174 7572 6573   **bond features
+0000de30: 2062 6f6e 6473 2a2a 203a 2060 6062 3132   bonds** : ``b12
+0000de40: 2c20 6232 312c 2062 3233 2c20 6233 322c  , b21, b23, b32,
+0000de50: 2062 3234 2c20 6234 322c 2062 3135 2c20   b24, b42, b15, 
+0000de60: 6235 3160 600a 2020 2020 2d20 2a2a 696e  b51``.    - **in
+0000de70: 6974 6961 6c20 6869 6464 656e 2073 7461  itial hidden sta
+0000de80: 7465 7320 6f66 2062 6f6e 6473 2a2a 203a  tes of bonds** :
+0000de90: 2060 6028 3029 6831 322c 2028 3029 6832   ``(0)h12, (0)h2
+0000dea0: 312c 2028 3029 6832 332c 2028 3029 6833  1, (0)h23, (0)h3
+0000deb0: 322c 2028 3029 6832 342c 2028 3029 6834  2, (0)h24, (0)h4
+0000dec0: 322c 2028 3029 6831 352c 2028 3029 6835  2, (0)h15, (0)h5
+0000ded0: 3160 600a 0a20 2020 2054 6865 2068 6964  1``..    The hid
+0000dee0: 6465 6e20 7374 6174 6520 6f66 2065 7665  den state of eve
+0000def0: 7279 2062 6f6e 6420 6973 2061 2066 756e  ry bond is a fun
+0000df00: 6374 696f 6e20 6f66 2074 6865 2063 6f6e  ction of the con
+0000df10: 6361 7465 6e61 7465 6420 6665 6174 7572  catenated featur
+0000df20: 6520 7665 6374 6f72 2077 6869 6368 2063  e vector which c
+0000df30: 6f6e 7461 696e 730a 2020 2020 636f 6e63  ontains.    conc
+0000df40: 6174 656e 6174 696f 6e20 6f66 2074 6865  atenation of the
+0000df50: 202a 2a66 6561 7475 7265 7320 6f66 2069   **features of i
+0000df60: 6e69 7469 616c 2061 746f 6d20 6f66 2074  nitial atom of t
+0000df70: 6865 2062 6f6e 642a 2a20 616e 6420 2a2a  he bond** and **
+0000df80: 626f 6e64 2066 6561 7475 7265 732a 2a2e  bond features**.
+0000df90: 0a0a 2020 2020 4578 616d 706c 653a 2060  ..    Example: `
+0000dfa0: 6028 3029 6832 3120 3d20 6675 6e63 3128  `(0)h21 = func1(
+0000dfb0: 636f 6e63 6174 2861 322c 2062 3231 2929  concat(a2, b21))
+0000dfc0: 6060 0a0a 2020 2020 2e2e 206e 6f74 653a  ``..    .. note:
+0000dfd0: 3a0a 2020 2020 2048 6572 6520 6675 6e63  :.     Here func
+0000dfe0: 3120 6973 2060 6073 656c 662e 575f 6960  1 is ``self.W_i`
+0000dff0: 600a 0a20 2020 202a 2a54 6865 204d 6573  `..    **The Mes
+0000e000: 7361 6765 2070 6173 7369 6e67 2070 6861  sage passing pha
+0000e010: 7365 2a2a 0a0a 2020 2020 5468 6520 676f  se**..    The go
+0000e020: 616c 206f 6620 7468 6520 6d65 7373 6167  al of the messag
+0000e030: 652d 7061 7373 696e 6720 7068 6173 6520  e-passing phase 
+0000e040: 6973 2074 6f20 6765 6e65 7261 7465 202a  is to generate *
+0000e050: 2a68 6964 6465 6e20 7374 6174 6573 206f  *hidden states o
+0000e060: 6620 616c 6c20 7468 6520 6174 6f6d 7320  f all the atoms 
+0000e070: 696e 2074 6865 206d 6f6c 6563 756c 652a  in the molecule*
+0000e080: 2a2e 0a0a 2020 2020 5468 6520 6869 6464  *...    The hidd
+0000e090: 656e 2073 7461 7465 206f 6620 616e 2061  en state of an a
+0000e0a0: 746f 6d20 6973 202a 2a61 2066 756e 6374  tom is **a funct
+0000e0b0: 696f 6e20 6f66 2063 6f6e 6361 7465 6e61  ion of concatena
+0000e0c0: 7469 6f6e 206f 6620 6174 6f6d 2066 6561  tion of atom fea
+0000e0d0: 7475 7265 7320 616e 6420 6d65 7373 6167  tures and messag
+0000e0e0: 6573 2028 6174 2054 2064 6570 7468 292a  es (at T depth)*
+0000e0f0: 2a2e 0a0a 2020 2020 4120 6d65 7373 6167  *...    A messag
+0000e100: 6520 6973 2061 2073 756d 206f 6620 2a2a  e is a sum of **
+0000e110: 6869 6464 656e 2073 7461 7465 7320 6f66  hidden states of
+0000e120: 2062 6f6e 6473 2063 6f6d 696e 6720 746f   bonds coming to
+0000e130: 2074 6865 2061 746f 6d20 2861 7420 5420   the atom (at T 
+0000e140: 6465 7074 6829 2a2a 2e0a 0a20 2020 202e  depth)**...    .
+0000e150: 2e20 6e6f 7465 3a3a 0a20 2020 2020 4465  . note::.     De
+0000e160: 7074 6820 7265 6665 7273 2074 6f20 7468  pth refers to th
+0000e170: 6520 6e75 6d62 6572 206f 6620 6974 6572  e number of iter
+0000e180: 6174 696f 6e73 2069 6e20 7468 6520 6d65  ations in the me
+0000e190: 7373 6167 6520 7061 7373 696e 6720 7068  ssage passing ph
+0000e1a0: 6173 6520 2868 6572 652c 2054 2069 7465  ase (here, T ite
+0000e1b0: 7261 7469 6f6e 7329 2e20 4166 7465 7220  rations). After 
+0000e1c0: 6561 6368 2069 7465 7261 7469 6f6e 2c20  each iteration, 
+0000e1d0: 7468 6520 6869 6464 656e 2073 7461 7465  the hidden state
+0000e1e0: 7320 6f66 2074 6865 2062 6f6e 6473 2061  s of the bonds a
+0000e1f0: 7265 2075 7064 6174 6564 2e0a 0a0a 2020  re updated....  
+0000e200: 2020 4578 616d 706c 653a 0a20 2020 2060    Example:.    `
+0000e210: 6068 3120 3d20 6675 6e63 3328 636f 6e63  `h1 = func3(conc
+0000e220: 6174 2861 312c 206d 3129 2960 600a 0a20  at(a1, m1))``.. 
+0000e230: 2020 202e 2e20 6e6f 7465 3a3a 0a20 2020     .. note::.   
+0000e240: 2020 4865 7265 2066 756e 6333 2069 7320    Here func3 is 
+0000e250: 6060 7365 6c66 2e57 5f6f 6060 2e0a 0a20  ``self.W_o``... 
+0000e260: 2020 2020 606d 3160 2072 6566 6572 7320      `m1` refers 
+0000e270: 746f 2074 6865 206d 6573 7361 6765 2063  to the message c
+0000e280: 6f6d 696e 6720 746f 2074 6865 2061 746f  oming to the ato
+0000e290: 6d2e 0a0a 2020 2020 6060 6d31 203d 2028  m...    ``m1 = (
+0000e2a0: 542d 3129 6832 3120 2b20 2854 2d31 2968  T-1)h21 + (T-1)h
+0000e2b0: 3531 6060 0a20 2020 2028 6869 6464 656e  51``.    (hidden
+0000e2c0: 2073 7461 7465 206f 6620 626f 6e64 2032   state of bond 2
+0000e2d0: 2d3e 3120 2b20 6869 6464 656e 2073 7461  ->1 + hidden sta
+0000e2e0: 7465 206f 6620 626f 6e64 2035 2d3e 3129  te of bond 5->1)
+0000e2f0: 2028 6174 2054 2064 6570 7468 290a 0a20   (at T depth).. 
+0000e300: 2020 2066 6f72 2c20 6465 7074 6820 5420     for, depth T 
+0000e310: 3d20 323a 0a0a 2020 2020 2d20 7468 6520  = 2:..    - the 
+0000e320: 6869 6464 656e 2073 7461 7465 7320 6f66  hidden states of
+0000e330: 2074 6865 2062 6f6e 6473 2040 2031 7374   the bonds @ 1st
+0000e340: 2069 7465 7261 7469 6f6e 2077 696c 6c20   iteration will 
+0000e350: 6265 203d 3e20 2830 2968 3231 2c20 2830  be => (0)h21, (0
+0000e360: 2968 3531 0a20 2020 202d 2074 6865 2068  )h51.    - the h
+0000e370: 6964 6465 6e20 7374 6174 6573 206f 6620  idden states of 
+0000e380: 7468 6520 626f 6e64 7320 4020 326e 6420  the bonds @ 2nd 
+0000e390: 6974 6572 6174 696f 6e20 7769 6c6c 2062  iteration will b
+0000e3a0: 6520 3d3e 2028 3129 6832 312c 2028 3129  e => (1)h21, (1)
+0000e3b0: 6835 310a 0a20 2020 2054 6865 2068 6964  h51..    The hid
+0000e3c0: 6465 6e20 7374 6174 6573 206f 6620 7468  den states of th
+0000e3d0: 6520 626f 6e64 7320 696e 2031 7374 2069  e bonds in 1st i
+0000e3e0: 7465 7261 7469 6f6e 2061 7265 2061 6c72  teration are alr
+0000e3f0: 6561 6479 206b 6e6f 772e 0a20 2020 2046  eady know..    F
+0000e400: 6f72 2068 6964 6465 6e20 7374 6174 6573  or hidden states
+0000e410: 206f 6620 7468 6520 626f 6e64 7320 696e   of the bonds in
+0000e420: 2032 6e64 2069 7465 7261 7469 6f6e 2c20   2nd iteration, 
+0000e430: 7765 2066 6f6c 6c6f 7720 7468 6520 6372  we follow the cr
+0000e440: 6974 6572 696f 6e20 7468 6174 3a0a 0a20  iterion that:.. 
+0000e450: 2020 202d 2068 6964 6465 6e20 7374 6174     - hidden stat
+0000e460: 6520 6f66 2074 6865 2062 6f6e 6420 6973  e of the bond is
+0000e470: 2061 2066 756e 6374 696f 6e20 6f66 202a   a function of *
+0000e480: 2a69 6e69 7469 616c 2068 6964 6465 6e20  *initial hidden 
+0000e490: 7374 6174 6520 6f66 2062 6f6e 642a 2a0a  state of bond**.
+0000e4a0: 2020 2020 616e 6420 2a2a 6d65 7373 6167      and **messag
+0000e4b0: 6573 2063 6f6d 696e 6720 746f 2074 6861  es coming to tha
+0000e4c0: 7420 626f 6e64 2069 6e20 7468 6174 2069  t bond in that i
+0000e4d0: 7465 7261 7469 6f6e 2a2a 0a0a 2020 2020  teration**..    
+0000e4e0: 4578 616d 706c 653a 0a20 2020 2060 6028  Example:.    ``(
+0000e4f0: 3129 6832 3120 3d20 6675 6e63 3228 2028  1)h21 = func2( (
+0000e500: 3029 6832 3120 2c20 2831 296d 3231 2029  0)h21 , (1)m21 )
+0000e510: 6060 0a0a 2020 2020 2e2e 206e 6f74 653a  ``..    .. note:
+0000e520: 3a0a 2020 2020 2048 6572 6520 6675 6e63  :.     Here func
+0000e530: 3220 6973 2060 6073 656c 662e 575f 6860  2 is ``self.W_h`
+0000e540: 602e 0a0a 2020 2020 2060 2831 296d 3231  `...     `(1)m21
+0000e550: 6020 7265 6665 7273 2074 6f20 7468 6520  ` refers to the 
+0000e560: 6d65 7373 6167 6573 2063 6f6d 696e 6720  messages coming 
+0000e570: 746f 2074 6861 7420 626f 6e64 2032 2d3e  to that bond 2->
+0000e580: 3120 696e 2074 6861 7420 326e 6420 6974  1 in that 2nd it
+0000e590: 6572 6174 696f 6e2e 0a0a 2020 2020 4d65  eration...    Me
+0000e5a0: 7373 6167 6573 2063 6f6d 696e 6720 746f  ssages coming to
+0000e5b0: 2061 2062 6f6e 6420 696e 2061 6e20 6974   a bond in an it
+0000e5c0: 6572 6174 696f 6e20 6973 202a 2a61 2073  eration is **a s
+0000e5d0: 756d 206f 6620 6869 6464 656e 2073 7461  um of hidden sta
+0000e5e0: 7465 7320 6f66 2062 6f6e 6473 2028 6672  tes of bonds (fr
+0000e5f0: 6f6d 2070 7265 7669 6f75 7320 6974 6572  om previous iter
+0000e600: 6174 696f 6e29 2063 6f6d 696e 6720 746f  ation) coming to
+0000e610: 2074 6869 7320 626f 6e64 2a2a 2e0a 0a20   this bond**... 
+0000e620: 2020 2045 7861 6d70 6c65 3a0a 2020 2020     Example:.    
+0000e630: 6060 2831 296d 3231 203d 2028 3029 6833  ``(1)m21 = (0)h3
+0000e640: 3220 2b20 2830 2968 3432 6060 0a0a 2020  2 + (0)h42``..  
+0000e650: 2020 7c20 2020 3220 3c2d 2d2d 2033 0a20    |   2 <--- 3. 
+0000e660: 2020 207c 2020 205e 0a20 2020 207c 2020     |   ^.    |  
+0000e670: 207c 0a20 2020 207c 2020 2034 0a0a 2020   |.    |   4..  
+0000e680: 2020 2a2a 436f 6d70 7574 696e 6720 7468    **Computing th
+0000e690: 6520 6d65 7373 6167 6573 2a2a 0a0a 2020  e messages**..  
+0000e6a0: 2020 2e2e 2063 6f64 652d 626c 6f63 6b3a    .. code-block:
+0000e6b0: 3a20 7079 7468 6f6e 0a0a 2020 2020 2020  : python..      
+0000e6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6d0: 2020 2020 2020 2042 3020 2020 2020 2042         B0      B
+0000e6e0: 3120 2020 2020 2042 3220 2020 2020 2042  1      B2      B
+0000e6f0: 3320 2020 2020 2042 3420 2020 2020 2042  3      B4      B
+0000e700: 3520 2020 2020 2042 3620 2020 2020 2042  5      B6      B
+0000e710: 3720 2020 2020 2042 380a 2020 2020 2020  7      B8.      
+0000e720: 2020 665f 696e 695f 6174 6f6d 735f 626f    f_ini_atoms_bo
+0000e730: 6e64 7320 3d20 5b28 3029 6831 322c 2028  nds = [(0)h12, (
+0000e740: 3029 6832 312c 2028 3029 6832 332c 2028  0)h21, (0)h23, (
+0000e750: 3029 6833 322c 2028 3029 6832 342c 2028  0)h32, (0)h24, (
+0000e760: 3029 6834 322c 2028 3029 6831 352c 2028  0)h42, (0)h15, (
+0000e770: 3029 6835 312c 2068 282d 3129 5d0a 0a0a  0)h51, h(-1)]...
+0000e780: 2020 2020 2e2e 206e 6f74 653a 3a0a 2020      .. note::.  
+0000e790: 2020 2068 282d 3129 2069 7320 616e 2065     h(-1) is an e
+0000e7a0: 6d70 7479 2061 7272 6179 206f 6620 7468  mpty array of th
+0000e7b0: 6520 7361 6d65 2073 697a 6520 6173 206f  e same size as o
+0000e7c0: 7468 6572 2068 6964 6465 6e20 7374 6174  ther hidden stat
+0000e7d0: 6573 206f 6620 626f 6e64 2073 7461 7465  es of bond state
+0000e7e0: 732e 0a0a 2020 2020 2e2e 2063 6f64 652d  s...    .. code-
+0000e7f0: 626c 6f63 6b3a 3a20 7079 7468 6f6e 0a0a  block:: python..
+0000e800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e810: 2020 2020 4230 2020 2020 2020 4231 2020      B0      B1  
+0000e820: 2020 2020 4232 2020 2020 2020 4233 2020      B2      B3  
+0000e830: 2020 2020 4234 2020 2020 2020 4235 2020      B4      B5  
+0000e840: 2020 2020 4236 2020 2020 2020 4237 2020      B6      B7  
+0000e850: 2020 2020 2042 380a 2020 2020 2020 2020       B8.        
+0000e860: 6d61 7070 696e 6720 3d20 5b20 5b2d 312c  mapping = [ [-1,
+0000e870: 4237 5d20 5b42 332c 4235 5d20 5b42 302c  B7] [B3,B5] [B0,
+0000e880: 4235 5d20 5b2d 312c 2d31 5d20 5b42 302c  B5] [-1,-1] [B0,
+0000e890: 4233 5d20 5b2d 312c 2d31 5d20 5b42 312c  B3] [-1,-1] [B1,
+0000e8a0: 2d31 5d20 5b2d 312c 2d31 5d20 205b 2d31  -1] [-1,-1]  [-1
+0000e8b0: 2c2d 315d 205d 0a0a 2020 2020 4c61 7465  ,-1] ]..    Late
+0000e8c0: 722c 2074 6865 2065 6e63 6f64 6572 2077  r, the encoder w
+0000e8d0: 696c 6c20 6d61 7020 7468 6520 636f 6e63  ill map the conc
+0000e8e0: 6174 656e 6174 6564 2066 6561 7475 7265  atenated feature
+0000e8f0: 7320 6672 6f6d 2074 6865 2060 6066 5f69  s from the ``f_i
+0000e900: 6e69 5f61 746f 6d73 5f62 6f6e 6473 6060  ni_atoms_bonds``
+0000e910: 0a20 2020 2074 6f20 6060 6d61 7070 696e  .    to ``mappin
+0000e920: 6760 6020 696e 2065 6163 6820 6974 6572  g`` in each iter
+0000e930: 6174 696f 6e20 7570 746f 2054 7468 2069  ation upto Tth i
+0000e940: 7465 7261 7469 6f6e 2e0a 0a20 2020 204e  teration...    N
+0000e950: 6578 7420 7468 6520 656e 636f 6465 7220  ext the encoder 
+0000e960: 7769 6c6c 2073 756d 2d75 7020 7468 6520  will sum-up the 
+0000e970: 636f 6e63 6174 2066 6561 7475 7265 7320  concat features 
+0000e980: 7769 7468 696e 2073 616d 6520 626f 6e64  within same bond
+0000e990: 2069 6e64 6578 2e0a 0a20 2020 202e 2e20   index...    .. 
+0000e9a0: 636f 6465 2d62 6c6f 636b 3a3a 2070 7974  code-block:: pyt
+0000e9b0: 686f 6e0a 0a20 2020 2020 2020 2020 2020  hon..           
+0000e9c0: 2020 2020 2020 2020 2020 2020 2028 3129               (1)
+0000e9d0: 6d31 3220 2020 2020 2020 2020 2020 2831  m12           (1
+0000e9e0: 296d 3231 2020 2020 2020 2020 2020 2028  )m21           (
+0000e9f0: 3129 6d32 3320 2020 2020 2020 2020 2020  1)m23           
+0000ea00: 2020 2028 3129 6d33 3220 2020 2020 2020     (1)m32       
+0000ea10: 2020 2028 3129 6d32 3420 2020 2020 2020     (1)m24       
+0000ea20: 2020 2020 2831 296d 3432 2020 2020 2020      (1)m42      
+0000ea30: 2020 2020 2028 3129 6d31 3520 2020 2020       (1)m15     
+0000ea40: 2020 2020 2028 3129 6d35 3120 2020 2020       (1)m51     
+0000ea50: 2020 2020 2020 206d 282d 3129 0a20 2020         m(-1).   
+0000ea60: 2020 2020 206d 6573 7361 6765 203d 205b       message = [
+0000ea70: 205b 6828 2d31 2920 2b20 2830 2968 3531   [h(-1) + (0)h51
+0000ea80: 5d20 5b28 3029 6833 3220 2b20 2830 2968  ] [(0)h32 + (0)h
+0000ea90: 3432 5d20 5b28 3029 6831 3220 2b20 2830  42] [(0)h12 + (0
+0000eaa0: 2968 3432 5d20 5b68 282d 3129 202b 2068  )h42] [h(-1) + h
+0000eab0: 282d 3129 5d20 5b28 3029 6831 3220 2b20  (-1)] [(0)h12 + 
+0000eac0: 2830 2968 3332 5d20 5b68 282d 3129 202b  (0)h32] [h(-1) +
+0000ead0: 2068 282d 3129 5d20 5b28 3029 6832 3120   h(-1)] [(0)h21 
+0000eae0: 2b20 6828 2d31 295d 205b 6828 2d31 2920  + h(-1)] [h(-1) 
+0000eaf0: 2b20 6828 2d31 295d 2020 5b68 282d 3129  + h(-1)]  [h(-1)
+0000eb00: 202b 2068 282d 3129 5d20 5d0a 0a20 2020   + h(-1)] ]..   
+0000eb10: 2048 656e 6365 2c20 7468 6973 2069 7320   Hence, this is 
+0000eb20: 686f 7720 656e 636f 6465 7220 6361 6e20  how encoder can 
+0000eb30: 6765 7420 6d65 7373 6167 6573 2066 6f72  get messages for
+0000eb40: 206d 6573 7361 6765 2d70 6173 7369 6e67   message-passing
+0000eb50: 2073 7465 7073 2e0a 0a20 2020 202a 2a47   steps...    **G
+0000eb60: 6574 206e 6577 2061 746f 6d20 6869 6464  et new atom hidd
+0000eb70: 656e 2073 7461 7465 7320 616e 6420 7265  en states and re
+0000eb80: 6164 6f75 7420 7068 6173 652a 2a0a 0a20  adout phase**.. 
+0000eb90: 2020 2048 656e 6365 206e 6f77 2066 6f72     Hence now for
+0000eba0: 2068 313a 0a0a 2020 2020 2e2e 2063 6f64   h1:..    .. cod
+0000ebb0: 652d 626c 6f63 6b3a 3a20 7079 7468 6f6e  e-block:: python
+0000ebc0: 0a0a 2020 2020 2020 2020 6831 203d 2066  ..        h1 = f
+0000ebd0: 756e 6333 280a 2020 2020 2020 2020 2020  unc3(.          
+0000ebe0: 2020 2020 2020 2020 2020 636f 6e63 6174            concat
+0000ebf0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000ec00: 2020 2020 2020 2020 2020 2061 312c 0a20             a1,. 
+0000ec10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec20: 2020 2020 2020 2020 5b0a 2020 2020 2020          [.      
+0000ec30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec40: 2020 2020 2020 6675 6e63 3228 2028 3029        func2( (0)
+0000ec50: 6832 3120 2c20 2830 2968 3332 202b 2028  h21 , (0)h32 + (
+0000ec60: 3029 6834 3220 2920 2b0a 2020 2020 2020  0)h42 ) +.      
+0000ec70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec80: 2020 2020 2020 6675 6e63 3228 2028 3029        func2( (0)
+0000ec90: 6835 3120 2c20 3020 2020 2020 2020 2020  h51 , 0         
+0000eca0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000ecb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ecc0: 205d 0a20 2020 2020 2020 2020 2020 2020   ].             
+0000ecd0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0000ece0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0000ecf0: 0a20 2020 2053 696d 696c 6172 6c79 2c20  .    Similarly, 
+0000ed00: 6832 2c20 6833 2c20 6834 2061 6e64 2068  h2, h3, h4 and h
+0000ed10: 3520 6172 6520 6361 6c63 756c 6174 6564  5 are calculated
+0000ed20: 2e0a 0a20 2020 204e 6578 742c 2061 6c6c  ...    Next, all
+0000ed30: 2061 746f 6d20 6869 6464 656e 2073 7461   atom hidden sta
+0000ed40: 7465 7320 6172 6520 636f 6e63 6174 656e  tes are concaten
+0000ed50: 6174 6564 2074 6f20 6d61 6b65 2061 2066  ated to make a f
+0000ed60: 6561 7475 7265 2076 6563 746f 7220 6f66  eature vector of
+0000ed70: 2074 6865 206d 6f6c 6563 756c 653a 0a0a   the molecule:..
+0000ed80: 2020 2020 6060 6d6f 6c5f 656e 636f 6469      ``mol_encodi
+0000ed90: 6e67 7320 3d20 5b5b 6831 2c20 6832 2c20  ngs = [[h1, h2, 
+0000eda0: 6833 2c20 6834 2c20 6835 5d5d 6060 0a0a  h3, h4, h5]]``..
+0000edb0: 2020 2020 2a2a 436f 6e63 6174 656e 6174      **Concatenat
+0000edc0: 6520 7468 6520 676c 6f62 616c 2066 6561  e the global fea
+0000edd0: 7475 7265 732a 2a0a 0a20 2020 204c 6574  tures**..    Let
+0000ede0: 2c0a 2020 2020 6060 676c 6f62 616c 5f66  ,.    ``global_f
+0000edf0: 6561 7475 7265 7320 3d20 5b5b 6766 312c  eatures = [[gf1,
+0000ee00: 2067 6632 2c20 6766 335d 5d60 600a 2020   gf2, gf3]]``.  
+0000ee10: 2020 5468 6973 2061 7272 6179 2063 6f6e    This array con
+0000ee20: 7461 696e 7320 6d6f 6c65 6375 6c65 206c  tains molecule l
+0000ee30: 6576 656c 2066 6561 7475 7265 732e 2049  evel features. I
+0000ee40: 6e20 6361 7365 206f 6620 7468 6973 2065  n case of this e
+0000ee50: 7861 6d70 6c65 2c20 6974 2063 6f6e 7461  xample, it conta
+0000ee60: 696e 7320 3320 676c 6f62 616c 2066 6561  ins 3 global fea
+0000ee70: 7475 7265 732e 0a0a 2020 2020 4865 6e63  tures...    Henc
+0000ee80: 6520 6166 7465 7220 636f 6e63 6174 656e  e after concaten
+0000ee90: 6174 696f 6e2c 0a0a 2020 2020 6060 6d6f  ation,..    ``mo
+0000eea0: 6c5f 656e 636f 6469 6e67 7320 3d20 5b5b  l_encodings = [[
+0000eeb0: 6831 2c20 6832 2c20 6833 2c20 6834 2c20  h1, h2, h3, h4, 
+0000eec0: 6835 2c20 6766 312c 2067 6632 2c20 6766  h5, gf1, gf2, gf
+0000eed0: 335d 5d60 600a 2020 2020 2846 696e 616c  3]]``.    (Final
+0000eee0: 206f 7574 7075 7420 6f66 2074 6865 2065   output of the e
+0000eef0: 6e63 6f64 6572 290a 0a20 2020 2052 6566  ncoder)..    Ref
+0000ef00: 6572 656e 6365 730a 2020 2020 2d2d 2d2d  erences.    ----
+0000ef10: 2d2d 2d2d 2d2d 0a20 2020 202e 2e20 5b31  ------.    .. [1
+0000ef20: 5d20 416e 616c 797a 696e 6720 4c65 6172  ] Analyzing Lear
+0000ef30: 6e65 6420 4d6f 6c65 6375 6c61 7220 5265  ned Molecular Re
+0000ef40: 7072 6573 656e 7461 7469 6f6e 7320 666f  presentations fo
+0000ef50: 7220 5072 6f70 6572 7479 2050 7265 6469  r Property Predi
+0000ef60: 6374 696f 6e20 6874 7470 733a 2f2f 6172  ction https://ar
+0000ef70: 7869 762e 6f72 672f 7064 662f 3139 3034  xiv.org/pdf/1904
+0000ef80: 2e30 3135 3631 2e70 6466 0a0a 2020 2020  .01561.pdf..    
+0000ef90: 4578 616d 706c 6573 0a20 2020 202d 2d2d  Examples.    ---
+0000efa0: 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20 6672  -----.    >>> fr
+0000efb0: 6f6d 2072 646b 6974 2069 6d70 6f72 7420  om rdkit import 
+0000efc0: 4368 656d 0a20 2020 203e 3e3e 2069 6d70  Chem.    >>> imp
+0000efd0: 6f72 7420 746f 7263 680a 2020 2020 3e3e  ort torch.    >>
+0000efe0: 3e20 696d 706f 7274 2064 6565 7063 6865  > import deepche
+0000eff0: 6d20 6173 2064 630a 2020 2020 3e3e 3e20  m as dc.    >>> 
+0000f000: 696e 7075 745f 736d 696c 6520 3d20 2243  input_smile = "C
+0000f010: 4322 0a20 2020 203e 3e3e 2066 6561 7420  C".    >>> feat 
+0000f020: 3d20 6463 2e66 6561 742e 444d 504e 4e46  = dc.feat.DMPNNF
+0000f030: 6561 7475 7269 7a65 7228 6665 6174 7572  eaturizer(featur
+0000f040: 6573 5f67 656e 6572 6174 6f72 733d 5b27  es_generators=['
+0000f050: 6d6f 7267 616e 275d 290a 2020 2020 3e3e  morgan']).    >>
+0000f060: 3e20 6772 6170 6820 3d20 6665 6174 2e66  > graph = feat.f
+0000f070: 6561 7475 7269 7a65 2869 6e70 7574 5f73  eaturize(input_s
+0000f080: 6d69 6c65 290a 2020 2020 3e3e 3e20 6672  mile).    >>> fr
+0000f090: 6f6d 2064 6565 7063 6865 6d2e 6d6f 6465  om deepchem.mode
+0000f0a0: 6c73 2e74 6f72 6368 5f6d 6f64 656c 732e  ls.torch_models.
+0000f0b0: 646d 706e 6e20 696d 706f 7274 205f 4d61  dmpnn import _Ma
+0000f0c0: 7070 6572 444d 504e 4e0a 2020 2020 3e3e  pperDMPNN.    >>
+0000f0d0: 3e20 6d61 7070 6572 203d 205f 4d61 7070  > mapper = _Mapp
+0000f0e0: 6572 444d 504e 4e28 6772 6170 685b 305d  erDMPNN(graph[0]
+0000f0f0: 290a 2020 2020 3e3e 3e20 6174 6f6d 5f66  ).    >>> atom_f
+0000f100: 6561 7475 7265 732c 2066 5f69 6e69 5f61  eatures, f_ini_a
+0000f110: 746f 6d73 5f62 6f6e 6473 2c20 6174 6f6d  toms_bonds, atom
+0000f120: 5f74 6f5f 696e 636f 6d69 6e67 5f62 6f6e  _to_incoming_bon
+0000f130: 6473 2c20 6d61 7070 696e 672c 2067 6c6f  ds, mapping, glo
+0000f140: 6261 6c5f 6665 6174 7572 6573 203d 206d  bal_features = m
+0000f150: 6170 7065 722e 7661 6c75 6573 0a20 2020  apper.values.   
+0000f160: 203e 3e3e 2061 746f 6d5f 6665 6174 7572   >>> atom_featur
+0000f170: 6573 203d 2074 6f72 6368 2e66 726f 6d5f  es = torch.from_
+0000f180: 6e75 6d70 7928 6174 6f6d 5f66 6561 7475  numpy(atom_featu
+0000f190: 7265 7329 2e66 6c6f 6174 2829 0a20 2020  res).float().   
+0000f1a0: 203e 3e3e 2066 5f69 6e69 5f61 746f 6d73   >>> f_ini_atoms
+0000f1b0: 5f62 6f6e 6473 203d 2074 6f72 6368 2e66  _bonds = torch.f
+0000f1c0: 726f 6d5f 6e75 6d70 7928 665f 696e 695f  rom_numpy(f_ini_
+0000f1d0: 6174 6f6d 735f 626f 6e64 7329 2e66 6c6f  atoms_bonds).flo
+0000f1e0: 6174 2829 0a20 2020 203e 3e3e 2061 746f  at().    >>> ato
+0000f1f0: 6d5f 746f 5f69 6e63 6f6d 696e 675f 626f  m_to_incoming_bo
+0000f200: 6e64 7320 3d20 746f 7263 682e 6672 6f6d  nds = torch.from
+0000f210: 5f6e 756d 7079 2861 746f 6d5f 746f 5f69  _numpy(atom_to_i
+0000f220: 6e63 6f6d 696e 675f 626f 6e64 7329 0a20  ncoming_bonds). 
+0000f230: 2020 203e 3e3e 206d 6170 7069 6e67 203d     >>> mapping =
+0000f240: 2074 6f72 6368 2e66 726f 6d5f 6e75 6d70   torch.from_nump
+0000f250: 7928 6d61 7070 696e 6729 0a20 2020 203e  y(mapping).    >
+0000f260: 3e3e 2067 6c6f 6261 6c5f 6665 6174 7572  >> global_featur
+0000f270: 6573 203d 2074 6f72 6368 2e66 726f 6d5f  es = torch.from_
+0000f280: 6e75 6d70 7928 676c 6f62 616c 5f66 6561  numpy(global_fea
+0000f290: 7475 7265 7329 2e66 6c6f 6174 2829 0a20  tures).float(). 
+0000f2a0: 2020 203e 3e3e 206d 6f6c 6563 756c 6573     >>> molecules
+0000f2b0: 5f75 6e62 6174 6368 5f6b 6579 203d 206c  _unbatch_key = l
+0000f2c0: 656e 2861 746f 6d5f 6665 6174 7572 6573  en(atom_features
+0000f2d0: 290a 2020 2020 3e3e 3e20 6c61 7965 7220  ).    >>> layer 
+0000f2e0: 3d20 444d 504e 4e45 6e63 6f64 6572 4c61  = DMPNNEncoderLa
+0000f2f0: 7965 7228 645f 6869 6464 656e 3d32 290a  yer(d_hidden=2).
+0000f300: 2020 2020 3e3e 3e20 6f75 7470 7574 203d      >>> output =
+0000f310: 206c 6179 6572 2861 746f 6d5f 6665 6174   layer(atom_feat
+0000f320: 7572 6573 2c20 665f 696e 695f 6174 6f6d  ures, f_ini_atom
+0000f330: 735f 626f 6e64 732c 2061 746f 6d5f 746f  s_bonds, atom_to
+0000f340: 5f69 6e63 6f6d 696e 675f 626f 6e64 732c  _incoming_bonds,
+0000f350: 206d 6170 7069 6e67 2c20 676c 6f62 616c   mapping, global
+0000f360: 5f66 6561 7475 7265 732c 206d 6f6c 6563  _features, molec
+0000f370: 756c 6573 5f75 6e62 6174 6368 5f6b 6579  ules_unbatch_key
+0000f380: 290a 2020 2020 2222 220a 0a20 2020 2064  ).    """..    d
+0000f390: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+0000f3a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000f3b0: 2020 2075 7365 5f64 6566 6175 6c74 5f66     use_default_f
+0000f3c0: 6469 6d3a 2062 6f6f 6c20 3d20 5472 7565  dim: bool = True
+0000f3d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000f3e0: 2020 2061 746f 6d5f 6664 696d 3a20 696e     atom_fdim: in
+0000f3f0: 7420 3d20 3133 332c 0a20 2020 2020 2020  t = 133,.       
+0000f400: 2020 2020 2020 2020 2020 626f 6e64 5f66            bond_f
+0000f410: 6469 6d3a 2069 6e74 203d 2031 342c 0a20  dim: int = 14,. 
+0000f420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f430: 645f 6869 6464 656e 3a20 696e 7420 3d20  d_hidden: int = 
+0000f440: 3330 302c 0a20 2020 2020 2020 2020 2020  300,.           
+0000f450: 2020 2020 2020 6465 7074 683a 2069 6e74        depth: int
+0000f460: 203d 2033 2c0a 2020 2020 2020 2020 2020   = 3,.          
+0000f470: 2020 2020 2020 2062 6961 733a 2062 6f6f         bias: boo
+0000f480: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
+0000f490: 2020 2020 2020 2020 2020 2020 6163 7469              acti
+0000f4a0: 7661 7469 6f6e 3a20 7374 7220 3d20 2772  vation: str = 'r
+0000f4b0: 656c 7527 2c0a 2020 2020 2020 2020 2020  elu',.          
+0000f4c0: 2020 2020 2020 2064 726f 706f 7574 5f70         dropout_p
+0000f4d0: 3a20 666c 6f61 7420 3d20 302e 302c 0a20  : float = 0.0,. 
+0000f4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f4f0: 6167 6772 6567 6174 696f 6e3a 2073 7472  aggregation: str
+0000f500: 203d 2027 6d65 616e 272c 0a20 2020 2020   = 'mean',.     
+0000f510: 2020 2020 2020 2020 2020 2020 6167 6772              aggr
+0000f520: 6567 6174 696f 6e5f 6e6f 726d 3a20 556e  egation_norm: Un
+0000f530: 696f 6e5b 696e 742c 2066 6c6f 6174 5d20  ion[int, float] 
+0000f540: 3d20 3130 3029 3a0a 2020 2020 2020 2020  = 100):.        
+0000f550: 2222 2249 6e69 7469 616c 697a 6520 6120  """Initialize a 
+0000f560: 444d 504e 4e45 6e63 6f64 6572 4c61 7965  DMPNNEncoderLaye
+0000f570: 7220 6c61 7965 722e 0a0a 2020 2020 2020  r layer...      
+0000f580: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+0000f590: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+0000f5a0: 2020 2020 2020 2020 7573 655f 6465 6661          use_defa
+0000f5b0: 756c 745f 6664 696d 3a20 626f 6f6c 0a20  ult_fdim: bool. 
+0000f5c0: 2020 2020 2020 2020 2020 2049 6620 6060             If ``
+0000f5d0: 5472 7565 6060 2c20 6060 7365 6c66 2e61  True``, ``self.a
+0000f5e0: 746f 6d5f 6664 696d 6060 2061 6e64 2060  tom_fdim`` and `
+0000f5f0: 6073 656c 662e 626f 6e64 5f66 6469 6d60  `self.bond_fdim`
+0000f600: 6020 6172 6520 696e 6974 6961 6c69 7a65  ` are initialize
+0000f610: 6420 7573 696e 6720 7661 6c75 6573 2066  d using values f
+0000f620: 726f 6d20 7468 6520 4772 6170 6843 6f6e  rom the GraphCon
+0000f630: 7643 6f6e 7374 616e 7473 2063 6c61 7373  vConstants class
+0000f640: 2e20 4966 2060 6046 616c 7365 6060 2c20  . If ``False``, 
+0000f650: 6060 7365 6c66 2e61 746f 6d5f 6664 696d  ``self.atom_fdim
+0000f660: 6060 2061 6e64 2060 6073 656c 662e 626f  `` and ``self.bo
+0000f670: 6e64 5f66 6469 6d60 6020 6172 6520 696e  nd_fdim`` are in
+0000f680: 6974 6961 6c69 7a65 6420 6672 6f6d 2074  itialized from t
+0000f690: 6865 2076 616c 7565 7320 7072 6f76 6964  he values provid
+0000f6a0: 6564 2e0a 2020 2020 2020 2020 6174 6f6d  ed..        atom
+0000f6b0: 5f66 6469 6d3a 2069 6e74 0a20 2020 2020  _fdim: int.     
+0000f6c0: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
+0000f6d0: 206f 6620 6174 6f6d 2066 6561 7475 7265   of atom feature
+0000f6e0: 2076 6563 746f 722e 0a20 2020 2020 2020   vector..       
+0000f6f0: 2062 6f6e 645f 6664 696d 3a20 696e 740a   bond_fdim: int.
+0000f700: 2020 2020 2020 2020 2020 2020 4469 6d65              Dime
+0000f710: 6e73 696f 6e20 6f66 2062 6f6e 6420 6665  nsion of bond fe
+0000f720: 6174 7572 6520 7665 6374 6f72 2e0a 2020  ature vector..  
+0000f730: 2020 2020 2020 645f 6869 6464 656e 3a20        d_hidden: 
+0000f740: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
+0000f750: 5369 7a65 206f 6620 6869 6464 656e 206c  Size of hidden l
+0000f760: 6179 6572 2069 6e20 7468 6520 656e 636f  ayer in the enco
+0000f770: 6465 7220 6c61 7965 722e 0a20 2020 2020  der layer..     
+0000f780: 2020 2064 6570 7468 3a20 696e 740a 2020     depth: int.  
+0000f790: 2020 2020 2020 2020 2020 4e6f 206f 6620            No of 
+0000f7a0: 6d65 7373 6167 6520 7061 7373 696e 6720  message passing 
+0000f7b0: 7374 6570 732e 0a20 2020 2020 2020 2062  steps..        b
+0000f7c0: 6961 733a 2062 6f6f 6c0a 2020 2020 2020  ias: bool.      
+0000f7d0: 2020 2020 2020 4966 2060 6054 7275 6560        If ``True`
+0000f7e0: 602c 2064 656e 7365 206c 6179 6572 7320  `, dense layers 
+0000f7f0: 7769 6c6c 2075 7365 2062 6961 7320 7665  will use bias ve
+0000f800: 6374 6f72 732e 0a20 2020 2020 2020 2061  ctors..        a
+0000f810: 6374 6976 6174 696f 6e3a 2073 7472 0a20  ctivation: str. 
+0000f820: 2020 2020 2020 2020 2020 2041 6374 6976             Activ
+0000f830: 6174 696f 6e20 6675 6e63 7469 6f6e 2074  ation function t
+0000f840: 6f20 6265 2075 7365 6420 696e 2074 6865  o be used in the
+0000f850: 2065 6e63 6f64 6572 206c 6179 6572 2e0a   encoder layer..
+0000f860: 2020 2020 2020 2020 2020 2020 4361 6e20              Can 
+0000f870: 6368 6f6f 7365 2062 6574 7765 656e 2027  choose between '
+0000f880: 7265 6c75 2720 666f 7220 5265 4c55 2c20  relu' for ReLU, 
+0000f890: 276c 6561 6b79 7265 6c75 2720 666f 7220  'leakyrelu' for 
+0000f8a0: 4c65 616b 7952 654c 552c 2027 7072 656c  LeakyReLU, 'prel
+0000f8b0: 7527 2066 6f72 2050 5265 4c55 2c0a 2020  u' for PReLU,.  
+0000f8c0: 2020 2020 2020 2020 2020 2774 616e 6827            'tanh'
+0000f8d0: 2066 6f72 2054 616e 482c 2027 7365 6c75   for TanH, 'selu
+0000f8e0: 2720 666f 7220 5345 4c55 2c20 616e 6420  ' for SELU, and 
+0000f8f0: 2765 6c75 2720 666f 7220 454c 552e 0a20  'elu' for ELU.. 
+0000f900: 2020 2020 2020 2064 726f 706f 7574 5f70         dropout_p
+0000f910: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
+0000f920: 2020 2020 4472 6f70 6f75 7420 7072 6f62      Dropout prob
+0000f930: 6162 696c 6974 7920 666f 7220 7468 6520  ability for the 
+0000f940: 656e 636f 6465 7220 6c61 7965 722e 0a20  encoder layer.. 
+0000f950: 2020 2020 2020 2061 6767 7265 6761 7469         aggregati
+0000f960: 6f6e 3a20 7374 720a 2020 2020 2020 2020  on: str.        
+0000f970: 2020 2020 4167 6772 6567 6174 696f 6e20      Aggregation 
+0000f980: 7479 7065 2074 6f20 6265 2075 7365 6420  type to be used 
+0000f990: 696e 2074 6865 2065 6e63 6f64 6572 206c  in the encoder l
+0000f9a0: 6179 6572 2e0a 2020 2020 2020 2020 2020  ayer..          
+0000f9b0: 2020 4361 6e20 6368 6f6f 7365 2062 6574    Can choose bet
+0000f9c0: 7765 656e 2027 6d65 616e 272c 2027 7375  ween 'mean', 'su
+0000f9d0: 6d27 2c20 616e 6420 276e 6f72 6d27 2e0a  m', and 'norm'..
+0000f9e0: 2020 2020 2020 2020 6167 6772 6567 6174          aggregat
+0000f9f0: 696f 6e5f 6e6f 726d 3a20 556e 696f 6e5b  ion_norm: Union[
+0000fa00: 696e 742c 2066 6c6f 6174 5d0a 2020 2020  int, float].    
+0000fa10: 2020 2020 2020 2020 5661 6c75 6520 7265          Value re
+0000fa20: 7175 6972 6564 2069 6620 6061 6767 7265  quired if `aggre
+0000fa30: 6761 7469 6f6e 6020 7479 7065 2069 7320  gation` type is 
+0000fa40: 276e 6f72 6d27 2e0a 2020 2020 2020 2020  'norm'..        
+0000fa50: 2222 220a 2020 2020 2020 2020 7375 7065  """.        supe
+0000fa60: 7228 444d 504e 4e45 6e63 6f64 6572 4c61  r(DMPNNEncoderLa
+0000fa70: 7965 722c 2073 656c 6629 2e5f 5f69 6e69  yer, self).__ini
+0000fa80: 745f 5f28 290a 0a20 2020 2020 2020 2069  t__()..        i
+0000fa90: 6620 7573 655f 6465 6661 756c 745f 6664  f use_default_fd
+0000faa0: 696d 3a0a 2020 2020 2020 2020 2020 2020  im:.            
+0000fab0: 6672 6f6d 2064 6565 7063 6865 6d2e 6665  from deepchem.fe
+0000fac0: 6174 2e6d 6f6c 6563 756c 655f 6665 6174  at.molecule_feat
+0000fad0: 7572 697a 6572 732e 646d 706e 6e5f 6665  urizers.dmpnn_fe
+0000fae0: 6174 7572 697a 6572 2069 6d70 6f72 7420  aturizer import 
+0000faf0: 4772 6170 6843 6f6e 7643 6f6e 7374 616e  GraphConvConstan
+0000fb00: 7473 0a20 2020 2020 2020 2020 2020 2073  ts.            s
+0000fb10: 656c 662e 6174 6f6d 5f66 6469 6d3a 2069  elf.atom_fdim: i
+0000fb20: 6e74 203d 2047 7261 7068 436f 6e76 436f  nt = GraphConvCo
+0000fb30: 6e73 7461 6e74 732e 4154 4f4d 5f46 4449  nstants.ATOM_FDI
+0000fb40: 4d0a 2020 2020 2020 2020 2020 2020 7365  M.            se
+0000fb50: 6c66 2e63 6f6e 6361 745f 6664 696d 3a20  lf.concat_fdim: 
+0000fb60: 696e 7420 3d20 4772 6170 6843 6f6e 7643  int = GraphConvC
+0000fb70: 6f6e 7374 616e 7473 2e41 544f 4d5f 4644  onstants.ATOM_FD
+0000fb80: 494d 202b 2047 7261 7068 436f 6e76 436f  IM + GraphConvCo
+0000fb90: 6e73 7461 6e74 732e 424f 4e44 5f46 4449  nstants.BOND_FDI
+0000fba0: 4d0a 2020 2020 2020 2020 656c 7365 3a0a  M.        else:.
+0000fbb0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000fbc0: 2e61 746f 6d5f 6664 696d 203d 2061 746f  .atom_fdim = ato
+0000fbd0: 6d5f 6664 696d 0a20 2020 2020 2020 2020  m_fdim.         
+0000fbe0: 2020 2073 656c 662e 636f 6e63 6174 5f66     self.concat_f
+0000fbf0: 6469 6d20 3d20 6174 6f6d 5f66 6469 6d20  dim = atom_fdim 
+0000fc00: 2b20 626f 6e64 5f66 6469 6d0a 0a20 2020  + bond_fdim..   
+0000fc10: 2020 2020 2073 656c 662e 6465 7074 683a       self.depth:
+0000fc20: 2069 6e74 203d 2064 6570 7468 0a20 2020   int = depth.   
+0000fc30: 2020 2020 2073 656c 662e 6167 6772 6567       self.aggreg
+0000fc40: 6174 696f 6e3a 2073 7472 203d 2061 6767  ation: str = agg
+0000fc50: 7265 6761 7469 6f6e 0a20 2020 2020 2020  regation.       
+0000fc60: 2073 656c 662e 6167 6772 6567 6174 696f   self.aggregatio
+0000fc70: 6e5f 6e6f 726d 3a20 556e 696f 6e5b 696e  n_norm: Union[in
+0000fc80: 742c 2066 6c6f 6174 5d20 3d20 6167 6772  t, float] = aggr
+0000fc90: 6567 6174 696f 6e5f 6e6f 726d 0a0a 2020  egation_norm..  
+0000fca0: 2020 2020 2020 6966 2061 6374 6976 6174        if activat
+0000fcb0: 696f 6e20 3d3d 2027 7265 6c75 273a 0a20  ion == 'relu':. 
+0000fcc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000fcd0: 6163 7469 7661 7469 6f6e 3a20 6e6e 2e6d  activation: nn.m
+0000fce0: 6f64 756c 6573 2e61 6374 6976 6174 696f  odules.activatio
+0000fcf0: 6e2e 4d6f 6475 6c65 203d 206e 6e2e 5265  n.Module = nn.Re
+0000fd00: 4c55 2829 0a0a 2020 2020 2020 2020 656c  LU()..        el
+0000fd10: 6966 2061 6374 6976 6174 696f 6e20 3d3d  if activation ==
+0000fd20: 2027 6c65 616b 7972 656c 7527 3a0a 2020   'leakyrelu':.  
+0000fd30: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+0000fd40: 6374 6976 6174 696f 6e20 3d20 6e6e 2e4c  ctivation = nn.L
+0000fd50: 6561 6b79 5265 4c55 2830 2e31 290a 0a20  eakyReLU(0.1).. 
+0000fd60: 2020 2020 2020 2065 6c69 6620 6163 7469         elif acti
+0000fd70: 7661 7469 6f6e 203d 3d20 2770 7265 6c75  vation == 'prelu
+0000fd80: 273a 0a20 2020 2020 2020 2020 2020 2073  ':.            s
+0000fd90: 656c 662e 6163 7469 7661 7469 6f6e 203d  elf.activation =
+0000fda0: 206e 6e2e 5052 654c 5528 290a 0a20 2020   nn.PReLU()..   
+0000fdb0: 2020 2020 2065 6c69 6620 6163 7469 7661       elif activa
+0000fdc0: 7469 6f6e 203d 3d20 2774 616e 6827 3a0a  tion == 'tanh':.
+0000fdd0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000fde0: 2e61 6374 6976 6174 696f 6e20 3d20 6e6e  .activation = nn
+0000fdf0: 2e54 616e 6828 290a 0a20 2020 2020 2020  .Tanh()..       
+0000fe00: 2065 6c69 6620 6163 7469 7661 7469 6f6e   elif activation
+0000fe10: 203d 3d20 2773 656c 7527 3a0a 2020 2020   == 'selu':.    
+0000fe20: 2020 2020 2020 2020 7365 6c66 2e61 6374          self.act
+0000fe30: 6976 6174 696f 6e20 3d20 6e6e 2e53 454c  ivation = nn.SEL
+0000fe40: 5528 290a 0a20 2020 2020 2020 2065 6c69  U()..        eli
+0000fe50: 6620 6163 7469 7661 7469 6f6e 203d 3d20  f activation == 
+0000fe60: 2765 6c75 273a 0a20 2020 2020 2020 2020  'elu':.         
+0000fe70: 2020 2073 656c 662e 6163 7469 7661 7469     self.activati
+0000fe80: 6f6e 203d 206e 6e2e 454c 5528 290a 0a20  on = nn.ELU().. 
+0000fe90: 2020 2020 2020 2073 656c 662e 6472 6f70         self.drop
+0000fea0: 6f75 743a 206e 6e2e 6d6f 6475 6c65 732e  out: nn.modules.
+0000feb0: 6472 6f70 6f75 742e 4d6f 6475 6c65 203d  dropout.Module =
+0000fec0: 206e 6e2e 4472 6f70 6f75 7428 6472 6f70   nn.Dropout(drop
+0000fed0: 6f75 745f 7029 0a0a 2020 2020 2020 2020  out_p)..        
+0000fee0: 2320 496e 7075 740a 2020 2020 2020 2020  # Input.        
+0000fef0: 7365 6c66 2e57 5f69 3a20 6e6e 2e4c 696e  self.W_i: nn.Lin
+0000ff00: 6561 7220 3d20 6e6e 2e4c 696e 6561 7228  ear = nn.Linear(
+0000ff10: 7365 6c66 2e63 6f6e 6361 745f 6664 696d  self.concat_fdim
+0000ff20: 2c20 645f 6869 6464 656e 2c20 6269 6173  , d_hidden, bias
+0000ff30: 3d62 6961 7329 0a0a 2020 2020 2020 2020  =bias)..        
+0000ff40: 2320 5368 6172 6564 2077 6569 6768 7420  # Shared weight 
+0000ff50: 6d61 7472 6978 2061 6372 6f73 7320 6465  matrix across de
+0000ff60: 7074 6873 2028 6465 6661 756c 7429 3a0a  pths (default):.
+0000ff70: 2020 2020 2020 2020 2320 466f 7220 6d65          # For me
+0000ff80: 7373 6167 6573 2068 6964 6465 6e20 7374  ssages hidden st
+0000ff90: 6174 6573 0a20 2020 2020 2020 2073 656c  ates.        sel
+0000ffa0: 662e 575f 683a 206e 6e2e 4c69 6e65 6172  f.W_h: nn.Linear
+0000ffb0: 203d 206e 6e2e 4c69 6e65 6172 2864 5f68   = nn.Linear(d_h
+0000ffc0: 6964 6465 6e2c 2064 5f68 6964 6465 6e2c  idden, d_hidden,
+0000ffd0: 2062 6961 733d 6269 6173 290a 0a20 2020   bias=bias)..   
+0000ffe0: 2020 2020 2023 2046 6f72 2061 746f 6d20       # For atom 
+0000fff0: 6869 6464 656e 2073 7461 7465 730a 2020  hidden states.  
+00010000: 2020 2020 2020 7365 6c66 2e57 5f6f 3a20        self.W_o: 
+00010010: 6e6e 2e4c 696e 6561 7220 3d20 6e6e 2e4c  nn.Linear = nn.L
+00010020: 696e 6561 7228 7365 6c66 2e61 746f 6d5f  inear(self.atom_
+00010030: 6664 696d 202b 2064 5f68 6964 6465 6e2c  fdim + d_hidden,
+00010040: 2064 5f68 6964 6465 6e29 0a0a 2020 2020   d_hidden)..    
+00010050: 6465 6620 5f67 6574 5f75 7064 6174 6564  def _get_updated
+00010060: 5f61 746f 6d73 5f68 6964 6465 6e5f 7374  _atoms_hidden_st
+00010070: 6174 6528 0a20 2020 2020 2020 2020 2020  ate(.           
+00010080: 2073 656c 662c 2061 746f 6d5f 6665 6174   self, atom_feat
+00010090: 7572 6573 3a20 746f 7263 682e 5465 6e73  ures: torch.Tens
+000100a0: 6f72 2c20 685f 6d65 7373 6167 653a 2074  or, h_message: t
+000100b0: 6f72 6368 2e54 656e 736f 722c 0a20 2020  orch.Tensor,.   
+000100c0: 2020 2020 2020 2020 2061 746f 6d5f 746f           atom_to
+000100d0: 5f69 6e63 6f6d 696e 675f 626f 6e64 733a  _incoming_bonds:
+000100e0: 2074 6f72 6368 2e54 656e 736f 7229 202d   torch.Tensor) -
+000100f0: 3e20 746f 7263 682e 5465 6e73 6f72 3a0a  > torch.Tensor:.
+00010100: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00010110: 2020 2020 4d65 7468 6f64 2074 6f20 636f      Method to co
+00010120: 6d70 7574 6520 6174 6f6d 2068 6964 6465  mpute atom hidde
+00010130: 6e20 7374 6174 6573 2e0a 0a20 2020 2020  n states...     
+00010140: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00010150: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00010160: 0a20 2020 2020 2020 2061 746f 6d5f 6665  .        atom_fe
+00010170: 6174 7572 6573 3a20 746f 7263 682e 5465  atures: torch.Te
+00010180: 6e73 6f72 0a20 2020 2020 2020 2020 2020  nsor.           
+00010190: 2054 656e 736f 7220 636f 6e74 6169 6e69   Tensor containi
+000101a0: 6e67 2061 746f 6d73 2066 6561 7475 7265  ng atoms feature
+000101b0: 732e 0a20 2020 2020 2020 2068 5f6d 6573  s..        h_mes
+000101c0: 7361 6765 3a20 746f 7263 682e 5465 6e73  sage: torch.Tens
+000101d0: 6f72 0a20 2020 2020 2020 2020 2020 2054  or.            T
+000101e0: 656e 736f 7220 636f 6e74 6169 6e69 6e67  ensor containing
+000101f0: 2068 6964 6465 6e20 7374 6174 6573 206f   hidden states o
+00010200: 6620 6d65 7373 6167 6573 2e0a 2020 2020  f messages..    
+00010210: 2020 2020 6174 6f6d 5f74 6f5f 696e 636f      atom_to_inco
+00010220: 6d69 6e67 5f62 6f6e 6473 3a20 746f 7263  ming_bonds: torc
+00010230: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
+00010240: 2020 2020 2054 656e 736f 7220 636f 6e74       Tensor cont
+00010250: 6169 6e69 6e67 206d 6170 7069 6e67 2066  aining mapping f
+00010260: 726f 6d20 6174 6f6d 2069 6e64 6578 2074  rom atom index t
+00010270: 6f20 6c69 7374 206f 6620 696e 6469 6369  o list of indici
+00010280: 6573 206f 6620 696e 636f 6d69 6e67 2062  es of incoming b
+00010290: 6f6e 6473 2e0a 0a20 2020 2020 2020 2052  onds...        R
+000102a0: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
+000102b0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2061  ------.        a
+000102c0: 746f 6d73 5f68 6964 6465 6e5f 7374 6174  toms_hidden_stat
+000102d0: 6573 3a20 746f 7263 682e 5465 6e73 6f72  es: torch.Tensor
+000102e0: 0a20 2020 2020 2020 2020 2020 2054 656e  .            Ten
+000102f0: 736f 7220 636f 6e74 6169 6e69 6e67 2061  sor containing a
+00010300: 746f 6d20 6869 6464 656e 2073 7461 7465  tom hidden state
+00010310: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
+00010320: 2020 2020 2020 206d 6573 7361 6765 735f         messages_
+00010330: 746f 5f61 746f 6d73 3a20 746f 7263 682e  to_atoms: torch.
+00010340: 5465 6e73 6f72 203d 2068 5f6d 6573 7361  Tensor = h_messa
+00010350: 6765 5b61 746f 6d5f 746f 5f69 6e63 6f6d  ge[atom_to_incom
+00010360: 696e 675f 626f 6e64 735d 2e73 756d 280a  ing_bonds].sum(.
+00010370: 2020 2020 2020 2020 2020 2020 3129 2020              1)  
+00010380: 2320 6e75 6d5f 6174 6f6d 7320 7820 6869  # num_atoms x hi
+00010390: 6464 656e 5f73 697a 650a 2020 2020 2020  dden_size.      
+000103a0: 2020 6174 6f6d 735f 6869 6464 656e 5f73    atoms_hidden_s
+000103b0: 7461 7465 733a 2074 6f72 6368 2e54 656e  tates: torch.Ten
+000103c0: 736f 7220 3d20 7365 6c66 2e57 5f6f 280a  sor = self.W_o(.
+000103d0: 2020 2020 2020 2020 2020 2020 746f 7263              torc
+000103e0: 682e 6361 7428 2861 746f 6d5f 6665 6174  h.cat((atom_feat
+000103f0: 7572 6573 2c20 6d65 7373 6167 6573 5f74  ures, messages_t
+00010400: 6f5f 6174 6f6d 7329 2c0a 2020 2020 2020  o_atoms),.      
+00010410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010420: 3129 2920 2023 206e 756d 5f61 746f 6d73  1))  # num_atoms
+00010430: 2078 2068 6964 6465 6e5f 7369 7a65 0a20   x hidden_size. 
+00010440: 2020 2020 2020 2061 746f 6d73 5f68 6964         atoms_hid
+00010450: 6465 6e5f 7374 6174 6573 203d 2073 656c  den_states = sel
+00010460: 662e 6163 7469 7661 7469 6f6e 280a 2020  f.activation(.  
+00010470: 2020 2020 2020 2020 2020 6174 6f6d 735f            atoms_
+00010480: 6869 6464 656e 5f73 7461 7465 7329 2020  hidden_states)  
+00010490: 2320 6e75 6d5f 6174 6f6d 7320 7820 6869  # num_atoms x hi
+000104a0: 6464 656e 5f73 697a 650a 2020 2020 2020  dden_size.      
+000104b0: 2020 6174 6f6d 735f 6869 6464 656e 5f73    atoms_hidden_s
+000104c0: 7461 7465 7320 3d20 7365 6c66 2e64 726f  tates = self.dro
+000104d0: 706f 7574 280a 2020 2020 2020 2020 2020  pout(.          
+000104e0: 2020 6174 6f6d 735f 6869 6464 656e 5f73    atoms_hidden_s
+000104f0: 7461 7465 7329 2020 2320 6e75 6d5f 6174  tates)  # num_at
+00010500: 6f6d 7320 7820 6869 6464 656e 5f73 697a  oms x hidden_siz
+00010510: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
+00010520: 2061 746f 6d73 5f68 6964 6465 6e5f 7374   atoms_hidden_st
+00010530: 6174 6573 2020 2320 6e75 6d5f 6174 6f6d  ates  # num_atom
+00010540: 7320 7820 6869 6464 656e 5f73 697a 650a  s x hidden_size.
+00010550: 0a20 2020 2064 6566 205f 7265 6164 6f75  .    def _readou
+00010560: 7428 7365 6c66 2c20 6174 6f6d 735f 6869  t(self, atoms_hi
+00010570: 6464 656e 5f73 7461 7465 733a 2074 6f72  dden_states: tor
+00010580: 6368 2e54 656e 736f 722c 0a20 2020 2020  ch.Tensor,.     
+00010590: 2020 2020 2020 2020 2020 2020 6d6f 6c65              mole
+000105a0: 6375 6c65 735f 756e 6261 7463 685f 6b65  cules_unbatch_ke
+000105b0: 793a 204c 6973 7429 202d 3e20 746f 7263  y: List) -> torc
+000105c0: 682e 5465 6e73 6f72 3a0a 2020 2020 2020  h.Tensor:.      
+000105d0: 2020 2222 220a 2020 2020 2020 2020 4d65    """.        Me
+000105e0: 7468 6f64 2074 6f20 6578 6563 7574 6520  thod to execute 
+000105f0: 7468 6520 7265 6164 6f75 7420 7068 6173  the readout phas
+00010600: 652e 2028 636f 6d70 7574 6520 6d6f 6c65  e. (compute mole
+00010610: 6375 6c65 7320 656e 636f 6469 6e67 7320  cules encodings 
+00010620: 6672 6f6d 2061 746f 6d20 6869 6464 656e  from atom hidden
+00010630: 2073 7461 7465 7329 0a0a 2020 2020 2020   states)..      
+00010640: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00010650: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+00010660: 2020 2020 2020 2020 6174 6f6d 735f 6869          atoms_hi
+00010670: 6464 656e 5f73 7461 7465 733a 2074 6f72  dden_states: tor
+00010680: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
+00010690: 2020 2020 2020 5465 6e73 6f72 2063 6f6e        Tensor con
+000106a0: 7461 696e 696e 6720 6174 6f6d 2068 6964  taining atom hid
+000106b0: 6465 6e20 7374 6174 6573 2e0a 2020 2020  den states..    
+000106c0: 2020 2020 6d6f 6c65 6375 6c65 735f 756e      molecules_un
+000106d0: 6261 7463 685f 6b65 793a 204c 6973 740a  batch_key: List.
+000106e0: 2020 2020 2020 2020 2020 2020 4c69 7374              List
+000106f0: 2063 6f6e 7461 696e 696e 6720 6e75 6d62   containing numb
+00010700: 6572 206f 6620 6174 6f6d 7320 696e 2076  er of atoms in v
+00010710: 6172 696f 7573 206d 6f6c 6563 756c 6573  arious molecules
+00010720: 206f 6620 6120 6261 7463 680a 0a20 2020   of a batch..   
+00010730: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
+00010740: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
+00010750: 2020 2020 206d 6f6c 6563 756c 655f 6869       molecule_hi
+00010760: 6464 656e 5f73 7461 7465 3a20 746f 7263  dden_state: torc
+00010770: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
+00010780: 2020 2020 2054 656e 736f 7220 636f 6e74       Tensor cont
+00010790: 6169 6e69 6e67 206d 6f6c 6563 756c 6520  aining molecule 
+000107a0: 656e 636f 6469 6e67 732e 0a20 2020 2020  encodings..     
+000107b0: 2020 2022 2222 0a20 2020 2020 2020 206d     """.        m
+000107c0: 6f6c 5f76 6563 733a 204c 6973 7420 3d20  ol_vecs: List = 
+000107d0: 5b5d 0a20 2020 2020 2020 2061 746f 6d73  [].        atoms
+000107e0: 5f68 6964 6465 6e5f 7374 6174 6573 5f73  _hidden_states_s
+000107f0: 706c 6974 3a20 5365 7175 656e 6365 5b54  plit: Sequence[T
+00010800: 656e 736f 725d 203d 2074 6f72 6368 2e73  ensor] = torch.s
+00010810: 706c 6974 280a 2020 2020 2020 2020 2020  plit(.          
+00010820: 2020 6174 6f6d 735f 6869 6464 656e 5f73    atoms_hidden_s
+00010830: 7461 7465 732c 206d 6f6c 6563 756c 6573  tates, molecules
+00010840: 5f75 6e62 6174 6368 5f6b 6579 290a 2020  _unbatch_key).  
+00010850: 2020 2020 2020 6d6f 6c5f 7665 633a 2074        mol_vec: t
+00010860: 6f72 6368 2e54 656e 736f 720a 2020 2020  orch.Tensor.    
+00010870: 2020 2020 666f 7220 6d6f 6c5f 7665 6320      for mol_vec 
+00010880: 696e 2061 746f 6d73 5f68 6964 6465 6e5f  in atoms_hidden_
+00010890: 7374 6174 6573 5f73 706c 6974 3a0a 2020  states_split:.  
+000108a0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+000108b0: 662e 6167 6772 6567 6174 696f 6e20 3d3d  f.aggregation ==
+000108c0: 2027 6d65 616e 273a 0a20 2020 2020 2020   'mean':.       
+000108d0: 2020 2020 2020 2020 206d 6f6c 5f76 6563           mol_vec
+000108e0: 203d 206d 6f6c 5f76 6563 2e73 756d 2864   = mol_vec.sum(d
+000108f0: 696d 3d30 2920 2f20 6c65 6e28 6d6f 6c5f  im=0) / len(mol_
+00010900: 7665 6329 0a20 2020 2020 2020 2020 2020  vec).           
+00010910: 2065 6c69 6620 7365 6c66 2e61 6767 7265   elif self.aggre
+00010920: 6761 7469 6f6e 203d 3d20 2773 756d 273a  gation == 'sum':
+00010930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010940: 206d 6f6c 5f76 6563 203d 206d 6f6c 5f76   mol_vec = mol_v
+00010950: 6563 2e73 756d 2864 696d 3d30 290a 2020  ec.sum(dim=0).  
+00010960: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
+00010970: 656c 662e 6167 6772 6567 6174 696f 6e20  elf.aggregation 
+00010980: 3d3d 2027 6e6f 726d 273a 0a20 2020 2020  == 'norm':.     
+00010990: 2020 2020 2020 2020 2020 206d 6f6c 5f76             mol_v
+000109a0: 6563 203d 206d 6f6c 5f76 6563 2e73 756d  ec = mol_vec.sum
+000109b0: 2864 696d 3d30 2920 2f20 7365 6c66 2e61  (dim=0) / self.a
+000109c0: 6767 7265 6761 7469 6f6e 5f6e 6f72 6d0a  ggregation_norm.
+000109d0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000109e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000109f0: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
+00010a00: 6e28 2249 6e76 616c 6964 2061 6767 7265  n("Invalid aggre
+00010a10: 6761 7469 6f6e 2229 0a20 2020 2020 2020  gation").       
+00010a20: 2020 2020 206d 6f6c 5f76 6563 732e 6170       mol_vecs.ap
+00010a30: 7065 6e64 286d 6f6c 5f76 6563 290a 0a20  pend(mol_vec).. 
+00010a40: 2020 2020 2020 206d 6f6c 6563 756c 655f         molecule_
+00010a50: 6869 6464 656e 5f73 7461 7465 3a20 746f  hidden_state: to
+00010a60: 7263 682e 5465 6e73 6f72 203d 2074 6f72  rch.Tensor = tor
+00010a70: 6368 2e73 7461 636b 286d 6f6c 5f76 6563  ch.stack(mol_vec
+00010a80: 732c 2064 696d 3d30 290a 2020 2020 2020  s, dim=0).      
+00010a90: 2020 7265 7475 726e 206d 6f6c 6563 756c    return molecul
+00010aa0: 655f 6869 6464 656e 5f73 7461 7465 2020  e_hidden_state  
+00010ab0: 2320 6e75 6d5f 6d6f 6c65 6375 6c65 7320  # num_molecules 
+00010ac0: 7820 6869 6464 656e 5f73 697a 650a 0a20  x hidden_size.. 
+00010ad0: 2020 2064 6566 2066 6f72 7761 7264 2873     def forward(s
+00010ae0: 656c 662c 2061 746f 6d5f 6665 6174 7572  elf, atom_featur
+00010af0: 6573 3a20 746f 7263 682e 5465 6e73 6f72  es: torch.Tensor
+00010b00: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00010b10: 2020 665f 696e 695f 6174 6f6d 735f 626f    f_ini_atoms_bo
+00010b20: 6e64 733a 2074 6f72 6368 2e54 656e 736f  nds: torch.Tenso
+00010b30: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00010b40: 2020 2061 746f 6d5f 746f 5f69 6e63 6f6d     atom_to_incom
+00010b50: 696e 675f 626f 6e64 733a 2074 6f72 6368  ing_bonds: torch
+00010b60: 2e54 656e 736f 722c 206d 6170 7069 6e67  .Tensor, mapping
+00010b70: 3a20 746f 7263 682e 5465 6e73 6f72 2c0a  : torch.Tensor,.
+00010b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b90: 676c 6f62 616c 5f66 6561 7475 7265 733a  global_features:
+00010ba0: 2074 6f72 6368 2e54 656e 736f 722c 0a20   torch.Tensor,. 
+00010bb0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00010bc0: 6f6c 6563 756c 6573 5f75 6e62 6174 6368  olecules_unbatch
+00010bd0: 5f6b 6579 3a20 4c69 7374 2920 2d3e 2074  _key: List) -> t
+00010be0: 6f72 6368 2e54 656e 736f 723a 0a20 2020  orch.Tensor:.   
+00010bf0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00010c00: 204f 7574 7075 7420 636f 6d70 7574 6174   Output computat
+00010c10: 696f 6e20 666f 7220 7468 6520 444d 504e  ion for the DMPN
+00010c20: 4e45 6e63 6f64 6572 4c61 7965 722e 0a0a  NEncoderLayer...
+00010c30: 2020 2020 2020 2020 5374 6570 733a 0a0a          Steps:..
+00010c40: 2020 2020 2020 2020 2d20 4765 7420 6f72          - Get or
+00010c50: 6967 696e 616c 2062 6f6e 6420 6869 6464  iginal bond hidd
+00010c60: 656e 2073 7461 7465 7320 6672 6f6d 2063  en states from c
+00010c70: 6f6e 6361 7465 6e61 7469 6f6e 206f 6620  oncatenation of 
+00010c80: 696e 6974 6961 6c20 6174 6f6d 2061 6e64  initial atom and
+00010c90: 2062 6f6e 6420 6665 6174 7572 6573 2e20   bond features. 
+00010ca0: 2860 6069 6e70 7574 6060 290a 2020 2020  (``input``).    
+00010cb0: 2020 2020 2d20 4765 7420 696e 6974 6961      - Get initia
+00010cc0: 6c20 6d65 7373 6167 6573 2068 6964 6465  l messages hidde
+00010cd0: 6e20 7374 6174 6573 2e20 2860 606d 6573  n states. (``mes
+00010ce0: 7361 6765 6060 290a 2020 2020 2020 2020  sage``).        
+00010cf0: 2d20 4578 6563 7574 6520 6d65 7373 6167  - Execute messag
+00010d00: 6520 7061 7373 696e 6720 7374 6570 2066  e passing step f
+00010d10: 6f72 2060 6073 656c 662e 6465 7074 6820  or ``self.depth 
+00010d20: 2d20 3160 6020 6974 6572 6174 696f 6e73  - 1`` iterations
+00010d30: 2e0a 2020 2020 2020 2020 2d20 4765 7420  ..        - Get 
+00010d40: 6174 6f6d 2068 6964 6465 6e20 7374 6174  atom hidden stat
+00010d50: 6573 2075 7369 6e67 2061 746f 6d20 6665  es using atom fe
+00010d60: 6174 7572 6573 2061 6e64 206d 6573 7361  atures and messa
+00010d70: 6765 2068 6964 6465 6e20 7374 6174 6573  ge hidden states
+00010d80: 2e0a 2020 2020 2020 2020 2d20 4765 7420  ..        - Get 
+00010d90: 6d6f 6c65 6375 6c65 2065 6e63 6f64 696e  molecule encodin
+00010da0: 6773 2e0a 2020 2020 2020 2020 2d20 436f  gs..        - Co
+00010db0: 6e63 6174 656e 6174 6520 676c 6f62 616c  ncatenate global
+00010dc0: 206d 6f6c 6563 756c 6172 2066 6561 7475   molecular featu
+00010dd0: 7265 7320 616e 6420 6d6f 6c65 6375 6c65  res and molecule
+00010de0: 2065 6e63 6f64 696e 6773 2e0a 0a20 2020   encodings...   
+00010df0: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+00010e00: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00010e10: 2d2d 0a20 2020 2020 2020 2061 746f 6d5f  --.        atom_
+00010e20: 6665 6174 7572 6573 3a20 746f 7263 682e  features: torch.
+00010e30: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
+00010e40: 2020 2054 656e 736f 7220 636f 6e74 6169     Tensor contai
+00010e50: 6e69 6e67 2061 746f 6d73 2066 6561 7475  ning atoms featu
+00010e60: 7265 732e 0a20 2020 2020 2020 2066 5f69  res..        f_i
+00010e70: 6e69 5f61 746f 6d73 5f62 6f6e 6473 3a20  ni_atoms_bonds: 
+00010e80: 746f 7263 682e 5465 6e73 6f72 0a20 2020  torch.Tensor.   
+00010e90: 2020 2020 2020 2020 2054 656e 736f 7220           Tensor 
+00010ea0: 636f 6e74 6169 6e69 6e67 2063 6f6e 6361  containing conca
+00010eb0: 7465 6e61 7465 6420 6665 6174 7572 6520  tenated feature 
+00010ec0: 7665 6374 6f72 2077 6869 6368 2063 6f6e  vector which con
+00010ed0: 7461 696e 7320 636f 6e63 6174 656e 6174  tains concatenat
+00010ee0: 696f 6e20 6f66 2069 6e69 7469 616c 2061  ion of initial a
+00010ef0: 746f 6d20 616e 6420 626f 6e64 2066 6561  tom and bond fea
+00010f00: 7475 7265 732e 0a20 2020 2020 2020 2061  tures..        a
+00010f10: 746f 6d5f 746f 5f69 6e63 6f6d 696e 675f  tom_to_incoming_
+00010f20: 626f 6e64 733a 2074 6f72 6368 2e54 656e  bonds: torch.Ten
+00010f30: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
+00010f40: 5465 6e73 6f72 2063 6f6e 7461 696e 696e  Tensor containin
+00010f50: 6720 6d61 7070 696e 6720 6672 6f6d 2061  g mapping from a
+00010f60: 746f 6d20 696e 6465 7820 746f 206c 6973  tom index to lis
+00010f70: 7420 6f66 2069 6e64 6963 6965 7320 6f66  t of indicies of
+00010f80: 2069 6e63 6f6d 696e 6720 626f 6e64 732e   incoming bonds.
+00010f90: 0a20 2020 2020 2020 206d 6170 7069 6e67  .        mapping
+00010fa0: 3a20 746f 7263 682e 5465 6e73 6f72 0a20  : torch.Tensor. 
+00010fb0: 2020 2020 2020 2020 2020 2054 656e 736f             Tenso
+00010fc0: 7220 636f 6e74 6169 6e69 6e67 2074 6865  r containing the
+00010fd0: 206d 6170 7069 6e67 2074 6861 7420 6d61   mapping that ma
+00010fe0: 7073 2062 6f6e 6420 696e 6465 7820 746f  ps bond index to
+00010ff0: 2027 6172 7261 7920 6f66 2069 6e64 6963   'array of indic
+00011000: 6573 206f 6620 7468 6520 626f 6e64 7327  es of the bonds'
+00011010: 0a20 2020 2020 2020 2020 2020 2069 6e63  .            inc
+00011020: 6f6d 696e 6720 6174 2074 6865 2069 6e69  oming at the ini
+00011030: 7469 616c 2061 746f 6d20 6f66 2074 6865  tial atom of the
+00011040: 2062 6f6e 6420 2865 7863 6c75 6469 6e67   bond (excluding
+00011050: 2074 6865 2072 6576 6572 7365 2062 6f6e   the reverse bon
+00011060: 6473 292e 0a20 2020 2020 2020 2067 6c6f  ds)..        glo
+00011070: 6261 6c5f 6665 6174 7572 6573 3a20 746f  bal_features: to
+00011080: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
+00011090: 2020 2020 2020 2054 656e 736f 7220 636f         Tensor co
+000110a0: 6e74 6169 6e69 6e67 206d 6f6c 6563 756c  ntaining molecul
+000110b0: 6520 6665 6174 7572 6573 2e0a 2020 2020  e features..    
+000110c0: 2020 2020 6d6f 6c65 6375 6c65 735f 756e      molecules_un
+000110d0: 6261 7463 685f 6b65 793a 204c 6973 740a  batch_key: List.
+000110e0: 2020 2020 2020 2020 2020 2020 4c69 7374              List
+000110f0: 2063 6f6e 7461 696e 696e 6720 6e75 6d62   containing numb
+00011100: 6572 206f 6620 6174 6f6d 7320 696e 2076  er of atoms in v
+00011110: 6172 696f 7573 206d 6f6c 6563 756c 6573  arious molecules
+00011120: 206f 6620 6120 6261 7463 680a 0a20 2020   of a batch..   
+00011130: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
+00011140: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
+00011150: 2020 2020 206f 7574 7075 743a 2074 6f72       output: tor
+00011160: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
+00011170: 2020 2020 2020 5465 6e73 6f72 2063 6f6e        Tensor con
+00011180: 7461 696e 696e 6720 7468 6520 656e 636f  taining the enco
+00011190: 6469 6e67 7320 6f66 2074 6865 206d 6f6c  dings of the mol
+000111a0: 6563 756c 6573 2e0a 2020 2020 2020 2020  ecules..        
+000111b0: 2222 220a 2020 2020 2020 2020 696e 7075  """.        inpu
+000111c0: 743a 2074 6f72 6368 2e54 656e 736f 7220  t: torch.Tensor 
+000111d0: 3d20 7365 6c66 2e57 5f69 280a 2020 2020  = self.W_i(.    
+000111e0: 2020 2020 2020 2020 665f 696e 695f 6174          f_ini_at
+000111f0: 6f6d 735f 626f 6e64 7329 2020 2320 6e75  oms_bonds)  # nu
+00011200: 6d5f 626f 6e64 7320 7820 6869 6464 656e  m_bonds x hidden
+00011210: 5f73 697a 650a 2020 2020 2020 2020 6d65  _size.        me
+00011220: 7373 6167 653a 2074 6f72 6368 2e54 656e  ssage: torch.Ten
+00011230: 736f 7220 3d20 7365 6c66 2e61 6374 6976  sor = self.activ
+00011240: 6174 696f 6e28 0a20 2020 2020 2020 2020  ation(.         
+00011250: 2020 2069 6e70 7574 2920 2023 206e 756d     input)  # num
+00011260: 5f62 6f6e 6473 2078 2068 6964 6465 6e5f  _bonds x hidden_
+00011270: 7369 7a65 0a0a 2020 2020 2020 2020 666f  size..        fo
+00011280: 7220 5f20 696e 2072 616e 6765 2831 2c20  r _ in range(1, 
+00011290: 7365 6c66 2e64 6570 7468 293a 0a20 2020  self.depth):.   
+000112a0: 2020 2020 2020 2020 206d 6573 7361 6765           message
+000112b0: 203d 206d 6573 7361 6765 5b6d 6170 7069   = message[mappi
+000112c0: 6e67 5d2e 7375 6d28 3129 2020 2320 6e75  ng].sum(1)  # nu
+000112d0: 6d5f 626f 6e64 7320 7820 6869 6464 656e  m_bonds x hidden
+000112e0: 5f73 697a 650a 2020 2020 2020 2020 2020  _size.          
+000112f0: 2020 685f 6d65 7373 6167 653a 2074 6f72    h_message: tor
+00011300: 6368 2e54 656e 736f 7220 3d20 696e 7075  ch.Tensor = inpu
+00011310: 7420 2b20 7365 6c66 2e57 5f68 280a 2020  t + self.W_h(.  
+00011320: 2020 2020 2020 2020 2020 2020 2020 6d65                me
+00011330: 7373 6167 6529 2020 2320 6e75 6d5f 626f  ssage)  # num_bo
+00011340: 6e64 7320 7820 6869 6464 656e 5f73 697a  nds x hidden_siz
+00011350: 650a 2020 2020 2020 2020 2020 2020 685f  e.            h_
+00011360: 6d65 7373 6167 6520 3d20 7365 6c66 2e61  message = self.a
+00011370: 6374 6976 6174 696f 6e28 685f 6d65 7373  ctivation(h_mess
+00011380: 6167 6529 2020 2320 6e75 6d5f 626f 6e64  age)  # num_bond
+00011390: 7320 7820 6869 6464 656e 5f73 697a 650a  s x hidden_size.
+000113a0: 2020 2020 2020 2020 2020 2020 685f 6d65              h_me
+000113b0: 7373 6167 6520 3d20 7365 6c66 2e64 726f  ssage = self.dro
+000113c0: 706f 7574 2868 5f6d 6573 7361 6765 2920  pout(h_message) 
+000113d0: 2023 206e 756d 5f62 6f6e 6473 2078 2068   # num_bonds x h
+000113e0: 6964 6465 6e5f 7369 7a65 0a0a 2020 2020  idden_size..    
+000113f0: 2020 2020 2320 6e75 6d5f 6174 6f6d 7320      # num_atoms 
+00011400: 7820 6869 6464 656e 5f73 697a 650a 2020  x hidden_size.  
+00011410: 2020 2020 2020 6174 6f6d 735f 6869 6464        atoms_hidd
+00011420: 656e 5f73 7461 7465 733a 2074 6f72 6368  en_states: torch
+00011430: 2e54 656e 736f 7220 3d20 7365 6c66 2e5f  .Tensor = self._
+00011440: 6765 745f 7570 6461 7465 645f 6174 6f6d  get_updated_atom
+00011450: 735f 6869 6464 656e 5f73 7461 7465 280a  s_hidden_state(.
+00011460: 2020 2020 2020 2020 2020 2020 6174 6f6d              atom
+00011470: 5f66 6561 7475 7265 732c 2068 5f6d 6573  _features, h_mes
+00011480: 7361 6765 2c20 6174 6f6d 5f74 6f5f 696e  sage, atom_to_in
+00011490: 636f 6d69 6e67 5f62 6f6e 6473 290a 0a20  coming_bonds).. 
+000114a0: 2020 2020 2020 2023 206e 756d 5f6d 6f6c         # num_mol
+000114b0: 6563 756c 6573 2078 2068 6964 6465 6e5f  ecules x hidden_
+000114c0: 7369 7a65 0a20 2020 2020 2020 206f 7574  size.        out
+000114d0: 7075 743a 2074 6f72 6368 2e54 656e 736f  put: torch.Tenso
+000114e0: 7220 3d20 7365 6c66 2e5f 7265 6164 6f75  r = self._readou
+000114f0: 7428 6174 6f6d 735f 6869 6464 656e 5f73  t(atoms_hidden_s
+00011500: 7461 7465 732c 0a20 2020 2020 2020 2020  tates,.         
+00011510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011530: 2020 2020 6d6f 6c65 6375 6c65 735f 756e      molecules_un
+00011540: 6261 7463 685f 6b65 7929 0a0a 2020 2020  batch_key)..    
+00011550: 2020 2020 2320 636f 6e63 6174 2067 6c6f      # concat glo
+00011560: 6261 6c20 6665 6174 7572 6573 0a20 2020  bal features.   
+00011570: 2020 2020 2069 6620 676c 6f62 616c 5f66       if global_f
+00011580: 6561 7475 7265 732e 7369 7a65 2829 5b30  eatures.size()[0
+00011590: 5d20 213d 2030 3a0a 2020 2020 2020 2020  ] != 0:.        
+000115a0: 2020 2020 6966 206c 656e 2867 6c6f 6261      if len(globa
+000115b0: 6c5f 6665 6174 7572 6573 2e73 6861 7065  l_features.shape
+000115c0: 2920 3d3d 2031 3a0a 2020 2020 2020 2020  ) == 1:.        
+000115d0: 2020 2020 2020 2020 676c 6f62 616c 5f66          global_f
+000115e0: 6561 7475 7265 7320 3d20 676c 6f62 616c  eatures = global
+000115f0: 5f66 6561 7475 7265 732e 7669 6577 286c  _features.view(l
+00011600: 656e 286f 7574 7075 7429 2c20 2d31 290a  en(output), -1).
+00011610: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
+00011620: 7574 203d 2074 6f72 6368 2e63 6174 285b  ut = torch.cat([
+00011630: 6f75 7470 7574 2c20 676c 6f62 616c 5f66  output, global_f
+00011640: 6561 7475 7265 735d 2c20 6469 6d3d 3129  eatures], dim=1)
+00011650: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00011660: 206f 7574 7075 7420 2023 206e 756d 5f6d   output  # num_m
+00011670: 6f6c 6563 756c 6573 2078 2068 6964 6465  olecules x hidde
+00011680: 6e5f 7369 7a65 0a0a 0a63 6c61 7373 2049  n_size...class I
+00011690: 6e74 6572 6174 6f6d 6963 4c32 4469 7374  nteratomicL2Dist
+000116a0: 616e 6365 7328 6e6e 2e4d 6f64 756c 6529  ances(nn.Module)
+000116b0: 3a0a 2020 2020 2222 2243 6f6d 7075 7465  :.    """Compute
+000116c0: 2028 7371 7561 7265 6429 204c 3220 4469   (squared) L2 Di
+000116d0: 7374 616e 6365 7320 6265 7477 6565 6e20  stances between 
+000116e0: 6174 6f6d 7320 6769 7665 6e20 6e65 6967  atoms given neig
+000116f0: 6862 6f72 732e 0a0a 2020 2020 5468 6973  hbors...    This
+00011700: 2063 6c61 7373 2069 7320 7468 6520 7079   class is the py
+00011710: 746f 7263 6820 696d 706c 656d 656e 7461  torch implementa
+00011720: 7469 6f6e 206f 6620 7468 6520 6f72 6967  tion of the orig
+00011730: 696e 616c 2049 6e74 6572 6174 6f6d 6963  inal Interatomic
+00011740: 4c32 4469 7374 616e 6365 7320 6c61 7965  L2Distances laye
+00011750: 7220 696d 706c 656d 656e 7465 6420 696e  r implemented in
+00011760: 204b 6572 6173 2e0a 2020 2020 5061 6972   Keras..    Pair
+00011770: 7769 7365 2064 6973 7461 6e63 6520 284c  wise distance (L
+00011780: 3229 2069 7320 6361 6c63 756c 6174 6564  2) is calculated
+00011790: 2062 6574 7765 656e 2069 6e70 7574 2061   between input a
+000117a0: 746f 6d73 2c20 6769 7665 6e20 7468 6520  toms, given the 
+000117b0: 6e75 6d62 6572 206f 6620 6e65 6967 6862  number of neighb
+000117c0: 6f72 7320 746f 2063 6f6e 7369 6465 722c  ors to consider,
+000117d0: 2061 6c6f 6e67 2077 6974 6820 7468 6520   along with the 
+000117e0: 6e75 6d62 6572 206f 6620 6465 7363 7269  number of descri
+000117f0: 7074 6f72 7320 666f 7220 6576 6572 7920  ptors for every 
+00011800: 6174 6f6d 2e0a 0a20 2020 2045 7861 6d70  atom...    Examp
+00011810: 6c65 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  les.    --------
+00011820: 0a20 2020 203e 3e3e 2061 746f 6d73 203d  .    >>> atoms =
+00011830: 2035 0a20 2020 203e 3e3e 206e 6569 6768   5.    >>> neigh
+00011840: 626f 7273 203d 2032 0a20 2020 203e 3e3e  bors = 2.    >>>
+00011850: 2063 6f6f 7264 7320 3d20 6e70 2e72 616e   coords = np.ran
+00011860: 646f 6d2e 7261 6e64 2861 746f 6d73 2c20  dom.rand(atoms, 
+00011870: 3329 0a20 2020 203e 3e3e 206e 6569 6768  3).    >>> neigh
+00011880: 626f 725f 6c69 7374 203d 206e 702e 7261  bor_list = np.ra
+00011890: 6e64 6f6d 2e72 616e 6469 6e74 2830 2c20  ndom.randint(0, 
+000118a0: 6174 6f6d 732c 2073 697a 653d 2861 746f  atoms, size=(ato
+000118b0: 6d73 2c20 6e65 6967 6862 6f72 7329 290a  ms, neighbors)).
+000118c0: 2020 2020 3e3e 3e20 6c61 7965 7220 3d20      >>> layer = 
+000118d0: 496e 7465 7261 746f 6d69 634c 3244 6973  InteratomicL2Dis
+000118e0: 7461 6e63 6573 2861 746f 6d73 2c20 6e65  tances(atoms, ne
+000118f0: 6967 6862 6f72 732c 2033 290a 2020 2020  ighbors, 3).    
+00011900: 3e3e 3e20 7265 7375 6c74 203d 206e 702e  >>> result = np.
+00011910: 6172 7261 7928 6c61 7965 7228 5b63 6f6f  array(layer([coo
+00011920: 7264 732c 206e 6569 6768 626f 725f 6c69  rds, neighbor_li
+00011930: 7374 5d29 290a 2020 2020 3e3e 3e20 7265  st])).    >>> re
+00011940: 7375 6c74 2e73 6861 7065 0a20 2020 2028  sult.shape.    (
+00011950: 352c 2032 290a 0a20 2020 2022 2222 0a0a  5, 2)..    """..
+00011960: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+00011970: 2873 656c 662c 204e 5f61 746f 6d73 3a20  (self, N_atoms: 
+00011980: 696e 742c 204d 5f6e 6272 733a 2069 6e74  int, M_nbrs: int
+00011990: 2c20 6e64 696d 3a20 696e 742c 202a 2a6b  , ndim: int, **k
+000119a0: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+000119b0: 2222 2243 6f6e 7374 7275 6374 6f72 2066  """Constructor f
+000119c0: 6f72 2074 6869 7320 6c61 7965 722e 0a0a  or this layer...
+000119d0: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+000119e0: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+000119f0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 4e5f  -----.        N_
+00011a00: 6174 6f6d 733a 2069 6e74 0a20 2020 2020  atoms: int.     
+00011a10: 2020 2020 2020 204e 756d 6265 7220 6f66         Number of
+00011a20: 2061 746f 6d73 2069 6e20 7468 6520 7379   atoms in the sy
+00011a30: 7374 656d 2074 6f74 616c 2e0a 2020 2020  stem total..    
+00011a40: 2020 2020 4d5f 6e62 7273 3a20 696e 740a      M_nbrs: int.
+00011a50: 2020 2020 2020 2020 2020 2020 4e75 6d62              Numb
+00011a60: 6572 206f 6620 6e65 6967 6862 6f72 7320  er of neighbors 
+00011a70: 746f 2063 6f6e 7369 6465 7220 7768 656e  to consider when
+00011a80: 2063 6f6d 7075 7469 6e67 2064 6973 7461   computing dista
+00011a90: 6e63 6573 2e0a 2020 2020 2020 2020 6e5f  nces..        n_
+00011aa0: 6469 6d3a 2020 696e 740a 2020 2020 2020  dim:  int.      
+00011ab0: 2020 2020 2020 4e75 6d62 6572 206f 6620        Number of 
+00011ac0: 6465 7363 7269 7074 6f72 7320 666f 7220  descriptors for 
+00011ad0: 6561 6368 2061 746f 6d2e 0a20 2020 2020  each atom..     
+00011ae0: 2020 2022 2222 0a20 2020 2020 2020 2073     """.        s
+00011af0: 7570 6572 2849 6e74 6572 6174 6f6d 6963  uper(Interatomic
+00011b00: 4c32 4469 7374 616e 6365 732c 2073 656c  L2Distances, sel
+00011b10: 6629 2e5f 5f69 6e69 745f 5f28 2a2a 6b77  f).__init__(**kw
+00011b20: 6172 6773 290a 2020 2020 2020 2020 7365  args).        se
+00011b30: 6c66 2e4e 5f61 746f 6d73 203d 204e 5f61  lf.N_atoms = N_a
+00011b40: 746f 6d73 0a20 2020 2020 2020 2073 656c  toms.        sel
+00011b50: 662e 4d5f 6e62 7273 203d 204d 5f6e 6272  f.M_nbrs = M_nbr
+00011b60: 730a 2020 2020 2020 2020 7365 6c66 2e6e  s.        self.n
+00011b70: 6469 6d20 3d20 6e64 696d 0a0a 2020 2020  dim = ndim..    
+00011b80: 6465 6620 5f5f 7265 7072 5f5f 2873 656c  def __repr__(sel
+00011b90: 6629 202d 3e20 7374 723a 0a20 2020 2020  f) -> str:.     
+00011ba0: 2020 2072 6574 7572 6e20 280a 2020 2020     return (.    
+00011bb0: 2020 2020 2020 2020 6627 7b73 656c 662e          f'{self.
+00011bc0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+00011bd0: 5f5f 7d28 4e5f 6174 6f6d 733d 7b73 656c  __}(N_atoms={sel
+00011be0: 662e 4e5f 6174 6f6d 737d 2c20 4d5f 6e62  f.N_atoms}, M_nb
+00011bf0: 7273 3d7b 7365 6c66 2e4d 5f6e 6272 737d  rs={self.M_nbrs}
+00011c00: 2c20 6e64 696d 3d7b 7365 6c66 2e6e 6469  , ndim={self.ndi
+00011c10: 6d7d 2927 0a20 2020 2020 2020 2029 0a0a  m})'.        )..
+00011c20: 2020 2020 6465 6620 666f 7277 6172 6428      def forward(
+00011c30: 0a20 2020 2020 2020 2073 656c 662c 2069  .        self, i
+00011c40: 6e70 7574 733a 204c 6973 745b 556e 696f  nputs: List[Unio
+00011c50: 6e5b 746f 7263 682e 5465 6e73 6f72 2c0a  n[torch.Tensor,.
+00011c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c80: 204c 6973 745b 556e 696f 6e5b 696e 742c   List[Union[int,
+00011c90: 2066 6c6f 6174 5d5d 5d5d 2920 2d3e 2074   float]]]]) -> t
+00011ca0: 6f72 6368 2e54 656e 736f 723a 0a20 2020  orch.Tensor:.   
+00011cb0: 2020 2020 2022 2222 496e 766f 6b65 7320       """Invokes 
+00011cc0: 7468 6973 206c 6179 6572 2e0a 0a20 2020  this layer...   
+00011cd0: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+00011ce0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00011cf0: 2d2d 0a20 2020 2020 2020 2069 6e70 7574  --.        input
+00011d00: 733a 206c 6973 740a 2020 2020 2020 2020  s: list.        
+00011d10: 2020 2020 5368 6f75 6c64 2062 6520 6f66      Should be of
+00011d20: 2066 6f72 6d20 6069 6e70 7574 733d 5b63   form `inputs=[c
+00011d30: 6f6f 7264 732c 206e 6272 5f6c 6973 745d  oords, nbr_list]
+00011d40: 6020 7768 6572 6520 6063 6f6f 7264 7360  ` where `coords`
+00011d50: 2069 7320 610a 2020 2020 2020 2020 2020   is a.          
+00011d60: 2020 7465 6e73 6f72 206f 6620 7368 6170    tensor of shap
+00011d70: 6520 6028 4e6f 6e65 2c20 4e2c 2033 2960  e `(None, N, 3)`
+00011d80: 2061 6e64 2060 6e62 725f 6c69 7374 6020   and `nbr_list` 
+00011d90: 6973 2061 206c 6973 742e 0a0a 2020 2020  is a list...    
+00011da0: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+00011db0: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
+00011dc0: 2020 2020 5465 6e73 6f72 206f 6620 7368      Tensor of sh
+00011dd0: 6170 6520 6028 4e5f 6174 6f6d 732c 204d  ape `(N_atoms, M
+00011de0: 5f6e 6272 7329 6020 7769 7468 2069 6e74  _nbrs)` with int
+00011df0: 6572 6174 6f6d 6963 2064 6973 7461 6e63  eratomic distanc
+00011e00: 6573 2e0a 2020 2020 2020 2020 2222 220a  es..        """.
+00011e10: 2020 2020 2020 2020 6966 206c 656e 2869          if len(i
+00011e20: 6e70 7574 7329 2021 3d20 323a 0a20 2020  nputs) != 2:.   
+00011e30: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00011e40: 616c 7565 4572 726f 7228 2249 6e74 6572  alueError("Inter
+00011e50: 6174 6f6d 6963 4469 7374 616e 6365 7320  atomicDistances 
+00011e60: 7265 7175 6972 6573 2063 6f6f 7264 732c  requires coords,
+00011e70: 6e62 725f 6c69 7374 2229 0a20 2020 2020  nbr_list").     
+00011e80: 2020 2063 6f6f 7264 732c 206e 6272 5f6c     coords, nbr_l
+00011e90: 6973 7420 3d20 2874 6f72 6368 2e74 656e  ist = (torch.ten
+00011ea0: 736f 7228 696e 7075 7473 5b30 5d29 2c20  sor(inputs[0]), 
+00011eb0: 746f 7263 682e 7465 6e73 6f72 2869 6e70  torch.tensor(inp
+00011ec0: 7574 735b 315d 2929 0a20 2020 2020 2020  uts[1])).       
+00011ed0: 204e 5f61 746f 6d73 2c20 4d5f 6e62 7273   N_atoms, M_nbrs
+00011ee0: 2c20 6e64 696d 203d 2073 656c 662e 4e5f  , ndim = self.N_
+00011ef0: 6174 6f6d 732c 2073 656c 662e 4d5f 6e62  atoms, self.M_nb
+00011f00: 7273 2c20 7365 6c66 2e6e 6469 6d0a 2020  rs, self.ndim.  
+00011f10: 2020 2020 2020 2320 5368 6170 6520 284e        # Shape (N
+00011f20: 5f61 746f 6d73 2c20 4d5f 6e62 7273 2c20  _atoms, M_nbrs, 
+00011f30: 6e64 696d 290a 2020 2020 2020 2020 6e62  ndim).        nb
+00011f40: 725f 636f 6f72 6473 203d 2063 6f6f 7264  r_coords = coord
+00011f50: 735b 6e62 725f 6c69 7374 2e6c 6f6e 6728  s[nbr_list.long(
+00011f60: 295d 0a20 2020 2020 2020 2023 2053 6861  )].        # Sha
+00011f70: 7065 2028 4e5f 6174 6f6d 732c 204d 5f6e  pe (N_atoms, M_n
+00011f80: 6272 732c 206e 6469 6d29 0a20 2020 2020  brs, ndim).     
+00011f90: 2020 2074 696c 6564 5f63 6f6f 7264 7320     tiled_coords 
+00011fa0: 3d20 746f 7263 682e 7469 6c65 2874 6f72  = torch.tile(tor
+00011fb0: 6368 2e72 6573 6861 7065 2863 6f6f 7264  ch.reshape(coord
+00011fc0: 732c 2028 4e5f 6174 6f6d 732c 2031 2c20  s, (N_atoms, 1, 
+00011fd0: 6e64 696d 2929 2c0a 2020 2020 2020 2020  ndim)),.        
+00011fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ff0: 2020 2020 2020 2020 2020 2831 2c20 4d5f            (1, M_
+00012000: 6e62 7273 2c20 3129 290a 2020 2020 2020  nbrs, 1)).      
+00012010: 2020 2320 5368 6170 6520 284e 5f61 746f    # Shape (N_ato
+00012020: 6d73 2c20 4d5f 6e62 7273 290a 2020 2020  ms, M_nbrs).    
+00012030: 2020 2020 7265 7475 726e 2074 6f72 6368      return torch
+00012040: 2e73 756d 2828 7469 6c65 645f 636f 6f72  .sum((tiled_coor
+00012050: 6473 202d 206e 6272 5f63 6f6f 7264 7329  ds - nbr_coords)
+00012060: 2a2a 322c 2064 696d 3d32 290a 0a0a 636c  **2, dim=2)...cl
+00012070: 6173 7320 5265 616c 4e56 504c 6179 6572  ass RealNVPLayer
+00012080: 286e 6e2e 4d6f 6475 6c65 293a 0a20 2020  (nn.Module):.   
+00012090: 2022 2222 5265 616c 204e 5650 2054 7261   """Real NVP Tra
+000120a0: 6e73 666f 726d 6174 696f 6e20 4c61 7965  nsformation Laye
+000120b0: 720a 0a20 2020 2054 6869 7320 636c 6173  r..    This clas
+000120c0: 7320 636c 6173 7320 6973 2061 2063 6f6e  s class is a con
+000120d0: 7374 7275 6374 6f72 2074 7261 6e73 666f  structor transfo
+000120e0: 726d 6174 696f 6e20 6c61 7965 7220 7573  rmation layer us
+000120f0: 6564 206f 6e20 610a 2020 2020 4e6f 726d  ed on a.    Norm
+00012100: 616c 697a 696e 6746 4c6f 7720 6d6f 6465  alizingFLow mode
+00012110: 6c2e 2020 5468 6520 5265 616c 204e 6f6e  l.  The Real Non
+00012120: 2d50 7265 7365 7276 696e 672d 566f 6c75  -Preserving-Volu
+00012130: 6d65 6e20 2852 6561 6c20 4e56 5029 2069  men (Real NVP) i
+00012140: 7320 6120 7479 7065 0a20 2020 206f 6620  s a type.    of 
+00012150: 6e6f 726d 616c 697a 696e 6720 666c 6f77  normalizing flow
+00012160: 206c 6179 6572 2077 6869 6368 2067 6976   layer which giv
+00012170: 6573 2061 6476 616e 7461 6765 7320 6f76  es advantages ov
+00012180: 6572 2074 6869 7320 6d61 696e 6c79 2062  er this mainly b
+00012190: 6563 6175 7365 2061 6e0a 2020 2020 6561  ecause an.    ea
+000121a0: 7365 2074 6f20 636f 6d70 7574 6520 7468  se to compute th
+000121b0: 6520 696e 7665 7273 6520 7061 7373 205b  e inverse pass [
+000121c0: 315d 5f2c 2074 6869 7320 6973 2074 6f20  1]_, this is to 
+000121d0: 6c65 6172 6e20 6120 7461 7267 6574 0a20  learn a target. 
+000121e0: 2020 2064 6973 7472 6962 7574 696f 6e2e     distribution.
+000121f0: 0a0a 2020 2020 4578 616d 706c 650a 2020  ..    Example.  
+00012200: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e    -------.    >>
+00012210: 3e20 696d 706f 7274 2074 6f72 6368 0a20  > import torch. 
+00012220: 2020 203e 3e3e 2069 6d70 6f72 7420 746f     >>> import to
+00012230: 7263 682e 6e6e 2061 7320 6e6e 0a20 2020  rch.nn as nn.   
+00012240: 203e 3e3e 2066 726f 6d20 746f 7263 682e   >>> from torch.
+00012250: 6469 7374 7269 6275 7469 6f6e 7320 696d  distributions im
+00012260: 706f 7274 204d 756c 7469 7661 7269 6174  port Multivariat
+00012270: 654e 6f72 6d61 6c0a 2020 2020 3e3e 3e20  eNormal.    >>> 
+00012280: 6672 6f6d 2064 6565 7063 6865 6d2e 6d6f  from deepchem.mo
+00012290: 6465 6c73 2e74 6f72 6368 5f6d 6f64 656c  dels.torch_model
+000122a0: 732e 6c61 7965 7273 2069 6d70 6f72 7420  s.layers import 
+000122b0: 5265 616c 4e56 504c 6179 6572 0a20 2020  RealNVPLayer.   
+000122c0: 203e 3e3e 2064 696d 203d 2032 0a20 2020   >>> dim = 2.   
+000122d0: 203e 3e3e 2073 616d 706c 6573 203d 2039   >>> samples = 9
+000122e0: 360a 2020 2020 3e3e 3e20 6461 7461 203d  6.    >>> data =
+000122f0: 204d 756c 7469 7661 7269 6174 654e 6f72   MultivariateNor
+00012300: 6d61 6c28 746f 7263 682e 7a65 726f 7328  mal(torch.zeros(
+00012310: 6469 6d29 2c20 746f 7263 682e 6579 6528  dim), torch.eye(
+00012320: 6469 6d29 290a 2020 2020 3e3e 3e20 7465  dim)).    >>> te
+00012330: 6e73 6f72 203d 2064 6174 612e 7361 6d70  nsor = data.samp
+00012340: 6c65 2874 6f72 6368 2e53 697a 6528 2873  le(torch.Size((s
+00012350: 616d 706c 6573 2c20 6469 6d29 2929 0a0a  amples, dim)))..
+00012360: 2020 2020 3e3e 3e20 6c61 7965 7273 203d      >>> layers =
+00012370: 2034 0a20 2020 203e 3e3e 2068 6964 6465   4.    >>> hidde
+00012380: 6e5f 7369 7a65 203d 2031 360a 2020 2020  n_size = 16.    
+00012390: 3e3e 3e20 6d61 736b 7320 3d20 462e 6f6e  >>> masks = F.on
+000123a0: 655f 686f 7428 746f 7263 682e 7465 6e73  e_hot(torch.tens
+000123b0: 6f72 285b 6920 2520 3220 666f 7220 6920  or([i % 2 for i 
+000123c0: 696e 2072 616e 6765 286c 6179 6572 7329  in range(layers)
+000123d0: 5d29 292e 666c 6f61 7428 290a 2020 2020  ])).float().    
+000123e0: 3e3e 3e20 6c61 7965 7273 203d 206e 6e2e  >>> layers = nn.
+000123f0: 4d6f 6475 6c65 4c69 7374 285b 5265 616c  ModuleList([Real
+00012400: 4e56 504c 6179 6572 286d 6173 6b2c 2068  NVPLayer(mask, h
+00012410: 6964 6465 6e5f 7369 7a65 2920 666f 7220  idden_size) for 
+00012420: 6d61 736b 2069 6e20 6d61 736b 735d 290a  mask in masks]).
+00012430: 0a20 2020 203e 3e3e 2066 6f72 206c 6179  .    >>> for lay
+00012440: 6572 2069 6e20 6c61 7965 7273 3a0a 2020  er in layers:.  
+00012450: 2020 2e2e 2e20 2020 5f2c 2069 6e76 6572    ...   _, inver
+00012460: 7365 5f6c 6f67 5f64 6574 5f6a 6163 6f62  se_log_det_jacob
+00012470: 6961 6e20 3d20 6c61 7965 722e 696e 7665  ian = layer.inve
+00012480: 7273 6528 7465 6e73 6f72 290a 2020 2020  rse(tensor).    
+00012490: 2e2e 2e20 2020 696e 7665 7273 655f 6c6f  ...   inverse_lo
+000124a0: 675f 6465 745f 6a61 636f 6269 616e 203d  g_det_jacobian =
+000124b0: 2069 6e76 6572 7365 5f6c 6f67 5f64 6574   inverse_log_det
+000124c0: 5f6a 6163 6f62 6961 6e2e 6465 7461 6368  _jacobian.detach
+000124d0: 2829 2e6e 756d 7079 2829 0a20 2020 203e  ().numpy().    >
+000124e0: 3e3e 206c 656e 2869 6e76 6572 7365 5f6c  >> len(inverse_l
+000124f0: 6f67 5f64 6574 5f6a 6163 6f62 6961 6e29  og_det_jacobian)
+00012500: 0a20 2020 2039 360a 0a20 2020 2052 6566  .    96..    Ref
+00012510: 6572 656e 6365 730a 2020 2020 2d2d 2d2d  erences.    ----
+00012520: 2d2d 2d2d 2d2d 0a20 2020 202e 2e20 5b31  ------.    .. [1
+00012530: 5d20 5374 696d 7065 722c 2056 2e2c 2053  ] Stimper, V., S
+00012540: 6368 c3b6 6c6b 6f70 662c 2042 2e2c 2026  ch..lkopf, B., &
+00012550: 2048 6572 6ec3 a16e 6465 7a2d 4c6f 6261   Hern..ndez-Loba
+00012560: 746f 2c20 4a2e 204d 2e20 2832 3032 3129  to, J. M. (2021)
+00012570: 2e20 5265 7361 6d70 6c69 6e67 2042 6173  . Resampling Bas
+00012580: 650a 2020 2020 4469 7374 7269 6275 7469  e.    Distributi
+00012590: 6f6e 7320 6f66 204e 6f72 6d61 6c69 7a69  ons of Normalizi
+000125a0: 6e67 2046 6c6f 7773 2e20 2832 3031 3729  ng Flows. (2017)
+000125b0: 2e20 5265 7472 6965 7665 6420 6672 6f6d  . Retrieved from
+000125c0: 2068 7474 703a 2f2f 6172 7869 762e 6f72   http://arxiv.or
+000125d0: 672f 6162 732f 3231 3130 2e31 3538 3238  g/abs/2110.15828
+000125e0: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
+000125f0: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00012600: 206d 6173 6b3a 2074 6f72 6368 2e54 656e   mask: torch.Ten
+00012610: 736f 722c 2068 6964 6465 6e5f 7369 7a65  sor, hidden_size
+00012620: 3a20 696e 7429 202d 3e20 4e6f 6e65 3a0a  : int) -> None:.
+00012630: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00012640: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+00012650: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+00012660: 2d2d 0a20 2020 2020 2020 206d 6173 6b3a  --.        mask:
+00012670: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
+00012680: 2020 2020 2020 2020 2020 5465 6e73 6f72            Tensor
+00012690: 2077 6974 6820 7a65 726f 7320 616e 6420   with zeros and 
+000126a0: 6f6e 6573 2061 6e64 2069 7473 2073 697a  ones and its siz
+000126b0: 6520 6465 7065 6e64 6520 6f6e 2074 6865  e depende on the
+000126c0: 206e 756d 6265 7220 6f66 206c 6179 6572   number of layer
+000126d0: 730a 2020 2020 2020 2020 2020 2020 616e  s.            an
+000126e0: 6420 6469 6d65 6e73 7369 6f6e 7320 7468  d dimenssions th
+000126f0: 6520 7573 6572 2072 6571 7565 7374 2e0a  e user request..
+00012700: 2020 2020 2020 2020 6869 6464 656e 5f73          hidden_s
+00012710: 697a 653a 2069 6e74 0a20 2020 2020 2020  ize: int.       
+00012720: 2020 2020 2054 6865 2073 697a 6520 6f66       The size of
+00012730: 2074 6865 206f 7574 7075 7473 2061 6e64   the outputs and
+00012740: 2069 6e70 7574 7320 7573 6564 206f 6e20   inputs used on 
+00012750: 7468 6520 696e 7465 726e 616c 206e 6f64  the internal nod
+00012760: 6573 206f 6620 7468 650a 2020 2020 2020  es of the.      
+00012770: 2020 2020 2020 7472 616e 7366 6f72 6d61        transforma
+00012780: 7469 6f6e 206c 6179 6572 2e0a 0a20 2020  tion layer...   
+00012790: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000127a0: 2073 7570 6572 2852 6561 6c4e 5650 4c61   super(RealNVPLa
+000127b0: 7965 722c 2073 656c 6629 2e5f 5f69 6e69  yer, self).__ini
+000127c0: 745f 5f28 290a 2020 2020 2020 2020 7365  t__().        se
+000127d0: 6c66 2e6d 6173 6b20 3d20 6e6e 2e50 6172  lf.mask = nn.Par
+000127e0: 616d 6574 6572 286d 6173 6b2c 2072 6571  ameter(mask, req
+000127f0: 7569 7265 735f 6772 6164 3d46 616c 7365  uires_grad=False
+00012800: 290a 2020 2020 2020 2020 7365 6c66 2e64  ).        self.d
+00012810: 696d 203d 206c 656e 286d 6173 6b29 0a0a  im = len(mask)..
+00012820: 2020 2020 2020 2020 7365 6c66 2e73 5f66          self.s_f
+00012830: 756e 6320 3d20 6e6e 2e53 6571 7565 6e74  unc = nn.Sequent
+00012840: 6961 6c28 0a20 2020 2020 2020 2020 2020  ial(.           
+00012850: 206e 6e2e 4c69 6e65 6172 2869 6e5f 6665   nn.Linear(in_fe
+00012860: 6174 7572 6573 3d73 656c 662e 6469 6d2c  atures=self.dim,
+00012870: 206f 7574 5f66 6561 7475 7265 733d 6869   out_features=hi
+00012880: 6464 656e 5f73 697a 6529 2c0a 2020 2020  dden_size),.    
+00012890: 2020 2020 2020 2020 6e6e 2e4c 6561 6b79          nn.Leaky
+000128a0: 5265 4c55 2829 2c0a 2020 2020 2020 2020  ReLU(),.        
+000128b0: 2020 2020 6e6e 2e4c 696e 6561 7228 696e      nn.Linear(in
+000128c0: 5f66 6561 7475 7265 733d 6869 6464 656e  _features=hidden
+000128d0: 5f73 697a 652c 206f 7574 5f66 6561 7475  _size, out_featu
+000128e0: 7265 733d 6869 6464 656e 5f73 697a 6529  res=hidden_size)
+000128f0: 2c0a 2020 2020 2020 2020 2020 2020 6e6e  ,.            nn
+00012900: 2e4c 6561 6b79 5265 4c55 2829 2c0a 2020  .LeakyReLU(),.  
+00012910: 2020 2020 2020 2020 2020 6e6e 2e4c 696e            nn.Lin
+00012920: 6561 7228 696e 5f66 6561 7475 7265 733d  ear(in_features=
+00012930: 6869 6464 656e 5f73 697a 652c 206f 7574  hidden_size, out
+00012940: 5f66 6561 7475 7265 733d 7365 6c66 2e64  _features=self.d
+00012950: 696d 2929 0a0a 2020 2020 2020 2020 7365  im))..        se
+00012960: 6c66 2e73 6361 6c65 203d 206e 6e2e 5061  lf.scale = nn.Pa
+00012970: 7261 6d65 7465 7228 746f 7263 682e 5465  rameter(torch.Te
+00012980: 6e73 6f72 2873 656c 662e 6469 6d29 290a  nsor(self.dim)).
+00012990: 0a20 2020 2020 2020 2073 656c 662e 745f  .        self.t_
+000129a0: 6675 6e63 203d 206e 6e2e 5365 7175 656e  func = nn.Sequen
+000129b0: 7469 616c 280a 2020 2020 2020 2020 2020  tial(.          
+000129c0: 2020 6e6e 2e4c 696e 6561 7228 696e 5f66    nn.Linear(in_f
+000129d0: 6561 7475 7265 733d 7365 6c66 2e64 696d  eatures=self.dim
+000129e0: 2c20 6f75 745f 6665 6174 7572 6573 3d68  , out_features=h
+000129f0: 6964 6465 6e5f 7369 7a65 292c 0a20 2020  idden_size),.   
+00012a00: 2020 2020 2020 2020 206e 6e2e 4c65 616b           nn.Leak
+00012a10: 7952 654c 5528 292c 0a20 2020 2020 2020  yReLU(),.       
+00012a20: 2020 2020 206e 6e2e 4c69 6e65 6172 2869       nn.Linear(i
+00012a30: 6e5f 6665 6174 7572 6573 3d68 6964 6465  n_features=hidde
+00012a40: 6e5f 7369 7a65 2c20 6f75 745f 6665 6174  n_size, out_feat
+00012a50: 7572 6573 3d68 6964 6465 6e5f 7369 7a65  ures=hidden_size
+00012a60: 292c 0a20 2020 2020 2020 2020 2020 206e  ),.            n
+00012a70: 6e2e 4c65 616b 7952 654c 5528 292c 0a20  n.LeakyReLU(),. 
+00012a80: 2020 2020 2020 2020 2020 206e 6e2e 4c69             nn.Li
+00012a90: 6e65 6172 2869 6e5f 6665 6174 7572 6573  near(in_features
+00012aa0: 3d68 6964 6465 6e5f 7369 7a65 2c20 6f75  =hidden_size, ou
+00012ab0: 745f 6665 6174 7572 6573 3d73 656c 662e  t_features=self.
+00012ac0: 6469 6d29 290a 0a20 2020 2064 6566 2066  dim))..    def f
+00012ad0: 6f72 7761 7264 2873 656c 662c 2078 3a20  orward(self, x: 
+00012ae0: 5365 7175 656e 6365 2920 2d3e 2054 7570  Sequence) -> Tup
+00012af0: 6c65 5b74 6f72 6368 2e54 656e 736f 722c  le[torch.Tensor,
+00012b00: 2074 6f72 6368 2e54 656e 736f 725d 3a0a   torch.Tensor]:.
+00012b10: 2020 2020 2020 2020 2222 2246 6f72 7761          """Forwa
+00012b20: 7264 2070 6173 732e 0a0a 2020 2020 2020  rd pass...      
+00012b30: 2020 5468 6973 2070 6172 7469 6375 6c61    This particula
+00012b40: 7220 7472 616e 7366 6f72 6d61 7469 6f6e  r transformation
+00012b50: 2069 7320 7265 7072 6573 656e 7465 6420   is represented 
+00012b60: 6279 2074 6865 2066 6f6c 6c6f 7769 6e67  by the following
+00012b70: 2066 756e 6374 696f 6e3a 0a20 2020 2020   function:.     
+00012b80: 2020 2079 203d 2078 202b 2028 3120 2d20     y = x + (1 - 
+00012b90: 7829 202a 2065 7870 2820 7328 7829 2920  x) * exp( s(x)) 
+00012ba0: 2b20 7428 7829 2c20 7768 6572 6520 7420  + t(x), where t 
+00012bb0: 616e 6420 7320 6e65 6564 7320 616e 2061  and s needs an a
+00012bc0: 6374 6976 6174 696f 6e0a 2020 2020 2020  ctivation.      
+00012bd0: 2020 6675 6e63 7469 6f6e 2e20 5468 6973    function. This
+00012be0: 2063 6c61 7373 2061 6c73 6f20 7265 7475   class also retu
+00012bf0: 726e 7320 7468 6520 6c6f 6761 7269 7468  rns the logarith
+00012c00: 6d20 6f66 2074 6865 206a 6163 6f62 6961  m of the jacobia
+00012c10: 6e73 0a20 2020 2020 2020 2064 6574 6572  ns.        deter
+00012c20: 6d69 6e61 6e74 2077 6869 6368 2069 7320  minant which is 
+00012c30: 7573 6566 756c 2077 6865 6e20 696e 7665  useful when inve
+00012c40: 7274 2061 2074 7261 6e73 666f 726d 6174  rt a transformat
+00012c50: 696f 6e20 616e 6420 636f 6d70 7574 650a  ion and compute.
+00012c60: 2020 2020 2020 2020 7468 6520 7072 6f62          the prob
+00012c70: 6162 696c 6974 7920 6f66 2074 6865 2074  ability of the t
+00012c80: 7261 6e73 666f 726d 6174 696f 6e2e 0a0a  ransformation...
+00012c90: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+00012ca0: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+00012cb0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7820  -----.        x 
+00012cc0: 3a20 5365 7175 656e 6365 0a20 2020 2020  : Sequence.     
+00012cd0: 2020 2020 2020 2054 656e 736f 7220 7361         Tensor sa
+00012ce0: 6d70 6c65 2077 6974 6820 7468 6520 696e  mple with the in
+00012cf0: 6974 6961 6c20 6469 7374 7269 6275 7469  itial distributi
+00012d00: 6f6e 2064 6174 6120 7768 6963 6820 7769  on data which wi
+00012d10: 6c6c 2070 6173 7320 696e 746f 0a20 2020  ll pass into.   
+00012d20: 2020 2020 2020 2020 2074 6865 206e 6f72           the nor
+00012d30: 6d61 6c69 7a69 6e67 2061 6c67 6f72 6974  malizing algorit
+00012d40: 686d 0a0a 2020 2020 2020 2020 5265 7475  hm..        Retu
+00012d50: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
+00012d60: 2d2d 2d0a 2020 2020 2020 2020 7920 3a20  ---.        y : 
+00012d70: 746f 7263 682e 5465 6e73 6f72 0a20 2020  torch.Tensor.   
+00012d80: 2020 2020 2020 2020 2054 7261 6e73 666f           Transfo
+00012d90: 726d 6564 2074 656e 736f 7220 6163 636f  rmed tensor acco
+00012da0: 7264 696e 6720 746f 2052 6561 6c20 4e56  rding to Real NV
+00012db0: 5020 6c61 7965 7220 7769 7468 2074 6865  P layer with the
+00012dc0: 2073 6861 7065 206f 6620 2778 272e 0a20   shape of 'x'.. 
+00012dd0: 2020 2020 2020 206c 6f67 5f64 6574 5f6a         log_det_j
+00012de0: 6163 6f62 6961 6e20 3a20 746f 7263 682e  acobian : torch.
+00012df0: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
+00012e00: 2020 2054 656e 736f 7220 7768 6963 6820     Tensor which 
+00012e10: 7265 7072 6573 656e 7473 2074 6865 2069  represents the i
+00012e20: 6e66 6f20 6162 6f75 7420 7468 6520 6465  nfo about the de
+00012e30: 7669 6174 696f 6e20 6f66 2074 6865 2069  viation of the i
+00012e40: 6e69 7469 616c 0a20 2020 2020 2020 2020  nitial.         
+00012e50: 2020 2061 6e64 2074 6172 6765 7420 6469     and target di
+00012e60: 7374 7269 6275 7469 6f6e 2e0a 0a20 2020  stribution...   
+00012e70: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00012e80: 2078 5f6d 6173 6b20 3d20 7820 2a20 7365   x_mask = x * se
+00012e90: 6c66 2e6d 6173 6b0a 2020 2020 2020 2020  lf.mask.        
+00012ea0: 7320 3d20 7365 6c66 2e73 5f66 756e 6328  s = self.s_func(
+00012eb0: 785f 6d61 736b 2920 2a20 7365 6c66 2e73  x_mask) * self.s
+00012ec0: 6361 6c65 0a20 2020 2020 2020 2074 203d  cale.        t =
+00012ed0: 2073 656c 662e 745f 6675 6e63 2878 5f6d   self.t_func(x_m
+00012ee0: 6173 6b29 0a0a 2020 2020 2020 2020 7920  ask)..        y 
+00012ef0: 3d20 785f 6d61 736b 202b 2028 3120 2d20  = x_mask + (1 - 
+00012f00: 7365 6c66 2e6d 6173 6b29 202a 2028 7820  self.mask) * (x 
+00012f10: 2a20 746f 7263 682e 6578 7028 7329 202b  * torch.exp(s) +
+00012f20: 2074 290a 0a20 2020 2020 2020 206c 6f67   t)..        log
+00012f30: 5f64 6574 5f6a 6163 6f62 6961 6e20 3d20  _det_jacobian = 
+00012f40: 2828 3120 2d20 7365 6c66 2e6d 6173 6b29  ((1 - self.mask)
+00012f50: 202a 2073 292e 7375 6d28 2d31 290a 2020   * s).sum(-1).  
+00012f60: 2020 2020 2020 7265 7475 726e 2079 2c20        return y, 
+00012f70: 6c6f 675f 6465 745f 6a61 636f 6269 616e  log_det_jacobian
+00012f80: 0a0a 2020 2020 6465 6620 696e 7665 7273  ..    def invers
+00012f90: 6528 7365 6c66 2c20 793a 2053 6571 7565  e(self, y: Seque
+00012fa0: 6e63 6529 202d 3e20 5475 706c 655b 746f  nce) -> Tuple[to
+00012fb0: 7263 682e 5465 6e73 6f72 2c20 746f 7263  rch.Tensor, torc
+00012fc0: 682e 5465 6e73 6f72 5d3a 0a20 2020 2020  h.Tensor]:.     
+00012fd0: 2020 2022 2222 2049 6e76 6572 7365 2070     """ Inverse p
+00012fe0: 6173 730a 0a20 2020 2020 2020 2054 6869  ass..        Thi
+00012ff0: 7320 636c 6173 7320 7065 7266 6f72 6d73  s class performs
+00013000: 2074 6865 2069 6e76 6572 7365 206f 6620   the inverse of 
+00013010: 7468 6520 7072 6576 696f 7573 206d 6574  the previous met
+00013020: 686f 6420 2866 6f72 6d77 6172 6429 2e0a  hod (formward)..
+00013030: 2020 2020 2020 2020 416c 736f 2c20 7468          Also, th
+00013040: 6973 206d 6574 6568 6f64 2072 6574 7572  is metehod retur
+00013050: 6e73 2074 6865 206c 6f67 6172 6974 686d  ns the logarithm
+00013060: 206f 6620 7468 6520 6a61 636f 6269 616e   of the jacobian
+00013070: 7320 6465 7465 726d 696e 616e 740a 2020  s determinant.  
+00013080: 2020 2020 2020 7768 6963 6820 6973 2075        which is u
+00013090: 7365 6675 6c20 746f 2063 6f6d 7075 7465  seful to compute
+000130a0: 2074 6865 206c 6561 726e 6561 626c 6520   the learneable 
+000130b0: 6665 6174 7572 6573 206f 6620 7461 7267  features of targ
+000130c0: 6574 2064 6973 7472 6962 7574 696f 6e2e  et distribution.
+000130d0: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
+000130e0: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
+000130f0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00013100: 7920 3a20 5365 7175 656e 6365 0a20 2020  y : Sequence.   
+00013110: 2020 2020 2020 2020 2054 656e 736f 7220           Tensor 
+00013120: 7361 6d70 6c65 2077 6974 6820 7472 616e  sample with tran
+00013130: 7366 6f72 6d65 6420 6469 7374 7269 6275  sformed distribu
+00013140: 7469 6f6e 2064 6174 6120 7768 6963 6820  tion data which 
+00013150: 7769 6c6c 2062 6520 7573 6564 2069 6e0a  will be used in.
+00013160: 2020 2020 2020 2020 2020 2020 7468 6520              the 
+00013170: 6e6f 726d 616c 697a 696e 6720 616c 676f  normalizing algo
+00013180: 7269 7468 6d20 696e 7665 7273 6520 7061  rithm inverse pa
+00013190: 7373 2e0a 0a20 2020 2020 2020 2052 6574  ss...        Ret
+000131a0: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
+000131b0: 2d2d 2d2d 0a20 2020 2020 2020 2078 203a  ----.        x :
+000131c0: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
+000131d0: 2020 2020 2020 2020 2020 5472 616e 7366            Transf
+000131e0: 6f72 6d65 6420 7465 6e73 6f72 2061 6363  ormed tensor acc
+000131f0: 6f72 6469 6e67 2074 6f20 5265 616c 204e  ording to Real N
+00013200: 5650 206c 6179 6572 2077 6974 6820 7468  VP layer with th
+00013210: 6520 7368 6170 6520 6f66 2027 7927 2e0a  e shape of 'y'..
+00013220: 2020 2020 2020 2020 696e 7665 7273 655f          inverse_
+00013230: 6c6f 675f 6465 745f 6a61 636f 6269 616e  log_det_jacobian
+00013240: 203a 2074 6f72 6368 2e54 656e 736f 720a   : torch.Tensor.
+00013250: 2020 2020 2020 2020 2020 2020 5465 6e73              Tens
+00013260: 6f72 2077 6869 6368 2072 6570 7265 7365  or which represe
+00013270: 6e74 7320 7468 6520 696e 666f 726d 6174  nts the informat
+00013280: 696f 6e20 6f66 2074 6865 2064 6576 6961  ion of the devia
+00013290: 7469 6f6e 206f 6620 7468 6520 696e 6974  tion of the init
+000132a0: 6961 6c0a 2020 2020 2020 2020 2020 2020  ial.            
+000132b0: 616e 6420 7461 7267 6574 2064 6973 7472  and target distr
+000132c0: 6962 7574 696f 6e2e 0a0a 2020 2020 2020  ibution...      
+000132d0: 2020 2222 220a 2020 2020 2020 2020 795f    """.        y_
+000132e0: 6d61 736b 203d 2079 202a 2073 656c 662e  mask = y * self.
+000132f0: 6d61 736b 0a20 2020 2020 2020 2073 203d  mask.        s =
+00013300: 2073 656c 662e 735f 6675 6e63 2879 5f6d   self.s_func(y_m
+00013310: 6173 6b29 202a 2073 656c 662e 7363 616c  ask) * self.scal
+00013320: 650a 2020 2020 2020 2020 7420 3d20 7365  e.        t = se
+00013330: 6c66 2e74 5f66 756e 6328 795f 6d61 736b  lf.t_func(y_mask
+00013340: 290a 0a20 2020 2020 2020 2078 203d 2079  )..        x = y
+00013350: 5f6d 6173 6b20 2b20 2831 202d 2073 656c  _mask + (1 - sel
+00013360: 662e 6d61 736b 2920 2a20 2879 202d 2074  f.mask) * (y - t
+00013370: 2920 2a20 746f 7263 682e 6578 7028 2d73  ) * torch.exp(-s
+00013380: 290a 0a20 2020 2020 2020 2069 6e76 6572  )..        inver
+00013390: 7365 5f6c 6f67 5f64 6574 5f6a 6163 6f62  se_log_det_jacob
+000133a0: 6961 6e20 3d20 2828 3120 2d20 7365 6c66  ian = ((1 - self
+000133b0: 2e6d 6173 6b29 202a 202d 7329 2e73 756d  .mask) * -s).sum
+000133c0: 282d 3129 0a0a 2020 2020 2020 2020 7265  (-1)..        re
+000133d0: 7475 726e 2078 2c20 696e 7665 7273 655f  turn x, inverse_
+000133e0: 6c6f 675f 6465 745f 6a61 636f 6269 616e  log_det_jacobian
+000133f0: 0a0a 0a63 6c61 7373 204e 6569 6768 626f  ...class Neighbo
+00013400: 724c 6973 7428 6e6e 2e4d 6f64 756c 6529  rList(nn.Module)
+00013410: 3a0a 2020 2020 2222 2243 6f6d 7075 7465  :.    """Compute
+00013420: 7320 6120 6e65 6967 6862 6f72 2d6c 6973  s a neighbor-lis
+00013430: 7420 696e 2050 7954 6f72 6368 2e0a 0a20  t in PyTorch... 
+00013440: 2020 204e 6569 6768 626f 722d 6c69 7374     Neighbor-list
+00013450: 7320 2861 6c73 6f20 6361 6c6c 6564 2056  s (also called V
+00013460: 6572 6c65 7420 4c69 7374 7329 2061 7265  erlet Lists) are
+00013470: 2061 2074 6f6f 6c20 666f 7220 6772 6f75   a tool for grou
+00013480: 7069 6e67 0a20 2020 2061 746f 6d73 2077  ping.    atoms w
+00013490: 6869 6368 2061 7265 2063 6c6f 7365 2074  hich are close t
+000134a0: 6f20 6561 6368 206f 7468 6572 2073 7061  o each other spa
+000134b0: 7469 616c 6c79 2e20 5468 6973 206c 6179  tially. This lay
+000134c0: 6572 2063 6f6d 7075 7465 7320 610a 2020  er computes a.  
+000134d0: 2020 4e65 6967 6862 6f72 204c 6973 7420    Neighbor List 
+000134e0: 6672 6f6d 2061 2070 726f 7669 6465 6420  from a provided 
+000134f0: 7465 6e73 6f72 206f 6620 6174 6f6d 6963  tensor of atomic
+00013500: 2063 6f6f 7264 696e 6174 6573 2e20 596f   coordinates. Yo
+00013510: 7520 6361 6e0a 2020 2020 7468 696e 6b20  u can.    think 
+00013520: 6f66 2074 6869 7320 6173 2061 2067 656e  of this as a gen
+00013530: 6572 616c 2022 6b2d 6d65 616e 7322 206c  eral "k-means" l
+00013540: 6179 6572 2c20 6275 7420 6f70 7469 6d69  ayer, but optimi
+00013550: 7a65 6420 666f 7220 7468 650a 2020 2020  zed for the.    
+00013560: 6361 7365 2060 6b3d 3d33 602e 0a0a 2020  case `k==3`...  
+00013570: 2020 4578 616d 706c 6573 0a20 2020 202d    Examples.    -
+00013580: 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20  -------.    >>> 
+00013590: 4e5f 6174 6f6d 7320 3d20 350a 2020 2020  N_atoms = 5.    
+000135a0: 3e3e 3e20 7374 6172 7420 3d20 300a 2020  >>> start = 0.  
+000135b0: 2020 3e3e 3e20 7374 6f70 203d 2031 320a    >>> stop = 12.
+000135c0: 2020 2020 3e3e 3e20 6e62 725f 6375 746f      >>> nbr_cuto
+000135d0: 6666 203d 2033 0a20 2020 203e 3e3e 206e  ff = 3.    >>> n
+000135e0: 6469 6d20 3d20 330a 2020 2020 3e3e 3e20  dim = 3.    >>> 
+000135f0: 4d5f 6e62 7273 203d 2032 0a20 2020 203e  M_nbrs = 2.    >
+00013600: 3e3e 2063 6f6f 7264 7320 3d20 7374 6172  >> coords = star
+00013610: 7420 2b20 6e70 2e72 616e 646f 6d2e 7261  t + np.random.ra
+00013620: 6e64 284e 5f61 746f 6d73 2c20 6e64 696d  nd(N_atoms, ndim
+00013630: 2920 2a20 2873 746f 7020 2d20 7374 6172  ) * (stop - star
+00013640: 7429 0a20 2020 203e 3e3e 2063 6f6f 7264  t).    >>> coord
+00013650: 7320 3d20 746f 7263 682e 6173 5f74 656e  s = torch.as_ten
+00013660: 736f 7228 636f 6f72 6473 2c20 6474 7970  sor(coords, dtyp
+00013670: 653d 746f 7263 682e 666c 6f61 7429 0a20  e=torch.float). 
+00013680: 2020 203e 3e3e 206c 6179 6572 203d 204e     >>> layer = N
+00013690: 6569 6768 626f 724c 6973 7428 4e5f 6174  eighborList(N_at
+000136a0: 6f6d 732c 204d 5f6e 6272 732c 206e 6469  oms, M_nbrs, ndi
+000136b0: 6d2c 206e 6272 5f63 7574 6f66 662c 2073  m, nbr_cutoff, s
+000136c0: 7461 7274 2c0a 2020 2020 2e2e 2e20 2020  tart,.    ...   
+000136d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000136e0: 2020 2073 746f 7029 0a20 2020 203e 3e3e     stop).    >>>
+000136f0: 2072 6573 756c 7420 3d20 6c61 7965 7228   result = layer(
+00013700: 636f 6f72 6473 290a 2020 2020 3e3e 3e20  coords).    >>> 
+00013710: 7265 7375 6c74 2e73 6861 7065 0a20 2020  result.shape.   
+00013720: 2074 6f72 6368 2e53 697a 6528 5b35 2c20   torch.Size([5, 
+00013730: 325d 290a 0a20 2020 2054 4f44 4f28 7262  2])..    TODO(rb
+00013740: 6861 7261 7468 293a 204d 616b 6520 7468  harath): Make th
+00013750: 6973 206c 6179 6572 2073 7570 706f 7274  is layer support
+00013760: 2062 6174 6368 696e 672e 0a20 2020 2022   batching..    "
+00013770: 2222 0a0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
+00013780: 6974 5f5f 2873 656c 662c 204e 5f61 746f  it__(self, N_ato
+00013790: 6d73 3a20 696e 742c 204d 5f6e 6272 733a  ms: int, M_nbrs:
+000137a0: 2069 6e74 2c20 6e64 696d 3a20 696e 742c   int, ndim: int,
+000137b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000137c0: 2020 6e62 725f 6375 746f 6666 3a20 556e    nbr_cutoff: Un
+000137d0: 696f 6e5b 696e 742c 0a20 2020 2020 2020  ion[int,.       
+000137e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000137f0: 2020 2020 2020 2020 2020 2020 666c 6f61              floa
+00013800: 745d 2c20 7374 6172 743a 2069 6e74 2c20  t], start: int, 
+00013810: 7374 6f70 3a20 696e 742c 202a 2a6b 7761  stop: int, **kwa
+00013820: 7267 7329 3a0a 2020 2020 2020 2020 2222  rgs):.        ""
+00013830: 220a 2020 2020 2020 2020 5061 7261 6d65  ".        Parame
+00013840: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
+00013850: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00013860: 4e5f 6174 6f6d 733a 2069 6e74 0a20 2020  N_atoms: int.   
+00013870: 2020 2020 2020 2020 204d 6178 696d 756d           Maximum
+00013880: 206e 756d 6265 7220 6f66 2061 746f 6d73   number of atoms
+00013890: 2074 6869 7320 6c61 7965 7220 7769 6c6c   this layer will
+000138a0: 206e 6569 6768 626f 722d 6c69 7374 2e0a   neighbor-list..
+000138b0: 2020 2020 2020 2020 4d5f 6e62 7273 3a20          M_nbrs: 
+000138c0: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
+000138d0: 4d61 7869 6d75 6d20 6e75 6d62 6572 206f  Maximum number o
+000138e0: 6620 7370 6174 6961 6c20 6e65 6967 6862  f spatial neighb
+000138f0: 6f72 7320 706f 7373 6962 6c65 2066 6f72  ors possible for
+00013900: 2061 746f 6d2e 0a20 2020 2020 2020 206e   atom..        n
+00013910: 6469 6d3a 2069 6e74 0a20 2020 2020 2020  dim: int.       
+00013920: 2020 2020 2044 696d 656e 7369 6f6e 616c       Dimensional
+00013930: 6974 7920 6f66 2073 7061 6365 2061 746f  ity of space ato
+00013940: 6d73 206c 6976 6520 696e 2e20 2854 7970  ms live in. (Typ
+00013950: 6963 616c 6c79 2033 442c 2062 7574 2073  ically 3D, but s
+00013960: 6f6d 6574 696d 6573 2077 696c 6c0a 2020  ometimes will.  
+00013970: 2020 2020 2020 2020 2020 7761 6e74 2074            want t
+00013980: 6f20 7573 6520 6869 6768 6572 2064 696d  o use higher dim
+00013990: 656e 7369 6f6e 616c 2064 6573 6372 6970  ensional descrip
+000139a0: 746f 7273 2066 6f72 2061 746f 6d73 292e  tors for atoms).
+000139b0: 0a20 2020 2020 2020 206e 6272 5f63 7574  .        nbr_cut
+000139c0: 6f66 663a 2069 6e74 206f 7220 666c 6f61  off: int or floa
+000139d0: 740a 2020 2020 2020 2020 2020 2020 4c65  t.            Le
+000139e0: 6e67 7468 2069 6e20 416e 6773 7472 6f6d  ngth in Angstrom
+000139f0: 7320 283f 2920 6174 2077 6869 6368 2061  s (?) at which a
+00013a00: 746f 6d20 626f 7865 7320 6172 6520 6772  tom boxes are gr
+00013a10: 6964 6465 642e 0a20 2020 2020 2020 2073  idded..        s
+00013a20: 7461 7274 3a20 696e 740a 2020 2020 2020  tart: int.      
+00013a30: 2020 2020 2020 5374 6172 7420 6f66 2072        Start of r
+00013a40: 616e 6765 2066 6f72 2074 6865 2062 6f78  ange for the box
+00013a50: 2069 6e20 7768 6963 6820 7468 6520 6c6f   in which the lo
+00013a60: 6361 7469 6f6e 7320 6f66 2061 6c6c 2067  cations of all g
+00013a70: 7269 6420 706f 696e 7473 2077 696c 6c20  rid points will 
+00013a80: 6265 2063 616c 6375 6c61 7465 6420 696e  be calculated in
+00013a90: 2060 7365 6c66 2e67 6574 5f63 656c 6c73   `self.get_cells
+00013aa0: 2829 602e 0a20 2020 2020 2020 2073 746f  ()`..        sto
+00013ab0: 703a 2069 6e74 0a20 2020 2020 2020 2020  p: int.         
+00013ac0: 2020 2045 6e64 206f 6620 7261 6e67 6520     End of range 
+00013ad0: 666f 7220 7468 6520 626f 7820 696e 2077  for the box in w
+00013ae0: 6869 6368 2074 6865 206c 6f63 6174 696f  hich the locatio
+00013af0: 6e73 206f 6620 616c 6c20 6772 6964 2070  ns of all grid p
+00013b00: 6f69 6e74 7320 7769 6c6c 2062 6520 6361  oints will be ca
+00013b10: 6c63 756c 6174 6564 2069 6e20 6073 656c  lculated in `sel
+00013b20: 662e 6765 745f 6365 6c6c 7328 2960 2e0a  f.get_cells()`..
+00013b30: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00013b40: 2020 2020 7375 7065 7228 4e65 6967 6862      super(Neighb
+00013b50: 6f72 4c69 7374 2c20 7365 6c66 292e 5f5f  orList, self).__
+00013b60: 696e 6974 5f5f 282a 2a6b 7761 7267 7329  init__(**kwargs)
+00013b70: 0a20 2020 2020 2020 2073 656c 662e 4e5f  .        self.N_
+00013b80: 6174 6f6d 7320 3d20 4e5f 6174 6f6d 730a  atoms = N_atoms.
+00013b90: 2020 2020 2020 2020 7365 6c66 2e4d 5f6e          self.M_n
+00013ba0: 6272 7320 3d20 4d5f 6e62 7273 0a20 2020  brs = M_nbrs.   
+00013bb0: 2020 2020 2073 656c 662e 6e64 696d 203d       self.ndim =
+00013bc0: 206e 6469 6d0a 2020 2020 2020 2020 2320   ndim.        # 
+00013bd0: 4e75 6d62 6572 206f 6620 6772 6964 2063  Number of grid c
+00013be0: 656c 6c73 0a20 2020 2020 2020 206e 5f63  ells.        n_c
+00013bf0: 656c 6c73 203d 2069 6e74 2828 2873 746f  ells = int(((sto
+00013c00: 7020 2d20 7374 6172 7429 202f 206e 6272  p - start) / nbr
+00013c10: 5f63 7574 6f66 6629 2a2a 6e64 696d 290a  _cutoff)**ndim).
+00013c20: 2020 2020 2020 2020 7365 6c66 2e6e 5f63          self.n_c
+00013c30: 656c 6c73 203d 206e 5f63 656c 6c73 0a20  ells = n_cells. 
+00013c40: 2020 2020 2020 2073 656c 662e 6e62 725f         self.nbr_
+00013c50: 6375 746f 6666 203d 206e 6272 5f63 7574  cutoff = nbr_cut
+00013c60: 6f66 660a 2020 2020 2020 2020 7365 6c66  off.        self
+00013c70: 2e73 7461 7274 203d 2073 7461 7274 0a20  .start = start. 
+00013c80: 2020 2020 2020 2073 656c 662e 7374 6f70         self.stop
+00013c90: 203d 2073 746f 700a 0a20 2020 2064 6566   = stop..    def
+00013ca0: 205f 5f72 6570 725f 5f28 7365 6c66 2920   __repr__(self) 
+00013cb0: 2d3e 2073 7472 3a0a 2020 2020 2020 2020  -> str:.        
+00013cc0: 7265 7475 726e 2028 0a20 2020 2020 2020  return (.       
+00013cd0: 2020 2020 2066 277b 7365 6c66 2e5f 5f63       f'{self.__c
+00013ce0: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+00013cf0: 284e 5f61 746f 6d73 3d7b 7365 6c66 2e4e  (N_atoms={self.N
+00013d00: 5f61 746f 6d73 7d2c 204d 5f6e 6272 733d  _atoms}, M_nbrs=
+00013d10: 7b73 656c 662e 4d5f 6e62 7273 7d2c 206e  {self.M_nbrs}, n
+00013d20: 6469 6d3d 7b73 656c 662e 6e64 696d 7d2c  dim={self.ndim},
+00013d30: 206e 5f63 656c 6c73 3d7b 7365 6c66 2e6e   n_cells={self.n
+00013d40: 5f63 656c 6c73 7d2c 206e 6272 5f63 7574  _cells}, nbr_cut
+00013d50: 6f66 663d 7b73 656c 662e 6e62 725f 6375  off={self.nbr_cu
+00013d60: 746f 6666 7d2c 2073 7461 7274 3d7b 7365  toff}, start={se
+00013d70: 6c66 2e73 7461 7274 7d2c 2073 746f 703d  lf.start}, stop=
+00013d80: 7b73 656c 662e 7374 6f70 7d29 270a 2020  {self.stop})'.  
+00013d90: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+00013da0: 2066 6f72 7761 7264 2873 656c 662c 2069   forward(self, i
+00013db0: 6e70 7574 733a 2074 6f72 6368 2e54 656e  nputs: torch.Ten
+00013dc0: 736f 7229 202d 3e20 746f 7263 682e 5465  sor) -> torch.Te
+00013dd0: 6e73 6f72 3a0a 2020 2020 2020 2020 2222  nsor:.        ""
+00013de0: 2249 6e76 6f6b 6573 2074 6869 7320 6c61  "Invokes this la
+00013df0: 7965 722e 0a0a 2020 2020 2020 2020 5061  yer...        Pa
+00013e00: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+00013e10: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00013e20: 2020 2020 696e 7075 7473 3a20 746f 7263      inputs: torc
+00013e30: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
+00013e40: 2020 2020 2053 6861 7065 2028 6e75 6d5f       Shape (num_
+00013e50: 6174 6f6d 732c 206e 6469 6d29 0a0a 2020  atoms, ndim)..  
+00013e60: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
+00013e70: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
+00013e80: 2020 2020 2020 6e65 6967 6862 6f72 5f6c        neighbor_l
+00013e90: 6973 743a 2074 6f72 6368 2e54 656e 736f  ist: torch.Tenso
+00013ea0: 720a 2020 2020 2020 2020 2020 2020 5368  r.            Sh
+00013eb0: 6170 6520 6028 4e5f 6174 6f6d 732c 204d  ape `(N_atoms, M
+00013ec0: 5f6e 6272 7329 600a 2020 2020 2020 2020  _nbrs)`.        
+00013ed0: 2222 220a 2020 2020 2020 2020 6966 2069  """.        if i
+00013ee0: 7369 6e73 7461 6e63 6528 696e 7075 7473  sinstance(inputs
+00013ef0: 2c20 5365 7175 656e 6365 436f 6c6c 6563  , SequenceCollec
+00013f00: 7469 6f6e 293a 0a20 2020 2020 2020 2020  tion):.         
+00013f10: 2020 2069 6620 6c65 6e28 696e 7075 7473     if len(inputs
+00013f20: 2920 213d 2031 3a0a 2020 2020 2020 2020  ) != 1:.        
+00013f30: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00013f40: 6c75 6545 7272 6f72 2822 4e65 6967 6862  lueError("Neighb
+00013f50: 6f72 4c69 7374 2063 616e 206f 6e6c 7920  orList can only 
+00013f60: 6861 7665 206f 6e65 2069 6e70 7574 2229  have one input")
+00013f70: 0a20 2020 2020 2020 2020 2020 2069 6e70  .            inp
+00013f80: 7574 7320 3d20 696e 7075 7473 5b30 5d0a  uts = inputs[0].
+00013f90: 2020 2020 2020 2020 6966 206c 656e 2869          if len(i
+00013fa0: 6e70 7574 732e 7368 6170 6529 2021 3d20  nputs.shape) != 
+00013fb0: 323a 0a20 2020 2020 2020 2020 2020 2023  2:.            #
+00013fc0: 2054 4f44 4f28 7262 6861 7261 7468 293a   TODO(rbharath):
+00013fd0: 2053 7570 706f 7274 2062 6174 6368 696e   Support batchin
+00013fe0: 670a 2020 2020 2020 2020 2020 2020 7261  g.            ra
+00013ff0: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
+00014000: 5061 7265 6e74 2074 656e 736f 7220 6d75  Parent tensor mu
+00014010: 7374 2062 6520 286e 756d 5f61 746f 6d73  st be (num_atoms
+00014020: 2c20 6e64 756d 2922 290a 2020 2020 2020  , ndum)").      
+00014030: 2020 7265 7475 726e 2073 656c 662e 636f    return self.co
+00014040: 6d70 7574 655f 6e62 725f 6c69 7374 2869  mpute_nbr_list(i
+00014050: 6e70 7574 7329 0a0a 2020 2020 6465 6620  nputs)..    def 
+00014060: 636f 6d70 7574 655f 6e62 725f 6c69 7374  compute_nbr_list
+00014070: 2873 656c 662c 2063 6f6f 7264 733a 2074  (self, coords: t
+00014080: 6f72 6368 2e54 656e 736f 7229 202d 3e20  orch.Tensor) -> 
+00014090: 746f 7263 682e 5465 6e73 6f72 3a0a 2020  torch.Tensor:.  
+000140a0: 2020 2020 2020 2222 2247 6574 2063 6c6f        """Get clo
+000140b0: 7365 7374 206e 6569 6768 626f 7273 2066  sest neighbors f
+000140c0: 6f72 2061 746f 6d73 2e0a 0a20 2020 2020  or atoms...     
+000140d0: 2020 204e 6565 6473 2074 6f20 6861 6e64     Needs to hand
+000140e0: 6c65 2070 6164 6469 6e67 2066 6f72 2061  le padding for a
+000140f0: 746f 6d73 2077 6974 6820 6e6f 206e 6569  toms with no nei
+00014100: 6768 626f 7273 2e0a 0a20 2020 2020 2020  ghbors...       
+00014110: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00014120: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00014130: 2020 2020 2020 2063 6f6f 7264 733a 2074         coords: t
+00014140: 6f72 6368 2e54 656e 736f 720a 2020 2020  orch.Tensor.    
+00014150: 2020 2020 2020 2020 5368 6170 6520 284e          Shape (N
+00014160: 5f61 746f 6d73 2c20 6e64 696d 290a 0a20  _atoms, ndim).. 
+00014170: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
+00014180: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
+00014190: 2020 2020 2020 206e 6272 5f6c 6973 743a         nbr_list:
+000141a0: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
+000141b0: 2020 2020 2020 2020 2020 5368 6170 6520            Shape 
+000141c0: 284e 5f61 746f 6d73 2c20 4d5f 6e62 7273  (N_atoms, M_nbrs
+000141d0: 2920 6f66 2061 746f 6d20 696e 6469 6365  ) of atom indice
+000141e0: 730a 2020 2020 2020 2020 2222 220a 2020  s.        """.  
+000141f0: 2020 2020 2020 2320 5368 6170 6520 286e        # Shape (n
+00014200: 5f63 656c 6c73 2c20 6e64 696d 290a 2020  _cells, ndim).  
+00014210: 2020 2020 2020 6365 6c6c 7320 3d20 7365        cells = se
+00014220: 6c66 2e67 6574 5f63 656c 6c73 2829 0a0a  lf.get_cells()..
+00014230: 2020 2020 2020 2020 2320 4c69 7374 206f          # List o
+00014240: 6620 6c65 6e67 7468 204e 5f61 746f 6d73  f length N_atoms
+00014250: 2c20 6561 6368 2065 6c65 6d65 6e74 206f  , each element o
+00014260: 6620 6469 6666 6572 656e 7420 6c65 6e67  f different leng
+00014270: 7468 2075 6e69 7175 6573 5f69 0a20 2020  th uniques_i.   
+00014280: 2020 2020 206e 6272 7320 3d20 7365 6c66       nbrs = self
+00014290: 2e67 6574 5f61 746f 6d73 5f69 6e5f 6e62  .get_atoms_in_nb
+000142a0: 7273 2863 6f6f 7264 732c 2063 656c 6c73  rs(coords, cells
+000142b0: 290a 2020 2020 2020 2020 7061 6464 696e  ).        paddin
+000142c0: 6720 3d20 746f 7263 682e 6675 6c6c 2828  g = torch.full((
+000142d0: 7365 6c66 2e4d 5f6e 6272 732c 292c 202d  self.M_nbrs,), -
+000142e0: 3129 0a20 2020 2020 2020 2070 6164 6465  1).        padde
+000142f0: 645f 6e62 7273 203d 205b 0a20 2020 2020  d_nbrs = [.     
+00014300: 2020 2020 2020 2074 6f72 6368 2e63 6f6e         torch.con
+00014310: 6361 7428 5b75 6e69 7175 655f 6e62 7273  cat([unique_nbrs
+00014320: 2c20 7061 6464 696e 675d 2c20 3029 2066  , padding], 0) f
+00014330: 6f72 2075 6e69 7175 655f 6e62 7273 2069  or unique_nbrs i
+00014340: 6e20 6e62 7273 0a20 2020 2020 2020 205d  n nbrs.        ]
+00014350: 0a0a 2020 2020 2020 2020 2320 4c69 7374  ..        # List
+00014360: 206f 6620 6c65 6e67 7468 204e 5f61 746f   of length N_ato
+00014370: 6d73 2c20 6561 6368 2065 6c65 6d65 6e74  ms, each element
+00014380: 206f 6620 6469 6666 6572 656e 7420 6c65   of different le
+00014390: 6e67 7468 2075 6e69 7175 6573 5f69 0a20  ngth uniques_i. 
+000143a0: 2020 2020 2020 2023 204c 6973 7420 6f66         # List of
+000143b0: 206c 656e 6774 6820 4e5f 6174 6f6d 732c   length N_atoms,
+000143c0: 2065 6163 6820 6120 7465 6e73 6f72 206f   each a tensor o
+000143d0: 6620 7368 6170 650a 2020 2020 2020 2020  f shape.        
+000143e0: 2320 2875 6e69 7175 6573 5f69 2c20 6e64  # (uniques_i, nd
+000143f0: 696d 290a 2020 2020 2020 2020 6e62 725f  im).        nbr_
+00014400: 636f 6f72 6473 203d 205b 0a20 2020 2020  coords = [.     
+00014410: 2020 2020 2020 2074 6f72 6368 2e69 6e64         torch.ind
+00014420: 6578 5f73 656c 6563 7428 636f 6f72 6473  ex_select(coords
+00014430: 2c20 302c 2061 746f 6d5f 6e62 7273 2920  , 0, atom_nbrs) 
+00014440: 666f 7220 6174 6f6d 5f6e 6272 7320 696e  for atom_nbrs in
+00014450: 206e 6272 730a 2020 2020 2020 2020 5d0a   nbrs.        ].
+00014460: 0a20 2020 2020 2020 2023 2041 6464 2070  .        # Add p
+00014470: 6861 6e74 6f6d 2061 746f 6d73 2074 6861  hantom atoms tha
+00014480: 7420 6578 6973 7420 6661 7220 6f75 7473  t exist far outs
+00014490: 6964 6520 7468 6520 626f 780a 2020 2020  ide the box.    
+000144a0: 2020 2020 636f 6f72 645f 7061 6464 696e      coord_paddin
+000144b0: 6720 3d20 746f 7263 682e 6675 6c6c 2828  g = torch.full((
+000144c0: 7365 6c66 2e4d 5f6e 6272 732c 2073 656c  self.M_nbrs, sel
+000144d0: 662e 6e64 696d 292c 0a20 2020 2020 2020  f.ndim),.       
+000144e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000144f0: 2020 2020 2020 2020 2020 2020 3220 2a20              2 * 
+00014500: 7365 6c66 2e73 746f 7029 2e74 6f28 746f  self.stop).to(to
+00014510: 7263 682e 666c 6f61 7429 0a20 2020 2020  rch.float).     
+00014520: 2020 2070 6164 6465 645f 6e62 725f 636f     padded_nbr_co
+00014530: 6f72 6473 203d 205b 0a20 2020 2020 2020  ords = [.       
+00014540: 2020 2020 2074 6f72 6368 2e63 6174 285b       torch.cat([
+00014550: 6e62 725f 636f 6f72 642c 2063 6f6f 7264  nbr_coord, coord
+00014560: 5f70 6164 6469 6e67 5d2c 2030 2920 666f  _padding], 0) fo
+00014570: 7220 6e62 725f 636f 6f72 6420 696e 206e  r nbr_coord in n
+00014580: 6272 5f63 6f6f 7264 730a 2020 2020 2020  br_coords.      
+00014590: 2020 5d0a 0a20 2020 2020 2020 2023 204c    ]..        # L
+000145a0: 6973 7420 6f66 206c 656e 6774 6820 4e5f  ist of length N_
+000145b0: 6174 6f6d 732c 2065 6163 6820 6f66 2073  atoms, each of s
+000145c0: 6861 7065 2028 312c 206e 6469 6d29 0a20  hape (1, ndim). 
+000145d0: 2020 2020 2020 2061 746f 6d5f 636f 6f72         atom_coor
+000145e0: 6473 203d 2074 6f72 6368 2e74 656e 736f  ds = torch.tenso
+000145f0: 725f 7370 6c69 7428 636f 6f72 6473 2c20  r_split(coords, 
+00014600: 7365 6c66 2e4e 5f61 746f 6d73 290a 0a20  self.N_atoms).. 
+00014610: 2020 2020 2020 2023 2054 4f44 4f28 7262         # TODO(rb
+00014620: 6861 7261 7468 293a 2048 6f77 2064 6f65  harath): How doe
+00014630: 7320 6469 7374 616e 6365 206e 6565 6420  s distance need 
+00014640: 746f 2062 6520 6d6f 6469 6669 6564 2068  to be modified h
+00014650: 6572 6520 746f 0a20 2020 2020 2020 2023  ere to.        #
+00014660: 2061 6363 6f75 6e74 2066 6f72 2070 6572   account for per
+00014670: 696f 6469 6320 626f 756e 6461 7279 2063  iodic boundary c
+00014680: 6f6e 6469 7469 6f6e 733f 0a20 2020 2020  onditions?.     
+00014690: 2020 2023 204c 6973 7420 6f66 206c 656e     # List of len
+000146a0: 6774 6820 4e5f 6174 6f6d 7320 6561 6368  gth N_atoms each
+000146b0: 206f 6620 7368 6170 6520 284d 5f6e 6272   of shape (M_nbr
+000146c0: 7329 0a20 2020 2020 2020 2070 6164 6465  s).        padde
+000146d0: 645f 6469 7374 7320 3d20 5b0a 2020 2020  d_dists = [.    
+000146e0: 2020 2020 2020 2020 746f 7263 682e 7375          torch.su
+000146f0: 6d28 2861 746f 6d5f 636f 6f72 6420 2d20  m((atom_coord - 
+00014700: 7061 6464 6564 5f6e 6272 5f63 6f6f 7264  padded_nbr_coord
+00014710: 292a 2a32 2c20 6469 6d3d 2d31 290a 2020  )**2, dim=-1).  
+00014720: 2020 2020 2020 2020 2020 666f 7220 2861            for (a
+00014730: 746f 6d5f 636f 6f72 642c 0a20 2020 2020  tom_coord,.     
+00014740: 2020 2020 2020 2020 2020 2020 7061 6464              padd
+00014750: 6564 5f6e 6272 5f63 6f6f 7264 2920 696e  ed_nbr_coord) in
+00014760: 207a 6970 2861 746f 6d5f 636f 6f72 6473   zip(atom_coords
+00014770: 2c20 7061 6464 6564 5f6e 6272 5f63 6f6f  , padded_nbr_coo
+00014780: 7264 7329 0a20 2020 2020 2020 205d 0a0a  rds).        ]..
+00014790: 2020 2020 2020 2020 7061 6464 6564 5f63          padded_c
+000147a0: 6c6f 7365 7374 5f6e 6272 7320 3d20 5b0a  losest_nbrs = [.
+000147b0: 2020 2020 2020 2020 2020 2020 746f 7263              torc
+000147c0: 682e 746f 706b 2870 6164 6465 645f 6469  h.topk(padded_di
+000147d0: 7374 2c20 6b3d 7365 6c66 2e4d 5f6e 6272  st, k=self.M_nbr
+000147e0: 732c 206c 6172 6765 7374 3d46 616c 7365  s, largest=False
+000147f0: 295b 315d 0a20 2020 2020 2020 2020 2020  )[1].           
+00014800: 2066 6f72 2070 6164 6465 645f 6469 7374   for padded_dist
+00014810: 2069 6e20 7061 6464 6564 5f64 6973 7473   in padded_dists
+00014820: 0a20 2020 2020 2020 205d 0a0a 2020 2020  .        ]..    
+00014830: 2020 2020 2320 4e5f 6174 6f6d 7320 656c      # N_atoms el
+00014840: 7473 206f 6620 7369 7a65 2028 4d5f 6e62  ts of size (M_nb
+00014850: 7273 2c29 2065 6163 680a 2020 2020 2020  rs,) each.      
+00014860: 2020 7061 6464 6564 5f6e 6569 6768 626f    padded_neighbo
+00014870: 725f 6c69 7374 203d 205b 0a20 2020 2020  r_list = [.     
+00014880: 2020 2020 2020 2074 6f72 6368 2e67 6174         torch.gat
+00014890: 6865 7228 7061 6464 6564 5f61 746f 6d5f  her(padded_atom_
+000148a0: 6e62 7273 2c20 302c 2070 6164 6465 645f  nbrs, 0, padded_
+000148b0: 636c 6f73 6573 745f 6e62 7229 0a20 2020  closest_nbr).   
+000148c0: 2020 2020 2020 2020 2066 6f72 2028 7061           for (pa
+000148d0: 6464 6564 5f61 746f 6d5f 6e62 7273 2c0a  dded_atom_nbrs,.
+000148e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000148f0: 2070 6164 6465 645f 636c 6f73 6573 745f   padded_closest_
+00014900: 6e62 7229 2069 6e20 7a69 7028 7061 6464  nbr) in zip(padd
+00014910: 6564 5f6e 6272 732c 2070 6164 6465 645f  ed_nbrs, padded_
+00014920: 636c 6f73 6573 745f 6e62 7273 290a 2020  closest_nbrs).  
+00014930: 2020 2020 2020 5d0a 0a20 2020 2020 2020        ]..       
+00014940: 206e 6569 6768 626f 725f 6c69 7374 203d   neighbor_list =
+00014950: 2074 6f72 6368 2e73 7461 636b 2870 6164   torch.stack(pad
+00014960: 6465 645f 6e65 6967 6862 6f72 5f6c 6973  ded_neighbor_lis
+00014970: 7429 0a0a 2020 2020 2020 2020 7265 7475  t)..        retu
+00014980: 726e 206e 6569 6768 626f 725f 6c69 7374  rn neighbor_list
+00014990: 0a0a 2020 2020 6465 6620 6765 745f 6174  ..    def get_at
+000149a0: 6f6d 735f 696e 5f6e 6272 7328 7365 6c66  oms_in_nbrs(self
+000149b0: 2c20 636f 6f72 6473 3a20 746f 7263 682e  , coords: torch.
+000149c0: 5465 6e73 6f72 2c0a 2020 2020 2020 2020  Tensor,.        
+000149d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000149e0: 2020 6365 6c6c 733a 2074 6f72 6368 2e54    cells: torch.T
+000149f0: 656e 736f 7229 202d 3e20 4c69 7374 5b74  ensor) -> List[t
+00014a00: 6f72 6368 2e54 656e 736f 725d 3a0a 2020  orch.Tensor]:.  
+00014a10: 2020 2020 2020 2222 2247 6574 2074 6865        """Get the
+00014a20: 2061 746f 6d73 2069 6e20 6e65 6967 6862   atoms in neighb
+00014a30: 6f72 696e 6720 6365 6c6c 7320 666f 7220  oring cells for 
+00014a40: 6561 6368 2063 656c 6c73 2e0a 0a20 2020  each cells...   
+00014a50: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+00014a60: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00014a70: 2d2d 0a20 2020 2020 2020 2063 6f6f 7264  --.        coord
+00014a80: 733a 2074 6f72 6368 2e54 656e 736f 720a  s: torch.Tensor.
+00014a90: 2020 2020 2020 2020 2020 2020 5368 6170              Shap
+00014aa0: 6520 284e 5f61 746f 6d73 2c20 6e64 696d  e (N_atoms, ndim
+00014ab0: 290a 2020 2020 2020 2020 6365 6c6c 733a  ).        cells:
+00014ac0: 2074 6f72 6368 2e54 656e 736f 720a 0a20   torch.Tensor.. 
+00014ad0: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
+00014ae0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
+00014af0: 2020 2020 2020 2061 746f 6d73 5f69 6e5f         atoms_in_
+00014b00: 6e62 7273 3a20 4c69 7374 5b74 6f72 6368  nbrs: List[torch
+00014b10: 2e54 656e 736f 725d 0a20 2020 2020 2020  .Tensor].       
+00014b20: 2020 2020 2028 4e5f 6174 6f6d 732c 206e       (N_atoms, n
+00014b30: 5f6e 6272 5f63 656c 6c73 2c20 4d5f 6e62  _nbr_cells, M_nb
+00014b40: 7273 290a 2020 2020 2020 2020 2222 220a  rs).        """.
+00014b50: 2020 2020 2020 2020 2320 5368 6170 6520          # Shape 
+00014b60: 284e 5f61 746f 6d73 2c20 3129 0a20 2020  (N_atoms, 1).   
+00014b70: 2020 2020 2063 656c 6c73 5f66 6f72 5f61       cells_for_a
+00014b80: 746f 6d73 203d 2073 656c 662e 6765 745f  toms = self.get_
+00014b90: 6365 6c6c 735f 666f 725f 6174 6f6d 7328  cells_for_atoms(
+00014ba0: 636f 6f72 6473 2c20 6365 6c6c 7329 0a0a  coords, cells)..
+00014bb0: 2020 2020 2020 2020 2320 4669 6e64 204d          # Find M
+00014bc0: 5f6e 6272 7320 6174 6f6d 7320 636c 6f73  _nbrs atoms clos
+00014bd0: 6573 7420 746f 2065 6163 6820 6365 6c6c  est to each cell
+00014be0: 0a20 2020 2020 2020 2023 2053 6861 7065  .        # Shape
+00014bf0: 2028 6e5f 6365 6c6c 732c 204d 5f6e 6272   (n_cells, M_nbr
+00014c00: 7329 0a20 2020 2020 2020 2063 6c6f 7365  s).        close
+00014c10: 7374 5f61 746f 6d73 203d 2073 656c 662e  st_atoms = self.
+00014c20: 6765 745f 636c 6f73 6573 745f 6174 6f6d  get_closest_atom
+00014c30: 7328 636f 6f72 6473 2c20 6365 6c6c 7329  s(coords, cells)
+00014c40: 0a0a 2020 2020 2020 2020 2320 4173 736f  ..        # Asso
+00014c50: 6369 6174 6520 6561 6368 2063 656c 6c20  ciate each cell 
+00014c60: 7769 7468 2069 7473 206e 6569 6768 626f  with its neighbo
+00014c70: 7220 6365 6c6c 732e 2041 7373 756d 6573  r cells. Assumes
+00014c80: 2070 6572 696f 6469 6320 626f 756e 6461   periodic bounda
+00014c90: 7279 0a20 2020 2020 2020 2023 2063 6f6e  ry.        # con
+00014ca0: 6469 7469 6f6e 732c 2073 6f20 646f 6573  ditions, so does
+00014cb0: 2077 7261 7072 6f75 6e64 2e20 4f28 636f   wrapround. O(co
+00014cc0: 6e73 7461 6e74 290a 2020 2020 2020 2020  nstant).        
+00014cd0: 2320 5368 6170 6520 286e 5f63 656c 6c73  # Shape (n_cells
+00014ce0: 2c20 6e5f 6e62 725f 6365 6c6c 7329 0a20  , n_nbr_cells). 
+00014cf0: 2020 2020 2020 206e 6569 6768 626f 725f         neighbor_
+00014d00: 6365 6c6c 7320 3d20 7365 6c66 2e67 6574  cells = self.get
+00014d10: 5f6e 6569 6768 626f 725f 6365 6c6c 7328  _neighbor_cells(
+00014d20: 6365 6c6c 7329 0a0a 2020 2020 2020 2020  cells)..        
+00014d30: 2320 5368 6170 6520 284e 5f61 746f 6d73  # Shape (N_atoms
+00014d40: 2c20 6e5f 6e62 725f 6365 6c6c 7329 0a20  , n_nbr_cells). 
+00014d50: 2020 2020 2020 206e 6569 6768 626f 725f         neighbor_
+00014d60: 6365 6c6c 7320 3d20 746f 7263 682e 7371  cells = torch.sq
+00014d70: 7565 657a 6528 0a20 2020 2020 2020 2020  ueeze(.         
+00014d80: 2020 2074 6f72 6368 2e69 6e64 6578 5f73     torch.index_s
+00014d90: 656c 6563 7428 6e65 6967 6862 6f72 5f63  elect(neighbor_c
+00014da0: 656c 6c73 2c20 302c 0a20 2020 2020 2020  ells, 0,.       
+00014db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014dc0: 2020 2020 2020 2020 746f 7263 682e 7371          torch.sq
+00014dd0: 7565 657a 6528 6365 6c6c 735f 666f 725f  ueeze(cells_for_
+00014de0: 6174 6f6d 7329 2929 0a0a 2020 2020 2020  atoms)))..      
+00014df0: 2020 2320 5368 6170 6520 284e 5f61 746f    # Shape (N_ato
+00014e00: 6d73 2c20 6e5f 6e62 725f 6365 6c6c 732c  ms, n_nbr_cells,
+00014e10: 204d 5f6e 6272 7329 0a20 2020 2020 2020   M_nbrs).       
+00014e20: 2061 746f 6d73 5f69 6e5f 6e62 7273 203d   atoms_in_nbrs =
+00014e30: 2074 6f72 6368 2e69 6e64 6578 5f73 656c   torch.index_sel
+00014e40: 6563 7428 636c 6f73 6573 745f 6174 6f6d  ect(closest_atom
+00014e50: 732c 2030 2c0a 2020 2020 2020 2020 2020  s, 0,.          
+00014e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e80: 206e 6569 6768 626f 725f 6365 6c6c 732e   neighbor_cells.
+00014e90: 666c 6174 7465 6e28 2929 0a0a 2020 2020  flatten())..    
+00014ea0: 2020 2020 2320 5368 6170 6520 284e 5f61      # Shape (N_a
+00014eb0: 746f 6d73 2c20 6e5f 6e62 725f 6365 6c6c  toms, n_nbr_cell
+00014ec0: 732a 4d5f 6e62 7273 290a 2020 2020 2020  s*M_nbrs).      
+00014ed0: 2020 6174 6f6d 735f 696e 5f6e 6272 7320    atoms_in_nbrs 
+00014ee0: 3d20 746f 7263 682e 7265 7368 6170 6528  = torch.reshape(
+00014ef0: 6174 6f6d 735f 696e 5f6e 6272 732c 205b  atoms_in_nbrs, [
+00014f00: 7365 6c66 2e4e 5f61 746f 6d73 2c20 2d31  self.N_atoms, -1
+00014f10: 5d29 0a0a 2020 2020 2020 2020 2320 4c69  ])..        # Li
+00014f20: 7374 206f 6620 6c65 6e67 7468 204e 5f61  st of length N_a
+00014f30: 746f 6d73 2c20 6561 6368 2065 6c65 6d65  toms, each eleme
+00014f40: 6e74 206c 656e 6774 6820 756e 6971 7565  nt length unique
+00014f50: 735f 690a 2020 2020 2020 2020 6e62 7273  s_i.        nbrs
+00014f60: 5f70 6572 5f61 746f 6d20 3d20 746f 7263  _per_atom = torc
+00014f70: 682e 7370 6c69 7428 6174 6f6d 735f 696e  h.split(atoms_in
+00014f80: 5f6e 6272 732c 2073 656c 662e 4e5f 6174  _nbrs, self.N_at
+00014f90: 6f6d 7329 0a0a 2020 2020 2020 2020 756e  oms)..        un
+00014fa0: 6971 7565 7320 3d20 5b0a 2020 2020 2020  iques = [.      
+00014fb0: 2020 2020 2020 746f 7263 682e 756e 6971        torch.uniq
+00014fc0: 7565 2861 746f 6d5f 6e62 7273 2c20 736f  ue(atom_nbrs, so
+00014fd0: 7274 6564 3d46 616c 7365 290a 2020 2020  rted=False).    
+00014fe0: 2020 2020 2020 2020 666f 7220 6174 6f6d          for atom
+00014ff0: 5f6e 6272 7320 696e 206e 6272 735f 7065  _nbrs in nbrs_pe
+00015000: 725f 6174 6f6d 5b30 5d0a 2020 2020 2020  r_atom[0].      
+00015010: 2020 5d0a 0a20 2020 2020 2020 2023 2054    ]..        # T
+00015020: 4f44 4f28 7262 6861 7261 7468 293a 2046  ODO(rbharath): F
+00015030: 5241 4749 4c45 2120 5573 6573 2066 6163  RAGILE! Uses fac
+00015040: 7420 7468 6174 2069 6465 6e74 6974 7920  t that identity 
+00015050: 7365 656d 7320 746f 2062 6520 7468 6520  seems to be the 
+00015060: 6669 7273 740a 2020 2020 2020 2020 2320  first.        # 
+00015070: 656c 656d 656e 7420 7265 6d6f 7665 6420  element removed 
+00015080: 746f 2072 656d 6f76 6520 7365 6c66 2066  to remove self f
+00015090: 726f 6d20 6c69 7374 206f 6620 6e65 6967  rom list of neig
+000150a0: 6862 6f72 732e 204e 6565 6420 746f 2076  hbors. Need to v
+000150b0: 6572 6966 790a 2020 2020 2020 2020 2320  erify.        # 
+000150c0: 7468 6973 2068 6f6c 6473 206d 6f72 6520  this holds more 
+000150d0: 6272 6f61 646c 7920 6f72 2063 6f6d 6520  broadly or come 
+000150e0: 7570 2077 6974 6820 726f 6275 7374 2061  up with robust a
+000150f0: 6c74 6572 6e61 7469 7665 2e0a 2020 2020  lternative..    
+00015100: 2020 2020 756e 6971 7565 7320 3d20 5b75      uniques = [u
+00015110: 6e69 7175 655b 313a 5d20 666f 7220 756e  nique[1:] for un
+00015120: 6971 7565 2069 6e20 756e 6971 7565 735d  ique in uniques]
+00015130: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00015140: 2075 6e69 7175 6573 0a0a 2020 2020 6465   uniques..    de
+00015150: 6620 6765 745f 636c 6f73 6573 745f 6174  f get_closest_at
+00015160: 6f6d 7328 7365 6c66 2c20 636f 6f72 6473  oms(self, coords
+00015170: 3a20 746f 7263 682e 5465 6e73 6f72 2c0a  : torch.Tensor,.
+00015180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015190: 2020 2020 2020 2020 2020 6365 6c6c 733a            cells:
+000151a0: 2074 6f72 6368 2e54 656e 736f 7229 202d   torch.Tensor) -
+000151b0: 3e20 746f 7263 682e 5465 6e73 6f72 3a0a  > torch.Tensor:.
+000151c0: 2020 2020 2020 2020 2222 2246 6f72 2065          """For e
+000151d0: 6163 6820 6365 6c6c 2c20 6669 6e64 204d  ach cell, find M
+000151e0: 5f6e 6272 7320 636c 6f73 6573 7420 6174  _nbrs closest at
+000151f0: 6f6d 732e 0a0a 2020 2020 2020 2020 4c65  oms...        Le
+00015200: 7420 4e5f 6174 6f6d 7320 6265 2074 6865  t N_atoms be the
+00015210: 206e 756d 6265 7220 6f66 2061 746f 6d73   number of atoms
+00015220: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+00015230: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+00015240: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00015250: 2063 6f6f 7264 733a 2074 6f72 6368 2e54   coords: torch.T
+00015260: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
+00015270: 2020 284e 5f61 746f 6d73 2c20 6e64 696d    (N_atoms, ndim
+00015280: 2920 7368 6170 652e 0a20 2020 2020 2020  ) shape..       
+00015290: 2063 656c 6c73 3a20 746f 7263 682e 5465   cells: torch.Te
+000152a0: 6e73 6f72 0a20 2020 2020 2020 2020 2020  nsor.           
+000152b0: 2028 6e5f 6365 6c6c 732c 206e 6469 6d29   (n_cells, ndim)
+000152c0: 2073 6861 7065 2e0a 0a20 2020 2020 2020   shape...       
+000152d0: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
+000152e0: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
+000152f0: 2063 6c6f 7365 7374 5f69 6e64 733a 2074   closest_inds: t
+00015300: 6f72 6368 2e54 656e 736f 720a 2020 2020  orch.Tensor.    
+00015310: 2020 2020 2020 2020 4f66 2073 6861 7065          Of shape
+00015320: 2028 6e5f 6365 6c6c 732c 204d 5f6e 6272   (n_cells, M_nbr
+00015330: 7329 0a20 2020 2020 2020 2022 2222 0a20  s).        """. 
+00015340: 2020 2020 2020 204e 5f61 746f 6d73 2c20         N_atoms, 
+00015350: 6e5f 6365 6c6c 732c 206e 6469 6d2c 204d  n_cells, ndim, M
+00015360: 5f6e 6272 7320 3d20 2873 656c 662e 4e5f  _nbrs = (self.N_
+00015370: 6174 6f6d 732c 2073 656c 662e 6e5f 6365  atoms, self.n_ce
+00015380: 6c6c 732c 2073 656c 662e 6e64 696d 2c0a  lls, self.ndim,.
+00015390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000153a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000153b0: 2020 2020 2020 2020 2020 7365 6c66 2e4d            self.M
+000153c0: 5f6e 6272 7329 0a20 2020 2020 2020 2023  _nbrs).        #
+000153d0: 2054 696c 6520 626f 7468 2063 656c 6c73   Tile both cells
+000153e0: 2061 6e64 2063 6f6f 7264 7320 746f 2066   and coords to f
+000153f0: 6f72 6d20 6172 7261 7973 206f 6620 7369  orm arrays of si
+00015400: 7a65 2028 4e5f 6174 6f6d 732a 6e5f 6365  ze (N_atoms*n_ce
+00015410: 6c6c 732c 206e 6469 6d29 0a20 2020 2020  lls, ndim).     
+00015420: 2020 2074 696c 6564 5f63 656c 6c73 203d     tiled_cells =
+00015430: 2074 6f72 6368 2e72 6573 6861 7065 2874   torch.reshape(t
+00015440: 6f72 6368 2e74 696c 6528 6365 6c6c 732c  orch.tile(cells,
+00015450: 2028 312c 204e 5f61 746f 6d73 2929 2c0a   (1, N_atoms)),.
+00015460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015480: 2020 2020 284e 5f61 746f 6d73 202a 206e      (N_atoms * n
+00015490: 5f63 656c 6c73 2c20 6e64 696d 2929 0a0a  _cells, ndim))..
+000154a0: 2020 2020 2020 2020 2320 5368 6170 6520          # Shape 
+000154b0: 284e 5f61 746f 6d73 2a6e 5f63 656c 6c73  (N_atoms*n_cells
+000154c0: 2c20 6e64 696d 2920 6166 7465 7220 7469  , ndim) after ti
+000154d0: 6c65 0a20 2020 2020 2020 2074 696c 6564  le.        tiled
+000154e0: 5f63 6f6f 7264 7320 3d20 746f 7263 682e  _coords = torch.
+000154f0: 7469 6c65 2863 6f6f 7264 732c 2028 6e5f  tile(coords, (n_
+00015500: 6365 6c6c 732c 2031 2929 0a0a 2020 2020  cells, 1))..    
+00015510: 2020 2020 2320 5368 6170 6520 284e 5f61      # Shape (N_a
+00015520: 746f 6d73 2a6e 5f63 656c 6c73 290a 2020  toms*n_cells).  
+00015530: 2020 2020 2020 636f 6f72 6473 5f76 6563        coords_vec
+00015540: 203d 2074 6f72 6368 2e73 756d 2828 7469   = torch.sum((ti
+00015550: 6c65 645f 636f 6f72 6473 202d 2074 696c  led_coords - til
+00015560: 6564 5f63 656c 6c73 292a 2a32 2c20 6469  ed_cells)**2, di
+00015570: 6d3d 2d31 290a 2020 2020 2020 2020 2320  m=-1).        # 
+00015580: 5368 6170 6520 286e 5f63 656c 6c73 2c20  Shape (n_cells, 
+00015590: 4e5f 6174 6f6d 7329 0a20 2020 2020 2020  N_atoms).       
+000155a0: 2063 6f6f 7264 735f 6e6f 726d 203d 2074   coords_norm = t
+000155b0: 6f72 6368 2e72 6573 6861 7065 2863 6f6f  orch.reshape(coo
+000155c0: 7264 735f 7665 632c 2028 6e5f 6365 6c6c  rds_vec, (n_cell
+000155d0: 732c 204e 5f61 746f 6d73 2929 0a0a 2020  s, N_atoms))..  
+000155e0: 2020 2020 2020 2320 4669 6e64 206b 2061        # Find k a
+000155f0: 746f 6d73 2063 6c6f 7365 7374 2074 6f20  toms closest to 
+00015600: 7468 6973 2063 656c 6c2e 0a20 2020 2020  this cell..     
+00015610: 2020 2023 2054 656e 736f 7220 6f66 2073     # Tensor of s
+00015620: 6861 7065 2028 6e5f 6365 6c6c 732c 204d  hape (n_cells, M
+00015630: 5f6e 6272 7329 0a20 2020 2020 2020 2063  _nbrs).        c
+00015640: 6c6f 7365 7374 5f69 6e64 7320 3d20 746f  losest_inds = to
+00015650: 7263 682e 746f 706b 2863 6f6f 7264 735f  rch.topk(coords_
+00015660: 6e6f 726d 2c20 6b3d 4d5f 6e62 7273 2c20  norm, k=M_nbrs, 
+00015670: 6c61 7267 6573 743d 4661 6c73 6529 5b31  largest=False)[1
+00015680: 5d0a 0a20 2020 2020 2020 2072 6574 7572  ]..        retur
+00015690: 6e20 636c 6f73 6573 745f 696e 6473 0a0a  n closest_inds..
+000156a0: 2020 2020 6465 6620 6765 745f 6365 6c6c      def get_cell
+000156b0: 735f 666f 725f 6174 6f6d 7328 7365 6c66  s_for_atoms(self
+000156c0: 2c20 636f 6f72 6473 3a20 746f 7263 682e  , coords: torch.
+000156d0: 5465 6e73 6f72 2c0a 2020 2020 2020 2020  Tensor,.        
+000156e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000156f0: 2020 2020 6365 6c6c 733a 2074 6f72 6368      cells: torch
+00015700: 2e54 656e 736f 7229 202d 3e20 746f 7263  .Tensor) -> torc
+00015710: 682e 5465 6e73 6f72 3a0a 2020 2020 2020  h.Tensor:.      
+00015720: 2020 2222 2243 6f6d 7075 7465 2074 6865    """Compute the
+00015730: 2063 656c 6c73 2065 6163 6820 6174 6f6d   cells each atom
+00015740: 2062 656c 6f6e 6773 2074 6f2e 0a0a 2020   belongs to...  
+00015750: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+00015760: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00015770: 2d2d 2d0a 2020 2020 2020 2020 636f 6f72  ---.        coor
+00015780: 6473 3a20 746f 7263 682e 5465 6e73 6f72  ds: torch.Tensor
+00015790: 0a20 2020 2020 2020 2020 2020 2053 6861  .            Sha
+000157a0: 7065 2028 4e5f 6174 6f6d 732c 206e 6469  pe (N_atoms, ndi
+000157b0: 6d29 0a20 2020 2020 2020 2063 656c 6c73  m).        cells
+000157c0: 3a20 746f 7263 682e 5465 6e73 6f72 0a20  : torch.Tensor. 
+000157d0: 2020 2020 2020 2020 2020 2028 6e5f 6365             (n_ce
+000157e0: 6c6c 732c 206e 6469 6d29 2073 6861 7065  lls, ndim) shape
+000157f0: 2e0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+00015800: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00015810: 2d0a 2020 2020 2020 2020 6365 6c6c 735f  -.        cells_
+00015820: 666f 725f 6174 6f6d 733a 2074 6f72 6368  for_atoms: torch
+00015830: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
+00015840: 2020 2020 5368 6170 6520 284e 5f61 746f      Shape (N_ato
+00015850: 6d73 2c20 3129 0a20 2020 2020 2020 2022  ms, 1).        "
+00015860: 2222 0a20 2020 2020 2020 204e 5f61 746f  "".        N_ato
+00015870: 6d73 2c20 6e5f 6365 6c6c 732c 206e 6469  ms, n_cells, ndi
+00015880: 6d20 3d20 7365 6c66 2e4e 5f61 746f 6d73  m = self.N_atoms
+00015890: 2c20 7365 6c66 2e6e 5f63 656c 6c73 2c20  , self.n_cells, 
+000158a0: 7365 6c66 2e6e 6469 6d0a 2020 2020 2020  self.ndim.      
+000158b0: 2020 6e5f 6365 6c6c 7320 3d20 696e 7428    n_cells = int(
+000158c0: 6e5f 6365 6c6c 7329 0a20 2020 2020 2020  n_cells).       
+000158d0: 2023 2054 696c 6520 626f 7468 2063 656c   # Tile both cel
+000158e0: 6c73 2061 6e64 2063 6f6f 7264 7320 746f  ls and coords to
+000158f0: 2066 6f72 6d20 6172 7261 7973 206f 6620   form arrays of 
+00015900: 7369 7a65 2028 4e5f 6174 6f6d 732a 6e5f  size (N_atoms*n_
+00015910: 6365 6c6c 732c 206e 6469 6d29 0a20 2020  cells, ndim).   
+00015920: 2020 2020 2074 696c 6564 5f63 656c 6c73       tiled_cells
+00015930: 203d 2074 6f72 6368 2e74 696c 6528 6365   = torch.tile(ce
+00015940: 6c6c 732c 2028 4e5f 6174 6f6d 732c 2031  lls, (N_atoms, 1
+00015950: 2929 0a0a 2020 2020 2020 2020 2320 5368  ))..        # Sh
+00015960: 6170 6520 284e 5f61 746f 6d73 2a6e 5f63  ape (N_atoms*n_c
+00015970: 656c 6c73 2c20 3129 2061 6674 6572 2074  ells, 1) after t
+00015980: 696c 650a 2020 2020 2020 2020 7469 6c65  ile.        tile
+00015990: 645f 636f 6f72 6473 203d 2074 6f72 6368  d_coords = torch
+000159a0: 2e72 6573 6861 7065 2874 6f72 6368 2e74  .reshape(torch.t
+000159b0: 696c 6528 636f 6f72 6473 2c20 2831 2c20  ile(coords, (1, 
+000159c0: 6e5f 6365 6c6c 7329 292c 0a20 2020 2020  n_cells)),.     
+000159d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000159e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000159f0: 286e 5f63 656c 6c73 202a 204e 5f61 746f  (n_cells * N_ato
+00015a00: 6d73 2c20 6e64 696d 2929 0a20 2020 2020  ms, ndim)).     
+00015a10: 2020 2063 6f6f 7264 735f 7665 6320 3d20     coords_vec = 
+00015a20: 746f 7263 682e 7375 6d28 2874 696c 6564  torch.sum((tiled
+00015a30: 5f63 6f6f 7264 7320 2d20 7469 6c65 645f  _coords - tiled_
+00015a40: 6365 6c6c 7329 2a2a 322c 2064 696d 3d2d  cells)**2, dim=-
+00015a50: 3129 0a20 2020 2020 2020 2063 6f6f 7264  1).        coord
+00015a60: 735f 6e6f 726d 203d 2074 6f72 6368 2e72  s_norm = torch.r
+00015a70: 6573 6861 7065 2863 6f6f 7264 735f 7665  eshape(coords_ve
+00015a80: 632c 2028 4e5f 6174 6f6d 732c 206e 5f63  c, (N_atoms, n_c
+00015a90: 656c 6c73 2929 0a0a 2020 2020 2020 2020  ells))..        
+00015aa0: 636c 6f73 6573 745f 696e 6473 203d 2074  closest_inds = t
+00015ab0: 6f72 6368 2e74 6f70 6b28 636f 6f72 6473  orch.topk(coords
+00015ac0: 5f6e 6f72 6d2c 206b 3d31 2c20 6c61 7267  _norm, k=1, larg
+00015ad0: 6573 743d 4661 6c73 6529 5b31 5d0a 0a20  est=False)[1].. 
+00015ae0: 2020 2020 2020 2072 6574 7572 6e20 636c         return cl
+00015af0: 6f73 6573 745f 696e 6473 0a0a 2020 2020  osest_inds..    
+00015b00: 6465 6620 5f67 6574 5f6e 756d 5f6e 6272  def _get_num_nbr
+00015b10: 7328 7365 6c66 2920 2d3e 2069 6e74 3a0a  s(self) -> int:.
+00015b20: 2020 2020 2020 2020 2222 2247 6574 206e          """Get n
+00015b30: 756d 6265 7220 6f66 206e 6569 6768 626f  umber of neighbo
+00015b40: 7273 2069 6e20 6375 7272 656e 7420 6469  rs in current di
+00015b50: 6d65 6e73 696f 6e61 6c69 7479 2073 7061  mensionality spa
+00015b60: 6365 2e22 2222 0a20 2020 2020 2020 2072  ce.""".        r
+00015b70: 6574 7572 6e20 332a 2a73 656c 662e 6e64  eturn 3**self.nd
+00015b80: 696d 0a0a 2020 2020 6465 6620 6765 745f  im..    def get_
+00015b90: 6e65 6967 6862 6f72 5f63 656c 6c73 2873  neighbor_cells(s
+00015ba0: 656c 662c 2063 656c 6c73 3a20 746f 7263  elf, cells: torc
+00015bb0: 682e 5465 6e73 6f72 2920 2d3e 2074 6f72  h.Tensor) -> tor
+00015bc0: 6368 2e54 656e 736f 723a 0a20 2020 2020  ch.Tensor:.     
+00015bd0: 2020 2022 2222 436f 6d70 7574 6520 6e65     """Compute ne
+00015be0: 6967 6862 6f72 7320 6f66 2063 656c 6c73  ighbors of cells
+00015bf0: 2069 6e20 6772 6964 2e0a 0a20 2020 2020   in grid...     
+00015c00: 2020 2023 2054 4f44 4f28 7262 6861 7261     # TODO(rbhara
+00015c10: 7468 293a 2044 6f20 7765 206e 6565 6420  th): Do we need 
+00015c20: 746f 2068 616e 646c 6520 7065 7269 6f64  to handle period
+00015c30: 6963 2062 6f75 6e64 6172 7920 636f 6e64  ic boundary cond
+00015c40: 6974 696f 6e73 0a20 2020 2020 2020 2070  itions.        p
+00015c50: 726f 7065 726c 7920 6865 7265 3f0a 2020  roperly here?.  
+00015c60: 2020 2020 2020 2320 544f 444f 2872 6268        # TODO(rbh
+00015c70: 6172 6174 6829 3a20 5468 6973 2064 6f65  arath): This doe
+00015c80: 736e 2774 2068 616e 646c 6520 626f 756e  sn't handle boun
+00015c90: 6461 7269 6573 2077 656c 6c2e 2057 6520  daries well. We 
+00015ca0: 6861 7264 2d63 6f64 650a 2020 2020 2020  hard-code.      
+00015cb0: 2020 2320 6c6f 6f6b 696e 6720 666f 7220    # looking for 
+00015cc0: 6e5f 6e62 725f 6365 6c6c 7320 6e65 6967  n_nbr_cells neig
+00015cd0: 6862 6f72 732c 2077 6869 6368 2069 736e  hbors, which isn
+00015ce0: 2774 2072 6967 6874 2066 6f72 2062 6f75  't right for bou
+00015cf0: 6e64 6172 7920 6365 6c6c 7320 696e 0a20  ndary cells in. 
+00015d00: 2020 2020 2020 2023 2074 6865 2063 7562         # the cub
+00015d10: 652e 0a0a 2020 2020 2020 2020 5061 7261  e...        Para
+00015d20: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
+00015d30: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+00015d40: 2020 6365 6c6c 733a 2074 6f72 6368 2e54    cells: torch.T
+00015d50: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
+00015d60: 2020 286e 5f63 656c 6c73 2c20 6e64 696d    (n_cells, ndim
+00015d70: 2920 7368 6170 652e 0a20 2020 2020 2020  ) shape..       
+00015d80: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
+00015d90: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
+00015da0: 206e 6272 5f63 656c 6c73 3a20 746f 7263   nbr_cells: torc
+00015db0: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
+00015dc0: 2020 2020 2028 6e5f 6365 6c6c 732c 206e       (n_cells, n
+00015dd0: 5f6e 6272 5f63 656c 6c73 290a 2020 2020  _nbr_cells).    
+00015de0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00015df0: 6e64 696d 2c20 6e5f 6365 6c6c 7320 3d20  ndim, n_cells = 
+00015e00: 7365 6c66 2e6e 6469 6d2c 2073 656c 662e  self.ndim, self.
+00015e10: 6e5f 6365 6c6c 730a 2020 2020 2020 2020  n_cells.        
+00015e20: 6e5f 6e62 725f 6365 6c6c 7320 3d20 7365  n_nbr_cells = se
+00015e30: 6c66 2e5f 6765 745f 6e75 6d5f 6e62 7273  lf._get_num_nbrs
+00015e40: 2829 0a20 2020 2020 2020 2023 2054 696c  ().        # Til
+00015e50: 6520 6365 6c6c 7320 746f 2066 6f72 6d20  e cells to form 
+00015e60: 6172 7261 7973 206f 6620 7369 7a65 2028  arrays of size (
+00015e70: 6e5f 6365 6c6c 732a 6e5f 6365 6c6c 732c  n_cells*n_cells,
+00015e80: 206e 6469 6d29 0a20 2020 2020 2020 2023   ndim).        #
+00015e90: 2054 776f 2074 696c 696e 6773 2028 612c   Two tilings (a,
+00015ea0: 2062 2c20 632c 2061 2c20 622c 2063 2c20   b, c, a, b, c, 
+00015eb0: 2e2e 2e29 2076 732e 2028 612c 2061 2c20  ...) vs. (a, a, 
+00015ec0: 612c 2062 2c20 622c 2062 2c20 6574 632e  a, b, b, b, etc.
+00015ed0: 290a 2020 2020 2020 2020 2320 5469 6c65  ).        # Tile
+00015ee0: 2028 612c 2061 2c20 612c 2062 2c20 622c   (a, a, a, b, b,
+00015ef0: 2062 2c20 6574 632e 290a 2020 2020 2020   b, etc.).      
+00015f00: 2020 7469 6c65 645f 6365 6e74 6572 7320    tiled_centers 
+00015f10: 3d20 746f 7263 682e 7265 7368 6170 6528  = torch.reshape(
+00015f20: 746f 7263 682e 7469 6c65 2863 656c 6c73  torch.tile(cells
+00015f30: 2c20 2831 2c20 6e5f 6365 6c6c 7329 292c  , (1, n_cells)),
+00015f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015f60: 2020 2020 2020 2028 6e5f 6365 6c6c 7320         (n_cells 
+00015f70: 2a20 6e5f 6365 6c6c 732c 206e 6469 6d29  * n_cells, ndim)
+00015f80: 290a 2020 2020 2020 2020 2320 5469 6c65  ).        # Tile
+00015f90: 2028 612c 2062 2c20 632c 2061 2c20 622c   (a, b, c, a, b,
+00015fa0: 2063 2c20 2e2e 2e29 0a20 2020 2020 2020   c, ...).       
+00015fb0: 2074 696c 6564 5f63 656c 6c73 203d 2074   tiled_cells = t
+00015fc0: 6f72 6368 2e74 696c 6528 6365 6c6c 732c  orch.tile(cells,
+00015fd0: 2028 6e5f 6365 6c6c 732c 2031 2929 0a0a   (n_cells, 1))..
+00015fe0: 2020 2020 2020 2020 636f 6f72 6473 5f76          coords_v
+00015ff0: 6563 203d 2074 6f72 6368 2e73 756d 2828  ec = torch.sum((
+00016000: 7469 6c65 645f 6365 6e74 6572 7320 2d20  tiled_centers - 
+00016010: 7469 6c65 645f 6365 6c6c 7329 2a2a 322c  tiled_cells)**2,
+00016020: 2064 696d 3d2d 3129 0a20 2020 2020 2020   dim=-1).       
+00016030: 2063 6f6f 7264 735f 6e6f 726d 203d 2074   coords_norm = t
+00016040: 6f72 6368 2e72 6573 6861 7065 2863 6f6f  orch.reshape(coo
+00016050: 7264 735f 7665 632c 2028 6e5f 6365 6c6c  rds_vec, (n_cell
+00016060: 732c 206e 5f63 656c 6c73 2929 0a20 2020  s, n_cells)).   
+00016070: 2020 2020 2063 6c6f 7365 7374 5f69 6e64       closest_ind
+00016080: 7320 3d20 746f 7263 682e 746f 706b 2863  s = torch.topk(c
+00016090: 6f6f 7264 735f 6e6f 726d 2c20 6b3d 6e5f  oords_norm, k=n_
+000160a0: 6e62 725f 6365 6c6c 732c 206c 6172 6765  nbr_cells, large
+000160b0: 7374 3d46 616c 7365 295b 315d 0a0a 2020  st=False)[1]..  
+000160c0: 2020 2020 2020 7265 7475 726e 2063 6c6f        return clo
+000160d0: 7365 7374 5f69 6e64 730a 0a20 2020 2064  sest_inds..    d
+000160e0: 6566 2067 6574 5f63 656c 6c73 2873 656c  ef get_cells(sel
+000160f0: 6629 202d 3e20 746f 7263 682e 5465 6e73  f) -> torch.Tens
+00016100: 6f72 3a0a 2020 2020 2020 2020 2222 2252  or:.        """R
+00016110: 6574 7572 6e73 2074 6865 206c 6f63 6174  eturns the locat
+00016120: 696f 6e73 206f 6620 616c 6c20 6772 6964  ions of all grid
+00016130: 2070 6f69 6e74 7320 696e 2062 6f78 2e0a   points in box..
+00016140: 0a20 2020 2020 2020 2053 7570 706f 7365  .        Suppose
+00016150: 2073 7461 7274 2069 7320 2d31 3020 416e   start is -10 An
+00016160: 6773 7472 6f6d 2c20 7374 6f70 2069 7320  gstrom, stop is 
+00016170: 3130 2041 6e67 7374 726f 6d2c 206e 6272  10 Angstrom, nbr
+00016180: 5f63 7574 6f66 6620 6973 2031 2e0a 2020  _cutoff is 1..  
+00016190: 2020 2020 2020 5468 656e 2077 6f75 6c64        Then would
+000161a0: 2072 6574 7572 6e20 6120 6c69 7374 206f   return a list o
+000161b0: 6620 6c65 6e67 7468 2032 305e 3320 7768  f length 20^3 wh
+000161c0: 6f73 6520 656e 7472 6965 7320 776f 756c  ose entries woul
+000161d0: 6420 6265 0a20 2020 2020 2020 205b 282d  d be.        [(-
+000161e0: 3130 2c20 2d31 302c 202d 3130 292c 2028  10, -10, -10), (
+000161f0: 2d31 302c 202d 3130 2c20 2d39 292c 202e  -10, -10, -9), .
+00016200: 2e2e 2c20 2839 2c20 392c 2039 295d 0a0a  .., (9, 9, 9)]..
+00016210: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
+00016220: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
+00016230: 2020 2020 2020 2020 6365 6c6c 733a 2074          cells: t
+00016240: 6f72 6368 2e54 656e 736f 720a 2020 2020  orch.Tensor.    
+00016250: 2020 2020 2020 286e 5f63 656c 6c73 2c20        (n_cells, 
+00016260: 6e64 696d 2920 7368 6170 652e 0a20 2020  ndim) shape..   
+00016270: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00016280: 2073 7461 7274 2c20 7374 6f70 2c20 6e62   start, stop, nb
+00016290: 725f 6375 746f 6666 203d 2073 656c 662e  r_cutoff = self.
+000162a0: 7374 6172 742c 2073 656c 662e 7374 6f70  start, self.stop
+000162b0: 2c20 7365 6c66 2e6e 6272 5f63 7574 6f66  , self.nbr_cutof
+000162c0: 660a 2020 2020 2020 2020 6d65 7368 5f61  f.        mesh_a
+000162d0: 7267 7320 3d20 5b0a 2020 2020 2020 2020  rgs = [.        
+000162e0: 2020 2020 746f 7263 682e 6172 616e 6765      torch.arange
+000162f0: 2873 7461 7274 2c20 7374 6f70 2c20 6e62  (start, stop, nb
+00016300: 725f 6375 746f 6666 2920 666f 7220 5f20  r_cutoff) for _ 
+00016310: 696e 2072 616e 6765 2873 656c 662e 6e64  in range(self.nd
+00016320: 696d 290a 2020 2020 2020 2020 5d0a 2020  im).        ].  
+00016330: 2020 2020 2020 7265 7475 726e 2074 6f72        return tor
+00016340: 6368 2e72 6573 6861 7065 280a 2020 2020  ch.reshape(.    
+00016350: 2020 2020 2020 2020 746f 7263 682e 7065          torch.pe
+00016360: 726d 7574 6528 0a20 2020 2020 2020 2020  rmute(.         
+00016370: 2020 2020 2020 2074 6f72 6368 2e73 7461         torch.sta
+00016380: 636b 2874 6f72 6368 2e6d 6573 6867 7269  ck(torch.meshgri
+00016390: 6428 2a6d 6573 685f 6172 6773 2c20 696e  d(*mesh_args, in
+000163a0: 6465 7869 6e67 3d27 7879 2729 292c 0a20  dexing='xy')),. 
+000163b0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+000163c0: 7570 6c65 2872 616e 6765 2873 656c 662e  uple(range(self.
+000163d0: 6e64 696d 2c20 2d31 2c20 2d31 2929 292c  ndim, -1, -1))),
+000163e0: 0a20 2020 2020 2020 2020 2020 2028 7365  .            (se
+000163f0: 6c66 2e6e 5f63 656c 6c73 2c20 7365 6c66  lf.n_cells, self
+00016400: 2e6e 6469 6d29 292e 746f 2874 6f72 6368  .ndim)).to(torch
+00016410: 2e66 6c6f 6174 290a 0a0a 636c 6173 7320  .float)...class 
+00016420: 4c53 544d 5374 6570 286e 6e2e 4d6f 6475  LSTMStep(nn.Modu
+00016430: 6c65 293a 0a20 2020 2022 2222 4c61 7965  le):.    """Laye
+00016440: 7220 7468 6174 2070 6572 666f 726d 7320  r that performs 
+00016450: 6120 7369 6e67 6c65 2073 7465 7020 4c53  a single step LS
+00016460: 544d 2075 7064 6174 652e 0a0a 2020 2020  TM update...    
+00016470: 5468 6973 2069 7320 7468 6520 546f 7263  This is the Torc
+00016480: 6820 6571 7569 7661 6c65 6e74 206f 6620  h equivalent of 
+00016490: 7468 6520 6f72 6967 696e 616c 2069 6d70  the original imp
+000164a0: 6c65 6d65 6e74 6174 696f 6e20 7573 696e  lementation usin
+000164b0: 6720 4b65 7261 732e 0a20 2020 2022 2222  g Keras..    """
+000164c0: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+000164d0: 5f5f 2873 656c 662c 0a20 2020 2020 2020  __(self,.       
+000164e0: 2020 2020 2020 2020 2020 6f75 7470 7574            output
+000164f0: 5f64 696d 2c0a 2020 2020 2020 2020 2020  _dim,.          
+00016500: 2020 2020 2020 2069 6e70 7574 5f64 696d         input_dim
+00016510: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00016520: 2020 2069 6e69 745f 666e 3d27 7861 7669     init_fn='xavi
+00016530: 6572 5f75 6e69 666f 726d 5f27 2c0a 2020  er_uniform_',.  
+00016540: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00016550: 6e6e 6572 5f69 6e69 745f 666e 3d27 6f72  nner_init_fn='or
+00016560: 7468 6f67 6f6e 616c 5f27 2c0a 2020 2020  thogonal_',.    
+00016570: 2020 2020 2020 2020 2020 2020 2061 6374               act
+00016580: 6976 6174 696f 6e5f 666e 3d27 7461 6e68  ivation_fn='tanh
+00016590: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+000165a0: 2020 2020 696e 6e65 725f 6163 7469 7661      inner_activa
+000165b0: 7469 6f6e 5f66 6e3d 2768 6172 6473 6967  tion_fn='hardsig
+000165c0: 6d6f 6964 272c 0a20 2020 2020 2020 2020  moid',.         
+000165d0: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
+000165e0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+000165f0: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+00016600: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00016610: 2d2d 2d2d 0a20 2020 2020 2020 206f 7574  ----.        out
+00016620: 7075 745f 6469 6d3a 2069 6e74 0a20 2020  put_dim: int.   
+00016630: 2020 2020 2020 2020 2044 696d 656e 7369           Dimensi
+00016640: 6f6e 616c 6974 7920 6f66 206f 7574 7075  onality of outpu
+00016650: 7420 7665 6374 6f72 732e 0a20 2020 2020  t vectors..     
+00016660: 2020 2069 6e70 7574 5f64 696d 3a20 696e     input_dim: in
+00016670: 740a 2020 2020 2020 2020 2020 2020 4469  t.            Di
+00016680: 6d65 6e73 696f 6e61 6c69 7479 206f 6620  mensionality of 
+00016690: 696e 7075 7420 7665 6374 6f72 732e 0a20  input vectors.. 
+000166a0: 2020 2020 2020 2069 6e69 745f 666e 3a20         init_fn: 
+000166b0: 7374 720a 2020 2020 2020 2020 2020 2020  str.            
+000166c0: 5079 546f 7263 6820 696e 6974 6961 6c69  PyTorch initiali
+000166d0: 7a61 7469 6f6e 2074 6f20 7573 6520 666f  zation to use fo
+000166e0: 7220 572e 0a20 2020 2020 2020 2069 6e6e  r W..        inn
+000166f0: 6572 5f69 6e69 745f 666e 3a20 7374 720a  er_init_fn: str.
+00016700: 2020 2020 2020 2020 2020 2020 5079 546f              PyTo
+00016710: 7263 6820 696e 6974 6961 6c69 7a61 7469  rch initializati
+00016720: 6f6e 2074 6f20 7573 6520 666f 7220 552e  on to use for U.
+00016730: 0a20 2020 2020 2020 2061 6374 6976 6174  .        activat
+00016740: 696f 6e5f 666e 3a20 7374 720a 2020 2020  ion_fn: str.    
+00016750: 2020 2020 2020 2020 5079 546f 7263 6820          PyTorch 
+00016760: 6163 7469 7661 7469 6f6e 2074 6f20 7573  activation to us
+00016770: 6520 666f 7220 6f75 7470 7574 2e0a 2020  e for output..  
+00016780: 2020 2020 2020 696e 6e65 725f 6163 7469        inner_acti
+00016790: 7661 7469 6f6e 5f66 6e3a 2073 7472 0a20  vation_fn: str. 
+000167a0: 2020 2020 2020 2020 2020 2050 7954 6f72             PyTor
+000167b0: 6368 2061 6374 6976 6174 696f 6e20 746f  ch activation to
+000167c0: 2075 7365 2066 6f72 2069 6e6e 6572 2073   use for inner s
+000167d0: 7465 7073 2e0a 2020 2020 2020 2020 2222  teps..        ""
+000167e0: 220a 0a20 2020 2020 2020 2073 7570 6572  "..        super
+000167f0: 284c 5354 4d53 7465 702c 2073 656c 6629  (LSTMStep, self)
+00016800: 2e5f 5f69 6e69 745f 5f28 2a2a 6b77 6172  .__init__(**kwar
+00016810: 6773 290a 2020 2020 2020 2020 7365 6c66  gs).        self
+00016820: 2e69 6e69 7420 3d20 696e 6974 5f66 6e0a  .init = init_fn.
+00016830: 2020 2020 2020 2020 7365 6c66 2e69 6e6e          self.inn
+00016840: 6572 5f69 6e69 7420 3d20 696e 6e65 725f  er_init = inner_
+00016850: 696e 6974 5f66 6e0a 2020 2020 2020 2020  init_fn.        
+00016860: 7365 6c66 2e6f 7574 7075 745f 6469 6d20  self.output_dim 
+00016870: 3d20 6f75 7470 7574 5f64 696d 0a20 2020  = output_dim.   
+00016880: 2020 2020 2023 204e 6f20 6f74 6865 7220       # No other 
+00016890: 666f 7267 6574 2062 6961 7365 7320 7375  forget biases su
+000168a0: 7070 6f72 7465 6420 7269 6768 7420 6e6f  pported right no
+000168b0: 772e 0a20 2020 2020 2020 2073 656c 662e  w..        self.
+000168c0: 6163 7469 7661 7469 6f6e 203d 2061 6374  activation = act
+000168d0: 6976 6174 696f 6e5f 666e 0a20 2020 2020  ivation_fn.     
+000168e0: 2020 2073 656c 662e 696e 6e65 725f 6163     self.inner_ac
+000168f0: 7469 7661 7469 6f6e 203d 2069 6e6e 6572  tivation = inner
+00016900: 5f61 6374 6976 6174 696f 6e5f 666e 0a20  _activation_fn. 
+00016910: 2020 2020 2020 2073 656c 662e 6163 7469         self.acti
+00016920: 7661 7469 6f6e 5f66 6e20 3d20 6765 745f  vation_fn = get_
+00016930: 6163 7469 7661 7469 6f6e 2861 6374 6976  activation(activ
+00016940: 6174 696f 6e5f 666e 290a 2020 2020 2020  ation_fn).      
+00016950: 2020 7365 6c66 2e69 6e6e 6572 5f61 6374    self.inner_act
+00016960: 6976 6174 696f 6e5f 666e 203d 2067 6574  ivation_fn = get
+00016970: 5f61 6374 6976 6174 696f 6e28 696e 6e65  _activation(inne
+00016980: 725f 6163 7469 7661 7469 6f6e 5f66 6e29  r_activation_fn)
+00016990: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
+000169a0: 7075 745f 6469 6d20 3d20 696e 7075 745f  put_dim = input_
+000169b0: 6469 6d0a 2020 2020 2020 2020 7365 6c66  dim.        self
+000169c0: 2e62 7569 6c64 2829 0a0a 2020 2020 6465  .build()..    de
+000169d0: 6620 6765 745f 636f 6e66 6967 2873 656c  f get_config(sel
+000169e0: 6629 3a0a 2020 2020 2020 2020 636f 6e66  f):.        conf
+000169f0: 6967 203d 2073 7570 6572 284c 5354 4d53  ig = super(LSTMS
+00016a00: 7465 702c 2073 656c 6629 2e67 6574 5f63  tep, self).get_c
+00016a10: 6f6e 6669 6728 290a 2020 2020 2020 2020  onfig().        
+00016a20: 636f 6e66 6967 5b27 6f75 7470 7574 5f64  config['output_d
+00016a30: 696d 275d 203d 2073 656c 662e 6f75 7470  im'] = self.outp
+00016a40: 7574 5f64 696d 0a20 2020 2020 2020 2063  ut_dim.        c
+00016a50: 6f6e 6669 675b 2769 6e70 7574 5f64 696d  onfig['input_dim
+00016a60: 275d 203d 2073 656c 662e 696e 7075 745f  '] = self.input_
+00016a70: 6469 6d0a 2020 2020 2020 2020 636f 6e66  dim.        conf
+00016a80: 6967 5b27 696e 6974 5f66 6e27 5d20 3d20  ig['init_fn'] = 
+00016a90: 7365 6c66 2e69 6e69 740a 2020 2020 2020  self.init.      
+00016aa0: 2020 636f 6e66 6967 5b27 696e 6e65 725f    config['inner_
+00016ab0: 696e 6974 5f66 6e27 5d20 3d20 7365 6c66  init_fn'] = self
+00016ac0: 2e69 6e6e 6572 5f69 6e69 740a 2020 2020  .inner_init.    
+00016ad0: 2020 2020 636f 6e66 6967 5b27 6163 7469      config['acti
+00016ae0: 7661 7469 6f6e 5f66 6e27 5d20 3d20 7365  vation_fn'] = se
+00016af0: 6c66 2e61 6374 6976 6174 696f 6e0a 2020  lf.activation.  
+00016b00: 2020 2020 2020 636f 6e66 6967 5b27 696e        config['in
+00016b10: 6e65 725f 6163 7469 7661 7469 6f6e 5f66  ner_activation_f
+00016b20: 6e27 5d20 3d20 7365 6c66 2e69 6e6e 6572  n'] = self.inner
+00016b30: 5f61 6374 6976 6174 696f 6e0a 2020 2020  _activation.    
+00016b40: 2020 2020 7265 7475 726e 2063 6f6e 6669      return confi
+00016b50: 670a 0a20 2020 2064 6566 2067 6574 5f69  g..    def get_i
+00016b60: 6e69 7469 616c 5f73 7461 7465 7328 7365  nitial_states(se
+00016b70: 6c66 2c20 696e 7075 745f 7368 6170 6529  lf, input_shape)
+00016b80: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00016b90: 205b 746f 7263 682e 7a65 726f 7328 696e   [torch.zeros(in
+00016ba0: 7075 745f 7368 6170 6529 2c20 746f 7263  put_shape), torc
+00016bb0: 682e 7a65 726f 7328 696e 7075 745f 7368  h.zeros(input_sh
+00016bc0: 6170 6529 5d0a 0a20 2020 2064 6566 2062  ape)]..    def b
+00016bd0: 7569 6c64 2873 656c 6629 3a0a 2020 2020  uild(self):.    
+00016be0: 2020 2020 2222 2243 6f6e 7374 7275 6374      """Construct
+00016bf0: 7320 6c65 6172 6e61 626c 6520 7765 6967  s learnable weig
+00016c00: 6874 7320 666f 7220 7468 6973 206c 6179  hts for this lay
+00016c10: 6572 2e22 2222 0a20 2020 2020 2020 2069  er.""".        i
+00016c20: 6e69 7420 3d20 6765 7461 7474 7228 696e  nit = getattr(in
+00016c30: 6974 6961 6c69 7a65 7273 2c20 7365 6c66  itializers, self
+00016c40: 2e69 6e69 7429 0a20 2020 2020 2020 2069  .init).        i
+00016c50: 6e6e 6572 5f69 6e69 7420 3d20 6765 7461  nner_init = geta
+00016c60: 7474 7228 696e 6974 6961 6c69 7a65 7273  ttr(initializers
+00016c70: 2c20 7365 6c66 2e69 6e6e 6572 5f69 6e69  , self.inner_ini
+00016c80: 7429 0a20 2020 2020 2020 2073 656c 662e  t).        self.
+00016c90: 5720 3d20 696e 6974 2874 6f72 6368 2e65  W = init(torch.e
+00016ca0: 6d70 7479 2873 656c 662e 696e 7075 745f  mpty(self.input_
+00016cb0: 6469 6d2c 2034 202a 2073 656c 662e 6f75  dim, 4 * self.ou
+00016cc0: 7470 7574 5f64 696d 2929 0a20 2020 2020  tput_dim)).     
+00016cd0: 2020 2073 656c 662e 5520 3d20 696e 6e65     self.U = inne
+00016ce0: 725f 696e 6974 2874 6f72 6368 2e65 6d70  r_init(torch.emp
+00016cf0: 7479 2873 656c 662e 6f75 7470 7574 5f64  ty(self.output_d
+00016d00: 696d 2c20 3420 2a20 7365 6c66 2e6f 7574  im, 4 * self.out
+00016d10: 7075 745f 6469 6d29 290a 0a20 2020 2020  put_dim))..     
+00016d20: 2020 2073 656c 662e 6220 3d20 746f 7263     self.b = torc
+00016d30: 682e 7465 6e73 6f72 286e 702e 6873 7461  h.tensor(np.hsta
+00016d40: 636b 280a 2020 2020 2020 2020 2020 2020  ck(.            
+00016d50: 286e 702e 7a65 726f 7328 7365 6c66 2e6f  (np.zeros(self.o
+00016d60: 7574 7075 745f 6469 6d29 2c20 6e70 2e6f  utput_dim), np.o
+00016d70: 6e65 7328 7365 6c66 2e6f 7574 7075 745f  nes(self.output_
+00016d80: 6469 6d29 2c0a 2020 2020 2020 2020 2020  dim),.          
+00016d90: 2020 206e 702e 7a65 726f 7328 7365 6c66     np.zeros(self
+00016da0: 2e6f 7574 7075 745f 6469 6d29 2c20 6e70  .output_dim), np
+00016db0: 2e7a 6572 6f73 2873 656c 662e 6f75 7470  .zeros(self.outp
+00016dc0: 7574 5f64 696d 2929 292c 0a20 2020 2020  ut_dim))),.     
+00016dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016de0: 2020 2020 2020 2020 2064 7479 7065 3d74           dtype=t
+00016df0: 6f72 6368 2e66 6c6f 6174 3332 290a 0a20  orch.float32).. 
+00016e00: 2020 2064 6566 2066 6f72 7761 7264 2873     def forward(s
+00016e10: 656c 662c 2069 6e70 7574 7329 3a0a 2020  elf, inputs):.  
+00016e20: 2020 2020 2020 2222 2245 7865 6375 7465        """Execute
+00016e30: 2074 6869 7320 6c61 7965 7220 6f6e 2069   this layer on i
+00016e40: 6e70 7574 2074 656e 736f 7273 2e0a 0a20  nput tensors... 
+00016e50: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+00016e60: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00016e70: 2d2d 2d2d 0a20 2020 2020 2020 2069 6e70  ----.        inp
+00016e80: 7574 733a 206c 6973 740a 2020 2020 2020  uts: list.      
+00016e90: 2020 2020 2020 4c69 7374 206f 6620 7468        List of th
+00016ea0: 7265 6520 7465 6e73 6f72 7320 2878 2c20  ree tensors (x, 
+00016eb0: 685f 746d 312c 2063 5f74 6d31 292e 2068  h_tm1, c_tm1). h
+00016ec0: 5f74 6d31 206d 6561 6e73 2022 682c 2074  _tm1 means "h, t
+00016ed0: 2d31 222e 0a0a 2020 2020 2020 2020 5265  -1"...        Re
+00016ee0: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
+00016ef0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6c69  -----.        li
+00016f00: 7374 0a20 2020 2020 2020 2020 2020 2052  st.            R
+00016f10: 6574 7572 6e73 2068 2c20 5b68 2c20 635d  eturns h, [h, c]
+00016f20: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00016f30: 2020 2020 2078 2c20 685f 746d 312c 2063       x, h_tm1, c
+00016f40: 5f74 6d31 203d 2069 6e70 7574 730a 2020  _tm1 = inputs.  
+00016f50: 2020 2020 2020 782c 2068 5f74 6d31 2c20        x, h_tm1, 
+00016f60: 635f 746d 3120 3d20 746f 7263 682e 7465  c_tm1 = torch.te
+00016f70: 6e73 6f72 2878 292c 2074 6f72 6368 2e74  nsor(x), torch.t
+00016f80: 656e 736f 7228 685f 746d 3129 2c20 746f  ensor(h_tm1), to
+00016f90: 7263 682e 7465 6e73 6f72 280a 2020 2020  rch.tensor(.    
+00016fa0: 2020 2020 2020 2020 635f 746d 3129 0a0a          c_tm1)..
+00016fb0: 2020 2020 2020 2020 7a20 3d20 746f 7263          z = torc
+00016fc0: 682e 6d61 746d 756c 2878 2c20 7365 6c66  h.matmul(x, self
+00016fd0: 2e57 2920 2b20 746f 7263 682e 6d61 746d  .W) + torch.matm
+00016fe0: 756c 2868 5f74 6d31 2c20 7365 6c66 2e55  ul(h_tm1, self.U
+00016ff0: 2920 2b20 7365 6c66 2e62 0a0a 2020 2020  ) + self.b..    
+00017000: 2020 2020 7a30 203d 207a 5b3a 2c20 3a73      z0 = z[:, :s
+00017010: 656c 662e 6f75 7470 7574 5f64 696d 5d0a  elf.output_dim].
+00017020: 2020 2020 2020 2020 7a31 203d 207a 5b3a          z1 = z[:
+00017030: 2c20 7365 6c66 2e6f 7574 7075 745f 6469  , self.output_di
+00017040: 6d3a 3220 2a20 7365 6c66 2e6f 7574 7075  m:2 * self.outpu
+00017050: 745f 6469 6d5d 0a20 2020 2020 2020 207a  t_dim].        z
+00017060: 3220 3d20 7a5b 3a2c 2032 202a 2073 656c  2 = z[:, 2 * sel
+00017070: 662e 6f75 7470 7574 5f64 696d 3a33 202a  f.output_dim:3 *
+00017080: 2073 656c 662e 6f75 7470 7574 5f64 696d   self.output_dim
+00017090: 5d0a 2020 2020 2020 2020 7a33 203d 207a  ].        z3 = z
+000170a0: 5b3a 2c20 3320 2a20 7365 6c66 2e6f 7574  [:, 3 * self.out
+000170b0: 7075 745f 6469 6d3a 5d0a 0a20 2020 2020  put_dim:]..     
+000170c0: 2020 2069 203d 2073 656c 662e 696e 6e65     i = self.inne
+000170d0: 725f 6163 7469 7661 7469 6f6e 5f66 6e28  r_activation_fn(
+000170e0: 7a30 290a 2020 2020 2020 2020 6620 3d20  z0).        f = 
+000170f0: 7365 6c66 2e69 6e6e 6572 5f61 6374 6976  self.inner_activ
+00017100: 6174 696f 6e5f 666e 287a 3129 0a20 2020  ation_fn(z1).   
+00017110: 2020 2020 2063 203d 2066 202a 2063 5f74       c = f * c_t
+00017120: 6d31 202b 2069 202a 2073 656c 662e 6163  m1 + i * self.ac
+00017130: 7469 7661 7469 6f6e 5f66 6e28 7a32 290a  tivation_fn(z2).
+00017140: 2020 2020 2020 2020 6f20 3d20 7365 6c66          o = self
+00017150: 2e69 6e6e 6572 5f61 6374 6976 6174 696f  .inner_activatio
+00017160: 6e5f 666e 287a 3329 0a0a 2020 2020 2020  n_fn(z3)..      
+00017170: 2020 6820 3d20 6f20 2a20 7365 6c66 2e61    h = o * self.a
+00017180: 6374 6976 6174 696f 6e5f 666e 2863 290a  ctivation_fn(c).
+00017190: 2020 2020 2020 2020 7265 7475 726e 2068          return h
+000171a0: 2c20 5b68 2c20 635d 0a0a 0a63 6c61 7373  , [h, c]...class
+000171b0: 2041 746f 6d69 6343 6f6e 766f 6c75 7469   AtomicConvoluti
+000171c0: 6f6e 286e 6e2e 4d6f 6475 6c65 293a 0a20  on(nn.Module):. 
+000171d0: 2020 2022 2222 496d 706c 656d 656e 7473     """Implements
+000171e0: 2074 6865 2041 746f 6d69 6320 436f 6e76   the Atomic Conv
+000171f0: 6f6c 7574 696f 6e61 6c20 7472 616e 7366  olutional transf
+00017200: 6f72 6d2c 2069 6e74 726f 6475 6365 6420  orm, introduced 
+00017210: 696e 0a0a 2020 2020 476f 6d65 732c 204a  in..    Gomes, J
+00017220: 6f73 6570 682c 2065 7420 616c 2e20 2241  oseph, et al. "A
+00017230: 746f 6d69 6320 636f 6e76 6f6c 7574 696f  tomic convolutio
+00017240: 6e61 6c20 6e65 7477 6f72 6b73 2066 6f72  nal networks for
+00017250: 2070 7265 6469 6374 696e 670a 2020 2020   predicting.    
+00017260: 7072 6f74 6569 6e2d 6c69 6761 6e64 2062  protein-ligand b
+00017270: 696e 6469 6e67 2061 6666 696e 6974 792e  inding affinity.
+00017280: 2220 6172 5869 7620 7072 6570 7269 6e74  " arXiv preprint
+00017290: 2061 7258 6976 3a31 3730 332e 3130 3630   arXiv:1703.1060
+000172a0: 330a 2020 2020 2832 3031 3729 2e0a 0a20  3.    (2017)... 
+000172b0: 2020 2041 7420 6120 6869 6768 206c 6576     At a high lev
+000172c0: 656c 2c20 7468 6973 2074 7261 6e73 666f  el, this transfo
+000172d0: 726d 2070 6572 666f 726d 7320 6120 6772  rm performs a gr
+000172e0: 6170 6820 636f 6e76 6f6c 7574 696f 6e0a  aph convolution.
+000172f0: 2020 2020 6f6e 2074 6865 206e 6561 7265      on the neare
+00017300: 7374 206e 6569 6768 626f 7273 2067 7261  st neighbors gra
+00017310: 7068 2069 6e20 3344 2073 7061 6365 2e0a  ph in 3D space..
+00017320: 0a20 2020 2045 7861 6d70 6c65 730a 2020  .    Examples.  
+00017330: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e    --------.    >
+00017340: 3e3e 2062 6174 6368 5f73 697a 6520 3d20  >> batch_size = 
+00017350: 340a 2020 2020 3e3e 3e20 6d61 785f 6174  4.    >>> max_at
+00017360: 6f6d 7320 3d20 350a 2020 2020 3e3e 3e20  oms = 5.    >>> 
+00017370: 6d61 785f 6e65 6967 6862 6f72 7320 3d20  max_neighbors = 
+00017380: 320a 2020 2020 3e3e 3e20 6469 6d65 6e73  2.    >>> dimens
+00017390: 696f 6e73 203d 2033 0a20 2020 203e 3e3e  ions = 3.    >>>
+000173a0: 2072 6164 6961 6c5f 7061 7261 6d73 203d   radial_params =
+000173b0: 2074 6f72 6368 2e74 656e 736f 7228 5b5b   torch.tensor([[
+000173c0: 352e 302c 2032 2e30 2c20 302e 355d 2c20  5.0, 2.0, 0.5], 
+000173d0: 5b31 302e 302c 2032 2e30 2c20 302e 355d  [10.0, 2.0, 0.5]
+000173e0: 2c0a 2020 2020 2e2e 2e20 2020 2020 2020  ,.    ...       
+000173f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017400: 2020 2020 2020 2020 5b35 2e30 2c20 312e          [5.0, 1.
+00017410: 302c 2030 2e32 5d5d 290a 2020 2020 3e3e  0, 0.2]]).    >>
+00017420: 3e20 696e 7075 7431 203d 206e 702e 7261  > input1 = np.ra
+00017430: 6e64 6f6d 2e72 616e 6428 6261 7463 685f  ndom.rand(batch_
+00017440: 7369 7a65 2c20 6d61 785f 6174 6f6d 732c  size, max_atoms,
+00017450: 2064 696d 656e 7369 6f6e 7329 2e61 7374   dimensions).ast
+00017460: 7970 6528 6e70 2e66 6c6f 6174 3332 290a  ype(np.float32).
+00017470: 2020 2020 3e3e 3e20 696e 7075 7432 203d      >>> input2 =
+00017480: 206e 702e 7261 6e64 6f6d 2e72 616e 6469   np.random.randi
+00017490: 6e74 286d 6178 5f61 746f 6d73 2c0a 2020  nt(max_atoms,.  
+000174a0: 2020 2e2e 2e20 2020 2020 2020 2020 2020    ...           
+000174b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000174c0: 2073 697a 653d 2862 6174 6368 5f73 697a   size=(batch_siz
+000174d0: 652c 206d 6178 5f61 746f 6d73 2c20 6d61  e, max_atoms, ma
+000174e0: 785f 6e65 6967 6862 6f72 7329 290a 2020  x_neighbors)).  
+000174f0: 2020 3e3e 3e20 696e 7075 7433 203d 206e    >>> input3 = n
+00017500: 702e 7261 6e64 6f6d 2e72 616e 6469 6e74  p.random.randint
+00017510: 2831 2c20 3130 2c20 7369 7a65 3d28 6261  (1, 10, size=(ba
+00017520: 7463 685f 7369 7a65 2c20 6d61 785f 6174  tch_size, max_at
+00017530: 6f6d 732c 206d 6178 5f6e 6569 6768 626f  oms, max_neighbo
+00017540: 7273 2929 0a20 2020 203e 3e3e 206c 6179  rs)).    >>> lay
+00017550: 6572 203d 2041 746f 6d69 6343 6f6e 766f  er = AtomicConvo
+00017560: 6c75 7469 6f6e 2872 6164 6961 6c5f 7061  lution(radial_pa
+00017570: 7261 6d73 3d72 6164 6961 6c5f 7061 7261  rams=radial_para
+00017580: 6d73 290a 2020 2020 3e3e 3e20 7265 7375  ms).    >>> resu
+00017590: 6c74 203d 206c 6179 6572 285b 696e 7075  lt = layer([inpu
+000175a0: 7431 2c20 696e 7075 7432 2c20 696e 7075  t1, input2, inpu
+000175b0: 7433 5d29 0a20 2020 203e 3e3e 2072 6573  t3]).    >>> res
+000175c0: 756c 742e 7368 6170 650a 2020 2020 746f  ult.shape.    to
+000175d0: 7263 682e 5369 7a65 285b 342c 2035 2c20  rch.Size([4, 5, 
+000175e0: 335d 290a 2020 2020 2222 220a 0a20 2020  3]).    """..   
+000175f0: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+00017600: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
+00017610: 2020 2020 2061 746f 6d5f 7479 7065 733a       atom_types:
+00017620: 204f 7074 696f 6e61 6c5b 556e 696f 6e5b   Optional[Union[
+00017630: 4172 7261 794c 696b 652c 2074 6f72 6368  ArrayLike, torch
+00017640: 2e54 656e 736f 725d 5d20 3d20 4e6f 6e65  .Tensor]] = None
+00017650: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00017660: 2020 2072 6164 6961 6c5f 7061 7261 6d73     radial_params
+00017670: 3a20 556e 696f 6e5b 4172 7261 794c 696b  : Union[ArrayLik
+00017680: 652c 2074 6f72 6368 2e54 656e 736f 725d  e, torch.Tensor]
+00017690: 203d 206c 6973 7428 292c 0a20 2020 2020   = list(),.     
+000176a0: 2020 2020 2020 2020 2020 2020 626f 785f              box_
+000176b0: 7369 7a65 3a20 4f70 7469 6f6e 616c 5b55  size: Optional[U
+000176c0: 6e69 6f6e 5b41 7272 6179 4c69 6b65 2c20  nion[ArrayLike, 
+000176d0: 746f 7263 682e 5465 6e73 6f72 5d5d 203d  torch.Tensor]] =
+000176e0: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
+000176f0: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
+00017700: 293a 0a20 2020 2020 2020 2022 2222 496e  ):.        """In
+00017710: 6974 6961 6c69 7a65 2074 6869 7320 6c61  itialize this la
+00017720: 7965 722e 0a0a 2020 2020 2020 2020 5061  yer...        Pa
+00017730: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+00017740: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00017750: 2020 2020 6174 6f6d 5f74 7970 6573 203a      atom_types :
+00017760: 2055 6e69 6f6e 5b41 7272 6179 4c69 6b65   Union[ArrayLike
+00017770: 2c20 746f 7263 682e 5465 6e73 6f72 5d2c  , torch.Tensor],
+00017780: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+00017790: 2020 2020 2020 4c69 7374 206f 6620 6174        List of at
+000177a0: 6f6d 2074 7970 6573 2e0a 2020 2020 2020  om types..      
+000177b0: 2020 7261 6469 616c 5f70 6172 616d 7320    radial_params 
+000177c0: 3a20 556e 696f 6e5b 4172 7261 794c 696b  : Union[ArrayLik
+000177d0: 652c 2074 6f72 6368 2e54 656e 736f 725d  e, torch.Tensor]
+000177e0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+000177f0: 2020 2020 2020 204c 6973 7420 6f66 2072         List of r
+00017800: 6164 6961 6c20 7061 7261 6d73 2e0a 2020  adial params..  
+00017810: 2020 2020 2020 626f 785f 7369 7a65 203a        box_size :
+00017820: 2055 6e69 6f6e 5b41 7272 6179 4c69 6b65   Union[ArrayLike
+00017830: 2c20 746f 7263 682e 5465 6e73 6f72 5d2c  , torch.Tensor],
+00017840: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+00017850: 2020 2020 2020 4c65 6e67 7468 206d 7573        Length mus
+00017860: 7420 6265 2065 7175 616c 2074 6f20 7468  t be equal to th
+00017870: 6520 6e75 6d62 6572 206f 6620 6665 6174  e number of feat
+00017880: 7572 6573 2e0a 2020 2020 2020 2020 2222  ures..        ""
+00017890: 220a 0a20 2020 2020 2020 2073 7570 6572  "..        super
+000178a0: 2841 746f 6d69 6343 6f6e 766f 6c75 7469  (AtomicConvoluti
+000178b0: 6f6e 2c20 7365 6c66 292e 5f5f 696e 6974  on, self).__init
+000178c0: 5f5f 282a 2a6b 7761 7267 7329 0a20 2020  __(**kwargs).   
+000178d0: 2020 2020 2073 656c 662e 6174 6f6d 5f74       self.atom_t
+000178e0: 7970 6573 203d 2061 746f 6d5f 7479 7065  ypes = atom_type
+000178f0: 730a 2020 2020 2020 2020 7365 6c66 2e72  s.        self.r
+00017900: 6164 6961 6c5f 7061 7261 6d73 203d 2072  adial_params = r
+00017910: 6164 6961 6c5f 7061 7261 6d73 0a0a 2020  adial_params..  
+00017920: 2020 2020 2020 6966 2062 6f78 5f73 697a        if box_siz
+00017930: 6520 6973 204e 6f6e 6520 6f72 2069 7369  e is None or isi
+00017940: 6e73 7461 6e63 6528 626f 785f 7369 7a65  nstance(box_size
+00017950: 2c20 746f 7263 682e 5465 6e73 6f72 293a  , torch.Tensor):
+00017960: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00017970: 662e 626f 785f 7369 7a65 203d 2062 6f78  f.box_size = box
+00017980: 5f73 697a 650a 2020 2020 2020 2020 656c  _size.        el
+00017990: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000179a0: 7365 6c66 2e62 6f78 5f73 697a 6520 3d20  self.box_size = 
+000179b0: 746f 7263 682e 7465 6e73 6f72 2862 6f78  torch.tensor(box
+000179c0: 5f73 697a 6529 0a0a 2020 2020 2020 2020  _size)..        
+000179d0: 7661 7273 203d 205b 5d0a 2020 2020 2020  vars = [].      
+000179e0: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
+000179f0: 2833 293a 0a20 2020 2020 2020 2020 2020  (3):.           
+00017a00: 2076 616c 203d 206e 702e 6172 7261 7928   val = np.array(
+00017a10: 5b70 5b69 5d20 666f 7220 7020 696e 2073  [p[i] for p in s
+00017a20: 656c 662e 7261 6469 616c 5f70 6172 616d  elf.radial_param
+00017a30: 735d 292e 7265 7368 6170 6528 0a20 2020  s]).reshape(.   
+00017a40: 2020 2020 2020 2020 2020 2020 2028 2d31               (-1
+00017a50: 2c20 312c 2031 2c20 3129 290a 2020 2020  , 1, 1, 1)).    
+00017a60: 2020 2020 2020 2020 7661 7273 2e61 7070          vars.app
+00017a70: 656e 6428 746f 7263 682e 7465 6e73 6f72  end(torch.tensor
+00017a80: 2876 616c 2c20 6474 7970 653d 746f 7263  (val, dtype=torc
+00017a90: 682e 666c 6f61 7429 290a 2020 2020 2020  h.float)).      
+00017aa0: 2020 7365 6c66 2e72 6320 3d20 6e6e 2e50    self.rc = nn.P
+00017ab0: 6172 616d 6574 6572 2876 6172 735b 305d  arameter(vars[0]
+00017ac0: 290a 2020 2020 2020 2020 7365 6c66 2e72  ).        self.r
+00017ad0: 7320 3d20 6e6e 2e50 6172 616d 6574 6572  s = nn.Parameter
+00017ae0: 2876 6172 735b 315d 290a 2020 2020 2020  (vars[1]).      
+00017af0: 2020 7365 6c66 2e72 6520 3d20 6e6e 2e50    self.re = nn.P
+00017b00: 6172 616d 6574 6572 2876 6172 735b 325d  arameter(vars[2]
+00017b10: 290a 0a20 2020 2064 6566 205f 5f72 6570  )..    def __rep
+00017b20: 725f 5f28 7365 6c66 293a 0a20 2020 2020  r__(self):.     
+00017b30: 2020 2072 6574 7572 6e20 280a 2020 2020     return (.    
+00017b40: 2020 2020 2020 2020 6627 7b73 656c 662e          f'{self.
+00017b50: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+00017b60: 5f5f 7d28 6174 6f6d 5f74 7970 6573 3d7b  __}(atom_types={
+00017b70: 7365 6c66 2e61 746f 6d5f 7479 7065 737d  self.atom_types}
+00017b80: 2c20 7261 6469 616c 5f70 6172 616d 733d  , radial_params=
+00017b90: 7b73 656c 662e 7261 6469 616c 5f70 6172  {self.radial_par
+00017ba0: 616d 737d 2c20 626f 785f 7369 7a65 3d7b  ams}, box_size={
+00017bb0: 7365 6c66 2e62 6f78 5f73 697a 657d 2c20  self.box_size}, 
+00017bc0: 7263 3d7b 7365 6c66 2e72 637d 2c20 7273  rc={self.rc}, rs
+00017bd0: 3d7b 7365 6c66 2e72 737d 2c20 7265 3d7b  ={self.rs}, re={
+00017be0: 7365 6c66 2e72 657d 2927 0a20 2020 2020  self.re})'.     
+00017bf0: 2020 2029 0a0a 2020 2020 6465 6620 666f     )..    def fo
+00017c00: 7277 6172 6428 0a20 2020 2020 2020 2020  rward(.         
+00017c10: 2020 2073 656c 662c 2069 6e70 7574 733a     self, inputs:
+00017c20: 2053 6571 7565 6e63 655b 556e 696f 6e5b   Sequence[Union[
+00017c30: 4172 7261 794c 696b 652c 0a20 2020 2020  ArrayLike,.     
+00017c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c60: 2020 2020 746f 7263 682e 5465 6e73 6f72      torch.Tensor
+00017c70: 5d5d 2920 2d3e 2074 6f72 6368 2e54 656e  ]]) -> torch.Ten
+00017c80: 736f 723a 0a20 2020 2020 2020 2022 2222  sor:.        """
+00017c90: 496e 766f 6b65 2074 6869 7320 6c61 7965  Invoke this laye
+00017ca0: 722e 0a0a 2020 2020 2020 2020 422c 204e  r...        B, N
+00017cb0: 2c20 4d2c 2064 2c20 6c20 3d20 6261 7463  , M, d, l = batc
+00017cc0: 685f 7369 7a65 2c20 6d61 785f 6e75 6d5f  h_size, max_num_
+00017cd0: 6174 6f6d 732c 206d 6178 5f6e 756d 5f6e  atoms, max_num_n
+00017ce0: 6569 6768 626f 7273 2c20 6e75 6d5f 6665  eighbors, num_fe
+00017cf0: 6174 7572 6573 2c20 6c65 6e28 7261 6469  atures, len(radi
+00017d00: 616c 5f70 6172 616d 7329 202a 206c 656e  al_params) * len
+00017d10: 2861 746f 6d5f 7479 7065 7329 0a0a 2020  (atom_types)..  
+00017d20: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+00017d30: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00017d40: 2d2d 2d0a 2020 2020 2020 2020 696e 7075  ---.        inpu
+00017d50: 7473 3a20 5365 7175 656e 6365 5b55 6e69  ts: Sequence[Uni
+00017d60: 6f6e 5b41 7272 6179 4c69 6b65 2c20 746f  on[ArrayLike, to
+00017d70: 7263 682e 5465 6e73 6f72 5d5d 0a20 2020  rch.Tensor]].   
+00017d80: 2020 2020 2020 2020 2046 6972 7374 2069           First i
+00017d90: 6e70 7574 2061 7265 2074 6865 2063 6f6f  nput are the coo
+00017da0: 7264 696e 6174 6573 2f66 6561 7475 7265  rdinates/feature
+00017db0: 732c 206f 6620 7368 6170 6520 2842 2c20  s, of shape (B, 
+00017dc0: 4e2c 2064 290a 2020 2020 2020 2020 2020  N, d).          
+00017dd0: 2020 5365 636f 6e64 2069 6e70 7574 2069    Second input i
+00017de0: 7320 7468 6520 6e65 6967 6862 6f72 206c  s the neighbor l
+00017df0: 6973 742c 206f 6620 7368 6170 6520 2842  ist, of shape (B
+00017e00: 2c20 4e2c 204d 290a 2020 2020 2020 2020  , N, M).        
+00017e10: 2020 2020 5468 6972 6420 696e 7075 7420      Third input 
+00017e20: 6172 6520 7468 6520 6174 6f6d 6963 206e  are the atomic n
+00017e30: 756d 6265 7273 206f 6620 6e65 6967 6862  umbers of neighb
+00017e40: 6f72 2061 746f 6d73 2c20 6f66 2073 6861  or atoms, of sha
+00017e50: 7065 2028 422c 204e 2c20 4d29 0a0a 2020  pe (B, N, M)..  
+00017e60: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
+00017e70: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
+00017e80: 2020 2020 2020 746f 7263 682e 5465 6e73        torch.Tens
+00017e90: 6f72 206f 6620 7368 6170 6520 2842 2c20  or of shape (B, 
+00017ea0: 4e2c 206c 290a 2020 2020 2020 2020 2020  N, l).          
+00017eb0: 2020 4f75 7470 7574 206f 6620 6174 6f6d    Output of atom
+00017ec0: 6963 2063 6f6e 766f 6c75 7469 6f6e 206c  ic convolution l
+00017ed0: 6179 6572 2e0a 0a20 2020 2020 2020 2052  ayer...        R
+00017ee0: 6169 7365 730a 2020 2020 2020 2020 2d2d  aises.        --
+00017ef0: 2d2d 2d2d 0a20 2020 2020 2020 2056 616c  ----.        Val
+00017f00: 7565 4572 726f 720a 2020 2020 2020 2020  ueError.        
+00017f10: 2020 2020 5768 656e 2074 6865 206c 656e      When the len
+00017f20: 6774 6820 6f66 2060 696e 7075 7473 6020  gth of `inputs` 
+00017f30: 6973 206e 6f74 2065 7175 616c 2074 6f20  is not equal to 
+00017f40: 332e 0a20 2020 2020 2020 2022 2222 0a20  3..        """. 
+00017f50: 2020 2020 2020 2069 6620 6c65 6e28 696e         if len(in
+00017f60: 7075 7473 2920 213d 2033 3a0a 2020 2020  puts) != 3:.    
+00017f70: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00017f80: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+00017f90: 2020 2020 2020 2020 2020 6622 6069 6e70            f"`inp
+00017fa0: 7574 7360 2068 6173 2074 6f20 6265 206f  uts` has to be o
+00017fb0: 6620 6c65 6e67 7468 2033 2c20 676f 743a  f length 3, got:
+00017fc0: 207b 6c65 6e28 696e 7075 7473 297d 2229   {len(inputs)}")
+00017fd0: 0a0a 2020 2020 2020 2020 5820 3d20 746f  ..        X = to
+00017fe0: 7263 682e 7465 6e73 6f72 2869 6e70 7574  rch.tensor(input
+00017ff0: 735b 305d 290a 2020 2020 2020 2020 4e62  s[0]).        Nb
+00018000: 7273 203d 2074 6f72 6368 2e74 656e 736f  rs = torch.tenso
+00018010: 7228 696e 7075 7473 5b31 5d2c 2064 7479  r(inputs[1], dty
+00018020: 7065 3d74 6f72 6368 2e69 6e74 3634 290a  pe=torch.int64).
+00018030: 2020 2020 2020 2020 4e62 7273 5f5a 203d          Nbrs_Z =
+00018040: 2074 6f72 6368 2e74 656e 736f 7228 696e   torch.tensor(in
+00018050: 7075 7473 5b32 5d29 0a0a 2020 2020 2020  puts[2])..      
+00018060: 2020 422c 204e 2c20 6420 3d20 582e 7368    B, N, d = X.sh
+00018070: 6170 650a 2020 2020 2020 2020 4d20 3d20  ape.        M = 
+00018080: 4e62 7273 2e73 6861 7065 5b2d 315d 0a0a  Nbrs.shape[-1]..
+00018090: 2020 2020 2020 2020 4420 3d20 7365 6c66          D = self
+000180a0: 2e64 6973 7461 6e63 655f 7465 6e73 6f72  .distance_tensor
+000180b0: 2858 2c20 4e62 7273 2c20 7365 6c66 2e62  (X, Nbrs, self.b
+000180c0: 6f78 5f73 697a 652c 2042 2c20 4e2c 204d  ox_size, B, N, M
+000180d0: 2c20 6429 0a20 2020 2020 2020 2052 203d  , d).        R =
+000180e0: 2073 656c 662e 6469 7374 616e 6365 5f6d   self.distance_m
+000180f0: 6174 7269 7828 4429 0a20 2020 2020 2020  atrix(D).       
+00018100: 2052 203d 2074 6f72 6368 2e75 6e73 7175   R = torch.unsqu
+00018110: 6565 7a65 2852 2c20 3029 0a20 2020 2020  eeze(R, 0).     
+00018120: 2020 2072 7366 203d 2073 656c 662e 7261     rsf = self.ra
+00018130: 6469 616c 5f73 796d 6d65 7472 795f 6675  dial_symmetry_fu
+00018140: 6e63 7469 6f6e 2852 2c20 7365 6c66 2e72  nction(R, self.r
+00018150: 632c 2073 656c 662e 7273 2c20 7365 6c66  c, self.rs, self
+00018160: 2e72 6529 0a0a 2020 2020 2020 2020 6966  .re)..        if
+00018170: 206e 6f74 2073 656c 662e 6174 6f6d 5f74   not self.atom_t
+00018180: 7970 6573 3a0a 2020 2020 2020 2020 2020  ypes:.          
+00018190: 2020 636f 6e64 203d 2074 6f72 6368 2e6e    cond = torch.n
+000181a0: 6f74 5f65 7175 616c 284e 6272 735f 5a2c  ot_equal(Nbrs_Z,
+000181b0: 2030 292e 746f 2874 6f72 6368 2e66 6c6f   0).to(torch.flo
+000181c0: 6174 292e 7265 7368 6170 6528 0a20 2020  at).reshape(.   
+000181d0: 2020 2020 2020 2020 2020 2020 2028 312c               (1,
+000181e0: 202d 312c 204e 2c20 4d29 290a 2020 2020   -1, N, M)).    
+000181f0: 2020 2020 2020 2020 6c61 7965 7220 3d20          layer = 
+00018200: 746f 7263 682e 7375 6d28 636f 6e64 202a  torch.sum(cond *
+00018210: 2072 7366 2c20 3329 0a20 2020 2020 2020   rsf, 3).       
+00018220: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00018230: 2020 2023 2053 756d 2074 6865 2070 6169     # Sum the pai
+00018240: 7277 6973 652d 696e 7465 7261 6374 696f  rwise-interactio
+00018250: 6e73 2062 6574 7765 656e 2061 746f 6d73  ns between atoms
+00018260: 2074 6861 7420 6172 6520 6f66 2060 6174   that are of `at
+00018270: 6f6d 5f74 7970 6560 2061 6e64 2069 7473  om_type` and its
+00018280: 206e 6569 6768 626f 7273 2066 6f72 2065   neighbors for e
+00018290: 6163 6820 6174 6f6d 2074 7970 6520 696e  ach atom type in
+000182a0: 2060 6174 6f6d 5f74 7970 6573 602e 0a20   `atom_types`.. 
+000182b0: 2020 2020 2020 2020 2020 2073 796d 6d65             symme
+000182c0: 7472 6965 7320 3d20 5b5d 0a20 2020 2020  tries = [].     
+000182d0: 2020 2020 2020 2066 6f72 2061 746f 6d5f         for atom_
+000182e0: 7479 7065 2069 6e20 7365 6c66 2e61 746f  type in self.ato
+000182f0: 6d5f 7479 7065 733a 0a20 2020 2020 2020  m_types:.       
+00018300: 2020 2020 2020 2020 2063 6f6e 6420 3d20           cond = 
+00018310: 746f 7263 682e 6571 284e 6272 735f 5a2c  torch.eq(Nbrs_Z,
+00018320: 2061 746f 6d5f 7479 7065 292e 746f 2874   atom_type).to(t
+00018330: 6f72 6368 2e66 6c6f 6174 292e 7265 7368  orch.float).resh
+00018340: 6170 6528 0a20 2020 2020 2020 2020 2020  ape(.           
+00018350: 2020 2020 2020 2020 2028 312c 202d 312c           (1, -1,
+00018360: 204e 2c20 4d29 290a 2020 2020 2020 2020   N, M)).        
+00018370: 2020 2020 2020 2020 7379 6d6d 6574 7269          symmetri
+00018380: 6573 2e61 7070 656e 6428 746f 7263 682e  es.append(torch.
+00018390: 7375 6d28 636f 6e64 202a 2072 7366 2c20  sum(cond * rsf, 
+000183a0: 3329 290a 2020 2020 2020 2020 2020 2020  3)).            
+000183b0: 6c61 7965 7220 3d20 746f 7263 682e 636f  layer = torch.co
+000183c0: 6e63 6174 2873 796d 6d65 7472 6965 732c  ncat(symmetries,
+000183d0: 2030 290a 0a20 2020 2020 2020 206c 6179   0)..        lay
+000183e0: 6572 203d 2074 6f72 6368 2e70 6572 6d75  er = torch.permu
+000183f0: 7465 286c 6179 6572 2c20 5b31 2c20 322c  te(layer, [1, 2,
+00018400: 2030 5d29 0a20 2020 2020 2020 2076 6172   0]).        var
+00018410: 2c20 6d65 616e 203d 2074 6f72 6368 2e76  , mean = torch.v
+00018420: 6172 5f6d 6561 6e28 6c61 7965 722c 205b  ar_mean(layer, [
+00018430: 302c 2032 5d29 0a20 2020 2020 2020 2076  0, 2]).        v
+00018440: 6172 2c20 6d65 616e 203d 2076 6172 2e64  ar, mean = var.d
+00018450: 6574 6163 6828 292c 206d 6561 6e2e 6465  etach(), mean.de
+00018460: 7461 6368 2829 0a0a 2020 2020 2020 2020  tach()..        
+00018470: 7265 7475 726e 2046 2e62 6174 6368 5f6e  return F.batch_n
+00018480: 6f72 6d28 6c61 7965 722c 206d 6561 6e2c  orm(layer, mean,
+00018490: 2076 6172 290a 0a20 2020 2064 6566 2064   var)..    def d
+000184a0: 6973 7461 6e63 655f 7465 6e73 6f72 2873  istance_tensor(s
+000184b0: 656c 662c 2058 3a20 746f 7263 682e 5465  elf, X: torch.Te
+000184c0: 6e73 6f72 2c20 4e62 7273 3a20 746f 7263  nsor, Nbrs: torc
+000184d0: 682e 5465 6e73 6f72 2c0a 2020 2020 2020  h.Tensor,.      
+000184e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000184f0: 2020 626f 785f 7369 7a65 3a20 556e 696f    box_size: Unio
+00018500: 6e5b 746f 7263 682e 5465 6e73 6f72 2c20  n[torch.Tensor, 
+00018510: 4e6f 6e65 5d2c 2042 3a20 696e 742c 204e  None], B: int, N
+00018520: 3a20 696e 742c 0a20 2020 2020 2020 2020  : int,.         
+00018530: 2020 2020 2020 2020 2020 2020 2020 204d                 M
+00018540: 3a20 696e 742c 2064 3a20 696e 7429 202d  : int, d: int) -
+00018550: 3e20 746f 7263 682e 5465 6e73 6f72 3a0a  > torch.Tensor:.
+00018560: 2020 2020 2020 2020 2222 2243 616c 6375          """Calcu
+00018570: 6c61 7465 2064 6973 7461 6e63 6520 7465  late distance te
+00018580: 6e73 6f72 2066 6f72 2061 2062 6174 6368  nsor for a batch
+00018590: 206f 6620 6d6f 6c65 6375 6c65 732e 0a0a   of molecules...
+000185a0: 2020 2020 2020 2020 422c 204e 2c20 4d2c          B, N, M,
+000185b0: 2064 203d 2062 6174 6368 5f73 697a 652c   d = batch_size,
+000185c0: 206d 6178 5f6e 756d 5f61 746f 6d73 2c20   max_num_atoms, 
+000185d0: 6d61 785f 6e75 6d5f 6e65 6967 6862 6f72  max_num_neighbor
+000185e0: 732c 206e 756d 5f66 6561 7475 7265 730a  s, num_features.
+000185f0: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+00018600: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
+00018610: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2058  ------.        X
+00018620: 203a 2074 6f72 6368 2e54 656e 736f 7220   : torch.Tensor 
+00018630: 6f66 2073 6861 7065 2028 422c 204e 2c20  of shape (B, N, 
+00018640: 6429 0a20 2020 2020 2020 2020 2020 2043  d).            C
+00018650: 6f6f 7264 696e 6174 6573 2f66 6561 7475  oordinates/featu
+00018660: 7265 732e 0a20 2020 2020 2020 204e 6272  res..        Nbr
+00018670: 7320 3a20 746f 7263 682e 5465 6e73 6f72  s : torch.Tensor
+00018680: 206f 6620 7368 6170 6520 2842 2c20 4e2c   of shape (B, N,
+00018690: 204d 290a 2020 2020 2020 2020 2020 2020   M).            
+000186a0: 4e65 6967 6862 6f72 206c 6973 742e 0a20  Neighbor list.. 
+000186b0: 2020 2020 2020 2062 6f78 5f73 697a 6520         box_size 
+000186c0: 3a20 746f 7263 682e 5465 6e73 6f72 0a20  : torch.Tensor. 
+000186d0: 2020 2020 2020 2020 2020 204c 656e 6774             Lengt
+000186e0: 6820 6d75 7374 2062 6520 6571 7561 6c20  h must be equal 
+000186f0: 746f 2060 6460 2e0a 2020 2020 2020 2020  to `d`..        
+00018700: 4220 3a20 696e 740a 2020 2020 2020 2020  B : int.        
+00018710: 2020 2020 4261 7463 6820 7369 7a65 0a20      Batch size. 
+00018720: 2020 2020 2020 204e 203a 2069 6e74 0a20         N : int. 
+00018730: 2020 2020 2020 2020 2020 204d 6178 696d             Maxim
+00018740: 756d 206e 756d 6265 7220 6f66 2061 746f  um number of ato
+00018750: 6d73 0a20 2020 2020 2020 204d 203a 2069  ms.        M : i
+00018760: 6e74 0a20 2020 2020 2020 2020 2020 204d  nt.            M
+00018770: 6178 696d 756d 206e 756d 6265 7220 6f66  aximum number of
+00018780: 206e 6569 6768 626f 7273 0a20 2020 2020   neighbors.     
+00018790: 2020 2064 203a 2069 6e74 0a20 2020 2020     d : int.     
+000187a0: 2020 2020 2020 204e 756d 6265 7220 6f66         Number of
+000187b0: 2066 6561 7475 7265 730a 0a20 2020 2020   features..     
+000187c0: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
+000187d0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
+000187e0: 2020 2074 6f72 6368 2e54 656e 736f 7220     torch.Tensor 
+000187f0: 6f66 2073 6861 7065 2028 422c 204e 2c20  of shape (B, N, 
+00018800: 4d2c 2064 290a 2020 2020 2020 2020 2020  M, d).          
+00018810: 2020 436f 6f72 6469 6e61 7465 732f 6665    Coordinates/fe
+00018820: 6174 7572 6573 2064 6973 7461 6e63 6520  atures distance 
+00018830: 7465 6e73 6f72 2e0a 0a20 2020 2020 2020  tensor...       
+00018840: 2052 6169 7365 730a 2020 2020 2020 2020   Raises.        
+00018850: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2056  ------.        V
+00018860: 616c 7565 4572 726f 720a 2020 2020 2020  alueError.      
+00018870: 2020 2020 2020 5768 656e 2074 6865 206c        When the l
+00018880: 656e 6774 6820 6f66 2060 626f 785f 7369  ength of `box_si
+00018890: 7a65 6020 6973 206e 6f74 2065 7175 616c  ze` is not equal
+000188a0: 2074 6f20 6064 602e 0a20 2020 2020 2020   to `d`..       
+000188b0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+000188c0: 626f 785f 7369 7a65 2069 7320 6e6f 7420  box_size is not 
+000188d0: 4e6f 6e65 2061 6e64 206c 656e 2862 6f78  None and len(box
+000188e0: 5f73 697a 6529 2021 3d20 643a 0a20 2020  _size) != d:.   
+000188f0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00018900: 616c 7565 4572 726f 7228 224c 656e 6774  alueError("Lengt
+00018910: 6820 6f66 2060 626f 785f 7369 7a65 6020  h of `box_size` 
+00018920: 6d75 7374 2062 6520 6571 7561 6c20 746f  must be equal to
+00018930: 2060 6460 2229 0a0a 2020 2020 2020 2020   `d`")..        
+00018940: 666c 6174 5f6e 6569 6768 626f 7273 203d  flat_neighbors =
+00018950: 2074 6f72 6368 2e72 6573 6861 7065 284e   torch.reshape(N
+00018960: 6272 732c 2028 2d31 2c20 4e20 2a20 4d29  brs, (-1, N * M)
+00018970: 290a 2020 2020 2020 2020 6e65 6967 6862  ).        neighb
+00018980: 6f72 5f63 6f6f 7264 7320 3d20 746f 7263  or_coords = torc
+00018990: 682e 7374 6163 6b28 0a20 2020 2020 2020  h.stack(.       
+000189a0: 2020 2020 205b 585b 622c 2066 6c61 745f       [X[b, flat_
+000189b0: 6e65 6967 6862 6f72 735b 625d 5d20 666f  neighbors[b]] fo
+000189c0: 7220 6220 696e 2072 616e 6765 2842 295d  r b in range(B)]
+000189d0: 290a 2020 2020 2020 2020 6e65 6967 6862  ).        neighb
+000189e0: 6f72 5f63 6f6f 7264 7320 3d20 746f 7263  or_coords = torc
+000189f0: 682e 7265 7368 6170 6528 6e65 6967 6862  h.reshape(neighb
+00018a00: 6f72 5f63 6f6f 7264 732c 2028 2d31 2c20  or_coords, (-1, 
+00018a10: 4e2c 204d 2c20 6429 290a 2020 2020 2020  N, M, d)).      
+00018a20: 2020 4420 3d20 6e65 6967 6862 6f72 5f63    D = neighbor_c
+00018a30: 6f6f 7264 7320 2d20 746f 7263 682e 756e  oords - torch.un
+00018a40: 7371 7565 657a 6528 582c 2032 290a 2020  squeeze(X, 2).  
+00018a50: 2020 2020 2020 6966 2062 6f78 5f73 697a        if box_siz
+00018a60: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
+00018a70: 2020 2020 2020 2020 2020 2062 6f78 5f73             box_s
+00018a80: 697a 6520 3d20 746f 7263 682e 7265 7368  ize = torch.resh
+00018a90: 6170 6528 626f 785f 7369 7a65 2c20 2831  ape(box_size, (1
+00018aa0: 2c20 312c 2031 2c20 6429 290a 2020 2020  , 1, 1, d)).    
+00018ab0: 2020 2020 2020 2020 4420 2d3d 2074 6f72          D -= tor
+00018ac0: 6368 2e72 6f75 6e64 2844 202f 2062 6f78  ch.round(D / box
+00018ad0: 5f73 697a 6529 202a 2062 6f78 5f73 697a  _size) * box_siz
+00018ae0: 650a 0a20 2020 2020 2020 2072 6574 7572  e..        retur
+00018af0: 6e20 440a 0a20 2020 2064 6566 2064 6973  n D..    def dis
+00018b00: 7461 6e63 655f 6d61 7472 6978 2873 656c  tance_matrix(sel
+00018b10: 662c 2044 3a20 746f 7263 682e 5465 6e73  f, D: torch.Tens
+00018b20: 6f72 2920 2d3e 2074 6f72 6368 2e54 656e  or) -> torch.Ten
+00018b30: 736f 723a 0a20 2020 2020 2020 2022 2222  sor:.        """
+00018b40: 4361 6c63 756c 6174 6520 6120 6469 7374  Calculate a dist
+00018b50: 616e 6365 206d 6174 7269 782c 2067 6976  ance matrix, giv
+00018b60: 656e 2061 2064 6973 7461 6e63 6520 7465  en a distance te
+00018b70: 6e73 6f72 2e0a 0a20 2020 2020 2020 2042  nsor...        B
+00018b80: 2c20 4e2c 204d 2c20 6420 3d20 6261 7463  , N, M, d = batc
+00018b90: 685f 7369 7a65 2c20 6d61 785f 6e75 6d5f  h_size, max_num_
+00018ba0: 6174 6f6d 732c 206d 6178 5f6e 756d 5f6e  atoms, max_num_n
+00018bb0: 6569 6768 626f 7273 2c20 6e75 6d5f 6665  eighbors, num_fe
+00018bc0: 6174 7572 6573 0a0a 2020 2020 2020 2020  atures..        
+00018bd0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+00018be0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+00018bf0: 2020 2020 2020 4420 3a20 746f 7263 682e        D : torch.
+00018c00: 5465 6e73 6f72 206f 6620 7368 6170 6520  Tensor of shape 
+00018c10: 2842 2c20 4e2c 204d 2c20 6429 0a20 2020  (B, N, M, d).   
+00018c20: 2020 2020 2020 2020 2044 6973 7461 6e63           Distanc
+00018c30: 6520 7465 6e73 6f72 0a0a 2020 2020 2020  e tensor..      
+00018c40: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+00018c50: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
+00018c60: 2020 746f 7263 682e 5465 6e73 6f72 206f    torch.Tensor o
+00018c70: 6620 7368 6170 6520 2842 2c20 4e2c 204d  f shape (B, N, M
+00018c80: 290a 2020 2020 2020 2020 2020 2020 4469  ).            Di
+00018c90: 7374 616e 6365 206d 6174 7269 782e 0a20  stance matrix.. 
+00018ca0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00018cb0: 2020 2072 6574 7572 6e20 746f 7263 682e     return torch.
+00018cc0: 7371 7274 2874 6f72 6368 2e73 756d 2874  sqrt(torch.sum(t
+00018cd0: 6f72 6368 2e6d 756c 2844 2c20 4429 2c20  orch.mul(D, D), 
+00018ce0: 3329 290a 0a20 2020 2064 6566 2067 6175  3))..    def gau
+00018cf0: 7373 6961 6e5f 6469 7374 616e 6365 5f6d  ssian_distance_m
+00018d00: 6174 7269 7828 7365 6c66 2c20 523a 2074  atrix(self, R: t
+00018d10: 6f72 6368 2e54 656e 736f 722c 2072 733a  orch.Tensor, rs:
+00018d20: 2074 6f72 6368 2e54 656e 736f 722c 0a20   torch.Tensor,. 
+00018d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d50: 7265 3a20 746f 7263 682e 5465 6e73 6f72  re: torch.Tensor
+00018d60: 2920 2d3e 2074 6f72 6368 2e54 656e 736f  ) -> torch.Tenso
+00018d70: 723a 0a20 2020 2020 2020 2022 2222 4361  r:.        """Ca
+00018d80: 6c63 756c 6174 6520 6120 4761 7573 7369  lculate a Gaussi
+00018d90: 616e 2064 6973 7461 6e63 6520 6d61 7472  an distance matr
+00018da0: 6978 2e0a 0a20 2020 2020 2020 2042 2c20  ix...        B, 
+00018db0: 4e2c 204d 2c20 6c20 3d20 6261 7463 685f  N, M, l = batch_
+00018dc0: 7369 7a65 2c20 6d61 785f 6e75 6d5f 6174  size, max_num_at
+00018dd0: 6f6d 732c 206d 6178 5f6e 756d 5f6e 6569  oms, max_num_nei
+00018de0: 6768 626f 7273 2c20 6c65 6e28 7261 6469  ghbors, len(radi
+00018df0: 616c 5f70 6172 616d 7329 0a0a 2020 2020  al_params)..    
+00018e00: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+00018e10: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+00018e20: 2d0a 2020 2020 2020 2020 5220 3a20 746f  -.        R : to
+00018e30: 7263 682e 5465 6e73 6f72 206f 6620 7368  rch.Tensor of sh
+00018e40: 6170 6520 2842 2c20 4e2c 204d 290a 2020  ape (B, N, M).  
+00018e50: 2020 2020 2020 2020 2020 4469 7374 616e            Distan
+00018e60: 6365 206d 6174 7269 782e 0a20 2020 2020  ce matrix..     
+00018e70: 2020 2072 7320 3a20 746f 7263 682e 5465     rs : torch.Te
+00018e80: 6e73 6f72 206f 6620 7368 6170 6520 286c  nsor of shape (l
+00018e90: 2c20 312c 2031 2c20 3129 0a20 2020 2020  , 1, 1, 1).     
+00018ea0: 2020 2020 2020 2047 6175 7373 6961 6e20         Gaussian 
+00018eb0: 6469 7374 616e 6365 206d 6174 7269 7820  distance matrix 
+00018ec0: 6d65 616e 2e0a 2020 2020 2020 2020 7265  mean..        re
+00018ed0: 203a 2074 6f72 6368 2e54 656e 736f 7220   : torch.Tensor 
+00018ee0: 6f66 2073 6861 7065 2028 6c2c 2031 2c20  of shape (l, 1, 
+00018ef0: 312c 2031 290a 2020 2020 2020 2020 2020  1, 1).          
+00018f00: 2020 4761 7573 7369 616e 2064 6973 7461    Gaussian dista
+00018f10: 6e63 6520 6d61 7472 6978 2077 6964 7468  nce matrix width
+00018f20: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00018f30: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
+00018f40: 2d2d 0a20 2020 2020 2020 2074 6f72 6368  --.        torch
+00018f50: 2e54 656e 736f 7220 6f66 2073 6861 7065  .Tensor of shape
+00018f60: 2028 422c 204e 2c20 4d29 0a20 2020 2020   (B, N, M).     
+00018f70: 2020 2020 2020 2047 6175 7373 6961 6e20         Gaussian 
+00018f80: 6469 7374 616e 6365 206d 6174 7269 782e  distance matrix.
+00018f90: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00018fa0: 2020 2020 2072 6574 7572 6e20 746f 7263       return torc
+00018fb0: 682e 6578 7028 2d72 6520 2a20 2852 202d  h.exp(-re * (R -
+00018fc0: 2072 7329 2a2a 3229 0a0a 2020 2020 6465   rs)**2)..    de
+00018fd0: 6620 7261 6469 616c 5f63 7574 6f66 6628  f radial_cutoff(
+00018fe0: 7365 6c66 2c20 523a 2074 6f72 6368 2e54  self, R: torch.T
+00018ff0: 656e 736f 722c 2072 633a 2074 6f72 6368  ensor, rc: torch
+00019000: 2e54 656e 736f 7229 202d 3e20 746f 7263  .Tensor) -> torc
+00019010: 682e 5465 6e73 6f72 3a0a 2020 2020 2020  h.Tensor:.      
+00019020: 2020 2222 2243 616c 6375 6c61 7465 2061    """Calculate a
+00019030: 2072 6164 6961 6c20 6375 742d 6f66 6620   radial cut-off 
+00019040: 6d61 7472 6978 2e0a 0a20 2020 2020 2020  matrix...       
+00019050: 2042 2c20 4e2c 204d 2c20 6c20 3d20 6261   B, N, M, l = ba
+00019060: 7463 685f 7369 7a65 2c20 6d61 785f 6e75  tch_size, max_nu
+00019070: 6d5f 6174 6f6d 732c 206d 6178 5f6e 756d  m_atoms, max_num
+00019080: 5f6e 6569 6768 626f 7273 2c20 6c65 6e28  _neighbors, len(
+00019090: 7261 6469 616c 5f70 6172 616d 7329 0a0a  radial_params)..
+000190a0: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+000190b0: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+000190c0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 5220  -----.        R 
+000190d0: 3a20 746f 7263 682e 5465 6e73 6f72 206f  : torch.Tensor o
+000190e0: 6620 7368 6170 6520 2842 2c20 4e2c 204d  f shape (B, N, M
+000190f0: 290a 2020 2020 2020 2020 2020 2020 4469  ).            Di
+00019100: 7374 616e 6365 206d 6174 7269 782e 0a20  stance matrix.. 
+00019110: 2020 2020 2020 2072 6320 3a20 746f 7263         rc : torc
+00019120: 682e 5465 6e73 6f72 206f 6620 7368 6170  h.Tensor of shap
+00019130: 6520 286c 2c20 312c 2031 2c20 3129 0a20  e (l, 1, 1, 1). 
+00019140: 2020 2020 2020 2020 2020 2049 6e74 6572             Inter
+00019150: 6163 7469 6f6e 2063 7574 6f66 6620 2869  action cutoff (i
+00019160: 6e20 616e 6773 7472 6f6d 292e 0a0a 2020  n angstrom)...  
+00019170: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
+00019180: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
+00019190: 2020 2020 2020 746f 7263 682e 5465 6e73        torch.Tens
+000191a0: 6f72 206f 6620 7368 6170 6520 2842 2c20  or of shape (B, 
+000191b0: 4e2c 204d 290a 2020 2020 2020 2020 2020  N, M).          
+000191c0: 2020 5261 6469 616c 2063 7574 6f66 6620    Radial cutoff 
+000191d0: 6d61 7472 6978 2e0a 2020 2020 2020 2020  matrix..        
+000191e0: 2222 220a 2020 2020 2020 2020 5420 3d20  """.        T = 
+000191f0: 302e 3520 2a20 2874 6f72 6368 2e63 6f73  0.5 * (torch.cos
+00019200: 286e 702e 7069 202a 2052 202f 2072 6329  (np.pi * R / rc)
+00019210: 202b 2031 290a 2020 2020 2020 2020 4520   + 1).        E 
+00019220: 3d20 746f 7263 682e 7a65 726f 735f 6c69  = torch.zeros_li
+00019230: 6b65 2854 290a 2020 2020 2020 2020 636f  ke(T).        co
+00019240: 6e64 203d 2074 6f72 6368 2e6c 6573 735f  nd = torch.less_
+00019250: 6571 7561 6c28 522c 2072 6329 0a20 2020  equal(R, rc).   
+00019260: 2020 2020 2046 4320 3d20 746f 7263 682e       FC = torch.
+00019270: 7768 6572 6528 636f 6e64 2c20 542c 2045  where(cond, T, E
+00019280: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+00019290: 6e20 4643 0a0a 2020 2020 6465 6620 7261  n FC..    def ra
+000192a0: 6469 616c 5f73 796d 6d65 7472 795f 6675  dial_symmetry_fu
+000192b0: 6e63 7469 6f6e 2873 656c 662c 2052 3a20  nction(self, R: 
+000192c0: 746f 7263 682e 5465 6e73 6f72 2c20 7263  torch.Tensor, rc
+000192d0: 3a20 746f 7263 682e 5465 6e73 6f72 2c0a  : torch.Tensor,.
+000192e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000192f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019300: 2072 733a 2074 6f72 6368 2e54 656e 736f   rs: torch.Tenso
+00019310: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00019320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019330: 2020 2020 7265 3a20 746f 7263 682e 5465      re: torch.Te
+00019340: 6e73 6f72 2920 2d3e 2074 6f72 6368 2e54  nsor) -> torch.T
+00019350: 656e 736f 723a 0a20 2020 2020 2020 2022  ensor:.        "
+00019360: 2222 4361 6c63 756c 6174 6520 6120 7261  ""Calculate a ra
+00019370: 6469 616c 2073 796d 6d65 7472 7920 6675  dial symmetry fu
+00019380: 6e63 7469 6f6e 2e0a 0a20 2020 2020 2020  nction...       
+00019390: 2042 2c20 4e2c 204d 2c20 6c20 3d20 6261   B, N, M, l = ba
+000193a0: 7463 685f 7369 7a65 2c20 6d61 785f 6e75  tch_size, max_nu
+000193b0: 6d5f 6174 6f6d 732c 206d 6178 5f6e 756d  m_atoms, max_num
+000193c0: 5f6e 6569 6768 626f 7273 2c20 6c65 6e28  _neighbors, len(
+000193d0: 7261 6469 616c 5f70 6172 616d 7329 0a0a  radial_params)..
+000193e0: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+000193f0: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+00019400: 2d2d 2d2d 2d0a 2020 2020 2020 2020 5220  -----.        R 
+00019410: 3a20 746f 7263 682e 5465 6e73 6f72 206f  : torch.Tensor o
+00019420: 6620 7368 6170 6520 2842 2c20 4e2c 204d  f shape (B, N, M
+00019430: 290a 2020 2020 2020 2020 2020 2020 4469  ).            Di
+00019440: 7374 616e 6365 206d 6174 7269 782e 0a20  stance matrix.. 
+00019450: 2020 2020 2020 2072 6320 3a20 746f 7263         rc : torc
+00019460: 682e 5465 6e73 6f72 206f 6620 7368 6170  h.Tensor of shap
+00019470: 6520 286c 2c20 312c 2031 2c20 3129 0a20  e (l, 1, 1, 1). 
+00019480: 2020 2020 2020 2020 2020 2049 6e74 6572             Inter
+00019490: 6163 7469 6f6e 2063 7574 6f66 6620 2869  action cutoff (i
+000194a0: 6e20 616e 6773 7472 6f6d 292e 0a20 2020  n angstrom)..   
+000194b0: 2020 2020 2072 7320 3a20 746f 7263 682e       rs : torch.
+000194c0: 5465 6e73 6f72 206f 6620 7368 6170 6520  Tensor of shape 
+000194d0: 286c 2c20 312c 2031 2c20 3129 0a20 2020  (l, 1, 1, 1).   
+000194e0: 2020 2020 2020 2020 2047 6175 7373 6961           Gaussia
+000194f0: 6e20 6469 7374 616e 6365 206d 6174 7269  n distance matri
+00019500: 7820 6d65 616e 2e0a 2020 2020 2020 2020  x mean..        
+00019510: 7265 203a 2074 6f72 6368 2e54 656e 736f  re : torch.Tenso
+00019520: 7220 6f66 2073 6861 7065 2028 6c2c 2031  r of shape (l, 1
+00019530: 2c20 312c 2031 290a 2020 2020 2020 2020  , 1, 1).        
+00019540: 2020 2020 4761 7573 7369 616e 2064 6973      Gaussian dis
+00019550: 7461 6e63 6520 6d61 7472 6978 2077 6964  tance matrix wid
+00019560: 7468 2e0a 2020 2020 2020 2020 5265 7475  th..        Retu
+00019570: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
+00019580: 2d2d 2d0a 2020 2020 2020 2020 746f 7263  ---.        torc
+00019590: 682e 5465 6e73 6f72 206f 6620 7368 6170  h.Tensor of shap
+000195a0: 6520 2842 2c20 4e2c 204d 290a 2020 2020  e (B, N, M).    
+000195b0: 2020 2020 2020 2020 5072 652d 7375 6d6d          Pre-summ
+000195c0: 6174 696f 6e20 7261 6469 616c 2073 796d  ation radial sym
+000195d0: 6d65 7472 7920 6675 6e63 7469 6f6e 2e0a  metry function..
+000195e0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000195f0: 2020 2020 4b20 3d20 7365 6c66 2e67 6175      K = self.gau
+00019600: 7373 6961 6e5f 6469 7374 616e 6365 5f6d  ssian_distance_m
+00019610: 6174 7269 7828 522c 2072 732c 2072 6529  atrix(R, rs, re)
+00019620: 0a20 2020 2020 2020 2046 4320 3d20 7365  .        FC = se
+00019630: 6c66 2e72 6164 6961 6c5f 6375 746f 6666  lf.radial_cutoff
+00019640: 2852 2c20 7263 290a 0a20 2020 2020 2020  (R, rc)..       
+00019650: 2072 6574 7572 6e20 746f 7263 682e 6d75   return torch.mu
+00019660: 6c28 4b2c 2046 4329 0a0a 0a63 6c61 7373  l(K, FC)...class
+00019670: 2043 6f6d 6269 6e65 4d65 616e 5374 6428   CombineMeanStd(
+00019680: 6e6e 2e4d 6f64 756c 6529 3a0a 2020 2020  nn.Module):.    
+00019690: 2222 2247 656e 6572 6174 6520 4761 7573  """Generate Gaus
+000196a0: 7369 616e 206e 6f69 7365 2e0a 0a20 2020  sian noise...   
+000196b0: 2054 6869 7320 6973 2074 6865 2054 6f72   This is the Tor
+000196c0: 6368 2065 7175 6976 616c 656e 7420 6f66  ch equivalent of
+000196d0: 2074 6865 206f 7269 6769 6e61 6c20 696d   the original im
+000196e0: 706c 656d 656e 7461 7469 6f6e 2075 7369  plementation usi
+000196f0: 6e67 204b 6572 6173 2e0a 2020 2020 2222  ng Keras..    ""
+00019700: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
+00019710: 745f 5f28 7365 6c66 2c0a 2020 2020 2020  t__(self,.      
+00019720: 2020 2020 2020 2020 2020 2074 7261 696e             train
+00019730: 696e 675f 6f6e 6c79 3a20 626f 6f6c 203d  ing_only: bool =
+00019740: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
+00019750: 2020 2020 2020 2020 206e 6f69 7365 5f65           noise_e
+00019760: 7073 696c 6f6e 3a20 666c 6f61 7420 3d20  psilon: float = 
+00019770: 312e 302c 0a20 2020 2020 2020 2020 2020  1.0,.           
+00019780: 2020 2020 2020 2a2a 6b77 6172 6773 293a        **kwargs):
+00019790: 0a20 2020 2020 2020 2022 2222 4372 6561  .        """Crea
+000197a0: 7465 2061 2043 6f6d 6269 6e65 4d65 616e  te a CombineMean
+000197b0: 5374 6420 6c61 7965 722e 0a0a 2020 2020  Std layer...    
+000197c0: 2020 2020 5468 6973 206c 6179 6572 2073      This layer s
+000197d0: 686f 756c 6420 6861 7665 2074 776f 2069  hould have two i
+000197e0: 6e70 7574 7320 7769 7468 2074 6865 2073  nputs with the s
+000197f0: 616d 6520 7368 6170 652c 2061 6e64 2069  ame shape, and i
+00019800: 7473 0a20 2020 2020 2020 206f 7574 7075  ts.        outpu
+00019810: 7420 616c 736f 2068 6173 2074 6865 2073  t also has the s
+00019820: 616d 6520 7368 6170 652e 2020 4561 6368  ame shape.  Each
+00019830: 2065 6c65 6d65 6e74 206f 6620 7468 6520   element of the 
+00019840: 6f75 7470 7574 2069 7320 610a 2020 2020  output is a.    
+00019850: 2020 2020 4761 7573 7369 616e 2064 6973      Gaussian dis
+00019860: 7472 6962 7574 6564 2072 616e 646f 6d20  tributed random 
+00019870: 6e75 6d62 6572 2077 686f 7365 206d 6561  number whose mea
+00019880: 6e20 6973 2074 6865 2063 6f72 7265 7370  n is the corresp
+00019890: 6f6e 6469 6e67 0a20 2020 2020 2020 2065  onding.        e
+000198a0: 6c65 6d65 6e74 206f 6620 7468 6520 6669  lement of the fi
+000198b0: 7273 7420 696e 7075 742c 2061 6e64 2077  rst input, and w
+000198c0: 686f 7365 2073 7461 6e64 6172 6420 6465  hose standard de
+000198d0: 7669 6174 696f 6e20 6973 2074 6865 0a20  viation is the. 
+000198e0: 2020 2020 2020 2063 6f72 7265 7370 6f6e         correspon
+000198f0: 6469 6e67 2065 6c65 6d65 6e74 206f 6620  ding element of 
+00019900: 7468 6520 7365 636f 6e64 2069 6e70 7574  the second input
+00019910: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+00019920: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+00019930: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00019940: 2074 7261 696e 696e 675f 6f6e 6c79 3a20   training_only: 
+00019950: 626f 6f6c 2c20 6f70 7469 6f6e 616c 2028  bool, optional (
+00019960: 6465 6661 756c 7420 4661 6c73 6529 2e0a  default False)..
+00019970: 2020 2020 2020 2020 2020 2020 6966 2054              if T
+00019980: 7275 652c 206e 6f69 7365 2069 7320 6f6e  rue, noise is on
+00019990: 6c79 2067 656e 6572 6174 6564 2064 7572  ly generated dur
+000199a0: 696e 6720 7472 6169 6e69 6e67 2e20 2044  ing training.  D
+000199b0: 7572 696e 670a 2020 2020 2020 2020 2020  uring.          
+000199c0: 2020 7072 6564 6963 7469 6f6e 2c20 7468    prediction, th
+000199d0: 6520 6f75 7470 7574 2069 7320 7369 6d70  e output is simp
+000199e0: 6c79 2065 7175 616c 2074 6f20 7468 6520  ly equal to the 
+000199f0: 6669 7273 7420 696e 7075 7420 2874 6861  first input (tha
+00019a00: 740a 2020 2020 2020 2020 2020 2020 6973  t.            is
+00019a10: 2c20 7468 6520 6d65 616e 206f 6620 7468  , the mean of th
+00019a20: 6520 6469 7374 7269 6275 7469 6f6e 2075  e distribution u
+00019a30: 7365 6420 6475 7269 6e67 2074 7261 696e  sed during train
+00019a40: 696e 6729 2e0a 2020 2020 2020 2020 6e6f  ing)..        no
+00019a50: 6973 655f 6570 7369 6c6f 6e3a 2066 6c6f  ise_epsilon: flo
+00019a60: 6174 2c20 6f70 7469 6f6e 616c 2028 6465  at, optional (de
+00019a70: 6661 756c 7420 312e 3029 2e0a 2020 2020  fault 1.0)..    
+00019a80: 2020 2020 2020 2020 5468 6520 6e6f 6973          The nois
+00019a90: 6520 6973 2073 6361 6c65 6420 6279 2074  e is scaled by t
+00019aa0: 6869 7320 6661 6374 6f72 0a20 2020 2020  his factor.     
+00019ab0: 2020 2022 2222 0a20 2020 2020 2020 2073     """.        s
+00019ac0: 7570 6572 2843 6f6d 6269 6e65 4d65 616e  uper(CombineMean
+00019ad0: 5374 642c 2073 656c 6629 2e5f 5f69 6e69  Std, self).__ini
+00019ae0: 745f 5f28 2a2a 6b77 6172 6773 290a 2020  t__(**kwargs).  
+00019af0: 2020 2020 2020 7365 6c66 2e74 7261 696e        self.train
+00019b00: 696e 675f 6f6e 6c79 203d 2074 7261 696e  ing_only = train
+00019b10: 696e 675f 6f6e 6c79 0a20 2020 2020 2020  ing_only.       
+00019b20: 2073 656c 662e 6e6f 6973 655f 6570 7369   self.noise_epsi
+00019b30: 6c6f 6e20 3d20 6e6f 6973 655f 6570 7369  lon = noise_epsi
+00019b40: 6c6f 6e0a 0a20 2020 2064 6566 205f 5f72  lon..    def __r
+00019b50: 6570 725f 5f28 7365 6c66 2920 2d3e 2073  epr__(self) -> s
+00019b60: 7472 3a0a 2020 2020 2020 2020 7265 7475  tr:.        retu
+00019b70: 726e 2028 0a20 2020 2020 2020 2020 2020  rn (.           
+00019b80: 2066 277b 7365 6c66 2e5f 5f63 6c61 7373   f'{self.__class
+00019b90: 5f5f 2e5f 5f6e 616d 655f 5f7d 2874 7261  __.__name__}(tra
+00019ba0: 696e 696e 675f 6f6e 6c79 3d7b 7365 6c66  ining_only={self
+00019bb0: 2e74 7261 696e 696e 675f 6f6e 6c79 7d2c  .training_only},
+00019bc0: 206e 6f69 7365 5f65 7073 696c 6f6e 3d7b   noise_epsilon={
+00019bd0: 7365 6c66 2e6e 6f69 7365 5f65 7073 696c  self.noise_epsil
+00019be0: 6f6e 7d29 270a 2020 2020 2020 2020 290a  on})'.        ).
+00019bf0: 0a20 2020 2064 6566 2066 6f72 7761 7264  .    def forward
+00019c00: 2873 656c 662c 0a20 2020 2020 2020 2020  (self,.         
+00019c10: 2020 2020 2020 2069 6e70 7574 733a 2053         inputs: S
+00019c20: 6571 7565 6e63 655b 4172 7261 794c 696b  equence[ArrayLik
+00019c30: 655d 2c0a 2020 2020 2020 2020 2020 2020  e],.            
+00019c40: 2020 2020 7472 6169 6e69 6e67 3a20 626f      training: bo
+00019c50: 6f6c 203d 2054 7275 6529 202d 3e20 746f  ol = True) -> to
+00019c60: 7263 682e 5465 6e73 6f72 3a0a 2020 2020  rch.Tensor:.    
+00019c70: 2020 2020 2222 2249 6e76 6f6b 6520 7468      """Invoke th
+00019c80: 6973 206c 6179 6572 2e0a 0a20 2020 2020  is layer...     
+00019c90: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00019ca0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00019cb0: 0a20 2020 2020 2020 2069 6e70 7574 733a  .        inputs:
+00019cc0: 2053 6571 7565 6e63 655b 4172 7261 794c   Sequence[ArrayL
+00019cd0: 696b 655d 0a20 2020 2020 2020 2020 2020  ike].           
+00019ce0: 2046 6972 7374 2065 6c65 6d65 6e74 2061   First element a
+00019cf0: 7265 2074 6865 206d 6561 6e73 2066 6f72  re the means for
+00019d00: 2074 6865 2072 616e 646f 6d20 6765 6e65   the random gene
+00019d10: 7261 7465 6420 6e75 6d62 6572 732e 0a20  rated numbers.. 
+00019d20: 2020 2020 2020 2020 2020 2053 6563 6f6e             Secon
+00019d30: 6420 656c 656d 656e 7420 6172 6520 7468  d element are th
+00019d40: 6520 7374 616e 6461 7264 2064 6576 6961  e standard devia
+00019d50: 7469 6f6e 7320 666f 7220 7468 6520 7261  tions for the ra
+00019d60: 6e64 6f6d 2067 656e 6572 6174 6564 206e  ndom generated n
+00019d70: 756d 6265 7273 2e0a 2020 2020 2020 2020  umbers..        
+00019d80: 7472 6169 6e69 6e67 3a20 626f 6f6c 2c20  training: bool, 
+00019d90: 6f70 7469 6f6e 616c 2028 6465 6661 756c  optional (defaul
+00019da0: 7420 5472 7565 292e 0a20 2020 2020 2020  t True)..       
+00019db0: 2020 2020 2053 7065 6369 6669 6573 2077       Specifies w
+00019dc0: 6865 7468 6572 2074 6f20 6765 6e65 7261  hether to genera
+00019dd0: 7465 206e 6f69 7365 2e0a 2020 2020 2020  te noise..      
+00019de0: 2020 2020 2020 4e6f 6973 6520 6973 206f        Noise is o
+00019df0: 6e6c 7920 6164 6465 6420 7768 656e 2074  nly added when t
+00019e00: 7261 696e 696e 672e 0a0a 2020 2020 2020  raining...      
+00019e10: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+00019e20: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
+00019e30: 2020 5465 6e73 6f72 206f 6620 4761 7573    Tensor of Gaus
+00019e40: 7369 616e 2064 6973 7472 6962 7574 6564  sian distributed
+00019e50: 2072 616e 646f 6d20 6e75 6d62 6572 733a   random numbers:
+00019e60: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
+00019e70: 2020 2020 2020 2020 2020 5361 6d65 2073            Same s
+00019e80: 6861 7065 2061 7320 7468 6520 6d65 616e  hape as the mean
+00019e90: 7320 616e 6420 7374 616e 6461 7264 2064  s and standard d
+00019ea0: 6576 6961 7469 6f6e 7320 6672 6f6d 2060  eviations from `
+00019eb0: 696e 7075 7473 602e 0a20 2020 2020 2020  inputs`..       
+00019ec0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+00019ed0: 6c65 6e28 696e 7075 7473 2920 213d 2032  len(inputs) != 2
+00019ee0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00019ef0: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
+00019f00: 4d75 7374 2068 6176 6520 7477 6f20 696e  Must have two in
+00019f10: 5f6c 6179 6572 7322 290a 0a20 2020 2020  _layers")..     
+00019f20: 2020 206d 6561 6e5f 7061 7265 6e74 2c20     mean_parent, 
+00019f30: 7374 645f 7061 7265 6e74 203d 2074 6f72  std_parent = tor
+00019f40: 6368 2e74 656e 736f 7228 696e 7075 7473  ch.tensor(inputs
+00019f50: 5b30 5d29 2c20 746f 7263 682e 7465 6e73  [0]), torch.tens
+00019f60: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+00019f70: 696e 7075 7473 5b31 5d29 0a20 2020 2020  inputs[1]).     
+00019f80: 2020 206e 6f69 7365 5f73 6361 6c65 203d     noise_scale =
+00019f90: 2074 6f72 6368 2e74 656e 736f 7228 7472   torch.tensor(tr
+00019fa0: 6169 6e69 6e67 206f 720a 2020 2020 2020  aining or.      
+00019fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019fc0: 2020 2020 2020 2020 2020 2020 206e 6f74               not
+00019fd0: 2073 656c 662e 7472 6169 6e69 6e67 5f6f   self.training_o
+00019fe0: 6e6c 7929 2e74 6f28 746f 7263 682e 666c  nly).to(torch.fl
+00019ff0: 6f61 7429 0a20 2020 2020 2020 2073 616d  oat).        sam
+0001a000: 706c 655f 6e6f 6973 6520 3d20 746f 7263  ple_noise = torc
+0001a010: 682e 6e6f 726d 616c 2830 2e30 2c20 7365  h.normal(0.0, se
+0001a020: 6c66 2e6e 6f69 7365 5f65 7073 696c 6f6e  lf.noise_epsilon
+0001a030: 2c20 6d65 616e 5f70 6172 656e 742e 7368  , mean_parent.sh
+0001a040: 6170 6529 0a20 2020 2020 2020 2072 6574  ape).        ret
+0001a050: 7572 6e20 6d65 616e 5f70 6172 656e 7420  urn mean_parent 
+0001a060: 2b20 6e6f 6973 655f 7363 616c 6520 2a20  + noise_scale * 
+0001a070: 7374 645f 7061 7265 6e74 202a 2073 616d  std_parent * sam
+0001a080: 706c 655f 6e6f 6973 650a 0a0a 636c 6173  ple_noise...clas
+0001a090: 7320 4761 7465 6452 6563 7572 7265 6e74  s GatedRecurrent
+0001a0a0: 556e 6974 286e 6e2e 4d6f 6475 6c65 293a  Unit(nn.Module):
+0001a0b0: 0a20 2020 2022 2222 2053 7562 6d6f 6475  .    """ Submodu
+0001a0c0: 6c65 2066 6f72 204d 6573 7361 6765 2050  le for Message P
+0001a0d0: 6173 7369 6e67 2022 2222 0a0a 2020 2020  assing """..    
+0001a0e0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+0001a0f0: 662c 206e 5f68 6964 6465 6e3d 3130 302c  f, n_hidden=100,
+0001a100: 2069 6e69 743d 2778 6176 6965 725f 756e   init='xavier_un
+0001a110: 6966 6f72 6d5f 272c 202a 2a6b 7761 7267  iform_', **kwarg
+0001a120: 7329 3a0a 2020 2020 2020 2020 7375 7065  s):.        supe
+0001a130: 7228 4761 7465 6452 6563 7572 7265 6e74  r(GatedRecurrent
+0001a140: 556e 6974 2c20 7365 6c66 292e 5f5f 696e  Unit, self).__in
+0001a150: 6974 5f5f 282a 2a6b 7761 7267 7329 0a20  it__(**kwargs). 
+0001a160: 2020 2020 2020 2073 656c 662e 6e5f 6869         self.n_hi
+0001a170: 6464 656e 203d 206e 5f68 6964 6465 6e0a  dden = n_hidden.
+0001a180: 2020 2020 2020 2020 7365 6c66 2e69 6e69          self.ini
+0001a190: 7420 3d20 696e 6974 0a20 2020 2020 2020  t = init.       
+0001a1a0: 2069 6e69 7420 3d20 6765 7461 7474 7228   init = getattr(
+0001a1b0: 696e 6974 6961 6c69 7a65 7273 2c20 7365  initializers, se
+0001a1c0: 6c66 2e69 6e69 7429 0a20 2020 2020 2020  lf.init).       
+0001a1d0: 2073 656c 662e 577a 203d 2069 6e69 7428   self.Wz = init(
+0001a1e0: 746f 7263 682e 656d 7074 7928 6e5f 6869  torch.empty(n_hi
+0001a1f0: 6464 656e 2c20 6e5f 6869 6464 656e 2929  dden, n_hidden))
+0001a200: 0a20 2020 2020 2020 2073 656c 662e 5772  .        self.Wr
+0001a210: 203d 2069 6e69 7428 746f 7263 682e 656d   = init(torch.em
+0001a220: 7074 7928 6e5f 6869 6464 656e 2c20 6e5f  pty(n_hidden, n_
+0001a230: 6869 6464 656e 2929 0a20 2020 2020 2020  hidden)).       
+0001a240: 2073 656c 662e 5768 203d 2069 6e69 7428   self.Wh = init(
+0001a250: 746f 7263 682e 656d 7074 7928 6e5f 6869  torch.empty(n_hi
+0001a260: 6464 656e 2c20 6e5f 6869 6464 656e 2929  dden, n_hidden))
+0001a270: 0a20 2020 2020 2020 2073 656c 662e 557a  .        self.Uz
+0001a280: 203d 2069 6e69 7428 746f 7263 682e 656d   = init(torch.em
+0001a290: 7074 7928 6e5f 6869 6464 656e 2c20 6e5f  pty(n_hidden, n_
+0001a2a0: 6869 6464 656e 2929 0a20 2020 2020 2020  hidden)).       
+0001a2b0: 2073 656c 662e 5572 203d 2069 6e69 7428   self.Ur = init(
+0001a2c0: 746f 7263 682e 656d 7074 7928 6e5f 6869  torch.empty(n_hi
+0001a2d0: 6464 656e 2c20 6e5f 6869 6464 656e 2929  dden, n_hidden))
+0001a2e0: 0a20 2020 2020 2020 2073 656c 662e 5568  .        self.Uh
+0001a2f0: 203d 2069 6e69 7428 746f 7263 682e 656d   = init(torch.em
+0001a300: 7074 7928 6e5f 6869 6464 656e 2c20 6e5f  pty(n_hidden, n_
+0001a310: 6869 6464 656e 2929 0a20 2020 2020 2020  hidden)).       
+0001a320: 2073 656c 662e 627a 203d 2074 6f72 6368   self.bz = torch
+0001a330: 2e7a 6572 6f73 2828 6e5f 6869 6464 656e  .zeros((n_hidden
+0001a340: 2c29 290a 2020 2020 2020 2020 7365 6c66  ,)).        self
+0001a350: 2e62 7220 3d20 746f 7263 682e 7a65 726f  .br = torch.zero
+0001a360: 7328 286e 5f68 6964 6465 6e2c 2929 0a20  s((n_hidden,)). 
+0001a370: 2020 2020 2020 2073 656c 662e 6268 203d         self.bh =
+0001a380: 2074 6f72 6368 2e7a 6572 6f73 2828 6e5f   torch.zeros((n_
+0001a390: 6869 6464 656e 2c29 290a 0a20 2020 2064  hidden,))..    d
+0001a3a0: 6566 2066 6f72 7761 7264 2873 656c 662c  ef forward(self,
+0001a3b0: 2069 6e70 7574 7329 3a0a 2020 2020 2020   inputs):.      
+0001a3c0: 2020 7369 676d 6f69 6420 3d20 6765 745f    sigmoid = get_
+0001a3d0: 6163 7469 7661 7469 6f6e 2827 7369 676d  activation('sigm
+0001a3e0: 6f69 6427 290a 2020 2020 2020 2020 7461  oid').        ta
+0001a3f0: 6e68 203d 2067 6574 5f61 6374 6976 6174  nh = get_activat
+0001a400: 696f 6e28 2774 616e 6827 290a 2020 2020  ion('tanh').    
+0001a410: 2020 2020 685f 746d 312c 2078 203d 2069      h_tm1, x = i
+0001a420: 6e70 7574 730a 2020 2020 2020 2020 7a20  nputs.        z 
+0001a430: 3d20 7369 676d 6f69 6428 0a20 2020 2020  = sigmoid(.     
+0001a440: 2020 2020 2020 2074 6f72 6368 2e6d 6174         torch.mat
+0001a450: 6d75 6c28 782c 2073 656c 662e 577a 2920  mul(x, self.Wz) 
+0001a460: 2b20 746f 7263 682e 6d61 746d 756c 2868  + torch.matmul(h
+0001a470: 5f74 6d31 2c20 7365 6c66 2e55 7a29 202b  _tm1, self.Uz) +
+0001a480: 2073 656c 662e 627a 290a 2020 2020 2020   self.bz).      
+0001a490: 2020 7220 3d20 7369 676d 6f69 6428 0a20    r = sigmoid(. 
+0001a4a0: 2020 2020 2020 2020 2020 2074 6f72 6368             torch
+0001a4b0: 2e6d 6174 6d75 6c28 782c 2073 656c 662e  .matmul(x, self.
+0001a4c0: 5772 2920 2b20 746f 7263 682e 6d61 746d  Wr) + torch.matm
+0001a4d0: 756c 2868 5f74 6d31 2c20 7365 6c66 2e55  ul(h_tm1, self.U
+0001a4e0: 7229 202b 2073 656c 662e 6272 290a 2020  r) + self.br).  
+0001a4f0: 2020 2020 2020 6820 3d20 2831 202d 207a        h = (1 - z
+0001a500: 2920 2a20 7461 6e68 280a 2020 2020 2020  ) * tanh(.      
+0001a510: 2020 2020 2020 746f 7263 682e 6d61 746d        torch.matm
+0001a520: 756c 2878 2c20 7365 6c66 2e57 6829 202b  ul(x, self.Wh) +
+0001a530: 2074 6f72 6368 2e6d 6174 6d75 6c28 685f   torch.matmul(h_
+0001a540: 746d 3120 2a20 722c 2073 656c 662e 5568  tm1 * r, self.Uh
+0001a550: 2920 2b0a 2020 2020 2020 2020 2020 2020  ) +.            
+0001a560: 7365 6c66 2e62 6829 202b 207a 202a 2078  self.bh) + z * x
+0001a570: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001a580: 680a 0a0a 636c 6173 7320 5765 6967 6874  h...class Weight
+0001a590: 6564 4c69 6e65 6172 436f 6d62 6f28 6e6e  edLinearCombo(nn
+0001a5a0: 2e4d 6f64 756c 6529 3a0a 2020 2020 2222  .Module):.    ""
+0001a5b0: 2243 6f6d 7075 7465 2061 2077 6569 6768  "Compute a weigh
+0001a5c0: 7465 6420 6c69 6e65 6172 2063 6f6d 6269  ted linear combi
+0001a5d0: 6e61 7469 6f6e 206f 6620 696e 7075 7420  nation of input 
+0001a5e0: 6c61 7965 7273 2c20 7768 6572 6520 7468  layers, where th
+0001a5f0: 6520 7765 6967 6874 2076 6172 6961 626c  e weight variabl
+0001a600: 6573 2061 7265 2074 7261 696e 6564 2e0a  es are trained..
+0001a610: 0a20 2020 2045 7861 6d70 6c65 730a 2020  .    Examples.  
+0001a620: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e    --------.    >
+0001a630: 3e3e 2069 6e70 7574 3120 3d20 6e70 2e72  >> input1 = np.r
+0001a640: 616e 646f 6d2e 7261 6e64 2835 2c20 3130  andom.rand(5, 10
+0001a650: 292e 6173 7479 7065 286e 702e 666c 6f61  ).astype(np.floa
+0001a660: 7433 3229 0a20 2020 203e 3e3e 2069 6e70  t32).    >>> inp
+0001a670: 7574 3220 3d20 6e70 2e72 616e 646f 6d2e  ut2 = np.random.
+0001a680: 7261 6e64 2835 2c20 3130 292e 6173 7479  rand(5, 10).asty
+0001a690: 7065 286e 702e 666c 6f61 7433 3229 0a20  pe(np.float32). 
+0001a6a0: 2020 203e 3e3e 206c 6179 6572 203d 2057     >>> layer = W
+0001a6b0: 6569 6768 7465 644c 696e 6561 7243 6f6d  eightedLinearCom
+0001a6c0: 626f 286c 656e 285b 696e 7075 7431 2c20  bo(len([input1, 
+0001a6d0: 696e 7075 7432 5d29 290a 2020 2020 3e3e  input2])).    >>
+0001a6e0: 3e20 7265 7375 6c74 203d 206c 6179 6572  > result = layer
+0001a6f0: 285b 696e 7075 7431 2c20 696e 7075 7432  ([input1, input2
+0001a700: 5d29 0a20 2020 203e 3e3e 2072 6573 756c  ]).    >>> resul
+0001a710: 742e 7368 6170 650a 2020 2020 746f 7263  t.shape.    torc
+0001a720: 682e 5369 7a65 285b 352c 2031 305d 290a  h.Size([5, 10]).
+0001a730: 2020 2020 2222 220a 0a20 2020 2064 6566      """..    def
+0001a740: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
+0001a750: 6e75 6d5f 696e 7075 7473 3a20 696e 742c  num_inputs: int,
+0001a760: 2073 7464 3a20 666c 6f61 7420 3d20 302e   std: float = 0.
+0001a770: 332c 202a 2a6b 7761 7267 7329 3a0a 2020  3, **kwargs):.  
+0001a780: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+0001a790: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+0001a7a0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+0001a7b0: 0a20 2020 2020 2020 206e 756d 5f69 6e70  .        num_inp
+0001a7c0: 7574 733a 2069 6e74 0a20 2020 2020 2020  uts: int.       
+0001a7d0: 2020 2020 204e 756d 6265 7220 6f66 2069       Number of i
+0001a7e0: 6e70 7574 7320 6769 7665 6e20 746f 2060  nputs given to `
+0001a7f0: 7365 6c66 2e66 6f72 7761 7264 2829 600a  self.forward()`.
+0001a800: 2020 2020 2020 2020 2020 2020 5468 6973              This
+0001a810: 2069 7320 7573 6564 2074 6f20 696e 6974   is used to init
+0001a820: 6961 6c69 7a65 2074 6865 2063 6f72 7265  ialize the corre
+0001a830: 6374 2061 6d6f 756e 7420 6f66 2077 6569  ct amount of wei
+0001a840: 6768 7420 7661 7269 6162 6c65 7320 746f  ght variables to
+0001a850: 2062 6520 7472 6169 6e65 642e 0a20 2020   be trained..   
+0001a860: 2020 2020 2073 7464 3a20 666c 6f61 740a       std: float.
+0001a870: 2020 2020 2020 2020 2020 2020 5468 6520              The 
+0001a880: 7374 616e 6461 7264 2064 6576 6961 7469  standard deviati
+0001a890: 6f6e 2066 6f72 2074 6865 206e 6f72 6d61  on for the norma
+0001a8a0: 6c20 6469 7374 7269 6275 7469 6f6e 2074  l distribution t
+0001a8b0: 6861 7420 6973 2075 7365 6420 746f 2069  hat is used to i
+0001a8c0: 6e69 7469 616c 697a 6520 7468 6520 7472  nitialize the tr
+0001a8d0: 6169 6e61 626c 6520 7765 6967 6874 732e  ainable weights.
+0001a8e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001a8f0: 2020 2020 2073 7570 6572 2857 6569 6768       super(Weigh
+0001a900: 7465 644c 696e 6561 7243 6f6d 626f 2c20  tedLinearCombo, 
+0001a910: 7365 6c66 292e 5f5f 696e 6974 5f5f 282a  self).__init__(*
+0001a920: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
+0001a930: 2073 656c 662e 6e75 6d5f 696e 7075 7473   self.num_inputs
+0001a940: 203d 206e 756d 5f69 6e70 7574 730a 2020   = num_inputs.  
+0001a950: 2020 2020 2020 7365 6c66 2e73 7464 203d        self.std =
+0001a960: 2073 7464 0a20 2020 2020 2020 2073 656c   std.        sel
+0001a970: 662e 696e 7075 745f 7765 6967 6874 7320  f.input_weights 
+0001a980: 3d20 6e6e 2e50 6172 616d 6574 6572 2874  = nn.Parameter(t
+0001a990: 6f72 6368 2e65 6d70 7479 2873 656c 662e  orch.empty(self.
+0001a9a0: 6e75 6d5f 696e 7075 7473 2929 0a20 2020  num_inputs)).   
+0001a9b0: 2020 2020 206e 6e2e 696e 6974 2e6e 6f72       nn.init.nor
+0001a9c0: 6d61 6c5f 2873 656c 662e 696e 7075 745f  mal_(self.input_
+0001a9d0: 7765 6967 6874 732c 2073 7464 3d73 7464  weights, std=std
+0001a9e0: 290a 0a20 2020 2064 6566 205f 5f72 6570  )..    def __rep
+0001a9f0: 725f 5f28 7365 6c66 293a 0a20 2020 2020  r__(self):.     
+0001aa00: 2020 2072 6574 7572 6e20 280a 2020 2020     return (.    
+0001aa10: 2020 2020 2020 2020 6627 7b73 656c 662e          f'{self.
+0001aa20: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+0001aa30: 5f5f 7d28 6e75 6d5f 696e 7075 7473 3d7b  __}(num_inputs={
+0001aa40: 7365 6c66 2e6e 756d 5f69 6e70 7574 737d  self.num_inputs}
+0001aa50: 2c20 7374 643d 7b73 656c 662e 7374 647d  , std={self.std}
+0001aa60: 2c20 696e 7075 745f 7765 6967 6874 733d  , input_weights=
+0001aa70: 7b73 656c 662e 696e 7075 745f 7765 6967  {self.input_weig
+0001aa80: 6874 737d 2927 0a20 2020 2020 2020 2029  hts})'.        )
+0001aa90: 0a0a 2020 2020 6465 6620 666f 7277 6172  ..    def forwar
+0001aaa0: 6428 0a20 2020 2020 2020 2073 656c 662c  d(.        self,
+0001aab0: 2069 6e70 7574 733a 2053 6571 7565 6e63   inputs: Sequenc
+0001aac0: 655b 556e 696f 6e5b 4172 7261 794c 696b  e[Union[ArrayLik
+0001aad0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0001aae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aaf0: 2020 2020 2020 2020 746f 7263 682e 5465          torch.Te
+0001ab00: 6e73 6f72 5d5d 2920 2d3e 204f 7074 696f  nsor]]) -> Optio
+0001ab10: 6e61 6c5b 746f 7263 682e 5465 6e73 6f72  nal[torch.Tensor
+0001ab20: 5d3a 0a20 2020 2020 2020 2022 2222 0a20  ]:.        """. 
+0001ab30: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+0001ab40: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+0001ab50: 2d2d 2d2d 0a20 2020 2020 2020 2069 6e70  ----.        inp
+0001ab60: 7574 733a 2053 6571 7565 6e63 655b 556e  uts: Sequence[Un
+0001ab70: 696f 6e5b 4172 7261 794c 696b 652c 2074  ion[ArrayLike, t
+0001ab80: 6f72 6368 2e54 656e 736f 725d 5d0a 2020  orch.Tensor]].  
+0001ab90: 2020 2020 2020 2020 2020 5468 6520 696e            The in
+0001aba0: 6974 6961 6c20 696e 7075 7420 6c61 7965  itial input laye
+0001abb0: 7273 2e0a 2020 2020 2020 2020 2020 2020  rs..            
+0001abc0: 5468 6520 6c65 6e67 7468 206d 7573 7420  The length must 
+0001abd0: 6265 2074 6865 2073 616d 6520 6173 2060  be the same as `
+0001abe0: 7365 6c66 2e6e 756d 5f69 6e70 7574 7360  self.num_inputs`
+0001abf0: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+0001ac00: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
+0001ac10: 2d2d 0a20 2020 2020 2020 206f 7574 5f74  --.        out_t
+0001ac20: 656e 736f 723a 2074 6f72 6368 2e54 656e  ensor: torch.Ten
+0001ac30: 736f 7220 6f72 204e 6f6e 650a 2020 2020  sor or None.    
+0001ac40: 2020 2020 2020 2020 5468 6520 7465 6e73          The tens
+0001ac50: 6f72 2063 6f6e 7461 696e 696e 6720 7468  or containing th
+0001ac60: 6520 7765 6967 6874 6564 206c 696e 6561  e weighted linea
+0001ac70: 7220 636f 6d62 696e 6174 696f 6e2e 0a20  r combination.. 
+0001ac80: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001ac90: 2020 206f 7574 5f74 656e 736f 7220 3d20     out_tensor = 
+0001aca0: 4e6f 6e65 0a20 2020 2020 2020 2066 6f72  None.        for
+0001acb0: 2069 6e5f 7465 6e73 6f72 2c20 7720 696e   in_tensor, w in
+0001acc0: 207a 6970 2869 6e70 7574 732c 2073 656c   zip(inputs, sel
+0001acd0: 662e 696e 7075 745f 7765 6967 6874 7329  f.input_weights)
+0001ace0: 3a0a 2020 2020 2020 2020 2020 2020 696e  :.            in
+0001acf0: 5f74 656e 736f 7220 3d20 746f 7263 682e  _tensor = torch.
+0001ad00: 466c 6f61 7454 656e 736f 7228 696e 5f74  FloatTensor(in_t
+0001ad10: 656e 736f 7229 0a20 2020 2020 2020 2020  ensor).         
+0001ad20: 2020 2069 6620 6f75 745f 7465 6e73 6f72     if out_tensor
+0001ad30: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0001ad40: 2020 2020 2020 2020 2020 6f75 745f 7465            out_te
+0001ad50: 6e73 6f72 203d 2077 202a 2069 6e5f 7465  nsor = w * in_te
+0001ad60: 6e73 6f72 0a20 2020 2020 2020 2020 2020  nsor.           
+0001ad70: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001ad80: 2020 2020 2020 206f 7574 5f74 656e 736f         out_tenso
+0001ad90: 7220 2b3d 2077 202a 2069 6e5f 7465 6e73  r += w * in_tens
+0001ada0: 6f72 0a20 2020 2020 2020 2072 6574 7572  or.        retur
+0001adb0: 6e20 6f75 745f 7465 6e73 6f72 0a         n out_tensor.
```

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/lcnn.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/lcnn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/mat.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/mat.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/megnet.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/megnet.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/modular.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/modular.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/mpnn.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/mpnn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/normalizing_flows_pytorch.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/normalizing_flows_pytorch.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/pagtn.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/pagtn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/readout.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/readout.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/torch_models/torch_model.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/torch_models/torch_model.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/models/wandblogger.py` & `deepchem-2.7.2.dev20230512194912/deepchem/models/wandblogger.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/__init__.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/check_availability.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/check_availability.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/defaults.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/defaults.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/dnasim.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/dnasim.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/bace_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/bace_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/bace_features.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/bace_features.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/bbbc_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/bbbc_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/bbbp_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/bbbp_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/cell_counting_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/cell_counting_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/chembl25_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/chembl25_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/chembl_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/chembl_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/chembl_tasks.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/chembl_tasks.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/clearance_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/clearance_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/clintox_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/clintox_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/delaney_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/delaney_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/factors_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/factors_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/freesolv_dataset.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/freesolv_dataset.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/hiv_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/hiv_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/hopv_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/hopv_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/hppb_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/hppb_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/kaggle_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/kaggle_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/kaggle_features.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/kaggle_features.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/kinase_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/kinase_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/lipo_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/lipo_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/load_dataset_template.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/load_dataset_template.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/material_datasets/load_Pt_NO_surface_adsorbate_energy.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/material_datasets/load_Pt_NO_surface_adsorbate_energy.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/material_datasets/load_bandgap.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/material_datasets/load_bandgap.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/material_datasets/load_mp_formation_energy.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/material_datasets/load_mp_formation_energy.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/material_datasets/load_mp_metallicity.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/material_datasets/load_mp_metallicity.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/material_datasets/load_perovskite.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/material_datasets/load_perovskite.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/molnet_loader.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/molnet_loader.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/muv_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/muv_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/nci_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/nci_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/pcba_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/pcba_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/pdbbind_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/pdbbind_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/ppb_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/ppb_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/qm7_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/qm7_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/qm8_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/qm8_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/qm9_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/qm9_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/sampl_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/sampl_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/sider_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/sider_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/sweetlead_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/sweetlead_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/thermosol_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/thermosol_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/tox21_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/tox21_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/toxcast_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/toxcast_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/uspto_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/uspto_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/uv_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/uv_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/uv_tasks.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/uv_tasks.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/load_function/zinc15_datasets.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/load_function/zinc15_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/preset_hyper_parameters.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/preset_hyper_parameters.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/run_benchmark.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/run_benchmark.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/run_benchmark_low_data.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/run_benchmark_low_data.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/molnet/run_benchmark_models.py` & `deepchem-2.7.2.dev20230512194912/deepchem/molnet/run_benchmark_models.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/rl/__init__.py` & `deepchem-2.7.2.dev20230512194912/deepchem/rl/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/rl/a2c.py` & `deepchem-2.7.2.dev20230512194912/deepchem/rl/a2c.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/rl/envs/test_tictactoe.py` & `deepchem-2.7.2.dev20230512194912/deepchem/rl/envs/test_tictactoe.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/rl/envs/tictactoe.py` & `deepchem-2.7.2.dev20230512194912/deepchem/rl/envs/tictactoe.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/rl/ppo.py` & `deepchem-2.7.2.dev20230512194912/deepchem/rl/ppo.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/splits/__init__.py` & `deepchem-2.7.2.dev20230512194912/deepchem/splits/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/splits/splitters.py` & `deepchem-2.7.2.dev20230512194912/deepchem/splits/splitters.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/splits/task_splitter.py` & `deepchem-2.7.2.dev20230512194912/deepchem/splits/task_splitter.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/trans/__init__.py` & `deepchem-2.7.2.dev20230512194912/deepchem/trans/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/trans/duplicate.py` & `deepchem-2.7.2.dev20230512194912/deepchem/trans/duplicate.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/trans/transformers.py` & `deepchem-2.7.2.dev20230512194912/deepchem/trans/transformers.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/__init__.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/conformers.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/conformers.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/coordinate_box_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/coordinate_box_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/data_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/data_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/debug_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/debug_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/dftutils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/dftutils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/docking_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/docking_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/electron_sampler.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/electron_sampler.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/evaluate.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/evaluate.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/fake_data_generator.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/fake_data_generator.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/fragment_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/fragment_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/genomics_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/genomics_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/geometry_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/geometry_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/grover.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/grover.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/hash_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/hash_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/molecule_feature_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/molecule_feature_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/noncovalent_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/noncovalent_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/pdbqt_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/pdbqt_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/pytorch_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/pytorch_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/rdkit_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/rdkit_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/save.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/save.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/sequence_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/sequence_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_coordinate_box_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_coordinate_box_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_data_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_data_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_dftutils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_dftutils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_docking_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_docking_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_electron_sampler.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_electron_sampler.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_evaluate.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_evaluate.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_fake_data_generator.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_fake_data_generator.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_fragment_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_fragment_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_generator_evaluator.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_generator_evaluator.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_genomics_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_genomics_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_geometry_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_geometry_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_grover.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_grover.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_hash_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_hash_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_molecule_feature_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_molecule_feature_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_noncovalent_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_noncovalent_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_pdbqt_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_pdbqt_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_rdkit_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_rdkit_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_sequence_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_sequence_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/test/test_voxel_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/test/test_voxel_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/typing.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/typing.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/vina_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/vina_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem/utils/voxel_utils.py` & `deepchem-2.7.2.dev20230512194912/deepchem/utils/voxel_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem.egg-info/PKG-INFO` & `deepchem-2.7.2.dev20230512194912/deepchem.egg-info/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: deepchem
-Version: 2.7.2.dev20230512194842
+Version: 2.7.2.dev20230512194912
 Summary: Deep learning models for drug discovery,         quantum chemistry, and the life sciences.
 Home-page: https://github.com/deepchem/deepchem
 Maintainer: DeepChem contributors
 License: MIT
 Project-URL: Documentation, https://deepchem.readthedocs.io/en/latest/
 Project-URL: Source, https://github.com/deepchem/deepchem
 Keywords: deepchem,chemistry,biology,materials-science,life-science,drug-discovery
```

### Comparing `deepchem-2.7.2.dev20230512194842/deepchem.egg-info/SOURCES.txt` & `deepchem-2.7.2.dev20230512194912/deepchem.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/setup.cfg` & `deepchem-2.7.2.dev20230512194912/setup.cfg`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230512194842/setup.py` & `deepchem-2.7.2.dev20230512194912/setup.py`

 * *Files identical despite different names*

