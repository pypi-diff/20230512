# Comparing `tmp/mariqt-0.4.2-py2.py3-none-any.whl.zip` & `tmp/mariqt-0.4.3-py2.py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,29 +1,30 @@
-Zip file size: 207378 bytes, number of entries: 27
--rw-r--r--  2.0 unx     5876 b- defN 23-May-11 08:59 mariqt/converters.py
--rw-r--r--  2.0 unx    12316 b- defN 23-May-11 08:59 mariqt/core.py
--rw-r--r--  2.0 unx     8485 b- defN 23-May-11 08:59 mariqt/directories.py
--rw-r--r--  2.0 unx      465 b- defN 23-May-11 08:59 mariqt/equipment.py
--rw-r--r--  2.0 unx    16541 b- defN 23-May-11 08:59 mariqt/files.py
--rw-r--r--  2.0 unx    27845 b- defN 23-May-11 08:59 mariqt/geo.py
--rw-r--r--  2.0 unx    23283 b- defN 23-May-11 08:59 mariqt/image.py
--rw-r--r--  2.0 unx     3064 b- defN 23-May-11 08:59 mariqt/misc.py
--rw-r--r--  2.0 unx    40059 b- defN 23-May-11 08:59 mariqt/navigation.py
--rw-r--r--  2.0 unx     7345 b- defN 23-May-11 08:59 mariqt/provenance.py
--rw-r--r--  2.0 unx    22316 b- defN 23-May-11 08:59 mariqt/reports.py
--rw-r--r--  2.0 unx     4294 b- defN 23-May-11 08:59 mariqt/settings.py
--rw-r--r--  2.0 unx    13762 b- defN 23-May-11 08:59 mariqt/tests.py
--rw-r--r--  2.0 unx    30040 b- defN 23-May-11 08:59 mariqt/variables.py
--rw-r--r--  2.0 unx       21 b- defN 23-May-11 08:59 mariqt/version.py
--rw-r--r--  2.0 unx    12135 b- defN 23-May-11 08:59 mariqt/sources/dship.py
--rw-r--r--  2.0 unx     4586 b- defN 23-May-11 08:59 mariqt/sources/dship_settings.py
--rw-r--r--  2.0 unx     2177 b- defN 23-May-11 08:59 mariqt/sources/elements.py
--rw-r--r--  2.0 unx   102939 b- defN 23-May-11 08:59 mariqt/sources/ifdo.py
--rw-r--r--  2.0 unx     5533 b- defN 23-May-11 08:59 mariqt/sources/ofop.py
--rw-r--r--  2.0 unx   650149 b- defN 23-May-11 08:59 mariqt/sources/svgs.py
--rw-r--r--  2.0 unx     3728 b- defN 23-May-11 08:59 mariqt/sources/underway.py
--rw-rw-rw-  2.0 unx    35140 b- defN 23-May-11 09:00 mariqt-0.4.2.dist-info/LICENSE
--rw-r--r--  2.0 unx     1108 b- defN 23-May-11 09:00 mariqt-0.4.2.dist-info/METADATA
--rw-r--r--  2.0 unx      110 b- defN 23-May-11 09:00 mariqt-0.4.2.dist-info/WHEEL
--rw-r--r--  2.0 unx        7 b- defN 23-May-11 09:00 mariqt-0.4.2.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2076 b- defN 23-May-11 09:00 mariqt-0.4.2.dist-info/RECORD
-27 files, 1035400 bytes uncompressed, 204136 bytes compressed:  80.3%
+Zip file size: 207926 bytes, number of entries: 28
+-rw-r--r--  2.0 unx     5876 b- defN 23-May-12 13:30 mariqt/converters.py
+-rw-r--r--  2.0 unx    12721 b- defN 23-May-12 13:30 mariqt/core.py
+-rw-r--r--  2.0 unx     8485 b- defN 23-May-12 13:30 mariqt/directories.py
+-rw-r--r--  2.0 unx      465 b- defN 23-May-12 13:30 mariqt/equipment.py
+-rw-r--r--  2.0 unx    16541 b- defN 23-May-12 13:30 mariqt/files.py
+-rw-r--r--  2.0 unx    27845 b- defN 23-May-12 13:30 mariqt/geo.py
+-rw-r--r--  2.0 unx    23283 b- defN 23-May-12 13:30 mariqt/image.py
+-rw-r--r--  2.0 unx     3064 b- defN 23-May-12 13:30 mariqt/misc.py
+-rw-r--r--  2.0 unx    40059 b- defN 23-May-12 13:30 mariqt/navigation.py
+-rw-r--r--  2.0 unx     7345 b- defN 23-May-12 13:30 mariqt/provenance.py
+-rw-r--r--  2.0 unx    22316 b- defN 23-May-12 13:30 mariqt/reports.py
+-rw-r--r--  2.0 unx     4294 b- defN 23-May-12 13:30 mariqt/settings.py
+-rw-r--r--  2.0 unx    13762 b- defN 23-May-12 13:30 mariqt/tests.py
+-rw-r--r--  2.0 unx    30040 b- defN 23-May-12 13:30 mariqt/variables.py
+-rw-r--r--  2.0 unx       21 b- defN 23-May-12 13:30 mariqt/version.py
+-rw-r--r--  2.0 unx    12135 b- defN 23-May-12 13:30 mariqt/sources/dship.py
+-rw-r--r--  2.0 unx     4586 b- defN 23-May-12 13:30 mariqt/sources/dship_settings.py
+-rw-r--r--  2.0 unx     2177 b- defN 23-May-12 13:30 mariqt/sources/elements.py
+-rw-r--r--  2.0 unx   104073 b- defN 23-May-12 13:30 mariqt/sources/ifdo.py
+-rw-r--r--  2.0 unx     5533 b- defN 23-May-12 13:30 mariqt/sources/ofop.py
+-rw-r--r--  2.0 unx   650149 b- defN 23-May-12 13:30 mariqt/sources/svgs.py
+-rw-r--r--  2.0 unx     3728 b- defN 23-May-12 13:30 mariqt/sources/underway.py
+-rw-rw-rw-  2.0 unx      162 b- defN 23-May-12 13:31 mariqt-0.4.3.dist-info/AUTHORS.md
+-rw-rw-rw-  2.0 unx    35140 b- defN 23-May-12 13:31 mariqt-0.4.3.dist-info/LICENSE
+-rw-r--r--  2.0 unx     1133 b- defN 23-May-12 13:31 mariqt-0.4.3.dist-info/METADATA
+-rw-r--r--  2.0 unx      110 b- defN 23-May-12 13:31 mariqt-0.4.3.dist-info/WHEEL
+-rw-r--r--  2.0 unx        7 b- defN 23-May-12 13:31 mariqt-0.4.3.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2165 b- defN 23-May-12 13:31 mariqt-0.4.3.dist-info/RECORD
+28 files, 1037215 bytes uncompressed, 204542 bytes compressed:  80.3%
```

## zipnote {}

```diff
@@ -60,23 +60,26 @@
 
 Filename: mariqt/sources/svgs.py
 Comment: 
 
 Filename: mariqt/sources/underway.py
 Comment: 
 
-Filename: mariqt-0.4.2.dist-info/LICENSE
+Filename: mariqt-0.4.3.dist-info/AUTHORS.md
 Comment: 
 
-Filename: mariqt-0.4.2.dist-info/METADATA
+Filename: mariqt-0.4.3.dist-info/LICENSE
 Comment: 
 
-Filename: mariqt-0.4.2.dist-info/WHEEL
+Filename: mariqt-0.4.3.dist-info/METADATA
 Comment: 
 
-Filename: mariqt-0.4.2.dist-info/top_level.txt
+Filename: mariqt-0.4.3.dist-info/WHEEL
 Comment: 
 
-Filename: mariqt-0.4.2.dist-info/RECORD
+Filename: mariqt-0.4.3.dist-info/top_level.txt
+Comment: 
+
+Filename: mariqt-0.4.3.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## mariqt/core.py

```diff
@@ -112,25 +112,31 @@
 		try:
 			dt = datetime.datetime.strptime(dt_str,miqtv.date_formats['mariqt_files']+"%z")
 		except:
 			raise Exception("can not parse time from file name " + fileName)
 	return dt
 
 
+def identical_mariqt_datetime(mariqt_datetime_str_1:str, mariqt_datetime_str_2:str):
+	""" compare two mariqt datetime strings (%Y-%m-%d %H:%M:%S.%f) """
+	dt_1 = datetime.datetime.strptime(mariqt_datetime_str_1, miqtv.date_formats['mariqt'])
+	dt_2 = datetime.datetime.strptime(mariqt_datetime_str_2, miqtv.date_formats['mariqt'])
+	return dt_1 == dt_2
+
 def recursivelyUpdateDicts(oldDict:dict, newDict:dict, mutuallyExclusives:list=[]):
 	""" Recursively updates oldDict with newDict.
 		Merges item entries with identical image-datetime.
 	 	Item entries without image-datetime will get image default (start) datetime.
 		Item lists will be sorted by image-datetime. """
 	log = []
 	for newItem in newDict:
 		# special case for updating video items which may contain of a list of dicts, each with a different timestamp which have to be checked and then get updated
 		try:
 			# both items are not lists
-			if newDict[newItem]['image-datetime'] != oldDict[newItem]['image-datetime']:
+			if not identical_mariqt_datetime(newDict[newItem]['image-datetime'], oldDict[newItem]['image-datetime']):
 				oldDict[newItem] = [oldDict[newItem]] # will be handled in bellow
 		except:
 			# TODO write to log?
 			pass
 		try:
 			# at least one is a list
 			if isinstance(newDict[newItem],list) or isinstance(oldDict[newItem],list):
@@ -164,15 +170,15 @@
 						#print("oldDictItem",oldDictItem)
 						if not 'image-datetime' in oldDictItem:
 							log += [str(newDictItem) + " does not contain \'image-datetime\', is removed"]
 							del oldDictNewItemList[i]
 							continue
 
 						i += 1 
-						if newDictItem['image-datetime'] == oldDictItem['image-datetime']:
+						if identical_mariqt_datetime(newDictItem['image-datetime'], oldDictItem['image-datetime']):
 							log += recursivelyUpdateDicts(oldDictItem,newDictItem,mutuallyExclusives)
 							matchFound = True
 							break
 
 					if not matchFound:
 						oldDictNewItemList.append(newDictItem) # TODO checkMutuallyExclusive wouldnt work, theoretically one could write altitude at timestamp 1 and depth at timestamp 2
 				# sort by date time
```

## mariqt/version.py

```diff
@@ -1 +1 @@
-__version__ = '0.4.2'
+__version__ = '0.4.3'
```

## mariqt/sources/ifdo.py

```diff
@@ -2890,3545 +2890,3616 @@
 0000b490: 6579 5d5b 2769 6d61 6765 2d6c 6f63 616c  ey]['image-local
 0000b4a0: 2d70 6174 6827 5d20 3d20 6f73 2e70 6174  -path'] = os.pat
 0000b4b0: 682e 7265 6c70 6174 6828 7365 6c66 2e69  h.relpath(self.i
 0000b4c0: 6d61 6765 7344 6972 2c20 6f73 2e70 6174  magesDir, os.pat
 0000b4d0: 682e 6469 726e 616d 6528 7365 6c66 2e67  h.dirname(self.g
 0000b4e0: 6574 6946 444f 4669 6c65 4e61 6d65 2829  etiFDOFileName()
 0000b4f0: 2929 0a0a 0a20 2020 2064 6566 2063 7265  ))...    def cre
-0000b500: 6174 6543 6f72 6546 6965 6c64 7328 7365  ateCoreFields(se
-0000b510: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-0000b520: 2046 696c 6c73 2074 6865 2069 4644 4f20   Fills the iFDO 
-0000b530: 636f 7265 2066 6965 6c64 7320 6672 6f6d  core fields from
-0000b540: 2069 6e74 6572 6d65 6469 6174 6520 6669   intermediate fi
-0000b550: 6c65 732e 2057 6974 686f 7574 2074 6865  les. Without the
-0000b560: 6d20 6e6f 2076 616c 6964 2069 4644 4f20  m no valid iFDO 
-0000b570: 6361 6e20 6265 2063 7265 6174 6564 2222  can be created""
-0000b580: 220a 0a20 2020 2020 2020 2023 2057 6869  "..        # Whi
-0000b590: 6368 2066 696c 6573 2063 6f6e 7461 696e  ch files contain
-0000b5a0: 2074 6865 2069 6e66 6f72 6d61 7469 6f6e   the information
-0000b5b0: 206e 6565 6465 6420 746f 2063 7265 6174   needed to creat
-0000b5c0: 6520 7468 6520 6946 444f 2069 7465 6d73  e the iFDO items
-0000b5d0: 2063 6f72 6520 696e 666f 726d 6174 696f   core informatio
-0000b5e0: 6e20 616e 6420 7768 6963 6820 636f 6c75  n and which colu
-0000b5f0: 6d6e 7320 7368 616c 6c20 6265 2075 7365  mns shall be use
-0000b600: 640a 2020 2020 2020 2020 7265 7120 3d20  d.        req = 
-0000b610: 7365 6c66 2e69 6e74 6572 6d65 6469 6174  self.intermediat
-0000b620: 6546 696c 6573 4465 665f 636f 7265 0a0a  eFilesDef_core..
-0000b630: 2020 2020 2020 2020 6974 656d 5f64 6174          item_dat
-0000b640: 6120 3d20 7b7d 0a20 2020 2020 2020 2070  a = {}.        p
-0000b650: 726f 6720 3d20 6d69 7174 632e 5072 696e  rog = miqtc.Prin
-0000b660: 744b 6e6f 776e 5072 6f67 7265 7373 4d73  tKnownProgressMs
-0000b670: 6728 2250 6172 7369 6e67 2069 6e74 6572  g("Parsing inter
-0000b680: 6d65 6469 6174 6520 6461 7461 222c 206c  mediate data", l
-0000b690: 656e 2872 6571 2929 0a20 2020 2020 2020  en(req)).       
-0000b6a0: 2066 6f72 2072 2069 6e20 7265 713a 0a20   for r in req:. 
-0000b6b0: 2020 2020 2020 2020 2020 2070 726f 672e             prog.
-0000b6c0: 7072 6f67 7265 7373 2829 0a20 2020 2020  progress().     
-0000b6d0: 2020 2020 2020 2066 696c 6520 3d20 7365         file = se
-0000b6e0: 6c66 2e5f 5f67 6574 5f69 6e74 5f66 696c  lf.__get_int_fil
-0000b6f0: 655f 7072 6566 6978 2829 202b 2072 6571  e_prefix() + req
-0000b700: 5b72 5d5b 2773 7566 6669 7827 5d0a 2020  [r]['suffix'].  
-0000b710: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0000b720: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-0000b730: 6669 6c65 293a 0a20 2020 2020 2020 2020  file):.         
-0000b740: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-0000b750: 2e6c 6f67 2822 5741 524e 494e 4721 2046  .log("WARNING! F
-0000b760: 6f72 2061 6368 6965 7669 6e67 2046 4149  or achieving FAI
-0000b770: 526e 6573 7320 616e 2069 6e74 6572 6d65  Rness an interme
-0000b780: 6469 6174 6520 696d 6167 6520 696e 666f  diate image info
-0000b790: 2066 696c 6520 6973 206d 6973 7369 6e67   file is missing
-0000b7a0: 3a20 222b 2073 656c 662e 5f5f 6765 745f  : "+ self.__get_
-0000b7b0: 696e 745f 6669 6c65 5f70 7265 6669 7828  int_file_prefix(
-0000b7c0: 2920 2b20 7265 715b 725d 5b27 7375 6666  ) + req[r]['suff
-0000b7d0: 6978 275d 2b20 2220 7275 6e20 6669 7273  ix']+ " run firs
-0000b7e0: 743a 2022 202b 2072 6571 5b72 5d5b 2763  t: " + req[r]['c
-0000b7f0: 7265 6174 696f 6e46 6374 275d 290a 2020  reationFct']).  
-0000b800: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0000b810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b820: 7365 6c66 2e70 6172 7365 4974 656d 4461  self.parseItemDa
-0000b830: 7461 6672 6f6d 5461 6246 696c 6544 6174  tafromTabFileDat
-0000b840: 6128 6974 656d 5f64 6174 612c 2066 696c  a(item_data, fil
-0000b850: 652c 2072 6571 5b72 5d5b 2763 6f6c 7327  e, req[r]['cols'
-0000b860: 5d2c 2072 6571 5b72 5d5b 276f 7074 696f  ], req[r]['optio
-0000b870: 6e61 6c27 5d29 0a20 2020 2020 2020 2020  nal']).         
-0000b880: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-0000b890: 2e6c 6f67 2822 5061 7273 6564 2069 7465  .log("Parsed ite
-0000b8a0: 6d20 6461 7461 2066 726f 6d3a 2022 202b  m data from: " +
-0000b8b0: 2066 696c 6529 0a0a 2020 2020 2020 2020   file)..        
-0000b8c0: 7072 6f67 2e63 6c65 6172 2829 0a20 2020  prog.clear().   
-0000b8d0: 2020 2020 2069 6620 6c65 6e28 6974 656d       if len(item
-0000b8e0: 5f64 6174 6129 203d 3d20 303a 0a20 2020  _data) == 0:.   
-0000b8f0: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
-0000b900: 7863 6570 7469 6f6e 2822 4e6f 2069 4644  xception("No iFD
-0000b910: 4f20 6974 656d 7322 290a 0a20 2020 2020  O items")..     
-0000b920: 2020 2023 2063 6865 636b 2066 696c 6573     # check files
-0000b930: 2065 7869 7374 0a20 2020 2020 2020 2072   exist.        r
-0000b940: 656d 6f76 6520 3d20 5b5d 0a20 2020 2020  emove = [].     
-0000b950: 2020 2066 6f72 2069 6d67 2069 6e20 6974     for img in it
-0000b960: 656d 5f64 6174 613a 0a20 2020 2020 2020  em_data:.       
-0000b970: 2020 2020 2069 6620 6e6f 7420 696d 6720       if not img 
-0000b980: 696e 2073 656c 662e 5f69 6d61 6765 4e61  in self._imageNa
-0000b990: 6d65 7349 6d61 6765 7344 6972 3a0a 2020  mesImagesDir:.  
-0000b9a0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000b9b0: 6d6f 7665 2e61 7070 656e 6428 696d 6729  move.append(img)
-0000b9c0: 0a20 2020 2020 2020 2066 6f72 2069 6d67  .        for img
-0000b9d0: 2069 6e20 7265 6d6f 7665 3a0a 2020 2020   in remove:.    
-0000b9e0: 2020 2020 2020 2020 6465 6c20 6974 656d          del item
-0000b9f0: 5f64 6174 615b 696d 675d 0a0a 2020 2020  _data[img]..    
-0000ba00: 2020 2020 2320 6164 6420 696d 6167 652d      # add image-
-0000ba10: 7572 6c0a 2020 2020 2020 2020 666f 7220  url.        for 
-0000ba20: 696d 6720 696e 2069 7465 6d5f 6461 7461  img in item_data
-0000ba30: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0000ba40: 2069 7369 6e73 7461 6e63 6528 6974 656d   isinstance(item
-0000ba50: 5f64 6174 615b 696d 675d 2c6c 6973 7429  _data[img],list)
-0000ba60: 3a20 2320 6974 656d 2069 7320 616c 7265  : # item is alre
-0000ba70: 6164 7920 6120 6c69 7374 2028 7669 6465  ady a list (vide
-0000ba80: 6f29 2062 7574 2070 6172 7365 6420 6461  o) but parsed da
-0000ba90: 7461 2069 7320 6e6f 742c 2069 2e65 2e20  ta is not, i.e. 
-0000baa0: 7061 7273 6564 2064 6174 6120 7265 6665  parsed data refe
-0000bab0: 7273 2074 6f20 7768 6f6c 6520 7669 6465  rs to whole vide
-0000bac0: 6f20 2874 696d 6520 696e 6465 7065 6e64  o (time independ
-0000bad0: 656e 7429 2c20 692e 652e 2077 7269 7465  ent), i.e. write
-0000bae0: 2074 6f20 6669 7273 7420 656e 7472 790a   to first entry.
-0000baf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb00: 7575 6964 203d 2066 696e 6446 6965 6c64  uuid = findField
-0000bb10: 2869 7465 6d5f 6461 7461 5b69 6d67 5d5b  (item_data[img][
-0000bb20: 305d 2c27 696d 6167 652d 7575 6964 2729  0],'image-uuid')
-0000bb30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bb40: 2069 6620 7575 6964 203d 3d20 2222 3a0a   if uuid == "":.
-0000bb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb60: 2020 2020 7072 696e 7428 6974 656d 5f64      print(item_d
-0000bb70: 6174 615b 696d 675d 290a 2020 2020 2020  ata[img]).      
-0000bb80: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-0000bb90: 6973 6520 6d69 7174 632e 4966 646f 4578  ise miqtc.IfdoEx
-0000bba0: 6365 7074 696f 6e28 2275 7569 6420 6e6f  ception("uuid no
-0000bbb0: 7420 666f 756e 6420 2861 2922 290a 2020  t found (a)").  
-0000bbc0: 2020 2020 2020 2020 2020 2020 2020 6974                it
-0000bbd0: 656d 5f64 6174 615b 696d 675d 5b30 5d5b  em_data[img][0][
-0000bbe0: 2769 6d61 6765 2d68 616e 646c 6527 5d20  'image-handle'] 
-0000bbf0: 3d20 7365 6c66 2e69 6d61 6765 5f68 616e  = self.image_han
-0000bc00: 646c 655f 7072 6566 6978 202b 2027 4027  dle_prefix + '@'
-0000bc10: 202b 2075 7569 640a 2020 2020 2020 2020   + uuid.        
-0000bc20: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000bc30: 2020 2020 2020 2020 2020 7575 6964 203d            uuid =
-0000bc40: 2066 696e 6446 6965 6c64 2869 7465 6d5f   findField(item_
-0000bc50: 6461 7461 5b69 6d67 5d2c 2769 6d61 6765  data[img],'image
-0000bc60: 2d75 7569 6427 290a 2020 2020 2020 2020  -uuid').        
-0000bc70: 2020 2020 2020 2020 6966 2075 7569 6420          if uuid 
-0000bc80: 3d3d 2022 223a 0a20 2020 2020 2020 2020  == "":.         
-0000bc90: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000bca0: 206d 6971 7463 2e49 6664 6f45 7863 6570   miqtc.IfdoExcep
-0000bcb0: 7469 6f6e 2822 7575 6964 206e 6f74 2066  tion("uuid not f
-0000bcc0: 6f75 6e64 2028 6229 2229 0a20 2020 2020  ound (b)").     
-0000bcd0: 2020 2020 2020 2020 2020 2069 7465 6d5f             item_
-0000bce0: 6461 7461 5b69 6d67 5d5b 2769 6d61 6765  data[img]['image
-0000bcf0: 2d68 616e 646c 6527 5d20 3d20 7365 6c66  -handle'] = self
-0000bd00: 2e69 6d61 6765 5f68 616e 646c 655f 7072  .image_handle_pr
-0000bd10: 6566 6978 202b 2027 4027 202b 2075 7569  efix + '@' + uui
-0000bd20: 640a 0a20 2020 2020 2020 2023 2063 7265  d..        # cre
-0000bd30: 6174 6520 7961 6d6c 2061 6e64 2063 6865  ate yaml and che
-0000bd40: 636b 2066 6965 6c64 7320 666f 7220 7661  ck fields for va
-0000bd50: 6c69 6469 7479 0a20 2020 2020 2020 2023  lidity.        #
-0000bd60: 2069 7465 6d5f 6461 7461 2063 6f6e 7461   item_data conta
-0000bd70: 696e 7320 6669 656c 6420 696d 6167 652d  ins field image-
-0000bd80: 6669 6c65 6e61 6d65 2c20 7768 6963 6820  filename, which 
-0000bd90: 7768 6963 6820 7769 6c6c 206e 6f74 2062  which will not b
-0000bda0: 6520 7374 6f72 6564 2061 7320 616e 2069  e stored as an i
-0000bdb0: 7465 6d20 6669 656c 6420 696e 2069 464f  tem field in iFO
-0000bdc0: 4420 6275 7420 6173 2074 6865 2069 7465  D but as the ite
-0000bdd0: 6d20 6e61 6d65 2069 7473 656c 660a 2020  m name itself.  
-0000bde0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000bdf0: 662e 7570 6461 7465 6946 444f 2873 656c  f.updateiFDO(sel
-0000be00: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
-0000be10: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
-0000be20: 795d 2c20 6974 656d 5f64 6174 612e 7661  y], item_data.va
-0000be30: 6c75 6573 2829 290a 0a0a 2020 2020 6465  lues())...    de
-0000be40: 6620 6372 6561 7465 4361 7074 7572 6541  f createCaptureA
-0000be50: 6e64 436f 6e74 656e 7446 6965 6c64 7328  ndContentFields(
-0000be60: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-0000be70: 2222 2046 696c 6c73 2074 6865 2069 4644  "" Fills the iFD
-0000be80: 4f20 6361 7075 7472 6520 616e 6420 636f  O caputre and co
-0000be90: 6e74 656e 7420 6669 6564 7320 6672 6f6d  ntent fieds from
-0000bea0: 2070 726f 7669 6465 6420 6461 7461 2066   provided data f
-0000beb0: 6965 6c64 7320 2222 220a 0a20 2020 2020  ields """..     
-0000bec0: 2020 2072 6571 203d 2073 656c 662e 6e6f     req = self.no
-0000bed0: 6e43 6f72 6546 6965 6c64 496e 7465 726d  nCoreFieldInterm
-0000bee0: 6564 6961 7465 4974 656d 496e 666f 4669  ediateItemInfoFi
-0000bef0: 6c65 730a 0a20 2020 2020 2020 2069 7465  les..        ite
-0000bf00: 6d5f 6461 7461 203d 207b 7d0a 2020 2020  m_data = {}.    
-0000bf10: 2020 2020 666f 7220 7220 696e 2072 6571      for r in req
-0000bf20: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0000bf30: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-0000bf40: 722e 6669 6c65 4e61 6d65 293a 0a20 2020  r.fileName):.   
-0000bf50: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000bf60: 662e 7072 6173 6549 7465 6d44 6174 6146  f.praseItemDataF
-0000bf70: 726f 6d46 696c 6528 6974 656d 5f64 6174  romFile(item_dat
-0000bf80: 612c 722e 6669 6c65 4e61 6d65 2c72 2e73  a,r.fileName,r.s
-0000bf90: 6570 6172 6174 6f72 2c72 2e68 6561 6465  eparator,r.heade
-0000bfa0: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
-0000bfb0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-0000bfc0: 2822 5061 7273 6564 2069 7465 6d20 6461  ("Parsed item da
-0000bfd0: 7461 2066 726f 6d3a 2022 202b 2072 2e66  ta from: " + r.f
-0000bfe0: 696c 654e 616d 6529 0a20 2020 2020 2020  ileName).       
-0000bff0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000c000: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000c010: 7072 6f76 2e6c 6f67 2822 4669 6c65 2064  prov.log("File d
-0000c020: 6f65 7320 6e6f 7420 6578 6973 7473 3a20  oes not exists: 
-0000c030: 2220 2b20 722e 6669 6c65 4e61 6d65 290a  " + r.fileName).
-0000c040: 0a20 2020 2020 2020 2023 2063 7265 6174  .        # creat
-0000c050: 6520 7961 6d6c 2061 6e64 2063 6865 636b  e yaml and check
-0000c060: 2066 6965 6c64 7320 666f 7220 7661 6c69   fields for vali
-0000c070: 6469 7479 0a20 2020 2020 2020 2023 2069  dity.        # i
-0000c080: 7465 6d5f 6461 7461 2063 6f6e 7461 696e  tem_data contain
-0000c090: 7320 6669 656c 6420 696d 6167 652d 6669  s field image-fi
-0000c0a0: 6c65 6e61 6d65 2c20 7768 6963 6820 7768  lename, which wh
-0000c0b0: 6963 6820 7769 6c6c 206e 6f74 2062 6520  ich will not be 
-0000c0c0: 7374 6f72 6564 2061 7320 616e 2069 7465  stored as an ite
-0000c0d0: 6d20 6669 656c 6420 696e 2069 464f 4420  m field in iFOD 
-0000c0e0: 6275 7420 6173 2074 6865 2069 7465 6d20  but as the item 
-0000c0f0: 6e61 6d65 2069 7473 656c 660a 2020 2020  name itself.    
-0000c100: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000c110: 7570 6461 7465 6946 444f 2873 656c 662e  updateiFDO(self.
-0000c120: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
-0000c130: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
-0000c140: 2c20 6974 656d 5f64 6174 612e 7661 6c75  , item_data.valu
-0000c150: 6573 2829 290a 0a0a 2020 2020 6465 6620  es())...    def 
-0000c160: 6164 6449 7465 6d49 6e66 6f54 6162 4669  addItemInfoTabFi
-0000c170: 6c65 2873 656c 662c 2066 696c 654e 616d  le(self, fileNam
-0000c180: 653a 2073 7472 2c20 7365 7061 7261 746f  e: str, separato
-0000c190: 723a 7374 722c 2068 6561 6465 723a 6469  r:str, header:di
-0000c1a0: 6374 293a 0a20 2020 2020 2020 2022 2222  ct):.        """
-0000c1b0: 2041 6464 2061 2074 6162 2073 6570 6572   Add a tab seper
-0000c1c0: 6174 6564 2074 6578 7420 6669 6c65 2074  ated text file t
-0000c1d0: 6f20 7061 7273 6520 6974 656d 2064 6174  o parse item dat
-0000c1e0: 6120 6672 6f6d 2062 7920 6372 6561 7465  a from by create
-0000c1f0: 4361 7074 7572 6541 6e64 436f 6e74 656e  CaptureAndConten
-0000c200: 7446 6965 6c64 7328 292e 200a 2020 2020  tFields(). .    
-0000c210: 2020 2020 436f 6c75 6d6e 7320 6865 6164      Columns head
-0000c220: 6572 7320 7769 6c6c 2062 6520 7365 7420  ers will be set 
-0000c230: 6173 2069 7465 6d20 6669 656c 6420 6e61  as item field na
-0000c240: 6d65 732e 204d 7573 7420 636f 6e74 6169  mes. Must contai
-0000c250: 6e20 636f 6c75 6d6e 2027 696d 6167 652d  n column 'image-
-0000c260: 6669 6c65 6e61 6d65 272e 0a20 2020 2020  filename'..     
-0000c270: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-0000c280: 6620 6669 6c65 4e61 6d65 203d 3d20 4e6f  f fileName == No
-0000c290: 6e65 206f 7220 6e6f 7420 6f73 2e70 6174  ne or not os.pat
-0000c2a0: 682e 6578 6973 7473 2866 696c 654e 616d  h.exists(fileNam
-0000c2b0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-0000c2c0: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
-0000c2d0: 2246 696c 6522 2c66 696c 654e 616d 652c  "File",fileName,
-0000c2e0: 226e 6f74 2066 6f75 6e64 2229 0a0a 2020  "not found")..  
-0000c2f0: 2020 2020 2020 666f 7220 6669 656c 6420        for field 
-0000c300: 696e 2068 6561 6465 723a 0a20 2020 2020  in header:.     
-0000c310: 2020 2020 2020 2069 6620 6865 6164 6572         if header
-0000c320: 5b66 6965 6c64 5d20 6e6f 7420 696e 206d  [field] not in m
-0000c330: 6971 7466 2e74 6162 4669 6c65 436f 6c75  iqtf.tabFileColu
-0000c340: 6d6e 4e61 6d65 7328 6669 6c65 4e61 6d65  mnNames(fileName
-0000c350: 2c63 6f6c 5f73 6570 6172 6174 6f72 3d73  ,col_separator=s
-0000c360: 6570 6172 6174 6f72 293a 0a20 2020 2020  eparator):.     
-0000c370: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000c380: 2045 7863 6570 7469 6f6e 2822 436f 6c75   Exception("Colu
-0000c390: 6d6e 222c 2068 6561 6465 725b 6669 656c  mn", header[fiel
-0000c3a0: 645d 2c20 226e 6f74 2069 6e20 6669 6c65  d], "not in file
-0000c3b0: 222c 2066 696c 654e 616d 6529 0a0a 2020  ", fileName)..  
-0000c3c0: 2020 2020 2020 6966 206d 6971 7463 2e61        if miqtc.a
-0000c3d0: 7373 6572 7453 6c61 7368 286f 732e 7061  ssertSlash(os.pa
-0000c3e0: 7468 2e64 6972 6e61 6d65 2866 696c 654e  th.dirname(fileN
-0000c3f0: 616d 6529 2920 213d 206d 6971 7463 2e61  ame)) != miqtc.a
-0000c400: 7373 6572 7453 6c61 7368 2873 656c 662e  ssertSlash(self.
-0000c410: 6469 722e 746f 2873 656c 662e 6469 722e  dir.to(self.dir.
-0000c420: 6474 2e69 6e74 6572 6d65 6469 6174 6529  dt.intermediate)
-0000c430: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-0000c440: 656c 662e 7072 6f76 2e6c 6f67 2820 2243  elf.prov.log( "C
-0000c450: 6175 7469 6f6e 3a20 4974 2069 7320 7265  aution: It is re
-0000c460: 636f 6d6d 656e 6465 6420 746f 2070 7574  commended to put
-0000c470: 2066 696c 6520 696e 2074 6865 2064 6972   file in the dir
-0000c480: 6563 746f 7279 2773 2027 696e 7465 726d  ectory's 'interm
-0000c490: 6564 6961 7465 2720 666f 6c64 6572 3a20  ediate' folder: 
-0000c4a0: 2220 2b20 6669 6c65 4e61 6d65 290a 2020  " + fileName).  
-0000c4b0: 2020 2020 2020 6966 206e 6f6e 436f 7265        if nonCore
-0000c4c0: 4669 656c 6449 6e74 6572 6d65 6469 6174  FieldIntermediat
-0000c4d0: 6549 7465 6d49 6e66 6f46 696c 6528 6669  eItemInfoFile(fi
-0000c4e0: 6c65 4e61 6d65 2c20 7365 7061 7261 746f  leName, separato
-0000c4f0: 722c 2068 6561 6465 7229 206e 6f74 2069  r, header) not i
-0000c500: 6e20 7365 6c66 2e6e 6f6e 436f 7265 4669  n self.nonCoreFi
-0000c510: 656c 6449 6e74 6572 6d65 6469 6174 6549  eldIntermediateI
-0000c520: 7465 6d49 6e66 6f46 696c 6573 3a20 0a20  temInfoFiles: . 
-0000c530: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000c540: 6e6f 6e43 6f72 6546 6965 6c64 496e 7465  nonCoreFieldInte
-0000c550: 726d 6564 6961 7465 4974 656d 496e 666f  rmediateItemInfo
-0000c560: 4669 6c65 732e 6170 7065 6e64 286e 6f6e  Files.append(non
-0000c570: 436f 7265 4669 656c 6449 6e74 6572 6d65  CoreFieldInterme
-0000c580: 6469 6174 6549 7465 6d49 6e66 6f46 696c  diateItemInfoFil
-0000c590: 6528 6669 6c65 4e61 6d65 2c20 7365 7061  e(fileName, sepa
-0000c5a0: 7261 746f 722c 2068 6561 6465 7229 290a  rator, header)).
-0000c5b0: 0a20 2020 2020 2020 200a 2020 2020 6465  .        .    de
-0000c5c0: 6620 7265 6d6f 7665 4974 656d 496e 666f  f removeItemInfo
-0000c5d0: 5461 6246 696c 6528 7365 6c66 2c20 6669  TabFile(self, fi
-0000c5e0: 6c65 4e61 6d65 3a20 7374 722c 2073 6570  leName: str, sep
-0000c5f0: 6172 6174 6f72 3a73 7472 2c20 6865 6164  arator:str, head
-0000c600: 6572 3a64 6963 7429 3a0a 2020 2020 2020  er:dict):.      
-0000c610: 2020 2222 2220 7265 6d6f 7665 7320 6669    """ removes fi
-0000c620: 6c65 2069 7465 6d20 6672 6f6d 206c 6973  le item from lis
-0000c630: 7420 6f66 2066 696c 6573 2074 6f20 7061  t of files to pa
-0000c640: 7273 6520 6974 656d 2064 6174 6120 6672  rse item data fr
-0000c650: 6f6d 2062 7920 6372 6561 7465 4361 7074  om by createCapt
-0000c660: 7572 6541 6e64 436f 6e74 656e 7446 6965  ureAndContentFie
-0000c670: 6c64 7328 2920 2222 220a 2020 2020 2020  lds() """.      
-0000c680: 2020 6966 206e 6f6e 436f 7265 4669 656c    if nonCoreFiel
-0000c690: 6449 6e74 6572 6d65 6469 6174 6549 7465  dIntermediateIte
-0000c6a0: 6d49 6e66 6f46 696c 6528 6669 6c65 4e61  mInfoFile(fileNa
-0000c6b0: 6d65 2c20 7365 7061 7261 746f 722c 2068  me, separator, h
-0000c6c0: 6561 6465 7229 2069 6e20 7365 6c66 2e6e  eader) in self.n
-0000c6d0: 6f6e 436f 7265 4669 656c 6449 6e74 6572  onCoreFieldInter
-0000c6e0: 6d65 6469 6174 6549 7465 6d49 6e66 6f46  mediateItemInfoF
-0000c6f0: 696c 6573 3a20 0a20 2020 2020 2020 2020  iles: .         
-0000c700: 2020 2073 656c 662e 6e6f 6e43 6f72 6546     self.nonCoreF
-0000c710: 6965 6c64 496e 7465 726d 6564 6961 7465  ieldIntermediate
-0000c720: 4974 656d 496e 666f 4669 6c65 732e 7265  ItemInfoFiles.re
-0000c730: 6d6f 7665 286e 6f6e 436f 7265 4669 656c  move(nonCoreFiel
-0000c740: 6449 6e74 6572 6d65 6469 6174 6549 7465  dIntermediateIte
-0000c750: 6d49 6e66 6f46 696c 6528 6669 6c65 4e61  mInfoFile(fileNa
-0000c760: 6d65 2c20 7365 7061 7261 746f 722c 2068  me, separator, h
-0000c770: 6561 6465 7229 290a 0a0a 2020 2020 6465  eader))...    de
-0000c780: 6620 7570 6461 7465 6946 444f 2873 656c  f updateiFDO(sel
-0000c790: 662c 2068 6561 6465 723a 2064 6963 742c  f, header: dict,
-0000c7a0: 2069 7465 6d73 3a20 6c69 7374 293a 0a20   items: list):. 
-0000c7b0: 2020 2020 2020 2022 2222 2055 7064 6174         """ Updat
-0000c7c0: 6573 2074 6865 2063 7572 7265 6e74 2076  es the current v
-0000c7d0: 616c 7565 7320 6946 444f 2077 6974 6820  alues iFDO with 
-0000c7e0: 7468 6520 7072 6f76 6964 6564 206e 6577  the provided new
-0000c7f0: 2076 616c 7565 7320 2222 220a 2020 2020   values """.    
-0000c800: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000c810: 6372 6561 7465 6946 444f 2868 6561 6465  createiFDO(heade
-0000c820: 722c 2069 7465 6d73 2c20 7570 6461 7465  r, items, update
-0000c830: 4578 6973 7469 6e67 3d54 7275 6529 0a0a  Existing=True)..
-0000c840: 0a20 2020 2064 6566 2063 7265 6174 6569  .    def createi
-0000c850: 4644 4f28 7365 6c66 2c20 6865 6164 6572  FDO(self, header
-0000c860: 3a20 6469 6374 2c20 6974 656d 733a 206c  : dict, items: l
-0000c870: 6973 742c 2075 7064 6174 6545 7869 7374  ist, updateExist
-0000c880: 696e 673d 4661 6c73 652c 6865 6164 6572  ing=False,header
-0000c890: 4f6e 6c79 3d46 616c 7365 293a 0a20 2020  Only=False):.   
-0000c8a0: 2020 2020 2022 2222 2043 7265 6174 6573       """ Creates
-0000c8b0: 2046 4149 5220 6469 6769 7461 6c20 6f62   FAIR digital ob
-0000c8c0: 6a65 6374 2066 6f72 2074 6865 2069 6d61  ject for the ima
-0000c8d0: 6765 2064 6174 6120 6974 7365 6c66 2e20  ge data itself. 
-0000c8e0: 5468 6973 2063 6f6e 7369 7374 7320 6f66  This consists of
-0000c8f0: 2068 6561 6465 7220 696e 666f 726d 6174   header informat
-0000c900: 696f 6e20 616e 6420 6974 656d 2069 6e66  ion and item inf
-0000c910: 6f72 6d61 7469 6f6e 2e20 2222 220a 0a20  ormation. """.. 
-0000c920: 2020 2020 2020 2069 6620 6e6f 7420 7570         if not up
-0000c930: 6461 7465 4578 6973 7469 6e67 2061 6e64  dateExisting and
-0000c940: 206c 656e 2869 7465 6d73 2920 3d3d 2030   len(items) == 0
-0000c950: 2061 6e64 206e 6f74 2068 6561 6465 724f   and not headerO
-0000c960: 6e6c 793a 0a20 2020 2020 2020 2020 2020  nly:.           
-0000c970: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
-0000c980: 2827 4e6f 2069 7465 6d20 696e 666f 726d  ('No item inform
-0000c990: 6174 696f 6e20 6769 7665 6e27 290a 0a20  ation given').. 
-0000c9a0: 2020 2020 2020 2069 6620 7570 6461 7465         if update
-0000c9b0: 4578 6973 7469 6e67 3a0a 2020 2020 2020  Existing:.      
-0000c9c0: 2020 2020 2020 2320 6865 6164 6572 0a20        # header. 
-0000c9d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000c9e0: 7570 6461 7465 6946 444f 4865 6164 6572  updateiFDOHeader
-0000c9f0: 4669 656c 6473 2868 6561 6465 7229 0a20  Fields(header). 
-0000ca00: 2020 2020 2020 2020 2020 2023 2069 7465             # ite
-0000ca10: 6d73 0a20 2020 2020 2020 2020 2020 2023  ms.            #
-0000ca20: 2075 7064 6174 6520 636f 7079 206f 6620   update copy of 
-0000ca30: 6375 7272 656e 7420 6974 656d 7320 7769  current items wi
-0000ca40: 7468 206e 6577 2069 7465 6d73 2066 6965  th new items fie
-0000ca50: 6c64 730a 2020 2020 2020 2020 2020 2020  lds.            
-0000ca60: 6974 656d 7344 6963 7420 3d20 6d69 7174  itemsDict = miqt
-0000ca70: 692e 6372 6561 7465 496d 6167 6549 7465  i.createImageIte
-0000ca80: 6d73 4469 6374 4672 6f6d 496d 6167 6549  msDictFromImageI
-0000ca90: 7465 6d73 4c69 7374 2869 7465 6d73 290a  temsList(items).
-0000caa0: 2020 2020 2020 2020 2020 2020 7570 6461              upda
-0000cab0: 7465 6449 7465 6d73 5f63 6f70 7920 3d20  tedItems_copy = 
-0000cac0: 636f 7079 2e64 6565 7063 6f70 7928 7365  copy.deepcopy(se
-0000cad0: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-0000cae0: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
-0000caf0: 795d 290a 2020 2020 2020 2020 2020 2020  y]).            
-0000cb00: 6c6f 6720 3d20 6d69 7174 632e 7265 6375  log = miqtc.recu
-0000cb10: 7273 6976 656c 7955 7064 6174 6544 6963  rsivelyUpdateDic
-0000cb20: 7473 2875 7064 6174 6564 4974 656d 735f  ts(updatedItems_
-0000cb30: 636f 7079 2c20 6974 656d 7344 6963 742c  copy, itemsDict,
-0000cb40: 206d 6971 7476 2e69 6664 6f5f 6d75 7475   miqtv.ifdo_mutu
-0000cb50: 616c 6c79 5f65 7863 6c75 7369 7665 5f66  ally_exclusive_f
-0000cb60: 6965 6c64 7329 0a20 2020 2020 2020 2020  ields).         
-0000cb70: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-0000cb80: 286c 6f67 2c64 6f6e 7453 686f 773d 5472  (log,dontShow=Tr
-0000cb90: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-0000cba0: 6974 656d 7320 3d20 6d69 7174 692e 6372  items = miqti.cr
-0000cbb0: 6561 7465 496d 6167 6549 7465 6d73 4c69  eateImageItemsLi
-0000cbc0: 7374 4672 6f6d 496d 6167 6549 7465 6d73  stFromImageItems
-0000cbd0: 4469 6374 2875 7064 6174 6564 4974 656d  Dict(updatedItem
-0000cbe0: 735f 636f 7079 290a 0a20 2020 2020 2020  s_copy)..       
-0000cbf0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000cc00: 2020 2073 656c 662e 7365 7469 4644 4f48     self.setiFDOH
-0000cc10: 6561 6465 7246 6965 6c64 7328 6865 6164  eaderFields(head
-0000cc20: 6572 290a 0a20 2020 2020 2020 2023 2050  er)..        # P
-0000cc30: 6172 7365 2069 6d61 6765 2d61 6273 7472  arse image-abstr
-0000cc40: 6163 7420 616e 6420 6669 6c6c 2069 7473  act and fill its
-0000cc50: 2070 6c61 6365 686f 6c64 6572 7320 7769   placeholders wi
-0000cc60: 7468 2069 6e66 6f72 6d61 7469 6f6e 0a20  th information. 
-0000cc70: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0000cc80: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
-0000cc90: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-0000cca0: 5365 7448 6561 6465 724b 6579 5d5b 2769  SetHeaderKey]['i
-0000ccb0: 6d61 6765 2d61 6273 7472 6163 7427 5d20  mage-abstract'] 
-0000ccc0: 3d20 6d69 7174 732e 7061 7273 6552 6570  = miqts.parseRep
-0000ccd0: 6c61 6365 5661 6c28 7365 6c66 2e69 6664  laceVal(self.ifd
-0000cce0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-0000ccf0: 5365 7448 6561 6465 724b 6579 5d2c 2027  SetHeaderKey], '
-0000cd00: 696d 6167 652d 6162 7374 7261 6374 2729  image-abstract')
-0000cd10: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-0000cd20: 4578 6365 7074 696f 6e20 6173 2065 783a  Exception as ex:
-0000cd30: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000cd40: 662e 7072 6f76 2e6c 6f67 2822 436f 756c  f.prov.log("Coul
-0000cd50: 6420 6e6f 7420 7265 706c 6163 6520 6b65  d not replace ke
-0000cd60: 7973 2069 6e20 5c27 696d 6167 652d 6162  ys in \'image-ab
-0000cd70: 7374 7261 6374 5c27 3a20 2220 2b20 7374  stract\': " + st
-0000cd80: 7228 6578 2929 0a0a 0a20 2020 2020 2020  r(ex))...       
-0000cd90: 2023 2073 6574 2076 6572 7369 6f6e 2028   # set version (
-0000cda0: 736f 2069 7420 6361 6e6e 6f74 2062 6520  so it cannot be 
-0000cdb0: 6368 616e 6765 6420 6279 2075 7365 7229  changed by user)
-0000cdc0: 0a20 2020 2020 2020 2073 656c 662e 6966  .        self.if
-0000cdd0: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
-0000cde0: 6553 6574 4865 6164 6572 4b65 795d 5b27  eSetHeaderKey]['
-0000cdf0: 696d 6167 652d 7365 742d 6966 646f 2d76  image-set-ifdo-v
-0000ce00: 6572 7369 6f6e 275d 203d 206d 6971 7476  ersion'] = miqtv
-0000ce10: 2e69 4644 4f5f 7665 7273 696f 6e0a 0a20  .iFDO_version.. 
-0000ce20: 2020 2020 2020 2023 2056 616c 6964 6174         # Validat
-0000ce30: 6520 6974 656d 2069 6e66 6f72 6d61 7469  e item informati
-0000ce40: 6f6e 0a20 2020 2020 2020 2069 6e76 616c  on.        inval
-0000ce50: 6964 5f69 7465 6d73 203d 2030 0a20 2020  id_items = 0.   
-0000ce60: 2020 2020 2069 6d61 6765 5f73 6574 5f69       image_set_i
-0000ce70: 7465 6d73 203d 207b 7d0a 0a20 2020 2020  tems = {}..     
-0000ce80: 2020 2073 656c 662e 6d69 7373 696e 6746     self.missingF
-0000ce90: 6965 6c64 7346 6f72 4661 6972 6e65 7373  ieldsForFairness
-0000cea0: 203d 205b 5d0a 2020 2020 2020 2020 7072   = [].        pr
-0000ceb0: 6f67 203d 206d 6971 7463 2e50 7269 6e74  og = miqtc.Print
-0000cec0: 4b6e 6f77 6e50 726f 6772 6573 734d 7367  KnownProgressMsg
-0000ced0: 2822 4368 6563 6b69 6e67 2069 7465 6d73  ("Checking items
-0000cee0: 222c 206c 656e 2869 7465 6d73 292c 6d6f  ", len(items),mo
-0000cef0: 6475 6c6f 3d35 290a 2020 2020 2020 2020  dulo=5).        
-0000cf00: 666f 7220 6974 656d 2069 6e20 6974 656d  for item in item
-0000cf10: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
-0000cf20: 726f 672e 7072 6f67 7265 7373 2829 0a20  rog.progress(). 
-0000cf30: 2020 2020 2020 2020 2020 2023 2063 6865             # che
-0000cf40: 636b 2069 6620 616c 6c20 636f 7265 2066  ck if all core f
-0000cf50: 6965 6c64 7320 6172 6520 6669 6c6c 6564  ields are filled
-0000cf60: 2061 6e64 2061 7265 2066 696c 6c65 6420   and are filled 
-0000cf70: 7661 6c69 646c 790a 2020 2020 2020 2020  validly.        
-0000cf80: 2020 2020 7472 793a 0a0a 2020 2020 2020      try:..      
-0000cf90: 2020 2020 2020 2020 2020 2320 6368 6563            # chec
-0000cfa0: 6b20 6974 656d 2069 6d61 6765 2065 7869  k item image exi
-0000cfb0: 7374 730a 2020 2020 2020 2020 2020 2020  sts.            
-0000cfc0: 2020 2020 2320 6966 2069 7465 6d20 6973      # if item is
-0000cfd0: 2061 206c 6973 7420 2876 6964 656f 292c   a list (video),
-0000cfe0: 206f 6e65 2077 6f75 6c64 2068 6176 6520   one would have 
-0000cff0: 746f 2063 6865 636b 2069 6620 6561 6368  to check if each
-0000d000: 2065 6e74 7279 2069 7320 7661 6c69 6420   entry is valid 
-0000d010: 6769 7665 6e20 7468 6520 6465 6661 756c  given the defaul
-0000d020: 7420 7661 6c75 6573 2069 6e20 6669 7273  t values in firs
-0000d030: 7420 656e 7472 7920 706c 7573 2067 6976  t entry plus giv
-0000d040: 656e 2064 6566 6175 6c74 2076 616c 7565  en default value
-0000d050: 7320 696e 2068 6561 6465 720a 2020 2020  s in header.    
-0000d060: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0000d070: 6f74 2069 7369 6e73 7461 6e63 6528 6974  ot isinstance(it
-0000d080: 656d 2c6c 6973 7429 3a0a 2020 2020 2020  em,list):.      
-0000d090: 2020 2020 2020 2020 2020 2020 2020 6974                it
-0000d0a0: 656d 203d 205b 6974 656d 5d0a 2020 2020  em = [item].    
-0000d0b0: 2020 2020 2020 2020 2020 2020 7375 6249              subI
-0000d0c0: 7465 6d44 6566 6175 6c74 203d 2069 7465  temDefault = ite
-0000d0d0: 6d5b 305d 200a 2020 2020 2020 2020 2020  m[0] .          
-0000d0e0: 2020 2020 2020 666f 7220 7375 6249 7465        for subIte
-0000d0f0: 6d20 696e 2069 7465 6d3a 0a20 2020 2020  m in item:.     
-0000d100: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000d110: 6620 7375 6249 7465 6d5b 2769 6d61 6765  f subItem['image
-0000d120: 2d66 696c 656e 616d 6527 5d20 6e6f 7420  -filename'] not 
-0000d130: 696e 2073 656c 662e 5f69 6d61 6765 4e61  in self._imageNa
-0000d140: 6d65 7349 6d61 6765 7344 6972 3a0a 2020  mesImagesDir:.  
-0000d150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d160: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
-0000d170: 7074 696f 6e28 2249 7465 6d20 2722 202b  ption("Item '" +
-0000d180: 2073 7562 4974 656d 5b27 696d 6167 652d   subItem['image-
-0000d190: 6669 6c65 6e61 6d65 275d 202b 2022 2720  filename'] + "' 
-0000d1a0: 6e6f 7420 666f 756e 6420 696e 202f 7261  not found in /ra
-0000d1b0: 7720 6469 7265 6374 6f72 792e 2229 0a0a  w directory.")..
-0000d1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d1d0: 2020 2020 6d69 7373 696e 6720 3d20 6d69      missing = mi
-0000d1e0: 7174 742e 6973 5661 6c69 6469 4644 4f49  qtt.isValidiFDOI
-0000d1f0: 7465 6d28 7375 6249 7465 6d2c 207b 2a2a  tem(subItem, {**
-0000d200: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-0000d210: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-0000d220: 724b 6579 5d2c 202a 2a73 7562 4974 656d  rKey], **subItem
-0000d230: 4465 6661 756c 747d 290a 2020 2020 2020  Default}).      
-0000d240: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000d250: 206c 656e 286d 6973 7369 6e67 2920 213d   len(missing) !=
-0000d260: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0000d270: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000d280: 2e6d 6973 7369 6e67 4669 656c 6473 466f  .missingFieldsFo
-0000d290: 7246 6169 726e 6573 732e 6170 7065 6e64  rFairness.append
-0000d2a0: 2873 7562 4974 656d 5b27 696d 6167 652d  (subItem['image-
-0000d2b0: 6669 6c65 6e61 6d65 275d 202b 2022 2022  filename'] + " "
-0000d2c0: 202b 2073 7562 4974 656d 5b27 696d 6167   + subItem['imag
-0000d2d0: 652d 6461 7465 7469 6d65 275d 202b 2022  e-datetime'] + "
-0000d2e0: 3a20 2220 2b20 7374 7228 6d69 7373 696e  : " + str(missin
-0000d2f0: 6729 290a 2020 2020 2020 2020 2020 2020  g)).            
-0000d300: 2020 2020 2020 2020 0a0a 2020 2020 2020          ..      
-0000d310: 2020 2020 2020 2020 2020 696d 6167 655f            image_
-0000d320: 7365 745f 6974 656d 735b 7375 6249 7465  set_items[subIte
-0000d330: 6d44 6566 6175 6c74 5b27 696d 6167 652d  mDefault['image-
-0000d340: 6669 6c65 6e61 6d65 275d 5d20 3d20 5b5d  filename']] = []
-0000d350: 2023 2063 6f75 6c64 206d 616b 6520 616e   # could make an
-0000d360: 2065 7874 7261 2063 6173 6520 666f 7220   extra case for 
-0000d370: 696d 6167 6573 206f 6d69 7474 696e 6720  images omitting 
-0000d380: 7468 6520 6c69 7374 0a20 2020 2020 2020  the list.       
-0000d390: 2020 2020 2020 2020 2066 6f72 2073 7562           for sub
-0000d3a0: 4974 656d 2069 6e20 6974 656d 3a0a 2020  Item in item:.  
-0000d3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d3c0: 2020 7375 6249 7465 6d44 6963 7420 3d20    subItemDict = 
-0000d3d0: 7b7d 0a20 2020 2020 2020 2020 2020 2020  {}.             
-0000d3e0: 2020 2020 2020 2066 6f72 2069 7420 696e         for it in
-0000d3f0: 2073 7562 4974 656d 3a0a 2020 2020 2020   subItem:.      
-0000d400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d410: 2020 6966 2069 7420 213d 2027 696d 6167    if it != 'imag
-0000d420: 652d 6669 6c65 6e61 6d65 273a 0a20 2020  e-filename':.   
-0000d430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d440: 2020 2020 2020 2020 2073 7562 4974 656d           subItem
-0000d450: 4469 6374 5b69 745d 203d 2073 7562 4974  Dict[it] = subIt
-0000d460: 656d 5b69 745d 0a20 2020 2020 2020 2020  em[it].         
-0000d470: 2020 2020 2020 2020 2020 2069 6d61 6765             image
-0000d480: 5f73 6574 5f69 7465 6d73 5b73 7562 4974  _set_items[subIt
-0000d490: 656d 4465 6661 756c 745b 2769 6d61 6765  emDefault['image
-0000d4a0: 2d66 696c 656e 616d 6527 5d5d 2e61 7070  -filename']].app
-0000d4b0: 656e 6428 7375 6249 7465 6d44 6963 7429  end(subItemDict)
-0000d4c0: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-0000d4d0: 2020 2020 2020 2020 2020 6578 6365 7074            except
-0000d4e0: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
-0000d4f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d500: 2069 6e76 616c 6964 5f69 7465 6d73 202b   invalid_items +
-0000d510: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-0000d520: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-0000d530: 6728 2249 6e76 616c 6964 2069 6d61 6765  g("Invalid image
-0000d540: 2069 7465 6d3a 2022 2b20 7374 7228 6974   item: "+ str(it
-0000d550: 656d 292c 646f 6e74 5368 6f77 3d54 7275  em),dontShow=Tru
-0000d560: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0000d570: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-0000d580: 2822 4578 6365 7074 696f 6e3a 5c6e 222b  ("Exception:\n"+
-0000d590: 2073 7472 2865 2e61 7267 7329 2c64 6f6e   str(e.args),don
-0000d5a0: 7453 686f 773d 5472 7565 290a 2020 2020  tShow=True).    
-0000d5b0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000d5c0: 6520 6d69 7174 632e 4966 646f 4578 6365  e miqtc.IfdoExce
-0000d5d0: 7074 696f 6e28 2249 6e76 616c 6964 2069  ption("Invalid i
-0000d5e0: 6d61 6765 2069 7465 6d3a 2022 2b20 7374  mage item: "+ st
-0000d5f0: 7228 6974 656d 2920 2b20 225c 6e45 7863  r(item) + "\nExc
-0000d600: 6570 7469 6f6e 3a5c 6e22 2b20 7374 7228  eption:\n"+ str(
-0000d610: 652e 6172 6773 2929 2023 206f 7468 6572  e.args)) # other
-0000d620: 7769 7365 2c20 696e 2063 6173 6520 6f66  wise, in case of
-0000d630: 206d 616e 7920 696d 6167 6573 2c20 6974   many images, it
-0000d640: 206d 6179 206b 6565 7020 7275 6e6e 696e   may keep runnin
-0000d650: 6720 616e 6420 7468 726f 7769 6e67 2065  g and throwing e
-0000d660: 7272 6f72 7320 666f 7220 7175 6974 2073  rrors for quit s
-0000d670: 6f6d 6520 7469 6d65 0a20 2020 2020 2020  ome time.       
-0000d680: 2070 726f 672e 636c 6561 7228 290a 0a20   prog.clear().. 
-0000d690: 2020 2020 2020 2069 6620 6c65 6e28 6974         if len(it
-0000d6a0: 656d 7329 2021 3d20 3020 616e 6420 696e  ems) != 0 and in
-0000d6b0: 7661 6c69 645f 6974 656d 7320 3d3d 206c  valid_items == l
-0000d6c0: 656e 2869 7465 6d73 293a 0a20 2020 2020  en(items):.     
-0000d6d0: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
-0000d6e0: 6570 7469 6f6e 2822 416c 6c20 6974 656d  eption("All item
-0000d6f0: 7320 6172 6520 696e 7661 6c69 6422 290a  s are invalid").
-0000d700: 2020 2020 2020 2020 656c 6966 2069 6e76          elif inv
-0000d710: 616c 6964 5f69 7465 6d73 203e 2030 3a0a  alid_items > 0:.
-0000d720: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000d730: 2e70 726f 762e 6c6f 6728 2241 7420 6c65  .prov.log("At le
-0000d740: 6173 7420 2220 2b20 7374 7228 696e 7661  ast " + str(inva
-0000d750: 6c69 645f 6974 656d 7329 202b 2022 2069  lid_items) + " i
-0000d760: 7465 6d73 2077 6572 6520 696e 7661 6c69  tems were invali
-0000d770: 6420 286f 6622 202b 2073 7472 286c 656e  d (of" + str(len
-0000d780: 2869 7465 6d73 2929 2b20 2229 2229 0a0a  (items))+ ")")..
-0000d790: 2020 2020 2020 2020 2320 5661 6c69 6461          # Valida
-0000d7a0: 7465 2068 6561 6465 7220 696e 666f 726d  te header inform
-0000d7b0: 6174 696f 6e0a 2020 2020 2020 2020 7365  ation.        se
-0000d7c0: 6c66 2e6d 6973 7369 6e67 4669 656c 6473  lf.missingFields
-0000d7d0: 466f 7246 6169 726e 6573 7320 2b3d 206d  ForFairness += m
-0000d7e0: 6971 7474 2e69 7356 616c 6964 6946 444f  iqtt.isValidiFDO
-0000d7f0: 436f 7265 4865 6164 6572 2873 656c 662e  CoreHeader(self.
-0000d800: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
-0000d810: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
-0000d820: 2923 2c20 616c 6c5f 6974 656d 735f 6861  )#, all_items_ha
-0000d830: 7665 290a 2020 2020 2020 2020 7365 6c66  ve).        self
-0000d840: 2e6c 6f67 4d69 7373 696e 6746 6965 6c64  .logMissingField
-0000d850: 7328 290a 0a0a 2020 2020 2020 2020 7320  s()...        s 
-0000d860: 3d20 6d69 7174 632e 5072 696e 744c 6f61  = miqtc.PrintLoa
-0000d870: 6469 6e67 4d73 6728 2255 7064 6174 696e  dingMsg("Updatin
-0000d880: 6722 290a 2020 2020 2020 2020 6c6f 6720  g").        log 
-0000d890: 3d20 6d69 7174 632e 7265 6375 7273 6976  = miqtc.recursiv
-0000d8a0: 656c 7955 7064 6174 6544 6963 7473 2873  elyUpdateDicts(s
-0000d8b0: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
-0000d8c0: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
-0000d8d0: 6579 5d2c 2069 6d61 6765 5f73 6574 5f69  ey], image_set_i
-0000d8e0: 7465 6d73 2c20 6d69 7174 762e 6966 646f  tems, miqtv.ifdo
-0000d8f0: 5f6d 7574 7561 6c6c 795f 6578 636c 7573  _mutually_exclus
-0000d900: 6976 655f 6669 656c 6473 290a 2020 2020  ive_fields).    
-0000d910: 2020 2020 732e 7374 6f70 2829 0a20 2020      s.stop().   
-0000d920: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-0000d930: 6f67 286c 6f67 290a 0a20 2020 2020 2020  og(log)..       
-0000d940: 2023 2072 656d 6f76 6520 656d 7470 7920   # remove emtpy 
-0000d950: 6669 656c 6473 0a20 2020 2020 2020 2073  fields.        s
-0000d960: 203d 206d 6971 7463 2e50 7269 6e74 4c6f   = miqtc.PrintLo
-0000d970: 6164 696e 674d 7367 2822 5265 6d6f 7669  adingMsg("Removi
-0000d980: 6e67 2065 6d70 7479 2066 6965 6c64 7322  ng empty fields"
-0000d990: 290a 2020 2020 2020 2020 7365 6c66 2e69  ).        self.i
-0000d9a0: 6664 6f5f 746d 7020 3d20 6d69 7174 632e  fdo_tmp = miqtc.
-0000d9b0: 7265 6375 7273 6976 656c 7952 656d 6f76  recursivelyRemov
-0000d9c0: 6545 6d70 7479 4669 656c 6473 2873 656c  eEmptyFields(sel
-0000d9d0: 662e 6966 646f 5f74 6d70 290a 2020 2020  f.ifdo_tmp).    
-0000d9e0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-0000d9f0: 696d 6167 6553 6574 4974 656d 734b 6579  imageSetItemsKey
-0000da00: 2069 6e20 7365 6c66 2e69 6664 6f5f 746d   in self.ifdo_tm
-0000da10: 703a 0a20 2020 2020 2020 2020 2020 2073  p:.            s
-0000da20: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
-0000da30: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
-0000da40: 6579 5d20 3d20 5b5d 0a20 2020 2020 2020  ey] = [].       
-0000da50: 2023 2072 656d 6f76 6520 6669 656c 6473   # remove fields
-0000da60: 2074 6861 7420 636f 6e74 6169 6e20 2769   that contain 'i
-0000da70: 6d61 6765 2d64 6174 6574 696d 6527 206f  mage-datetime' o
-0000da80: 6e6c 790a 2020 2020 2020 2020 7365 6c66  nly.        self
-0000da90: 2e72 656d 6f76 6549 7465 6d46 6965 6c64  .removeItemField
-0000daa0: 7357 6974 684f 6e6c 7944 6174 6554 696d  sWithOnlyDateTim
-0000dab0: 6528 290a 2020 2020 2020 2020 732e 7374  e().        s.st
-0000dac0: 6f70 2829 0a0a 2020 2020 2020 2020 7365  op()..        se
-0000dad0: 6c66 2e63 6865 636b 416c 6c49 7465 6d48  lf.checkAllItemH
-0000dae0: 6173 6865 7328 290a 0a20 2020 2020 2020  ashes()..       
-0000daf0: 2023 2063 6865 636b 2061 6c6c 206f 7468   # check all oth
-0000db00: 6572 206b 6e6f 776e 2066 696c 6c65 6420  er known filled 
-0000db10: 6669 656c 6473 2061 7265 2066 696c 6c65  fields are fille
-0000db20: 6420 7661 6c69 646c 790a 2020 2020 2020  d validly.      
-0000db30: 2020 6d69 7174 742e 6973 5661 6c69 6469    miqtt.isValidi
-0000db40: 4644 4f43 6170 7475 7265 2873 656c 662e  FDOCapture(self.
-0000db50: 6966 646f 5f74 6d70 290a 2020 2020 2020  ifdo_tmp).      
-0000db60: 2020 6d69 7174 742e 6973 5661 6c69 6469    miqtt.isValidi
-0000db70: 4644 4f43 6f6e 7465 6e74 2873 656c 662e  FDOContent(self.
-0000db80: 6966 646f 5f74 6d70 290a 0a20 2020 2020  ifdo_tmp)..     
-0000db90: 2020 2023 2073 6574 2066 696e 616c 206f     # set final o
-0000dba0: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
-0000dbb0: 6966 646f 5f63 6865 636b 6564 203d 2063  ifdo_checked = c
-0000dbc0: 6f70 792e 6465 6570 636f 7079 2873 656c  opy.deepcopy(sel
-0000dbd0: 662e 6966 646f 5f74 6d70 290a 2020 2020  f.ifdo_tmp).    
-0000dbe0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000dbf0: 6966 646f 5f63 6865 636b 6564 0a0a 0a20  ifdo_checked... 
-0000dc00: 2020 2064 6566 206c 6f67 4d69 7373 696e     def logMissin
-0000dc10: 6746 6965 6c64 7328 7365 6c66 293a 0a20  gFields(self):. 
-0000dc20: 2020 2020 2020 2022 2222 2057 7269 7465         """ Write
-0000dc30: 7320 6669 656c 6473 206d 6973 7369 6e67  s fields missing
-0000dc40: 2074 6f20 6163 6869 6576 6520 4641 4952   to achieve FAIR
-0000dc50: 6e65 7373 2074 6f20 6c6f 6720 2222 220a  ness to log """.
-0000dc60: 2020 2020 2020 2020 6f75 7453 7472 203d          outStr =
-0000dc70: 2022 5741 524e 494e 4721 2069 4644 4f20   "WARNING! iFDO 
-0000dc80: 646f 6573 206e 6f74 2061 6368 6965 7665  does not achieve
-0000dc90: 2046 4149 526e 6573 7320 7965 7421 2046   FAIRness yet! F
-0000dca0: 6f6c 6c6f 7769 6e67 2066 6965 6c64 7320  ollowing fields 
-0000dcb0: 6172 6520 6d69 7373 696e 673a 5c6e 220a  are missing:\n".
-0000dcc0: 2020 2020 2020 2020 6920 3d20 300a 2020          i = 0.  
-0000dcd0: 2020 2020 2020 6d61 784e 724c 696e 6573        maxNrLines
-0000dce0: 203d 2031 300a 2020 2020 2020 2020 666f   = 10.        fo
-0000dcf0: 7220 6d69 7373 696e 6746 6965 6c64 2069  r missingField i
-0000dd00: 6e20 7365 6c66 2e6d 6973 7369 6e67 4669  n self.missingFi
-0000dd10: 656c 6473 466f 7246 6169 726e 6573 733a  eldsForFairness:
-0000dd20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000dd30: 6920 3e3d 206d 6178 4e72 4c69 6e65 733a  i >= maxNrLines:
-0000dd40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dd50: 206f 7574 5374 7220 2b3d 2022 5c74 2220   outStr += "\t" 
-0000dd60: 2b20 7374 7228 6c65 6e28 7365 6c66 2e6d  + str(len(self.m
-0000dd70: 6973 7369 6e67 4669 656c 6473 466f 7246  issingFieldsForF
-0000dd80: 6169 726e 6573 7329 202d 206d 6178 4e72  airness) - maxNr
-0000dd90: 4c69 6e65 7329 202b 2022 206d 6f72 652e  Lines) + " more.
-0000dda0: 2e2e 220a 2020 2020 2020 2020 2020 2020  ..".            
-0000ddb0: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
-0000ddc0: 2020 2020 2020 6f75 7453 7472 202b 3d20        outStr += 
-0000ddd0: 225c 7422 202b 206d 6973 7369 6e67 4669  "\t" + missingFi
-0000dde0: 656c 6420 2b20 225c 6e22 0a20 2020 2020  eld + "\n".     
-0000ddf0: 2020 2020 2020 2069 202b 3d20 310a 2020         i += 1.  
-0000de00: 2020 2020 2020 6966 2069 203e 2030 3a0a        if i > 0:.
-0000de10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000de20: 2e70 726f 762e 6c6f 6728 6f75 7453 7472  .prov.log(outStr
-0000de30: 290a 0a0a 2020 2020 6465 6620 6661 6972  )...    def fair
-0000de40: 6e65 7373 4163 6869 6576 6564 2873 656c  nessAchieved(sel
-0000de50: 6629 3a0a 2020 2020 2020 2020 2222 2220  f):.        """ 
-0000de60: 7265 7475 726e 7320 7768 6574 6865 7220  returns whether 
-0000de70: 616c 6c20 6669 656c 6473 2072 6571 7569  all fields requi
-0000de80: 7265 6420 746f 2061 6368 6976 6520 4641  red to achive FA
-0000de90: 4952 6e65 7373 2061 7265 2076 616c 6964  IRness are valid
-0000dea0: 6c79 2066 696c 6c65 642e 2052 756e 2063  ly filled. Run c
-0000deb0: 7265 6174 6543 6f72 6546 6965 6c64 7328  reateCoreFields(
-0000dec0: 2920 6669 7273 7421 2022 2222 0a20 2020  ) first! """.   
-0000ded0: 2020 2020 2069 6620 6c65 6e28 7365 6c66       if len(self
-0000dee0: 2e6d 6973 7369 6e67 4669 656c 6473 466f  .missingFieldsFo
-0000def0: 7246 6169 726e 6573 7329 2021 3d20 303a  rFairness) != 0:
-0000df00: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000df10: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
-0000df20: 2020 7265 7475 726e 2054 7275 650a 0a0a    return True...
-0000df30: 2020 2020 6465 6620 7265 6d6f 7665 4974      def removeIt
-0000df40: 656d 4669 656c 6473 5769 7468 4f6e 6c79  emFieldsWithOnly
-0000df50: 4461 7465 5469 6d65 2873 656c 6629 3a0a  DateTime(self):.
-0000df60: 2020 2020 2020 2020 2222 2220 6974 2063          """ it c
-0000df70: 616e 2068 6170 7065 6e20 7468 6174 2061  an happen that a
-0000df80: 6e20 696d 6167 6520 7469 6d65 7374 616d  n image timestam
-0000df90: 7020 646f 6573 206e 6f74 2063 6f6e 7461  p does not conta
-0000dfa0: 696e 2061 6e79 2066 6965 6c64 7320 6275  in any fields bu
-0000dfb0: 7420 7468 6520 7469 6d65 7374 616d 7020  t the timestamp 
-0000dfc0: 616e 7920 6d6f 7265 2e20 5468 6f73 6520  any more. Those 
-0000dfd0: 6172 6520 7265 6d6f 7665 6420 6865 7265  are removed here
-0000dfe0: 2e20 2222 2220 0a20 2020 2020 2020 2066  . """ .        f
-0000dff0: 6f72 2069 7465 6d20 696e 2073 656c 662e  or item in self.
-0000e000: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
-0000e010: 6167 6553 6574 4974 656d 734b 6579 5d3a  ageSetItemsKey]:
-0000e020: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000e030: 6e6f 7420 6973 696e 7374 616e 6365 2873  not isinstance(s
-0000e040: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
-0000e050: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
-0000e060: 6579 5d5b 6974 656d 5d2c 6c69 7374 293a  ey][item],list):
-0000e070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e080: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
-0000e090: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
-0000e0a0: 734b 6579 5d5b 6974 656d 5d20 3d20 5b73  sKey][item] = [s
-0000e0b0: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
-0000e0c0: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
-0000e0d0: 6579 5d5b 6974 656d 5d5d 0a20 2020 2020  ey][item]].     
-0000e0e0: 2020 2020 2020 2074 6f42 6552 656d 6f76         toBeRemov
-0000e0f0: 6564 203d 205b 5d0a 2020 2020 2020 2020  ed = [].        
-0000e100: 2020 2020 666f 7220 656e 7472 7920 696e      for entry in
-0000e110: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
-0000e120: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
-0000e130: 734b 6579 5d5b 6974 656d 5d3a 0a20 2020  sKey][item]:.   
-0000e140: 2020 2020 2020 2020 2020 2020 2023 7072               #pr
-0000e150: 696e 7428 656e 7472 7929 0a20 2020 2020  int(entry).     
-0000e160: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-0000e170: 6e28 656e 7472 7929 203d 3d20 3120 616e  n(entry) == 1 an
-0000e180: 6420 2769 6d61 6765 2d64 6174 6574 696d  d 'image-datetim
-0000e190: 6527 2069 6e20 656e 7472 793a 0a20 2020  e' in entry:.   
-0000e1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e1b0: 2074 6f42 6552 656d 6f76 6564 2e61 7070   toBeRemoved.app
-0000e1c0: 656e 6428 656e 7472 7929 0a20 2020 2020  end(entry).     
-0000e1d0: 2020 2020 2020 2066 6f72 2065 6e74 7279         for entry
-0000e1e0: 2069 6e20 746f 4265 5265 6d6f 7665 643a   in toBeRemoved:
-0000e1f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e200: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
-0000e210: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
-0000e220: 734b 6579 5d5b 6974 656d 5d2e 7265 6d6f  sKey][item].remo
-0000e230: 7665 2865 6e74 7279 2920 0a0a 0a20 2020  ve(entry) ...   
-0000e240: 2064 6566 2063 6865 636b 416c 6c49 7465   def checkAllIte
-0000e250: 6d48 6173 6865 7328 7365 6c66 2c20 6861  mHashes(self, ha
-0000e260: 7264 3d46 616c 7365 2c20 7261 6973 6545  rd=False, raiseE
-0000e270: 7863 6570 7469 6f6e 203d 2054 7275 6529  xception = True)
-0000e280: 3a0a 2020 2020 2020 2020 2222 2220 0a20  :.        """ . 
-0000e290: 2020 2020 2020 2043 6865 636b 7320 6966         Checks if
-0000e2a0: 2068 6173 6865 7320 696e 2069 4644 4f20   hashes in iFDO 
-0000e2b0: 6d61 7463 6820 6861 7368 6573 2069 6e20  match hashes in 
-0000e2c0: 696e 7465 726d 6569 6461 7465 2068 6173  intermeidate has
-0000e2d0: 6820 6669 6c65 2069 6620 7468 6520 6c61  h file if the la
-0000e2e0: 7474 6572 2077 6173 2063 6861 6e67 6564  tter was changed
-0000e2f0: 206c 6173 7420 6166 7465 7220 7468 6520   last after the 
-0000e300: 696d 6167 6573 2068 6173 2063 6861 6e67  images has chang
-0000e310: 6564 2e0a 2020 2020 2020 2020 4f74 6865  ed..        Othe
-0000e320: 7277 6973 6520 6f72 2069 6620 6861 7264  rwise or if hard
-0000e330: 3d3d 5472 7565 2069 7420 7265 6465 7465  ==True it redete
-0000e340: 726d 696e 6573 2074 6865 2061 6374 7561  rmines the actua
-0000e350: 6c6c 2066 696c 6527 7320 6861 7368 2061  ll file's hash a
-0000e360: 6e64 2063 6f6d 7061 7265 7320 7468 6520  nd compares the 
-0000e370: 6946 444f 2069 7465 6d27 7320 6861 7368  iFDO item's hash
-0000e380: 2077 6974 6820 7468 6174 2e0a 2020 2020   with that..    
-0000e390: 2020 2020 4966 2068 6173 6865 7320 646f      If hashes do
-0000e3a0: 206e 6f74 206d 6174 6368 2061 206d 6172   not match a mar
-0000e3b0: 6971 742e 636f 7265 2e49 6664 6f45 7863  iqt.core.IfdoExc
-0000e3c0: 6570 7469 6f6e 2069 7320 7269 7365 6e20  eption is risen 
-0000e3d0: 756e 736c 6573 7320 7261 6973 6545 7863  unsless raiseExc
-0000e3e0: 6570 7469 6f6e 203d 3d20 4661 6c73 652c  eption == False,
-0000e3f0: 2074 6865 6e20 6120 6c69 7374 206f 6620   then a list of 
-0000e400: 6c69 7374 7320 5b3c 6669 6c65 3e2c 3c65  lists [<file>,<e
-0000e410: 7863 6570 7469 6f6e 3e5d 2069 7320 7265  xception>] is re
-0000e420: 7475 726e 6564 2e0a 2020 2020 2020 2020  turned..        
-0000e430: 2222 220a 2020 2020 2020 2020 6861 7368  """.        hash
-0000e440: 6573 203d 207b 7d0a 2020 2020 2020 2020  es = {}.        
-0000e450: 6861 7368 4669 6c65 4d6f 6454 696d 6520  hashFileModTime 
-0000e460: 3d20 3130 652b 3130 300a 2020 2020 2020  = 10e+100.      
-0000e470: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
-0000e480: 7374 7328 7365 6c66 2e67 6574 5f69 6e74  sts(self.get_int
-0000e490: 5f68 6173 685f 6669 6c65 2829 293a 0a20  _hash_file()):. 
-0000e4a0: 2020 2020 2020 2020 2020 2068 6173 6865             hashe
-0000e4b0: 7320 3d20 6d69 7174 662e 7461 6246 696c  s = miqtf.tabFil
-0000e4c0: 6544 6174 6128 7365 6c66 2e67 6574 5f69  eData(self.get_i
-0000e4d0: 6e74 5f68 6173 685f 6669 6c65 2829 2c20  nt_hash_file(), 
-0000e4e0: 5b6d 6971 7476 2e63 6f6c 5f68 6561 6465  [miqtv.col_heade
-0000e4f0: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
-0000e500: 275d 2c20 6d69 7174 762e 636f 6c5f 6865  '], miqtv.col_he
-0000e510: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-0000e520: 6861 7368 275d 5d2c 206b 6579 5f63 6f6c  hash']], key_col
-0000e530: 3d6d 6971 7476 2e63 6f6c 5f68 6561 6465  =miqtv.col_heade
-0000e540: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
-0000e550: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
-0000e560: 6861 7368 4669 6c65 4d6f 6454 696d 6520  hashFileModTime 
-0000e570: 3d20 6f73 2e70 6174 682e 6765 746d 7469  = os.path.getmti
-0000e580: 6d65 2873 656c 662e 6765 745f 696e 745f  me(self.get_int_
-0000e590: 6861 7368 5f66 696c 6528 2929 0a0a 2020  hash_file())..  
-0000e5a0: 2020 2020 2020 6578 6365 7074 696f 6e4c        exceptionL
-0000e5b0: 6973 7420 3d20 5b5d 0a0a 2020 2020 2020  ist = []..      
-0000e5c0: 2020 6861 7368 556e 6368 6563 6b49 6d61    hashUncheckIma
-0000e5d0: 6765 7349 6e52 6177 203d 2073 656c 662e  gesInRaw = self.
-0000e5e0: 696d 6167 6573 496e 496d 6167 6573 4469  imagesInImagesDi
-0000e5f0: 7228 290a 2020 2020 2020 2020 7072 6f67  r().        prog
-0000e600: 203d 206d 6971 7463 2e50 7269 6e74 4b6e   = miqtc.PrintKn
-0000e610: 6f77 6e50 726f 6772 6573 734d 7367 2822  ownProgressMsg("
-0000e620: 4368 6563 6b69 6e67 2069 7465 6d20 6861  Checking item ha
-0000e630: 7368 6573 222c 206c 656e 2873 656c 662e  shes", len(self.
-0000e640: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
-0000e650: 6167 6553 6574 4974 656d 734b 6579 5d29  ageSetItemsKey])
-0000e660: 290a 2020 2020 2020 2020 666f 7220 6974  ).        for it
-0000e670: 656d 2069 6e20 7365 6c66 2e69 6664 6f5f  em in self.ifdo_
-0000e680: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
-0000e690: 7449 7465 6d73 4b65 795d 3a0a 2020 2020  tItemsKey]:.    
-0000e6a0: 2020 2020 2020 2020 7072 6f67 2e70 726f          prog.pro
-0000e6b0: 6772 6573 7328 290a 0a20 2020 2020 2020  gress()..       
-0000e6c0: 2020 2020 2066 6f75 6e64 203d 2046 616c       found = Fal
-0000e6d0: 7365 0a20 2020 2020 2020 2020 2020 2066  se.            f
-0000e6e0: 6f72 2069 6d61 6765 2069 6e20 6861 7368  or image in hash
-0000e6f0: 556e 6368 6563 6b49 6d61 6765 7349 6e52  UncheckImagesInR
-0000e700: 6177 3a0a 2020 2020 2020 2020 2020 2020  aw:.            
-0000e710: 2020 2020 6669 6c65 4e61 6d65 203d 206f      fileName = o
-0000e720: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-0000e730: 696d 6167 6529 0a20 2020 2020 2020 2020  image).         
-0000e740: 2020 2020 2020 2069 6620 6669 6c65 4e61         if fileNa
-0000e750: 6d65 203d 3d20 6974 656d 3a0a 2020 2020  me == item:.    
-0000e760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e770: 666f 756e 6420 3d20 5472 7565 0a20 2020  found = True.   
-0000e780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e790: 2069 6620 6973 696e 7374 616e 6365 2873   if isinstance(s
-0000e7a0: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
-0000e7b0: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
-0000e7c0: 6579 5d5b 6974 656d 5d2c 6c69 7374 293a  ey][item],list):
-0000e7d0: 2023 2069 6e20 6361 7365 206f 6620 7669   # in case of vi
-0000e7e0: 6465 6f20 7769 7468 2069 7465 6d20 6173  deo with item as
-0000e7f0: 206c 6973 7420 7468 6520 6669 7273 7420   list the first 
-0000e800: 656e 7472 7920 686f 6c64 7320 7468 6520  entry holds the 
-0000e810: 6465 6661 756c 7420 616e 6420 7468 6520  default and the 
-0000e820: 6861 7368 2063 616e 6e6f 7420 7661 7279  hash cannot vary
-0000e830: 2066 6f72 2074 6865 2073 616d 6520 696d   for the same im
-0000e840: 6167 650a 2020 2020 2020 2020 2020 2020  age.            
-0000e850: 2020 2020 2020 2020 2020 2020 6974 656d              item
-0000e860: 456e 7472 7920 3d20 7365 6c66 2e69 6664  Entry = self.ifd
-0000e870: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-0000e880: 5365 7449 7465 6d73 4b65 795d 5b69 7465  SetItemsKey][ite
-0000e890: 6d5d 5b30 5d20 0a20 2020 2020 2020 2020  m][0] .         
-0000e8a0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000e8b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e8c0: 2020 2020 2020 2020 2069 7465 6d45 6e74           itemEnt
-0000e8d0: 7279 203d 2073 656c 662e 6966 646f 5f74  ry = self.ifdo_t
-0000e8e0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
-0000e8f0: 4974 656d 734b 6579 5d5b 6974 656d 5d0a  ItemsKey][item].
-0000e900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e910: 2020 2020 2069 6d61 6765 4d6f 6454 696d       imageModTim
-0000e920: 6520 3d20 6f73 2e70 6174 682e 6765 746d  e = os.path.getm
-0000e930: 7469 6d65 2869 6d61 6765 290a 2020 2020  time(image).    
-0000e940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e950: 6966 206e 6f74 2068 6172 6420 616e 6420  if not hard and 
-0000e960: 696d 6167 654d 6f64 5469 6d65 203c 2068  imageModTime < h
-0000e970: 6173 6846 696c 654d 6f64 5469 6d65 3a0a  ashFileModTime:.
-0000e980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e990: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
-0000e9a0: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-0000e9b0: 696d 6167 6529 2069 6e20 6861 7368 6573  image) in hashes
-0000e9c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000e9d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000e9e0: 2072 6169 7365 4578 6365 7074 696f 6e3a   raiseException:
-0000e9f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ea00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea10: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
-0000ea20: 6f45 7863 6570 7469 6f6e 2869 7465 6d2c  oException(item,
-0000ea30: 2022 6e6f 7420 666f 756e 6420 696e 2069   "not found in i
-0000ea40: 6e74 6572 6d65 6964 6174 6520 6861 7368  ntermeidate hash
-0000ea50: 2066 696c 6522 2c73 656c 662e 6765 745f   file",self.get_
-0000ea60: 696e 745f 6861 7368 5f66 696c 6528 292c  int_hash_file(),
-0000ea70: 2220 7275 6e20 6372 6561 7465 496d 6167  " run createImag
-0000ea80: 6553 4841 3235 3646 696c 6528 2920 6669  eSHA256File() fi
-0000ea90: 7273 7422 2920 0a20 2020 2020 2020 2020  rst") .         
-0000eaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eab0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000eac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ead0: 2020 2020 2020 2020 2065 7863 6570 7469           excepti
-0000eae0: 6f6e 4c69 7374 2e61 7070 656e 6428 5b66  onList.append([f
-0000eaf0: 696c 654e 616d 652c 226e 6f74 2066 6f75  ileName,"not fou
-0000eb00: 6e64 2069 6e20 696e 7465 726d 6569 6461  nd in intermeida
-0000eb10: 7465 2068 6173 6820 6669 6c65 2022 202b  te hash file " +
-0000eb20: 2073 7472 2873 656c 662e 6765 745f 696e   str(self.get_in
-0000eb30: 745f 6861 7368 5f66 696c 6528 2929 5d29  t_hash_file())])
-0000eb40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000eb50: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-0000eb60: 6974 656d 456e 7472 795b 2769 6d61 6765  itemEntry['image
-0000eb70: 2d68 6173 682d 7368 6132 3536 275d 203d  -hash-sha256'] =
-0000eb80: 3d20 6861 7368 6573 5b6f 732e 7061 7468  = hashes[os.path
-0000eb90: 2e62 6173 656e 616d 6528 696d 6167 6529  .basename(image)
-0000eba0: 5d5b 2769 6d61 6765 2d68 6173 682d 7368  ]['image-hash-sh
-0000ebb0: 6132 3536 275d 3a0a 2020 2020 2020 2020  a256']:.        
-0000ebc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ebd0: 2020 2020 6966 2072 6169 7365 4578 6365      if raiseExce
-0000ebe0: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
-0000ebf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec00: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
-0000ec10: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
-0000ec20: 2869 7465 6d2c 2022 696e 636f 7272 6563  (item, "incorrec
-0000ec30: 7420 7368 6132 3536 2068 6173 6822 2c20  t sha256 hash", 
-0000ec40: 6974 656d 456e 7472 795b 2769 6d61 6765  itemEntry['image
-0000ec50: 2d68 6173 682d 7368 6132 3536 275d 2c22  -hash-sha256'],"
-0000ec60: 666f 7220 6669 6c65 222c 6669 6c65 4e61  for file",fileNa
-0000ec70: 6d65 2c22 2072 756e 2063 7265 6174 6549  me," run createI
-0000ec80: 6d61 6765 5348 4132 3536 4669 6c65 2829  mageSHA256File()
-0000ec90: 2066 6972 7374 2229 0a20 2020 2020 2020   first").       
-0000eca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ecb0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000ecc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ecd0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-0000ece0: 7469 6f6e 4c69 7374 2e61 7070 656e 6428  tionList.append(
-0000ecf0: 5b66 696c 654e 616d 652c 2269 6e63 6f72  [fileName,"incor
-0000ed00: 7265 6374 2073 6861 3235 3620 6861 7368  rect sha256 hash
-0000ed10: 225d 290a 2020 2020 2020 2020 2020 2020  "]).            
-0000ed20: 2020 2020 2020 2020 656c 6966 206e 6f74          elif not
-0000ed30: 2069 7465 6d45 6e74 7279 5b27 696d 6167   itemEntry['imag
-0000ed40: 652d 6861 7368 2d73 6861 3235 3627 5d20  e-hash-sha256'] 
-0000ed50: 3d3d 206d 6971 7463 2e73 6861 3235 3648  == miqtc.sha256H
-0000ed60: 6173 6846 696c 6528 696d 6167 6529 3a0a  ashFile(image):.
-0000ed70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed80: 2020 2020 2020 2020 6966 2072 6169 7365          if raise
-0000ed90: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
-0000eda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000edb0: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
-0000edc0: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
-0000edd0: 2869 7465 6d2c 2022 696e 636f 7272 6563  (item, "incorrec
-0000ede0: 7420 7368 6132 3536 2068 6173 6822 2c20  t sha256 hash", 
-0000edf0: 6974 656d 456e 7472 795b 2769 6d61 6765  itemEntry['image
-0000ee00: 2d68 6173 682d 7368 6132 3536 275d 2c22  -hash-sha256'],"
-0000ee10: 666f 7220 6669 6c65 222c 6669 6c65 4e61  for file",fileNa
-0000ee20: 6d65 2c22 2072 756e 2063 7265 6174 6549  me," run createI
-0000ee30: 6d61 6765 5348 4132 3536 4669 6c65 2829  mageSHA256File()
-0000ee40: 2066 6972 7374 2229 0a20 2020 2020 2020   first").       
-0000ee50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee60: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000ee70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee80: 2020 2065 7863 6570 7469 6f6e 4c69 7374     exceptionList
-0000ee90: 2e61 7070 656e 6428 5b66 696c 654e 616d  .append([fileNam
-0000eea0: 652c 2269 6e63 6f72 7265 6374 2073 6861  e,"incorrect sha
-0000eeb0: 3235 3620 6861 7368 225d 290a 2020 2020  256 hash"]).    
-0000eec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eed0: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
-0000eee0: 2020 6966 2066 6f75 6e64 3a0a 2020 2020    if found:.    
-0000eef0: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
-0000ef00: 6861 7368 556e 6368 6563 6b49 6d61 6765  hashUncheckImage
-0000ef10: 7349 6e52 6177 5b69 6d61 6765 5d0a 2020  sInRaw[image].  
-0000ef20: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0000ef30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef40: 6966 2072 6169 7365 4578 6365 7074 696f  if raiseExceptio
-0000ef50: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
-0000ef60: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
-0000ef70: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
-0000ef80: 2820 2269 6d61 6765 222c 2069 7465 6d2c  ( "image", item,
-0000ef90: 2022 6e6f 7420 666f 756e 6420 696e 2064   "not found in d
-0000efa0: 6972 6563 746f 7279 2773 2072 6177 2066  irectory's raw f
-0000efb0: 6f6c 6465 7221 2229 0a20 2020 2020 2020  older!").       
-0000efc0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000efd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000efe0: 2020 2065 7863 6570 7469 6f6e 4c69 7374     exceptionList
-0000eff0: 2e61 7070 656e 6428 5b66 696c 654e 616d  .append([fileNam
-0000f000: 652c 2266 696c 6520 6e6f 7420 666f 756e  e,"file not foun
-0000f010: 6422 5d29 0a20 2020 2020 2020 2070 726f  d"]).        pro
-0000f020: 672e 636c 6561 7228 290a 2020 2020 2020  g.clear().      
-0000f030: 2020 6966 206e 6f74 2072 6169 7365 4578    if not raiseEx
-0000f040: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
-0000f050: 2020 2020 2072 6574 7572 6e20 6578 6365       return exce
-0000f060: 7074 696f 6e4c 6973 740a 0a0a 2020 2020  ptionList...    
-0000f070: 6465 6620 6372 6561 7465 5555 4944 4669  def createUUIDFi
-0000f080: 6c65 2873 656c 662c 636c 6561 6e3d 5472  le(self,clean=Tr
-0000f090: 7565 293a 0a20 2020 2020 2020 2022 2222  ue):.        """
-0000f0a0: 2043 7265 6174 6573 2069 6e20 2f69 6e74   Creates in /int
-0000f0b0: 6572 6d65 6469 6174 6520 6120 7465 7874  ermediate a text
-0000f0c0: 2066 696c 6520 636f 6e74 6169 6e69 6e67   file containing
-0000f0d0: 2070 6572 2069 6d61 6765 2061 2063 7265   per image a cre
-0000f0e0: 6174 6564 2075 7569 6420 2876 6572 7369  ated uuid (versi
-0000f0f0: 6f6e 2034 292e 0a0a 2020 2020 2020 2020  on 4)...        
-0000f100: 5468 6520 5555 4944 2069 7320 6f6e 6c79  The UUID is only
-0000f110: 202a 7461 6b65 6e2a 2066 726f 6d20 7468   *taken* from th
-0000f120: 6520 6d65 7461 6461 7461 206f 6620 7468  e metadata of th
-0000f130: 6520 696d 6167 6573 2e20 4974 2064 6f65  e images. It doe
-0000f140: 7320 6e6f 7420 7772 6974 6520 5555 4944  s not write UUID
-0000f150: 7320 746f 2074 6865 206d 6574 6164 6174  s to the metadat
-0000f160: 6120 696e 2063 6173 6520 736f 6d65 2066  a in case some f
-0000f170: 696c 6573 2061 7265 206d 6973 7369 6e67  iles are missing
-0000f180: 2069 742e 0a20 2020 2020 2020 2042 7574   it..        But
-0000f190: 2c20 6974 2063 7265 6174 6573 2061 2043  , it creates a C
-0000f1a0: 5356 2066 696c 6520 696e 2074 6861 7420  SV file in that 
-0000f1b0: 6361 7365 2074 6861 7420 796f 7520 6361  case that you ca
-0000f1c0: 6e20 7573 6520 746f 6765 7468 6572 2077  n use together w
-0000f1d0: 6974 6820 6578 6966 746f 6f6c 2074 6f20  ith exiftool to 
-0000f1e0: 6164 6420 7468 6520 5555 4944 2074 6f20  add the UUID to 
-0000f1f0: 796f 7572 2064 6174 612e 2042 6577 6172  your data. Bewar
-0000f200: 6521 2074 6869 7320 6361 6e20 6465 7374  e! this can dest
-0000f210: 726f 7920 796f 7572 2069 6d61 6765 730a  roy your images.
-0000f220: 2020 2020 2020 2020 6966 206e 6f74 2064          if not d
-0000f230: 6f6e 6520 7072 6f70 6572 6c79 2120 4e6f  one properly! No
-0000f240: 2067 7561 7261 6e74 6565 2069 7320 6769   guarantee is gi
-0000f250: 7665 6e20 6974 2077 696c 6c20 776f 726b  ven it will work
-0000f260: 2e20 4265 2063 6172 6566 756c 210a 0a20  . Be careful!.. 
-0000f270: 2020 2020 2020 2055 7365 2063 6c65 616e         Use clean
-0000f280: 3d46 616c 7365 2074 6f20 6e6f 7420 6368  =False to not ch
-0000f290: 6563 6b20 7468 6f73 6520 6669 6c65 7320  eck those files 
-0000f2a0: 6167 6169 6e20 7768 6963 6820 6172 6520  again which are 
-0000f2b0: 616c 7265 6164 7920 666f 756e 6420 696e  already found in
-0000f2c0: 2069 6e74 6572 6d65 6469 6174 6520 7575   intermediate uu
-0000f2d0: 6964 2066 696c 650a 2020 2020 2020 2020  id file.        
-0000f2e0: 2222 220a 0a20 2020 2020 2020 2075 7569  """..        uui
-0000f2f0: 6473 203d 207b 7d0a 2020 2020 2020 2020  ds = {}.        
-0000f300: 2320 4368 6563 6b20 7768 6574 6865 7220  # Check whether 
-0000f310: 6120 6669 6c65 2077 6974 6820 5555 4944  a file with UUID
-0000f320: 7320 6578 6973 7473 2c20 7468 656e 2072  s exists, then r
-0000f330: 6561 6420 6974 0a20 2020 2020 2020 2069  ead it.        i
-0000f340: 6620 6e6f 7420 636c 6561 6e20 616e 6420  f not clean and 
-0000f350: 6f73 2e70 6174 682e 6578 6973 7473 2873  os.path.exists(s
-0000f360: 656c 662e 6765 745f 696e 745f 7575 6964  elf.get_int_uuid
-0000f370: 5f66 696c 6528 2929 3a0a 2020 2020 2020  _file()):.      
-0000f380: 2020 2020 2020 7575 6964 7320 3d20 6d69        uuids = mi
-0000f390: 7174 662e 7461 6246 696c 6544 6174 6128  qtf.tabFileData(
-0000f3a0: 7365 6c66 2e67 6574 5f69 6e74 5f75 7569  self.get_int_uui
-0000f3b0: 645f 6669 6c65 2829 2c20 5b6d 6971 7476  d_file(), [miqtv
-0000f3c0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-0000f3d0: 6971 7427 5d5b 2769 6d67 275d 2c20 6d69  iqt']['img'], mi
-0000f3e0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-0000f3f0: 6d61 7269 7174 275d 5b27 7575 6964 275d  mariqt']['uuid']
-0000f400: 5d2c 206b 6579 5f63 6f6c 3d6d 6971 7476  ], key_col=miqtv
-0000f410: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-0000f420: 6971 7427 5d5b 2769 6d67 275d 290a 2020  iqt']['img']).  
-0000f430: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-0000f440: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
-0000f450: 6973 7473 2873 656c 662e 696d 6167 6573  ists(self.images
-0000f460: 4469 7229 3a0a 0a20 2020 2020 2020 2020  Dir):..         
-0000f470: 2020 206d 6973 7369 6e67 5f75 7569 6473     missing_uuids
-0000f480: 203d 207b 7d0a 2020 2020 2020 2020 2020   = {}.          
-0000f490: 2020 6164 6465 645f 7575 6964 7320 3d20    added_uuids = 
-0000f4a0: 300a 0a20 2020 2020 2020 2020 2020 2075  0..            u
-0000f4b0: 6e6b 6e6f 776e 4669 6c65 7320 3d20 5b5d  nknownFiles = []
-0000f4c0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0000f4d0: 2066 696c 6520 696e 2073 656c 662e 696d   file in self.im
-0000f4e0: 6167 6573 496e 496d 6167 6573 4469 7228  agesInImagesDir(
-0000f4f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000f500: 2020 2066 696c 655f 6e61 6d65 203d 206f     file_name = o
-0000f510: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-0000f520: 6669 6c65 290a 2020 2020 2020 2020 2020  file).          
-0000f530: 2020 2020 2020 6966 2066 696c 655f 6e61        if file_na
-0000f540: 6d65 206e 6f74 2069 6e20 7575 6964 733a  me not in uuids:
-0000f550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f560: 2020 2020 2075 6e6b 6e6f 776e 4669 6c65       unknownFile
-0000f570: 732e 6170 7065 6e64 2866 696c 6529 0a20  s.append(file). 
-0000f580: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000f590: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000f5a0: 2020 2020 2020 2020 2075 7569 6473 5b66           uuids[f
-0000f5b0: 696c 655f 6e61 6d65 5d20 3d20 7575 6964  ile_name] = uuid
-0000f5c0: 735b 6669 6c65 5f6e 616d 655d 5b6d 6971  s[file_name][miq
-0000f5d0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-0000f5e0: 6172 6971 7427 5d5b 2775 7569 6427 5d5d  ariqt']['uuid']]
-0000f5f0: 0a0a 2020 2020 2020 2020 2020 2020 756e  ..            un
-0000f600: 6b6e 6f77 6e46 696c 6573 5555 4944 7320  knownFilesUUIDs 
-0000f610: 3d20 6d69 7174 692e 696d 6167 6573 436f  = miqti.imagesCo
-0000f620: 6e74 6169 6e56 616c 6964 5555 4944 2875  ntainValidUUID(u
-0000f630: 6e6b 6e6f 776e 4669 6c65 7329 0a20 2020  nknownFiles).   
-0000f640: 2020 2020 2020 2020 2066 6f72 2066 696c           for fil
-0000f650: 6520 696e 2075 6e6b 6e6f 776e 4669 6c65  e in unknownFile
-0000f660: 7355 5549 4473 3a0a 2020 2020 2020 2020  sUUIDs:.        
-0000f670: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
-0000f680: 6520 3d20 6f73 2e70 6174 682e 6261 7365  e = os.path.base
-0000f690: 6e61 6d65 2866 696c 6529 0a20 2020 2020  name(file).     
-0000f6a0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0000f6b0: 7420 756e 6b6e 6f77 6e46 696c 6573 5555  t unknownFilesUU
-0000f6c0: 4944 735b 6669 6c65 5d5b 2776 616c 6964  IDs[file]['valid
-0000f6d0: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
-0000f6e0: 2020 2020 2020 2020 7575 6964 203d 206d          uuid = m
-0000f6f0: 6971 7463 2e75 7569 6434 2829 0a20 2020  iqtc.uuid4().   
-0000f700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f710: 206d 6973 7369 6e67 5f75 7569 6473 5b66   missing_uuids[f
-0000f720: 696c 655d 203d 2075 7569 640a 2020 2020  ile] = uuid.    
-0000f730: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000f740: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000f750: 2020 2020 2020 7575 6964 735b 6669 6c65        uuids[file
-0000f760: 5f6e 616d 655d 203d 2075 6e6b 6e6f 776e  _name] = unknown
-0000f770: 4669 6c65 7355 5549 4473 5b66 696c 655d  FilesUUIDs[file]
-0000f780: 5b27 7575 6964 275d 0a20 2020 2020 2020  ['uuid'].       
-0000f790: 2020 2020 2020 2020 2020 2020 2061 6464               add
-0000f7a0: 6564 5f75 7569 6473 202b 3d20 310a 0a20  ed_uuids += 1.. 
-0000f7b0: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
-0000f7c0: 7072 6576 696f 7573 6c79 2075 6e6b 6e6f  previously unkno
-0000f7d0: 776e 2055 5549 4473 2077 6572 6520 666f  wn UUIDs were fo
-0000f7e0: 756e 6420 696e 2074 6865 2066 696c 6520  und in the file 
-0000f7f0: 6865 6164 6572 732c 2061 6464 2074 6865  headers, add the
-0000f800: 6d20 746f 2074 6865 2055 5549 4420 6669  m to the UUID fi
-0000f810: 6c65 0a20 2020 2020 2020 2020 2020 2069  le.            i
-0000f820: 6620 6164 6465 645f 7575 6964 7320 3e20  f added_uuids > 
-0000f830: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0000f840: 2020 2072 6573 203d 206f 7065 6e28 7365     res = open(se
-0000f850: 6c66 2e67 6574 5f69 6e74 5f75 7569 645f  lf.get_int_uuid_
-0000f860: 6669 6c65 2829 2c20 2277 2229 0a20 2020  file(), "w").   
-0000f870: 2020 2020 2020 2020 2020 2020 2072 6573               res
-0000f880: 2e77 7269 7465 286d 6971 7476 2e63 6f6c  .write(miqtv.col
-0000f890: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-0000f8a0: 5d5b 2769 6d67 275d 202b 225c 7422 2b6d  ]['img'] +"\t"+m
-0000f8b0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-0000f8c0: 276d 6172 6971 7427 5d5b 2775 7569 6427  'mariqt']['uuid'
-0000f8d0: 5d2b 225c 6e22 290a 2020 2020 2020 2020  ]+"\n").        
-0000f8e0: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
-0000f8f0: 2069 6e20 7575 6964 733a 0a20 2020 2020   in uuids:.     
-0000f900: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000f910: 6573 2e77 7269 7465 2866 696c 652b 225c  es.write(file+"\
-0000f920: 7422 2b73 7472 2875 7569 6473 5b66 696c  t"+str(uuids[fil
-0000f930: 655d 292b 225c 6e22 290a 2020 2020 2020  e])+"\n").      
-0000f940: 2020 2020 2020 2020 2020 7265 732e 636c            res.cl
-0000f950: 6f73 6528 290a 0a20 2020 2020 2020 2020  ose()..         
-0000f960: 2020 2069 6620 6c65 6e28 6d69 7373 696e     if len(missin
-0000f970: 675f 7575 6964 7329 203e 2030 3a0a 2020  g_uuids) > 0:.  
-0000f980: 2020 2020 2020 2020 2020 2020 2020 6563                ec
-0000f990: 7376 5f70 6174 6820 3d20 7365 6c66 2e5f  sv_path = self._
-0000f9a0: 5f67 6574 5f69 6e74 5f66 696c 655f 7072  _get_int_file_pr
-0000f9b0: 6566 6978 2829 202b 2022 5f65 7869 662d  efix() + "_exif-
-0000f9c0: 6164 642d 7575 6964 2e63 7376 220a 2020  add-uuid.csv".  
-0000f9d0: 2020 2020 2020 2020 2020 2020 2020 6373                cs
-0000f9e0: 7620 3d20 6f70 656e 2865 6373 765f 7061  v = open(ecsv_pa
-0000f9f0: 7468 2c20 2277 2229 0a20 2020 2020 2020  th, "w").       
-0000fa00: 2020 2020 2020 2020 2063 7376 2e77 7269           csv.wri
-0000fa10: 7465 286d 6971 7476 2e63 6f6c 5f68 6561  te(miqtv.col_hea
-0000fa20: 6465 725b 2765 7869 6627 5d5b 2769 6d67  der['exif']['img
-0000fa30: 275d 202b 0a20 2020 2020 2020 2020 2020  '] +.           
-0000fa40: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000fa50: 2c22 2b6d 6971 7476 2e63 6f6c 5f68 6561  ,"+miqtv.col_hea
-0000fa60: 6465 725b 2765 7869 6627 5d5b 2775 7569  der['exif']['uui
-0000fa70: 6427 5d2b 225c 6e22 290a 2020 2020 2020  d']+"\n").      
-0000fa80: 2020 2020 2020 2020 2020 6469 6666 6572            differ
-0000fa90: 656e 745f 7061 7468 7320 3d20 5b5d 0a20  ent_paths = []. 
-0000faa0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000fab0: 6f72 2069 6d67 2069 6e20 6d69 7373 696e  or img in missin
-0000fac0: 675f 7575 6964 733a 0a20 2020 2020 2020  g_uuids:.       
-0000fad0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000fae0: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
-0000faf0: 2869 6d67 2920 6e6f 7420 696e 2064 6966  (img) not in dif
-0000fb00: 6665 7265 6e74 5f70 6174 6873 3a0a 2020  ferent_paths:.  
-0000fb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb20: 2020 2020 2020 6469 6666 6572 656e 745f        different_
-0000fb30: 7061 7468 732e 6170 7065 6e64 286f 732e  paths.append(os.
-0000fb40: 7061 7468 2e62 6173 656e 616d 6528 696d  path.basename(im
-0000fb50: 6729 290a 2020 2020 2020 2020 2020 2020  g)).            
-0000fb60: 2020 2020 2020 2020 6373 762e 7772 6974          csv.writ
-0000fb70: 6528 696d 672b 222c 222b 7374 7228 6d69  e(img+","+str(mi
-0000fb80: 7373 696e 675f 7575 6964 735b 696d 675d  ssing_uuids[img]
-0000fb90: 292b 225c 6e22 290a 2020 2020 2020 2020  )+"\n").        
-0000fba0: 2020 2020 2020 2020 2372 6574 7572 6e20          #return 
-0000fbb0: 4661 6c73 652c 2022 6578 6966 746f 6f6c  False, "exiftool
-0000fbc0: 202d 6373 763d 222b 6563 7376 5f70 6174   -csv="+ecsv_pat
-0000fbd0: 682b 2220 222b 2220 222e 6a6f 696e 2864  h+" "+" ".join(d
-0000fbe0: 6966 6665 7265 6e74 5f70 6174 6873 290a  ifferent_paths).
-0000fbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc00: 7265 7475 726e 2046 616c 7365 2c20 224e  return False, "N
-0000fc10: 6f74 2061 6c6c 2069 6d61 6765 7320 6861  ot all images ha
-0000fc20: 7665 2076 616c 6964 2055 5549 4473 2e20  ve valid UUIDs. 
-0000fc30: 4d69 7373 696e 6720 666f 7220 666f 6c6c  Missing for foll
-0000fc40: 6f77 696e 6720 6669 6c65 733a 5c6e 222b  owing files:\n"+
-0000fc50: 225c c586 222e 6a6f 696e 2864 6966 6665  "\..".join(diffe
-0000fc60: 7265 6e74 5f70 6174 6873 290a 2020 2020  rent_paths).    
-0000fc70: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-0000fc80: 2020 2020 2073 656c 662e 5f5f 616c 6c55       self.__allU
-0000fc90: 5549 4473 4368 6563 6b65 6420 3d20 5472  UIDsChecked = Tr
-0000fca0: 7565 0a20 2020 2020 2020 2020 2020 2072  ue.            r
-0000fcb0: 6574 7572 6e20 5472 7565 2c20 2241 6c6c  eturn True, "All
-0000fcc0: 2069 6d61 6765 7320 6861 7665 2061 2055   images have a U
-0000fcd0: 5549 4422 0a20 2020 2020 2020 2072 6574  UID".        ret
-0000fce0: 7572 6e20 4661 6c73 652c 2022 5061 7468  urn False, "Path
-0000fcf0: 2022 2b73 656c 662e 696d 6167 6573 4469   "+self.imagesDi
-0000fd00: 7220 2b20 2220 6e6f 7420 666f 756e 642e  r + " not found.
-0000fd10: 220a 0a0a 2020 2020 6465 6620 7365 7449  "...    def setI
-0000fd20: 6d61 6765 5365 7441 7474 6974 7564 6528  mageSetAttitude(
-0000fd30: 7365 6c66 2c79 6177 5f66 7261 6d65 3a66  self,yaw_frame:f
-0000fd40: 6c6f 6174 2c70 6974 6368 5f66 7261 6d65  loat,pitch_frame
-0000fd50: 3a66 6c6f 6174 2c72 6f6c 6c5f 6672 616d  :float,roll_fram
-0000fd60: 653a 666c 6f61 742c 7961 775f 6361 6d32  e:float,yaw_cam2
-0000fd70: 6672 616d 653a 666c 6f61 742c 7069 7463  frame:float,pitc
-0000fd80: 685f 6361 6d32 6672 616d 653a 666c 6f61  h_cam2frame:floa
-0000fd90: 742c 726f 6c6c 5f63 616d 3266 7261 6d65  t,roll_cam2frame
-0000fda0: 3a66 6c6f 6174 293a 0a20 2020 2020 2020  :float):.       
-0000fdb0: 2022 2222 2063 616c 6375 6c61 7465 7320   """ calculates 
-0000fdc0: 7468 6520 7468 6520 6361 6d65 7261 7320  the the cameras 
-0000fdd0: 6162 736f 6c75 7465 2061 7474 6974 7564  absolute attitud
-0000fde0: 6520 616e 6420 7365 7473 2069 7420 746f  e and sets it to
-0000fdf0: 2069 6d61 6765 2073 6574 2068 6561 6465   image set heade
-0000fe00: 722e 2041 6c6c 2061 6e67 6c65 7320 6172  r. All angles ar
-0000fe10: 6520 6578 7065 6374 6564 2069 6e20 6465  e expected in de
-0000fe20: 6772 6565 732e 200a 2020 2020 2020 2020  grees. .        
-0000fe30: 6361 6d65 7261 3266 7261 6d65 2061 6e67  camera2frame ang
-0000fe40: 6c65 733a 2072 6f74 6174 696f 6e20 6f66  les: rotation of
-0000fe50: 2063 616d 6572 6120 636f 6f72 6469 6e61   camera coordina
-0000fe60: 7465 7320 2878 2c79 2c7a 203d 2074 6f70  tes (x,y,z = top
-0000fe70: 2c20 7269 6768 742c 206c 696e 6520 6f66  , right, line of
-0000fe80: 2073 6967 6874 2920 7769 7468 2072 6573   sight) with res
-0000fe90: 7065 6374 2074 6f20 7665 6869 636c 6520  pect to vehicle 
-0000fea0: 636f 6f72 6469 6e61 7465 7320 2878 2c79  coordinates (x,y
-0000feb0: 2c7a 203d 2066 6f72 7761 7264 2c72 6967  ,z = forward,rig
-0000fec0: 6874 2c64 6f77 6e29 200a 2020 2020 2020  ht,down) .      
-0000fed0: 2020 696e 2061 6363 6f72 6461 6e63 6520    in accordance 
-0000fee0: 7769 7468 2074 6865 2079 6177 2c70 6974  with the yaw,pit
-0000fef0: 6368 2c72 6f6c 6c20 726f 7461 7469 6f6e  ch,roll rotation
-0000ff00: 206f 7264 6572 2063 6f6e 7665 6e74 696f   order conventio
-0000ff10: 6e3a 0a0a 2020 2020 2020 2020 312e 2079  n:..        1. y
-0000ff20: 6177 2061 726f 756e 6420 7a2c 0a20 2020  aw around z,.   
-0000ff30: 2020 2020 2032 2e20 7069 7463 6820 6172       2. pitch ar
-0000ff40: 6f75 6e64 2072 6f74 6174 6564 2079 2c0a  ound rotated y,.
-0000ff50: 2020 2020 2020 2020 332e 2072 6f6c 6c20          3. roll 
-0000ff60: 6172 6f75 6e64 2072 6f74 6174 6564 2078  around rotated x
-0000ff70: 0a0a 2020 2020 2020 2020 526f 7461 7469  ..        Rotati
-0000ff80: 6f6e 2064 6972 6563 7469 6f6e 7320 6163  on directions ac
-0000ff90: 636f 7264 696e 6720 746f 205c 2772 6967  cording to \'rig
-0000ffa0: 6874 2d68 616e 6420 7275 6c65 5c27 2e0a  ht-hand rule\'..
-0000ffb0: 0a20 2020 2020 2020 2049 2e65 2e20 6361  .        I.e. ca
-0000ffc0: 6d65 7261 3246 7261 6d65 2061 6e67 6c65  mera2Frame angle
-0000ffd0: 7320 3d20 302c 302c 3020 6361 6d65 7261  s = 0,0,0 camera
-0000ffe0: 2069 7320 6661 6369 6e67 2064 6f77 6e77   is facing downw
-0000fff0: 6172 6420 7769 7468 2074 6f70 2073 6964  ard with top sid
-00010000: 6520 746f 7761 7264 7320 7665 6869 636c  e towards vehicl
-00010010: 6527 7320 666f 7277 6172 6420 6469 7265  e's forward dire
-00010020: 6374 696f 6e27 2022 2222 0a0a 2020 2020  ction' """..    
-00010030: 2020 2020 525f 6672 616d 6532 6e65 6420      R_frame2ned 
-00010040: 3d20 6d69 7174 672e 525f 5961 7750 6974  = miqtg.R_YawPit
-00010050: 6368 526f 6c6c 2879 6177 5f66 7261 6d65  chRoll(yaw_frame
-00010060: 2c70 6974 6368 5f66 7261 6d65 2c72 6f6c  ,pitch_frame,rol
-00010070: 6c5f 6672 616d 6529 0a20 2020 2020 2020  l_frame).       
-00010080: 2052 5f63 616d 3266 7261 6d65 203d 206d   R_cam2frame = m
-00010090: 6971 7467 2e52 5f59 6177 5069 7463 6852  iqtg.R_YawPitchR
-000100a0: 6f6c 6c28 7961 775f 6361 6d32 6672 616d  oll(yaw_cam2fram
-000100b0: 652c 7069 7463 685f 6361 6d32 6672 616d  e,pitch_cam2fram
-000100c0: 652c 726f 6c6c 5f63 616d 3266 7261 6d65  e,roll_cam2frame
-000100d0: 290a 2020 2020 2020 2020 525f 6361 6d32  ).        R_cam2
-000100e0: 6e65 6420 3d20 525f 6672 616d 6532 6e65  ned = R_frame2ne
-000100f0: 642e 646f 7428 525f 6361 6d32 6672 616d  d.dot(R_cam2fram
-00010100: 6529 0a20 2020 2020 2020 2079 6177 2c70  e).        yaw,p
-00010110: 6974 6368 2c72 6f6c 6c20 3d20 6d69 7174  itch,roll = miqt
-00010120: 672e 7961 7750 6974 6368 526f 6c6c 2852  g.yawPitchRoll(R
-00010130: 5f63 616d 326e 6564 290a 0a20 2020 2020  _cam2ned)..     
-00010140: 2020 2023 2070 6f73 6520 6d61 7472 6978     # pose matrix
-00010150: 2063 616d 3275 746d 0a20 2020 2020 2020   cam2utm.       
-00010160: 2052 5f63 616d 5374 6432 7574 6d20 3d20   R_camStd2utm = 
-00010170: 7365 6c66 2e67 6574 5f52 5f63 616d 5374  self.get_R_camSt
-00010180: 6432 7574 6d28 525f 6361 6d32 6672 616d  d2utm(R_cam2fram
-00010190: 652c 525f 6672 616d 6532 6e65 6429 0a0a  e,R_frame2ned)..
-000101a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000101b0: 2020 2020 7820 3d20 6e70 2e61 7272 6179      x = np.array
-000101c0: 285b 312c 302c 305d 290a 2020 2020 2020  ([1,0,0]).      
-000101d0: 2020 7920 3d20 6e70 2e61 7272 6179 285b    y = np.array([
-000101e0: 302c 312c 305d 290a 2020 2020 2020 2020  0,1,0]).        
-000101f0: 7a20 3d20 6e70 2e61 7272 6179 285b 302c  z = np.array([0,
-00010200: 302c 315d 290a 2020 2020 2020 2020 7072  0,1]).        pr
-00010210: 696e 7428 2778 272c 525f 6361 6d53 7464  int('x',R_camStd
-00010220: 3275 746d 2e64 6f74 2878 292e 726f 756e  2utm.dot(x).roun
-00010230: 6428 3529 290a 2020 2020 2020 2020 7072  d(5)).        pr
-00010240: 696e 7428 2779 272c 525f 6361 6d53 7464  int('y',R_camStd
-00010250: 3275 746d 2e64 6f74 2879 292e 726f 756e  2utm.dot(y).roun
-00010260: 6428 3529 290a 2020 2020 2020 2020 7072  d(5)).        pr
-00010270: 696e 7428 277a 272c 525f 6361 6d53 7464  int('z',R_camStd
-00010280: 3275 746d 2e64 6f74 287a 292e 726f 756e  2utm.dot(z).roun
-00010290: 6428 3529 290a 2020 2020 2020 2020 2222  d(5)).        ""
-000102a0: 220a 0a20 2020 2020 2020 2068 6561 6465  "..        heade
-000102b0: 7255 7064 6174 6520 3d20 7b0a 2020 2020  rUpdate = {.    
-000102c0: 2020 2020 2020 2020 6d69 7174 762e 636f          miqtv.co
-000102d0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-000102e0: 275d 5b27 7961 7727 5d3a 7961 772c 0a20  ']['yaw']:yaw,. 
-000102f0: 2020 2020 2020 2020 2020 206d 6971 7476             miqtv
-00010300: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00010310: 6971 7427 5d5b 2770 6974 6368 275d 3a70  iqt']['pitch']:p
-00010320: 6974 6368 2c0a 2020 2020 2020 2020 2020  itch,.          
-00010330: 2020 6d69 7174 762e 636f 6c5f 6865 6164    miqtv.col_head
-00010340: 6572 5b27 6d61 7269 7174 275d 5b27 726f  er['mariqt']['ro
-00010350: 6c6c 275d 3a72 6f6c 6c2c 0a20 2020 2020  ll']:roll,.     
-00010360: 2020 2020 2020 206d 6971 7476 2e63 6f6c         miqtv.col
-00010370: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00010380: 5d5b 2770 6f73 6527 5d3a 7b27 706f 7365  ]['pose']:{'pose
-00010390: 2d61 6273 6f6c 7574 652d 6f72 6965 6e74  -absolute-orient
-000103a0: 6174 696f 6e2d 7574 6d2d 6d61 7472 6978  ation-utm-matrix
-000103b0: 273a 525f 6361 6d53 7464 3275 746d 2e66  ':R_camStd2utm.f
-000103c0: 6c61 7474 656e 2829 2e74 6f6c 6973 7428  latten().tolist(
-000103d0: 297d 0a20 2020 2020 2020 207d 0a20 2020  )}.        }.   
-000103e0: 2020 2020 2073 656c 662e 7570 6461 7465       self.update
-000103f0: 6946 444f 4865 6164 6572 4669 656c 6473  iFDOHeaderFields
-00010400: 2868 6561 6465 7255 7064 6174 6529 0a0a  (headerUpdate)..
-00010410: 0a20 2020 2064 6566 2063 7265 6174 6549  .    def createI
-00010420: 6d61 6765 4174 7469 7475 6465 4669 6c65  mageAttitudeFile
-00010430: 2873 656c 662c 2061 7474 5f70 6174 683a  (self, att_path:
-00010440: 7374 722c 2066 7261 6d65 5f61 7474 5f68  str, frame_att_h
-00010450: 6561 6465 723a 6469 6374 2c20 6361 6d65  eader:dict, came
-00010460: 7261 3246 7261 6d65 5f79 6177 3a66 6c6f  ra2Frame_yaw:flo
-00010470: 6174 2c63 616d 6572 6132 4672 616d 655f  at,camera2Frame_
-00010480: 7069 7463 683a 666c 6f61 742c 6361 6d65  pitch:float,came
-00010490: 7261 3246 7261 6d65 5f72 6f6c 6c3a 666c  ra2Frame_roll:fl
-000104a0: 6f61 742c 0a20 2020 2020 6461 7465 5f66  oat,.     date_f
-000104b0: 6f72 6d61 743d 6d69 7174 762e 6461 7465  ormat=miqtv.date
-000104c0: 5f66 6f72 6d61 7473 5b27 7061 6e67 6165  _formats['pangae
-000104d0: 6127 5d2c 2063 6f6e 7374 5f76 616c 7565  a'], const_value
-000104e0: 7320 3d20 7b7d 2c20 6f76 6572 7772 6974  s = {}, overwrit
-000104f0: 653d 4661 6c73 652c 2063 6f6c 5f73 6570  e=False, col_sep
-00010500: 6172 6174 6f72 203d 2022 5c74 222c 6174  arator = "\t",at
-00010510: 745f 7061 7468 5f61 6e67 6c65 735f 696e  t_path_angles_in
-00010520: 5f72 6164 203d 2046 616c 7365 2c20 7669  _rad = False, vi
-00010530: 6465 6f53 616d 706c 6553 6563 6f6e 6473  deoSampleSeconds
-00010540: 3d31 2c72 6563 6f72 6473 3262 6549 6e76  =1,records2beInv
-00010550: 6572 7465 643d 5b5d 293a 0a20 2020 2020  erted=[]):.     
-00010560: 2020 2022 2222 2043 7265 6174 6573 2069     """ Creates i
-00010570: 6e20 2f69 6e74 6572 6d65 6469 6174 6520  n /intermediate 
-00010580: 6120 7465 7874 2066 696c 6520 7769 7468  a text file with
-00010590: 2063 616d 6572 6120 6174 7469 7475 6465   camera attitude
-000105a0: 2064 6174 6120 666f 7220 6561 6368 2069   data for each i
-000105b0: 6d61 6765 2e20 416c 6c20 616e 676c 6573  mage. All angles
-000105c0: 2061 7265 2065 7870 6563 7465 6420 696e   are expected in
-000105d0: 2064 6567 7265 6573 2e20 5573 6520 6174   degrees. Use at
-000105e0: 745f 7061 7468 5f61 6e67 6c65 735f 696e  t_path_angles_in
-000105f0: 5f72 6164 2069 6620 6e65 6365 7373 6172  _rad if necessar
-00010600: 792e 200a 2020 2020 2020 2020 6361 6d65  y. .        came
-00010610: 7261 3246 7261 6d65 2061 6e67 6c65 733a  ra2Frame angles:
-00010620: 2072 6f74 6174 696f 6e20 6f66 2063 616d   rotation of cam
-00010630: 6572 6120 636f 6f72 6469 6e61 7465 7320  era coordinates 
-00010640: 2878 2c79 2c7a 203d 2074 6f70 2c20 7269  (x,y,z = top, ri
-00010650: 6768 742c 206c 696e 6520 6f66 2073 6967  ght, line of sig
-00010660: 6874 2920 7769 7468 2072 6573 7065 6374  ht) with respect
-00010670: 2074 6f20 7665 6869 636c 6520 636f 6f72   to vehicle coor
-00010680: 6469 6e61 7465 7320 2878 2c79 2c7a 203d  dinates (x,y,z =
-00010690: 2066 6f72 7761 7264 2c72 6967 6874 2c64   forward,right,d
-000106a0: 6f77 6e29 200a 2020 2020 2020 2020 696e  own) .        in
-000106b0: 2061 6363 6f72 6461 6e63 6520 7769 7468   accordance with
-000106c0: 2074 6865 2079 6177 2c70 6974 6368 2c72   the yaw,pitch,r
-000106d0: 6f6c 6c20 726f 7461 7469 6f6e 206f 7264  oll rotation ord
-000106e0: 6572 2063 6f6e 7665 6e74 696f 6e3a 0a20  er convention:. 
-000106f0: 2020 2020 2020 2031 2e20 7961 7720 6172         1. yaw ar
-00010700: 6f75 6e64 207a 2c0a 2020 2020 2020 2020  ound z,.        
-00010710: 322e 2070 6974 6368 2061 726f 756e 6420  2. pitch around 
-00010720: 726f 7461 7465 6420 792c 0a20 2020 2020  rotated y,.     
-00010730: 2020 2033 2e20 726f 6c6c 2061 726f 756e     3. roll aroun
-00010740: 6420 726f 7461 7465 6420 780a 0a20 2020  d rotated x..   
-00010750: 2020 2020 2052 6f74 6174 696f 6e20 6469       Rotation di
-00010760: 7265 6374 696f 6e73 2061 6363 6f72 6469  rections accordi
-00010770: 6e67 2074 6f20 5c27 7269 6768 742d 6861  ng to \'right-ha
-00010780: 6e64 2072 756c 655c 272e 0a0a 2020 2020  nd rule\'...    
-00010790: 2020 2020 492e 652e 2063 616d 6572 6132      I.e. camera2
-000107a0: 4672 616d 6520 616e 676c 6573 203d 2030  Frame angles = 0
-000107b0: 2c30 2c30 2063 616d 6572 6120 6973 2066  ,0,0 camera is f
-000107c0: 6163 696e 6720 646f 776e 7761 7264 2077  acing downward w
-000107d0: 6974 6820 746f 7020 7369 6465 2074 6f77  ith top side tow
-000107e0: 6172 6473 2076 6568 6963 6c65 2773 2066  ards vehicle's f
-000107f0: 6f72 7761 7264 2064 6972 6563 7469 6f6e  orward direction
-00010800: 2720 2222 220a 0a20 2020 2020 2020 2069  ' """..        i
-00010810: 6e74 5f61 7474 7574 7564 655f 6669 6c65  nt_attutude_file
-00010820: 203d 2073 656c 662e 5f5f 6765 745f 696e   = self.__get_in
-00010830: 745f 6669 6c65 5f70 7265 6669 7828 2920  t_file_prefix() 
-00010840: 2b20 275f 696d 6167 652d 6174 7469 7475  + '_image-attitu
-00010850: 6465 2e74 7874 270a 2020 2020 2020 2020  de.txt'.        
-00010860: 6f75 7470 7574 5f68 6561 6465 725f 6174  output_header_at
-00010870: 7420 3d20 7b20 2020 6d69 7174 762e 636f  t = {   miqtv.co
-00010880: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00010890: 275d 5b27 696d 6727 5d3a 2020 6d69 7174  ']['img']:  miqt
-000108a0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-000108b0: 7269 7174 275d 5b27 696d 6727 5d2c 0a20  riqt']['img'],. 
-000108c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000108d0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000108e0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-000108f0: 276d 6172 6971 7427 5d5b 2775 7463 275d  'mariqt']['utc']
-00010900: 3a6d 6971 7476 2e63 6f6c 5f68 6561 6465  :miqtv.col_heade
-00010910: 725b 276d 6172 6971 7427 5d5b 2775 7463  r['mariqt']['utc
-00010920: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
-00010930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010940: 2020 2020 6d69 7174 762e 636f 6c5f 6865      miqtv.col_he
-00010950: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00010960: 7961 7727 5d3a 6d69 7174 762e 636f 6c5f  yaw']:miqtv.col_
-00010970: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-00010980: 5b27 7961 7727 5d2c 0a20 2020 2020 2020  ['yaw'],.       
-00010990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000109a0: 2020 2020 2020 2020 206d 6971 7476 2e63           miqtv.c
-000109b0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-000109c0: 7427 5d5b 2770 6974 6368 275d 3a6d 6971  t']['pitch']:miq
-000109d0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-000109e0: 6172 6971 7427 5d5b 2770 6974 6368 275d  ariqt']['pitch']
-000109f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00010a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010a10: 2020 6d69 7174 762e 636f 6c5f 6865 6164    miqtv.col_head
-00010a20: 6572 5b27 6d61 7269 7174 275d 5b27 726f  er['mariqt']['ro
-00010a30: 6c6c 275d 3a6d 6971 7476 2e63 6f6c 5f68  ll']:miqtv.col_h
-00010a40: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-00010a50: 2772 6f6c 6c27 5d2c 0a20 2020 2020 2020  'roll'],.       
-00010a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010a70: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
-00010a80: 696e 745f 706f 7365 5f66 696c 6520 3d20  int_pose_file = 
-00010a90: 7365 6c66 2e5f 5f67 6574 5f69 6e74 5f66  self.__get_int_f
-00010aa0: 696c 655f 7072 6566 6978 2829 202b 2027  ile_prefix() + '
-00010ab0: 5f69 6d61 6765 2d63 616d 6572 612d 706f  _image-camera-po
-00010ac0: 7365 2e74 7874 270a 2020 2020 2020 2020  se.txt'.        
-00010ad0: 6f75 7470 7574 5f68 6561 6465 725f 706f  output_header_po
-00010ae0: 7365 203d 207b 2020 6d69 7174 762e 636f  se = {  miqtv.co
-00010af0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00010b00: 275d 5b27 696d 6727 5d3a 6d69 7174 762e  ']['img']:miqtv.
-00010b10: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00010b20: 7174 275d 5b27 696d 6727 5d2c 0a20 2020  qt']['img'],.   
-00010b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b40: 2020 2020 2020 2020 2020 2020 206d 6971               miq
-00010b50: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00010b60: 6172 6971 7427 5d5b 2775 7463 275d 3a6d  ariqt']['utc']:m
-00010b70: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00010b80: 276d 6172 6971 7427 5d5b 2775 7463 275d  'mariqt']['utc']
-00010b90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00010ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010bb0: 2020 6d69 7174 762e 636f 6c5f 6865 6164    miqtv.col_head
-00010bc0: 6572 5b27 6d61 7269 7174 275d 5b27 706f  er['mariqt']['po
-00010bd0: 7365 275d 3a6d 6971 7476 2e63 6f6c 5f68  se']:miqtv.col_h
-00010be0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-00010bf0: 2770 6f73 6527 5d2c 0a20 2020 2020 2020  'pose'],.       
-00010c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010c10: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
-00010c20: 6966 206f 732e 7061 7468 2e65 7869 7374  if os.path.exist
-00010c30: 7328 696e 745f 6174 7475 7475 6465 5f66  s(int_attutude_f
-00010c40: 696c 6529 2061 6e64 206e 6f74 206f 7665  ile) and not ove
-00010c50: 7277 7269 7465 3a0a 2020 2020 2020 2020  rwrite:.        
-00010c60: 2020 2020 7365 6c66 2e61 6464 4974 656d      self.addItem
-00010c70: 496e 666f 5461 6246 696c 6528 696e 745f  InfoTabFile(int_
-00010c80: 6174 7475 7475 6465 5f66 696c 652c 225c  attutude_file,"\
-00010c90: 7422 2c6f 7574 7075 745f 6865 6164 6572  t",output_header
-00010ca0: 5f61 7474 290a 2020 2020 2020 2020 2020  _att).          
-00010cb0: 2020 7265 7475 726e 2054 7275 652c 2022    return True, "
-00010cc0: 4f75 7470 7574 2066 696c 6520 6578 6973  Output file exis
-00010cd0: 7473 3a20 222b 696e 745f 6174 7475 7475  ts: "+int_attutu
-00010ce0: 6465 5f66 696c 650a 0a20 2020 2020 2020  de_file..       
-00010cf0: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
-00010d00: 6578 6973 7473 2861 7474 5f70 6174 6829  exists(att_path)
-00010d10: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00010d20: 7475 726e 2046 616c 7365 2c20 224e 6176  turn False, "Nav
-00010d30: 6967 6174 696f 6e20 6669 6c65 206e 6f74  igation file not
-00010d40: 2066 6f75 6e64 3a20 222b 6174 745f 7061   found: "+att_pa
-00010d50: 7468 0a0a 2020 2020 2020 2020 6966 206e  th..        if n
-00010d60: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
-00010d70: 7328 7365 6c66 2e69 6d61 6765 7344 6972  s(self.imagesDir
-00010d80: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00010d90: 6574 7572 6e20 4661 6c73 652c 2022 496d  eturn False, "Im
-00010da0: 6167 6520 666f 6c64 6572 206e 6f74 2066  age folder not f
-00010db0: 6f75 6e64 3a20 222b 2073 656c 662e 696d  ound: "+ self.im
-00010dc0: 6167 6573 4469 720a 0a20 2020 2020 2020  agesDir..       
-00010dd0: 2073 203d 206d 6971 7463 2e50 7269 6e74   s = miqtc.Print
-00010de0: 4c6f 6164 696e 674d 7367 2822 4372 6561  LoadingMsg("Crea
-00010df0: 7469 6e67 2069 7465 6d73 2720 6174 7469  ting items' atti
-00010e00: 7475 6465 2064 6174 6122 290a 0a20 2020  tude data")..   
-00010e10: 2020 2020 2023 206c 6f61 6420 6672 616d       # load fram
-00010e20: 6520 6174 7469 7475 6465 2064 6174 6120  e attitude data 
-00010e30: 6672 6f6d 2066 696c 650a 2020 2020 2020  from file.      
-00010e40: 2020 6174 745f 6461 7461 2c20 7061 7273    att_data, pars
-00010e50: 654d 7367 203d 206d 6971 746e 2e72 6561  eMsg = miqtn.rea
-00010e60: 6441 6c6c 4174 7469 7475 6465 7346 726f  dAllAttitudesFro
-00010e70: 6d46 696c 6550 6174 6828 6174 745f 7061  mFilePath(att_pa
-00010e80: 7468 2c20 6672 616d 655f 6174 745f 6865  th, frame_att_he
-00010e90: 6164 6572 2c20 6461 7465 5f66 6f72 6d61  ader, date_forma
-00010ea0: 742c 636f 6c5f 7365 7061 7261 746f 723d  t,col_separator=
-00010eb0: 636f 6c5f 7365 7061 7261 746f 722c 636f  col_separator,co
-00010ec0: 6e73 745f 7661 6c75 6573 3d63 6f6e 7374  nst_values=const
-00010ed0: 5f76 616c 7565 732c 616e 676c 6573 496e  _values,anglesIn
-00010ee0: 5261 643d 6174 745f 7061 7468 5f61 6e67  Rad=att_path_ang
-00010ef0: 6c65 735f 696e 5f72 6164 290a 2020 2020  les_in_rad).    
-00010f00: 2020 2020 6966 2070 6172 7365 4d73 6720      if parseMsg 
-00010f10: 213d 2022 223a 0a20 2020 2020 2020 2020  != "":.         
-00010f20: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-00010f30: 2870 6172 7365 4d73 672c 646f 6e74 5368  (parseMsg,dontSh
-00010f40: 6f77 3d54 7275 6529 0a20 2020 2020 2020  ow=True).       
-00010f50: 2020 2020 2070 6172 7365 4d73 6720 3d20       parseMsg = 
-00010f60: 225c 6e22 202b 2070 6172 7365 4d73 670a  "\n" + parseMsg.
-00010f70: 0a20 2020 2020 2020 2023 2066 696e 6420  .        # find 
-00010f80: 666f 7220 6561 6368 2069 6d61 6765 2074  for each image t
-00010f90: 6865 2072 6573 7065 6374 6976 6520 6e61  he respective na
-00010fa0: 7669 6761 7469 6f6e 2064 6174 610a 2020  vigation data.  
-00010fb0: 2020 2020 2020 732e 7374 6f70 2829 0a20        s.stop(). 
-00010fc0: 2020 2020 2020 2073 7563 6365 7373 2c20         success, 
-00010fd0: 696d 6167 655f 6474 732c 206d 7367 203d  image_dts, msg =
-00010fe0: 2073 656c 662e 6669 6e64 4e61 7644 6174   self.findNavDat
-00010ff0: 6146 6f72 496d 6167 6528 6174 745f 6461  aForImage(att_da
-00011000: 7461 2c76 6964 656f 5361 6d70 6c65 5365  ta,videoSampleSe
-00011010: 636f 6e64 7329 0a20 2020 2020 2020 2069  conds).        i
-00011020: 6620 6e6f 7420 7375 6363 6573 733a 0a20  f not success:. 
-00011030: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00011040: 6e20 4661 6c73 652c 206d 7367 202b 2070  n False, msg + p
-00011050: 6172 7365 4d73 670a 2020 2020 2020 2020  arseMsg.        
-00011060: 7320 3d20 6d69 7174 632e 5072 696e 744c  s = miqtc.PrintL
-00011070: 6f61 6469 6e67 4d73 6728 2243 7265 6174  oadingMsg("Creat
-00011080: 696e 6720 6974 656d 7327 2061 7474 6974  ing items' attit
-00011090: 7564 6520 6461 7461 2229 0a0a 2020 2020  ude data")..    
-000110a0: 2020 2020 2320 6164 6420 6361 6d65 7261      # add camera
-000110b0: 3246 7261 6d65 2061 6e67 6c65 730a 2020  2Frame angles.  
-000110c0: 2020 2020 2020 525f 6361 6d32 6672 616d        R_cam2fram
-000110d0: 6520 3d20 6d69 7174 672e 525f 5961 7750  e = miqtg.R_YawP
-000110e0: 6974 6368 526f 6c6c 2863 616d 6572 6132  itchRoll(camera2
-000110f0: 4672 616d 655f 7961 772c 6361 6d65 7261  Frame_yaw,camera
-00011100: 3246 7261 6d65 5f70 6974 6368 2c63 616d  2Frame_pitch,cam
-00011110: 6572 6132 4672 616d 655f 726f 6c6c 290a  era2Frame_roll).
-00011120: 2020 2020 2020 2020 525f 6361 6d32 7574          R_cam2ut
-00011130: 6d5f 6c69 7374 203d 205b 5d0a 2020 2020  m_list = [].    
-00011140: 2020 2020 666f 7220 6669 6c65 2069 6e20      for file in 
-00011150: 696d 6167 655f 6474 733a 0a20 2020 2020  image_dts:.     
-00011160: 2020 2020 2020 2066 6f72 2074 696d 6570         for timep
-00011170: 6f69 6e74 2069 6e20 696d 6167 655f 6474  oint in image_dt
-00011180: 735b 6669 6c65 5d3a 0a20 2020 2020 2020  s[file]:.       
-00011190: 2020 2020 2020 2020 2061 7474 6974 7564           attitud
-000111a0: 6520 3d20 7469 6d65 706f 696e 740a 2020  e = timepoint.  
-000111b0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000111c0: 2061 7474 6974 7564 652e 7961 7720 6973   attitude.yaw is
-000111d0: 204e 6f6e 6520 6f72 2061 7474 6974 7564   None or attitud
-000111e0: 652e 7069 7463 6820 6973 204e 6f6e 6520  e.pitch is None 
-000111f0: 6f72 2061 7474 6974 7564 652e 726f 6c6c  or attitude.roll
-00011200: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00011210: 2020 2020 2020 2020 2020 2020 2020 525f                R_
-00011220: 6361 6d32 7574 6d5f 6c69 7374 2e61 7070  cam2utm_list.app
-00011230: 656e 6428 2222 290a 2020 2020 2020 2020  end("").        
-00011240: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00011250: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-00011260: 2020 2020 2052 5f66 7261 6d65 326e 6564       R_frame2ned
-00011270: 203d 206d 6971 7467 2e52 5f59 6177 5069   = miqtg.R_YawPi
-00011280: 7463 6852 6f6c 6c28 6174 7469 7475 6465  tchRoll(attitude
-00011290: 2e79 6177 2c61 7474 6974 7564 652e 7069  .yaw,attitude.pi
-000112a0: 7463 682c 6174 7469 7475 6465 2e72 6f6c  tch,attitude.rol
-000112b0: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
-000112c0: 2020 2052 5f63 616d 326e 6564 203d 2052     R_cam2ned = R
-000112d0: 5f66 7261 6d65 326e 6564 2e64 6f74 2852  _frame2ned.dot(R
-000112e0: 5f63 616d 3266 7261 6d65 290a 2020 2020  _cam2frame).    
-000112f0: 2020 2020 2020 2020 2020 2020 7961 772c              yaw,
-00011300: 7069 7463 682c 726f 6c6c 203d 206d 6971  pitch,roll = miq
-00011310: 7467 2e79 6177 5069 7463 6852 6f6c 6c28  tg.yawPitchRoll(
-00011320: 525f 6361 6d32 6e65 6429 0a20 2020 2020  R_cam2ned).     
-00011330: 2020 2020 2020 2020 2020 2061 7474 6974             attit
-00011340: 7564 652e 7961 7720 3d20 7961 770a 2020  ude.yaw = yaw.  
-00011350: 2020 2020 2020 2020 2020 2020 2020 6174                at
-00011360: 7469 7475 6465 2e70 6974 6368 203d 2070  titude.pitch = p
-00011370: 6974 6368 0a20 2020 2020 2020 2020 2020  itch.           
-00011380: 2020 2020 2061 7474 6974 7564 652e 726f       attitude.ro
-00011390: 6c6c 203d 2072 6f6c 6c0a 0a20 2020 2020  ll = roll..     
-000113a0: 2020 2020 2020 2020 2020 2052 5f63 616d             R_cam
-000113b0: 5374 6432 7574 6d20 3d20 7365 6c66 2e67  Std2utm = self.g
-000113c0: 6574 5f52 5f63 616d 5374 6432 7574 6d28  et_R_camStd2utm(
-000113d0: 525f 6361 6d32 6672 616d 652c 525f 6672  R_cam2frame,R_fr
-000113e0: 616d 6532 6e65 6429 0a20 2020 2020 2020  ame2ned).       
-000113f0: 2020 2020 2020 2020 2052 5f63 616d 3275           R_cam2u
-00011400: 746d 5f6c 6973 742e 6170 7065 6e64 2852  tm_list.append(R
-00011410: 5f63 616d 5374 6432 7574 6d2e 666c 6174  _camStd2utm.flat
-00011420: 7465 6e28 292e 746f 6c69 7374 2829 290a  ten().tolist()).
-00011430: 0a20 2020 2020 2020 2073 656c 662e 7072  .        self.pr
-00011440: 6f76 2e6c 6f67 2822 6170 706c 6965 6420  ov.log("applied 
-00011450: 6672 616d 6520 746f 2063 616d 6572 6120  frame to camera 
-00011460: 726f 7461 7469 6f6e 2079 6177 2c70 6974  rotation yaw,pit
-00011470: 6368 2c72 6f6c 6c20 3d20 2220 2b20 7374  ch,roll = " + st
-00011480: 7228 6361 6d65 7261 3246 7261 6d65 5f79  r(camera2Frame_y
-00011490: 6177 2920 2b20 222c 2220 2b20 7374 7228  aw) + "," + str(
-000114a0: 6361 6d65 7261 3246 7261 6d65 5f70 6974  camera2Frame_pit
-000114b0: 6368 2920 2b20 222c 2220 2b20 7374 7228  ch) + "," + str(
-000114c0: 6361 6d65 7261 3246 7261 6d65 5f72 6f6c  camera2Frame_rol
-000114d0: 6c29 2c64 6f6e 7453 686f 773d 5472 7565  l),dontShow=True
-000114e0: 290a 0a20 2020 2020 2020 2069 6620 6c65  )..        if le
-000114f0: 6e28 696d 6167 655f 6474 7329 203e 2030  n(image_dts) > 0
-00011500: 3a0a 0a20 2020 2020 2020 2020 2020 2023  :..            #
-00011510: 2057 7269 7465 2074 6f20 6e61 7669 6761   Write to naviga
-00011520: 7469 6f6e 2074 7874 2066 696c 650a 2020  tion txt file.  
-00011530: 2020 2020 2020 2020 2020 2320 6865 6164            # head
-00011540: 6572 0a20 2020 2020 2020 2020 2020 2072  er.            r
-00011550: 6573 203d 206f 7065 6e28 696e 745f 6174  es = open(int_at
-00011560: 7475 7475 6465 5f66 696c 652c 2022 7722  tutude_file, "w"
-00011570: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00011580: 732e 7772 6974 6528 6d69 7174 762e 636f  s.write(miqtv.co
-00011590: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-000115a0: 275d 5b27 696d 6727 5d2b 225c 7422 2b6d  ']['img']+"\t"+m
-000115b0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-000115c0: 276d 6172 6971 7427 5d5b 2775 7463 275d  'mariqt']['utc']
-000115d0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-000115e0: 732e 7772 6974 6528 225c 7422 2b6d 6971  s.write("\t"+miq
-000115f0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00011600: 6172 6971 7427 5d5b 2779 6177 275d 290a  ariqt']['yaw']).
-00011610: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-00011620: 7772 6974 6528 225c 7422 2b6d 6971 7476  write("\t"+miqtv
-00011630: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00011640: 6971 7427 5d5b 2770 6974 6368 275d 290a  iqt']['pitch']).
-00011650: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-00011660: 7772 6974 6528 225c 7422 2b6d 6971 7476  write("\t"+miqtv
-00011670: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00011680: 6971 7427 5d5b 2772 6f6c 6c27 5d29 0a0a  iqt']['roll'])..
-00011690: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-000116a0: 7772 6974 6528 225c 6e22 290a 2020 2020  write("\n").    
-000116b0: 2020 2020 2020 2020 2320 6461 7461 206c          # data l
-000116c0: 696e 6573 0a20 2020 2020 2020 2020 2020  ines.           
-000116d0: 2066 6f72 2066 696c 6520 696e 2069 6d61   for file in ima
-000116e0: 6765 5f64 7473 3a0a 2020 2020 2020 2020  ge_dts:.        
-000116f0: 2020 2020 2020 2020 666f 7220 7469 6d65          for time
-00011700: 706f 696e 7420 696e 2069 6d61 6765 5f64  point in image_d
-00011710: 7473 5b66 696c 655d 3a0a 2020 2020 2020  ts[file]:.      
-00011720: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00011730: 732e 7772 6974 6528 6669 6c65 2b22 5c74  s.write(file+"\t
-00011740: 222b 7469 6d65 706f 696e 742e 6461 7465  "+timepoint.date
-00011750: 5469 6d65 2829 2e73 7472 6674 696d 6528  Time().strftime(
-00011760: 6d69 7174 762e 6461 7465 5f66 6f72 6d61  miqtv.date_forma
-00011770: 7473 5b27 6d61 7269 7174 275d 2929 200a  ts['mariqt'])) .
-00011780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011790: 2020 2020 7661 6c20 3d20 7469 6d65 706f      val = timepo
-000117a0: 696e 742e 7961 770a 2020 2020 2020 2020  int.yaw.        
-000117b0: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-000117c0: 7961 7727 2069 6e20 7265 636f 7264 7332  yaw' in records2
-000117d0: 6265 496e 7665 7274 6564 3a0a 2020 2020  beInverted:.    
-000117e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000117f0: 2020 2020 7661 6c20 2a3d 202d 310a 2020      val *= -1.  
-00011800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011810: 2020 7265 732e 7772 6974 6528 225c 7422    res.write("\t"
-00011820: 2b73 7472 2876 616c 2929 0a20 2020 2020  +str(val)).     
-00011830: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00011840: 616c 203d 2074 696d 6570 6f69 6e74 2e70  al = timepoint.p
-00011850: 6974 6368 0a20 2020 2020 2020 2020 2020  itch.           
-00011860: 2020 2020 2020 2020 2069 6620 2770 6974           if 'pit
-00011870: 6368 2720 696e 2072 6563 6f72 6473 3262  ch' in records2b
-00011880: 6549 6e76 6572 7465 643a 0a20 2020 2020  eInverted:.     
-00011890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000118a0: 2020 2076 616c 202a 3d20 2d31 0a20 2020     val *= -1.   
-000118b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000118c0: 2072 6573 2e77 7269 7465 2822 5c74 222b   res.write("\t"+
-000118d0: 7374 7228 7661 6c29 290a 2020 2020 2020  str(val)).      
-000118e0: 2020 2020 2020 2020 2020 2020 2020 7661                va
-000118f0: 6c20 3d20 7469 6d65 706f 696e 742e 726f  l = timepoint.ro
-00011900: 6c6c 0a20 2020 2020 2020 2020 2020 2020  ll.             
-00011910: 2020 2020 2020 2069 6620 2772 6f6c 6c27         if 'roll'
-00011920: 2069 6e20 7265 636f 7264 7332 6265 496e   in records2beIn
-00011930: 7665 7274 6564 3a0a 2020 2020 2020 2020  verted:.        
-00011940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011950: 7661 6c20 2a3d 202d 310a 2020 2020 2020  val *= -1.      
-00011960: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00011970: 732e 7772 6974 6528 225c 7422 2b73 7472  s.write("\t"+str
-00011980: 2876 616c 2929 0a20 2020 2020 2020 2020  (val)).         
-00011990: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
-000119a0: 7269 7465 2822 5c6e 2229 0a20 2020 2020  rite("\n").     
-000119b0: 2020 2020 2020 2072 6573 2e63 6c6f 7365         res.close
-000119c0: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
-000119d0: 7365 6c66 2e70 726f 762e 6164 6441 7267  self.prov.addArg
-000119e0: 756d 656e 7428 2269 6e70 7574 4174 7469  ument("inputAtti
-000119f0: 7475 6465 4669 6c65 222c 6174 745f 7061  tudeFile",att_pa
-00011a00: 7468 2c6f 7665 7277 7269 7465 3d54 7275  th,overwrite=Tru
-00011a10: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
-00011a20: 656c 662e 7072 6f76 2e6c 6f67 2822 7061  elf.prov.log("pa
-00011a30: 7273 6564 2066 726f 6d20 696e 7075 7441  rsed from inputA
-00011a40: 7474 6974 7564 6546 696c 653a 2022 202b  ttitudeFile: " +
-00011a50: 2073 7472 2866 7261 6d65 5f61 7474 5f68   str(frame_att_h
-00011a60: 6561 6465 7229 2c64 6f6e 7453 686f 773d  eader),dontShow=
-00011a70: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-00011a80: 2020 7365 6c66 2e61 6464 4974 656d 496e    self.addItemIn
-00011a90: 666f 5461 6246 696c 6528 696e 745f 6174  foTabFile(int_at
-00011aa0: 7475 7475 6465 5f66 696c 652c 225c 7422  tutude_file,"\t"
-00011ab0: 2c6f 7574 7075 745f 6865 6164 6572 5f61  ,output_header_a
-00011ac0: 7474 290a 0a20 2020 2020 2020 2020 2020  tt)..           
-00011ad0: 2023 2057 7269 7465 2074 6f20 706f 7365   # Write to pose
-00011ae0: 2074 7874 2066 696c 650a 2020 2020 2020   txt file.      
-00011af0: 2020 2020 2020 2320 6865 6164 6572 0a20        # header. 
-00011b00: 2020 2020 2020 2020 2020 2072 6573 203d             res =
-00011b10: 206f 7065 6e28 696e 745f 706f 7365 5f66   open(int_pose_f
-00011b20: 696c 652c 2022 7722 290a 2020 2020 2020  ile, "w").      
-00011b30: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
-00011b40: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00011b50: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
-00011b60: 5d2b 225c 7422 2b6d 6971 7476 2e63 6f6c  ]+"\t"+miqtv.col
-00011b70: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00011b80: 5d5b 2775 7463 275d 290a 2020 2020 2020  ]['utc']).      
-00011b90: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
-00011ba0: 225c 7422 2b6d 6971 7476 2e63 6f6c 5f68  "\t"+miqtv.col_h
-00011bb0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-00011bc0: 2770 6f73 6527 5d29 0a20 2020 2020 2020  'pose']).       
-00011bd0: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
-00011be0: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
-00011bf0: 2023 2064 6174 6120 6c69 6e65 730a 2020   # data lines.  
-00011c00: 2020 2020 2020 2020 2020 6920 3d20 300a            i = 0.
-00011c10: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00011c20: 6669 6c65 2069 6e20 696d 6167 655f 6474  file in image_dt
-00011c30: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00011c40: 2020 2066 6f72 2074 696d 6570 6f69 6e74     for timepoint
-00011c50: 2069 6e20 696d 6167 655f 6474 735b 6669   in image_dts[fi
-00011c60: 6c65 5d3a 0a20 2020 2020 2020 2020 2020  le]:.           
-00011c70: 2020 2020 2020 2020 2069 6620 525f 6361           if R_ca
-00011c80: 6d32 7574 6d5f 6c69 7374 5b69 5d20 3d3d  m2utm_list[i] ==
-00011c90: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
-00011ca0: 2020 2020 2020 2020 2020 2020 2069 202b               i +
-00011cb0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00011cc0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00011cd0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-00011ce0: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
-00011cf0: 7465 2866 696c 652b 225c 7422 2b74 696d  te(file+"\t"+tim
-00011d00: 6570 6f69 6e74 2e64 6174 6554 696d 6528  epoint.dateTime(
-00011d10: 292e 7374 7266 7469 6d65 286d 6971 7476  ).strftime(miqtv
-00011d20: 2e64 6174 655f 666f 726d 6174 735b 276d  .date_formats['m
-00011d30: 6172 6971 7427 5d29 2920 0a20 2020 2020  ariqt'])) .     
-00011d40: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00011d50: 6e74 7279 203d 2073 7472 287b 2770 6f73  ntry = str({'pos
-00011d60: 652d 6162 736f 6c75 7465 2d6f 7269 656e  e-absolute-orien
-00011d70: 7461 7469 6f6e 2d75 746d 2d6d 6174 7269  tation-utm-matri
-00011d80: 7827 3a52 5f63 616d 3275 746d 5f6c 6973  x':R_cam2utm_lis
-00011d90: 745b 695d 7d29 2e72 6570 6c61 6365 2827  t[i]}).replace('
-00011da0: 5c6e 272c 2727 290a 2020 2020 2020 2020  \n','').        
-00011db0: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-00011dc0: 7772 6974 6528 225c 7422 2b65 6e74 7279  write("\t"+entry
-00011dd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00011de0: 2020 2020 2020 6920 2b3d 2031 0a20 2020        i += 1.   
-00011df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011e00: 2072 6573 2e77 7269 7465 2822 5c6e 2229   res.write("\n")
-00011e10: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00011e20: 2e63 6c6f 7365 2829 0a20 2020 2020 2020  .close().       
-00011e30: 2020 2020 2073 656c 662e 6164 6449 7465       self.addIte
-00011e40: 6d49 6e66 6f54 6162 4669 6c65 2869 6e74  mInfoTabFile(int
-00011e50: 5f70 6f73 655f 6669 6c65 2c22 5c74 222c  _pose_file,"\t",
-00011e60: 6f75 7470 7574 5f68 6561 6465 725f 706f  output_header_po
-00011e70: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
-00011e80: 732e 7374 6f70 2829 0a20 2020 2020 2020  s.stop().       
-00011e90: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-00011ea0: 2c20 2241 7474 6974 7564 6520 6461 7461  , "Attitude data
-00011eb0: 2063 7265 6174 6564 2220 2b20 7061 7273   created" + pars
-00011ec0: 654d 7367 0a20 2020 2020 2020 2065 6c73  eMsg.        els
-00011ed0: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-00011ee0: 2e73 746f 7028 290a 2020 2020 2020 2020  .stop().        
-00011ef0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00011f00: 2c20 224e 6f20 696d 6167 6520 6174 7469  , "No image atti
-00011f10: 7475 6465 7320 666f 756e 6422 202b 2070  tudes found" + p
-00011f20: 6172 7365 4d73 670a 2020 2020 2020 2020  arseMsg.        
-00011f30: 0a0a 2020 2020 6465 6620 6765 745f 525f  ..    def get_R_
-00011f40: 6361 6d53 7464 3275 746d 2873 656c 662c  camStd2utm(self,
-00011f50: 525f 6361 6d32 6672 616d 653a 6e70 2e61  R_cam2frame:np.a
-00011f60: 7272 6179 2c52 5f66 7261 6d65 326e 6564  rray,R_frame2ned
-00011f70: 3a6e 702e 6172 7261 7929 3a0a 2020 2020  :np.array):.    
-00011f80: 2020 2020 2222 2220 7265 7472 756e 2072      """ retrun r
-00011f90: 6f74 6174 696f 6e20 6d61 7472 6978 2052  otation matrix R
-00011fa0: 2074 7261 6e66 6f72 6d69 6e67 2066 726f   tranforming fro
-00011fb0: 6d20 6361 6d53 7464 3a20 2878 2c79 2c7a  m camStd: (x,y,z
-00011fc0: 203d 2072 6967 6874 2c62 7574 746f 6d2c   = right,buttom,
-00011fd0: 6c69 6e65 206f 6620 7369 6768 7429 2074  line of sight) t
-00011fe0: 6f20 7574 6d20 2878 2c79 2c7a 203d 2065  o utm (x,y,z = e
-00011ff0: 6173 7469 6e67 2c6e 6f72 7468 696e 672c  asting,northing,
-00012000: 7570 2920 2222 220a 2020 2020 2020 2020  up) """.        
-00012010: 525f 6361 6d69 4644 4f32 6361 6d53 7464  R_camiFDO2camStd
-00012020: 203d 206d 6971 7467 2e52 5f59 6177 5069   = miqtg.R_YawPi
-00012030: 7463 6852 6f6c 6c28 3930 2c30 2c30 2920  tchRoll(90,0,0) 
-00012040: 2320 696e 2069 4644 4f20 6361 6d3a 2028  # in iFDO cam: (
-00012050: 782c 792c 7a20 3d20 746f 702c 7269 6768  x,y,z = top,righ
-00012060: 742c 6c69 6e65 206f 6620 7369 6768 7429  t,line of sight)
-00012070: 2062 7574 2066 6f72 2070 6f73 6520 7468   but for pose th
-00012080: 6520 2773 7461 6e64 6172 6427 2063 616d  e 'standard' cam
-00012090: 5374 643a 2028 782c 792c 7a20 3d20 7269  Std: (x,y,z = ri
-000120a0: 6768 742c 6275 7474 6f6d 2c6c 696e 6520  ght,buttom,line 
-000120b0: 6f66 2073 6967 6874 2920 6973 2065 7870  of sight) is exp
-000120c0: 6563 7465 640a 2020 2020 2020 2020 525f  ected.        R_
-000120d0: 6361 6d53 7464 3266 7261 6d65 203d 2052  camStd2frame = R
-000120e0: 5f63 616d 3266 7261 6d65 2e64 6f74 2852  _cam2frame.dot(R
-000120f0: 5f63 616d 6946 444f 3263 616d 5374 6429  _camiFDO2camStd)
-00012100: 0a20 2020 2020 2020 2052 5f63 616d 5374  .        R_camSt
-00012110: 6432 6e65 6420 3d20 525f 6672 616d 6532  d2ned = R_frame2
-00012120: 6e65 642e 646f 7428 525f 6361 6d53 7464  ned.dot(R_camStd
-00012130: 3266 7261 6d65 290a 2020 2020 2020 2020  2frame).        
-00012140: 525f 6e65 6432 7574 6d20 3d20 6d69 7174  R_ned2utm = miqt
-00012150: 672e 525f 5859 5a28 3138 302c 302c 3930  g.R_XYZ(180,0,90
-00012160: 2920 2320 7769 7468 2075 746d 2078 2c79  ) # with utm x,y
-00012170: 2c7a 203d 2065 6173 7469 6e67 2c6e 6f72  ,z = easting,nor
-00012180: 7468 696e 672c 7570 0a20 2020 2020 2020  thing,up.       
-00012190: 2052 5f63 616d 5374 6432 7574 6d20 3d20   R_camStd2utm = 
-000121a0: 525f 6e65 6432 7574 6d2e 646f 7428 525f  R_ned2utm.dot(R_
-000121b0: 6361 6d53 7464 326e 6564 292e 726f 756e  camStd2ned).roun
-000121c0: 6428 3529 0a20 2020 2020 2020 2072 6574  d(5).        ret
-000121d0: 7572 6e20 525f 6361 6d53 7464 3275 746d  urn R_camStd2utm
-000121e0: 0a0a 0a20 2020 2064 6566 2066 696e 644e  ...    def findN
-000121f0: 6176 4461 7461 466f 7249 6d61 6765 2873  avDataForImage(s
-00012200: 656c 662c 6461 7461 3a6d 6971 7467 2e4e  elf,data:miqtg.N
-00012210: 756d 4461 7461 5469 6d65 5374 616d 7065  umDataTimeStampe
-00012220: 642c 7669 6465 6f53 616d 706c 6553 6563  d,videoSampleSec
-00012230: 6f6e 6473 3d31 293a 0a20 2020 2020 2020  onds=1):.       
-00012240: 2022 2222 2063 7265 6174 6573 2061 2064   """ creates a d
-00012250: 6963 7420 2869 6d61 6765 5f64 7473 2920  ict (image_dts) 
-00012260: 7769 7468 2066 696c 6520 6e61 6d65 2061  with file name a
-00012270: 7320 6b65 7920 616e 6420 6120 6c69 7374  s key and a list
-00012280: 206f 6620 6461 7461 2065 6c65 6d65 6e74   of data element
-00012290: 7320 6173 2076 616c 7565 2e20 0a20 2020  s as value. .   
-000122a0: 2020 2020 2020 2020 2049 6e20 6361 7365           In case
-000122b0: 206f 6620 7068 6f74 6f73 2074 6865 206c   of photos the l
-000122c0: 6973 7420 6861 7320 6f6e 6c79 2061 2073  ist has only a s
-000122d0: 696e 676c 6520 656e 7472 792c 2066 6f72  ingle entry, for
-000122e0: 2076 6964 656f 7320 6974 2068 6173 2076   videos it has v
-000122f0: 6964 656f 2064 7572 6174 696f 6e20 5b73  ideo duration [s
-00012300: 6563 5d20 2f20 7669 6465 6f53 616d 706c  ec] / videoSampl
-00012310: 6553 6563 6f6e 6473 2065 6e74 7269 6573  eSeconds entries
-00012320: 2e0a 2020 2020 2020 2020 2020 2020 5265  ..            Re
-00012330: 7475 726e 7320 7375 6363 6573 732c 2069  turns success, i
-00012340: 6d61 6765 5f64 7473 2c20 6d73 6720 2222  mage_dts, msg ""
-00012350: 220a 0a20 2020 2020 2020 2069 6620 7669  "..        if vi
-00012360: 6465 6f53 616d 706c 6553 6563 6f6e 6473  deoSampleSeconds
-00012370: 203c 3d20 303a 0a20 2020 2020 2020 2020   <= 0:.         
-00012380: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
-00012390: 6f6e 2822 6669 6e64 4e61 7644 6174 6146  on("findNavDataF
-000123a0: 6f72 496d 6167 653a 2076 6964 656f 5361  orImage: videoSa
-000123b0: 6d70 6c65 5365 636f 6e64 7320 6d75 7374  mpleSeconds must
-000123c0: 2062 6520 6772 6561 7465 7220 3022 290a   be greater 0").
-000123d0: 0a20 2020 2020 2020 2023 2063 7265 6174  .        # creat
-000123e0: 6520 736f 7274 6564 2074 696d 6520 706f  e sorted time po
-000123f0: 696e 7473 0a20 2020 2020 2020 2074 696d  ints.        tim
-00012400: 655f 706f 696e 7473 203d 206c 6973 7428  e_points = list(
-00012410: 6461 7461 2e6b 6579 7328 2929 0a20 2020  data.keys()).   
-00012420: 2020 2020 2074 696d 655f 706f 696e 7473       time_points
-00012430: 2e73 6f72 7428 290a 2020 2020 2020 2020  .sort().        
-00012440: 756e 6d61 7463 6865 6454 696d 6550 6f69  unmatchedTimePoi
-00012450: 6e74 7320 3d20 5b5d 0a20 2020 2020 2020  nts = [].       
-00012460: 2069 6d61 6765 5f64 7473 203d 207b 7d0a   image_dts = {}.
-00012470: 2020 2020 2020 2020 7374 6172 7453 6561          startSea
-00012480: 7263 6849 6e64 6578 203d 2030 0a20 2020  rchIndex = 0.   
-00012490: 2020 2020 2069 6d61 6765 7349 6e52 6177       imagesInRaw
-000124a0: 203d 2020 7365 6c66 2e69 6d61 6765 7349   =  self.imagesI
-000124b0: 6e49 6d61 6765 7344 6972 2829 0a20 2020  nImagesDir().   
-000124c0: 2020 2020 2069 6d61 6765 7349 6e52 6177       imagesInRaw
-000124d0: 536f 7274 6564 4c69 7374 203d 2073 656c  SortedList = sel
-000124e0: 662e 696d 6167 6573 496e 496d 6167 6573  f.imagesInImages
-000124f0: 4469 7253 6f72 7465 644c 6973 7428 290a  DirSortedList().
-00012500: 2020 2020 2020 2020 7072 6f67 203d 206d          prog = m
-00012510: 6971 7463 2e50 7269 6e74 4b6e 6f77 6e50  iqtc.PrintKnownP
-00012520: 726f 6772 6573 734d 7367 2822 496e 7465  rogressMsg("Inte
-00012530: 7270 6f6c 6174 696e 6720 6e61 7669 6761  rpolating naviga
-00012540: 7469 6f6e 2066 6f72 2069 6d61 6765 222c  tion for image",
-00012550: 206c 656e 2869 6d61 6765 7349 6e52 6177   len(imagesInRaw
-00012560: 292c 6d6f 6475 6c6f 3d31 290a 2020 2020  ),modulo=1).    
-00012570: 2020 2020 666f 7220 6669 6c65 2069 6e20      for file in 
-00012580: 696d 6167 6573 496e 5261 7753 6f72 7465  imagesInRawSorte
-00012590: 644c 6973 743a 0a20 2020 2020 2020 2020  dList:.         
-000125a0: 2020 2070 726f 672e 7072 6f67 7265 7373     prog.progress
-000125b0: 2829 0a20 2020 2020 2020 2020 2020 2066  ().            f
-000125c0: 696c 655f 6e61 6d65 203d 206f 732e 7061  ile_name = os.pa
-000125d0: 7468 2e62 6173 656e 616d 6528 6669 6c65  th.basename(file
-000125e0: 290a 0a20 2020 2020 2020 2020 2020 2064  )..            d
-000125f0: 745f 696d 6167 6520 3d20 6d69 7174 632e  t_image = miqtc.
-00012600: 7061 7273 6546 696c 6544 6174 6554 696d  parseFileDateTim
-00012610: 6541 7355 5443 2866 696c 655f 6e61 6d65  eAsUTC(file_name
-00012620: 290a 2020 2020 2020 2020 2020 2020 6474  ).            dt
-00012630: 5f69 6d61 6765 5f74 7320 3d20 696e 7428  _image_ts = int(
-00012640: 6474 5f69 6d61 6765 2e74 696d 6573 7461  dt_image.timesta
-00012650: 6d70 2829 202a 2031 3030 3029 0a0a 2020  mp() * 1000)..  
-00012660: 2020 2020 2020 2020 2020 7275 6e54 696d            runTim
-00012670: 6520 3d20 696d 6167 6573 496e 5261 775b  e = imagesInRaw[
-00012680: 6669 6c65 5d5b 315d 2023 202d 3120 666f  file][1] # -1 fo
-00012690: 7220 7068 6f74 6f73 0a20 2020 2020 2020  r photos.       
-000126a0: 2020 2020 2023 2076 6964 656f 0a20 2020       # video.   
-000126b0: 2020 2020 2020 2020 2069 6620 696d 6167           if imag
-000126c0: 6573 496e 5261 775b 6669 6c65 5d5b 325d  esInRaw[file][2]
-000126d0: 2069 6e20 6d69 7174 762e 7669 6465 6f5f   in miqtv.video_
-000126e0: 7479 7065 7320 616e 6420 7275 6e54 696d  types and runTim
-000126f0: 6520 3c3d 2030 3a20 2320 6578 740a 2020  e <= 0: # ext.  
-00012700: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00012710: 696e 7428 2243 6175 7469 6f6e 2120 436f  int("Caution! Co
-00012720: 756c 6420 6e6f 7420 7265 6164 2076 6964  uld not read vid
-00012730: 656f 2072 756e 2074 696d 6520 6672 6f6d  eo run time from
-00012740: 2066 696c 6522 2c66 696c 6529 2023 2054   file",file) # T
-00012750: 4f44 4f20 646f 6573 2074 6869 7320 6861  ODO does this ha
-00012760: 7070 656e 3f20 4861 6e64 6c65 2062 6574  ppen? Handle bet
-00012770: 7465 723f 0a0a 2020 2020 2020 2020 2020  ter?..          
-00012780: 2020 7361 6d70 6c65 5469 6d65 5365 6373    sampleTimeSecs
-00012790: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-000127a0: 2070 6f73 5f6c 6973 7420 3d20 5b5d 0a20   pos_list = []. 
-000127b0: 2020 2020 2020 2020 2020 2067 6f20 3d20             go = 
-000127c0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-000127d0: 2077 6869 6c65 2067 6f3a 0a20 2020 2020   while go:.     
-000127e0: 2020 2020 2020 2020 2020 2074 7279 3a20             try: 
-000127f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012800: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-00012810: 2020 2020 2020 2020 706f 732c 2073 7461          pos, sta
-00012820: 7274 5365 6172 6368 496e 6465 7820 3d20  rtSearchIndex = 
-00012830: 6461 7461 2e69 6e74 6572 706f 6c61 7465  data.interpolate
-00012840: 4174 5469 6d65 2864 745f 696d 6167 655f  AtTime(dt_image_
-00012850: 7473 202b 2073 616d 706c 6554 696d 6553  ts + sampleTimeS
-00012860: 6563 7320 2a20 3130 3030 2c74 696d 655f  ecs * 1000,time_
-00012870: 706f 696e 7473 2c73 7461 7274 5365 6172  points,startSear
-00012880: 6368 496e 6465 7829 0a20 2020 2020 2020  chIndex).       
-00012890: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-000128a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000128b0: 2020 2320 696e 7465 7270 6f6c 6174 6541    # interpolateA
-000128c0: 7454 696d 6520 7265 7475 726e 7320 4e6f  tTime returns No
-000128d0: 6e65 2076 616c 7565 7320 6966 2074 696d  ne values if tim
-000128e0: 6520 6f75 7420 6f66 2072 616e 6765 0a20  e out of range. 
-000128f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012900: 2020 2069 6620 706f 732e 636f 7461 696e     if pos.cotain
-00012910: 734e 6f6e 6556 616c 7565 7349 6e52 6571  sNoneValuesInReq
-00012920: 7569 7265 6446 6965 6c64 7328 293a 0a20  uiredFields():. 
-00012930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012940: 2020 2020 2020 2075 6e6d 6174 6368 6564         unmatched
-00012950: 5469 6d65 506f 696e 7473 2e61 7070 656e  TimePoints.appen
-00012960: 6428 2864 745f 696d 6167 655f 7473 202b  d((dt_image_ts +
-00012970: 2073 616d 706c 6554 696d 6553 6563 7320   sampleTimeSecs 
-00012980: 2a20 3130 3030 292f 3130 3030 290a 2020  * 1000)/1000).  
-00012990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000129a0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000129b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000129c0: 706f 735f 6c69 7374 2e61 7070 656e 6428  pos_list.append(
-000129d0: 706f 7329 0a20 2020 2020 2020 2020 2020  pos).           
-000129e0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-000129f0: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
-00012a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012a10: 7265 7475 726e 2046 616c 7365 2c20 696d  return False, im
-00012a20: 6167 655f 6474 732c 2022 436f 756c 6420  age_dts, "Could 
-00012a30: 6e6f 7420 6669 6e64 2069 6d61 6765 2074  not find image t
-00012a40: 696d 6520 222b 2064 6174 6574 696d 652e  ime "+ datetime.
-00012a50: 6461 7465 7469 6d65 2e75 7463 6672 6f6d  datetime.utcfrom
-00012a60: 7469 6d65 7374 616d 7028 2864 745f 696d  timestamp((dt_im
-00012a70: 6167 655f 7473 202b 2073 616d 706c 6554  age_ts + sampleT
-00012a80: 696d 6553 6563 7320 2a20 3130 3030 292f  imeSecs * 1000)/
-00012a90: 3130 3030 292e 7374 7266 7469 6d65 286d  1000).strftime(m
-00012aa0: 6971 7476 2e64 6174 655f 666f 726d 6174  iqtv.date_format
-00012ab0: 735b 276d 6172 6971 7427 5d29 202b 2220  s['mariqt']) +" 
-00012ac0: 696e 2022 2b73 7472 2864 6174 612e 6c65  in "+str(data.le
-00012ad0: 6e28 2929 2b22 2064 6174 6120 706f 7369  n())+" data posi
-00012ae0: 7469 6f6e 7322 202b 2073 7472 2865 2e61  tions" + str(e.a
-00012af0: 7267 7329 0a20 2020 2020 2020 2020 2020  rgs).           
-00012b00: 2020 2020 2073 616d 706c 6554 696d 6553       sampleTimeS
-00012b10: 6563 7320 2b3d 2076 6964 656f 5361 6d70  ecs += videoSamp
-00012b20: 6c65 5365 636f 6e64 730a 2020 2020 2020  leSeconds.      
-00012b30: 2020 2020 2020 2020 2020 6966 2073 616d            if sam
-00012b40: 706c 6554 696d 6553 6563 7320 3e20 7275  pleTimeSecs > ru
-00012b50: 6e54 696d 653a 0a20 2020 2020 2020 2020  nTime:.         
-00012b60: 2020 2020 2020 2020 2020 2067 6f20 3d20             go = 
-00012b70: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-00012b80: 2020 0a20 2020 2020 2020 2020 2020 2069    .            i
-00012b90: 6d61 6765 5f64 7473 5b66 696c 655f 6e61  mage_dts[file_na
-00012ba0: 6d65 5d20 3d20 706f 735f 6c69 7374 0a20  me] = pos_list. 
-00012bb0: 2020 2020 2020 2070 726f 672e 636c 6561         prog.clea
-00012bc0: 7228 290a 2020 2020 2020 2020 7265 7475  r().        retu
-00012bd0: 726e 4d73 6720 3d20 2222 0a20 2020 2020  rnMsg = "".     
-00012be0: 2020 2069 6620 6c65 6e28 756e 6d61 7463     if len(unmatc
-00012bf0: 6865 6454 696d 6550 6f69 6e74 7329 2021  hedTimePoints) !
-00012c00: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-00012c10: 2075 6e6d 6174 6368 6564 5469 6d65 506f   unmatchedTimePo
-00012c20: 696e 7473 2e73 6f72 7428 290a 2020 2020  ints.sort().    
-00012c30: 2020 2020 2020 2020 756e 6d61 7463 6865          unmatche
-00012c40: 6454 696d 6550 6f69 6e74 7320 3d20 5b64  dTimePoints = [d
-00012c50: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
-00012c60: 2e75 7463 6672 6f6d 7469 6d65 7374 616d  .utcfromtimestam
-00012c70: 7028 7473 292e 7374 7266 7469 6d65 286d  p(ts).strftime(m
-00012c80: 6971 7476 2e64 6174 655f 666f 726d 6174  iqtv.date_format
-00012c90: 735b 276d 6172 6971 7427 5d29 2066 6f72  s['mariqt']) for
-00012ca0: 2074 7320 696e 2075 6e6d 6174 6368 6564   ts in unmatched
-00012cb0: 5469 6d65 506f 696e 7473 5d0a 2020 2020  TimePoints].    
-00012cc0: 2020 2020 2020 2020 7265 7475 726e 4d73          returnMs
-00012cd0: 6720 3d20 2243 4155 5449 4f4e 2120 4e61  g = "CAUTION! Na
-00012ce0: 7669 6761 7469 6f6e 206e 6f74 2066 6f75  vigation not fou
-00012cf0: 6e64 2066 6f72 2074 6865 2066 6f6c 6c6f  nd for the follo
-00012d00: 7769 6e67 2069 6d61 6765 2074 696d 6520  wing image time 
-00012d10: 706f 696e 7473 2e20 446f 7562 6c65 2063  points. Double c
-00012d20: 6865 636b 206f 7220 7072 6f76 6964 6520  heck or provide 
-00012d30: 6174 206c 6561 7374 2073 7461 7469 6320  at least static 
-00012d40: 6465 6661 756c 7420 6e61 7669 6761 7469  default navigati
-00012d50: 6f6e 2069 6e20 6865 6164 6572 2066 6965  on in header fie
-00012d60: 6c64 732e 220a 2020 2020 2020 2020 2020  lds.".          
-00012d70: 2020 7265 7475 726e 4d73 6720 2b3d 2022    returnMsg += "
-00012d80: 5c6e 2220 2b20 225c 6e22 2e6a 6f69 6e28  \n" + "\n".join(
-00012d90: 756e 6d61 7463 6865 6454 696d 6550 6f69  unmatchedTimePoi
-00012da0: 6e74 7329 0a20 2020 2020 2020 2072 6574  nts).        ret
-00012db0: 7572 6e20 5472 7565 2c20 696d 6167 655f  urn True, image_
-00012dc0: 6474 732c 2072 6574 7572 6e4d 7367 0a0a  dts, returnMsg..
-00012dd0: 0a20 2020 2064 6566 2063 7265 6174 6549  .    def createI
-00012de0: 6d61 6765 4e61 7669 6761 7469 6f6e 4669  mageNavigationFi
-00012df0: 6c65 2873 656c 662c 206e 6176 5f70 6174  le(self, nav_pat
-00012e00: 683a 2073 7472 2c20 6e61 765f 6865 6164  h: str, nav_head
-00012e10: 6572 3d6d 6971 7476 2e70 6f73 5f68 6561  er=miqtv.pos_hea
-00012e20: 6465 725b 2770 616e 6761 6561 275d 2c20  der['pangaea'], 
-00012e30: 6461 7465 5f66 6f72 6d61 743d 6d69 7174  date_format=miqt
-00012e40: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
-00012e50: 7061 6e67 6165 6127 5d2c 206f 7665 7277  pangaea'], overw
-00012e60: 7269 7465 3d46 616c 7365 2c20 636f 6c5f  rite=False, col_
-00012e70: 7365 7061 7261 746f 7220 3d20 225c 7422  separator = "\t"
-00012e80: 2c20 7669 6465 6f53 616d 706c 6553 6563  , videoSampleSec
-00012e90: 6f6e 6473 3d31 2c0a 2020 2020 2020 2020  onds=1,.        
-00012ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012eb0: 2020 2020 2020 2020 2020 2020 6f66 6673              offs
-00012ec0: 6574 5f78 3d30 2c20 6f66 6673 6574 5f79  et_x=0, offset_y
-00012ed0: 3d30 2c20 6f66 6673 6574 5f7a 3d30 2c61  =0, offset_z=0,a
-00012ee0: 6e67 6c65 735f 696e 5f72 6164 203d 2046  ngles_in_rad = F
-00012ef0: 616c 7365 2c20 7265 636f 7264 7332 6265  alse, records2be
-00012f00: 496e 7665 7274 6564 3d5b 5d29 3a0a 2020  Inverted=[]):.  
-00012f10: 2020 2020 2020 2222 2220 4372 6561 7465        """ Create
-00012f20: 7320 696e 202f 696e 7465 726d 6564 6961  s in /intermedia
-00012f30: 7465 2061 2074 6578 7420 6669 6c65 2077  te a text file w
-00012f40: 6974 6820 342e 3544 206e 6176 6967 6174  ith 4.5D navigat
-00012f50: 696f 6e20 6461 7461 2066 6f72 2065 6163  ion data for eac
-00012f60: 6820 696d 6167 652c 2069 2e65 2e20 6120  h image, i.e. a 
-00012f70: 7369 6e67 6c65 2072 6f77 2070 6572 2070  single row per p
-00012f80: 686f 746f 2c20 7669 6465 6f20 6475 7261  hoto, video dura
-00012f90: 7469 6f6e 205b 7365 635d 202f 2076 6964  tion [sec] / vid
-00012fa0: 656f 5361 6d70 6c65 5365 636f 6e64 7320  eoSampleSeconds 
-00012fb0: 726f 7773 2070 6572 2076 6964 656f 2e0a  rows per video..
-00012fc0: 2020 2020 2020 2020 2020 2020 6e61 765f              nav_
-00012fd0: 6865 6164 6572 206d 7573 7420 6265 2064  header must be d
-00012fe0: 6963 7420 636f 6e74 6169 6e69 6e67 2074  ict containing t
-00012ff0: 6865 206b 6579 7320 2775 7463 272c 276c  he keys 'utc','l
-00013000: 6174 272c 276c 6f6e 272c 2764 6570 2728  at','lon','dep'(
-00013010: 6f72 2027 616c 7427 292c 206f 7074 696f  or 'alt'), optio
-00013020: 6e61 6c3a 2027 6867 7427 2c27 756e 6365  nal: 'hgt','unce
-00013030: 7274 2720 7769 7468 2074 6865 2072 6573  rt' with the res
-00013040: 7065 6374 6976 6520 636f 6c75 6d6e 2068  pective column h
-00013050: 6561 6465 7273 2061 7320 7661 6c75 6573  eaders as values
-00013060: 200a 2020 2020 2020 2020 2020 2020 6966   .            if
-00013070: 206f 6e65 206f 6620 7468 6520 7665 6869   one of the vehi
-00013080: 636c 6520 782c 792c 7a20 6f66 6673 6574  cle x,y,z offset
-00013090: 7320 5b6d 5d20 6973 206e 6f74 2030 2061  s [m] is not 0 a
-000130a0: 6e64 206e 6176 5f68 6561 6465 7220 616c  nd nav_header al
-000130b0: 736f 2063 6f6e 7461 696e 7320 2779 6177  so contains 'yaw
-000130c0: 272c 2770 6974 6368 272c 2772 6f6c 6c27  ','pitch','roll'
-000130d0: 206c 6576 6572 6172 6d20 6f66 6673 6574   leverarm offset
-000130e0: 7320 6172 6520 636f 6d70 656e 7361 7465  s are compensate
-000130f0: 6420 666f 7220 2222 220a 0a20 2020 2020  d for """..     
-00013100: 2020 2069 6620 7365 6c66 2e69 6e74 6572     if self.inter
-00013110: 6d65 6469 6174 654e 6176 4669 6c65 4578  mediateNavFileEx
-00013120: 6973 7473 2829 2061 6e64 206e 6f74 206f  ists() and not o
-00013130: 7665 7277 7269 7465 3a0a 2020 2020 2020  verwrite:.      
-00013140: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-00013150: 652c 2022 4f75 7470 7574 2066 696c 6520  e, "Output file 
-00013160: 6578 6973 7473 3a20 222b 7365 6c66 2e67  exists: "+self.g
-00013170: 6574 5f69 6e74 5f6e 6176 5f66 696c 6528  et_int_nav_file(
-00013180: 290a 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
-00013190: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
-000131a0: 286e 6176 5f70 6174 6829 3a0a 2020 2020  (nav_path):.    
-000131b0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-000131c0: 616c 7365 2c20 224e 6176 6967 6174 696f  alse, "Navigatio
-000131d0: 6e20 6669 6c65 206e 6f74 2066 6f75 6e64  n file not found
-000131e0: 3a20 222b 6e61 765f 7061 7468 0a0a 2020  : "+nav_path..  
-000131f0: 2020 2020 2020 6966 206e 6f74 206f 732e        if not os.
-00013200: 7061 7468 2e65 7869 7374 7328 7365 6c66  path.exists(self
-00013210: 2e69 6d61 6765 7344 6972 293a 0a20 2020  .imagesDir):.   
-00013220: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00013230: 4661 6c73 652c 2022 496d 6167 6520 666f  False, "Image fo
-00013240: 6c64 6572 206e 6f74 2066 6f75 6e64 3a20  lder not found: 
-00013250: 222b 2073 656c 662e 696d 6167 6573 4469  "+ self.imagesDi
-00013260: 720a 0a20 2020 2020 2020 2073 203d 206d  r..        s = m
-00013270: 6971 7463 2e50 7269 6e74 4c6f 6164 696e  iqtc.PrintLoadin
-00013280: 674d 7367 2822 4372 6561 7469 6e67 2069  gMsg("Creating i
-00013290: 7465 6d73 2720 6e61 7669 6761 7469 6f6e  tems' navigation
-000132a0: 2064 6174 6122 290a 2020 2020 2020 2020   data").        
-000132b0: 7265 7475 726e 4d73 6720 3d20 2222 0a20  returnMsg = "". 
-000132c0: 2020 2020 2020 2063 6f6d 7065 6e73 6174         compensat
-000132d0: 4f66 6673 6574 7320 3d20 4661 6c73 650a  Offsets = False.
-000132e0: 2020 2020 2020 2020 6966 2028 6f66 6673          if (offs
-000132f0: 6574 5f78 213d 3020 6f72 206f 6666 7365  et_x!=0 or offse
-00013300: 745f 7921 3d30 206f 7220 6f66 6673 6574  t_y!=0 or offset
-00013310: 5f7a 213d 3029 2061 6e64 2027 7961 7727  _z!=0) and 'yaw'
-00013320: 2069 6e20 6e61 765f 6865 6164 6572 2061   in nav_header a
-00013330: 6e64 2027 7069 7463 6827 2069 6e20 6e61  nd 'pitch' in na
-00013340: 765f 6865 6164 6572 2061 6e64 2027 726f  v_header and 'ro
-00013350: 6c6c 2720 696e 206e 6176 5f68 6561 6465  ll' in nav_heade
-00013360: 723a 0a20 2020 2020 2020 2020 2020 2063  r:.            c
-00013370: 6f6d 7065 6e73 6174 4f66 6673 6574 7320  ompensatOffsets 
-00013380: 3d20 5472 7565 0a0a 2020 2020 2020 2020  = True..        
-00013390: 2320 6368 6563 6b20 6966 2066 6f72 206d  # check if for m
-000133a0: 6973 7369 6e67 2066 6965 6c64 7320 7468  issing fields th
-000133b0: 6572 6520 6172 6520 636f 6e73 7420 7661  ere are const va
-000133c0: 6c75 6573 2069 6e20 6865 6164 6572 0a20  lues in header. 
-000133d0: 2020 2020 2020 2063 6f6e 7374 5f76 616c         const_val
-000133e0: 7565 7320 3d20 7b7d 0a20 2020 2020 2020  ues = {}.       
-000133f0: 2066 6f72 206e 6176 4669 656c 6420 696e   for navField in
-00013400: 206d 6971 7476 2e70 6f73 5f68 6561 6465   miqtv.pos_heade
-00013410: 725b 276d 6172 6971 7427 5d3a 0a20 2020  r['mariqt']:.   
-00013420: 2020 2020 2020 2020 2072 6573 7065 6374           respect
-00013430: 6976 6548 6561 6465 7246 6965 6c64 203d  iveHeaderField =
-00013440: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
-00013450: 725b 226d 6172 6971 7422 5d5b 6e61 7646  r["mariqt"][navF
-00013460: 6965 6c64 5d0a 2020 2020 2020 2020 2020  ield].          
-00013470: 2020 6966 206e 6176 4669 656c 6420 6e6f    if navField no
-00013480: 7420 696e 206e 6176 5f68 6561 6465 7220  t in nav_header 
-00013490: 616e 6420 2872 6573 7065 6374 6976 6548  and (respectiveH
-000134a0: 6561 6465 7246 6965 6c64 2069 6e20 7365  eaderField in se
-000134b0: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-000134c0: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
-000134d0: 6579 5d20 616e 6420 7365 6c66 2e66 696e  ey] and self.fin
-000134e0: 6454 6d70 4669 656c 6432 2872 6573 7065  dTmpField2(respe
-000134f0: 6374 6976 6548 6561 6465 7246 6965 6c64  ctiveHeaderField
-00013500: 2920 213d 2022 2229 3a20 0a20 2020 2020  ) != ""): .     
-00013510: 2020 2020 2020 2020 2020 2063 6f6e 7374             const
-00013520: 5f76 616c 7565 735b 6e61 7646 6965 6c64  _values[navField
-00013530: 5d20 3d20 7365 6c66 2e66 696e 6454 6d70  ] = self.findTmp
-00013540: 4669 656c 6428 7265 7370 6563 7469 7665  Field(respective
-00013550: 4865 6164 6572 4669 656c 6429 0a0a 2020  HeaderField)..  
-00013560: 2020 2020 2020 2320 4c6f 6164 206e 6176        # Load nav
-00013570: 6967 6174 696f 6e20 6461 7461 0a20 2020  igation data.   
-00013580: 2020 2020 206e 6176 5f64 6174 612c 2070       nav_data, p
-00013590: 6172 7365 4d73 6720 3d20 6d69 7174 6e2e  arseMsg = miqtn.
-000135a0: 7265 6164 416c 6c50 6f73 6974 696f 6e73  readAllPositions
-000135b0: 4672 6f6d 4669 6c65 5061 7468 286e 6176  FromFilePath(nav
-000135c0: 5f70 6174 682c 206e 6176 5f68 6561 6465  _path, nav_heade
-000135d0: 722c 2064 6174 655f 666f 726d 6174 2c63  r, date_format,c
-000135e0: 6f6c 5f73 6570 6172 6174 6f72 3d63 6f6c  ol_separator=col
-000135f0: 5f73 6570 6172 6174 6f72 2c63 6f6e 7374  _separator,const
-00013600: 5f76 616c 7565 733d 636f 6e73 745f 7661  _values=const_va
-00013610: 6c75 6573 290a 2020 2020 2020 2020 6966  lues).        if
-00013620: 2070 6172 7365 4d73 6720 213d 2022 223a   parseMsg != "":
-00013630: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00013640: 662e 7072 6f76 2e6c 6f67 2870 6172 7365  f.prov.log(parse
-00013650: 4d73 672c 646f 6e74 5368 6f77 3d54 7275  Msg,dontShow=Tru
-00013660: 6529 0a20 2020 2020 2020 2020 2020 2072  e).            r
-00013670: 6574 7572 6e4d 7367 203d 2022 5c6e 2220  eturnMsg = "\n" 
-00013680: 2b20 7061 7273 654d 7367 0a0a 2020 2020  + parseMsg..    
-00013690: 2020 2020 2320 6669 6e64 2066 6f72 2065      # find for e
-000136a0: 6163 6820 696d 6167 6520 7468 6520 7265  ach image the re
-000136b0: 7370 6563 7469 7665 206e 6176 6967 6174  spective navigat
-000136c0: 696f 6e20 6461 7461 0a20 2020 2020 2020  ion data.       
-000136d0: 2073 2e73 746f 7028 290a 2020 2020 2020   s.stop().      
-000136e0: 2020 7375 6363 6573 732c 2069 6d61 6765    success, image
-000136f0: 5f64 7473 2c20 6d73 6720 3d20 7365 6c66  _dts, msg = self
-00013700: 2e66 696e 644e 6176 4461 7461 466f 7249  .findNavDataForI
-00013710: 6d61 6765 286e 6176 5f64 6174 612c 7669  mage(nav_data,vi
-00013720: 6465 6f53 616d 706c 6553 6563 6f6e 6473  deoSampleSeconds
-00013730: 290a 2020 2020 2020 2020 7365 6c66 2e70  ).        self.p
-00013740: 726f 762e 6c6f 6728 6d73 672c 646f 6e74  rov.log(msg,dont
-00013750: 5368 6f77 3d54 7275 6529 0a20 2020 2020  Show=True).     
-00013760: 2020 2069 6620 6d73 6720 213d 2022 223a     if msg != "":
-00013770: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00013780: 7572 6e4d 7367 202b 3d20 225c 6e22 202b  urnMsg += "\n" +
-00013790: 206d 7367 0a20 2020 2020 2020 2069 6620   msg.        if 
-000137a0: 6e6f 7420 7375 6363 6573 733a 0a20 2020  not success:.   
-000137b0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000137c0: 4661 6c73 652c 2072 6574 7572 6e4d 7367  False, returnMsg
-000137d0: 0a20 2020 2020 2020 2073 203d 206d 6971  .        s = miq
-000137e0: 7463 2e50 7269 6e74 4c6f 6164 696e 674d  tc.PrintLoadingM
-000137f0: 7367 2822 4372 6561 7469 6e67 2069 7465  sg("Creating ite
-00013800: 6d73 2720 6e61 7669 6761 7469 6f6e 2064  ms' navigation d
-00013810: 6174 6122 290a 0a20 2020 2020 2020 2023  ata")..        #
-00013820: 2063 6f6d 7065 6e73 6174 6520 6c65 7665   compensate leve
-00013830: 7261 726d 206f 6666 7365 7473 0a20 2020  rarm offsets.   
-00013840: 2020 2020 2069 6620 636f 6d70 656e 7361       if compensa
-00013850: 744f 6666 7365 7473 3a0a 0a20 2020 2020  tOffsets:..     
-00013860: 2020 2020 2020 2023 206c 6f61 6420 6672         # load fr
-00013870: 616d 6520 6174 7469 7475 6465 2064 6174  ame attitude dat
-00013880: 6120 6672 6f6d 2066 696c 650a 2020 2020  a from file.    
-00013890: 2020 2020 2020 2020 6174 745f 6461 7461          att_data
-000138a0: 2c20 7061 7273 654d 7367 203d 206d 6971  , parseMsg = miq
-000138b0: 746e 2e72 6561 6441 6c6c 4174 7469 7475  tn.readAllAttitu
-000138c0: 6465 7346 726f 6d46 696c 6550 6174 6828  desFromFilePath(
-000138d0: 6e61 765f 7061 7468 2c20 6e61 765f 6865  nav_path, nav_he
-000138e0: 6164 6572 2c20 6461 7465 5f66 6f72 6d61  ader, date_forma
-000138f0: 742c 636f 6c5f 7365 7061 7261 746f 723d  t,col_separator=
-00013900: 636f 6c5f 7365 7061 7261 746f 722c 636f  col_separator,co
-00013910: 6e73 745f 7661 6c75 6573 3d63 6f6e 7374  nst_values=const
-00013920: 5f76 616c 7565 732c 616e 676c 6573 496e  _values,anglesIn
-00013930: 5261 643d 616e 676c 6573 5f69 6e5f 7261  Rad=angles_in_ra
-00013940: 6429 0a20 2020 2020 2020 2020 2020 2069  d).            i
-00013950: 6620 7061 7273 654d 7367 2021 3d20 2222  f parseMsg != ""
-00013960: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00013970: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
-00013980: 7061 7273 654d 7367 2c64 6f6e 7453 686f  parseMsg,dontSho
-00013990: 773d 5472 7565 290a 2020 2020 2020 2020  w=True).        
-000139a0: 2020 2020 2020 2020 7265 7475 726e 4d73          returnMs
-000139b0: 6720 2b3d 2022 5c6e 2220 2b20 7061 7273  g += "\n" + pars
-000139c0: 654d 7367 0a0a 2020 2020 2020 2020 2020  eMsg..          
-000139d0: 2020 2320 6669 6e64 2066 6f72 2065 6163    # find for eac
-000139e0: 6820 696d 6167 6520 7468 6520 7265 7370  h image the resp
-000139f0: 6563 7469 7665 206e 6176 6967 6174 696f  ective navigatio
-00013a00: 6e20 6461 7461 0a20 2020 2020 2020 2020  n data.         
-00013a10: 2020 2073 7563 6365 7373 2c20 696d 6167     success, imag
-00013a20: 655f 6474 735f 6174 742c 206d 7367 203d  e_dts_att, msg =
-00013a30: 2073 656c 662e 6669 6e64 4e61 7644 6174   self.findNavDat
-00013a40: 6146 6f72 496d 6167 6528 6174 745f 6461  aForImage(att_da
-00013a50: 7461 2c76 6964 656f 5361 6d70 6c65 5365  ta,videoSampleSe
-00013a60: 636f 6e64 7329 0a20 2020 2020 2020 2020  conds).         
-00013a70: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-00013a80: 286d 7367 2c64 6f6e 7453 686f 773d 5472  (msg,dontShow=Tr
-00013a90: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00013aa0: 6966 206d 7367 2021 3d20 2222 3a0a 2020  if msg != "":.  
-00013ab0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00013ac0: 7475 726e 4d73 6720 2b3d 2022 5c6e 2220  turnMsg += "\n" 
-00013ad0: 2b20 6d73 670a 2020 2020 2020 2020 2020  + msg.          
-00013ae0: 2020 6966 206e 6f74 2073 7563 6365 7373    if not success
-00013af0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00013b00: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
-00013b10: 7265 7475 726e 4d73 670a 0a20 2020 2020  returnMsg..     
-00013b20: 2020 2020 2020 2023 2063 6f6d 7065 6e73         # compens
-00013b30: 6174 650a 2020 2020 2020 2020 2020 2020  ate.            
-00013b40: 666f 7220 6669 6c65 2069 6e20 696d 6167  for file in imag
-00013b50: 655f 6474 733a 0a20 2020 2020 2020 2020  e_dts:.         
-00013b60: 2020 2020 2020 2070 6f73 6974 696f 6e73         positions
-00013b70: 203d 2069 6d61 6765 5f64 7473 5b66 696c   = image_dts[fil
-00013b80: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
-00013b90: 2020 2061 7474 6974 7564 6573 203d 2069     attitudes = i
-00013ba0: 6d61 6765 5f64 7473 5f61 7474 5b66 696c  mage_dts_att[fil
-00013bb0: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
-00013bc0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-00013bd0: 6528 6c65 6e28 706f 7369 7469 6f6e 7329  e(len(positions)
-00013be0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00013bf0: 2020 2020 2020 206c 6174 203d 2070 6f73         lat = pos
-00013c00: 6974 696f 6e73 5b69 5d2e 6c61 740a 2020  itions[i].lat.  
-00013c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c20: 2020 6c6f 6e20 3d20 706f 7369 7469 6f6e    lon = position
-00013c30: 735b 695d 2e6c 6f6e 0a20 2020 2020 2020  s[i].lon.       
-00013c40: 2020 2020 2020 2020 2020 2020 2064 6570               dep
-00013c50: 203d 2070 6f73 6974 696f 6e73 5b69 5d2e   = positions[i].
-00013c60: 6465 700a 2020 2020 2020 2020 2020 2020  dep.            
-00013c70: 2020 2020 2020 2020 6966 2027 616c 7427          if 'alt'
-00013c80: 2069 6e20 6e61 765f 6865 6164 6572 2061   in nav_header a
-00013c90: 6e64 206e 6f74 2027 6465 7027 2069 6e20  nd not 'dep' in 
-00013ca0: 6e61 765f 6865 6164 6572 3a0a 2020 2020  nav_header:.    
-00013cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013cc0: 2020 2020 6465 7020 2a3d 202d 310a 2020      dep *= -1.  
-00013cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ce0: 2020 7961 7720 3d20 6174 7469 7475 6465    yaw = attitude
-00013cf0: 735b 695d 2e79 6177 0a20 2020 2020 2020  s[i].yaw.       
-00013d00: 2020 2020 2020 2020 2020 2020 2070 6974               pit
-00013d10: 6368 203d 2061 7474 6974 7564 6573 5b69  ch = attitudes[i
-00013d20: 5d2e 7069 7463 680a 2020 2020 2020 2020  ].pitch.        
-00013d30: 2020 2020 2020 2020 2020 2020 726f 6c6c              roll
-00013d40: 203d 2061 7474 6974 7564 6573 5b69 5d2e   = attitudes[i].
-00013d50: 726f 6c6c 0a20 2020 2020 2020 2020 2020  roll.           
-00013d60: 2020 2020 2020 2020 2069 6620 7961 7720           if yaw 
-00013d70: 6973 204e 6f6e 6520 6f72 2070 6974 6368  is None or pitch
-00013d80: 2069 7320 4e6f 6e65 206f 7220 726f 6c6c   is None or roll
-00013d90: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00013da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013db0: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-00013dc0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00013dd0: 6577 5f6c 6174 2c6e 6577 5f6c 6f6e 2c6e  ew_lat,new_lon,n
-00013de0: 6577 5f64 6570 203d 206d 6971 7467 2e61  ew_dep = miqtg.a
-00013df0: 6464 4c65 7665 7261 726d 7332 4c61 746c  ddLeverarms2Latl
-00013e00: 6f6e 286c 6174 2c6c 6f6e 2c64 6570 2c6f  on(lat,lon,dep,o
-00013e10: 6666 7365 745f 782c 6f66 6673 6574 5f79  ffset_x,offset_y
-00013e20: 2c6f 6666 7365 745f 7a2c 7961 772c 7069  ,offset_z,yaw,pi
-00013e30: 7463 682c 726f 6c6c 290a 2020 2020 2020  tch,roll).      
-00013e40: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00013e50: 7369 7469 6f6e 735b 695d 2e6c 6174 203d  sitions[i].lat =
-00013e60: 206e 6577 5f6c 6174 0a20 2020 2020 2020   new_lat.       
-00013e70: 2020 2020 2020 2020 2020 2020 2070 6f73               pos
-00013e80: 6974 696f 6e73 5b69 5d2e 6c6f 6e20 3d20  itions[i].lon = 
-00013e90: 6e65 775f 6c6f 6e0a 2020 2020 2020 2020  new_lon.        
-00013ea0: 2020 2020 2020 2020 2020 2020 706f 7369              posi
-00013eb0: 7469 6f6e 735b 695d 2e64 6570 203d 206e  tions[i].dep = n
-00013ec0: 6577 5f64 6570 0a0a 2020 2020 2020 2020  ew_dep..        
-00013ed0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-00013ee0: 6728 2261 7070 6c69 6564 206c 6576 6572  g("applied lever
-00013ef0: 2061 726d 2063 6f6d 7065 6e73 6174 696f   arm compensatio
-00013f00: 6e20 782c 792c 7a20 3d20 2220 2b20 7374  n x,y,z = " + st
-00013f10: 7228 6f66 6673 6574 5f78 2920 2b20 222c  r(offset_x) + ",
-00013f20: 2220 2b20 7374 7228 6f66 6673 6574 5f79  " + str(offset_y
-00013f30: 2920 2b20 222c 2220 2b20 7374 7228 6f66  ) + "," + str(of
-00013f40: 6673 6574 5f7a 292c 646f 6e74 5368 6f77  fset_z),dontShow
-00013f50: 3d54 7275 6529 0a0a 2020 2020 2020 2020  =True)..        
-00013f60: 6966 206c 656e 2869 6d61 6765 5f64 7473  if len(image_dts
-00013f70: 2920 3e20 303a 0a20 2020 2020 2020 2020  ) > 0:.         
-00013f80: 2020 2023 2043 6865 636b 2077 6865 7468     # Check wheth
-00013f90: 6572 2064 6570 7468 2061 6e64 2068 6569  er depth and hei
-00013fa0: 6768 7420 6172 6520 7365 740a 2020 2020  ght are set.    
-00013fb0: 2020 2020 2020 2020 6c61 745f 6964 656e          lat_iden
-00013fc0: 7469 6361 6c2c 206c 6f6e 5f69 6465 6e74  tical, lon_ident
-00013fd0: 6963 616c 2c20 6465 705f 6964 656e 7469  ical, dep_identi
-00013fe0: 6361 6c2c 2068 6774 5f69 6465 6e74 6963  cal, hgt_identic
-00013ff0: 616c 2c20 6465 705f 6e6f 745f 7a65 726f  al, dep_not_zero
-00014000: 2c20 6867 745f 6e6f 745f 7a65 726f 2c75  , hgt_not_zero,u
-00014010: 6e63 6572 745f 6e6f 745f 7a65 726f 203d  ncert_not_zero =
-00014020: 206e 6176 5f64 6174 612e 6368 6563 6b50   nav_data.checkP
-00014030: 6f73 6974 696f 6e73 436f 6e74 656e 7428  ositionsContent(
-00014040: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-00014050: 2057 7269 7465 2074 6f20 6e61 7669 6761   Write to naviga
-00014060: 7469 6f6e 2074 7874 2066 696c 650a 2020  tion txt file.  
-00014070: 2020 2020 2020 2020 2020 2320 6865 6164            # head
-00014080: 6572 0a20 2020 2020 2020 2020 2020 2072  er.            r
-00014090: 6573 203d 206f 7065 6e28 7365 6c66 2e67  es = open(self.g
-000140a0: 6574 5f69 6e74 5f6e 6176 5f66 696c 6528  et_int_nav_file(
-000140b0: 292c 2022 7722 290a 2020 2020 2020 2020  ), "w").        
-000140c0: 2020 2020 7265 732e 7772 6974 6528 6d69      res.write(mi
-000140d0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-000140e0: 6d61 7269 7174 275d 5b27 696d 6727 5d2b  mariqt']['img']+
-000140f0: 225c 7422 2b6d 6971 7476 2e63 6f6c 5f68  "\t"+miqtv.col_h
-00014100: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-00014110: 2775 7463 275d 290a 2020 2020 2020 2020  'utc']).        
-00014120: 2020 2020 6966 2027 6c61 7427 2069 6e20      if 'lat' in 
-00014130: 6e61 765f 6865 6164 6572 3a0a 2020 2020  nav_header:.    
-00014140: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-00014150: 7772 6974 6528 225c 7422 2b6d 6971 7476  write("\t"+miqtv
-00014160: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00014170: 6971 7427 5d5b 276c 6174 275d 290a 2020  iqt']['lat']).  
-00014180: 2020 2020 2020 2020 2020 6966 2027 6c6f            if 'lo
-00014190: 6e27 2069 6e20 6e61 765f 6865 6164 6572  n' in nav_header
-000141a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000141b0: 2020 7265 732e 7772 6974 6528 225c 7422    res.write("\t"
-000141c0: 2b6d 6971 7476 2e63 6f6c 5f68 6561 6465  +miqtv.col_heade
-000141d0: 725b 276d 6172 6971 7427 5d5b 276c 6f6e  r['mariqt']['lon
-000141e0: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
-000141f0: 6966 2064 6570 5f6e 6f74 5f7a 6572 6f20  if dep_not_zero 
-00014200: 616e 6420 2764 6570 2720 696e 206e 6176  and 'dep' in nav
-00014210: 5f68 6561 6465 723a 0a20 2020 2020 2020  _header:.       
-00014220: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
-00014230: 7465 2822 5c74 222b 6d69 7174 762e 636f  te("\t"+miqtv.co
-00014240: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00014250: 275d 5b27 6465 7027 5d29 0a20 2020 2020  ']['dep']).     
-00014260: 2020 2020 2020 2065 6c69 6620 6465 705f         elif dep_
-00014270: 6e6f 745f 7a65 726f 2061 6e64 2027 616c  not_zero and 'al
-00014280: 7427 2069 6e20 6e61 765f 6865 6164 6572  t' in nav_header
-00014290: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000142a0: 2020 7265 732e 7772 6974 6528 225c 7422    res.write("\t"
-000142b0: 2b6d 6971 7476 2e63 6f6c 5f68 6561 6465  +miqtv.col_heade
-000142c0: 725b 276d 6172 6971 7427 5d5b 2761 6c74  r['mariqt']['alt
-000142d0: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
-000142e0: 6966 2068 6774 5f6e 6f74 5f7a 6572 6f20  if hgt_not_zero 
-000142f0: 616e 6420 2768 6774 2720 696e 206e 6176  and 'hgt' in nav
-00014300: 5f68 6561 6465 723a 0a20 2020 2020 2020  _header:.       
-00014310: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
-00014320: 7465 2822 5c74 222b 6d69 7174 762e 636f  te("\t"+miqtv.co
-00014330: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00014340: 275d 5b27 6867 7427 5d29 0a20 2020 2020  ']['hgt']).     
-00014350: 2020 2020 2020 2069 6620 756e 6365 7274         if uncert
-00014360: 5f6e 6f74 5f7a 6572 6f20 616e 6420 2775  _not_zero and 'u
-00014370: 6e63 6572 7427 2069 6e20 6e61 765f 6865  ncert' in nav_he
-00014380: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
-00014390: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
-000143a0: 225c 7422 2b6d 6971 7476 2e63 6f6c 5f68  "\t"+miqtv.col_h
-000143b0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-000143c0: 2775 6e63 6572 7427 5d29 0a20 2020 2020  'uncert']).     
-000143d0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-000143e0: 2822 5c6e 2229 0a20 2020 2020 2020 2020  ("\n").         
-000143f0: 2020 2023 2064 6174 6120 6c69 6e65 730a     # data lines.
-00014400: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00014410: 6669 6c65 2069 6e20 696d 6167 655f 6474  file in image_dt
-00014420: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00014430: 2020 2066 6f72 2074 696d 6570 6f69 6e74     for timepoint
-00014440: 2069 6e20 696d 6167 655f 6474 735b 6669   in image_dts[fi
-00014450: 6c65 5d3a 0a20 2020 2020 2020 2020 2020  le]:.           
-00014460: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
-00014470: 7465 2866 696c 652b 225c 7422 2b74 696d  te(file+"\t"+tim
-00014480: 6570 6f69 6e74 2e64 6174 6554 696d 6528  epoint.dateTime(
-00014490: 292e 7374 7266 7469 6d65 286d 6971 7476  ).strftime(miqtv
-000144a0: 2e64 6174 655f 666f 726d 6174 735b 276d  .date_formats['m
-000144b0: 6172 6971 7427 5d29 2920 0a20 2020 2020  ariqt'])) .     
-000144c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000144d0: 6620 276c 6174 2720 696e 206e 6176 5f68  f 'lat' in nav_h
-000144e0: 6561 6465 723a 0a20 2020 2020 2020 2020  eader:.         
-000144f0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00014500: 616c 203d 2074 696d 6570 6f69 6e74 2e6c  al = timepoint.l
-00014510: 6174 0a20 2020 2020 2020 2020 2020 2020  at.             
-00014520: 2020 2020 2020 2020 2020 2069 6620 276c             if 'l
-00014530: 6174 2720 696e 2072 6563 6f72 6473 3262  at' in records2b
-00014540: 6549 6e76 6572 7465 643a 0a20 2020 2020  eInverted:.     
-00014550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014560: 2020 2020 2020 2076 616c 202a 3d20 2d31         val *= -1
-00014570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014580: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
-00014590: 7465 2822 5c74 222b 7374 7228 7661 6c29  te("\t"+str(val)
-000145a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000145b0: 2020 2020 2020 6966 2027 6c6f 6e27 2069        if 'lon' i
-000145c0: 6e20 6e61 765f 6865 6164 6572 3a0a 2020  n nav_header:.  
-000145d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000145e0: 2020 2020 2020 7661 6c20 3d20 7469 6d65        val = time
-000145f0: 706f 696e 742e 6c6f 6e0a 2020 2020 2020  point.lon.      
-00014600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014610: 2020 6966 2027 6c6f 6e27 2069 6e20 7265    if 'lon' in re
-00014620: 636f 7264 7332 6265 496e 7665 7274 6564  cords2beInverted
-00014630: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00014640: 2020 2020 2020 2020 2020 2020 2020 7661                va
-00014650: 6c20 2a3d 202d 310a 2020 2020 2020 2020  l *= -1.        
-00014660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014670: 7265 732e 7772 6974 6528 225c 7422 2b73  res.write("\t"+s
-00014680: 7472 2876 616c 2929 0a20 2020 2020 2020  tr(val)).       
-00014690: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000146a0: 6465 705f 6e6f 745f 7a65 726f 2061 6e64  dep_not_zero and
-000146b0: 2027 6465 7027 2069 6e20 6e61 765f 6865   'dep' in nav_he
-000146c0: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
-000146d0: 2020 2020 2020 2020 2020 2020 2020 7661                va
-000146e0: 6c20 3d20 7469 6d65 706f 696e 742e 6465  l = timepoint.de
-000146f0: 700a 2020 2020 2020 2020 2020 2020 2020  p.              
-00014700: 2020 2020 2020 2020 2020 6966 2027 6465            if 'de
-00014710: 7027 2069 6e20 7265 636f 7264 7332 6265  p' in records2be
-00014720: 496e 7665 7274 6564 3a0a 2020 2020 2020  Inverted:.      
-00014730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014740: 2020 2020 2020 7661 6c20 2a3d 202d 310a        val *= -1.
-00014750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014760: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
-00014770: 6528 225c 7422 2b73 7472 2876 616c 2929  e("\t"+str(val))
-00014780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014790: 2020 2020 2065 6c69 6620 6465 705f 6e6f       elif dep_no
-000147a0: 745f 7a65 726f 2061 6e64 2027 616c 7427  t_zero and 'alt'
-000147b0: 2069 6e20 6e61 765f 6865 6164 6572 3a0a   in nav_header:.
-000147c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000147d0: 2020 2020 2020 2020 7661 6c20 3d20 7469          val = ti
-000147e0: 6d65 706f 696e 742e 6465 7020 2a20 2d31  mepoint.dep * -1
-000147f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014800: 2020 2020 2020 2020 2069 6620 2761 6c74           if 'alt
-00014810: 2720 696e 2072 6563 6f72 6473 3262 6549  ' in records2beI
-00014820: 6e76 6572 7465 643a 0a20 2020 2020 2020  nverted:.       
-00014830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014840: 2020 2020 2076 616c 202a 3d20 2d31 0a20       val *= -1. 
-00014850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014860: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00014870: 2822 5c74 222b 7374 7228 7661 6c29 290a  ("\t"+str(val)).
-00014880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014890: 2020 2020 6966 2068 6774 5f6e 6f74 5f7a      if hgt_not_z
-000148a0: 6572 6f20 616e 6420 2768 6774 2720 696e  ero and 'hgt' in
-000148b0: 206e 6176 5f68 6561 6465 723a 0a20 2020   nav_header:.   
-000148c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000148d0: 2020 2020 2076 616c 203d 2074 696d 6570       val = timep
-000148e0: 6f69 6e74 2e68 6774 0a20 2020 2020 2020  oint.hgt.       
-000148f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014900: 2069 6620 2768 6774 2720 696e 2072 6563   if 'hgt' in rec
-00014910: 6f72 6473 3262 6549 6e76 6572 7465 643a  ords2beInverted:
-00014920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014930: 2020 2020 2020 2020 2020 2020 2076 616c               val
-00014940: 202a 3d20 2d31 0a20 2020 2020 2020 2020   *= -1.         
-00014950: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00014960: 6573 2e77 7269 7465 2822 5c74 222b 7374  es.write("\t"+st
-00014970: 7228 7661 6c29 290a 2020 2020 2020 2020  r(val)).        
-00014980: 2020 2020 2020 2020 2020 2020 6966 2075              if u
-00014990: 6e63 6572 745f 6e6f 745f 7a65 726f 2061  ncert_not_zero a
-000149a0: 6e64 2027 756e 6365 7274 2720 696e 206e  nd 'uncert' in n
-000149b0: 6176 5f68 6561 6465 723a 0a20 2020 2020  av_header:.     
-000149c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000149d0: 2020 2076 616c 203d 2074 696d 6570 6f69     val = timepoi
-000149e0: 6e74 2e75 6e63 6572 740a 2020 2020 2020  nt.uncert.      
-000149f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a00: 2020 6966 2027 756e 6365 7274 2720 696e    if 'uncert' in
-00014a10: 2072 6563 6f72 6473 3262 6549 6e76 6572   records2beInver
-00014a20: 7465 643a 0a20 2020 2020 2020 2020 2020  ted:.           
-00014a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a40: 2076 616c 202a 3d20 2d31 0a20 2020 2020   val *= -1.     
-00014a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a60: 2020 2072 6573 2e77 7269 7465 2822 5c74     res.write("\t
-00014a70: 222b 7374 7228 7661 6c29 290a 2020 2020  "+str(val)).    
-00014a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a90: 7265 732e 7772 6974 6528 225c 6e22 290a  res.write("\n").
+0000b500: 6174 655f 6669 656c 6473 2873 656c 6629  ate_fields(self)
+0000b510: 3a0a 2020 2020 2020 2020 2222 2220 4372  :.        """ Cr
+0000b520: 6561 7465 2061 6e64 2076 616c 6964 6174  eate and validat
+0000b530: 6520 6375 7272 656e 7420 6865 6164 6572  e current header
+0000b540: 2066 6965 6c64 7320 616e 6420 6974 656d   fields and item
+0000b550: 2066 6965 6c64 7320 6672 6f6d 2069 6e74   fields from int
+0000b560: 6572 6d65 6469 6174 6520 6669 6c65 732e  ermediate files.
+0000b570: 204f 7665 7277 7269 7465 7320 6578 6973   Overwrites exis
+0000b580: 7469 6e67 2066 6965 6c64 732e 2022 2222  ting fields. """
+0000b590: 0a20 2020 2020 2020 2069 7465 6d5f 6461  .        item_da
+0000b5a0: 7461 203d 2073 656c 662e 5f67 6574 5f69  ta = self._get_i
+0000b5b0: 7465 6d5f 6461 7461 5f66 726f 6d5f 696e  tem_data_from_in
+0000b5c0: 7465 726d 6564 6961 7465 5f66 696c 6573  termediate_files
+0000b5d0: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
+0000b5e0: 6e20 7365 6c66 2e63 7265 6174 6569 4644  n self.createiFD
+0000b5f0: 4f28 7365 6c66 2e69 6664 6f5f 746d 705b  O(self.ifdo_tmp[
+0000b600: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0000b610: 6465 724b 6579 5d2c 2069 7465 6d5f 6461  derKey], item_da
+0000b620: 7461 2e76 616c 7565 7328 2929 0a0a 0a20  ta.values())... 
+0000b630: 2020 2064 6566 2075 7064 6174 655f 6669     def update_fi
+0000b640: 656c 6473 2873 656c 6629 3a0a 2020 2020  elds(self):.    
+0000b650: 2020 2020 2222 2220 5570 6461 7465 2061      """ Update a
+0000b660: 6e64 2076 616c 6964 6174 6520 6375 7272  nd validate curr
+0000b670: 656e 7420 6865 6164 6572 2066 6965 6c64  ent header field
+0000b680: 7320 616e 6420 6974 656d 2066 6965 6c64  s and item field
+0000b690: 7320 6672 6f6d 2069 6e74 6572 6d65 6469  s from intermedi
+0000b6a0: 6174 6520 6669 6c65 732e 2022 2222 0a20  ate files. """. 
+0000b6b0: 2020 2020 2020 2069 7465 6d5f 6461 7461         item_data
+0000b6c0: 203d 2073 656c 662e 5f67 6574 5f69 7465   = self._get_ite
+0000b6d0: 6d5f 6461 7461 5f66 726f 6d5f 696e 7465  m_data_from_inte
+0000b6e0: 726d 6564 6961 7465 5f66 696c 6573 2829  rmediate_files()
+0000b6f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000b700: 7365 6c66 2e75 7064 6174 6569 4644 4f28  self.updateiFDO(
+0000b710: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+0000b720: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+0000b730: 724b 6579 5d2c 2069 7465 6d5f 6461 7461  rKey], item_data
+0000b740: 2e76 616c 7565 7328 2929 0a0a 0a20 2020  .values())...   
+0000b750: 2064 6566 2063 7265 6174 6543 6f72 6546   def createCoreF
+0000b760: 6965 6c64 7328 7365 6c66 293a 0a20 2020  ields(self):.   
+0000b770: 2020 2020 2022 2222 2044 4550 5245 4341       """ DEPRECA
+0000b780: 4445 542c 2075 7365 2063 7265 6174 655f  DET, use create_
+0000b790: 6669 656c 6473 2829 206f 7220 7570 6461  fields() or upda
+0000b7a0: 7465 5f66 6965 6c64 7328 2920 696e 7374  te_fields() inst
+0000b7b0: 6564 2e0a 2020 2020 2020 2020 4669 6c6c  ed..        Fill
+0000b7c0: 7320 7468 6520 6946 444f 2063 6f72 6520  s the iFDO core 
+0000b7d0: 6669 656c 6473 2066 726f 6d20 696e 7465  fields from inte
+0000b7e0: 726d 6564 6961 7465 2066 696c 6573 2e20  rmediate files. 
+0000b7f0: 5769 7468 6f75 7420 7468 656d 206e 6f20  Without them no 
+0000b800: 7661 6c69 6420 6946 444f 2063 616e 2062  valid iFDO can b
+0000b810: 6520 6372 6561 7465 642e 0a20 2020 2020  e created..     
+0000b820: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+0000b830: 7465 6d5f 6461 7461 203d 2073 656c 662e  tem_data = self.
+0000b840: 5f67 6574 5f69 7465 6d5f 6461 7461 5f66  _get_item_data_f
+0000b850: 726f 6d5f 696e 7465 726d 6564 6961 7465  rom_intermediate
+0000b860: 5f66 696c 6573 5f63 6f72 6528 290a 2020  _files_core().  
+0000b870: 2020 2020 2020 2320 6368 6563 6b20 6669        # check fi
+0000b880: 656c 6473 2066 6f72 2076 616c 6964 6974  elds for validit
+0000b890: 790a 2020 2020 2020 2020 2320 6974 656d  y.        # item
+0000b8a0: 5f64 6174 6120 636f 6e74 6169 6e73 2066  _data contains f
+0000b8b0: 6965 6c64 2069 6d61 6765 2d66 696c 656e  ield image-filen
+0000b8c0: 616d 652c 2077 6869 6368 2077 6869 6368  ame, which which
+0000b8d0: 2077 696c 6c20 6e6f 7420 6265 2073 746f   will not be sto
+0000b8e0: 7265 6420 6173 2061 6e20 6974 656d 2066  red as an item f
+0000b8f0: 6965 6c64 2069 6e20 6946 4f44 2062 7574  ield in iFOD but
+0000b900: 2061 7320 7468 6520 6974 656d 206e 616d   as the item nam
+0000b910: 6520 6974 7365 6c66 0a20 2020 2020 2020  e itself.       
+0000b920: 2072 6574 7572 6e20 7365 6c66 2e75 7064   return self.upd
+0000b930: 6174 6569 4644 4f28 7365 6c66 2e69 6664  ateiFDO(self.ifd
+0000b940: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
+0000b950: 5365 7448 6561 6465 724b 6579 5d2c 2069  SetHeaderKey], i
+0000b960: 7465 6d5f 6461 7461 2e76 616c 7565 7328  tem_data.values(
+0000b970: 2929 0a0a 0a20 2020 2064 6566 2063 7265  ))...    def cre
+0000b980: 6174 6543 6170 7475 7265 416e 6443 6f6e  ateCaptureAndCon
+0000b990: 7465 6e74 4669 656c 6473 2873 656c 6629  tentFields(self)
+0000b9a0: 3a0a 2020 2020 2020 2020 2222 2220 4445  :.        """ DE
+0000b9b0: 5052 4543 4144 4554 2c20 7573 6520 6372  PRECADET, use cr
+0000b9c0: 6561 7465 5f66 6965 6c64 7328 2920 6f72  eate_fields() or
+0000b9d0: 2075 7064 6174 655f 6669 656c 6473 2829   update_fields()
+0000b9e0: 2069 6e73 7465 642e 0a20 2020 2020 2020   insted..       
+0000b9f0: 2046 696c 6c73 2074 6865 2069 4644 4f20   Fills the iFDO 
+0000ba00: 6361 7075 7472 6520 616e 6420 636f 6e74  caputre and cont
+0000ba10: 656e 7420 6669 6564 7320 6672 6f6d 2070  ent fieds from p
+0000ba20: 726f 7669 6465 6420 6461 7461 2066 6965  rovided data fie
+0000ba30: 6c64 7320 0a20 2020 2020 2020 2022 2222  lds .        """
+0000ba40: 0a20 2020 2020 2020 2069 7465 6d5f 6461  .        item_da
+0000ba50: 7461 203d 2073 656c 662e 5f67 6574 5f69  ta = self._get_i
+0000ba60: 7465 6d5f 6461 7461 5f66 726f 6d5f 696e  tem_data_from_in
+0000ba70: 7465 726d 6564 6961 7465 5f66 696c 6573  termediate_files
+0000ba80: 5f6e 6f6e 655f 636f 7265 2829 0a20 2020  _none_core().   
+0000ba90: 2020 2020 2023 2063 6865 636b 2066 6965       # check fie
+0000baa0: 6c64 7320 666f 7220 7661 6c69 6469 7479  lds for validity
+0000bab0: 0a20 2020 2020 2020 2023 2069 7465 6d5f  .        # item_
+0000bac0: 6461 7461 2063 6f6e 7461 696e 7320 6669  data contains fi
+0000bad0: 656c 6420 696d 6167 652d 6669 6c65 6e61  eld image-filena
+0000bae0: 6d65 2c20 7768 6963 6820 7768 6963 6820  me, which which 
+0000baf0: 7769 6c6c 206e 6f74 2062 6520 7374 6f72  will not be stor
+0000bb00: 6564 2061 7320 616e 2069 7465 6d20 6669  ed as an item fi
+0000bb10: 656c 6420 696e 2069 464f 4420 6275 7420  eld in iFOD but 
+0000bb20: 6173 2074 6865 2069 7465 6d20 6e61 6d65  as the item name
+0000bb30: 2069 7473 656c 660a 2020 2020 2020 2020   itself.        
+0000bb40: 7265 7475 726e 2073 656c 662e 7570 6461  return self.upda
+0000bb50: 7465 6946 444f 2873 656c 662e 6966 646f  teiFDO(self.ifdo
+0000bb60: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+0000bb70: 6574 4865 6164 6572 4b65 795d 2c20 6974  etHeaderKey], it
+0000bb80: 656d 5f64 6174 612e 7661 6c75 6573 2829  em_data.values()
+0000bb90: 290a 0a20 2020 200a 2020 2020 6465 6620  )..    .    def 
+0000bba0: 5f67 6574 5f69 7465 6d5f 6461 7461 5f66  _get_item_data_f
+0000bbb0: 726f 6d5f 696e 7465 726d 6564 6961 7465  rom_intermediate
+0000bbc0: 5f66 696c 6573 2873 656c 6629 3a0a 2020  _files(self):.  
+0000bbd0: 2020 2020 2020 2222 2220 5265 6164 2064        """ Read d
+0000bbe0: 6174 6120 6672 6f6d 2063 6f72 6520 616e  ata from core an
+0000bbf0: 6420 6e6f 6e65 2d63 6f72 6520 696e 7465  d none-core inte
+0000bc00: 726d 6465 6174 6520 6669 6c65 732c 2063  rmdeate files, c
+0000bc10: 6865 636b 2066 696c 6573 2065 7869 7374  heck files exist
+0000bc20: 2c20 6164 6420 2769 6d61 6765 2d68 616e  , add 'image-han
+0000bc30: 646c 6527 2e0a 2020 2020 2020 2020 5265  dle'..        Re
+0000bc40: 7475 726e 7320 6469 6374 206f 6620 666f  turns dict of fo
+0000bc50: 726d 207b 696d 6167 652d 6669 6c65 2d6e  rm {image-file-n
+0000bc60: 616d 653a 7b66 6965 6c64 3a76 616c 7565  ame:{field:value
+0000bc70: 7d2c 2e2e 2e7d 200a 2020 2020 2020 2020  },...} .        
+0000bc80: 2222 220a 2020 2020 2020 2020 6974 656d  """.        item
+0000bc90: 5f64 6174 615f 636f 7265 203d 2073 656c  _data_core = sel
+0000bca0: 662e 5f67 6574 5f69 7465 6d5f 6461 7461  f._get_item_data
+0000bcb0: 5f66 726f 6d5f 696e 7465 726d 6564 6961  _from_intermedia
+0000bcc0: 7465 5f66 696c 6573 5f63 6f72 6528 290a  te_files_core().
+0000bcd0: 2020 2020 2020 2020 6974 656d 5f64 6174          item_dat
+0000bce0: 615f 6e6f 6e65 5f63 6f72 6520 3d20 7365  a_none_core = se
+0000bcf0: 6c66 2e5f 6765 745f 6974 656d 5f64 6174  lf._get_item_dat
+0000bd00: 615f 6672 6f6d 5f69 6e74 6572 6d65 6469  a_from_intermedi
+0000bd10: 6174 655f 6669 6c65 735f 6e6f 6e65 5f63  ate_files_none_c
+0000bd20: 6f72 6528 290a 2020 2020 2020 2020 2370  ore().        #p
+0000bd30: 7072 696e 7428 6974 656d 5f64 6174 615f  print(item_data_
+0000bd40: 6e6f 6e65 5f63 6f72 6529 0a20 2020 2020  none_core).     
+0000bd50: 2020 2023 7070 7269 6e74 2869 7465 6d5f     #pprint(item_
+0000bd60: 6461 7461 5f63 6f72 6529 0a20 2020 2020  data_core).     
+0000bd70: 2020 2069 7465 6d5f 6461 7461 203d 2069     item_data = i
+0000bd80: 7465 6d5f 6461 7461 5f63 6f72 650a 2020  tem_data_core.  
+0000bd90: 2020 2020 2020 6c6f 6720 3d20 6d69 7174        log = miqt
+0000bda0: 632e 7265 6375 7273 6976 656c 7955 7064  c.recursivelyUpd
+0000bdb0: 6174 6544 6963 7473 2869 7465 6d5f 6461  ateDicts(item_da
+0000bdc0: 7461 2c20 6974 656d 5f64 6174 615f 6e6f  ta, item_data_no
+0000bdd0: 6e65 5f63 6f72 652c 206d 6971 7476 2e69  ne_core, miqtv.i
+0000bde0: 6664 6f5f 6d75 7475 616c 6c79 5f65 7863  fdo_mutually_exc
+0000bdf0: 6c75 7369 7665 5f66 6965 6c64 7329 0a20  lusive_fields). 
+0000be00: 2020 2020 2020 2023 7070 7269 6e74 2869         #pprint(i
+0000be10: 7465 6d5f 6461 7461 290a 2020 2020 2020  tem_data).      
+0000be20: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+0000be30: 6c6f 672c 646f 6e74 5368 6f77 3d54 7275  log,dontShow=Tru
+0000be40: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
+0000be50: 6e20 6974 656d 5f64 6174 610a 0a20 2020  n item_data..   
+0000be60: 2064 6566 205f 6765 745f 6974 656d 5f64   def _get_item_d
+0000be70: 6174 615f 6672 6f6d 5f69 6e74 6572 6d65  ata_from_interme
+0000be80: 6469 6174 655f 6669 6c65 735f 6e6f 6e65  diate_files_none
+0000be90: 5f63 6f72 6528 7365 6c66 293a 0a20 2020  _core(self):.   
+0000bea0: 2020 2020 2022 2222 2052 6561 6420 6461       """ Read da
+0000beb0: 7461 2066 726f 6d20 6e6f 6e2d 636f 7265  ta from non-core
+0000bec0: 2069 6e74 6572 6d64 6561 7465 2066 696c   intermdeate fil
+0000bed0: 6573 2e0a 2020 2020 2020 2020 5265 7475  es..        Retu
+0000bee0: 726e 7320 6469 6374 206f 6620 666f 726d  rns dict of form
+0000bef0: 207b 696d 6167 652d 6669 6c65 2d6e 616d   {image-file-nam
+0000bf00: 653a 7b66 6965 6c64 3a76 616c 7565 7d2c  e:{field:value},
+0000bf10: 2e2e 2e7d 200a 2020 2020 2020 2020 2222  ...} .        ""
+0000bf20: 220a 2020 2020 2020 2020 7265 7120 3d20  ".        req = 
+0000bf30: 7365 6c66 2e6e 6f6e 436f 7265 4669 656c  self.nonCoreFiel
+0000bf40: 6449 6e74 6572 6d65 6469 6174 6549 7465  dIntermediateIte
+0000bf50: 6d49 6e66 6f46 696c 6573 0a0a 2020 2020  mInfoFiles..    
+0000bf60: 2020 2020 6974 656d 5f64 6174 6120 3d20      item_data = 
+0000bf70: 7b7d 0a20 2020 2020 2020 2066 6f72 2072  {}.        for r
+0000bf80: 2069 6e20 7265 713a 0a20 2020 2020 2020   in req:.       
+0000bf90: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+0000bfa0: 6578 6973 7473 2872 2e66 696c 654e 616d  exists(r.fileNam
+0000bfb0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+0000bfc0: 2020 2020 7365 6c66 2e70 7261 7365 4974      self.praseIt
+0000bfd0: 656d 4461 7461 4672 6f6d 4669 6c65 2869  emDataFromFile(i
+0000bfe0: 7465 6d5f 6461 7461 2c72 2e66 696c 654e  tem_data,r.fileN
+0000bff0: 616d 652c 722e 7365 7061 7261 746f 722c  ame,r.separator,
+0000c000: 722e 6865 6164 6572 290a 2020 2020 2020  r.header).      
+0000c010: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0000c020: 726f 762e 6c6f 6728 2250 6172 7365 6420  rov.log("Parsed 
+0000c030: 6974 656d 2064 6174 6120 6672 6f6d 3a20  item data from: 
+0000c040: 2220 2b20 722e 6669 6c65 4e61 6d65 290a  " + r.fileName).
+0000c050: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0000c060: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000c070: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+0000c080: 2246 696c 6520 646f 6573 206e 6f74 2065  "File does not e
+0000c090: 7869 7374 733a 2022 202b 2072 2e66 696c  xists: " + r.fil
+0000c0a0: 654e 616d 6529 0a0a 2020 2020 2020 2020  eName)..        
+0000c0b0: 7265 7475 726e 2069 7465 6d5f 6461 7461  return item_data
+0000c0c0: 0a0a 0a20 2020 2064 6566 205f 6765 745f  ...    def _get_
+0000c0d0: 6974 656d 5f64 6174 615f 6672 6f6d 5f69  item_data_from_i
+0000c0e0: 6e74 6572 6d65 6469 6174 655f 6669 6c65  ntermediate_file
+0000c0f0: 735f 636f 7265 2873 656c 6629 3a0a 2020  s_core(self):.  
+0000c100: 2020 2020 2020 2222 2220 5265 6164 2064        """ Read d
+0000c110: 6174 6120 6672 6f6d 2063 6f72 6520 696e  ata from core in
+0000c120: 7465 726d 6465 6174 6520 6669 6c65 732c  termdeate files,
+0000c130: 2063 6865 636b 2066 696c 6573 2065 7869   check files exi
+0000c140: 7374 2c20 6164 6420 2769 6d61 6765 2d68  st, add 'image-h
+0000c150: 616e 646c 6527 2e0a 2020 2020 2020 2020  andle'..        
+0000c160: 5265 7475 726e 7320 6469 6374 206f 6620  Returns dict of 
+0000c170: 666f 726d 207b 696d 6167 652d 6669 6c65  form {image-file
+0000c180: 2d6e 616d 653a 7b66 6965 6c64 3a76 616c  -name:{field:val
+0000c190: 7565 7d2c 2e2e 2e7d 200a 2020 2020 2020  ue},...} .      
+0000c1a0: 2020 2222 220a 0a20 2020 2020 2020 2023    """..        #
+0000c1b0: 2057 6869 6368 2066 696c 6573 2063 6f6e   Which files con
+0000c1c0: 7461 696e 2074 6865 2069 6e66 6f72 6d61  tain the informa
+0000c1d0: 7469 6f6e 206e 6565 6465 6420 746f 2063  tion needed to c
+0000c1e0: 7265 6174 6520 7468 6520 6946 444f 2069  reate the iFDO i
+0000c1f0: 7465 6d73 2063 6f72 6520 696e 666f 726d  tems core inform
+0000c200: 6174 696f 6e20 616e 6420 7768 6963 6820  ation and which 
+0000c210: 636f 6c75 6d6e 7320 7368 616c 6c20 6265  columns shall be
+0000c220: 2075 7365 640a 2020 2020 2020 2020 7265   used.        re
+0000c230: 7120 3d20 7365 6c66 2e69 6e74 6572 6d65  q = self.interme
+0000c240: 6469 6174 6546 696c 6573 4465 665f 636f  diateFilesDef_co
+0000c250: 7265 0a0a 2020 2020 2020 2020 6974 656d  re..        item
+0000c260: 5f64 6174 6120 3d20 7b7d 0a20 2020 2020  _data = {}.     
+0000c270: 2020 2070 726f 6720 3d20 6d69 7174 632e     prog = miqtc.
+0000c280: 5072 696e 744b 6e6f 776e 5072 6f67 7265  PrintKnownProgre
+0000c290: 7373 4d73 6728 2250 6172 7369 6e67 2069  ssMsg("Parsing i
+0000c2a0: 6e74 6572 6d65 6469 6174 6520 6461 7461  ntermediate data
+0000c2b0: 222c 206c 656e 2872 6571 2929 0a20 2020  ", len(req)).   
+0000c2c0: 2020 2020 2066 6f72 2072 2069 6e20 7265       for r in re
+0000c2d0: 713a 0a20 2020 2020 2020 2020 2020 2070  q:.            p
+0000c2e0: 726f 672e 7072 6f67 7265 7373 2829 0a20  rog.progress(). 
+0000c2f0: 2020 2020 2020 2020 2020 2066 696c 6520             file 
+0000c300: 3d20 7365 6c66 2e5f 5f67 6574 5f69 6e74  = self.__get_int
+0000c310: 5f66 696c 655f 7072 6566 6978 2829 202b  _file_prefix() +
+0000c320: 2072 6571 5b72 5d5b 2773 7566 6669 7827   req[r]['suffix'
+0000c330: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
+0000c340: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
+0000c350: 7374 7328 6669 6c65 293a 0a20 2020 2020  sts(file):.     
+0000c360: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000c370: 7072 6f76 2e6c 6f67 2822 5741 524e 494e  prov.log("WARNIN
+0000c380: 4721 2046 6f72 2061 6368 6965 7669 6e67  G! For achieving
+0000c390: 2046 4149 526e 6573 7320 616e 2069 6e74   FAIRness an int
+0000c3a0: 6572 6d65 6469 6174 6520 696d 6167 6520  ermediate image 
+0000c3b0: 696e 666f 2066 696c 6520 6973 206d 6973  info file is mis
+0000c3c0: 7369 6e67 3a20 222b 2073 656c 662e 5f5f  sing: "+ self.__
+0000c3d0: 6765 745f 696e 745f 6669 6c65 5f70 7265  get_int_file_pre
+0000c3e0: 6669 7828 2920 2b20 7265 715b 725d 5b27  fix() + req[r]['
+0000c3f0: 7375 6666 6978 275d 2b20 2220 7275 6e20  suffix']+ " run 
+0000c400: 6669 7273 743a 2022 202b 2072 6571 5b72  first: " + req[r
+0000c410: 5d5b 2763 7265 6174 696f 6e46 6374 275d  ]['creationFct']
+0000c420: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+0000c430: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000c440: 2020 2020 7365 6c66 2e70 6172 7365 4974      self.parseIt
+0000c450: 656d 4461 7461 6672 6f6d 5461 6246 696c  emDatafromTabFil
+0000c460: 6544 6174 6128 6974 656d 5f64 6174 612c  eData(item_data,
+0000c470: 2066 696c 652c 2072 6571 5b72 5d5b 2763   file, req[r]['c
+0000c480: 6f6c 7327 5d2c 2072 6571 5b72 5d5b 276f  ols'], req[r]['o
+0000c490: 7074 696f 6e61 6c27 5d29 0a20 2020 2020  ptional']).     
+0000c4a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000c4b0: 7072 6f76 2e6c 6f67 2822 5061 7273 6564  prov.log("Parsed
+0000c4c0: 2069 7465 6d20 6461 7461 2066 726f 6d3a   item data from:
+0000c4d0: 2022 202b 2066 696c 6529 0a0a 2020 2020   " + file)..    
+0000c4e0: 2020 2020 7072 6f67 2e63 6c65 6172 2829      prog.clear()
+0000c4f0: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+0000c500: 6974 656d 5f64 6174 6129 203d 3d20 303a  item_data) == 0:
+0000c510: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000c520: 7365 2045 7863 6570 7469 6f6e 2822 4e6f  se Exception("No
+0000c530: 2069 4644 4f20 6974 656d 7322 290a 0a20   iFDO items").. 
+0000c540: 2020 2020 2020 2023 2063 6865 636b 2066         # check f
+0000c550: 696c 6573 2065 7869 7374 0a20 2020 2020  iles exist.     
+0000c560: 2020 2072 656d 6f76 6520 3d20 5b5d 0a20     remove = []. 
+0000c570: 2020 2020 2020 2066 6f72 2069 6d67 2069         for img i
+0000c580: 6e20 6974 656d 5f64 6174 613a 0a20 2020  n item_data:.   
+0000c590: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0000c5a0: 696d 6720 696e 2073 656c 662e 5f69 6d61  img in self._ima
+0000c5b0: 6765 4e61 6d65 7349 6d61 6765 7344 6972  geNamesImagesDir
+0000c5c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000c5d0: 2020 7265 6d6f 7665 2e61 7070 656e 6428    remove.append(
+0000c5e0: 696d 6729 0a20 2020 2020 2020 2066 6f72  img).        for
+0000c5f0: 2069 6d67 2069 6e20 7265 6d6f 7665 3a0a   img in remove:.
+0000c600: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
+0000c610: 6974 656d 5f64 6174 615b 696d 675d 0a0a  item_data[img]..
+0000c620: 2020 2020 2020 2020 2320 6164 6420 696d          # add im
+0000c630: 6167 652d 7572 6c0a 2020 2020 2020 2020  age-url.        
+0000c640: 666f 7220 696d 6720 696e 2069 7465 6d5f  for img in item_
+0000c650: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
+0000c660: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0000c670: 6974 656d 5f64 6174 615b 696d 675d 2c6c  item_data[img],l
+0000c680: 6973 7429 3a20 2320 6974 656d 2069 7320  ist): # item is 
+0000c690: 616c 7265 6164 7920 6120 6c69 7374 2028  already a list (
+0000c6a0: 7669 6465 6f29 2062 7574 2070 6172 7365  video) but parse
+0000c6b0: 6420 6461 7461 2069 7320 6e6f 742c 2069  d data is not, i
+0000c6c0: 2e65 2e20 7061 7273 6564 2064 6174 6120  .e. parsed data 
+0000c6d0: 7265 6665 7273 2074 6f20 7768 6f6c 6520  refers to whole 
+0000c6e0: 7669 6465 6f20 2874 696d 6520 696e 6465  video (time inde
+0000c6f0: 7065 6e64 656e 7429 2c20 692e 652e 2077  pendent), i.e. w
+0000c700: 7269 7465 2074 6f20 6669 7273 7420 656e  rite to first en
+0000c710: 7472 790a 2020 2020 2020 2020 2020 2020  try.            
+0000c720: 2020 2020 7575 6964 203d 2066 696e 6446      uuid = findF
+0000c730: 6965 6c64 2869 7465 6d5f 6461 7461 5b69  ield(item_data[i
+0000c740: 6d67 5d5b 305d 2c27 696d 6167 652d 7575  mg][0],'image-uu
+0000c750: 6964 2729 0a20 2020 2020 2020 2020 2020  id').           
+0000c760: 2020 2020 2069 6620 7575 6964 203d 3d20       if uuid == 
+0000c770: 2222 3a0a 2020 2020 2020 2020 2020 2020  "":.            
+0000c780: 2020 2020 2020 2020 7072 696e 7428 6974          print(it
+0000c790: 656d 5f64 6174 615b 696d 675d 290a 2020  em_data[img]).  
+0000c7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c7b0: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
+0000c7c0: 646f 4578 6365 7074 696f 6e28 2275 7569  doException("uui
+0000c7d0: 6420 6e6f 7420 666f 756e 6420 2861 2922  d not found (a)"
+0000c7e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000c7f0: 2020 6974 656d 5f64 6174 615b 696d 675d    item_data[img]
+0000c800: 5b30 5d5b 2769 6d61 6765 2d68 616e 646c  [0]['image-handl
+0000c810: 6527 5d20 3d20 7365 6c66 2e69 6d61 6765  e'] = self.image
+0000c820: 5f68 616e 646c 655f 7072 6566 6978 202b  _handle_prefix +
+0000c830: 2027 4027 202b 2075 7569 640a 2020 2020   '@' + uuid.    
+0000c840: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000c850: 2020 2020 2020 2020 2020 2020 2020 7575                uu
+0000c860: 6964 203d 2066 696e 6446 6965 6c64 2869  id = findField(i
+0000c870: 7465 6d5f 6461 7461 5b69 6d67 5d2c 2769  tem_data[img],'i
+0000c880: 6d61 6765 2d75 7569 6427 290a 2020 2020  mage-uuid').    
+0000c890: 2020 2020 2020 2020 2020 2020 6966 2075              if u
+0000c8a0: 7569 6420 3d3d 2022 223a 0a20 2020 2020  uid == "":.     
+0000c8b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000c8c0: 6169 7365 206d 6971 7463 2e49 6664 6f45  aise miqtc.IfdoE
+0000c8d0: 7863 6570 7469 6f6e 2822 7575 6964 206e  xception("uuid n
+0000c8e0: 6f74 2066 6f75 6e64 2028 6229 2229 0a20  ot found (b)"). 
+0000c8f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000c900: 7465 6d5f 6461 7461 5b69 6d67 5d5b 2769  tem_data[img]['i
+0000c910: 6d61 6765 2d68 616e 646c 6527 5d20 3d20  mage-handle'] = 
+0000c920: 7365 6c66 2e69 6d61 6765 5f68 616e 646c  self.image_handl
+0000c930: 655f 7072 6566 6978 202b 2027 4027 202b  e_prefix + '@' +
+0000c940: 2075 7569 640a 0a20 2020 2020 2020 2072   uuid..        r
+0000c950: 6574 7572 6e20 6974 656d 5f64 6174 610a  eturn item_data.
+0000c960: 0a0a 2020 2020 6465 6620 6164 6449 7465  ..    def addIte
+0000c970: 6d49 6e66 6f54 6162 4669 6c65 2873 656c  mInfoTabFile(sel
+0000c980: 662c 2066 696c 654e 616d 653a 2073 7472  f, fileName: str
+0000c990: 2c20 7365 7061 7261 746f 723a 7374 722c  , separator:str,
+0000c9a0: 2068 6561 6465 723a 6469 6374 293a 0a20   header:dict):. 
+0000c9b0: 2020 2020 2020 2022 2222 2041 6464 2061         """ Add a
+0000c9c0: 2074 6162 2073 6570 6572 6174 6564 2074   tab seperated t
+0000c9d0: 6578 7420 6669 6c65 2074 6f20 7061 7273  ext file to pars
+0000c9e0: 6520 6974 656d 2064 6174 6120 6672 6f6d  e item data from
+0000c9f0: 2062 7920 6372 6561 7465 4361 7074 7572   by createCaptur
+0000ca00: 6541 6e64 436f 6e74 656e 7446 6965 6c64  eAndContentField
+0000ca10: 7328 292e 200a 2020 2020 2020 2020 436f  s(). .        Co
+0000ca20: 6c75 6d6e 7320 6865 6164 6572 7320 7769  lumns headers wi
+0000ca30: 6c6c 2062 6520 7365 7420 6173 2069 7465  ll be set as ite
+0000ca40: 6d20 6669 656c 6420 6e61 6d65 732e 204d  m field names. M
+0000ca50: 7573 7420 636f 6e74 6169 6e20 636f 6c75  ust contain colu
+0000ca60: 6d6e 2027 696d 6167 652d 6669 6c65 6e61  mn 'image-filena
+0000ca70: 6d65 272e 0a20 2020 2020 2020 2022 2222  me'..        """
+0000ca80: 0a20 2020 2020 2020 2069 6620 6669 6c65  .        if file
+0000ca90: 4e61 6d65 203d 3d20 4e6f 6e65 206f 7220  Name == None or 
+0000caa0: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
+0000cab0: 7473 2866 696c 654e 616d 6529 3a0a 2020  ts(fileName):.  
+0000cac0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000cad0: 4578 6365 7074 696f 6e28 2246 696c 6522  Exception("File"
+0000cae0: 2c66 696c 654e 616d 652c 226e 6f74 2066  ,fileName,"not f
+0000caf0: 6f75 6e64 2229 0a0a 2020 2020 2020 2020  ound")..        
+0000cb00: 666f 7220 6669 656c 6420 696e 2068 6561  for field in hea
+0000cb10: 6465 723a 0a20 2020 2020 2020 2020 2020  der:.           
+0000cb20: 2069 6620 6865 6164 6572 5b66 6965 6c64   if header[field
+0000cb30: 5d20 6e6f 7420 696e 206d 6971 7466 2e74  ] not in miqtf.t
+0000cb40: 6162 4669 6c65 436f 6c75 6d6e 4e61 6d65  abFileColumnName
+0000cb50: 7328 6669 6c65 4e61 6d65 2c63 6f6c 5f73  s(fileName,col_s
+0000cb60: 6570 6172 6174 6f72 3d73 6570 6172 6174  eparator=separat
+0000cb70: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
+0000cb80: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
+0000cb90: 7469 6f6e 2822 436f 6c75 6d6e 222c 2068  tion("Column", h
+0000cba0: 6561 6465 725b 6669 656c 645d 2c20 226e  eader[field], "n
+0000cbb0: 6f74 2069 6e20 6669 6c65 222c 2066 696c  ot in file", fil
+0000cbc0: 654e 616d 6529 0a0a 2020 2020 2020 2020  eName)..        
+0000cbd0: 6966 206d 6971 7463 2e61 7373 6572 7453  if miqtc.assertS
+0000cbe0: 6c61 7368 286f 732e 7061 7468 2e64 6972  lash(os.path.dir
+0000cbf0: 6e61 6d65 2866 696c 654e 616d 6529 2920  name(fileName)) 
+0000cc00: 213d 206d 6971 7463 2e61 7373 6572 7453  != miqtc.assertS
+0000cc10: 6c61 7368 2873 656c 662e 6469 722e 746f  lash(self.dir.to
+0000cc20: 2873 656c 662e 6469 722e 6474 2e69 6e74  (self.dir.dt.int
+0000cc30: 6572 6d65 6469 6174 6529 293a 0a20 2020  ermediate)):.   
+0000cc40: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+0000cc50: 6f76 2e6c 6f67 2820 2243 6175 7469 6f6e  ov.log( "Caution
+0000cc60: 3a20 4974 2069 7320 7265 636f 6d6d 656e  : It is recommen
+0000cc70: 6465 6420 746f 2070 7574 2066 696c 6520  ded to put file 
+0000cc80: 696e 2074 6865 2064 6972 6563 746f 7279  in the directory
+0000cc90: 2773 2027 696e 7465 726d 6564 6961 7465  's 'intermediate
+0000cca0: 2720 666f 6c64 6572 3a20 2220 2b20 6669  ' folder: " + fi
+0000ccb0: 6c65 4e61 6d65 290a 2020 2020 2020 2020  leName).        
+0000ccc0: 6966 206e 6f6e 436f 7265 4669 656c 6449  if nonCoreFieldI
+0000ccd0: 6e74 6572 6d65 6469 6174 6549 7465 6d49  ntermediateItemI
+0000cce0: 6e66 6f46 696c 6528 6669 6c65 4e61 6d65  nfoFile(fileName
+0000ccf0: 2c20 7365 7061 7261 746f 722c 2068 6561  , separator, hea
+0000cd00: 6465 7229 206e 6f74 2069 6e20 7365 6c66  der) not in self
+0000cd10: 2e6e 6f6e 436f 7265 4669 656c 6449 6e74  .nonCoreFieldInt
+0000cd20: 6572 6d65 6469 6174 6549 7465 6d49 6e66  ermediateItemInf
+0000cd30: 6f46 696c 6573 3a20 0a20 2020 2020 2020  oFiles: .       
+0000cd40: 2020 2020 2073 656c 662e 6e6f 6e43 6f72       self.nonCor
+0000cd50: 6546 6965 6c64 496e 7465 726d 6564 6961  eFieldIntermedia
+0000cd60: 7465 4974 656d 496e 666f 4669 6c65 732e  teItemInfoFiles.
+0000cd70: 6170 7065 6e64 286e 6f6e 436f 7265 4669  append(nonCoreFi
+0000cd80: 656c 6449 6e74 6572 6d65 6469 6174 6549  eldIntermediateI
+0000cd90: 7465 6d49 6e66 6f46 696c 6528 6669 6c65  temInfoFile(file
+0000cda0: 4e61 6d65 2c20 7365 7061 7261 746f 722c  Name, separator,
+0000cdb0: 2068 6561 6465 7229 290a 0a20 2020 2020   header))..     
+0000cdc0: 2020 200a 2020 2020 6465 6620 7265 6d6f     .    def remo
+0000cdd0: 7665 4974 656d 496e 666f 5461 6246 696c  veItemInfoTabFil
+0000cde0: 6528 7365 6c66 2c20 6669 6c65 4e61 6d65  e(self, fileName
+0000cdf0: 3a20 7374 722c 2073 6570 6172 6174 6f72  : str, separator
+0000ce00: 3a73 7472 2c20 6865 6164 6572 3a64 6963  :str, header:dic
+0000ce10: 7429 3a0a 2020 2020 2020 2020 2222 2220  t):.        """ 
+0000ce20: 7265 6d6f 7665 7320 6669 6c65 2069 7465  removes file ite
+0000ce30: 6d20 6672 6f6d 206c 6973 7420 6f66 2066  m from list of f
+0000ce40: 696c 6573 2074 6f20 7061 7273 6520 6974  iles to parse it
+0000ce50: 656d 2064 6174 6120 6672 6f6d 2062 7920  em data from by 
+0000ce60: 6372 6561 7465 4361 7074 7572 6541 6e64  createCaptureAnd
+0000ce70: 436f 6e74 656e 7446 6965 6c64 7328 2920  ContentFields() 
+0000ce80: 2222 220a 2020 2020 2020 2020 6966 206e  """.        if n
+0000ce90: 6f6e 436f 7265 4669 656c 6449 6e74 6572  onCoreFieldInter
+0000cea0: 6d65 6469 6174 6549 7465 6d49 6e66 6f46  mediateItemInfoF
+0000ceb0: 696c 6528 6669 6c65 4e61 6d65 2c20 7365  ile(fileName, se
+0000cec0: 7061 7261 746f 722c 2068 6561 6465 7229  parator, header)
+0000ced0: 2069 6e20 7365 6c66 2e6e 6f6e 436f 7265   in self.nonCore
+0000cee0: 4669 656c 6449 6e74 6572 6d65 6469 6174  FieldIntermediat
+0000cef0: 6549 7465 6d49 6e66 6f46 696c 6573 3a20  eItemInfoFiles: 
+0000cf00: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000cf10: 662e 6e6f 6e43 6f72 6546 6965 6c64 496e  f.nonCoreFieldIn
+0000cf20: 7465 726d 6564 6961 7465 4974 656d 496e  termediateItemIn
+0000cf30: 666f 4669 6c65 732e 7265 6d6f 7665 286e  foFiles.remove(n
+0000cf40: 6f6e 436f 7265 4669 656c 6449 6e74 6572  onCoreFieldInter
+0000cf50: 6d65 6469 6174 6549 7465 6d49 6e66 6f46  mediateItemInfoF
+0000cf60: 696c 6528 6669 6c65 4e61 6d65 2c20 7365  ile(fileName, se
+0000cf70: 7061 7261 746f 722c 2068 6561 6465 7229  parator, header)
+0000cf80: 290a 0a0a 2020 2020 6465 6620 7570 6461  )...    def upda
+0000cf90: 7465 6946 444f 2873 656c 662c 2068 6561  teiFDO(self, hea
+0000cfa0: 6465 723a 2064 6963 742c 2069 7465 6d73  der: dict, items
+0000cfb0: 3a20 6c69 7374 293a 0a20 2020 2020 2020  : list):.       
+0000cfc0: 2022 2222 2055 7064 6174 6573 2074 6865   """ Updates the
+0000cfd0: 2063 7572 7265 6e74 2076 616c 7565 7320   current values 
+0000cfe0: 6946 444f 2077 6974 6820 7468 6520 7072  iFDO with the pr
+0000cff0: 6f76 6964 6564 206e 6577 2076 616c 7565  ovided new value
+0000d000: 7320 2222 220a 2020 2020 2020 2020 7265  s """.        re
+0000d010: 7475 726e 2073 656c 662e 6372 6561 7465  turn self.create
+0000d020: 6946 444f 2868 6561 6465 722c 2069 7465  iFDO(header, ite
+0000d030: 6d73 2c20 7570 6461 7465 4578 6973 7469  ms, updateExisti
+0000d040: 6e67 3d54 7275 6529 0a0a 0a20 2020 2064  ng=True)...    d
+0000d050: 6566 2063 7265 6174 6569 4644 4f28 7365  ef createiFDO(se
+0000d060: 6c66 2c20 6865 6164 6572 3a20 6469 6374  lf, header: dict
+0000d070: 2c20 6974 656d 733a 206c 6973 742c 2075  , items: list, u
+0000d080: 7064 6174 6545 7869 7374 696e 673d 4661  pdateExisting=Fa
+0000d090: 6c73 652c 6865 6164 6572 4f6e 6c79 3d46  lse,headerOnly=F
+0000d0a0: 616c 7365 293a 0a20 2020 2020 2020 2022  alse):.        "
+0000d0b0: 2222 2043 7265 6174 6573 2046 4149 5220  "" Creates FAIR 
+0000d0c0: 6469 6769 7461 6c20 6f62 6a65 6374 2066  digital object f
+0000d0d0: 6f72 2074 6865 2069 6d61 6765 2064 6174  or the image dat
+0000d0e0: 6120 6974 7365 6c66 2e20 5468 6973 2063  a itself. This c
+0000d0f0: 6f6e 7369 7374 7320 6f66 2068 6561 6465  onsists of heade
+0000d100: 7220 696e 666f 726d 6174 696f 6e20 616e  r information an
+0000d110: 6420 6974 656d 2069 6e66 6f72 6d61 7469  d item informati
+0000d120: 6f6e 2e20 2222 220a 0a20 2020 2020 2020  on. """..       
+0000d130: 2069 6620 6e6f 7420 7570 6461 7465 4578   if not updateEx
+0000d140: 6973 7469 6e67 2061 6e64 206c 656e 2869  isting and len(i
+0000d150: 7465 6d73 2920 3d3d 2030 2061 6e64 206e  tems) == 0 and n
+0000d160: 6f74 2068 6561 6465 724f 6e6c 793a 0a20  ot headerOnly:. 
+0000d170: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000d180: 2045 7863 6570 7469 6f6e 2827 4e6f 2069   Exception('No i
+0000d190: 7465 6d20 696e 666f 726d 6174 696f 6e20  tem information 
+0000d1a0: 6769 7665 6e27 290a 0a20 2020 2020 2020  given')..       
+0000d1b0: 2069 6620 7570 6461 7465 4578 6973 7469   if updateExisti
+0000d1c0: 6e67 3a0a 2020 2020 2020 2020 2020 2020  ng:.            
+0000d1d0: 2320 6865 6164 6572 0a20 2020 2020 2020  # header.       
+0000d1e0: 2020 2020 2073 656c 662e 7570 6461 7465       self.update
+0000d1f0: 6946 444f 4865 6164 6572 4669 656c 6473  iFDOHeaderFields
+0000d200: 2868 6561 6465 7229 0a20 2020 2020 2020  (header).       
+0000d210: 2020 2020 2023 2069 7465 6d73 0a20 2020       # items.   
+0000d220: 2020 2020 2020 2020 2023 2075 7064 6174           # updat
+0000d230: 6520 636f 7079 206f 6620 6375 7272 656e  e copy of curren
+0000d240: 7420 6974 656d 7320 7769 7468 206e 6577  t items with new
+0000d250: 2069 7465 6d73 2066 6965 6c64 730a 2020   items fields.  
+0000d260: 2020 2020 2020 2020 2020 6974 656d 7344            itemsD
+0000d270: 6963 7420 3d20 6d69 7174 692e 6372 6561  ict = miqti.crea
+0000d280: 7465 496d 6167 6549 7465 6d73 4469 6374  teImageItemsDict
+0000d290: 4672 6f6d 496d 6167 6549 7465 6d73 4c69  FromImageItemsLi
+0000d2a0: 7374 2869 7465 6d73 290a 2020 2020 2020  st(items).      
+0000d2b0: 2020 2020 2020 7570 6461 7465 6449 7465        updatedIte
+0000d2c0: 6d73 5f63 6f70 7920 3d20 636f 7079 2e64  ms_copy = copy.d
+0000d2d0: 6565 7063 6f70 7928 7365 6c66 2e69 6664  eepcopy(self.ifd
+0000d2e0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
+0000d2f0: 5365 7449 7465 6d73 4b65 795d 290a 2020  SetItemsKey]).  
+0000d300: 2020 2020 2020 2020 2020 6c6f 6720 3d20            log = 
+0000d310: 6d69 7174 632e 7265 6375 7273 6976 656c  miqtc.recursivel
+0000d320: 7955 7064 6174 6544 6963 7473 2875 7064  yUpdateDicts(upd
+0000d330: 6174 6564 4974 656d 735f 636f 7079 2c20  atedItems_copy, 
+0000d340: 6974 656d 7344 6963 742c 206d 6971 7476  itemsDict, miqtv
+0000d350: 2e69 6664 6f5f 6d75 7475 616c 6c79 5f65  .ifdo_mutually_e
+0000d360: 7863 6c75 7369 7665 5f66 6965 6c64 7329  xclusive_fields)
+0000d370: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000d380: 662e 7072 6f76 2e6c 6f67 286c 6f67 2c64  f.prov.log(log,d
+0000d390: 6f6e 7453 686f 773d 5472 7565 290a 2020  ontShow=True).  
+0000d3a0: 2020 2020 2020 2020 2020 6974 656d 7320            items 
+0000d3b0: 3d20 6d69 7174 692e 6372 6561 7465 496d  = miqti.createIm
+0000d3c0: 6167 6549 7465 6d73 4c69 7374 4672 6f6d  ageItemsListFrom
+0000d3d0: 496d 6167 6549 7465 6d73 4469 6374 2875  ImageItemsDict(u
+0000d3e0: 7064 6174 6564 4974 656d 735f 636f 7079  pdatedItems_copy
+0000d3f0: 290a 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
+0000d400: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000d410: 662e 7365 7469 4644 4f48 6561 6465 7246  f.setiFDOHeaderF
+0000d420: 6965 6c64 7328 6865 6164 6572 290a 0a20  ields(header).. 
+0000d430: 2020 2020 2020 2023 2050 6172 7365 2069         # Parse i
+0000d440: 6d61 6765 2d61 6273 7472 6163 7420 616e  mage-abstract an
+0000d450: 6420 6669 6c6c 2069 7473 2070 6c61 6365  d fill its place
+0000d460: 686f 6c64 6572 7320 7769 7468 2069 6e66  holders with inf
+0000d470: 6f72 6d61 7469 6f6e 0a20 2020 2020 2020  ormation.       
+0000d480: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+0000d490: 2020 7365 6c66 2e69 6664 6f5f 746d 705b    self.ifdo_tmp[
+0000d4a0: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0000d4b0: 6465 724b 6579 5d5b 2769 6d61 6765 2d61  derKey]['image-a
+0000d4c0: 6273 7472 6163 7427 5d20 3d20 6d69 7174  bstract'] = miqt
+0000d4d0: 732e 7061 7273 6552 6570 6c61 6365 5661  s.parseReplaceVa
+0000d4e0: 6c28 7365 6c66 2e69 6664 6f5f 746d 705b  l(self.ifdo_tmp[
+0000d4f0: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0000d500: 6465 724b 6579 5d2c 2027 696d 6167 652d  derKey], 'image-
+0000d510: 6162 7374 7261 6374 2729 0a20 2020 2020  abstract').     
+0000d520: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+0000d530: 696f 6e20 6173 2065 783a 0a20 2020 2020  ion as ex:.     
+0000d540: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+0000d550: 2e6c 6f67 2822 436f 756c 6420 6e6f 7420  .log("Could not 
+0000d560: 7265 706c 6163 6520 6b65 7973 2069 6e20  replace keys in 
+0000d570: 5c27 696d 6167 652d 6162 7374 7261 6374  \'image-abstract
+0000d580: 5c27 3a20 2220 2b20 7374 7228 6578 2929  \': " + str(ex))
+0000d590: 0a0a 0a20 2020 2020 2020 2023 2073 6574  ...        # set
+0000d5a0: 2076 6572 7369 6f6e 2028 736f 2069 7420   version (so it 
+0000d5b0: 6361 6e6e 6f74 2062 6520 6368 616e 6765  cannot be change
+0000d5c0: 6420 6279 2075 7365 7229 0a20 2020 2020  d by user).     
+0000d5d0: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
+0000d5e0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+0000d5f0: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
+0000d600: 7365 742d 6966 646f 2d76 6572 7369 6f6e  set-ifdo-version
+0000d610: 275d 203d 206d 6971 7476 2e69 4644 4f5f  '] = miqtv.iFDO_
+0000d620: 7665 7273 696f 6e0a 0a20 2020 2020 2020  version..       
+0000d630: 2023 2056 616c 6964 6174 6520 6974 656d   # Validate item
+0000d640: 2069 6e66 6f72 6d61 7469 6f6e 0a20 2020   information.   
+0000d650: 2020 2020 2069 6e76 616c 6964 5f69 7465       invalid_ite
+0000d660: 6d73 203d 2030 0a20 2020 2020 2020 2069  ms = 0.        i
+0000d670: 6d61 6765 5f73 6574 5f69 7465 6d73 203d  mage_set_items =
+0000d680: 207b 7d0a 0a20 2020 2020 2020 2073 656c   {}..        sel
+0000d690: 662e 6d69 7373 696e 6746 6965 6c64 7346  f.missingFieldsF
+0000d6a0: 6f72 4661 6972 6e65 7373 203d 205b 5d0a  orFairness = [].
+0000d6b0: 2020 2020 2020 2020 7072 6f67 203d 206d          prog = m
+0000d6c0: 6971 7463 2e50 7269 6e74 4b6e 6f77 6e50  iqtc.PrintKnownP
+0000d6d0: 726f 6772 6573 734d 7367 2822 4368 6563  rogressMsg("Chec
+0000d6e0: 6b69 6e67 2069 7465 6d73 222c 206c 656e  king items", len
+0000d6f0: 2869 7465 6d73 292c 6d6f 6475 6c6f 3d35  (items),modulo=5
+0000d700: 290a 2020 2020 2020 2020 666f 7220 6974  ).        for it
+0000d710: 656d 2069 6e20 6974 656d 733a 0a20 2020  em in items:.   
+0000d720: 2020 2020 2020 2020 2070 726f 672e 7072           prog.pr
+0000d730: 6f67 7265 7373 2829 0a20 2020 2020 2020  ogress().       
+0000d740: 2020 2020 2023 2063 6865 636b 2069 6620       # check if 
+0000d750: 616c 6c20 636f 7265 2066 6965 6c64 7320  all core fields 
+0000d760: 6172 6520 6669 6c6c 6564 2061 6e64 2061  are filled and a
+0000d770: 7265 2066 696c 6c65 6420 7661 6c69 646c  re filled validl
+0000d780: 790a 2020 2020 2020 2020 2020 2020 7472  y.            tr
+0000d790: 793a 0a0a 2020 2020 2020 2020 2020 2020  y:..            
+0000d7a0: 2020 2020 2320 6368 6563 6b20 6974 656d      # check item
+0000d7b0: 2069 6d61 6765 2065 7869 7374 730a 2020   image exists.  
+0000d7c0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000d7d0: 6966 2069 7465 6d20 6973 2061 206c 6973  if item is a lis
+0000d7e0: 7420 2876 6964 656f 292c 206f 6e65 2077  t (video), one w
+0000d7f0: 6f75 6c64 2068 6176 6520 746f 2063 6865  ould have to che
+0000d800: 636b 2069 6620 6561 6368 2065 6e74 7279  ck if each entry
+0000d810: 2069 7320 7661 6c69 6420 6769 7665 6e20   is valid given 
+0000d820: 7468 6520 6465 6661 756c 7420 7661 6c75  the default valu
+0000d830: 6573 2069 6e20 6669 7273 7420 656e 7472  es in first entr
+0000d840: 7920 706c 7573 2067 6976 656e 2064 6566  y plus given def
+0000d850: 6175 6c74 2076 616c 7565 7320 696e 2068  ault values in h
+0000d860: 6561 6465 720a 2020 2020 2020 2020 2020  eader.          
+0000d870: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+0000d880: 6e73 7461 6e63 6528 6974 656d 2c6c 6973  nstance(item,lis
+0000d890: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+0000d8a0: 2020 2020 2020 2020 6974 656d 203d 205b          item = [
+0000d8b0: 6974 656d 5d0a 2020 2020 2020 2020 2020  item].          
+0000d8c0: 2020 2020 2020 7375 6249 7465 6d44 6566        subItemDef
+0000d8d0: 6175 6c74 203d 2069 7465 6d5b 305d 200a  ault = item[0] .
+0000d8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d8f0: 666f 7220 7375 6249 7465 6d20 696e 2069  for subItem in i
+0000d900: 7465 6d3a 0a20 2020 2020 2020 2020 2020  tem:.           
+0000d910: 2020 2020 2020 2020 2069 6620 7375 6249           if subI
+0000d920: 7465 6d5b 2769 6d61 6765 2d66 696c 656e  tem['image-filen
+0000d930: 616d 6527 5d20 6e6f 7420 696e 2073 656c  ame'] not in sel
+0000d940: 662e 5f69 6d61 6765 4e61 6d65 7349 6d61  f._imageNamesIma
+0000d950: 6765 7344 6972 3a0a 2020 2020 2020 2020  gesDir:.        
+0000d960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d970: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
+0000d980: 2249 7465 6d20 2722 202b 2073 7562 4974  "Item '" + subIt
+0000d990: 656d 5b27 696d 6167 652d 6669 6c65 6e61  em['image-filena
+0000d9a0: 6d65 275d 202b 2022 2720 6e6f 7420 666f  me'] + "' not fo
+0000d9b0: 756e 6420 696e 202f 7261 7720 6469 7265  und in /raw dire
+0000d9c0: 6374 6f72 792e 2229 0a0a 2020 2020 2020  ctory.")..      
+0000d9d0: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
+0000d9e0: 7373 696e 6720 3d20 6d69 7174 742e 6973  ssing = miqtt.is
+0000d9f0: 5661 6c69 6469 4644 4f49 7465 6d28 7375  ValidiFDOItem(su
+0000da00: 6249 7465 6d2c 207b 2a2a 7365 6c66 2e69  bItem, {**self.i
+0000da10: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
+0000da20: 6765 5365 7448 6561 6465 724b 6579 5d2c  geSetHeaderKey],
+0000da30: 202a 2a73 7562 4974 656d 4465 6661 756c   **subItemDefaul
+0000da40: 747d 290a 2020 2020 2020 2020 2020 2020  t}).            
+0000da50: 2020 2020 2020 2020 6966 206c 656e 286d          if len(m
+0000da60: 6973 7369 6e67 2920 213d 2030 3a0a 2020  issing) != 0:.  
+0000da70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000da80: 2020 2020 2020 7365 6c66 2e6d 6973 7369        self.missi
+0000da90: 6e67 4669 656c 6473 466f 7246 6169 726e  ngFieldsForFairn
+0000daa0: 6573 732e 6170 7065 6e64 2873 7562 4974  ess.append(subIt
+0000dab0: 656d 5b27 696d 6167 652d 6669 6c65 6e61  em['image-filena
+0000dac0: 6d65 275d 202b 2022 2022 202b 2073 7562  me'] + " " + sub
+0000dad0: 4974 656d 5b27 696d 6167 652d 6461 7465  Item['image-date
+0000dae0: 7469 6d65 275d 202b 2022 3a20 2220 2b20  time'] + ": " + 
+0000daf0: 7374 7228 6d69 7373 696e 6729 290a 2020  str(missing)).  
+0000db00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000db10: 2020 0a0a 2020 2020 2020 2020 2020 2020    ..            
+0000db20: 2020 2020 696d 6167 655f 7365 745f 6974      image_set_it
+0000db30: 656d 735b 7375 6249 7465 6d44 6566 6175  ems[subItemDefau
+0000db40: 6c74 5b27 696d 6167 652d 6669 6c65 6e61  lt['image-filena
+0000db50: 6d65 275d 5d20 3d20 5b5d 2023 2063 6f75  me']] = [] # cou
+0000db60: 6c64 206d 616b 6520 616e 2065 7874 7261  ld make an extra
+0000db70: 2063 6173 6520 666f 7220 696d 6167 6573   case for images
+0000db80: 206f 6d69 7474 696e 6720 7468 6520 6c69   omitting the li
+0000db90: 7374 0a20 2020 2020 2020 2020 2020 2020  st.             
+0000dba0: 2020 2066 6f72 2073 7562 4974 656d 2069     for subItem i
+0000dbb0: 6e20 6974 656d 3a0a 2020 2020 2020 2020  n item:.        
+0000dbc0: 2020 2020 2020 2020 2020 2020 7375 6249              subI
+0000dbd0: 7465 6d44 6963 7420 3d20 7b7d 0a20 2020  temDict = {}.   
+0000dbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dbf0: 2066 6f72 2069 7420 696e 2073 7562 4974   for it in subIt
+0000dc00: 656d 3a0a 2020 2020 2020 2020 2020 2020  em:.            
+0000dc10: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+0000dc20: 7420 213d 2027 696d 6167 652d 6669 6c65  t != 'image-file
+0000dc30: 6e61 6d65 273a 0a20 2020 2020 2020 2020  name':.         
+0000dc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc50: 2020 2073 7562 4974 656d 4469 6374 5b69     subItemDict[i
+0000dc60: 745d 203d 2073 7562 4974 656d 5b69 745d  t] = subItem[it]
+0000dc70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dc80: 2020 2020 2069 6d61 6765 5f73 6574 5f69       image_set_i
+0000dc90: 7465 6d73 5b73 7562 4974 656d 4465 6661  tems[subItemDefa
+0000dca0: 756c 745b 2769 6d61 6765 2d66 696c 656e  ult['image-filen
+0000dcb0: 616d 6527 5d5d 2e61 7070 656e 6428 7375  ame']].append(su
+0000dcc0: 6249 7465 6d44 6963 7429 0a20 2020 2020  bItemDict).     
+0000dcd0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0000dce0: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+0000dcf0: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
+0000dd00: 2020 2020 2020 2020 2020 2069 6e76 616c             inval
+0000dd10: 6964 5f69 7465 6d73 202b 3d20 310a 2020  id_items += 1.  
+0000dd20: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000dd30: 6c66 2e70 726f 762e 6c6f 6728 2249 6e76  lf.prov.log("Inv
+0000dd40: 616c 6964 2069 6d61 6765 2069 7465 6d3a  alid image item:
+0000dd50: 2022 2b20 7374 7228 6974 656d 292c 646f   "+ str(item),do
+0000dd60: 6e74 5368 6f77 3d54 7275 6529 0a20 2020  ntShow=True).   
+0000dd70: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000dd80: 662e 7072 6f76 2e6c 6f67 2822 4578 6365  f.prov.log("Exce
+0000dd90: 7074 696f 6e3a 5c6e 222b 2073 7472 2865  ption:\n"+ str(e
+0000dda0: 2e61 7267 7329 2c64 6f6e 7453 686f 773d  .args),dontShow=
+0000ddb0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+0000ddc0: 2020 2020 2020 7261 6973 6520 6d69 7174        raise miqt
+0000ddd0: 632e 4966 646f 4578 6365 7074 696f 6e28  c.IfdoException(
+0000dde0: 2249 6e76 616c 6964 2069 6d61 6765 2069  "Invalid image i
+0000ddf0: 7465 6d3a 2022 2b20 7374 7228 6974 656d  tem: "+ str(item
+0000de00: 2920 2b20 225c 6e45 7863 6570 7469 6f6e  ) + "\nException
+0000de10: 3a5c 6e22 2b20 7374 7228 652e 6172 6773  :\n"+ str(e.args
+0000de20: 2929 2023 206f 7468 6572 7769 7365 2c20  )) # otherwise, 
+0000de30: 696e 2063 6173 6520 6f66 206d 616e 7920  in case of many 
+0000de40: 696d 6167 6573 2c20 6974 206d 6179 206b  images, it may k
+0000de50: 6565 7020 7275 6e6e 696e 6720 616e 6420  eep running and 
+0000de60: 7468 726f 7769 6e67 2065 7272 6f72 7320  throwing errors 
+0000de70: 666f 7220 7175 6974 2073 6f6d 6520 7469  for quit some ti
+0000de80: 6d65 0a20 2020 2020 2020 2070 726f 672e  me.        prog.
+0000de90: 636c 6561 7228 290a 0a20 2020 2020 2020  clear()..       
+0000dea0: 2069 6620 6c65 6e28 6974 656d 7329 2021   if len(items) !
+0000deb0: 3d20 3020 616e 6420 696e 7661 6c69 645f  = 0 and invalid_
+0000dec0: 6974 656d 7320 3d3d 206c 656e 2869 7465  items == len(ite
+0000ded0: 6d73 293a 0a20 2020 2020 2020 2020 2020  ms):.           
+0000dee0: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
+0000def0: 2822 416c 6c20 6974 656d 7320 6172 6520  ("All items are 
+0000df00: 696e 7661 6c69 6422 290a 2020 2020 2020  invalid").      
+0000df10: 2020 656c 6966 2069 6e76 616c 6964 5f69    elif invalid_i
+0000df20: 7465 6d73 203e 2030 3a0a 2020 2020 2020  tems > 0:.      
+0000df30: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
+0000df40: 6c6f 6728 2241 7420 6c65 6173 7420 2220  log("At least " 
+0000df50: 2b20 7374 7228 696e 7661 6c69 645f 6974  + str(invalid_it
+0000df60: 656d 7329 202b 2022 2069 7465 6d73 2077  ems) + " items w
+0000df70: 6572 6520 696e 7661 6c69 6420 286f 6622  ere invalid (of"
+0000df80: 202b 2073 7472 286c 656e 2869 7465 6d73   + str(len(items
+0000df90: 2929 2b20 2229 2229 0a0a 2020 2020 2020  ))+ ")")..      
+0000dfa0: 2020 2320 5661 6c69 6461 7465 2068 6561    # Validate hea
+0000dfb0: 6465 7220 696e 666f 726d 6174 696f 6e0a  der information.
+0000dfc0: 2020 2020 2020 2020 7365 6c66 2e6d 6973          self.mis
+0000dfd0: 7369 6e67 4669 656c 6473 466f 7246 6169  singFieldsForFai
+0000dfe0: 726e 6573 7320 2b3d 206d 6971 7474 2e69  rness += miqtt.i
+0000dff0: 7356 616c 6964 6946 444f 436f 7265 4865  sValidiFDOCoreHe
+0000e000: 6164 6572 2873 656c 662e 6966 646f 5f74  ader(self.ifdo_t
+0000e010: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
+0000e020: 4865 6164 6572 4b65 795d 2923 2c20 616c  HeaderKey])#, al
+0000e030: 6c5f 6974 656d 735f 6861 7665 290a 2020  l_items_have).  
+0000e040: 2020 2020 2020 7365 6c66 2e6c 6f67 4d69        self.logMi
+0000e050: 7373 696e 6746 6965 6c64 7328 290a 0a0a  ssingFields()...
+0000e060: 2020 2020 2020 2020 7320 3d20 6d69 7174          s = miqt
+0000e070: 632e 5072 696e 744c 6f61 6469 6e67 4d73  c.PrintLoadingMs
+0000e080: 6728 2255 7064 6174 696e 6722 290a 2020  g("Updating").  
+0000e090: 2020 2020 2020 6c6f 6720 3d20 6d69 7174        log = miqt
+0000e0a0: 632e 7265 6375 7273 6976 656c 7955 7064  c.recursivelyUpd
+0000e0b0: 6174 6544 6963 7473 2873 656c 662e 6966  ateDicts(self.if
+0000e0c0: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+0000e0d0: 6553 6574 4974 656d 734b 6579 5d2c 2069  eSetItemsKey], i
+0000e0e0: 6d61 6765 5f73 6574 5f69 7465 6d73 2c20  mage_set_items, 
+0000e0f0: 6d69 7174 762e 6966 646f 5f6d 7574 7561  miqtv.ifdo_mutua
+0000e100: 6c6c 795f 6578 636c 7573 6976 655f 6669  lly_exclusive_fi
+0000e110: 656c 6473 290a 2020 2020 2020 2020 732e  elds).        s.
+0000e120: 7374 6f70 2829 0a20 2020 2020 2020 2073  stop().        s
+0000e130: 656c 662e 7072 6f76 2e6c 6f67 286c 6f67  elf.prov.log(log
+0000e140: 290a 0a20 2020 2020 2020 2023 2072 656d  )..        # rem
+0000e150: 6f76 6520 656d 7470 7920 6669 656c 6473  ove emtpy fields
+0000e160: 0a20 2020 2020 2020 2073 203d 206d 6971  .        s = miq
+0000e170: 7463 2e50 7269 6e74 4c6f 6164 696e 674d  tc.PrintLoadingM
+0000e180: 7367 2822 5265 6d6f 7669 6e67 2065 6d70  sg("Removing emp
+0000e190: 7479 2066 6965 6c64 7322 290a 2020 2020  ty fields").    
+0000e1a0: 2020 2020 7365 6c66 2e69 6664 6f5f 746d      self.ifdo_tm
+0000e1b0: 7020 3d20 6d69 7174 632e 7265 6375 7273  p = miqtc.recurs
+0000e1c0: 6976 656c 7952 656d 6f76 6545 6d70 7479  ivelyRemoveEmpty
+0000e1d0: 4669 656c 6473 2873 656c 662e 6966 646f  Fields(self.ifdo
+0000e1e0: 5f74 6d70 290a 2020 2020 2020 2020 6966  _tmp).        if
+0000e1f0: 206e 6f74 2073 656c 662e 696d 6167 6553   not self.imageS
+0000e200: 6574 4974 656d 734b 6579 2069 6e20 7365  etItemsKey in se
+0000e210: 6c66 2e69 6664 6f5f 746d 703a 0a20 2020  lf.ifdo_tmp:.   
+0000e220: 2020 2020 2020 2020 2073 656c 662e 6966           self.if
+0000e230: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+0000e240: 6553 6574 4974 656d 734b 6579 5d20 3d20  eSetItemsKey] = 
+0000e250: 5b5d 0a20 2020 2020 2020 2023 2072 656d  [].        # rem
+0000e260: 6f76 6520 6669 656c 6473 2074 6861 7420  ove fields that 
+0000e270: 636f 6e74 6169 6e20 2769 6d61 6765 2d64  contain 'image-d
+0000e280: 6174 6574 696d 6527 206f 6e6c 790a 2020  atetime' only.  
+0000e290: 2020 2020 2020 7365 6c66 2e72 656d 6f76        self.remov
+0000e2a0: 6549 7465 6d46 6965 6c64 7357 6974 684f  eItemFieldsWithO
+0000e2b0: 6e6c 7944 6174 6554 696d 6528 290a 2020  nlyDateTime().  
+0000e2c0: 2020 2020 2020 732e 7374 6f70 2829 0a0a        s.stop()..
+0000e2d0: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
+0000e2e0: 636b 416c 6c49 7465 6d48 6173 6865 7328  ckAllItemHashes(
+0000e2f0: 290a 0a20 2020 2020 2020 2023 2063 6865  )..        # che
+0000e300: 636b 2061 6c6c 206f 7468 6572 206b 6e6f  ck all other kno
+0000e310: 776e 2066 696c 6c65 6420 6669 656c 6473  wn filled fields
+0000e320: 2061 7265 2066 696c 6c65 6420 7661 6c69   are filled vali
+0000e330: 646c 790a 2020 2020 2020 2020 6d69 7174  dly.        miqt
+0000e340: 742e 6973 5661 6c69 6469 4644 4f43 6170  t.isValidiFDOCap
+0000e350: 7475 7265 2873 656c 662e 6966 646f 5f74  ture(self.ifdo_t
+0000e360: 6d70 290a 2020 2020 2020 2020 6d69 7174  mp).        miqt
+0000e370: 742e 6973 5661 6c69 6469 4644 4f43 6f6e  t.isValidiFDOCon
+0000e380: 7465 6e74 2873 656c 662e 6966 646f 5f74  tent(self.ifdo_t
+0000e390: 6d70 290a 0a20 2020 2020 2020 2023 2073  mp)..        # s
+0000e3a0: 6574 2066 696e 616c 206f 6e65 0a20 2020  et final one.   
+0000e3b0: 2020 2020 2073 656c 662e 6966 646f 5f63       self.ifdo_c
+0000e3c0: 6865 636b 6564 203d 2063 6f70 792e 6465  hecked = copy.de
+0000e3d0: 6570 636f 7079 2873 656c 662e 6966 646f  epcopy(self.ifdo
+0000e3e0: 5f74 6d70 290a 2020 2020 2020 2020 7265  _tmp).        re
+0000e3f0: 7475 726e 2073 656c 662e 6966 646f 5f63  turn self.ifdo_c
+0000e400: 6865 636b 6564 0a0a 0a20 2020 2064 6566  hecked...    def
+0000e410: 206c 6f67 4d69 7373 696e 6746 6965 6c64   logMissingField
+0000e420: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+0000e430: 2022 2222 2057 7269 7465 7320 6669 656c   """ Writes fiel
+0000e440: 6473 206d 6973 7369 6e67 2074 6f20 6163  ds missing to ac
+0000e450: 6869 6576 6520 4641 4952 6e65 7373 2074  hieve FAIRness t
+0000e460: 6f20 6c6f 6720 2222 220a 2020 2020 2020  o log """.      
+0000e470: 2020 6f75 7453 7472 203d 2022 5741 524e    outStr = "WARN
+0000e480: 494e 4721 2069 4644 4f20 646f 6573 206e  ING! iFDO does n
+0000e490: 6f74 2061 6368 6965 7665 2046 4149 526e  ot achieve FAIRn
+0000e4a0: 6573 7320 7965 7421 2046 6f6c 6c6f 7769  ess yet! Followi
+0000e4b0: 6e67 2066 6965 6c64 7320 6172 6520 6d69  ng fields are mi
+0000e4c0: 7373 696e 673a 5c6e 220a 2020 2020 2020  ssing:\n".      
+0000e4d0: 2020 6920 3d20 300a 2020 2020 2020 2020    i = 0.        
+0000e4e0: 6d61 784e 724c 696e 6573 203d 2031 300a  maxNrLines = 10.
+0000e4f0: 2020 2020 2020 2020 666f 7220 6d69 7373          for miss
+0000e500: 696e 6746 6965 6c64 2069 6e20 7365 6c66  ingField in self
+0000e510: 2e6d 6973 7369 6e67 4669 656c 6473 466f  .missingFieldsFo
+0000e520: 7246 6169 726e 6573 733a 0a20 2020 2020  rFairness:.     
+0000e530: 2020 2020 2020 2069 6620 6920 3e3d 206d         if i >= m
+0000e540: 6178 4e72 4c69 6e65 733a 0a20 2020 2020  axNrLines:.     
+0000e550: 2020 2020 2020 2020 2020 206f 7574 5374             outSt
+0000e560: 7220 2b3d 2022 5c74 2220 2b20 7374 7228  r += "\t" + str(
+0000e570: 6c65 6e28 7365 6c66 2e6d 6973 7369 6e67  len(self.missing
+0000e580: 4669 656c 6473 466f 7246 6169 726e 6573  FieldsForFairnes
+0000e590: 7329 202d 206d 6178 4e72 4c69 6e65 7329  s) - maxNrLines)
+0000e5a0: 202b 2022 206d 6f72 652e 2e2e 220a 2020   + " more...".  
+0000e5b0: 2020 2020 2020 2020 2020 2020 2020 6272                br
+0000e5c0: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
+0000e5d0: 6f75 7453 7472 202b 3d20 225c 7422 202b  outStr += "\t" +
+0000e5e0: 206d 6973 7369 6e67 4669 656c 6420 2b20   missingField + 
+0000e5f0: 225c 6e22 0a20 2020 2020 2020 2020 2020  "\n".           
+0000e600: 2069 202b 3d20 310a 2020 2020 2020 2020   i += 1.        
+0000e610: 6966 2069 203e 2030 3a0a 2020 2020 2020  if i > 0:.      
+0000e620: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
+0000e630: 6c6f 6728 6f75 7453 7472 290a 0a0a 2020  log(outStr)...  
+0000e640: 2020 6465 6620 6661 6972 6e65 7373 4163    def fairnessAc
+0000e650: 6869 6576 6564 2873 656c 6629 3a0a 2020  hieved(self):.  
+0000e660: 2020 2020 2020 2222 2220 7265 7475 726e        """ return
+0000e670: 7320 7768 6574 6865 7220 616c 6c20 6669  s whether all fi
+0000e680: 656c 6473 2072 6571 7569 7265 6420 746f  elds required to
+0000e690: 2061 6368 6976 6520 4641 4952 6e65 7373   achive FAIRness
+0000e6a0: 2061 7265 2076 616c 6964 6c79 2066 696c   are validly fil
+0000e6b0: 6c65 642e 2052 756e 2063 7265 6174 6543  led. Run createC
+0000e6c0: 6f72 6546 6965 6c64 7328 2920 6669 7273  oreFields() firs
+0000e6d0: 7421 2022 2222 0a20 2020 2020 2020 2069  t! """.        i
+0000e6e0: 6620 6c65 6e28 7365 6c66 2e6d 6973 7369  f len(self.missi
+0000e6f0: 6e67 4669 656c 6473 466f 7246 6169 726e  ngFieldsForFairn
+0000e700: 6573 7329 2021 3d20 303a 0a20 2020 2020  ess) != 0:.     
+0000e710: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+0000e720: 6c73 650a 2020 2020 2020 2020 7265 7475  lse.        retu
+0000e730: 726e 2054 7275 650a 0a0a 2020 2020 6465  rn True...    de
+0000e740: 6620 7265 6d6f 7665 4974 656d 4669 656c  f removeItemFiel
+0000e750: 6473 5769 7468 4f6e 6c79 4461 7465 5469  dsWithOnlyDateTi
+0000e760: 6d65 2873 656c 6629 3a0a 2020 2020 2020  me(self):.      
+0000e770: 2020 2222 2220 6974 2063 616e 2068 6170    """ it can hap
+0000e780: 7065 6e20 7468 6174 2061 6e20 696d 6167  pen that an imag
+0000e790: 6520 7469 6d65 7374 616d 7020 646f 6573  e timestamp does
+0000e7a0: 206e 6f74 2063 6f6e 7461 696e 2061 6e79   not contain any
+0000e7b0: 2066 6965 6c64 7320 6275 7420 7468 6520   fields but the 
+0000e7c0: 7469 6d65 7374 616d 7020 616e 7920 6d6f  timestamp any mo
+0000e7d0: 7265 2e20 5468 6f73 6520 6172 6520 7265  re. Those are re
+0000e7e0: 6d6f 7665 6420 6865 7265 2e20 2222 2220  moved here. """ 
+0000e7f0: 0a20 2020 2020 2020 2066 6f72 2069 7465  .        for ite
+0000e800: 6d20 696e 2073 656c 662e 6966 646f 5f74  m in self.ifdo_t
+0000e810: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
+0000e820: 4974 656d 734b 6579 5d3a 0a20 2020 2020  ItemsKey]:.     
+0000e830: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+0000e840: 696e 7374 616e 6365 2873 656c 662e 6966  instance(self.if
+0000e850: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+0000e860: 6553 6574 4974 656d 734b 6579 5d5b 6974  eSetItemsKey][it
+0000e870: 656d 5d2c 6c69 7374 293a 0a20 2020 2020  em],list):.     
+0000e880: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000e890: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+0000e8a0: 6167 6553 6574 4974 656d 734b 6579 5d5b  ageSetItemsKey][
+0000e8b0: 6974 656d 5d20 3d20 5b73 656c 662e 6966  item] = [self.if
+0000e8c0: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+0000e8d0: 6553 6574 4974 656d 734b 6579 5d5b 6974  eSetItemsKey][it
+0000e8e0: 656d 5d5d 0a20 2020 2020 2020 2020 2020  em]].           
+0000e8f0: 2074 6f42 6552 656d 6f76 6564 203d 205b   toBeRemoved = [
+0000e900: 5d0a 2020 2020 2020 2020 2020 2020 666f  ].            fo
+0000e910: 7220 656e 7472 7920 696e 2073 656c 662e  r entry in self.
+0000e920: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+0000e930: 6167 6553 6574 4974 656d 734b 6579 5d5b  ageSetItemsKey][
+0000e940: 6974 656d 5d3a 0a20 2020 2020 2020 2020  item]:.         
+0000e950: 2020 2020 2020 2023 7072 696e 7428 656e         #print(en
+0000e960: 7472 7929 0a20 2020 2020 2020 2020 2020  try).           
+0000e970: 2020 2020 2069 6620 6c65 6e28 656e 7472       if len(entr
+0000e980: 7929 203d 3d20 3120 616e 6420 2769 6d61  y) == 1 and 'ima
+0000e990: 6765 2d64 6174 6574 696d 6527 2069 6e20  ge-datetime' in 
+0000e9a0: 656e 7472 793a 0a20 2020 2020 2020 2020  entry:.         
+0000e9b0: 2020 2020 2020 2020 2020 2074 6f42 6552             toBeR
+0000e9c0: 656d 6f76 6564 2e61 7070 656e 6428 656e  emoved.append(en
+0000e9d0: 7472 7929 0a20 2020 2020 2020 2020 2020  try).           
+0000e9e0: 2066 6f72 2065 6e74 7279 2069 6e20 746f   for entry in to
+0000e9f0: 4265 5265 6d6f 7665 643a 0a20 2020 2020  BeRemoved:.     
+0000ea00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000ea10: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+0000ea20: 6167 6553 6574 4974 656d 734b 6579 5d5b  ageSetItemsKey][
+0000ea30: 6974 656d 5d2e 7265 6d6f 7665 2865 6e74  item].remove(ent
+0000ea40: 7279 2920 0a0a 0a20 2020 2064 6566 2063  ry) ...    def c
+0000ea50: 6865 636b 416c 6c49 7465 6d48 6173 6865  heckAllItemHashe
+0000ea60: 7328 7365 6c66 2c20 6861 7264 3d46 616c  s(self, hard=Fal
+0000ea70: 7365 2c20 7261 6973 6545 7863 6570 7469  se, raiseExcepti
+0000ea80: 6f6e 203d 2054 7275 6529 3a0a 2020 2020  on = True):.    
+0000ea90: 2020 2020 2222 2220 0a20 2020 2020 2020      """ .       
+0000eaa0: 2043 6865 636b 7320 6966 2068 6173 6865   Checks if hashe
+0000eab0: 7320 696e 2069 4644 4f20 6d61 7463 6820  s in iFDO match 
+0000eac0: 6861 7368 6573 2069 6e20 696e 7465 726d  hashes in interm
+0000ead0: 6569 6461 7465 2068 6173 6820 6669 6c65  eidate hash file
+0000eae0: 2069 6620 7468 6520 6c61 7474 6572 2077   if the latter w
+0000eaf0: 6173 2063 6861 6e67 6564 206c 6173 7420  as changed last 
+0000eb00: 6166 7465 7220 7468 6520 696d 6167 6573  after the images
+0000eb10: 2068 6173 2063 6861 6e67 6564 2e0a 2020   has changed..  
+0000eb20: 2020 2020 2020 4f74 6865 7277 6973 6520        Otherwise 
+0000eb30: 6f72 2069 6620 6861 7264 3d3d 5472 7565  or if hard==True
+0000eb40: 2069 7420 7265 6465 7465 726d 696e 6573   it redetermines
+0000eb50: 2074 6865 2061 6374 7561 6c6c 2066 696c   the actuall fil
+0000eb60: 6527 7320 6861 7368 2061 6e64 2063 6f6d  e's hash and com
+0000eb70: 7061 7265 7320 7468 6520 6946 444f 2069  pares the iFDO i
+0000eb80: 7465 6d27 7320 6861 7368 2077 6974 6820  tem's hash with 
+0000eb90: 7468 6174 2e0a 2020 2020 2020 2020 4966  that..        If
+0000eba0: 2068 6173 6865 7320 646f 206e 6f74 206d   hashes do not m
+0000ebb0: 6174 6368 2061 206d 6172 6971 742e 636f  atch a mariqt.co
+0000ebc0: 7265 2e49 6664 6f45 7863 6570 7469 6f6e  re.IfdoException
+0000ebd0: 2069 7320 7269 7365 6e20 756e 736c 6573   is risen unsles
+0000ebe0: 7320 7261 6973 6545 7863 6570 7469 6f6e  s raiseException
+0000ebf0: 203d 3d20 4661 6c73 652c 2074 6865 6e20   == False, then 
+0000ec00: 6120 6c69 7374 206f 6620 6c69 7374 7320  a list of lists 
+0000ec10: 5b3c 6669 6c65 3e2c 3c65 7863 6570 7469  [<file>,<excepti
+0000ec20: 6f6e 3e5d 2069 7320 7265 7475 726e 6564  on>] is returned
+0000ec30: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0000ec40: 2020 2020 2020 6861 7368 6573 203d 207b        hashes = {
+0000ec50: 7d0a 2020 2020 2020 2020 6861 7368 4669  }.        hashFi
+0000ec60: 6c65 4d6f 6454 696d 6520 3d20 3130 652b  leModTime = 10e+
+0000ec70: 3130 300a 2020 2020 2020 2020 6966 206f  100.        if o
+0000ec80: 732e 7061 7468 2e65 7869 7374 7328 7365  s.path.exists(se
+0000ec90: 6c66 2e67 6574 5f69 6e74 5f68 6173 685f  lf.get_int_hash_
+0000eca0: 6669 6c65 2829 293a 0a20 2020 2020 2020  file()):.       
+0000ecb0: 2020 2020 2068 6173 6865 7320 3d20 6d69       hashes = mi
+0000ecc0: 7174 662e 7461 6246 696c 6544 6174 6128  qtf.tabFileData(
+0000ecd0: 7365 6c66 2e67 6574 5f69 6e74 5f68 6173  self.get_int_has
+0000ece0: 685f 6669 6c65 2829 2c20 5b6d 6971 7476  h_file(), [miqtv
+0000ecf0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+0000ed00: 6971 7427 5d5b 2769 6d67 275d 2c20 6d69  iqt']['img'], mi
+0000ed10: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+0000ed20: 6d61 7269 7174 275d 5b27 6861 7368 275d  mariqt']['hash']
+0000ed30: 5d2c 206b 6579 5f63 6f6c 3d6d 6971 7476  ], key_col=miqtv
+0000ed40: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+0000ed50: 6971 7427 5d5b 2769 6d67 275d 290a 2020  iqt']['img']).  
+0000ed60: 2020 2020 2020 2020 2020 6861 7368 4669            hashFi
+0000ed70: 6c65 4d6f 6454 696d 6520 3d20 6f73 2e70  leModTime = os.p
+0000ed80: 6174 682e 6765 746d 7469 6d65 2873 656c  ath.getmtime(sel
+0000ed90: 662e 6765 745f 696e 745f 6861 7368 5f66  f.get_int_hash_f
+0000eda0: 696c 6528 2929 0a0a 2020 2020 2020 2020  ile())..        
+0000edb0: 6578 6365 7074 696f 6e4c 6973 7420 3d20  exceptionList = 
+0000edc0: 5b5d 0a0a 2020 2020 2020 2020 6861 7368  []..        hash
+0000edd0: 556e 6368 6563 6b49 6d61 6765 7349 6e52  UncheckImagesInR
+0000ede0: 6177 203d 2073 656c 662e 696d 6167 6573  aw = self.images
+0000edf0: 496e 496d 6167 6573 4469 7228 290a 2020  InImagesDir().  
+0000ee00: 2020 2020 2020 7072 6f67 203d 206d 6971        prog = miq
+0000ee10: 7463 2e50 7269 6e74 4b6e 6f77 6e50 726f  tc.PrintKnownPro
+0000ee20: 6772 6573 734d 7367 2822 4368 6563 6b69  gressMsg("Checki
+0000ee30: 6e67 2069 7465 6d20 6861 7368 6573 222c  ng item hashes",
+0000ee40: 206c 656e 2873 656c 662e 6966 646f 5f74   len(self.ifdo_t
+0000ee50: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
+0000ee60: 4974 656d 734b 6579 5d29 290a 2020 2020  ItemsKey])).    
+0000ee70: 2020 2020 666f 7220 6974 656d 2069 6e20      for item in 
+0000ee80: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+0000ee90: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+0000eea0: 4b65 795d 3a0a 2020 2020 2020 2020 2020  Key]:.          
+0000eeb0: 2020 7072 6f67 2e70 726f 6772 6573 7328    prog.progress(
+0000eec0: 290a 0a20 2020 2020 2020 2020 2020 2066  )..            f
+0000eed0: 6f75 6e64 203d 2046 616c 7365 0a20 2020  ound = False.   
+0000eee0: 2020 2020 2020 2020 2066 6f72 2069 6d61           for ima
+0000eef0: 6765 2069 6e20 6861 7368 556e 6368 6563  ge in hashUnchec
+0000ef00: 6b49 6d61 6765 7349 6e52 6177 3a0a 2020  kImagesInRaw:.  
+0000ef10: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0000ef20: 6c65 4e61 6d65 203d 206f 732e 7061 7468  leName = os.path
+0000ef30: 2e62 6173 656e 616d 6528 696d 6167 6529  .basename(image)
+0000ef40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ef50: 2069 6620 6669 6c65 4e61 6d65 203d 3d20   if fileName == 
+0000ef60: 6974 656d 3a0a 2020 2020 2020 2020 2020  item:.          
+0000ef70: 2020 2020 2020 2020 2020 666f 756e 6420            found 
+0000ef80: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+0000ef90: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+0000efa0: 696e 7374 616e 6365 2873 656c 662e 6966  instance(self.if
+0000efb0: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+0000efc0: 6553 6574 4974 656d 734b 6579 5d5b 6974  eSetItemsKey][it
+0000efd0: 656d 5d2c 6c69 7374 293a 2023 2069 6e20  em],list): # in 
+0000efe0: 6361 7365 206f 6620 7669 6465 6f20 7769  case of video wi
+0000eff0: 7468 2069 7465 6d20 6173 206c 6973 7420  th item as list 
+0000f000: 7468 6520 6669 7273 7420 656e 7472 7920  the first entry 
+0000f010: 686f 6c64 7320 7468 6520 6465 6661 756c  holds the defaul
+0000f020: 7420 616e 6420 7468 6520 6861 7368 2063  t and the hash c
+0000f030: 616e 6e6f 7420 7661 7279 2066 6f72 2074  annot vary for t
+0000f040: 6865 2073 616d 6520 696d 6167 650a 2020  he same image.  
+0000f050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f060: 2020 2020 2020 6974 656d 456e 7472 7920        itemEntry 
+0000f070: 3d20 7365 6c66 2e69 6664 6f5f 746d 705b  = self.ifdo_tmp[
+0000f080: 7365 6c66 2e69 6d61 6765 5365 7449 7465  self.imageSetIte
+0000f090: 6d73 4b65 795d 5b69 7465 6d5d 5b30 5d20  msKey][item][0] 
+0000f0a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f0b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000f0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0d0: 2020 2069 7465 6d45 6e74 7279 203d 2073     itemEntry = s
+0000f0e0: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+0000f0f0: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
+0000f100: 6579 5d5b 6974 656d 5d0a 0a20 2020 2020  ey][item]..     
+0000f110: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000f120: 6d61 6765 4d6f 6454 696d 6520 3d20 6f73  mageModTime = os
+0000f130: 2e70 6174 682e 6765 746d 7469 6d65 2869  .path.getmtime(i
+0000f140: 6d61 6765 290a 2020 2020 2020 2020 2020  mage).          
+0000f150: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0000f160: 2068 6172 6420 616e 6420 696d 6167 654d   hard and imageM
+0000f170: 6f64 5469 6d65 203c 2068 6173 6846 696c  odTime < hashFil
+0000f180: 654d 6f64 5469 6d65 3a0a 2020 2020 2020  eModTime:.      
+0000f190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f1a0: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
+0000f1b0: 2e62 6173 656e 616d 6528 696d 6167 6529  .basename(image)
+0000f1c0: 2069 6e20 6861 7368 6573 3a0a 2020 2020   in hashes:.    
+0000f1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f1e0: 2020 2020 2020 2020 6966 2072 6169 7365          if raise
+0000f1f0: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
+0000f200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f210: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000f220: 206d 6971 7463 2e49 6664 6f45 7863 6570   miqtc.IfdoExcep
+0000f230: 7469 6f6e 2869 7465 6d2c 2022 6e6f 7420  tion(item, "not 
+0000f240: 666f 756e 6420 696e 2069 6e74 6572 6d65  found in interme
+0000f250: 6964 6174 6520 6861 7368 2066 696c 6522  idate hash file"
+0000f260: 2c73 656c 662e 6765 745f 696e 745f 6861  ,self.get_int_ha
+0000f270: 7368 5f66 696c 6528 292c 2220 7275 6e20  sh_file()," run 
+0000f280: 6372 6561 7465 496d 6167 6553 4841 3235  createImageSHA25
+0000f290: 3646 696c 6528 2920 6669 7273 7422 2920  6File() first") 
+0000f2a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f2b0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0000f2c0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000f2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f2e0: 2020 2065 7863 6570 7469 6f6e 4c69 7374     exceptionList
+0000f2f0: 2e61 7070 656e 6428 5b66 696c 654e 616d  .append([fileNam
+0000f300: 652c 226e 6f74 2066 6f75 6e64 2069 6e20  e,"not found in 
+0000f310: 696e 7465 726d 6569 6461 7465 2068 6173  intermeidate has
+0000f320: 6820 6669 6c65 2022 202b 2073 7472 2873  h file " + str(s
+0000f330: 656c 662e 6765 745f 696e 745f 6861 7368  elf.get_int_hash
+0000f340: 5f66 696c 6528 2929 5d29 0a20 2020 2020  _file())]).     
+0000f350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f360: 2020 2069 6620 6e6f 7420 6974 656d 456e     if not itemEn
+0000f370: 7472 795b 2769 6d61 6765 2d68 6173 682d  try['image-hash-
+0000f380: 7368 6132 3536 275d 203d 3d20 6861 7368  sha256'] == hash
+0000f390: 6573 5b6f 732e 7061 7468 2e62 6173 656e  es[os.path.basen
+0000f3a0: 616d 6528 696d 6167 6529 5d5b 2769 6d61  ame(image)]['ima
+0000f3b0: 6765 2d68 6173 682d 7368 6132 3536 275d  ge-hash-sha256']
+0000f3c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000f3d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000f3e0: 2072 6169 7365 4578 6365 7074 696f 6e3a   raiseException:
+0000f3f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f410: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
+0000f420: 6f45 7863 6570 7469 6f6e 2869 7465 6d2c  oException(item,
+0000f430: 2022 696e 636f 7272 6563 7420 7368 6132   "incorrect sha2
+0000f440: 3536 2068 6173 6822 2c20 6974 656d 456e  56 hash", itemEn
+0000f450: 7472 795b 2769 6d61 6765 2d68 6173 682d  try['image-hash-
+0000f460: 7368 6132 3536 275d 2c22 666f 7220 6669  sha256'],"for fi
+0000f470: 6c65 222c 6669 6c65 4e61 6d65 2c22 2072  le",fileName," r
+0000f480: 756e 2063 7265 6174 6549 6d61 6765 5348  un createImageSH
+0000f490: 4132 3536 4669 6c65 2829 2066 6972 7374  A256File() first
+0000f4a0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0000f4b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000f4c0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000f4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f4e0: 2020 2020 2065 7863 6570 7469 6f6e 4c69       exceptionLi
+0000f4f0: 7374 2e61 7070 656e 6428 5b66 696c 654e  st.append([fileN
+0000f500: 616d 652c 2269 6e63 6f72 7265 6374 2073  ame,"incorrect s
+0000f510: 6861 3235 3620 6861 7368 225d 290a 2020  ha256 hash"]).  
+0000f520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f530: 2020 656c 6966 206e 6f74 2069 7465 6d45    elif not itemE
+0000f540: 6e74 7279 5b27 696d 6167 652d 6861 7368  ntry['image-hash
+0000f550: 2d73 6861 3235 3627 5d20 3d3d 206d 6971  -sha256'] == miq
+0000f560: 7463 2e73 6861 3235 3648 6173 6846 696c  tc.sha256HashFil
+0000f570: 6528 696d 6167 6529 3a0a 2020 2020 2020  e(image):.      
+0000f580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f590: 2020 6966 2072 6169 7365 4578 6365 7074    if raiseExcept
+0000f5a0: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+0000f5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f5c0: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
+0000f5d0: 6f45 7863 6570 7469 6f6e 2869 7465 6d2c  oException(item,
+0000f5e0: 2022 696e 636f 7272 6563 7420 7368 6132   "incorrect sha2
+0000f5f0: 3536 2068 6173 6822 2c20 6974 656d 456e  56 hash", itemEn
+0000f600: 7472 795b 2769 6d61 6765 2d68 6173 682d  try['image-hash-
+0000f610: 7368 6132 3536 275d 2c22 666f 7220 6669  sha256'],"for fi
+0000f620: 6c65 222c 6669 6c65 4e61 6d65 2c22 2072  le",fileName," r
+0000f630: 756e 2063 7265 6174 6549 6d61 6765 5348  un createImageSH
+0000f640: 4132 3536 4669 6c65 2829 2066 6972 7374  A256File() first
+0000f650: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0000f660: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000f670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f680: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+0000f690: 6570 7469 6f6e 4c69 7374 2e61 7070 656e  eptionList.appen
+0000f6a0: 6428 5b66 696c 654e 616d 652c 2269 6e63  d([fileName,"inc
+0000f6b0: 6f72 7265 6374 2073 6861 3235 3620 6861  orrect sha256 ha
+0000f6c0: 7368 225d 290a 2020 2020 2020 2020 2020  sh"]).          
+0000f6d0: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+0000f6e0: 2020 2020 2020 2020 2020 2020 6966 2066              if f
+0000f6f0: 6f75 6e64 3a0a 2020 2020 2020 2020 2020  ound:.          
+0000f700: 2020 2020 2020 6465 6c20 6861 7368 556e        del hashUn
+0000f710: 6368 6563 6b49 6d61 6765 7349 6e52 6177  checkImagesInRaw
+0000f720: 5b69 6d61 6765 5d0a 2020 2020 2020 2020  [image].        
+0000f730: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000f740: 2020 2020 2020 2020 2020 6966 2072 6169            if rai
+0000f750: 7365 4578 6365 7074 696f 6e3a 0a20 2020  seException:.   
+0000f760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f770: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
+0000f780: 6f45 7863 6570 7469 6f6e 2820 2269 6d61  oException( "ima
+0000f790: 6765 222c 2069 7465 6d2c 2022 6e6f 7420  ge", item, "not 
+0000f7a0: 666f 756e 6420 696e 2064 6972 6563 746f  found in directo
+0000f7b0: 7279 2773 2072 6177 2066 6f6c 6465 7221  ry's raw folder!
+0000f7c0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0000f7d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000f7e0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+0000f7f0: 6570 7469 6f6e 4c69 7374 2e61 7070 656e  eptionList.appen
+0000f800: 6428 5b66 696c 654e 616d 652c 2266 696c  d([fileName,"fil
+0000f810: 6520 6e6f 7420 666f 756e 6422 5d29 0a20  e not found"]). 
+0000f820: 2020 2020 2020 2070 726f 672e 636c 6561         prog.clea
+0000f830: 7228 290a 2020 2020 2020 2020 6966 206e  r().        if n
+0000f840: 6f74 2072 6169 7365 4578 6365 7074 696f  ot raiseExceptio
+0000f850: 6e3a 0a20 2020 2020 2020 2020 2020 2072  n:.            r
+0000f860: 6574 7572 6e20 6578 6365 7074 696f 6e4c  eturn exceptionL
+0000f870: 6973 740a 0a0a 2020 2020 6465 6620 6372  ist...    def cr
+0000f880: 6561 7465 5555 4944 4669 6c65 2873 656c  eateUUIDFile(sel
+0000f890: 662c 636c 6561 6e3d 5472 7565 293a 0a20  f,clean=True):. 
+0000f8a0: 2020 2020 2020 2022 2222 2043 7265 6174         """ Creat
+0000f8b0: 6573 2069 6e20 2f69 6e74 6572 6d65 6469  es in /intermedi
+0000f8c0: 6174 6520 6120 7465 7874 2066 696c 6520  ate a text file 
+0000f8d0: 636f 6e74 6169 6e69 6e67 2070 6572 2069  containing per i
+0000f8e0: 6d61 6765 2061 2063 7265 6174 6564 2075  mage a created u
+0000f8f0: 7569 6420 2876 6572 7369 6f6e 2034 292e  uid (version 4).
+0000f900: 0a0a 2020 2020 2020 2020 5468 6520 5555  ..        The UU
+0000f910: 4944 2069 7320 6f6e 6c79 202a 7461 6b65  ID is only *take
+0000f920: 6e2a 2066 726f 6d20 7468 6520 6d65 7461  n* from the meta
+0000f930: 6461 7461 206f 6620 7468 6520 696d 6167  data of the imag
+0000f940: 6573 2e20 4974 2064 6f65 7320 6e6f 7420  es. It does not 
+0000f950: 7772 6974 6520 5555 4944 7320 746f 2074  write UUIDs to t
+0000f960: 6865 206d 6574 6164 6174 6120 696e 2063  he metadata in c
+0000f970: 6173 6520 736f 6d65 2066 696c 6573 2061  ase some files a
+0000f980: 7265 206d 6973 7369 6e67 2069 742e 0a20  re missing it.. 
+0000f990: 2020 2020 2020 2042 7574 2c20 6974 2063         But, it c
+0000f9a0: 7265 6174 6573 2061 2043 5356 2066 696c  reates a CSV fil
+0000f9b0: 6520 696e 2074 6861 7420 6361 7365 2074  e in that case t
+0000f9c0: 6861 7420 796f 7520 6361 6e20 7573 6520  hat you can use 
+0000f9d0: 746f 6765 7468 6572 2077 6974 6820 6578  together with ex
+0000f9e0: 6966 746f 6f6c 2074 6f20 6164 6420 7468  iftool to add th
+0000f9f0: 6520 5555 4944 2074 6f20 796f 7572 2064  e UUID to your d
+0000fa00: 6174 612e 2042 6577 6172 6521 2074 6869  ata. Beware! thi
+0000fa10: 7320 6361 6e20 6465 7374 726f 7920 796f  s can destroy yo
+0000fa20: 7572 2069 6d61 6765 730a 2020 2020 2020  ur images.      
+0000fa30: 2020 6966 206e 6f74 2064 6f6e 6520 7072    if not done pr
+0000fa40: 6f70 6572 6c79 2120 4e6f 2067 7561 7261  operly! No guara
+0000fa50: 6e74 6565 2069 7320 6769 7665 6e20 6974  ntee is given it
+0000fa60: 2077 696c 6c20 776f 726b 2e20 4265 2063   will work. Be c
+0000fa70: 6172 6566 756c 210a 0a20 2020 2020 2020  areful!..       
+0000fa80: 2055 7365 2063 6c65 616e 3d46 616c 7365   Use clean=False
+0000fa90: 2074 6f20 6e6f 7420 6368 6563 6b20 7468   to not check th
+0000faa0: 6f73 6520 6669 6c65 7320 6167 6169 6e20  ose files again 
+0000fab0: 7768 6963 6820 6172 6520 616c 7265 6164  which are alread
+0000fac0: 7920 666f 756e 6420 696e 2069 6e74 6572  y found in inter
+0000fad0: 6d65 6469 6174 6520 7575 6964 2066 696c  mediate uuid fil
+0000fae0: 650a 2020 2020 2020 2020 2222 220a 0a20  e.        """.. 
+0000faf0: 2020 2020 2020 2075 7569 6473 203d 207b         uuids = {
+0000fb00: 7d0a 2020 2020 2020 2020 2320 4368 6563  }.        # Chec
+0000fb10: 6b20 7768 6574 6865 7220 6120 6669 6c65  k whether a file
+0000fb20: 2077 6974 6820 5555 4944 7320 6578 6973   with UUIDs exis
+0000fb30: 7473 2c20 7468 656e 2072 6561 6420 6974  ts, then read it
+0000fb40: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0000fb50: 636c 6561 6e20 616e 6420 6f73 2e70 6174  clean and os.pat
+0000fb60: 682e 6578 6973 7473 2873 656c 662e 6765  h.exists(self.ge
+0000fb70: 745f 696e 745f 7575 6964 5f66 696c 6528  t_int_uuid_file(
+0000fb80: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+0000fb90: 7575 6964 7320 3d20 6d69 7174 662e 7461  uuids = miqtf.ta
+0000fba0: 6246 696c 6544 6174 6128 7365 6c66 2e67  bFileData(self.g
+0000fbb0: 6574 5f69 6e74 5f75 7569 645f 6669 6c65  et_int_uuid_file
+0000fbc0: 2829 2c20 5b6d 6971 7476 2e63 6f6c 5f68  (), [miqtv.col_h
+0000fbd0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+0000fbe0: 2769 6d67 275d 2c20 6d69 7174 762e 636f  'img'], miqtv.co
+0000fbf0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+0000fc00: 275d 5b27 7575 6964 275d 5d2c 206b 6579  ']['uuid']], key
+0000fc10: 5f63 6f6c 3d6d 6971 7476 2e63 6f6c 5f68  _col=miqtv.col_h
+0000fc20: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+0000fc30: 2769 6d67 275d 290a 2020 2020 2020 2020  'img']).        
+0000fc40: 2020 2020 0a20 2020 2020 2020 2069 6620      .        if 
+0000fc50: 6f73 2e70 6174 682e 6578 6973 7473 2873  os.path.exists(s
+0000fc60: 656c 662e 696d 6167 6573 4469 7229 3a0a  elf.imagesDir):.
+0000fc70: 0a20 2020 2020 2020 2020 2020 206d 6973  .            mis
+0000fc80: 7369 6e67 5f75 7569 6473 203d 207b 7d0a  sing_uuids = {}.
+0000fc90: 2020 2020 2020 2020 2020 2020 6164 6465              adde
+0000fca0: 645f 7575 6964 7320 3d20 300a 0a20 2020  d_uuids = 0..   
+0000fcb0: 2020 2020 2020 2020 2075 6e6b 6e6f 776e           unknown
+0000fcc0: 4669 6c65 7320 3d20 5b5d 0a20 2020 2020  Files = [].     
+0000fcd0: 2020 2020 2020 2066 6f72 2066 696c 6520         for file 
+0000fce0: 696e 2073 656c 662e 696d 6167 6573 496e  in self.imagesIn
+0000fcf0: 496d 6167 6573 4469 7228 293a 0a20 2020  ImagesDir():.   
+0000fd00: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+0000fd10: 655f 6e61 6d65 203d 206f 732e 7061 7468  e_name = os.path
+0000fd20: 2e62 6173 656e 616d 6528 6669 6c65 290a  .basename(file).
+0000fd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd40: 6966 2066 696c 655f 6e61 6d65 206e 6f74  if file_name not
+0000fd50: 2069 6e20 7575 6964 733a 0a20 2020 2020   in uuids:.     
+0000fd60: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+0000fd70: 6e6b 6e6f 776e 4669 6c65 732e 6170 7065  nknownFiles.appe
+0000fd80: 6e64 2866 696c 6529 0a20 2020 2020 2020  nd(file).       
+0000fd90: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000fda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fdb0: 2020 2075 7569 6473 5b66 696c 655f 6e61     uuids[file_na
+0000fdc0: 6d65 5d20 3d20 7575 6964 735b 6669 6c65  me] = uuids[file
+0000fdd0: 5f6e 616d 655d 5b6d 6971 7476 2e63 6f6c  _name][miqtv.col
+0000fde0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+0000fdf0: 5d5b 2775 7569 6427 5d5d 0a0a 2020 2020  ]['uuid']]..    
+0000fe00: 2020 2020 2020 2020 756e 6b6e 6f77 6e46          unknownF
+0000fe10: 696c 6573 5555 4944 7320 3d20 6d69 7174  ilesUUIDs = miqt
+0000fe20: 692e 696d 6167 6573 436f 6e74 6169 6e56  i.imagesContainV
+0000fe30: 616c 6964 5555 4944 2875 6e6b 6e6f 776e  alidUUID(unknown
+0000fe40: 4669 6c65 7329 0a20 2020 2020 2020 2020  Files).         
+0000fe50: 2020 2066 6f72 2066 696c 6520 696e 2075     for file in u
+0000fe60: 6e6b 6e6f 776e 4669 6c65 7355 5549 4473  nknownFilesUUIDs
+0000fe70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000fe80: 2020 6669 6c65 5f6e 616d 6520 3d20 6f73    file_name = os
+0000fe90: 2e70 6174 682e 6261 7365 6e61 6d65 2866  .path.basename(f
+0000fea0: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
+0000feb0: 2020 2020 2069 6620 6e6f 7420 756e 6b6e       if not unkn
+0000fec0: 6f77 6e46 696c 6573 5555 4944 735b 6669  ownFilesUUIDs[fi
+0000fed0: 6c65 5d5b 2776 616c 6964 275d 3a0a 2020  le]['valid']:.  
+0000fee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fef0: 2020 7575 6964 203d 206d 6971 7463 2e75    uuid = miqtc.u
+0000ff00: 7569 6434 2829 0a20 2020 2020 2020 2020  uid4().         
+0000ff10: 2020 2020 2020 2020 2020 206d 6973 7369             missi
+0000ff20: 6e67 5f75 7569 6473 5b66 696c 655d 203d  ng_uuids[file] =
+0000ff30: 2075 7569 640a 2020 2020 2020 2020 2020   uuid.          
+0000ff40: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000ff50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff60: 7575 6964 735b 6669 6c65 5f6e 616d 655d  uuids[file_name]
+0000ff70: 203d 2075 6e6b 6e6f 776e 4669 6c65 7355   = unknownFilesU
+0000ff80: 5549 4473 5b66 696c 655d 5b27 7575 6964  UIDs[file]['uuid
+0000ff90: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
+0000ffa0: 2020 2020 2020 2061 6464 6564 5f75 7569         added_uui
+0000ffb0: 6473 202b 3d20 310a 0a20 2020 2020 2020  ds += 1..       
+0000ffc0: 2020 2020 2023 2049 6620 7072 6576 696f       # If previo
+0000ffd0: 7573 6c79 2075 6e6b 6e6f 776e 2055 5549  usly unknown UUI
+0000ffe0: 4473 2077 6572 6520 666f 756e 6420 696e  Ds were found in
+0000fff0: 2074 6865 2066 696c 6520 6865 6164 6572   the file header
+00010000: 732c 2061 6464 2074 6865 6d20 746f 2074  s, add them to t
+00010010: 6865 2055 5549 4420 6669 6c65 0a20 2020  he UUID file.   
+00010020: 2020 2020 2020 2020 2069 6620 6164 6465           if adde
+00010030: 645f 7575 6964 7320 3e20 303a 0a20 2020  d_uuids > 0:.   
+00010040: 2020 2020 2020 2020 2020 2020 2072 6573               res
+00010050: 203d 206f 7065 6e28 7365 6c66 2e67 6574   = open(self.get
+00010060: 5f69 6e74 5f75 7569 645f 6669 6c65 2829  _int_uuid_file()
+00010070: 2c20 2277 2229 0a20 2020 2020 2020 2020  , "w").         
+00010080: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+00010090: 286d 6971 7476 2e63 6f6c 5f68 6561 6465  (miqtv.col_heade
+000100a0: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
+000100b0: 275d 202b 225c 7422 2b6d 6971 7476 2e63  '] +"\t"+miqtv.c
+000100c0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+000100d0: 7427 5d5b 2775 7569 6427 5d2b 225c 6e22  t']['uuid']+"\n"
+000100e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000100f0: 2020 666f 7220 6669 6c65 2069 6e20 7575    for file in uu
+00010100: 6964 733a 0a20 2020 2020 2020 2020 2020  ids:.           
+00010110: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
+00010120: 7465 2866 696c 652b 225c 7422 2b73 7472  te(file+"\t"+str
+00010130: 2875 7569 6473 5b66 696c 655d 292b 225c  (uuids[file])+"\
+00010140: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
+00010150: 2020 2020 7265 732e 636c 6f73 6528 290a      res.close().
+00010160: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00010170: 6c65 6e28 6d69 7373 696e 675f 7575 6964  len(missing_uuid
+00010180: 7329 203e 2030 3a0a 2020 2020 2020 2020  s) > 0:.        
+00010190: 2020 2020 2020 2020 6563 7376 5f70 6174          ecsv_pat
+000101a0: 6820 3d20 7365 6c66 2e5f 5f67 6574 5f69  h = self.__get_i
+000101b0: 6e74 5f66 696c 655f 7072 6566 6978 2829  nt_file_prefix()
+000101c0: 202b 2022 5f65 7869 662d 6164 642d 7575   + "_exif-add-uu
+000101d0: 6964 2e63 7376 220a 2020 2020 2020 2020  id.csv".        
+000101e0: 2020 2020 2020 2020 6373 7620 3d20 6f70          csv = op
+000101f0: 656e 2865 6373 765f 7061 7468 2c20 2277  en(ecsv_path, "w
+00010200: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00010210: 2020 2063 7376 2e77 7269 7465 286d 6971     csv.write(miq
+00010220: 7476 2e63 6f6c 5f68 6561 6465 725b 2765  tv.col_header['e
+00010230: 7869 6627 5d5b 2769 6d67 275d 202b 0a20  xif']['img'] +. 
+00010240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010250: 2020 2020 2020 2020 2022 2c22 2b6d 6971           ","+miq
+00010260: 7476 2e63 6f6c 5f68 6561 6465 725b 2765  tv.col_header['e
+00010270: 7869 6627 5d5b 2775 7569 6427 5d2b 225c  xif']['uuid']+"\
+00010280: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
+00010290: 2020 2020 6469 6666 6572 656e 745f 7061      different_pa
+000102a0: 7468 7320 3d20 5b5d 0a20 2020 2020 2020  ths = [].       
+000102b0: 2020 2020 2020 2020 2066 6f72 2069 6d67           for img
+000102c0: 2069 6e20 6d69 7373 696e 675f 7575 6964   in missing_uuid
+000102d0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+000102e0: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
+000102f0: 682e 6261 7365 6e61 6d65 2869 6d67 2920  h.basename(img) 
+00010300: 6e6f 7420 696e 2064 6966 6665 7265 6e74  not in different
+00010310: 5f70 6174 6873 3a0a 2020 2020 2020 2020  _paths:.        
+00010320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010330: 6469 6666 6572 656e 745f 7061 7468 732e  different_paths.
+00010340: 6170 7065 6e64 286f 732e 7061 7468 2e62  append(os.path.b
+00010350: 6173 656e 616d 6528 696d 6729 290a 2020  asename(img)).  
+00010360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010370: 2020 6373 762e 7772 6974 6528 696d 672b    csv.write(img+
+00010380: 222c 222b 7374 7228 6d69 7373 696e 675f  ","+str(missing_
+00010390: 7575 6964 735b 696d 675d 292b 225c 6e22  uuids[img])+"\n"
+000103a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000103b0: 2020 2372 6574 7572 6e20 4661 6c73 652c    #return False,
+000103c0: 2022 6578 6966 746f 6f6c 202d 6373 763d   "exiftool -csv=
+000103d0: 222b 6563 7376 5f70 6174 682b 2220 222b  "+ecsv_path+" "+
+000103e0: 2220 222e 6a6f 696e 2864 6966 6665 7265  " ".join(differe
+000103f0: 6e74 5f70 6174 6873 290a 2020 2020 2020  nt_paths).      
+00010400: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00010410: 2046 616c 7365 2c20 224e 6f74 2061 6c6c   False, "Not all
+00010420: 2069 6d61 6765 7320 6861 7665 2076 616c   images have val
+00010430: 6964 2055 5549 4473 2e20 4d69 7373 696e  id UUIDs. Missin
+00010440: 6720 666f 7220 666f 6c6c 6f77 696e 6720  g for following 
+00010450: 6669 6c65 733a 5c6e 222b 225c c586 222e  files:\n"+"\..".
+00010460: 6a6f 696e 2864 6966 6665 7265 6e74 5f70  join(different_p
+00010470: 6174 6873 290a 2020 2020 2020 2020 2020  aths).          
+00010480: 2020 0a20 2020 2020 2020 2020 2020 2073    .            s
+00010490: 656c 662e 5f5f 616c 6c55 5549 4473 4368  elf.__allUUIDsCh
+000104a0: 6563 6b65 6420 3d20 5472 7565 0a20 2020  ecked = True.   
+000104b0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000104c0: 5472 7565 2c20 2241 6c6c 2069 6d61 6765  True, "All image
+000104d0: 7320 6861 7665 2061 2055 5549 4422 0a20  s have a UUID". 
+000104e0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+000104f0: 6c73 652c 2022 5061 7468 2022 2b73 656c  lse, "Path "+sel
+00010500: 662e 696d 6167 6573 4469 7220 2b20 2220  f.imagesDir + " 
+00010510: 6e6f 7420 666f 756e 642e 220a 0a0a 2020  not found."...  
+00010520: 2020 6465 6620 7365 7449 6d61 6765 5365    def setImageSe
+00010530: 7441 7474 6974 7564 6528 7365 6c66 2c79  tAttitude(self,y
+00010540: 6177 5f66 7261 6d65 3a66 6c6f 6174 2c70  aw_frame:float,p
+00010550: 6974 6368 5f66 7261 6d65 3a66 6c6f 6174  itch_frame:float
+00010560: 2c72 6f6c 6c5f 6672 616d 653a 666c 6f61  ,roll_frame:floa
+00010570: 742c 7961 775f 6361 6d32 6672 616d 653a  t,yaw_cam2frame:
+00010580: 666c 6f61 742c 7069 7463 685f 6361 6d32  float,pitch_cam2
+00010590: 6672 616d 653a 666c 6f61 742c 726f 6c6c  frame:float,roll
+000105a0: 5f63 616d 3266 7261 6d65 3a66 6c6f 6174  _cam2frame:float
+000105b0: 293a 0a20 2020 2020 2020 2022 2222 2063  ):.        """ c
+000105c0: 616c 6375 6c61 7465 7320 7468 6520 7468  alculates the th
+000105d0: 6520 6361 6d65 7261 7320 6162 736f 6c75  e cameras absolu
+000105e0: 7465 2061 7474 6974 7564 6520 616e 6420  te attitude and 
+000105f0: 7365 7473 2069 7420 746f 2069 6d61 6765  sets it to image
+00010600: 2073 6574 2068 6561 6465 722e 2041 6c6c   set header. All
+00010610: 2061 6e67 6c65 7320 6172 6520 6578 7065   angles are expe
+00010620: 6374 6564 2069 6e20 6465 6772 6565 732e  cted in degrees.
+00010630: 200a 2020 2020 2020 2020 6361 6d65 7261   .        camera
+00010640: 3266 7261 6d65 2061 6e67 6c65 733a 2072  2frame angles: r
+00010650: 6f74 6174 696f 6e20 6f66 2063 616d 6572  otation of camer
+00010660: 6120 636f 6f72 6469 6e61 7465 7320 2878  a coordinates (x
+00010670: 2c79 2c7a 203d 2074 6f70 2c20 7269 6768  ,y,z = top, righ
+00010680: 742c 206c 696e 6520 6f66 2073 6967 6874  t, line of sight
+00010690: 2920 7769 7468 2072 6573 7065 6374 2074  ) with respect t
+000106a0: 6f20 7665 6869 636c 6520 636f 6f72 6469  o vehicle coordi
+000106b0: 6e61 7465 7320 2878 2c79 2c7a 203d 2066  nates (x,y,z = f
+000106c0: 6f72 7761 7264 2c72 6967 6874 2c64 6f77  orward,right,dow
+000106d0: 6e29 200a 2020 2020 2020 2020 696e 2061  n) .        in a
+000106e0: 6363 6f72 6461 6e63 6520 7769 7468 2074  ccordance with t
+000106f0: 6865 2079 6177 2c70 6974 6368 2c72 6f6c  he yaw,pitch,rol
+00010700: 6c20 726f 7461 7469 6f6e 206f 7264 6572  l rotation order
+00010710: 2063 6f6e 7665 6e74 696f 6e3a 0a0a 2020   convention:..  
+00010720: 2020 2020 2020 312e 2079 6177 2061 726f        1. yaw aro
+00010730: 756e 6420 7a2c 0a20 2020 2020 2020 2032  und z,.        2
+00010740: 2e20 7069 7463 6820 6172 6f75 6e64 2072  . pitch around r
+00010750: 6f74 6174 6564 2079 2c0a 2020 2020 2020  otated y,.      
+00010760: 2020 332e 2072 6f6c 6c20 6172 6f75 6e64    3. roll around
+00010770: 2072 6f74 6174 6564 2078 0a0a 2020 2020   rotated x..    
+00010780: 2020 2020 526f 7461 7469 6f6e 2064 6972      Rotation dir
+00010790: 6563 7469 6f6e 7320 6163 636f 7264 696e  ections accordin
+000107a0: 6720 746f 205c 2772 6967 6874 2d68 616e  g to \'right-han
+000107b0: 6420 7275 6c65 5c27 2e0a 0a20 2020 2020  d rule\'...     
+000107c0: 2020 2049 2e65 2e20 6361 6d65 7261 3246     I.e. camera2F
+000107d0: 7261 6d65 2061 6e67 6c65 7320 3d20 302c  rame angles = 0,
+000107e0: 302c 3020 6361 6d65 7261 2069 7320 6661  0,0 camera is fa
+000107f0: 6369 6e67 2064 6f77 6e77 6172 6420 7769  cing downward wi
+00010800: 7468 2074 6f70 2073 6964 6520 746f 7761  th top side towa
+00010810: 7264 7320 7665 6869 636c 6527 7320 666f  rds vehicle's fo
+00010820: 7277 6172 6420 6469 7265 6374 696f 6e27  rward direction'
+00010830: 2022 2222 0a0a 2020 2020 2020 2020 525f   """..        R_
+00010840: 6672 616d 6532 6e65 6420 3d20 6d69 7174  frame2ned = miqt
+00010850: 672e 525f 5961 7750 6974 6368 526f 6c6c  g.R_YawPitchRoll
+00010860: 2879 6177 5f66 7261 6d65 2c70 6974 6368  (yaw_frame,pitch
+00010870: 5f66 7261 6d65 2c72 6f6c 6c5f 6672 616d  _frame,roll_fram
+00010880: 6529 0a20 2020 2020 2020 2052 5f63 616d  e).        R_cam
+00010890: 3266 7261 6d65 203d 206d 6971 7467 2e52  2frame = miqtg.R
+000108a0: 5f59 6177 5069 7463 6852 6f6c 6c28 7961  _YawPitchRoll(ya
+000108b0: 775f 6361 6d32 6672 616d 652c 7069 7463  w_cam2frame,pitc
+000108c0: 685f 6361 6d32 6672 616d 652c 726f 6c6c  h_cam2frame,roll
+000108d0: 5f63 616d 3266 7261 6d65 290a 2020 2020  _cam2frame).    
+000108e0: 2020 2020 525f 6361 6d32 6e65 6420 3d20      R_cam2ned = 
+000108f0: 525f 6672 616d 6532 6e65 642e 646f 7428  R_frame2ned.dot(
+00010900: 525f 6361 6d32 6672 616d 6529 0a20 2020  R_cam2frame).   
+00010910: 2020 2020 2079 6177 2c70 6974 6368 2c72       yaw,pitch,r
+00010920: 6f6c 6c20 3d20 6d69 7174 672e 7961 7750  oll = miqtg.yawP
+00010930: 6974 6368 526f 6c6c 2852 5f63 616d 326e  itchRoll(R_cam2n
+00010940: 6564 290a 0a20 2020 2020 2020 2023 2070  ed)..        # p
+00010950: 6f73 6520 6d61 7472 6978 2063 616d 3275  ose matrix cam2u
+00010960: 746d 0a20 2020 2020 2020 2052 5f63 616d  tm.        R_cam
+00010970: 5374 6432 7574 6d20 3d20 7365 6c66 2e67  Std2utm = self.g
+00010980: 6574 5f52 5f63 616d 5374 6432 7574 6d28  et_R_camStd2utm(
+00010990: 525f 6361 6d32 6672 616d 652c 525f 6672  R_cam2frame,R_fr
+000109a0: 616d 6532 6e65 6429 0a0a 2020 2020 2020  ame2ned)..      
+000109b0: 2020 2222 220a 2020 2020 2020 2020 7820    """.        x 
+000109c0: 3d20 6e70 2e61 7272 6179 285b 312c 302c  = np.array([1,0,
+000109d0: 305d 290a 2020 2020 2020 2020 7920 3d20  0]).        y = 
+000109e0: 6e70 2e61 7272 6179 285b 302c 312c 305d  np.array([0,1,0]
+000109f0: 290a 2020 2020 2020 2020 7a20 3d20 6e70  ).        z = np
+00010a00: 2e61 7272 6179 285b 302c 302c 315d 290a  .array([0,0,1]).
+00010a10: 2020 2020 2020 2020 7072 696e 7428 2778          print('x
+00010a20: 272c 525f 6361 6d53 7464 3275 746d 2e64  ',R_camStd2utm.d
+00010a30: 6f74 2878 292e 726f 756e 6428 3529 290a  ot(x).round(5)).
+00010a40: 2020 2020 2020 2020 7072 696e 7428 2779          print('y
+00010a50: 272c 525f 6361 6d53 7464 3275 746d 2e64  ',R_camStd2utm.d
+00010a60: 6f74 2879 292e 726f 756e 6428 3529 290a  ot(y).round(5)).
+00010a70: 2020 2020 2020 2020 7072 696e 7428 277a          print('z
+00010a80: 272c 525f 6361 6d53 7464 3275 746d 2e64  ',R_camStd2utm.d
+00010a90: 6f74 287a 292e 726f 756e 6428 3529 290a  ot(z).round(5)).
+00010aa0: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+00010ab0: 2020 2020 2068 6561 6465 7255 7064 6174       headerUpdat
+00010ac0: 6520 3d20 7b0a 2020 2020 2020 2020 2020  e = {.          
+00010ad0: 2020 6d69 7174 762e 636f 6c5f 6865 6164    miqtv.col_head
+00010ae0: 6572 5b27 6d61 7269 7174 275d 5b27 7961  er['mariqt']['ya
+00010af0: 7727 5d3a 7961 772c 0a20 2020 2020 2020  w']:yaw,.       
+00010b00: 2020 2020 206d 6971 7476 2e63 6f6c 5f68       miqtv.col_h
+00010b10: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00010b20: 2770 6974 6368 275d 3a70 6974 6368 2c0a  'pitch']:pitch,.
+00010b30: 2020 2020 2020 2020 2020 2020 6d69 7174              miqt
+00010b40: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+00010b50: 7269 7174 275d 5b27 726f 6c6c 275d 3a72  riqt']['roll']:r
+00010b60: 6f6c 6c2c 0a20 2020 2020 2020 2020 2020  oll,.           
+00010b70: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
+00010b80: 725b 276d 6172 6971 7427 5d5b 2770 6f73  r['mariqt']['pos
+00010b90: 6527 5d3a 7b27 706f 7365 2d61 6273 6f6c  e']:{'pose-absol
+00010ba0: 7574 652d 6f72 6965 6e74 6174 696f 6e2d  ute-orientation-
+00010bb0: 7574 6d2d 6d61 7472 6978 273a 525f 6361  utm-matrix':R_ca
+00010bc0: 6d53 7464 3275 746d 2e66 6c61 7474 656e  mStd2utm.flatten
+00010bd0: 2829 2e74 6f6c 6973 7428 297d 0a20 2020  ().tolist()}.   
+00010be0: 2020 2020 207d 0a20 2020 2020 2020 2073       }.        s
+00010bf0: 656c 662e 7570 6461 7465 6946 444f 4865  elf.updateiFDOHe
+00010c00: 6164 6572 4669 656c 6473 2868 6561 6465  aderFields(heade
+00010c10: 7255 7064 6174 6529 0a0a 0a20 2020 2064  rUpdate)...    d
+00010c20: 6566 2063 7265 6174 6549 6d61 6765 4174  ef createImageAt
+00010c30: 7469 7475 6465 4669 6c65 2873 656c 662c  titudeFile(self,
+00010c40: 2061 7474 5f70 6174 683a 7374 722c 2066   att_path:str, f
+00010c50: 7261 6d65 5f61 7474 5f68 6561 6465 723a  rame_att_header:
+00010c60: 6469 6374 2c20 6361 6d65 7261 3246 7261  dict, camera2Fra
+00010c70: 6d65 5f79 6177 3a66 6c6f 6174 2c63 616d  me_yaw:float,cam
+00010c80: 6572 6132 4672 616d 655f 7069 7463 683a  era2Frame_pitch:
+00010c90: 666c 6f61 742c 6361 6d65 7261 3246 7261  float,camera2Fra
+00010ca0: 6d65 5f72 6f6c 6c3a 666c 6f61 742c 0a20  me_roll:float,. 
+00010cb0: 2020 2020 6461 7465 5f66 6f72 6d61 743d      date_format=
+00010cc0: 6d69 7174 762e 6461 7465 5f66 6f72 6d61  miqtv.date_forma
+00010cd0: 7473 5b27 7061 6e67 6165 6127 5d2c 2063  ts['pangaea'], c
+00010ce0: 6f6e 7374 5f76 616c 7565 7320 3d20 7b7d  onst_values = {}
+00010cf0: 2c20 6f76 6572 7772 6974 653d 4661 6c73  , overwrite=Fals
+00010d00: 652c 2063 6f6c 5f73 6570 6172 6174 6f72  e, col_separator
+00010d10: 203d 2022 5c74 222c 6174 745f 7061 7468   = "\t",att_path
+00010d20: 5f61 6e67 6c65 735f 696e 5f72 6164 203d  _angles_in_rad =
+00010d30: 2046 616c 7365 2c20 7669 6465 6f53 616d   False, videoSam
+00010d40: 706c 6553 6563 6f6e 6473 3d31 2c72 6563  pleSeconds=1,rec
+00010d50: 6f72 6473 3262 6549 6e76 6572 7465 643d  ords2beInverted=
+00010d60: 5b5d 293a 0a20 2020 2020 2020 2022 2222  []):.        """
+00010d70: 2043 7265 6174 6573 2069 6e20 2f69 6e74   Creates in /int
+00010d80: 6572 6d65 6469 6174 6520 6120 7465 7874  ermediate a text
+00010d90: 2066 696c 6520 7769 7468 2063 616d 6572   file with camer
+00010da0: 6120 6174 7469 7475 6465 2064 6174 6120  a attitude data 
+00010db0: 666f 7220 6561 6368 2069 6d61 6765 2e20  for each image. 
+00010dc0: 416c 6c20 616e 676c 6573 2061 7265 2065  All angles are e
+00010dd0: 7870 6563 7465 6420 696e 2064 6567 7265  xpected in degre
+00010de0: 6573 2e20 5573 6520 6174 745f 7061 7468  es. Use att_path
+00010df0: 5f61 6e67 6c65 735f 696e 5f72 6164 2069  _angles_in_rad i
+00010e00: 6620 6e65 6365 7373 6172 792e 200a 2020  f necessary. .  
+00010e10: 2020 2020 2020 6361 6d65 7261 3246 7261        camera2Fra
+00010e20: 6d65 2061 6e67 6c65 733a 2072 6f74 6174  me angles: rotat
+00010e30: 696f 6e20 6f66 2063 616d 6572 6120 636f  ion of camera co
+00010e40: 6f72 6469 6e61 7465 7320 2878 2c79 2c7a  ordinates (x,y,z
+00010e50: 203d 2074 6f70 2c20 7269 6768 742c 206c   = top, right, l
+00010e60: 696e 6520 6f66 2073 6967 6874 2920 7769  ine of sight) wi
+00010e70: 7468 2072 6573 7065 6374 2074 6f20 7665  th respect to ve
+00010e80: 6869 636c 6520 636f 6f72 6469 6e61 7465  hicle coordinate
+00010e90: 7320 2878 2c79 2c7a 203d 2066 6f72 7761  s (x,y,z = forwa
+00010ea0: 7264 2c72 6967 6874 2c64 6f77 6e29 200a  rd,right,down) .
+00010eb0: 2020 2020 2020 2020 696e 2061 6363 6f72          in accor
+00010ec0: 6461 6e63 6520 7769 7468 2074 6865 2079  dance with the y
+00010ed0: 6177 2c70 6974 6368 2c72 6f6c 6c20 726f  aw,pitch,roll ro
+00010ee0: 7461 7469 6f6e 206f 7264 6572 2063 6f6e  tation order con
+00010ef0: 7665 6e74 696f 6e3a 0a20 2020 2020 2020  vention:.       
+00010f00: 2031 2e20 7961 7720 6172 6f75 6e64 207a   1. yaw around z
+00010f10: 2c0a 2020 2020 2020 2020 322e 2070 6974  ,.        2. pit
+00010f20: 6368 2061 726f 756e 6420 726f 7461 7465  ch around rotate
+00010f30: 6420 792c 0a20 2020 2020 2020 2033 2e20  d y,.        3. 
+00010f40: 726f 6c6c 2061 726f 756e 6420 726f 7461  roll around rota
+00010f50: 7465 6420 780a 0a20 2020 2020 2020 2052  ted x..        R
+00010f60: 6f74 6174 696f 6e20 6469 7265 6374 696f  otation directio
+00010f70: 6e73 2061 6363 6f72 6469 6e67 2074 6f20  ns according to 
+00010f80: 5c27 7269 6768 742d 6861 6e64 2072 756c  \'right-hand rul
+00010f90: 655c 272e 0a0a 2020 2020 2020 2020 492e  e\'...        I.
+00010fa0: 652e 2063 616d 6572 6132 4672 616d 6520  e. camera2Frame 
+00010fb0: 616e 676c 6573 203d 2030 2c30 2c30 2063  angles = 0,0,0 c
+00010fc0: 616d 6572 6120 6973 2066 6163 696e 6720  amera is facing 
+00010fd0: 646f 776e 7761 7264 2077 6974 6820 746f  downward with to
+00010fe0: 7020 7369 6465 2074 6f77 6172 6473 2076  p side towards v
+00010ff0: 6568 6963 6c65 2773 2066 6f72 7761 7264  ehicle's forward
+00011000: 2064 6972 6563 7469 6f6e 2720 2222 220a   direction' """.
+00011010: 0a20 2020 2020 2020 2069 6e74 5f61 7474  .        int_att
+00011020: 7574 7564 655f 6669 6c65 203d 2073 656c  utude_file = sel
+00011030: 662e 5f5f 6765 745f 696e 745f 6669 6c65  f.__get_int_file
+00011040: 5f70 7265 6669 7828 2920 2b20 275f 696d  _prefix() + '_im
+00011050: 6167 652d 6174 7469 7475 6465 2e74 7874  age-attitude.txt
+00011060: 270a 2020 2020 2020 2020 6f75 7470 7574  '.        output
+00011070: 5f68 6561 6465 725f 6174 7420 3d20 7b20  _header_att = { 
+00011080: 2020 6d69 7174 762e 636f 6c5f 6865 6164    miqtv.col_head
+00011090: 6572 5b27 6d61 7269 7174 275d 5b27 696d  er['mariqt']['im
+000110a0: 6727 5d3a 2020 6d69 7174 762e 636f 6c5f  g']:  miqtv.col_
+000110b0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+000110c0: 5b27 696d 6727 5d2c 0a20 2020 2020 2020  ['img'],.       
+000110d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000110e0: 2020 2020 2020 2020 206d 6971 7476 2e63           miqtv.c
+000110f0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+00011100: 7427 5d5b 2775 7463 275d 3a6d 6971 7476  t']['utc']:miqtv
+00011110: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+00011120: 6971 7427 5d5b 2775 7463 275d 2c0a 2020  iqt']['utc'],.  
+00011130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011140: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
+00011150: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+00011160: 6d61 7269 7174 275d 5b27 7961 7727 5d3a  mariqt']['yaw']:
+00011170: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00011180: 5b27 6d61 7269 7174 275d 5b27 7961 7727  ['mariqt']['yaw'
+00011190: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+000111a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000111b0: 2020 206d 6971 7476 2e63 6f6c 5f68 6561     miqtv.col_hea
+000111c0: 6465 725b 276d 6172 6971 7427 5d5b 2770  der['mariqt']['p
+000111d0: 6974 6368 275d 3a6d 6971 7476 2e63 6f6c  itch']:miqtv.col
+000111e0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+000111f0: 5d5b 2770 6974 6368 275d 2c0a 2020 2020  ]['pitch'],.    
+00011200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011210: 2020 2020 2020 2020 2020 2020 6d69 7174              miqt
+00011220: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+00011230: 7269 7174 275d 5b27 726f 6c6c 275d 3a6d  riqt']['roll']:m
+00011240: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+00011250: 276d 6172 6971 7427 5d5b 2772 6f6c 6c27  'mariqt']['roll'
+00011260: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+00011270: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+00011280: 0a0a 2020 2020 2020 2020 696e 745f 706f  ..        int_po
+00011290: 7365 5f66 696c 6520 3d20 7365 6c66 2e5f  se_file = self._
+000112a0: 5f67 6574 5f69 6e74 5f66 696c 655f 7072  _get_int_file_pr
+000112b0: 6566 6978 2829 202b 2027 5f69 6d61 6765  efix() + '_image
+000112c0: 2d63 616d 6572 612d 706f 7365 2e74 7874  -camera-pose.txt
+000112d0: 270a 2020 2020 2020 2020 6f75 7470 7574  '.        output
+000112e0: 5f68 6561 6465 725f 706f 7365 203d 207b  _header_pose = {
+000112f0: 2020 6d69 7174 762e 636f 6c5f 6865 6164    miqtv.col_head
+00011300: 6572 5b27 6d61 7269 7174 275d 5b27 696d  er['mariqt']['im
+00011310: 6727 5d3a 6d69 7174 762e 636f 6c5f 6865  g']:miqtv.col_he
+00011320: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00011330: 696d 6727 5d2c 0a20 2020 2020 2020 2020  img'],.         
+00011340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011350: 2020 2020 2020 206d 6971 7476 2e63 6f6c         miqtv.col
+00011360: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00011370: 5d5b 2775 7463 275d 3a6d 6971 7476 2e63  ]['utc']:miqtv.c
+00011380: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+00011390: 7427 5d5b 2775 7463 275d 2c0a 2020 2020  t']['utc'],.    
+000113a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000113b0: 2020 2020 2020 2020 2020 2020 6d69 7174              miqt
+000113c0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+000113d0: 7269 7174 275d 5b27 706f 7365 275d 3a6d  riqt']['pose']:m
+000113e0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+000113f0: 276d 6172 6971 7427 5d5b 2770 6f73 6527  'mariqt']['pose'
+00011400: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+00011410: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+00011420: 0a0a 2020 2020 2020 2020 6966 206f 732e  ..        if os.
+00011430: 7061 7468 2e65 7869 7374 7328 696e 745f  path.exists(int_
+00011440: 6174 7475 7475 6465 5f66 696c 6529 2061  attutude_file) a
+00011450: 6e64 206e 6f74 206f 7665 7277 7269 7465  nd not overwrite
+00011460: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00011470: 6c66 2e61 6464 4974 656d 496e 666f 5461  lf.addItemInfoTa
+00011480: 6246 696c 6528 696e 745f 6174 7475 7475  bFile(int_attutu
+00011490: 6465 5f66 696c 652c 225c 7422 2c6f 7574  de_file,"\t",out
+000114a0: 7075 745f 6865 6164 6572 5f61 7474 290a  put_header_att).
+000114b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000114c0: 726e 2054 7275 652c 2022 4f75 7470 7574  rn True, "Output
+000114d0: 2066 696c 6520 6578 6973 7473 3a20 222b   file exists: "+
+000114e0: 696e 745f 6174 7475 7475 6465 5f66 696c  int_attutude_fil
+000114f0: 650a 0a20 2020 2020 2020 2069 6620 6e6f  e..        if no
+00011500: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
+00011510: 2861 7474 5f70 6174 6829 3a0a 2020 2020  (att_path):.    
+00011520: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+00011530: 616c 7365 2c20 224e 6176 6967 6174 696f  alse, "Navigatio
+00011540: 6e20 6669 6c65 206e 6f74 2066 6f75 6e64  n file not found
+00011550: 3a20 222b 6174 745f 7061 7468 0a0a 2020  : "+att_path..  
+00011560: 2020 2020 2020 6966 206e 6f74 206f 732e        if not os.
+00011570: 7061 7468 2e65 7869 7374 7328 7365 6c66  path.exists(self
+00011580: 2e69 6d61 6765 7344 6972 293a 0a20 2020  .imagesDir):.   
+00011590: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000115a0: 4661 6c73 652c 2022 496d 6167 6520 666f  False, "Image fo
+000115b0: 6c64 6572 206e 6f74 2066 6f75 6e64 3a20  lder not found: 
+000115c0: 222b 2073 656c 662e 696d 6167 6573 4469  "+ self.imagesDi
+000115d0: 720a 0a20 2020 2020 2020 2073 203d 206d  r..        s = m
+000115e0: 6971 7463 2e50 7269 6e74 4c6f 6164 696e  iqtc.PrintLoadin
+000115f0: 674d 7367 2822 4372 6561 7469 6e67 2069  gMsg("Creating i
+00011600: 7465 6d73 2720 6174 7469 7475 6465 2064  tems' attitude d
+00011610: 6174 6122 290a 0a20 2020 2020 2020 2023  ata")..        #
+00011620: 206c 6f61 6420 6672 616d 6520 6174 7469   load frame atti
+00011630: 7475 6465 2064 6174 6120 6672 6f6d 2066  tude data from f
+00011640: 696c 650a 2020 2020 2020 2020 6174 745f  ile.        att_
+00011650: 6461 7461 2c20 7061 7273 654d 7367 203d  data, parseMsg =
+00011660: 206d 6971 746e 2e72 6561 6441 6c6c 4174   miqtn.readAllAt
+00011670: 7469 7475 6465 7346 726f 6d46 696c 6550  titudesFromFileP
+00011680: 6174 6828 6174 745f 7061 7468 2c20 6672  ath(att_path, fr
+00011690: 616d 655f 6174 745f 6865 6164 6572 2c20  ame_att_header, 
+000116a0: 6461 7465 5f66 6f72 6d61 742c 636f 6c5f  date_format,col_
+000116b0: 7365 7061 7261 746f 723d 636f 6c5f 7365  separator=col_se
+000116c0: 7061 7261 746f 722c 636f 6e73 745f 7661  parator,const_va
+000116d0: 6c75 6573 3d63 6f6e 7374 5f76 616c 7565  lues=const_value
+000116e0: 732c 616e 676c 6573 496e 5261 643d 6174  s,anglesInRad=at
+000116f0: 745f 7061 7468 5f61 6e67 6c65 735f 696e  t_path_angles_in
+00011700: 5f72 6164 290a 2020 2020 2020 2020 6966  _rad).        if
+00011710: 2070 6172 7365 4d73 6720 213d 2022 223a   parseMsg != "":
+00011720: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00011730: 662e 7072 6f76 2e6c 6f67 2870 6172 7365  f.prov.log(parse
+00011740: 4d73 672c 646f 6e74 5368 6f77 3d54 7275  Msg,dontShow=Tru
+00011750: 6529 0a20 2020 2020 2020 2020 2020 2070  e).            p
+00011760: 6172 7365 4d73 6720 3d20 225c 6e22 202b  arseMsg = "\n" +
+00011770: 2070 6172 7365 4d73 670a 0a20 2020 2020   parseMsg..     
+00011780: 2020 2023 2066 696e 6420 666f 7220 6561     # find for ea
+00011790: 6368 2069 6d61 6765 2074 6865 2072 6573  ch image the res
+000117a0: 7065 6374 6976 6520 6e61 7669 6761 7469  pective navigati
+000117b0: 6f6e 2064 6174 610a 2020 2020 2020 2020  on data.        
+000117c0: 732e 7374 6f70 2829 0a20 2020 2020 2020  s.stop().       
+000117d0: 2073 7563 6365 7373 2c20 696d 6167 655f   success, image_
+000117e0: 6474 732c 206d 7367 203d 2073 656c 662e  dts, msg = self.
+000117f0: 6669 6e64 4e61 7644 6174 6146 6f72 496d  findNavDataForIm
+00011800: 6167 6528 6174 745f 6461 7461 2c76 6964  age(att_data,vid
+00011810: 656f 5361 6d70 6c65 5365 636f 6e64 7329  eoSampleSeconds)
+00011820: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00011830: 7375 6363 6573 733a 0a20 2020 2020 2020  success:.       
+00011840: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00011850: 652c 206d 7367 202b 2070 6172 7365 4d73  e, msg + parseMs
+00011860: 670a 2020 2020 2020 2020 7320 3d20 6d69  g.        s = mi
+00011870: 7174 632e 5072 696e 744c 6f61 6469 6e67  qtc.PrintLoading
+00011880: 4d73 6728 2243 7265 6174 696e 6720 6974  Msg("Creating it
+00011890: 656d 7327 2061 7474 6974 7564 6520 6461  ems' attitude da
+000118a0: 7461 2229 0a0a 2020 2020 2020 2020 2320  ta")..        # 
+000118b0: 6164 6420 6361 6d65 7261 3246 7261 6d65  add camera2Frame
+000118c0: 2061 6e67 6c65 730a 2020 2020 2020 2020   angles.        
+000118d0: 525f 6361 6d32 6672 616d 6520 3d20 6d69  R_cam2frame = mi
+000118e0: 7174 672e 525f 5961 7750 6974 6368 526f  qtg.R_YawPitchRo
+000118f0: 6c6c 2863 616d 6572 6132 4672 616d 655f  ll(camera2Frame_
+00011900: 7961 772c 6361 6d65 7261 3246 7261 6d65  yaw,camera2Frame
+00011910: 5f70 6974 6368 2c63 616d 6572 6132 4672  _pitch,camera2Fr
+00011920: 616d 655f 726f 6c6c 290a 2020 2020 2020  ame_roll).      
+00011930: 2020 525f 6361 6d32 7574 6d5f 6c69 7374    R_cam2utm_list
+00011940: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
+00011950: 7220 6669 6c65 2069 6e20 696d 6167 655f  r file in image_
+00011960: 6474 733a 0a20 2020 2020 2020 2020 2020  dts:.           
+00011970: 2066 6f72 2074 696d 6570 6f69 6e74 2069   for timepoint i
+00011980: 6e20 696d 6167 655f 6474 735b 6669 6c65  n image_dts[file
+00011990: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+000119a0: 2020 2061 7474 6974 7564 6520 3d20 7469     attitude = ti
+000119b0: 6d65 706f 696e 740a 2020 2020 2020 2020  mepoint.        
+000119c0: 2020 2020 2020 2020 6966 2061 7474 6974          if attit
+000119d0: 7564 652e 7961 7720 6973 204e 6f6e 6520  ude.yaw is None 
+000119e0: 6f72 2061 7474 6974 7564 652e 7069 7463  or attitude.pitc
+000119f0: 6820 6973 204e 6f6e 6520 6f72 2061 7474  h is None or att
+00011a00: 6974 7564 652e 726f 6c6c 2069 7320 4e6f  itude.roll is No
+00011a10: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00011a20: 2020 2020 2020 2020 525f 6361 6d32 7574          R_cam2ut
+00011a30: 6d5f 6c69 7374 2e61 7070 656e 6428 2222  m_list.append(""
+00011a40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00011a50: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+00011a60: 2020 2020 2020 2020 2020 2020 2020 2052                 R
+00011a70: 5f66 7261 6d65 326e 6564 203d 206d 6971  _frame2ned = miq
+00011a80: 7467 2e52 5f59 6177 5069 7463 6852 6f6c  tg.R_YawPitchRol
+00011a90: 6c28 6174 7469 7475 6465 2e79 6177 2c61  l(attitude.yaw,a
+00011aa0: 7474 6974 7564 652e 7069 7463 682c 6174  ttitude.pitch,at
+00011ab0: 7469 7475 6465 2e72 6f6c 6c29 0a20 2020  titude.roll).   
+00011ac0: 2020 2020 2020 2020 2020 2020 2052 5f63               R_c
+00011ad0: 616d 326e 6564 203d 2052 5f66 7261 6d65  am2ned = R_frame
+00011ae0: 326e 6564 2e64 6f74 2852 5f63 616d 3266  2ned.dot(R_cam2f
+00011af0: 7261 6d65 290a 2020 2020 2020 2020 2020  rame).          
+00011b00: 2020 2020 2020 7961 772c 7069 7463 682c        yaw,pitch,
+00011b10: 726f 6c6c 203d 206d 6971 7467 2e79 6177  roll = miqtg.yaw
+00011b20: 5069 7463 6852 6f6c 6c28 525f 6361 6d32  PitchRoll(R_cam2
+00011b30: 6e65 6429 0a20 2020 2020 2020 2020 2020  ned).           
+00011b40: 2020 2020 2061 7474 6974 7564 652e 7961       attitude.ya
+00011b50: 7720 3d20 7961 770a 2020 2020 2020 2020  w = yaw.        
+00011b60: 2020 2020 2020 2020 6174 7469 7475 6465          attitude
+00011b70: 2e70 6974 6368 203d 2070 6974 6368 0a20  .pitch = pitch. 
+00011b80: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00011b90: 7474 6974 7564 652e 726f 6c6c 203d 2072  ttitude.roll = r
+00011ba0: 6f6c 6c0a 0a20 2020 2020 2020 2020 2020  oll..           
+00011bb0: 2020 2020 2052 5f63 616d 5374 6432 7574       R_camStd2ut
+00011bc0: 6d20 3d20 7365 6c66 2e67 6574 5f52 5f63  m = self.get_R_c
+00011bd0: 616d 5374 6432 7574 6d28 525f 6361 6d32  amStd2utm(R_cam2
+00011be0: 6672 616d 652c 525f 6672 616d 6532 6e65  frame,R_frame2ne
+00011bf0: 6429 0a20 2020 2020 2020 2020 2020 2020  d).             
+00011c00: 2020 2052 5f63 616d 3275 746d 5f6c 6973     R_cam2utm_lis
+00011c10: 742e 6170 7065 6e64 2852 5f63 616d 5374  t.append(R_camSt
+00011c20: 6432 7574 6d2e 666c 6174 7465 6e28 292e  d2utm.flatten().
+00011c30: 746f 6c69 7374 2829 290a 0a20 2020 2020  tolist())..     
+00011c40: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+00011c50: 2822 6170 706c 6965 6420 6672 616d 6520  ("applied frame 
+00011c60: 746f 2063 616d 6572 6120 726f 7461 7469  to camera rotati
+00011c70: 6f6e 2079 6177 2c70 6974 6368 2c72 6f6c  on yaw,pitch,rol
+00011c80: 6c20 3d20 2220 2b20 7374 7228 6361 6d65  l = " + str(came
+00011c90: 7261 3246 7261 6d65 5f79 6177 2920 2b20  ra2Frame_yaw) + 
+00011ca0: 222c 2220 2b20 7374 7228 6361 6d65 7261  "," + str(camera
+00011cb0: 3246 7261 6d65 5f70 6974 6368 2920 2b20  2Frame_pitch) + 
+00011cc0: 222c 2220 2b20 7374 7228 6361 6d65 7261  "," + str(camera
+00011cd0: 3246 7261 6d65 5f72 6f6c 6c29 2c64 6f6e  2Frame_roll),don
+00011ce0: 7453 686f 773d 5472 7565 290a 0a20 2020  tShow=True)..   
+00011cf0: 2020 2020 2069 6620 6c65 6e28 696d 6167       if len(imag
+00011d00: 655f 6474 7329 203e 2030 3a0a 0a20 2020  e_dts) > 0:..   
+00011d10: 2020 2020 2020 2020 2023 2057 7269 7465           # Write
+00011d20: 2074 6f20 6e61 7669 6761 7469 6f6e 2074   to navigation t
+00011d30: 7874 2066 696c 650a 2020 2020 2020 2020  xt file.        
+00011d40: 2020 2020 2320 6865 6164 6572 0a20 2020      # header.   
+00011d50: 2020 2020 2020 2020 2072 6573 203d 206f           res = o
+00011d60: 7065 6e28 696e 745f 6174 7475 7475 6465  pen(int_attutude
+00011d70: 5f66 696c 652c 2022 7722 290a 2020 2020  _file, "w").    
+00011d80: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
+00011d90: 6528 6d69 7174 762e 636f 6c5f 6865 6164  e(miqtv.col_head
+00011da0: 6572 5b27 6d61 7269 7174 275d 5b27 696d  er['mariqt']['im
+00011db0: 6727 5d2b 225c 7422 2b6d 6971 7476 2e63  g']+"\t"+miqtv.c
+00011dc0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+00011dd0: 7427 5d5b 2775 7463 275d 290a 2020 2020  t']['utc']).    
+00011de0: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
+00011df0: 6528 225c 7422 2b6d 6971 7476 2e63 6f6c  e("\t"+miqtv.col
+00011e00: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00011e10: 5d5b 2779 6177 275d 290a 2020 2020 2020  ]['yaw']).      
+00011e20: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
+00011e30: 225c 7422 2b6d 6971 7476 2e63 6f6c 5f68  "\t"+miqtv.col_h
+00011e40: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00011e50: 2770 6974 6368 275d 290a 2020 2020 2020  'pitch']).      
+00011e60: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
+00011e70: 225c 7422 2b6d 6971 7476 2e63 6f6c 5f68  "\t"+miqtv.col_h
+00011e80: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00011e90: 2772 6f6c 6c27 5d29 0a0a 2020 2020 2020  'roll'])..      
+00011ea0: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
+00011eb0: 225c 6e22 290a 2020 2020 2020 2020 2020  "\n").          
+00011ec0: 2020 2320 6461 7461 206c 696e 6573 0a20    # data lines. 
+00011ed0: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
+00011ee0: 696c 6520 696e 2069 6d61 6765 5f64 7473  ile in image_dts
+00011ef0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00011f00: 2020 666f 7220 7469 6d65 706f 696e 7420    for timepoint 
+00011f10: 696e 2069 6d61 6765 5f64 7473 5b66 696c  in image_dts[fil
+00011f20: 655d 3a0a 2020 2020 2020 2020 2020 2020  e]:.            
+00011f30: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
+00011f40: 6528 6669 6c65 2b22 5c74 222b 7469 6d65  e(file+"\t"+time
+00011f50: 706f 696e 742e 6461 7465 5469 6d65 2829  point.dateTime()
+00011f60: 2e73 7472 6674 696d 6528 6d69 7174 762e  .strftime(miqtv.
+00011f70: 6461 7465 5f66 6f72 6d61 7473 5b27 6d61  date_formats['ma
+00011f80: 7269 7174 275d 2929 200a 2020 2020 2020  riqt'])) .      
+00011f90: 2020 2020 2020 2020 2020 2020 2020 7661                va
+00011fa0: 6c20 3d20 7469 6d65 706f 696e 742e 7961  l = timepoint.ya
+00011fb0: 770a 2020 2020 2020 2020 2020 2020 2020  w.              
+00011fc0: 2020 2020 2020 6966 2027 7961 7727 2069        if 'yaw' i
+00011fd0: 6e20 7265 636f 7264 7332 6265 496e 7665  n records2beInve
+00011fe0: 7274 6564 3a0a 2020 2020 2020 2020 2020  rted:.          
+00011ff0: 2020 2020 2020 2020 2020 2020 2020 7661                va
+00012000: 6c20 2a3d 202d 310a 2020 2020 2020 2020  l *= -1.        
+00012010: 2020 2020 2020 2020 2020 2020 7265 732e              res.
+00012020: 7772 6974 6528 225c 7422 2b73 7472 2876  write("\t"+str(v
+00012030: 616c 2929 0a20 2020 2020 2020 2020 2020  al)).           
+00012040: 2020 2020 2020 2020 2076 616c 203d 2074           val = t
+00012050: 696d 6570 6f69 6e74 2e70 6974 6368 0a20  imepoint.pitch. 
+00012060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012070: 2020 2069 6620 2770 6974 6368 2720 696e     if 'pitch' in
+00012080: 2072 6563 6f72 6473 3262 6549 6e76 6572   records2beInver
+00012090: 7465 643a 0a20 2020 2020 2020 2020 2020  ted:.           
+000120a0: 2020 2020 2020 2020 2020 2020 2076 616c               val
+000120b0: 202a 3d20 2d31 0a20 2020 2020 2020 2020   *= -1.         
+000120c0: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
+000120d0: 7269 7465 2822 5c74 222b 7374 7228 7661  rite("\t"+str(va
+000120e0: 6c29 290a 2020 2020 2020 2020 2020 2020  l)).            
+000120f0: 2020 2020 2020 2020 7661 6c20 3d20 7469          val = ti
+00012100: 6d65 706f 696e 742e 726f 6c6c 0a20 2020  mepoint.roll.   
+00012110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012120: 2069 6620 2772 6f6c 6c27 2069 6e20 7265   if 'roll' in re
+00012130: 636f 7264 7332 6265 496e 7665 7274 6564  cords2beInverted
+00012140: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00012150: 2020 2020 2020 2020 2020 7661 6c20 2a3d            val *=
+00012160: 202d 310a 2020 2020 2020 2020 2020 2020   -1.            
+00012170: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
+00012180: 6528 225c 7422 2b73 7472 2876 616c 2929  e("\t"+str(val))
+00012190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000121a0: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
+000121b0: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
+000121c0: 2072 6573 2e63 6c6f 7365 2829 0a0a 2020   res.close()..  
+000121d0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+000121e0: 726f 762e 6164 6441 7267 756d 656e 7428  rov.addArgument(
+000121f0: 2269 6e70 7574 4174 7469 7475 6465 4669  "inputAttitudeFi
+00012200: 6c65 222c 6174 745f 7061 7468 2c6f 7665  le",att_path,ove
+00012210: 7277 7269 7465 3d54 7275 6529 0a20 2020  rwrite=True).   
+00012220: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+00012230: 6f76 2e6c 6f67 2822 7061 7273 6564 2066  ov.log("parsed f
+00012240: 726f 6d20 696e 7075 7441 7474 6974 7564  rom inputAttitud
+00012250: 6546 696c 653a 2022 202b 2073 7472 2866  eFile: " + str(f
+00012260: 7261 6d65 5f61 7474 5f68 6561 6465 7229  rame_att_header)
+00012270: 2c64 6f6e 7453 686f 773d 5472 7565 290a  ,dontShow=True).
+00012280: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00012290: 2e61 6464 4974 656d 496e 666f 5461 6246  .addItemInfoTabF
+000122a0: 696c 6528 696e 745f 6174 7475 7475 6465  ile(int_attutude
+000122b0: 5f66 696c 652c 225c 7422 2c6f 7574 7075  _file,"\t",outpu
+000122c0: 745f 6865 6164 6572 5f61 7474 290a 0a20  t_header_att).. 
+000122d0: 2020 2020 2020 2020 2020 2023 2057 7269             # Wri
+000122e0: 7465 2074 6f20 706f 7365 2074 7874 2066  te to pose txt f
+000122f0: 696c 650a 2020 2020 2020 2020 2020 2020  ile.            
+00012300: 2320 6865 6164 6572 0a20 2020 2020 2020  # header.       
+00012310: 2020 2020 2072 6573 203d 206f 7065 6e28       res = open(
+00012320: 696e 745f 706f 7365 5f66 696c 652c 2022  int_pose_file, "
+00012330: 7722 290a 2020 2020 2020 2020 2020 2020  w").            
+00012340: 7265 732e 7772 6974 6528 6d69 7174 762e  res.write(miqtv.
+00012350: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+00012360: 7174 275d 5b27 696d 6727 5d2b 225c 7422  qt']['img']+"\t"
+00012370: 2b6d 6971 7476 2e63 6f6c 5f68 6561 6465  +miqtv.col_heade
+00012380: 725b 276d 6172 6971 7427 5d5b 2775 7463  r['mariqt']['utc
+00012390: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
+000123a0: 7265 732e 7772 6974 6528 225c 7422 2b6d  res.write("\t"+m
+000123b0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+000123c0: 276d 6172 6971 7427 5d5b 2770 6f73 6527  'mariqt']['pose'
+000123d0: 5d29 0a20 2020 2020 2020 2020 2020 2072  ]).            r
+000123e0: 6573 2e77 7269 7465 2822 5c6e 2229 0a20  es.write("\n"). 
+000123f0: 2020 2020 2020 2020 2020 2023 2064 6174             # dat
+00012400: 6120 6c69 6e65 730a 2020 2020 2020 2020  a lines.        
+00012410: 2020 2020 6920 3d20 300a 2020 2020 2020      i = 0.      
+00012420: 2020 2020 2020 666f 7220 6669 6c65 2069        for file i
+00012430: 6e20 696d 6167 655f 6474 733a 0a20 2020  n image_dts:.   
+00012440: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00012450: 2074 696d 6570 6f69 6e74 2069 6e20 696d   timepoint in im
+00012460: 6167 655f 6474 735b 6669 6c65 5d3a 0a20  age_dts[file]:. 
+00012470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012480: 2020 2069 6620 525f 6361 6d32 7574 6d5f     if R_cam2utm_
+00012490: 6c69 7374 5b69 5d20 3d3d 2022 223a 0a20  list[i] == "":. 
+000124a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000124b0: 2020 2020 2020 2069 202b 3d20 310a 2020         i += 1.  
+000124c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000124d0: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+000124e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000124f0: 2020 2072 6573 2e77 7269 7465 2866 696c     res.write(fil
+00012500: 652b 225c 7422 2b74 696d 6570 6f69 6e74  e+"\t"+timepoint
+00012510: 2e64 6174 6554 696d 6528 292e 7374 7266  .dateTime().strf
+00012520: 7469 6d65 286d 6971 7476 2e64 6174 655f  time(miqtv.date_
+00012530: 666f 726d 6174 735b 276d 6172 6971 7427  formats['mariqt'
+00012540: 5d29 2920 0a20 2020 2020 2020 2020 2020  ])) .           
+00012550: 2020 2020 2020 2020 2065 6e74 7279 203d           entry =
+00012560: 2073 7472 287b 2770 6f73 652d 6162 736f   str({'pose-abso
+00012570: 6c75 7465 2d6f 7269 656e 7461 7469 6f6e  lute-orientation
+00012580: 2d75 746d 2d6d 6174 7269 7827 3a52 5f63  -utm-matrix':R_c
+00012590: 616d 3275 746d 5f6c 6973 745b 695d 7d29  am2utm_list[i]})
+000125a0: 2e72 6570 6c61 6365 2827 5c6e 272c 2727  .replace('\n',''
+000125b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000125c0: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
+000125d0: 225c 7422 2b65 6e74 7279 290a 2020 2020  "\t"+entry).    
+000125e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000125f0: 6920 2b3d 2031 0a20 2020 2020 2020 2020  i += 1.         
+00012600: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
+00012610: 7269 7465 2822 5c6e 2229 0a20 2020 2020  rite("\n").     
+00012620: 2020 2020 2020 2072 6573 2e63 6c6f 7365         res.close
+00012630: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
+00012640: 656c 662e 6164 6449 7465 6d49 6e66 6f54  elf.addItemInfoT
+00012650: 6162 4669 6c65 2869 6e74 5f70 6f73 655f  abFile(int_pose_
+00012660: 6669 6c65 2c22 5c74 222c 6f75 7470 7574  file,"\t",output
+00012670: 5f68 6561 6465 725f 706f 7365 290a 2020  _header_pose).  
+00012680: 2020 2020 2020 2020 2020 732e 7374 6f70            s.stop
+00012690: 2829 0a20 2020 2020 2020 2020 2020 2072  ().            r
+000126a0: 6574 7572 6e20 5472 7565 2c20 2241 7474  eturn True, "Att
+000126b0: 6974 7564 6520 6461 7461 2063 7265 6174  itude data creat
+000126c0: 6564 2220 2b20 7061 7273 654d 7367 0a20  ed" + parseMsg. 
+000126d0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000126e0: 2020 2020 2020 2020 2073 2e73 746f 7028           s.stop(
+000126f0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00012700: 7475 726e 2046 616c 7365 2c20 224e 6f20  turn False, "No 
+00012710: 696d 6167 6520 6174 7469 7475 6465 7320  image attitudes 
+00012720: 666f 756e 6422 202b 2070 6172 7365 4d73  found" + parseMs
+00012730: 670a 2020 2020 2020 2020 0a0a 2020 2020  g.        ..    
+00012740: 6465 6620 6765 745f 525f 6361 6d53 7464  def get_R_camStd
+00012750: 3275 746d 2873 656c 662c 525f 6361 6d32  2utm(self,R_cam2
+00012760: 6672 616d 653a 6e70 2e61 7272 6179 2c52  frame:np.array,R
+00012770: 5f66 7261 6d65 326e 6564 3a6e 702e 6172  _frame2ned:np.ar
+00012780: 7261 7929 3a0a 2020 2020 2020 2020 2222  ray):.        ""
+00012790: 2220 7265 7472 756e 2072 6f74 6174 696f  " retrun rotatio
+000127a0: 6e20 6d61 7472 6978 2052 2074 7261 6e66  n matrix R tranf
+000127b0: 6f72 6d69 6e67 2066 726f 6d20 6361 6d53  orming from camS
+000127c0: 7464 3a20 2878 2c79 2c7a 203d 2072 6967  td: (x,y,z = rig
+000127d0: 6874 2c62 7574 746f 6d2c 6c69 6e65 206f  ht,buttom,line o
+000127e0: 6620 7369 6768 7429 2074 6f20 7574 6d20  f sight) to utm 
+000127f0: 2878 2c79 2c7a 203d 2065 6173 7469 6e67  (x,y,z = easting
+00012800: 2c6e 6f72 7468 696e 672c 7570 2920 2222  ,northing,up) ""
+00012810: 220a 2020 2020 2020 2020 525f 6361 6d69  ".        R_cami
+00012820: 4644 4f32 6361 6d53 7464 203d 206d 6971  FDO2camStd = miq
+00012830: 7467 2e52 5f59 6177 5069 7463 6852 6f6c  tg.R_YawPitchRol
+00012840: 6c28 3930 2c30 2c30 2920 2320 696e 2069  l(90,0,0) # in i
+00012850: 4644 4f20 6361 6d3a 2028 782c 792c 7a20  FDO cam: (x,y,z 
+00012860: 3d20 746f 702c 7269 6768 742c 6c69 6e65  = top,right,line
+00012870: 206f 6620 7369 6768 7429 2062 7574 2066   of sight) but f
+00012880: 6f72 2070 6f73 6520 7468 6520 2773 7461  or pose the 'sta
+00012890: 6e64 6172 6427 2063 616d 5374 643a 2028  ndard' camStd: (
+000128a0: 782c 792c 7a20 3d20 7269 6768 742c 6275  x,y,z = right,bu
+000128b0: 7474 6f6d 2c6c 696e 6520 6f66 2073 6967  ttom,line of sig
+000128c0: 6874 2920 6973 2065 7870 6563 7465 640a  ht) is expected.
+000128d0: 2020 2020 2020 2020 525f 6361 6d53 7464          R_camStd
+000128e0: 3266 7261 6d65 203d 2052 5f63 616d 3266  2frame = R_cam2f
+000128f0: 7261 6d65 2e64 6f74 2852 5f63 616d 6946  rame.dot(R_camiF
+00012900: 444f 3263 616d 5374 6429 0a20 2020 2020  DO2camStd).     
+00012910: 2020 2052 5f63 616d 5374 6432 6e65 6420     R_camStd2ned 
+00012920: 3d20 525f 6672 616d 6532 6e65 642e 646f  = R_frame2ned.do
+00012930: 7428 525f 6361 6d53 7464 3266 7261 6d65  t(R_camStd2frame
+00012940: 290a 2020 2020 2020 2020 525f 6e65 6432  ).        R_ned2
+00012950: 7574 6d20 3d20 6d69 7174 672e 525f 5859  utm = miqtg.R_XY
+00012960: 5a28 3138 302c 302c 3930 2920 2320 7769  Z(180,0,90) # wi
+00012970: 7468 2075 746d 2078 2c79 2c7a 203d 2065  th utm x,y,z = e
+00012980: 6173 7469 6e67 2c6e 6f72 7468 696e 672c  asting,northing,
+00012990: 7570 0a20 2020 2020 2020 2052 5f63 616d  up.        R_cam
+000129a0: 5374 6432 7574 6d20 3d20 525f 6e65 6432  Std2utm = R_ned2
+000129b0: 7574 6d2e 646f 7428 525f 6361 6d53 7464  utm.dot(R_camStd
+000129c0: 326e 6564 292e 726f 756e 6428 3529 0a20  2ned).round(5). 
+000129d0: 2020 2020 2020 2072 6574 7572 6e20 525f         return R_
+000129e0: 6361 6d53 7464 3275 746d 0a0a 0a20 2020  camStd2utm...   
+000129f0: 2064 6566 2066 696e 644e 6176 4461 7461   def findNavData
+00012a00: 466f 7249 6d61 6765 2873 656c 662c 6461  ForImage(self,da
+00012a10: 7461 3a6d 6971 7467 2e4e 756d 4461 7461  ta:miqtg.NumData
+00012a20: 5469 6d65 5374 616d 7065 642c 7669 6465  TimeStamped,vide
+00012a30: 6f53 616d 706c 6553 6563 6f6e 6473 3d31  oSampleSeconds=1
+00012a40: 293a 0a20 2020 2020 2020 2022 2222 2063  ):.        """ c
+00012a50: 7265 6174 6573 2061 2064 6963 7420 2869  reates a dict (i
+00012a60: 6d61 6765 5f64 7473 2920 7769 7468 2066  mage_dts) with f
+00012a70: 696c 6520 6e61 6d65 2061 7320 6b65 7920  ile name as key 
+00012a80: 616e 6420 6120 6c69 7374 206f 6620 6461  and a list of da
+00012a90: 7461 2065 6c65 6d65 6e74 7320 6173 2076  ta elements as v
+00012aa0: 616c 7565 2e20 0a20 2020 2020 2020 2020  alue. .         
+00012ab0: 2020 2049 6e20 6361 7365 206f 6620 7068     In case of ph
+00012ac0: 6f74 6f73 2074 6865 206c 6973 7420 6861  otos the list ha
+00012ad0: 7320 6f6e 6c79 2061 2073 696e 676c 6520  s only a single 
+00012ae0: 656e 7472 792c 2066 6f72 2076 6964 656f  entry, for video
+00012af0: 7320 6974 2068 6173 2076 6964 656f 2064  s it has video d
+00012b00: 7572 6174 696f 6e20 5b73 6563 5d20 2f20  uration [sec] / 
+00012b10: 7669 6465 6f53 616d 706c 6553 6563 6f6e  videoSampleSecon
+00012b20: 6473 2065 6e74 7269 6573 2e0a 2020 2020  ds entries..    
+00012b30: 2020 2020 2020 2020 5265 7475 726e 7320          Returns 
+00012b40: 7375 6363 6573 732c 2069 6d61 6765 5f64  success, image_d
+00012b50: 7473 2c20 6d73 6720 2222 220a 0a20 2020  ts, msg """..   
+00012b60: 2020 2020 2069 6620 7669 6465 6f53 616d       if videoSam
+00012b70: 706c 6553 6563 6f6e 6473 203c 3d20 303a  pleSeconds <= 0:
+00012b80: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00012b90: 7365 2045 7863 6570 7469 6f6e 2822 6669  se Exception("fi
+00012ba0: 6e64 4e61 7644 6174 6146 6f72 496d 6167  ndNavDataForImag
+00012bb0: 653a 2076 6964 656f 5361 6d70 6c65 5365  e: videoSampleSe
+00012bc0: 636f 6e64 7320 6d75 7374 2062 6520 6772  conds must be gr
+00012bd0: 6561 7465 7220 3022 290a 0a20 2020 2020  eater 0")..     
+00012be0: 2020 2023 2063 7265 6174 6520 736f 7274     # create sort
+00012bf0: 6564 2074 696d 6520 706f 696e 7473 0a20  ed time points. 
+00012c00: 2020 2020 2020 2074 696d 655f 706f 696e         time_poin
+00012c10: 7473 203d 206c 6973 7428 6461 7461 2e6b  ts = list(data.k
+00012c20: 6579 7328 2929 0a20 2020 2020 2020 2074  eys()).        t
+00012c30: 696d 655f 706f 696e 7473 2e73 6f72 7428  ime_points.sort(
+00012c40: 290a 2020 2020 2020 2020 756e 6d61 7463  ).        unmatc
+00012c50: 6865 6454 696d 6550 6f69 6e74 7320 3d20  hedTimePoints = 
+00012c60: 5b5d 0a20 2020 2020 2020 2069 6d61 6765  [].        image
+00012c70: 5f64 7473 203d 207b 7d0a 2020 2020 2020  _dts = {}.      
+00012c80: 2020 7374 6172 7453 6561 7263 6849 6e64    startSearchInd
+00012c90: 6578 203d 2030 0a20 2020 2020 2020 2069  ex = 0.        i
+00012ca0: 6d61 6765 7349 6e52 6177 203d 2020 7365  magesInRaw =  se
+00012cb0: 6c66 2e69 6d61 6765 7349 6e49 6d61 6765  lf.imagesInImage
+00012cc0: 7344 6972 2829 0a20 2020 2020 2020 2069  sDir().        i
+00012cd0: 6d61 6765 7349 6e52 6177 536f 7274 6564  magesInRawSorted
+00012ce0: 4c69 7374 203d 2073 656c 662e 696d 6167  List = self.imag
+00012cf0: 6573 496e 496d 6167 6573 4469 7253 6f72  esInImagesDirSor
+00012d00: 7465 644c 6973 7428 290a 2020 2020 2020  tedList().      
+00012d10: 2020 7072 6f67 203d 206d 6971 7463 2e50    prog = miqtc.P
+00012d20: 7269 6e74 4b6e 6f77 6e50 726f 6772 6573  rintKnownProgres
+00012d30: 734d 7367 2822 496e 7465 7270 6f6c 6174  sMsg("Interpolat
+00012d40: 696e 6720 6e61 7669 6761 7469 6f6e 2066  ing navigation f
+00012d50: 6f72 2069 6d61 6765 222c 206c 656e 2869  or image", len(i
+00012d60: 6d61 6765 7349 6e52 6177 292c 6d6f 6475  magesInRaw),modu
+00012d70: 6c6f 3d31 290a 2020 2020 2020 2020 666f  lo=1).        fo
+00012d80: 7220 6669 6c65 2069 6e20 696d 6167 6573  r file in images
+00012d90: 496e 5261 7753 6f72 7465 644c 6973 743a  InRawSortedList:
+00012da0: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
+00012db0: 672e 7072 6f67 7265 7373 2829 0a20 2020  g.progress().   
+00012dc0: 2020 2020 2020 2020 2066 696c 655f 6e61           file_na
+00012dd0: 6d65 203d 206f 732e 7061 7468 2e62 6173  me = os.path.bas
+00012de0: 656e 616d 6528 6669 6c65 290a 0a20 2020  ename(file)..   
+00012df0: 2020 2020 2020 2020 2064 745f 696d 6167           dt_imag
+00012e00: 6520 3d20 6d69 7174 632e 7061 7273 6546  e = miqtc.parseF
+00012e10: 696c 6544 6174 6554 696d 6541 7355 5443  ileDateTimeAsUTC
+00012e20: 2866 696c 655f 6e61 6d65 290a 2020 2020  (file_name).    
+00012e30: 2020 2020 2020 2020 6474 5f69 6d61 6765          dt_image
+00012e40: 5f74 7320 3d20 696e 7428 6474 5f69 6d61  _ts = int(dt_ima
+00012e50: 6765 2e74 696d 6573 7461 6d70 2829 202a  ge.timestamp() *
+00012e60: 2031 3030 3029 0a0a 2020 2020 2020 2020   1000)..        
+00012e70: 2020 2020 7275 6e54 696d 6520 3d20 696d      runTime = im
+00012e80: 6167 6573 496e 5261 775b 6669 6c65 5d5b  agesInRaw[file][
+00012e90: 315d 2023 202d 3120 666f 7220 7068 6f74  1] # -1 for phot
+00012ea0: 6f73 0a20 2020 2020 2020 2020 2020 2023  os.            #
+00012eb0: 2076 6964 656f 0a20 2020 2020 2020 2020   video.         
+00012ec0: 2020 2069 6620 696d 6167 6573 496e 5261     if imagesInRa
+00012ed0: 775b 6669 6c65 5d5b 325d 2069 6e20 6d69  w[file][2] in mi
+00012ee0: 7174 762e 7669 6465 6f5f 7479 7065 7320  qtv.video_types 
+00012ef0: 616e 6420 7275 6e54 696d 6520 3c3d 2030  and runTime <= 0
+00012f00: 3a20 2320 6578 740a 2020 2020 2020 2020  : # ext.        
+00012f10: 2020 2020 2020 2020 7072 696e 7428 2243          print("C
+00012f20: 6175 7469 6f6e 2120 436f 756c 6420 6e6f  aution! Could no
+00012f30: 7420 7265 6164 2076 6964 656f 2072 756e  t read video run
+00012f40: 2074 696d 6520 6672 6f6d 2066 696c 6522   time from file"
+00012f50: 2c66 696c 6529 2023 2054 4f44 4f20 646f  ,file) # TODO do
+00012f60: 6573 2074 6869 7320 6861 7070 656e 3f20  es this happen? 
+00012f70: 4861 6e64 6c65 2062 6574 7465 723f 0a0a  Handle better?..
+00012f80: 2020 2020 2020 2020 2020 2020 7361 6d70              samp
+00012f90: 6c65 5469 6d65 5365 6373 203d 2030 0a20  leTimeSecs = 0. 
+00012fa0: 2020 2020 2020 2020 2020 2070 6f73 5f6c             pos_l
+00012fb0: 6973 7420 3d20 5b5d 0a20 2020 2020 2020  ist = [].       
+00012fc0: 2020 2020 2067 6f20 3d20 5472 7565 0a20       go = True. 
+00012fd0: 2020 2020 2020 2020 2020 2077 6869 6c65             while
+00012fe0: 2067 6f3a 0a20 2020 2020 2020 2020 2020   go:.           
+00012ff0: 2020 2020 2074 7279 3a20 2020 2020 2020       try:       
+00013000: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+00013010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013020: 2020 706f 732c 2073 7461 7274 5365 6172    pos, startSear
+00013030: 6368 496e 6465 7820 3d20 6461 7461 2e69  chIndex = data.i
+00013040: 6e74 6572 706f 6c61 7465 4174 5469 6d65  nterpolateAtTime
+00013050: 2864 745f 696d 6167 655f 7473 202b 2073  (dt_image_ts + s
+00013060: 616d 706c 6554 696d 6553 6563 7320 2a20  ampleTimeSecs * 
+00013070: 3130 3030 2c74 696d 655f 706f 696e 7473  1000,time_points
+00013080: 2c73 7461 7274 5365 6172 6368 496e 6465  ,startSearchInde
+00013090: 7829 0a20 2020 2020 2020 2020 2020 2020  x).             
+000130a0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+000130b0: 2020 2020 2020 2020 2020 2020 2320 696e              # in
+000130c0: 7465 7270 6f6c 6174 6541 7454 696d 6520  terpolateAtTime 
+000130d0: 7265 7475 726e 7320 4e6f 6e65 2076 616c  returns None val
+000130e0: 7565 7320 6966 2074 696d 6520 6f75 7420  ues if time out 
+000130f0: 6f66 2072 616e 6765 0a20 2020 2020 2020  of range.       
+00013100: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00013110: 706f 732e 636f 7461 696e 734e 6f6e 6556  pos.cotainsNoneV
+00013120: 616c 7565 7349 6e52 6571 7569 7265 6446  aluesInRequiredF
+00013130: 6965 6c64 7328 293a 0a20 2020 2020 2020  ields():.       
+00013140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013150: 2075 6e6d 6174 6368 6564 5469 6d65 506f   unmatchedTimePo
+00013160: 696e 7473 2e61 7070 656e 6428 2864 745f  ints.append((dt_
+00013170: 696d 6167 655f 7473 202b 2073 616d 706c  image_ts + sampl
+00013180: 6554 696d 6553 6563 7320 2a20 3130 3030  eTimeSecs * 1000
+00013190: 292f 3130 3030 290a 2020 2020 2020 2020  )/1000).        
+000131a0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000131b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000131c0: 2020 2020 2020 2020 2020 706f 735f 6c69            pos_li
+000131d0: 7374 2e61 7070 656e 6428 706f 7329 0a20  st.append(pos). 
+000131e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000131f0: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
+00013200: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+00013210: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00013220: 2046 616c 7365 2c20 696d 6167 655f 6474   False, image_dt
+00013230: 732c 2022 436f 756c 6420 6e6f 7420 6669  s, "Could not fi
+00013240: 6e64 2069 6d61 6765 2074 696d 6520 222b  nd image time "+
+00013250: 2064 6174 6574 696d 652e 6461 7465 7469   datetime.dateti
+00013260: 6d65 2e75 7463 6672 6f6d 7469 6d65 7374  me.utcfromtimest
+00013270: 616d 7028 2864 745f 696d 6167 655f 7473  amp((dt_image_ts
+00013280: 202b 2073 616d 706c 6554 696d 6553 6563   + sampleTimeSec
+00013290: 7320 2a20 3130 3030 292f 3130 3030 292e  s * 1000)/1000).
+000132a0: 7374 7266 7469 6d65 286d 6971 7476 2e64  strftime(miqtv.d
+000132b0: 6174 655f 666f 726d 6174 735b 276d 6172  ate_formats['mar
+000132c0: 6971 7427 5d29 202b 2220 696e 2022 2b73  iqt']) +" in "+s
+000132d0: 7472 2864 6174 612e 6c65 6e28 2929 2b22  tr(data.len())+"
+000132e0: 2064 6174 6120 706f 7369 7469 6f6e 7322   data positions"
+000132f0: 202b 2073 7472 2865 2e61 7267 7329 0a20   + str(e.args). 
+00013300: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00013310: 616d 706c 6554 696d 6553 6563 7320 2b3d  ampleTimeSecs +=
+00013320: 2076 6964 656f 5361 6d70 6c65 5365 636f   videoSampleSeco
+00013330: 6e64 730a 2020 2020 2020 2020 2020 2020  nds.            
+00013340: 2020 2020 6966 2073 616d 706c 6554 696d      if sampleTim
+00013350: 6553 6563 7320 3e20 7275 6e54 696d 653a  eSecs > runTime:
+00013360: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013370: 2020 2020 2067 6f20 3d20 4661 6c73 650a       go = False.
+00013380: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00013390: 2020 2020 2020 2020 2069 6d61 6765 5f64           image_d
+000133a0: 7473 5b66 696c 655f 6e61 6d65 5d20 3d20  ts[file_name] = 
+000133b0: 706f 735f 6c69 7374 0a20 2020 2020 2020  pos_list.       
+000133c0: 2070 726f 672e 636c 6561 7228 290a 2020   prog.clear().  
+000133d0: 2020 2020 2020 7265 7475 726e 4d73 6720        returnMsg 
+000133e0: 3d20 2222 0a20 2020 2020 2020 2069 6620  = "".        if 
+000133f0: 6c65 6e28 756e 6d61 7463 6865 6454 696d  len(unmatchedTim
+00013400: 6550 6f69 6e74 7329 2021 3d20 303a 0a20  ePoints) != 0:. 
+00013410: 2020 2020 2020 2020 2020 2075 6e6d 6174             unmat
+00013420: 6368 6564 5469 6d65 506f 696e 7473 2e73  chedTimePoints.s
+00013430: 6f72 7428 290a 2020 2020 2020 2020 2020  ort().          
+00013440: 2020 756e 6d61 7463 6865 6454 696d 6550    unmatchedTimeP
+00013450: 6f69 6e74 7320 3d20 5b64 6174 6574 696d  oints = [datetim
+00013460: 652e 6461 7465 7469 6d65 2e75 7463 6672  e.datetime.utcfr
+00013470: 6f6d 7469 6d65 7374 616d 7028 7473 292e  omtimestamp(ts).
+00013480: 7374 7266 7469 6d65 286d 6971 7476 2e64  strftime(miqtv.d
+00013490: 6174 655f 666f 726d 6174 735b 276d 6172  ate_formats['mar
+000134a0: 6971 7427 5d29 2066 6f72 2074 7320 696e  iqt']) for ts in
+000134b0: 2075 6e6d 6174 6368 6564 5469 6d65 506f   unmatchedTimePo
+000134c0: 696e 7473 5d0a 2020 2020 2020 2020 2020  ints].          
+000134d0: 2020 7265 7475 726e 4d73 6720 3d20 2243    returnMsg = "C
+000134e0: 4155 5449 4f4e 2120 4e61 7669 6761 7469  AUTION! Navigati
+000134f0: 6f6e 206e 6f74 2066 6f75 6e64 2066 6f72  on not found for
+00013500: 2074 6865 2066 6f6c 6c6f 7769 6e67 2069   the following i
+00013510: 6d61 6765 2074 696d 6520 706f 696e 7473  mage time points
+00013520: 2e20 446f 7562 6c65 2063 6865 636b 206f  . Double check o
+00013530: 7220 7072 6f76 6964 6520 6174 206c 6561  r provide at lea
+00013540: 7374 2073 7461 7469 6320 6465 6661 756c  st static defaul
+00013550: 7420 6e61 7669 6761 7469 6f6e 2069 6e20  t navigation in 
+00013560: 6865 6164 6572 2066 6965 6c64 732e 220a  header fields.".
+00013570: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00013580: 726e 4d73 6720 2b3d 2022 5c6e 2220 2b20  rnMsg += "\n" + 
+00013590: 225c 6e22 2e6a 6f69 6e28 756e 6d61 7463  "\n".join(unmatc
+000135a0: 6865 6454 696d 6550 6f69 6e74 7329 0a20  hedTimePoints). 
+000135b0: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+000135c0: 7565 2c20 696d 6167 655f 6474 732c 2072  ue, image_dts, r
+000135d0: 6574 7572 6e4d 7367 0a0a 0a20 2020 2064  eturnMsg...    d
+000135e0: 6566 2063 7265 6174 6549 6d61 6765 4e61  ef createImageNa
+000135f0: 7669 6761 7469 6f6e 4669 6c65 2873 656c  vigationFile(sel
+00013600: 662c 206e 6176 5f70 6174 683a 2073 7472  f, nav_path: str
+00013610: 2c20 6e61 765f 6865 6164 6572 3d6d 6971  , nav_header=miq
+00013620: 7476 2e70 6f73 5f68 6561 6465 725b 2770  tv.pos_header['p
+00013630: 616e 6761 6561 275d 2c20 6461 7465 5f66  angaea'], date_f
+00013640: 6f72 6d61 743d 6d69 7174 762e 6461 7465  ormat=miqtv.date
+00013650: 5f66 6f72 6d61 7473 5b27 7061 6e67 6165  _formats['pangae
+00013660: 6127 5d2c 206f 7665 7277 7269 7465 3d46  a'], overwrite=F
+00013670: 616c 7365 2c20 636f 6c5f 7365 7061 7261  alse, col_separa
+00013680: 746f 7220 3d20 225c 7422 2c20 7669 6465  tor = "\t", vide
+00013690: 6f53 616d 706c 6553 6563 6f6e 6473 3d31  oSampleSeconds=1
+000136a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000136b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000136c0: 2020 2020 2020 6f66 6673 6574 5f78 3d30        offset_x=0
+000136d0: 2c20 6f66 6673 6574 5f79 3d30 2c20 6f66  , offset_y=0, of
+000136e0: 6673 6574 5f7a 3d30 2c61 6e67 6c65 735f  fset_z=0,angles_
+000136f0: 696e 5f72 6164 203d 2046 616c 7365 2c20  in_rad = False, 
+00013700: 7265 636f 7264 7332 6265 496e 7665 7274  records2beInvert
+00013710: 6564 3d5b 5d29 3a0a 2020 2020 2020 2020  ed=[]):.        
+00013720: 2222 2220 4372 6561 7465 7320 696e 202f  """ Creates in /
+00013730: 696e 7465 726d 6564 6961 7465 2061 2074  intermediate a t
+00013740: 6578 7420 6669 6c65 2077 6974 6820 342e  ext file with 4.
+00013750: 3544 206e 6176 6967 6174 696f 6e20 6461  5D navigation da
+00013760: 7461 2066 6f72 2065 6163 6820 696d 6167  ta for each imag
+00013770: 652c 2069 2e65 2e20 6120 7369 6e67 6c65  e, i.e. a single
+00013780: 2072 6f77 2070 6572 2070 686f 746f 2c20   row per photo, 
+00013790: 7669 6465 6f20 6475 7261 7469 6f6e 205b  video duration [
+000137a0: 7365 635d 202f 2076 6964 656f 5361 6d70  sec] / videoSamp
+000137b0: 6c65 5365 636f 6e64 7320 726f 7773 2070  leSeconds rows p
+000137c0: 6572 2076 6964 656f 2e0a 2020 2020 2020  er video..      
+000137d0: 2020 2020 2020 6e61 765f 6865 6164 6572        nav_header
+000137e0: 206d 7573 7420 6265 2064 6963 7420 636f   must be dict co
+000137f0: 6e74 6169 6e69 6e67 2074 6865 206b 6579  ntaining the key
+00013800: 7320 2775 7463 272c 276c 6174 272c 276c  s 'utc','lat','l
+00013810: 6f6e 272c 2764 6570 2728 6f72 2027 616c  on','dep'(or 'al
+00013820: 7427 292c 206f 7074 696f 6e61 6c3a 2027  t'), optional: '
+00013830: 6867 7427 2c27 756e 6365 7274 2720 7769  hgt','uncert' wi
+00013840: 7468 2074 6865 2072 6573 7065 6374 6976  th the respectiv
+00013850: 6520 636f 6c75 6d6e 2068 6561 6465 7273  e column headers
+00013860: 2061 7320 7661 6c75 6573 200a 2020 2020   as values .    
+00013870: 2020 2020 2020 2020 6966 206f 6e65 206f          if one o
+00013880: 6620 7468 6520 7665 6869 636c 6520 782c  f the vehicle x,
+00013890: 792c 7a20 6f66 6673 6574 7320 5b6d 5d20  y,z offsets [m] 
+000138a0: 6973 206e 6f74 2030 2061 6e64 206e 6176  is not 0 and nav
+000138b0: 5f68 6561 6465 7220 616c 736f 2063 6f6e  _header also con
+000138c0: 7461 696e 7320 2779 6177 272c 2770 6974  tains 'yaw','pit
+000138d0: 6368 272c 2772 6f6c 6c27 206c 6576 6572  ch','roll' lever
+000138e0: 6172 6d20 6f66 6673 6574 7320 6172 6520  arm offsets are 
+000138f0: 636f 6d70 656e 7361 7465 6420 666f 7220  compensated for 
+00013900: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
+00013910: 7365 6c66 2e69 6e74 6572 6d65 6469 6174  self.intermediat
+00013920: 654e 6176 4669 6c65 4578 6973 7473 2829  eNavFileExists()
+00013930: 2061 6e64 206e 6f74 206f 7665 7277 7269   and not overwri
+00013940: 7465 3a0a 2020 2020 2020 2020 2020 2020  te:.            
+00013950: 7265 7475 726e 2054 7275 652c 2022 4f75  return True, "Ou
+00013960: 7470 7574 2066 696c 6520 6578 6973 7473  tput file exists
+00013970: 3a20 222b 7365 6c66 2e67 6574 5f69 6e74  : "+self.get_int
+00013980: 5f6e 6176 5f66 696c 6528 290a 0a20 2020  _nav_file()..   
+00013990: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
+000139a0: 6174 682e 6578 6973 7473 286e 6176 5f70  ath.exists(nav_p
+000139b0: 6174 6829 3a0a 2020 2020 2020 2020 2020  ath):.          
+000139c0: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
+000139d0: 224e 6176 6967 6174 696f 6e20 6669 6c65  "Navigation file
+000139e0: 206e 6f74 2066 6f75 6e64 3a20 222b 6e61   not found: "+na
+000139f0: 765f 7061 7468 0a0a 2020 2020 2020 2020  v_path..        
+00013a00: 6966 206e 6f74 206f 732e 7061 7468 2e65  if not os.path.e
+00013a10: 7869 7374 7328 7365 6c66 2e69 6d61 6765  xists(self.image
+00013a20: 7344 6972 293a 0a20 2020 2020 2020 2020  sDir):.         
+00013a30: 2020 2072 6574 7572 6e20 4661 6c73 652c     return False,
+00013a40: 2022 496d 6167 6520 666f 6c64 6572 206e   "Image folder n
+00013a50: 6f74 2066 6f75 6e64 3a20 222b 2073 656c  ot found: "+ sel
+00013a60: 662e 696d 6167 6573 4469 720a 0a20 2020  f.imagesDir..   
+00013a70: 2020 2020 2073 203d 206d 6971 7463 2e50       s = miqtc.P
+00013a80: 7269 6e74 4c6f 6164 696e 674d 7367 2822  rintLoadingMsg("
+00013a90: 4372 6561 7469 6e67 2069 7465 6d73 2720  Creating items' 
+00013aa0: 6e61 7669 6761 7469 6f6e 2064 6174 6122  navigation data"
+00013ab0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00013ac0: 4d73 6720 3d20 2222 0a20 2020 2020 2020  Msg = "".       
+00013ad0: 2063 6f6d 7065 6e73 6174 4f66 6673 6574   compensatOffset
+00013ae0: 7320 3d20 4661 6c73 650a 2020 2020 2020  s = False.      
+00013af0: 2020 6966 2028 6f66 6673 6574 5f78 213d    if (offset_x!=
+00013b00: 3020 6f72 206f 6666 7365 745f 7921 3d30  0 or offset_y!=0
+00013b10: 206f 7220 6f66 6673 6574 5f7a 213d 3029   or offset_z!=0)
+00013b20: 2061 6e64 2027 7961 7727 2069 6e20 6e61   and 'yaw' in na
+00013b30: 765f 6865 6164 6572 2061 6e64 2027 7069  v_header and 'pi
+00013b40: 7463 6827 2069 6e20 6e61 765f 6865 6164  tch' in nav_head
+00013b50: 6572 2061 6e64 2027 726f 6c6c 2720 696e  er and 'roll' in
+00013b60: 206e 6176 5f68 6561 6465 723a 0a20 2020   nav_header:.   
+00013b70: 2020 2020 2020 2020 2063 6f6d 7065 6e73           compens
+00013b80: 6174 4f66 6673 6574 7320 3d20 5472 7565  atOffsets = True
+00013b90: 0a0a 2020 2020 2020 2020 2320 6368 6563  ..        # chec
+00013ba0: 6b20 6966 2066 6f72 206d 6973 7369 6e67  k if for missing
+00013bb0: 2066 6965 6c64 7320 7468 6572 6520 6172   fields there ar
+00013bc0: 6520 636f 6e73 7420 7661 6c75 6573 2069  e const values i
+00013bd0: 6e20 6865 6164 6572 0a20 2020 2020 2020  n header.       
+00013be0: 2063 6f6e 7374 5f76 616c 7565 7320 3d20   const_values = 
+00013bf0: 7b7d 0a20 2020 2020 2020 2066 6f72 206e  {}.        for n
+00013c00: 6176 4669 656c 6420 696e 206d 6971 7476  avField in miqtv
+00013c10: 2e70 6f73 5f68 6561 6465 725b 276d 6172  .pos_header['mar
+00013c20: 6971 7427 5d3a 0a20 2020 2020 2020 2020  iqt']:.         
+00013c30: 2020 2072 6573 7065 6374 6976 6548 6561     respectiveHea
+00013c40: 6465 7246 6965 6c64 203d 206d 6971 7476  derField = miqtv
+00013c50: 2e63 6f6c 5f68 6561 6465 725b 226d 6172  .col_header["mar
+00013c60: 6971 7422 5d5b 6e61 7646 6965 6c64 5d0a  iqt"][navField].
+00013c70: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00013c80: 6176 4669 656c 6420 6e6f 7420 696e 206e  avField not in n
+00013c90: 6176 5f68 6561 6465 7220 616e 6420 2872  av_header and (r
+00013ca0: 6573 7065 6374 6976 6548 6561 6465 7246  espectiveHeaderF
+00013cb0: 6965 6c64 2069 6e20 7365 6c66 2e69 6664  ield in self.ifd
+00013cc0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
+00013cd0: 5365 7448 6561 6465 724b 6579 5d20 616e  SetHeaderKey] an
+00013ce0: 6420 7365 6c66 2e66 696e 6454 6d70 4669  d self.findTmpFi
+00013cf0: 656c 6432 2872 6573 7065 6374 6976 6548  eld2(respectiveH
+00013d00: 6561 6465 7246 6965 6c64 2920 213d 2022  eaderField) != "
+00013d10: 2229 3a20 0a20 2020 2020 2020 2020 2020  "): .           
+00013d20: 2020 2020 2063 6f6e 7374 5f76 616c 7565       const_value
+00013d30: 735b 6e61 7646 6965 6c64 5d20 3d20 7365  s[navField] = se
+00013d40: 6c66 2e66 696e 6454 6d70 4669 656c 6428  lf.findTmpField(
+00013d50: 7265 7370 6563 7469 7665 4865 6164 6572  respectiveHeader
+00013d60: 4669 656c 6429 0a0a 2020 2020 2020 2020  Field)..        
+00013d70: 2320 4c6f 6164 206e 6176 6967 6174 696f  # Load navigatio
+00013d80: 6e20 6461 7461 0a20 2020 2020 2020 206e  n data.        n
+00013d90: 6176 5f64 6174 612c 2070 6172 7365 4d73  av_data, parseMs
+00013da0: 6720 3d20 6d69 7174 6e2e 7265 6164 416c  g = miqtn.readAl
+00013db0: 6c50 6f73 6974 696f 6e73 4672 6f6d 4669  lPositionsFromFi
+00013dc0: 6c65 5061 7468 286e 6176 5f70 6174 682c  lePath(nav_path,
+00013dd0: 206e 6176 5f68 6561 6465 722c 2064 6174   nav_header, dat
+00013de0: 655f 666f 726d 6174 2c63 6f6c 5f73 6570  e_format,col_sep
+00013df0: 6172 6174 6f72 3d63 6f6c 5f73 6570 6172  arator=col_separ
+00013e00: 6174 6f72 2c63 6f6e 7374 5f76 616c 7565  ator,const_value
+00013e10: 733d 636f 6e73 745f 7661 6c75 6573 290a  s=const_values).
+00013e20: 2020 2020 2020 2020 6966 2070 6172 7365          if parse
+00013e30: 4d73 6720 213d 2022 223a 0a20 2020 2020  Msg != "":.     
+00013e40: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+00013e50: 2e6c 6f67 2870 6172 7365 4d73 672c 646f  .log(parseMsg,do
+00013e60: 6e74 5368 6f77 3d54 7275 6529 0a20 2020  ntShow=True).   
+00013e70: 2020 2020 2020 2020 2072 6574 7572 6e4d           returnM
+00013e80: 7367 203d 2022 5c6e 2220 2b20 7061 7273  sg = "\n" + pars
+00013e90: 654d 7367 0a0a 2020 2020 2020 2020 2320  eMsg..        # 
+00013ea0: 6669 6e64 2066 6f72 2065 6163 6820 696d  find for each im
+00013eb0: 6167 6520 7468 6520 7265 7370 6563 7469  age the respecti
+00013ec0: 7665 206e 6176 6967 6174 696f 6e20 6461  ve navigation da
+00013ed0: 7461 0a20 2020 2020 2020 2073 2e73 746f  ta.        s.sto
+00013ee0: 7028 290a 2020 2020 2020 2020 7375 6363  p().        succ
+00013ef0: 6573 732c 2069 6d61 6765 5f64 7473 2c20  ess, image_dts, 
+00013f00: 6d73 6720 3d20 7365 6c66 2e66 696e 644e  msg = self.findN
+00013f10: 6176 4461 7461 466f 7249 6d61 6765 286e  avDataForImage(n
+00013f20: 6176 5f64 6174 612c 7669 6465 6f53 616d  av_data,videoSam
+00013f30: 706c 6553 6563 6f6e 6473 290a 2020 2020  pleSeconds).    
+00013f40: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+00013f50: 6728 6d73 672c 646f 6e74 5368 6f77 3d54  g(msg,dontShow=T
+00013f60: 7275 6529 0a20 2020 2020 2020 2069 6620  rue).        if 
+00013f70: 6d73 6720 213d 2022 223a 0a20 2020 2020  msg != "":.     
+00013f80: 2020 2020 2020 2072 6574 7572 6e4d 7367         returnMsg
+00013f90: 202b 3d20 225c 6e22 202b 206d 7367 0a20   += "\n" + msg. 
+00013fa0: 2020 2020 2020 2069 6620 6e6f 7420 7375         if not su
+00013fb0: 6363 6573 733a 0a20 2020 2020 2020 2020  ccess:.         
+00013fc0: 2020 2072 6574 7572 6e20 4661 6c73 652c     return False,
+00013fd0: 2072 6574 7572 6e4d 7367 0a20 2020 2020   returnMsg.     
+00013fe0: 2020 2073 203d 206d 6971 7463 2e50 7269     s = miqtc.Pri
+00013ff0: 6e74 4c6f 6164 696e 674d 7367 2822 4372  ntLoadingMsg("Cr
+00014000: 6561 7469 6e67 2069 7465 6d73 2720 6e61  eating items' na
+00014010: 7669 6761 7469 6f6e 2064 6174 6122 290a  vigation data").
+00014020: 0a20 2020 2020 2020 2023 2063 6f6d 7065  .        # compe
+00014030: 6e73 6174 6520 6c65 7665 7261 726d 206f  nsate leverarm o
+00014040: 6666 7365 7473 0a20 2020 2020 2020 2069  ffsets.        i
+00014050: 6620 636f 6d70 656e 7361 744f 6666 7365  f compensatOffse
+00014060: 7473 3a0a 0a20 2020 2020 2020 2020 2020  ts:..           
+00014070: 2023 206c 6f61 6420 6672 616d 6520 6174   # load frame at
+00014080: 7469 7475 6465 2064 6174 6120 6672 6f6d  titude data from
+00014090: 2066 696c 650a 2020 2020 2020 2020 2020   file.          
+000140a0: 2020 6174 745f 6461 7461 2c20 7061 7273    att_data, pars
+000140b0: 654d 7367 203d 206d 6971 746e 2e72 6561  eMsg = miqtn.rea
+000140c0: 6441 6c6c 4174 7469 7475 6465 7346 726f  dAllAttitudesFro
+000140d0: 6d46 696c 6550 6174 6828 6e61 765f 7061  mFilePath(nav_pa
+000140e0: 7468 2c20 6e61 765f 6865 6164 6572 2c20  th, nav_header, 
+000140f0: 6461 7465 5f66 6f72 6d61 742c 636f 6c5f  date_format,col_
+00014100: 7365 7061 7261 746f 723d 636f 6c5f 7365  separator=col_se
+00014110: 7061 7261 746f 722c 636f 6e73 745f 7661  parator,const_va
+00014120: 6c75 6573 3d63 6f6e 7374 5f76 616c 7565  lues=const_value
+00014130: 732c 616e 676c 6573 496e 5261 643d 616e  s,anglesInRad=an
+00014140: 676c 6573 5f69 6e5f 7261 6429 0a20 2020  gles_in_rad).   
+00014150: 2020 2020 2020 2020 2069 6620 7061 7273           if pars
+00014160: 654d 7367 2021 3d20 2222 3a0a 2020 2020  eMsg != "":.    
+00014170: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00014180: 2e70 726f 762e 6c6f 6728 7061 7273 654d  .prov.log(parseM
+00014190: 7367 2c64 6f6e 7453 686f 773d 5472 7565  sg,dontShow=True
+000141a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000141b0: 2020 7265 7475 726e 4d73 6720 2b3d 2022    returnMsg += "
+000141c0: 5c6e 2220 2b20 7061 7273 654d 7367 0a0a  \n" + parseMsg..
+000141d0: 2020 2020 2020 2020 2020 2020 2320 6669              # fi
+000141e0: 6e64 2066 6f72 2065 6163 6820 696d 6167  nd for each imag
+000141f0: 6520 7468 6520 7265 7370 6563 7469 7665  e the respective
+00014200: 206e 6176 6967 6174 696f 6e20 6461 7461   navigation data
+00014210: 0a20 2020 2020 2020 2020 2020 2073 7563  .            suc
+00014220: 6365 7373 2c20 696d 6167 655f 6474 735f  cess, image_dts_
+00014230: 6174 742c 206d 7367 203d 2073 656c 662e  att, msg = self.
+00014240: 6669 6e64 4e61 7644 6174 6146 6f72 496d  findNavDataForIm
+00014250: 6167 6528 6174 745f 6461 7461 2c76 6964  age(att_data,vid
+00014260: 656f 5361 6d70 6c65 5365 636f 6e64 7329  eoSampleSeconds)
+00014270: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00014280: 662e 7072 6f76 2e6c 6f67 286d 7367 2c64  f.prov.log(msg,d
+00014290: 6f6e 7453 686f 773d 5472 7565 290a 2020  ontShow=True).  
+000142a0: 2020 2020 2020 2020 2020 6966 206d 7367            if msg
+000142b0: 2021 3d20 2222 3a0a 2020 2020 2020 2020   != "":.        
+000142c0: 2020 2020 2020 2020 7265 7475 726e 4d73          returnMs
+000142d0: 6720 2b3d 2022 5c6e 2220 2b20 6d73 670a  g += "\n" + msg.
+000142e0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+000142f0: 6f74 2073 7563 6365 7373 3a0a 2020 2020  ot success:.    
+00014300: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00014310: 726e 2046 616c 7365 2c20 7265 7475 726e  rn False, return
+00014320: 4d73 670a 0a20 2020 2020 2020 2020 2020  Msg..           
+00014330: 2023 2063 6f6d 7065 6e73 6174 650a 2020   # compensate.  
+00014340: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
+00014350: 6c65 2069 6e20 696d 6167 655f 6474 733a  le in image_dts:
+00014360: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014370: 2070 6f73 6974 696f 6e73 203d 2069 6d61   positions = ima
+00014380: 6765 5f64 7473 5b66 696c 655d 0a20 2020  ge_dts[file].   
+00014390: 2020 2020 2020 2020 2020 2020 2061 7474               att
+000143a0: 6974 7564 6573 203d 2069 6d61 6765 5f64  itudes = image_d
+000143b0: 7473 5f61 7474 5b66 696c 655d 0a20 2020  ts_att[file].   
+000143c0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+000143d0: 2069 2069 6e20 7261 6e67 6528 6c65 6e28   i in range(len(
+000143e0: 706f 7369 7469 6f6e 7329 293a 0a20 2020  positions)):.   
+000143f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014400: 206c 6174 203d 2070 6f73 6974 696f 6e73   lat = positions
+00014410: 5b69 5d2e 6c61 740a 2020 2020 2020 2020  [i].lat.        
+00014420: 2020 2020 2020 2020 2020 2020 6c6f 6e20              lon 
+00014430: 3d20 706f 7369 7469 6f6e 735b 695d 2e6c  = positions[i].l
+00014440: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
+00014450: 2020 2020 2020 2064 6570 203d 2070 6f73         dep = pos
+00014460: 6974 696f 6e73 5b69 5d2e 6465 700a 2020  itions[i].dep.  
+00014470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014480: 2020 6966 2027 616c 7427 2069 6e20 6e61    if 'alt' in na
+00014490: 765f 6865 6164 6572 2061 6e64 206e 6f74  v_header and not
+000144a0: 2027 6465 7027 2069 6e20 6e61 765f 6865   'dep' in nav_he
+000144b0: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
+000144c0: 2020 2020 2020 2020 2020 2020 2020 6465                de
+000144d0: 7020 2a3d 202d 310a 2020 2020 2020 2020  p *= -1.        
+000144e0: 2020 2020 2020 2020 2020 2020 7961 7720              yaw 
+000144f0: 3d20 6174 7469 7475 6465 735b 695d 2e79  = attitudes[i].y
+00014500: 6177 0a20 2020 2020 2020 2020 2020 2020  aw.             
+00014510: 2020 2020 2020 2070 6974 6368 203d 2061         pitch = a
+00014520: 7474 6974 7564 6573 5b69 5d2e 7069 7463  ttitudes[i].pitc
+00014530: 680a 2020 2020 2020 2020 2020 2020 2020  h.              
+00014540: 2020 2020 2020 726f 6c6c 203d 2061 7474        roll = att
+00014550: 6974 7564 6573 5b69 5d2e 726f 6c6c 0a20  itudes[i].roll. 
+00014560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014570: 2020 2069 6620 7961 7720 6973 204e 6f6e     if yaw is Non
+00014580: 6520 6f72 2070 6974 6368 2069 7320 4e6f  e or pitch is No
+00014590: 6e65 206f 7220 726f 6c6c 2069 7320 4e6f  ne or roll is No
+000145a0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000145b0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+000145c0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+000145d0: 2020 2020 2020 2020 206e 6577 5f6c 6174           new_lat
+000145e0: 2c6e 6577 5f6c 6f6e 2c6e 6577 5f64 6570  ,new_lon,new_dep
+000145f0: 203d 206d 6971 7467 2e61 6464 4c65 7665   = miqtg.addLeve
+00014600: 7261 726d 7332 4c61 746c 6f6e 286c 6174  rarms2Latlon(lat
+00014610: 2c6c 6f6e 2c64 6570 2c6f 6666 7365 745f  ,lon,dep,offset_
+00014620: 782c 6f66 6673 6574 5f79 2c6f 6666 7365  x,offset_y,offse
+00014630: 745f 7a2c 7961 772c 7069 7463 682c 726f  t_z,yaw,pitch,ro
+00014640: 6c6c 290a 2020 2020 2020 2020 2020 2020  ll).            
+00014650: 2020 2020 2020 2020 706f 7369 7469 6f6e          position
+00014660: 735b 695d 2e6c 6174 203d 206e 6577 5f6c  s[i].lat = new_l
+00014670: 6174 0a20 2020 2020 2020 2020 2020 2020  at.             
+00014680: 2020 2020 2020 2070 6f73 6974 696f 6e73         positions
+00014690: 5b69 5d2e 6c6f 6e20 3d20 6e65 775f 6c6f  [i].lon = new_lo
+000146a0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+000146b0: 2020 2020 2020 706f 7369 7469 6f6e 735b        positions[
+000146c0: 695d 2e64 6570 203d 206e 6577 5f64 6570  i].dep = new_dep
+000146d0: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+000146e0: 6c66 2e70 726f 762e 6c6f 6728 2261 7070  lf.prov.log("app
+000146f0: 6c69 6564 206c 6576 6572 2061 726d 2063  lied lever arm c
+00014700: 6f6d 7065 6e73 6174 696f 6e20 782c 792c  ompensation x,y,
+00014710: 7a20 3d20 2220 2b20 7374 7228 6f66 6673  z = " + str(offs
+00014720: 6574 5f78 2920 2b20 222c 2220 2b20 7374  et_x) + "," + st
+00014730: 7228 6f66 6673 6574 5f79 2920 2b20 222c  r(offset_y) + ",
+00014740: 2220 2b20 7374 7228 6f66 6673 6574 5f7a  " + str(offset_z
+00014750: 292c 646f 6e74 5368 6f77 3d54 7275 6529  ),dontShow=True)
+00014760: 0a0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
+00014770: 2869 6d61 6765 5f64 7473 2920 3e20 303a  (image_dts) > 0:
+00014780: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
+00014790: 6865 636b 2077 6865 7468 6572 2064 6570  heck whether dep
+000147a0: 7468 2061 6e64 2068 6569 6768 7420 6172  th and height ar
+000147b0: 6520 7365 740a 2020 2020 2020 2020 2020  e set.          
+000147c0: 2020 6c61 745f 6964 656e 7469 6361 6c2c    lat_identical,
+000147d0: 206c 6f6e 5f69 6465 6e74 6963 616c 2c20   lon_identical, 
+000147e0: 6465 705f 6964 656e 7469 6361 6c2c 2068  dep_identical, h
+000147f0: 6774 5f69 6465 6e74 6963 616c 2c20 6465  gt_identical, de
+00014800: 705f 6e6f 745f 7a65 726f 2c20 6867 745f  p_not_zero, hgt_
+00014810: 6e6f 745f 7a65 726f 2c75 6e63 6572 745f  not_zero,uncert_
+00014820: 6e6f 745f 7a65 726f 203d 206e 6176 5f64  not_zero = nav_d
+00014830: 6174 612e 6368 6563 6b50 6f73 6974 696f  ata.checkPositio
+00014840: 6e73 436f 6e74 656e 7428 290a 0a20 2020  nsContent()..   
+00014850: 2020 2020 2020 2020 2023 2057 7269 7465           # Write
+00014860: 2074 6f20 6e61 7669 6761 7469 6f6e 2074   to navigation t
+00014870: 7874 2066 696c 650a 2020 2020 2020 2020  xt file.        
+00014880: 2020 2020 2320 6865 6164 6572 0a20 2020      # header.   
+00014890: 2020 2020 2020 2020 2072 6573 203d 206f           res = o
+000148a0: 7065 6e28 7365 6c66 2e67 6574 5f69 6e74  pen(self.get_int
+000148b0: 5f6e 6176 5f66 696c 6528 292c 2022 7722  _nav_file(), "w"
+000148c0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+000148d0: 732e 7772 6974 6528 6d69 7174 762e 636f  s.write(miqtv.co
+000148e0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+000148f0: 275d 5b27 696d 6727 5d2b 225c 7422 2b6d  ']['img']+"\t"+m
+00014900: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+00014910: 276d 6172 6971 7427 5d5b 2775 7463 275d  'mariqt']['utc']
+00014920: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00014930: 2027 6c61 7427 2069 6e20 6e61 765f 6865   'lat' in nav_he
+00014940: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
+00014950: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
+00014960: 225c 7422 2b6d 6971 7476 2e63 6f6c 5f68  "\t"+miqtv.col_h
+00014970: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00014980: 276c 6174 275d 290a 2020 2020 2020 2020  'lat']).        
+00014990: 2020 2020 6966 2027 6c6f 6e27 2069 6e20      if 'lon' in 
+000149a0: 6e61 765f 6865 6164 6572 3a0a 2020 2020  nav_header:.    
+000149b0: 2020 2020 2020 2020 2020 2020 7265 732e              res.
+000149c0: 7772 6974 6528 225c 7422 2b6d 6971 7476  write("\t"+miqtv
+000149d0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+000149e0: 6971 7427 5d5b 276c 6f6e 275d 290a 2020  iqt']['lon']).  
+000149f0: 2020 2020 2020 2020 2020 6966 2064 6570            if dep
+00014a00: 5f6e 6f74 5f7a 6572 6f20 616e 6420 2764  _not_zero and 'd
+00014a10: 6570 2720 696e 206e 6176 5f68 6561 6465  ep' in nav_heade
+00014a20: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+00014a30: 2020 2072 6573 2e77 7269 7465 2822 5c74     res.write("\t
+00014a40: 222b 6d69 7174 762e 636f 6c5f 6865 6164  "+miqtv.col_head
+00014a50: 6572 5b27 6d61 7269 7174 275d 5b27 6465  er['mariqt']['de
+00014a60: 7027 5d29 0a20 2020 2020 2020 2020 2020  p']).           
+00014a70: 2065 6c69 6620 6465 705f 6e6f 745f 7a65   elif dep_not_ze
+00014a80: 726f 2061 6e64 2027 616c 7427 2069 6e20  ro and 'alt' in 
+00014a90: 6e61 765f 6865 6164 6572 3a0a 2020 2020  nav_header:.    
 00014aa0: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-00014ab0: 636c 6f73 6528 290a 0a20 2020 2020 2020  close()..       
-00014ac0: 2020 2020 2023 2057 7269 7465 2074 6f20       # Write to 
-00014ad0: 6765 6f6a 736f 6e20 6669 6c65 0a20 2020  geojson file.   
-00014ae0: 2020 2020 2020 2020 2067 656f 6a73 6f6e           geojson
-00014af0: 203d 207b 2774 7970 6527 3a20 2746 6561   = {'type': 'Fea
-00014b00: 7475 7265 436f 6c6c 6563 7469 6f6e 272c  tureCollection',
-00014b10: 2027 6e61 6d65 273a 2073 656c 662e 6469   'name': self.di
-00014b20: 722e 6576 656e 7428 292b 225f 222b 7365  r.event()+"_"+se
-00014b30: 6c66 2e64 6972 2e73 656e 736f 7228 292b  lf.dir.sensor()+
-00014b40: 225f 696d 6167 652d 6e61 7669 6761 7469  "_image-navigati
-00014b50: 6f6e 222c 2027 6665 6174 7572 6573 273a  on", 'features':
-00014b60: 205b 5d7d 0a20 2020 2020 2020 2020 2020   []}.           
-00014b70: 2066 6f72 2066 696c 6520 696e 2069 6d61   for file in ima
-00014b80: 6765 5f64 7473 3a0a 2020 2020 2020 2020  ge_dts:.        
-00014b90: 2020 2020 2020 2020 2320 7068 6f74 6f0a          # photo.
-00014ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014bb0: 6966 206c 656e 2869 6d61 6765 5f64 7473  if len(image_dts
-00014bc0: 5b66 696c 655d 2920 3d3d 2031 3a0a 2020  [file]) == 1:.  
-00014bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014be0: 2020 6966 2064 6570 5f6e 6f74 5f7a 6572    if dep_not_zer
-00014bf0: 6f3a 0a20 2020 2020 2020 2020 2020 2020  o:.             
-00014c00: 2020 2020 2020 2020 2020 2067 656f 6d65             geome
-00014c10: 7472 7920 3d20 207b 2774 7970 6527 3a20  try =  {'type': 
-00014c20: 2250 6f69 6e74 222c 2027 636f 6f72 6469  "Point", 'coordi
-00014c30: 6e61 7465 7327 3a20 0a20 2020 2020 2020  nates': .       
-00014c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c60: 205b 666c 6f61 7428 696d 6167 655f 6474   [float(image_dt
-00014c70: 735b 6669 6c65 5d5b 305d 2e6c 6f6e 292c  s[file][0].lon),
-00014c80: 2066 6c6f 6174 2869 6d61 6765 5f64 7473   float(image_dts
-00014c90: 5b66 696c 655d 5b30 5d2e 6c61 7429 2c20  [file][0].lat), 
-00014ca0: 666c 6f61 7428 696d 6167 655f 6474 735b  float(image_dts[
-00014cb0: 6669 6c65 5d5b 305d 2e64 6570 295d 0a20  file][0].dep)]. 
-00014cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ce0: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-00014cf0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00014d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d10: 2020 2020 2020 2067 656f 6d65 7472 7920         geometry 
-00014d20: 3d20 207b 2774 7970 6527 3a20 2250 6f69  =  {'type': "Poi
-00014d30: 6e74 222c 2027 636f 6f72 6469 6e61 7465  nt", 'coordinate
-00014d40: 7327 3a20 0a20 2020 2020 2020 2020 2020  s': .           
-00014d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d60: 2020 2020 2020 2020 2020 2020 205b 666c               [fl
-00014d70: 6f61 7428 696d 6167 655f 6474 735b 6669  oat(image_dts[fi
-00014d80: 6c65 5d5b 305d 2e6c 6f6e 292c 2066 6c6f  le][0].lon), flo
-00014d90: 6174 2869 6d61 6765 5f64 7473 5b66 696c  at(image_dts[fil
-00014da0: 655d 5b30 5d2e 6c61 7429 5d0a 2020 2020  e][0].lat)].    
+00014ab0: 7772 6974 6528 225c 7422 2b6d 6971 7476  write("\t"+miqtv
+00014ac0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+00014ad0: 6971 7427 5d5b 2761 6c74 275d 290a 2020  iqt']['alt']).  
+00014ae0: 2020 2020 2020 2020 2020 6966 2068 6774            if hgt
+00014af0: 5f6e 6f74 5f7a 6572 6f20 616e 6420 2768  _not_zero and 'h
+00014b00: 6774 2720 696e 206e 6176 5f68 6561 6465  gt' in nav_heade
+00014b10: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+00014b20: 2020 2072 6573 2e77 7269 7465 2822 5c74     res.write("\t
+00014b30: 222b 6d69 7174 762e 636f 6c5f 6865 6164  "+miqtv.col_head
+00014b40: 6572 5b27 6d61 7269 7174 275d 5b27 6867  er['mariqt']['hg
+00014b50: 7427 5d29 0a20 2020 2020 2020 2020 2020  t']).           
+00014b60: 2069 6620 756e 6365 7274 5f6e 6f74 5f7a   if uncert_not_z
+00014b70: 6572 6f20 616e 6420 2775 6e63 6572 7427  ero and 'uncert'
+00014b80: 2069 6e20 6e61 765f 6865 6164 6572 3a0a   in nav_header:.
+00014b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ba0: 7265 732e 7772 6974 6528 225c 7422 2b6d  res.write("\t"+m
+00014bb0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+00014bc0: 276d 6172 6971 7427 5d5b 2775 6e63 6572  'mariqt']['uncer
+00014bd0: 7427 5d29 0a20 2020 2020 2020 2020 2020  t']).           
+00014be0: 2072 6573 2e77 7269 7465 2822 5c6e 2229   res.write("\n")
+00014bf0: 0a20 2020 2020 2020 2020 2020 2023 2064  .            # d
+00014c00: 6174 6120 6c69 6e65 730a 2020 2020 2020  ata lines.      
+00014c10: 2020 2020 2020 666f 7220 6669 6c65 2069        for file i
+00014c20: 6e20 696d 6167 655f 6474 733a 0a20 2020  n image_dts:.   
+00014c30: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00014c40: 2074 696d 6570 6f69 6e74 2069 6e20 696d   timepoint in im
+00014c50: 6167 655f 6474 735b 6669 6c65 5d3a 0a20  age_dts[file]:. 
+00014c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c70: 2020 2072 6573 2e77 7269 7465 2866 696c     res.write(fil
+00014c80: 652b 225c 7422 2b74 696d 6570 6f69 6e74  e+"\t"+timepoint
+00014c90: 2e64 6174 6554 696d 6528 292e 7374 7266  .dateTime().strf
+00014ca0: 7469 6d65 286d 6971 7476 2e64 6174 655f  time(miqtv.date_
+00014cb0: 666f 726d 6174 735b 276d 6172 6971 7427  formats['mariqt'
+00014cc0: 5d29 2920 0a20 2020 2020 2020 2020 2020  ])) .           
+00014cd0: 2020 2020 2020 2020 2069 6620 276c 6174           if 'lat
+00014ce0: 2720 696e 206e 6176 5f68 6561 6465 723a  ' in nav_header:
+00014cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014d00: 2020 2020 2020 2020 2076 616c 203d 2074           val = t
+00014d10: 696d 6570 6f69 6e74 2e6c 6174 0a20 2020  imepoint.lat.   
+00014d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014d30: 2020 2020 2069 6620 276c 6174 2720 696e       if 'lat' in
+00014d40: 2072 6563 6f72 6473 3262 6549 6e76 6572   records2beInver
+00014d50: 7465 643a 0a20 2020 2020 2020 2020 2020  ted:.           
+00014d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014d70: 2076 616c 202a 3d20 2d31 0a20 2020 2020   val *= -1.     
+00014d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014d90: 2020 2072 6573 2e77 7269 7465 2822 5c74     res.write("\t
+00014da0: 222b 7374 7228 7661 6c29 290a 2020 2020  "+str(val)).    
 00014db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014dd0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-00014de0: 2020 2020 2020 6966 2054 7275 6520 696e        if True in
-00014df0: 205b 6d61 7468 2e69 736e 616e 2878 2920   [math.isnan(x) 
-00014e00: 666f 7220 7820 696e 2067 656f 6d65 7472  for x in geometr
-00014e10: 795b 2763 6f6f 7264 696e 6174 6573 275d  y['coordinates']
-00014e20: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00014e30: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-00014e40: 6e75 650a 0a20 2020 2020 2020 2020 2020  nue..           
-00014e50: 2020 2020 2023 2076 6964 656f 0a20 2020       # video.   
-00014e60: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00014e70: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00014e80: 2020 2020 2020 2069 6620 6465 705f 6e6f         if dep_no
-00014e90: 745f 7a65 726f 3a0a 2020 2020 2020 2020  t_zero:.        
-00014ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014eb0: 6765 6f6d 6574 7279 203d 2020 7b27 7479  geometry =  {'ty
-00014ec0: 7065 273a 2022 4d75 6c74 6950 6f69 6e74  pe': "MultiPoint
-00014ed0: 222c 2027 636f 6f72 6469 6e61 7465 7327  ", 'coordinates'
-00014ee0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00014ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f00: 2020 2020 2020 2020 2020 5b5b 666c 6f61            [[floa
-00014f10: 7428 642e 6c6f 6e29 2c20 666c 6f61 7428  t(d.lon), float(
-00014f20: 642e 6c61 7429 2c20 666c 6f61 7428 642e  d.lat), float(d.
-00014f30: 6465 7029 5d20 666f 7220 6420 696e 2069  dep)] for d in i
-00014f40: 6d61 6765 5f64 7473 5b66 696c 655d 5d0a  mage_dts[file]].
-00014f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014dc0: 6966 2027 6c6f 6e27 2069 6e20 6e61 765f  if 'lon' in nav_
+00014dd0: 6865 6164 6572 3a0a 2020 2020 2020 2020  header:.        
+00014de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014df0: 7661 6c20 3d20 7469 6d65 706f 696e 742e  val = timepoint.
+00014e00: 6c6f 6e0a 2020 2020 2020 2020 2020 2020  lon.            
+00014e10: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+00014e20: 6c6f 6e27 2069 6e20 7265 636f 7264 7332  lon' in records2
+00014e30: 6265 496e 7665 7274 6564 3a0a 2020 2020  beInverted:.    
+00014e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e50: 2020 2020 2020 2020 7661 6c20 2a3d 202d          val *= -
+00014e60: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+00014e70: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
+00014e80: 6974 6528 225c 7422 2b73 7472 2876 616c  ite("\t"+str(val
+00014e90: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00014ea0: 2020 2020 2020 2069 6620 6465 705f 6e6f         if dep_no
+00014eb0: 745f 7a65 726f 2061 6e64 2027 6465 7027  t_zero and 'dep'
+00014ec0: 2069 6e20 6e61 765f 6865 6164 6572 3a0a   in nav_header:.
+00014ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ee0: 2020 2020 2020 2020 7661 6c20 3d20 7469          val = ti
+00014ef0: 6d65 706f 696e 742e 6465 700a 2020 2020  mepoint.dep.    
+00014f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f10: 2020 2020 6966 2027 6465 7027 2069 6e20      if 'dep' in 
+00014f20: 7265 636f 7264 7332 6265 496e 7665 7274  records2beInvert
+00014f30: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+00014f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f50: 7661 6c20 2a3d 202d 310a 2020 2020 2020  val *= -1.      
 00014f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f70: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
-00014f80: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00014f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014fa0: 2020 2020 2020 2020 6765 6f6d 6574 7279          geometry
-00014fb0: 203d 2020 7b27 7479 7065 273a 2022 4d75   =  {'type': "Mu
-00014fc0: 6c74 6950 6f69 6e74 222c 2027 636f 6f72  ltiPoint", 'coor
-00014fd0: 6469 6e61 7465 7327 3a0a 2020 2020 2020  dinates':.      
-00014fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015000: 2020 5b5b 666c 6f61 7428 642e 6c6f 6e29    [[float(d.lon)
-00015010: 2c20 666c 6f61 7428 642e 6c61 7429 5d20  , float(d.lat)] 
-00015020: 666f 7220 6420 696e 2069 6d61 6765 5f64  for d in image_d
-00015030: 7473 5b66 696c 655d 5d0a 2020 2020 2020  ts[file]].      
-00015040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015050: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
+00014f70: 2020 7265 732e 7772 6974 6528 225c 7422    res.write("\t"
+00014f80: 2b73 7472 2876 616c 2929 0a20 2020 2020  +str(val)).     
+00014f90: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00014fa0: 6c69 6620 6465 705f 6e6f 745f 7a65 726f  lif dep_not_zero
+00014fb0: 2061 6e64 2027 616c 7427 2069 6e20 6e61   and 'alt' in na
+00014fc0: 765f 6865 6164 6572 3a0a 2020 2020 2020  v_header:.      
+00014fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014fe0: 2020 7661 6c20 3d20 7469 6d65 706f 696e    val = timepoin
+00014ff0: 742e 6465 7020 2a20 2d31 0a20 2020 2020  t.dep * -1.     
+00015000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015010: 2020 2069 6620 2761 6c74 2720 696e 2072     if 'alt' in r
+00015020: 6563 6f72 6473 3262 6549 6e76 6572 7465  ecords2beInverte
+00015030: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
+00015040: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00015050: 616c 202a 3d20 2d31 0a20 2020 2020 2020  al *= -1.       
 00015060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015070: 2020 2020 6966 2054 7275 6520 696e 205b      if True in [
-00015080: 6d61 7468 2e69 736e 616e 2878 2920 666f  math.isnan(x) fo
-00015090: 7220 7820 696e 205b 6974 656d 2066 6f72  r x in [item for
-000150a0: 2073 7562 6c69 7374 2069 6e20 6765 6f6d   sublist in geom
-000150b0: 6574 7279 5b27 636f 6f72 6469 6e61 7465  etry['coordinate
-000150c0: 7327 5d20 666f 7220 6974 656d 2069 6e20  s'] for item in 
-000150d0: 7375 626c 6973 745d 5d3a 0a20 2020 2020  sublist]]:.     
-000150e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150f0: 2020 2063 6f6e 7469 6e75 650a 0a20 2020     continue..   
-00015100: 2020 2020 2020 2020 2020 2020 2067 656f               geo
-00015110: 6a73 6f6e 5b27 6665 6174 7572 6573 275d  json['features']
-00015120: 2e61 7070 656e 6428 7b27 7479 7065 273a  .append({'type':
-00015130: 2027 4665 6174 7572 6527 2c20 2770 726f   'Feature', 'pro
-00015140: 7065 7274 6965 7327 3a20 7b27 6964 273a  perties': {'id':
-00015150: 2066 696c 657d 2c20 2767 656f 6d65 7472   file}, 'geometr
-00015160: 7927 3a20 6765 6f6d 6574 7279 207d 290a  y': geometry }).
-00015170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015180: 0a20 2020 2020 2020 2020 2020 206f 203d  .            o =
-00015190: 206f 7065 6e28 7365 6c66 2e67 6574 5f69   open(self.get_i
-000151a0: 6e74 5f6e 6176 5f66 696c 6528 292e 7265  nt_nav_file().re
-000151b0: 706c 6163 6528 222e 7478 7422 2c20 222e  place(".txt", ".
-000151c0: 6765 6f6a 736f 6e22 292c 0a20 2020 2020  geojson"),.     
-000151d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000151e0: 2277 222c 2065 7272 6f72 733d 2269 676e  "w", errors="ign
-000151f0: 6f72 6522 2c20 656e 636f 6469 6e67 3d27  ore", encoding='
-00015200: 7574 662d 3827 290a 2020 2020 2020 2020  utf-8').        
-00015210: 2020 2020 6a73 6f6e 2e64 756d 7028 6765      json.dump(ge
-00015220: 6f6a 736f 6e2c 206f 2c20 656e 7375 7265  ojson, o, ensure
-00015230: 5f61 7363 6969 3d46 616c 7365 2c20 696e  _ascii=False, in
-00015240: 6465 6e74 3d34 290a 2020 2020 2020 2020  dent=4).        
-00015250: 2020 2020 6f2e 636c 6f73 6528 290a 0a20      o.close().. 
-00015260: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00015270: 7072 6f76 2e61 6464 4172 6775 6d65 6e74  prov.addArgument
-00015280: 2822 696e 7075 744e 6176 6967 6174 696f  ("inputNavigatio
-00015290: 6e46 696c 6522 2c6e 6176 5f70 6174 682c  nFile",nav_path,
-000152a0: 6f76 6572 7772 6974 653d 5472 7565 290a  overwrite=True).
-000152b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000152c0: 2e70 726f 762e 6c6f 6728 2270 6172 7365  .prov.log("parse
-000152d0: 6420 6672 6f6d 2069 6e70 7574 4e61 7669  d from inputNavi
-000152e0: 6761 7469 6f6e 4669 6c65 3a20 2220 2b20  gationFile: " + 
-000152f0: 7374 7228 6e61 765f 6865 6164 6572 292c  str(nav_header),
-00015300: 646f 6e74 5368 6f77 3d54 7275 6529 0a20  dontShow=True). 
-00015310: 2020 2020 2020 2020 2020 2073 2e73 746f             s.sto
-00015320: 7028 290a 2020 2020 2020 2020 2020 2020  p().            
-00015330: 7265 7475 726e 2054 7275 652c 2022 4e61  return True, "Na
-00015340: 7669 6761 7469 6f6e 2064 6174 6120 6372  vigation data cr
-00015350: 6561 7465 6422 202b 2072 6574 7572 6e4d  eated" + returnM
-00015360: 7367 0a20 2020 2020 2020 2065 6c73 653a  sg.        else:
-00015370: 0a20 2020 2020 2020 2020 2020 2073 2e73  .            s.s
-00015380: 746f 7028 290a 2020 2020 2020 2020 2020  top().          
-00015390: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
-000153a0: 224e 6f20 696d 6167 6520 636f 6f72 6469  "No image coordi
-000153b0: 6e61 7465 7320 666f 756e 6422 202b 2072  nates found" + r
-000153c0: 6574 7572 6e4d 7367 0a0a 0a20 2020 2064  eturnMsg...    d
-000153d0: 6566 2063 7265 6174 6549 6d61 6765 5348  ef createImageSH
-000153e0: 4132 3536 4669 6c65 2873 656c 662c 7265  A256File(self,re
-000153f0: 5265 6164 416c 6c3d 5472 7565 293a 0a20  ReadAll=True):. 
-00015400: 2020 2020 2020 2022 2222 2043 7265 6174         """ Creat
-00015410: 6573 2069 6e20 2f69 6e74 6572 6d65 6469  es in /intermedi
-00015420: 6174 6520 6120 7465 7874 2066 696c 6520  ate a text file 
-00015430: 636f 6e74 6169 6e69 6e67 2070 6572 2069  containing per i
-00015440: 6d61 6765 2069 7473 2053 4841 3235 3620  mage its SHA256 
-00015450: 6861 7368 2e0a 2020 2020 2020 2020 2020  hash..          
-00015460: 2020 4966 2072 6552 6561 6441 6c6c 2069    If reReadAll i
-00015470: 7320 5472 7565 2061 6c6c 2069 6d61 6765  s True all image
-00015480: 7327 2068 6173 6865 7320 6172 6520 6465  s' hashes are de
-00015490: 7465 726d 696e 6564 2e20 4f74 6865 7277  termined. Otherw
-000154a0: 6973 6520 6f6e 6c79 2066 6f72 2074 686f  ise only for tho
-000154b0: 7365 2066 696c 6573 0a20 2020 2020 2020  se files.       
-000154c0: 2020 2020 2077 6869 6368 2061 7265 206e       which are n
-000154d0: 6f74 2079 6574 2069 6e20 7468 6520 696e  ot yet in the in
-000154e0: 7465 726d 6564 6961 7465 2066 696c 6520  termediate file 
-000154f0: 636f 6e74 6169 6e69 6e67 2074 6865 2069  containing the i
-00015500: 6d61 6765 2068 6173 6865 7320 2022 2222  mage hashes  """
-00015510: 0a20 2020 2020 2020 2068 6173 6865 7320  .        hashes 
-00015520: 3d20 7b7d 0a20 2020 2020 2020 2069 6620  = {}.        if 
-00015530: 6f73 2e70 6174 682e 6578 6973 7473 2873  os.path.exists(s
-00015540: 656c 662e 6765 745f 696e 745f 6861 7368  elf.get_int_hash
-00015550: 5f66 696c 6528 2929 3a0a 2020 2020 2020  _file()):.      
-00015560: 2020 2020 2020 6861 7368 6573 203d 206d        hashes = m
-00015570: 6971 7466 2e74 6162 4669 6c65 4461 7461  iqtf.tabFileData
-00015580: 2873 656c 662e 6765 745f 696e 745f 6861  (self.get_int_ha
-00015590: 7368 5f66 696c 6528 292c 205b 6d69 7174  sh_file(), [miqt
-000155a0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-000155b0: 7269 7174 275d 5b27 696d 6727 5d2c 206d  riqt']['img'], m
-000155c0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-000155d0: 276d 6172 6971 7427 5d5b 2768 6173 6827  'mariqt']['hash'
-000155e0: 5d5d 2c20 6b65 795f 636f 6c3d 6d69 7174  ]], key_col=miqt
-000155f0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-00015600: 7269 7174 275d 5b27 696d 6727 5d29 0a0a  riqt']['img'])..
-00015610: 2020 2020 2020 2020 696d 6167 6573 496e          imagesIn
-00015620: 5261 7720 3d20 7365 6c66 2e69 6d61 6765  Raw = self.image
-00015630: 7349 6e49 6d61 6765 7344 6972 2829 0a20  sInImagesDir(). 
-00015640: 2020 2020 2020 2069 6620 6c65 6e28 696d         if len(im
-00015650: 6167 6573 496e 5261 7729 203e 2030 3a0a  agesInRaw) > 0:.
-00015660: 0a20 2020 2020 2020 2020 2020 2061 6464  .            add
-00015670: 6564 5f68 6173 6865 7320 3d20 300a 2020  ed_hashes = 0.  
-00015680: 2020 2020 2020 2020 2020 7072 6f67 203d            prog =
-00015690: 206d 6971 7463 2e50 7269 6e74 4b6e 6f77   miqtc.PrintKnow
-000156a0: 6e50 726f 6772 6573 734d 7367 2822 4368  nProgressMsg("Ch
-000156b0: 6563 6b69 6e67 2068 6173 6865 7322 2c20  ecking hashes", 
-000156c0: 6c65 6e28 696d 6167 6573 496e 5261 7729  len(imagesInRaw)
-000156d0: 2c6d 6f64 756c 6f3d 3529 0a20 2020 2020  ,modulo=5).     
-000156e0: 2020 2020 2020 2066 6f72 2066 696c 6520         for file 
-000156f0: 696e 2069 6d61 6765 7349 6e52 6177 3a0a  in imagesInRaw:.
+00015070: 2072 6573 2e77 7269 7465 2822 5c74 222b   res.write("\t"+
+00015080: 7374 7228 7661 6c29 290a 2020 2020 2020  str(val)).      
+00015090: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000150a0: 2068 6774 5f6e 6f74 5f7a 6572 6f20 616e   hgt_not_zero an
+000150b0: 6420 2768 6774 2720 696e 206e 6176 5f68  d 'hgt' in nav_h
+000150c0: 6561 6465 723a 0a20 2020 2020 2020 2020  eader:.         
+000150d0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+000150e0: 616c 203d 2074 696d 6570 6f69 6e74 2e68  al = timepoint.h
+000150f0: 6774 0a20 2020 2020 2020 2020 2020 2020  gt.             
+00015100: 2020 2020 2020 2020 2020 2069 6620 2768             if 'h
+00015110: 6774 2720 696e 2072 6563 6f72 6473 3262  gt' in records2b
+00015120: 6549 6e76 6572 7465 643a 0a20 2020 2020  eInverted:.     
+00015130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015140: 2020 2020 2020 2076 616c 202a 3d20 2d31         val *= -1
+00015150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015160: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
+00015170: 7465 2822 5c74 222b 7374 7228 7661 6c29  te("\t"+str(val)
+00015180: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00015190: 2020 2020 2020 6966 2075 6e63 6572 745f        if uncert_
+000151a0: 6e6f 745f 7a65 726f 2061 6e64 2027 756e  not_zero and 'un
+000151b0: 6365 7274 2720 696e 206e 6176 5f68 6561  cert' in nav_hea
+000151c0: 6465 723a 0a20 2020 2020 2020 2020 2020  der:.           
+000151d0: 2020 2020 2020 2020 2020 2020 2076 616c               val
+000151e0: 203d 2074 696d 6570 6f69 6e74 2e75 6e63   = timepoint.unc
+000151f0: 6572 740a 2020 2020 2020 2020 2020 2020  ert.            
+00015200: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+00015210: 756e 6365 7274 2720 696e 2072 6563 6f72  uncert' in recor
+00015220: 6473 3262 6549 6e76 6572 7465 643a 0a20  ds2beInverted:. 
+00015230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015240: 2020 2020 2020 2020 2020 2076 616c 202a             val *
+00015250: 3d20 2d31 0a20 2020 2020 2020 2020 2020  = -1.           
+00015260: 2020 2020 2020 2020 2020 2020 2072 6573               res
+00015270: 2e77 7269 7465 2822 5c74 222b 7374 7228  .write("\t"+str(
+00015280: 7661 6c29 290a 2020 2020 2020 2020 2020  val)).          
+00015290: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
+000152a0: 6974 6528 225c 6e22 290a 2020 2020 2020  ite("\n").      
+000152b0: 2020 2020 2020 7265 732e 636c 6f73 6528        res.close(
+000152c0: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+000152d0: 2057 7269 7465 2074 6f20 6765 6f6a 736f   Write to geojso
+000152e0: 6e20 6669 6c65 0a20 2020 2020 2020 2020  n file.         
+000152f0: 2020 2067 656f 6a73 6f6e 203d 207b 2774     geojson = {'t
+00015300: 7970 6527 3a20 2746 6561 7475 7265 436f  ype': 'FeatureCo
+00015310: 6c6c 6563 7469 6f6e 272c 2027 6e61 6d65  llection', 'name
+00015320: 273a 2073 656c 662e 6469 722e 6576 656e  ': self.dir.even
+00015330: 7428 292b 225f 222b 7365 6c66 2e64 6972  t()+"_"+self.dir
+00015340: 2e73 656e 736f 7228 292b 225f 696d 6167  .sensor()+"_imag
+00015350: 652d 6e61 7669 6761 7469 6f6e 222c 2027  e-navigation", '
+00015360: 6665 6174 7572 6573 273a 205b 5d7d 0a20  features': []}. 
+00015370: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
+00015380: 696c 6520 696e 2069 6d61 6765 5f64 7473  ile in image_dts
+00015390: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000153a0: 2020 2320 7068 6f74 6f0a 2020 2020 2020    # photo.      
+000153b0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+000153c0: 2869 6d61 6765 5f64 7473 5b66 696c 655d  (image_dts[file]
+000153d0: 2920 3d3d 2031 3a0a 2020 2020 2020 2020  ) == 1:.        
+000153e0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+000153f0: 6570 5f6e 6f74 5f7a 6572 6f3a 0a20 2020  ep_not_zero:.   
+00015400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015410: 2020 2020 2067 656f 6d65 7472 7920 3d20       geometry = 
+00015420: 207b 2774 7970 6527 3a20 2250 6f69 6e74   {'type': "Point
+00015430: 222c 2027 636f 6f72 6469 6e61 7465 7327  ", 'coordinates'
+00015440: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
+00015450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015460: 2020 2020 2020 2020 2020 205b 666c 6f61             [floa
+00015470: 7428 696d 6167 655f 6474 735b 6669 6c65  t(image_dts[file
+00015480: 5d5b 305d 2e6c 6f6e 292c 2066 6c6f 6174  ][0].lon), float
+00015490: 2869 6d61 6765 5f64 7473 5b66 696c 655d  (image_dts[file]
+000154a0: 5b30 5d2e 6c61 7429 2c20 666c 6f61 7428  [0].lat), float(
+000154b0: 696d 6167 655f 6474 735b 6669 6c65 5d5b  image_dts[file][
+000154c0: 305d 2e64 6570 295d 0a20 2020 2020 2020  0].dep)].       
+000154d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000154e0: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
+000154f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015500: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00015510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015520: 2067 656f 6d65 7472 7920 3d20 207b 2774   geometry =  {'t
+00015530: 7970 6527 3a20 2250 6f69 6e74 222c 2027  ype': "Point", '
+00015540: 636f 6f72 6469 6e61 7465 7327 3a20 0a20  coordinates': . 
+00015550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015570: 2020 2020 2020 205b 666c 6f61 7428 696d         [float(im
+00015580: 6167 655f 6474 735b 6669 6c65 5d5b 305d  age_dts[file][0]
+00015590: 2e6c 6f6e 292c 2066 6c6f 6174 2869 6d61  .lon), float(ima
+000155a0: 6765 5f64 7473 5b66 696c 655d 5b30 5d2e  ge_dts[file][0].
+000155b0: 6c61 7429 5d0a 2020 2020 2020 2020 2020  lat)].          
+000155c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155d0: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
+000155e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155f0: 6966 2054 7275 6520 696e 205b 6d61 7468  if True in [math
+00015600: 2e69 736e 616e 2878 2920 666f 7220 7820  .isnan(x) for x 
+00015610: 696e 2067 656f 6d65 7472 795b 2763 6f6f  in geometry['coo
+00015620: 7264 696e 6174 6573 275d 5d3a 0a20 2020  rdinates']]:.   
+00015630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015640: 2020 2020 2063 6f6e 7469 6e75 650a 0a20       continue.. 
+00015650: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00015660: 2076 6964 656f 0a20 2020 2020 2020 2020   video.         
+00015670: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00015680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015690: 2069 6620 6465 705f 6e6f 745f 7a65 726f   if dep_not_zero
+000156a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000156b0: 2020 2020 2020 2020 2020 6765 6f6d 6574            geomet
+000156c0: 7279 203d 2020 7b27 7479 7065 273a 2022  ry =  {'type': "
+000156d0: 4d75 6c74 6950 6f69 6e74 222c 2027 636f  MultiPoint", 'co
+000156e0: 6f72 6469 6e61 7465 7327 3a0a 2020 2020  ordinates':.    
+000156f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00015700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015710: 7072 6f67 2e70 726f 6772 6573 7328 290a  prog.progress().
-00015720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015730: 2069 6620 6e6f 7420 7365 6c66 2e5f 5f61   if not self.__a
-00015740: 6c6c 5555 4944 7343 6865 636b 6564 2061  llUUIDsChecked a
-00015750: 6e64 206e 6f74 206d 6971 7469 2e69 6d61  nd not miqti.ima
-00015760: 6765 436f 6e74 6169 6e73 5661 6c69 6455  geContainsValidU
-00015770: 5549 4428 6669 6c65 295b 305d 3a0a 2020  UID(file)[0]:.  
+00015710: 2020 2020 5b5b 666c 6f61 7428 642e 6c6f      [[float(d.lo
+00015720: 6e29 2c20 666c 6f61 7428 642e 6c61 7429  n), float(d.lat)
+00015730: 2c20 666c 6f61 7428 642e 6465 7029 5d20  , float(d.dep)] 
+00015740: 666f 7220 6420 696e 2069 6d61 6765 5f64  for d in image_d
+00015750: 7473 5b66 696c 655d 5d0a 2020 2020 2020  ts[file]].      
+00015760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015770: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
 00015780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015790: 2020 2320 7265 6d6f 7665 2066 726f 6d20    # remove from 
-000157a0: 7575 6964 2066 696c 650a 2020 2020 2020  uuid file.      
-000157b0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000157c0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-000157d0: 7365 6c66 2e67 6574 5f69 6e74 5f75 7569  self.get_int_uui
-000157e0: 645f 6669 6c65 2829 293a 0a20 2020 2020  d_file()):.     
+00015790: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000157a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000157b0: 2020 6765 6f6d 6574 7279 203d 2020 7b27    geometry =  {'
+000157c0: 7479 7065 273a 2022 4d75 6c74 6950 6f69  type': "MultiPoi
+000157d0: 6e74 222c 2027 636f 6f72 6469 6e61 7465  nt", 'coordinate
+000157e0: 7327 3a0a 2020 2020 2020 2020 2020 2020  s':.            
 000157f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015800: 2020 2072 6573 203d 206f 7065 6e28 7365     res = open(se
-00015810: 6c66 2e67 6574 5f69 6e74 5f75 7569 645f  lf.get_int_uuid_
-00015820: 6669 6c65 2829 2c20 2272 2229 0a20 2020  file(), "r").   
-00015830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015840: 2020 2020 206c 696e 6573 203d 2072 6573       lines = res
-00015850: 2e72 6561 646c 696e 6573 2829 0a20 2020  .readlines().   
-00015860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015870: 2020 2020 2072 6573 2e63 6c6f 7365 2829       res.close()
-00015880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015890: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000158a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000158b0: 2020 206c 696e 6573 203d 205b 5d0a 2020     lines = [].  
-000158c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000158d0: 2020 6920 3d20 300a 2020 2020 2020 2020    i = 0.        
-000158e0: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
-000158f0: 4e72 203d 2069 0a20 2020 2020 2020 2020  Nr = i.         
-00015900: 2020 2020 2020 2020 2020 2066 6f72 206c             for l
-00015910: 696e 6520 696e 206c 696e 6573 3a0a 2020  ine in lines:.  
-00015920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015930: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
-00015940: 2e62 6173 656e 616d 6528 6669 6c65 2920  .basename(file) 
-00015950: 696e 206c 696e 653a 0a20 2020 2020 2020  in line:.       
-00015960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015970: 2020 2020 206c 696e 654e 7220 3d20 690a       lineNr = i.
-00015980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015990: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-000159a0: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
-000159b0: 2020 2020 2020 2020 2020 6920 2b3d 2031            i += 1
-000159c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000159d0: 2020 2020 2069 6620 6c69 6e65 4e72 2021       if lineNr !
-000159e0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-000159f0: 2020 2020 2020 2020 2020 2020 2064 656c               del
-00015a00: 206c 696e 6573 5b6c 696e 654e 725d 0a20   lines[lineNr]. 
-00015a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015a20: 2020 2020 2020 2072 6573 203d 206f 7065         res = ope
-00015a30: 6e28 7365 6c66 2e67 6574 5f69 6e74 5f75  n(self.get_int_u
-00015a40: 7569 645f 6669 6c65 2829 2c20 2277 2229  uid_file(), "w")
-00015a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015a60: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
-00015a70: 7465 6c69 6e65 7328 6c69 6e65 7329 0a20  telines(lines). 
-00015a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015a90: 2020 2020 2020 2072 6573 2e63 6c6f 7365         res.close
-00015aa0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-00015ab0: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
-00015ac0: 6570 7469 6f6e 2820 2246 696c 6520 2220  eption( "File " 
-00015ad0: 2b20 6669 6c65 202b 2022 2064 6f65 7320  + file + " does 
-00015ae0: 6e6f 7420 636f 7461 696e 2061 2076 616c  not cotain a val
-00015af0: 6964 2055 5549 442e 2052 756e 2063 7265  id UUID. Run cre
-00015b00: 6174 6555 5549 4446 696c 6528 2920 6669  ateUUIDFile() fi
-00015b10: 7273 7421 2229 0a0a 2020 2020 2020 2020  rst!")..        
-00015b20: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
-00015b30: 6520 3d20 6f73 2e70 6174 682e 6261 7365  e = os.path.base
-00015b40: 6e61 6d65 2866 696c 6529 0a20 2020 2020  name(file).     
-00015b50: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00015b60: 7420 7265 5265 6164 416c 6c20 616e 6420  t reReadAll and 
-00015b70: 6669 6c65 5f6e 616d 6520 696e 2068 6173  file_name in has
-00015b80: 6865 733a 0a20 2020 2020 2020 2020 2020  hes:.           
-00015b90: 2020 2020 2020 2020 2068 6173 6865 735b           hashes[
-00015ba0: 6669 6c65 5f6e 616d 655d 203d 2068 6173  file_name] = has
-00015bb0: 6865 735b 6669 6c65 5f6e 616d 655d 5b6d  hes[file_name][m
-00015bc0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00015bd0: 276d 6172 6971 7427 5d5b 2768 6173 6827  'mariqt']['hash'
-00015be0: 5d5d 0a20 2020 2020 2020 2020 2020 2020  ]].             
-00015bf0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00015c00: 2020 2020 2020 2020 2020 2020 2068 6173               has
-00015c10: 6865 735b 6669 6c65 5f6e 616d 655d 203d  hes[file_name] =
-00015c20: 206d 6971 7463 2e73 6861 3235 3648 6173   miqtc.sha256Has
-00015c30: 6846 696c 6528 6669 6c65 290a 2020 2020  hFile(file).    
-00015c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015c50: 6164 6465 645f 6861 7368 6573 202b 3d20  added_hashes += 
-00015c60: 310a 2020 2020 2020 2020 2020 2020 7072  1.            pr
-00015c70: 6f67 2e63 6c65 6172 2829 0a0a 2020 2020  og.clear()..    
-00015c80: 2020 2020 2020 2020 6966 2072 6552 6561          if reRea
-00015c90: 6441 6c6c 206f 7220 6164 6465 645f 6861  dAll or added_ha
-00015ca0: 7368 6573 203e 2030 3a0a 2020 2020 2020  shes > 0:.      
-00015cb0: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
-00015cc0: 696c 6520 3d20 6f70 656e 2873 656c 662e  ile = open(self.
-00015cd0: 6765 745f 696e 745f 6861 7368 5f66 696c  get_int_hash_fil
-00015ce0: 6528 292c 2022 7722 290a 2020 2020 2020  e(), "w").      
-00015cf0: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
-00015d00: 696c 652e 7772 6974 6528 206d 6971 7476  ile.write( miqtv
-00015d10: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00015d20: 6971 7427 5d5b 2769 6d67 275d 2b22 5c74  iqt']['img']+"\t
-00015d30: 222b 6d69 7174 762e 636f 6c5f 6865 6164  "+miqtv.col_head
-00015d40: 6572 5b27 6d61 7269 7174 275d 5b27 6861  er['mariqt']['ha
-00015d50: 7368 275d 2b22 5c6e 2229 0a20 2020 2020  sh']+"\n").     
-00015d60: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
-00015d70: 696c 655f 6e61 6d65 2069 6e20 6861 7368  ile_name in hash
-00015d80: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00015d90: 2020 2020 2020 2020 6861 7368 5f66 696c          hash_fil
-00015da0: 652e 7772 6974 6528 6669 6c65 5f6e 616d  e.write(file_nam
-00015db0: 652b 225c 7422 2b68 6173 6865 735b 6669  e+"\t"+hashes[fi
-00015dc0: 6c65 5f6e 616d 655d 2b22 5c6e 2229 0a0a  le_name]+"\n")..
-00015dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015de0: 6861 7368 5f66 696c 652e 636c 6f73 6528  hash_file.close(
-00015df0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00015e00: 2020 7265 7475 726e 2054 7275 652c 2022    return True, "
-00015e10: 4164 6465 6420 222b 7374 7228 6164 6465  Added "+str(adde
-00015e20: 645f 6861 7368 6573 292b 2220 6861 7368  d_hashes)+" hash
-00015e30: 6573 2074 6f20 6861 7368 2066 696c 6522  es to hash file"
-00015e40: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00015e50: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00015e60: 2020 2072 6574 7572 6e20 5472 7565 2c20     return True, 
-00015e70: 2241 6c6c 2068 6173 6865 7320 6578 6973  "All hashes exis
-00015e80: 7422 0a0a 2020 2020 2020 2020 656c 7365  t"..        else
-00015e90: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00015ea0: 7475 726e 2046 616c 7365 2c20 224e 6f20  turn False, "No 
-00015eb0: 696d 6167 6573 2066 6f75 6e64 2074 6f20  images found to 
-00015ec0: 6861 7368 220a 0a0a 2020 2020 6465 6620  hash"...    def 
-00015ed0: 6372 6561 7465 5374 6172 7454 696d 6546  createStartTimeF
-00015ee0: 696c 6528 7365 6c66 293a 0a20 2020 2020  ile(self):.     
-00015ef0: 2020 2022 2222 2043 7265 6174 6573 2069     """ Creates i
-00015f00: 6e20 2f69 6e74 6572 6d65 6469 6174 6520  n /intermediate 
-00015f10: 6120 7465 7874 2066 696c 6520 636f 6e74  a text file cont
-00015f20: 6169 6e69 6e67 2070 6572 2069 6d61 6765  aining per image
-00015f30: 2069 7473 2073 7461 7274 2074 696d 6520   its start time 
-00015f40: 7061 7273 6564 2066 726f 6d20 7468 6520  parsed from the 
-00015f50: 6669 6c65 206e 616d 6520 2222 220a 0a20  file name """.. 
-00015f60: 2020 2020 2020 2073 203d 206d 6971 7463         s = miqtc
-00015f70: 2e50 7269 6e74 4c6f 6164 696e 674d 7367  .PrintLoadingMsg
-00015f80: 2822 4372 6561 7469 6e67 2069 6e74 6572  ("Creating inter
-00015f90: 6d65 6469 6174 6520 7374 6172 7474 696d  mediate starttim
-00015fa0: 6520 6669 6c65 2022 290a 2020 2020 2020  e file ").      
-00015fb0: 2020 696d 6167 6573 496e 5261 7720 3d20    imagesInRaw = 
-00015fc0: 7365 6c66 2e69 6d61 6765 7349 6e49 6d61  self.imagesInIma
-00015fd0: 6765 7344 6972 536f 7274 6564 4c69 7374  gesDirSortedList
-00015fe0: 2829 0a20 2020 2020 2020 2069 6620 6c65  ().        if le
-00015ff0: 6e28 696d 6167 6573 496e 5261 7729 203e  n(imagesInRaw) >
-00016000: 2030 3a0a 0a20 2020 2020 2020 2020 2020   0:..           
-00016010: 206f 203d 206f 7065 6e28 7365 6c66 2e67   o = open(self.g
-00016020: 6574 5f69 6e74 5f73 7461 7274 5469 6d65  et_int_startTime
-00016030: 735f 6669 6c65 2829 2c20 2277 2229 0a20  s_file(), "w"). 
-00016040: 2020 2020 2020 2020 2020 206f 2e77 7269             o.wri
-00016050: 7465 286d 6971 7476 2e63 6f6c 5f68 6561  te(miqtv.col_hea
-00016060: 6465 725b 276d 6172 6971 7427 5d5b 2769  der['mariqt']['i
-00016070: 6d67 275d 202b 0a20 2020 2020 2020 2020  mg'] +.         
-00016080: 2020 2020 2020 2020 2020 2022 5c74 222b             "\t"+
-00016090: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-000160a0: 5b27 6d61 7269 7174 275d 5b27 7574 6327  ['mariqt']['utc'
-000160b0: 5d2b 225c 6e22 290a 0a20 2020 2020 2020  ]+"\n")..       
-000160c0: 2020 2020 2066 6f72 2066 696c 6520 696e       for file in
-000160d0: 2069 6d61 6765 7349 6e52 6177 3a0a 2020   imagesInRaw:.  
-000160e0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-000160f0: 6c65 5f6e 616d 6520 3d20 6f73 2e70 6174  le_name = os.pat
-00016100: 682e 6261 7365 6e61 6d65 2866 696c 6529  h.basename(file)
-00016110: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00016120: 2020 6474 203d 206d 6971 7463 2e70 6172    dt = miqtc.par
-00016130: 7365 4669 6c65 4461 7465 5469 6d65 4173  seFileDateTimeAs
-00016140: 5554 4328 6669 6c65 5f6e 616d 6529 0a20  UTC(file_name). 
-00016150: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00016160: 2e77 7269 7465 2866 696c 655f 6e61 6d65  .write(file_name
-00016170: 2b22 5c74 2220 2b20 6474 2e73 7472 6674  +"\t" + dt.strft
-00016180: 696d 6528 6d69 7174 762e 6461 7465 5f66  ime(miqtv.date_f
-00016190: 6f72 6d61 7473 5b27 6d61 7269 7174 275d  ormats['mariqt']
-000161a0: 292b 225c 6e22 290a 0a20 2020 2020 2020  )+"\n")..       
-000161b0: 2020 2020 206f 2e63 6c6f 7365 2829 0a20       o.close(). 
-000161c0: 2020 2020 2020 2020 2020 2073 2e73 746f             s.sto
-000161d0: 7028 290a 2020 2020 2020 2020 2020 2020  p().            
-000161e0: 7265 7475 726e 2054 7275 652c 2022 4372  return True, "Cr
-000161f0: 6561 7465 6420 7374 6172 7420 7469 6d65  eated start time
-00016200: 2066 696c 6522 0a20 2020 2020 2020 2065   file".        e
-00016210: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00016220: 2073 2e73 746f 7028 290a 2020 2020 2020   s.stop().      
-00016230: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00016240: 7365 2c20 224e 6f20 696d 6167 6573 2066  se, "No images f
-00016250: 6f75 6e64 2074 6f20 7265 6164 2073 7461  ound to read sta
-00016260: 7274 2074 696d 6573 220a 0a0a 2020 2020  rt times"...    
-00016270: 6465 6620 6372 6561 7465 4163 7175 6973  def createAcquis
-00016280: 6974 696f 6e53 6574 7469 6e67 7345 5849  itionSettingsEXI
-00016290: 4646 696c 6528 7365 6c66 2c6f 7665 7272  FFile(self,overr
-000162a0: 6964 653d 4661 6c73 6529 3a0a 2020 2020  ide=False):.    
-000162b0: 2020 2020 2222 2220 4372 6561 7465 7320      """ Creates 
-000162c0: 696e 202f 696e 7465 726d 6564 6961 7465  in /intermediate
-000162d0: 2061 2074 6578 7420 6669 6c65 2063 6f6e   a text file con
-000162e0: 7461 696e 696e 6720 7065 7220 696d 6167  taining per imag
-000162f0: 6520 6120 6469 6374 206f 6620 6578 6966  e a dict of exif
-00016300: 2074 6167 7320 616e 6420 7468 6569 7220   tags and their 
-00016310: 7661 6c75 6573 2070 6172 7365 6420 6672  values parsed fr
-00016320: 6f6d 2074 6865 2069 6d61 6765 2022 2222  om the image """
-00016330: 0a0a 2020 2020 2020 2020 696e 745f 6163  ..        int_ac
-00016340: 7175 6973 6974 696f 6e53 6574 7469 6e67  quisitionSetting
-00016350: 5f66 696c 6520 3d20 7365 6c66 2e5f 5f67  _file = self.__g
-00016360: 6574 5f69 6e74 5f66 696c 655f 7072 6566  et_int_file_pref
-00016370: 6978 2829 202b 2027 5f69 6d61 6765 2d61  ix() + '_image-a
-00016380: 6371 7569 7369 7469 6f6e 2d73 6574 7469  cquisition-setti
-00016390: 6e67 732e 7478 7427 0a20 2020 2020 2020  ngs.txt'.       
-000163a0: 2068 6561 6465 7220 3d20 7b20 206d 6971   header = {  miq
-000163b0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-000163c0: 6172 6971 7427 5d5b 2769 6d67 275d 3a20  ariqt']['img']: 
-000163d0: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
-000163e0: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
-000163f0: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
-00016400: 2020 2020 2020 2020 6d69 7174 762e 636f          miqtv.co
-00016410: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00016420: 275d 5b27 6163 7175 6927 5d3a 6d69 7174  ']['acqui']:miqt
-00016430: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-00016440: 7269 7174 275d 5b27 6163 7175 6927 5d7d  riqt']['acqui']}
-00016450: 0a20 2020 2020 2020 2069 6620 6f73 2e70  .        if os.p
-00016460: 6174 682e 6578 6973 7473 2869 6e74 5f61  ath.exists(int_a
-00016470: 6371 7569 7369 7469 6f6e 5365 7474 696e  cquisitionSettin
-00016480: 675f 6669 6c65 2920 616e 6420 6e6f 7420  g_file) and not 
-00016490: 6f76 6572 7269 6465 3a0a 2020 2020 2020  override:.      
-000164a0: 2020 2020 2020 7365 6c66 2e61 6464 4974        self.addIt
-000164b0: 656d 496e 666f 5461 6246 696c 6528 696e  emInfoTabFile(in
-000164c0: 745f 6163 7175 6973 6974 696f 6e53 6574  t_acquisitionSet
-000164d0: 7469 6e67 5f66 696c 652c 225c 7422 2c68  ting_file,"\t",h
-000164e0: 6561 6465 7229 0a20 2020 2020 2020 2020  eader).         
-000164f0: 2020 2072 6574 7572 6e20 5472 7565 2c20     return True, 
-00016500: 2252 6573 756c 7420 6669 6c65 2065 7869  "Result file exi
-00016510: 7374 7322 0a0a 2020 2020 2020 2020 696d  sts"..        im
-00016520: 6167 6573 496e 5261 7720 3d20 7365 6c66  agesInRaw = self
-00016530: 2e69 6d61 6765 7349 6e49 6d61 6765 7344  .imagesInImagesD
-00016540: 6972 536f 7274 6564 4c69 7374 2829 0a20  irSortedList(). 
-00016550: 2020 2020 2020 2069 6620 6c65 6e28 696d         if len(im
-00016560: 6167 6573 496e 5261 7729 203e 2030 3a0a  agesInRaw) > 0:.
-00016570: 0a20 2020 2020 2020 2020 2020 206f 203d  .            o =
-00016580: 206f 7065 6e28 696e 745f 6163 7175 6973   open(int_acquis
-00016590: 6974 696f 6e53 6574 7469 6e67 5f66 696c  itionSetting_fil
-000165a0: 652c 2022 7722 290a 2020 2020 2020 2020  e, "w").        
-000165b0: 2020 2020 6f2e 7772 6974 6528 6d69 7174      o.write(miqt
-000165c0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-000165d0: 7269 7174 275d 5b27 696d 6727 5d20 2b20  riqt']['img'] + 
-000165e0: 225c 7422 2b6d 6971 7476 2e63 6f6c 5f68  "\t"+miqtv.col_h
-000165f0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-00016600: 2761 6371 7569 275d 2b22 5c6e 2229 0a20  'acqui']+"\n"). 
-00016610: 0a20 2020 2020 2020 2020 2020 2069 6d61  .            ima
-00016620: 6765 7345 7869 6673 203d 206d 6971 7469  gesExifs = miqti
-00016630: 2e67 6574 496d 6167 6573 416c 6c45 7869  .getImagesAllExi
-00016640: 6656 616c 7565 7328 696d 6167 6573 496e  fValues(imagesIn
-00016650: 5261 772c 7365 6c66 2e70 726f 7629 0a20  Raw,self.prov). 
-00016660: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
-00016670: 696c 6520 696e 2069 6d61 6765 7345 7869  ile in imagesExi
-00016680: 6673 3a0a 2020 2020 2020 2020 2020 2020  fs:.            
-00016690: 2020 2020 6669 6c65 5f6e 616d 6520 3d20      file_name = 
-000166a0: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
-000166b0: 2866 696c 6529 0a20 2020 2020 2020 2020  (file).         
-000166c0: 2020 2020 2020 206f 2e77 7269 7465 2866         o.write(f
-000166d0: 696c 655f 6e61 6d65 2b22 5c74 222b 7374  ile_name+"\t"+st
-000166e0: 7228 696d 6167 6573 4578 6966 735b 6669  r(imagesExifs[fi
-000166f0: 6c65 5d29 2b22 5c6e 2229 0a0a 2020 2020  le])+"\n")..    
-00016700: 2020 2020 2020 2020 6f2e 636c 6f73 6528          o.close(
-00016710: 290a 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00016720: 656c 662e 6164 6449 7465 6d49 6e66 6f54  elf.addItemInfoT
-00016730: 6162 4669 6c65 2869 6e74 5f61 6371 7569  abFile(int_acqui
-00016740: 7369 7469 6f6e 5365 7474 696e 675f 6669  sitionSetting_fi
-00016750: 6c65 2c22 5c74 222c 6865 6164 6572 290a  le,"\t",header).
-00016760: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00016770: 726e 2054 7275 652c 2022 4372 6561 7465  rn True, "Create
-00016780: 6420 6163 7175 6973 6974 696f 6e20 7365  d acquisition se
-00016790: 7474 696e 6773 2066 696c 6522 0a20 2020  ttings file".   
-000167a0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000167b0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-000167c0: 6c73 652c 2022 4e6f 2069 6d61 6765 7320  lse, "No images 
-000167d0: 666f 756e 6422 0a0a 0a20 2020 2064 6566  found"...    def
-000167e0: 2069 6d61 6765 7349 6e49 6d61 6765 7344   imagesInImagesD
-000167f0: 6972 2873 656c 6629 3a0a 2020 2020 2020  ir(self):.      
-00016800: 2020 7265 7475 726e 2063 6f70 792e 6465    return copy.de
-00016810: 6570 636f 7079 2873 656c 662e 5f69 6d61  epcopy(self._ima
-00016820: 6765 7349 6e49 6d61 6765 7344 6972 290a  gesInImagesDir).
-00016830: 0a20 2020 2064 6566 2069 6d61 6765 7349  .    def imagesI
-00016840: 6e49 6d61 6765 7344 6972 536f 7274 6564  nImagesDirSorted
-00016850: 4c69 7374 2873 656c 6629 3a0a 2020 2020  List(self):.    
-00016860: 2020 2020 7265 7475 726e 2063 6f70 792e      return copy.
-00016870: 6465 6570 636f 7079 2873 656c 662e 5f69  deepcopy(self._i
-00016880: 6d61 6765 7349 6e49 6d61 6765 7344 6972  magesInImagesDir
-00016890: 536f 7274 6564 4c69 7374 290a 0a0a 2020  SortedList)...  
-000168a0: 2020 6465 6620 7061 7273 6549 7465 6d44    def parseItemD
-000168b0: 6174 6166 726f 6d54 6162 4669 6c65 4461  atafromTabFileDa
-000168c0: 7461 2873 656c 662c 2069 7465 6d73 3a20  ta(self, items: 
-000168d0: 6469 6374 2c20 6669 6c65 3a20 7374 722c  dict, file: str,
-000168e0: 2063 6f6c 733a 206c 6973 742c 206f 7074   cols: list, opt
-000168f0: 696f 6e61 6c3a 206c 6973 7420 3d20 5b5d  ional: list = []
-00016900: 293a 0a20 2020 2020 2020 2022 2222 2070  ):.        """ p
-00016910: 6172 7365 7320 6461 7461 2066 726f 6d20  arses data from 
-00016920: 636f 6c75 6d6e 7320 696e 2063 6f6c 7320  columns in cols 
-00016930: 616e 6420 7772 6974 6573 2069 6e66 6f20  and writes info 
-00016940: 746f 2069 7465 6d73 2e20 436f 6c75 6d6e  to items. Column
-00016950: 2027 696d 6167 652d 6669 6c65 6e61 6d65   'image-filename
-00016960: 2720 6d75 7374 2062 6520 696e 2066 696c  ' must be in fil
-00016970: 6520 616e 6420 646f 6573 206e 6f74 206e  e and does not n
-00016980: 6565 6420 746f 2062 6520 7061 7373 6564  eed to be passed
-00016990: 2069 6e20 636f 6c73 2e20 0a20 2020 2020   in cols. .     
-000169a0: 2020 2020 2020 2046 696c 6520 6d75 7374         File must
-000169b0: 2062 6520 7461 6220 7365 7061 7261 7465   be tab separate
-000169c0: 6420 616e 6420 636f 6c75 6d6e 7320 6e61  d and columns na
-000169d0: 6d65 7320 6d75 7374 2065 7175 616c 2069  mes must equal i
-000169e0: 7465 6d20 6669 656c 6420 6e61 6d65 7322  tem field names"
-000169f0: 2222 0a20 2020 2020 2020 2074 6d70 5f64  "".        tmp_d
-00016a00: 6174 6120 3d20 6d69 7174 662e 7461 6246  ata = miqtf.tabF
-00016a10: 696c 6544 6174 6128 6669 6c65 2c20 636f  ileData(file, co
-00016a20: 6c73 2b5b 2769 6d61 6765 2d66 696c 656e  ls+['image-filen
-00016a30: 616d 6527 5d2b 6f70 7469 6f6e 616c 2c20  ame']+optional, 
-00016a40: 6b65 795f 636f 6c3d 2769 6d61 6765 2d66  key_col='image-f
-00016a50: 696c 656e 616d 6527 2c20 6f70 7469 6f6e  ilename', option
-00016a60: 616c 3d6f 7074 696f 6e61 6c2c 636f 6e76  al=optional,conv
-00016a70: 6572 743d 5472 7565 290a 2020 2020 2020  ert=True).      
-00016a80: 2020 7365 6c66 2e77 7269 7465 5061 7273    self.writePars
-00016a90: 6564 4461 7461 546f 4974 656d 7328 746d  edDataToItems(tm
-00016aa0: 705f 6461 7461 2c69 7465 6d73 2c73 656c  p_data,items,sel
-00016ab0: 662e 6966 646f 5f74 6d70 5b6d 6971 7476  f.ifdo_tmp[miqtv
-00016ac0: 2e69 6d61 6765 5f73 6574 5f68 6561 6465  .image_set_heade
-00016ad0: 725f 6b65 795d 290a 0a0a 2020 2020 6465  r_key])...    de
-00016ae0: 6620 7072 6173 6549 7465 6d44 6174 6146  f praseItemDataF
-00016af0: 726f 6d46 696c 6528 7365 6c66 2c69 7465  romFile(self,ite
-00016b00: 6d73 3a64 6963 742c 6669 6c65 3a73 7472  ms:dict,file:str
-00016b10: 2c73 6570 6172 6174 6f72 3a73 7472 2c68  ,separator:str,h
-00016b20: 6561 6465 723a 6469 6374 293a 0a20 2020  eader:dict):.   
-00016b30: 2020 2020 2022 2222 2070 6172 7365 7320       """ parses 
-00016b40: 6461 7461 2066 726f 6d20 6672 6f6d 2066  data from from f
-00016b50: 696c 6520 746f 2069 7465 6d73 2e20 6865  ile to items. he
-00016b60: 6164 6572 2064 6963 7420 6d75 7374 2062  ader dict must b
-00016b70: 6520 6f66 2073 7472 7563 7475 7265 3a20  e of structure: 
-00016b80: 7b3c 6974 656d 2d66 6965 6c64 2d6e 616d  {<item-field-nam
-00016b90: 653e 3a3c 636f 6c75 6d6e 2d6e 616d 653e  e>:<column-name>
-00016ba0: 7d0a 2020 2020 2020 2020 2020 2020 616e  }.            an
-00016bb0: 6420 6d75 7374 2063 6f6e 7461 696e 2065  d must contain e
-00016bc0: 6e74 7279 2027 696d 6167 652d 6669 6c65  ntry 'image-file
-00016bd0: 6e61 6d65 2720 2222 220a 2020 2020 2020  name' """.      
-00016be0: 2020 6966 206e 6f74 2027 696d 6167 652d    if not 'image-
-00016bf0: 6669 6c65 6e61 6d65 2720 696e 2068 6561  filename' in hea
-00016c00: 6465 723a 0a20 2020 2020 2020 2020 2020  der:.           
-00016c10: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
-00016c20: 2822 6865 6164 6572 2064 6f65 7320 6e6f  ("header does no
-00016c30: 7420 636f 6e74 6169 6e20 2769 6d61 6765  t contain 'image
-00016c40: 2d66 696c 656e 616d 6527 2229 0a20 2020  -filename'").   
-00016c50: 2020 2020 200a 2020 2020 2020 2020 746d       .        tm
-00016c60: 705f 6461 7461 203d 206d 6971 7466 2e74  p_data = miqtf.t
-00016c70: 6162 4669 6c65 4461 7461 2866 696c 652c  abFileData(file,
-00016c80: 2068 6561 6465 722c 636f 6c5f 7365 7061   header,col_sepa
-00016c90: 7261 746f 723d 7365 7061 7261 746f 722c  rator=separator,
-00016ca0: 206b 6579 5f63 6f6c 3d27 696d 6167 652d   key_col='image-
-00016cb0: 6669 6c65 6e61 6d65 272c 636f 6e76 6572  filename',conver
-00016cc0: 743d 5472 7565 290a 2020 2020 2020 2020  t=True).        
-00016cd0: 7365 6c66 2e77 7269 7465 5061 7273 6564  self.writeParsed
-00016ce0: 4461 7461 546f 4974 656d 7328 746d 705f  DataToItems(tmp_
-00016cf0: 6461 7461 2c69 7465 6d73 2c73 656c 662e  data,items,self.
-00016d00: 6966 646f 5f74 6d70 5b6d 6971 7476 2e69  ifdo_tmp[miqtv.i
-00016d10: 6d61 6765 5f73 6574 5f68 6561 6465 725f  mage_set_header_
-00016d20: 6b65 795d 290a 0a0a 2020 2020 6465 6620  key])...    def 
-00016d30: 7772 6974 6550 6172 7365 6444 6174 6154  writeParsedDataT
-00016d40: 6f49 7465 6d73 2873 656c 662c 6461 7461  oItems(self,data
-00016d50: 3a64 6963 742c 6974 656d 733a 6469 6374  :dict,items:dict
-00016d60: 2c68 6561 6465 723a 6469 6374 293a 0a0a  ,header:dict):..
-00016d70: 2020 2020 2020 2020 2320 6576 616c 2073          # eval s
-00016d80: 7472 696e 6773 2061 7320 6469 6374 206f  trings as dict o
-00016d90: 7220 6c69 7374 0a20 2020 2020 2020 206d  r list.        m
-00016da0: 6971 7463 2e72 6563 7572 7369 7665 4576  iqtc.recursiveEv
-00016db0: 616c 2864 6174 6129 0a0a 2020 2020 2020  al(data)..      
-00016dc0: 2020 2320 706f 7465 6e74 6169 6c6c 7920    # potentailly 
-00016dd0: 7265 6d6f 7665 2063 6f6e 7374 2064 6174  remove const dat
-00016de0: 6120 6672 6f6d 2069 7465 6d73 2061 6e64  a from items and
-00016df0: 2070 7574 2069 6e20 6865 6164 6572 0a20   put in header. 
-00016e00: 2020 2020 2020 2073 656c 662e 6578 7472         self.extr
-00016e10: 6163 7443 6f6e 7374 4461 7461 5661 6c75  actConstDataValu
-00016e20: 6573 2864 6174 612c 6865 6164 6572 290a  es(data,header).
-00016e30: 0a20 2020 2020 2020 2066 6f72 2069 6d67  .        for img
-00016e40: 2069 6e20 6461 7461 3a0a 2020 2020 2020   in data:.      
-00016e50: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-00016e60: 2020 2069 6620 696d 6720 6e6f 7420 696e     if img not in
-00016e70: 2069 7465 6d73 3a0a 2020 2020 2020 2020   items:.        
-00016e80: 2020 2020 2020 2020 6974 656d 735b 696d          items[im
-00016e90: 675d 203d 207b 7d0a 2020 2020 2020 2020  g] = {}.        
-00016ea0: 2020 2020 2320 7265 6d6f 7665 2070 6f74      # remove pot
-00016eb0: 656e 7469 616c 204e 6f6e 6520 656e 7472  ential None entr
-00016ec0: 6965 730a 2020 2020 2020 2020 2020 2020  ies.            
-00016ed0: 6461 7461 5b69 6d67 5d20 3d20 6d69 7174  data[img] = miqt
-00016ee0: 632e 7265 6375 7273 6976 656c 7952 656d  c.recursivelyRem
-00016ef0: 6f76 6545 6d70 7479 4669 656c 6473 2864  oveEmptyFields(d
-00016f00: 6174 615b 696d 675d 2c63 6f6e 7465 6e74  ata[img],content
-00016f10: 3262 6552 656d 6f76 6564 3d4e 6f6e 6529  2beRemoved=None)
-00016f20: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00016f30: 2069 7369 6e73 7461 6e63 6528 6461 7461   isinstance(data
-00016f40: 5b69 6d67 5d2c 6c69 7374 293a 0a20 2020  [img],list):.   
-00016f50: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00016f60: 6e6f 7420 6973 696e 7374 616e 6365 2869  not isinstance(i
-00016f70: 7465 6d73 5b69 6d67 5d2c 6c69 7374 293a  tems[img],list):
-00016f80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016f90: 2020 2020 2069 6620 6974 656d 735b 696d       if items[im
-00016fa0: 675d 203d 3d20 7b7d 3a0a 2020 2020 2020  g] == {}:.      
-00016fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016fc0: 2020 6974 656d 735b 696d 675d 203d 205b    items[img] = [
-00016fd0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00016fe0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00016ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017000: 2020 2020 6974 656d 735b 696d 675d 203d      items[img] =
-00017010: 205b 6974 656d 735b 696d 675d 5d0a 2020   [items[img]].  
-00017020: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00017030: 7220 7620 696e 2064 6174 615b 696d 675d  r v in data[img]
-00017040: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00017050: 2020 2020 2020 765b 2769 6d61 6765 2d66        v['image-f
-00017060: 696c 656e 616d 6527 5d20 3d20 696d 670a  ilename'] = img.
-00017070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017080: 2020 2020 6974 656d 735b 696d 675d 2e61      items[img].a
-00017090: 7070 656e 6428 7629 0a20 2020 2020 2020  ppend(v).       
-000170a0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000170b0: 2020 2020 2020 2020 2020 2066 6f72 2076             for v
-000170c0: 2069 6e20 6461 7461 5b69 6d67 5d3a 2023   in data[img]: #
-000170d0: 2077 6f72 6b73 2069 6620 6461 7461 5b69   works if data[i
-000170e0: 6d67 5d20 6973 2064 6963 740a 0a20 2020  mg] is dict..   
-000170f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017100: 2076 616c 203d 2064 6174 615b 696d 675d   val = data[img]
-00017110: 5b76 5d0a 2020 2020 2020 2020 2020 2020  [v].            
-00017120: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00017130: 7461 6e63 6528 6974 656d 735b 696d 675d  tance(items[img]
-00017140: 2c6c 6973 7429 3a20 2320 6974 656d 2069  ,list): # item i
-00017150: 7320 616c 7265 6164 7920 6120 6c69 7374  s already a list
-00017160: 2028 7669 6465 6f29 2062 7574 2070 6172   (video) but par
-00017170: 7365 6420 6461 7461 2069 7320 6e6f 742c  sed data is not,
-00017180: 2069 2e65 2e20 7061 7273 6564 2064 6174   i.e. parsed dat
-00017190: 6120 7265 6665 7273 2074 6f20 7768 6f6c  a refers to whol
-000171a0: 6520 7669 6465 6f20 2874 696d 6520 696e  e video (time in
-000171b0: 6465 7065 6e64 656e 7429 2c20 692e 652e  dependent), i.e.
-000171c0: 2077 7269 7465 2074 6f20 6669 7273 7420   write to first 
-000171d0: 656e 7472 790a 2020 2020 2020 2020 2020  entry.          
-000171e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000171f0: 206e 6f74 2076 616c 2069 7320 4e6f 6e65   not val is None
-00017200: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00017210: 2020 2020 2020 2020 2020 2020 2020 6974                it
-00017220: 656d 735b 696d 675d 5b30 5d5b 765d 203d  ems[img][0][v] =
-00017230: 2076 616c 0a20 2020 2020 2020 2020 2020   val.           
-00017240: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00017250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017260: 2020 2020 2020 2069 6620 6e6f 7420 7661         if not va
-00017270: 6c20 6973 204e 6f6e 653a 0a20 2020 2020  l is None:.     
-00017280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017290: 2020 2020 2020 2069 7465 6d73 5b69 6d67         items[img
-000172a0: 5d5b 765d 203d 2076 616c 0a20 2020 2020  ][v] = val.     
-000172b0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-000172c0: 696e 7374 616e 6365 2869 7465 6d73 5b69  instance(items[i
-000172d0: 6d67 5d2c 6c69 7374 293a 2023 2069 7465  mg],list): # ite
-000172e0: 6d20 6973 2061 6c72 6561 6479 2061 206c  m is already a l
-000172f0: 6973 7420 2876 6964 656f 2920 6275 7420  ist (video) but 
-00017300: 7061 7273 6564 2064 6174 6120 6973 206e  parsed data is n
-00017310: 6f74 2c20 692e 652e 2070 6172 7365 6420  ot, i.e. parsed 
-00017320: 6461 7461 2072 6566 6572 7320 746f 2077  data refers to w
-00017330: 686f 6c65 2076 6964 656f 2028 7469 6d65  hole video (time
-00017340: 2069 6e64 6570 656e 6465 6e74 292c 2069   independent), i
-00017350: 2e65 2e20 7772 6974 6520 746f 2066 6972  .e. write to fir
-00017360: 7374 2065 6e74 7279 0a20 2020 2020 2020  st entry.       
-00017370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017380: 2069 7465 6d73 5b69 6d67 5d5b 305d 5b27   items[img][0]['
-00017390: 696d 6167 652d 6669 6c65 6e61 6d65 275d  image-filename']
-000173a0: 203d 2069 6d67 0a20 2020 2020 2020 2020   = img.         
-000173b0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000173c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000173d0: 2069 7465 6d73 5b69 6d67 5d5b 2769 6d61   items[img]['ima
-000173e0: 6765 2d66 696c 656e 616d 6527 5d20 3d20  ge-filename'] = 
-000173f0: 696d 670a 0a0a 2020 2020 4073 7461 7469  img...    @stati
-00017400: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
-00017410: 6578 7472 6163 7443 6f6e 7374 4461 7461  extractConstData
-00017420: 5661 6c75 6573 2864 6174 613a 6469 6374  Values(data:dict
-00017430: 2c68 6561 6465 723a 6469 6374 293a 0a20  ,header:dict):. 
-00017440: 2020 2020 2020 2022 2222 2052 656d 6f76         """ Remov
-00017450: 6573 2066 6965 6c64 7320 7468 6174 2061  es fields that a
-00017460: 7265 2063 6f6e 7374 616e 7420 666f 7220  re constant for 
-00017470: 616c 6c20 656e 7472 6965 7320 6672 6f6d  all entries from
-00017480: 2064 6174 6120 6469 6374 2061 6e64 2070   data dict and p
-00017490: 7574 2074 6865 6d20 696e 2068 6561 6465  ut them in heade
-000174a0: 7220 6469 6374 2e20 0a20 2020 2020 2020  r dict. .       
-000174b0: 2020 2020 2045 6163 6820 656e 7472 7920       Each entry 
-000174c0: 6f66 2064 6174 6120 6d75 7374 2062 6520  of data must be 
-000174d0: 6120 6469 6374 2077 6974 6820 7468 6520  a dict with the 
-000174e0: 7361 6d65 2073 6574 206f 6620 6b65 7973  same set of keys
-000174f0: 2e20 2222 220a 2020 2020 0a20 2020 2020  . """.    .     
-00017500: 2020 2066 6965 6c64 7354 6f49 676e 6f72     fieldsToIgnor
-00017510: 6520 3d20 5b27 696d 6167 652d 6461 7465  e = ['image-date
-00017520: 7469 6d65 275d 0a20 2020 2020 2020 2063  time'].        c
-00017530: 6f6e 7374 4461 7461 203d 207b 7d0a 2020  onstData = {}.  
-00017540: 2020 2020 2020 6669 7273 7449 6d61 6765        firstImage
-00017550: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00017560: 666f 7220 696d 6167 652c 696d 6167 655f  for image,image_
-00017570: 6461 7461 2069 6e20 6461 7461 2e69 7465  data in data.ite
-00017580: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-00017590: 2020 0a20 2020 2020 2020 2020 2020 2069    .            i
-000175a0: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-000175b0: 2869 6d61 6765 5f64 6174 612c 6c69 7374  (image_data,list
-000175c0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000175d0: 2020 2069 6d61 6765 5f64 6174 6120 3d20     image_data = 
-000175e0: 5b69 6d61 6765 5f64 6174 615d 0a0a 2020  [image_data]..  
-000175f0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00017600: 2066 6972 7374 496d 6167 6520 616e 6420   firstImage and 
-00017610: 636f 6e73 7444 6174 6120 3d3d 207b 7d3a  constData == {}:
-00017620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017630: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
-00017640: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-00017650: 6669 7273 7454 696d 6550 6f69 6e74 203d  firstTimePoint =
-00017660: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-00017670: 2020 666f 7220 696d 6167 655f 7470 5f64    for image_tp_d
-00017680: 6174 6120 696e 2069 6d61 6765 5f64 6174  ata in image_dat
-00017690: 613a 0a20 2020 2020 2020 2020 2020 2020  a:.             
-000176a0: 2020 2023 2076 6572 7920 6669 7273 7420     # very first 
-000176b0: 6461 7461 2066 6f72 2063 6f6d 7061 7269  data for compari
-000176c0: 736f 6e0a 2020 2020 2020 2020 2020 2020  son.            
-000176d0: 2020 2020 6966 2066 6972 7374 496d 6167      if firstImag
-000176e0: 6520 616e 6420 6669 7273 7454 696d 6550  e and firstTimeP
-000176f0: 6f69 6e74 3a0a 2020 2020 2020 2020 2020  oint:.          
-00017700: 2020 2020 2020 2020 2020 636f 6e73 7444            constD
-00017710: 6174 6120 3d20 636f 7079 2e64 6565 7063  ata = copy.deepc
-00017720: 6f70 7928 696d 6167 655f 7470 5f64 6174  opy(image_tp_dat
-00017730: 6129 0a20 2020 2020 2020 2020 2020 2020  a).             
-00017740: 2020 2020 2020 2066 6f72 2066 6965 6c64         for field
-00017750: 2069 6e20 6669 656c 6473 546f 4967 6e6f   in fieldsToIgno
-00017760: 7265 3a0a 2020 2020 2020 2020 2020 2020  re:.            
-00017770: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-00017780: 6965 6c64 2069 6e20 636f 6e73 7444 6174  ield in constDat
-00017790: 613a 0a20 2020 2020 2020 2020 2020 2020  a:.             
-000177a0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-000177b0: 656c 2063 6f6e 7374 4461 7461 5b66 6965  el constData[fie
-000177c0: 6c64 5d0a 2020 2020 2020 2020 2020 2020  ld].            
-000177d0: 2020 2020 2020 2020 6669 7273 7454 696d          firstTim
-000177e0: 6550 6f69 6e74 203d 2046 616c 7365 0a20  ePoint = False. 
-000177f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017800: 2020 2063 6f6e 7469 6e75 650a 0a20 2020     continue..   
-00017810: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00017820: 7374 4461 7461 203d 206d 6971 7463 2e66  stData = miqtc.f
-00017830: 696e 6443 6f6d 6d6f 6e44 6963 7445 6c65  indCommonDictEle
-00017840: 6d65 6e74 7328 696d 6167 655f 7470 5f64  ments(image_tp_d
-00017850: 6174 612c 636f 6e73 7444 6174 6129 0a0a  ata,constData)..
-00017860: 2020 2020 2020 2020 2020 2020 6669 7273              firs
-00017870: 7449 6d61 6765 203d 2046 616c 7365 0a0a  tImage = False..
-00017880: 2020 2020 2020 2020 2320 544f 444f 2063          # TODO c
-00017890: 6865 636b 2077 6974 6869 6e20 696d 6167  heck within imag
-000178a0: 6520 7469 6d65 7320 2d3e 2074 6f20 696d  e times -> to im
-000178b0: 6167 6520 6465 6661 756c 742e 2028 7472  age default. (tr
-000178c0: 6963 6b79 2073 696e 6365 2077 6520 646f  icky since we do
-000178d0: 6e27 7420 6861 7665 2074 6865 2064 6166  n't have the daf
-000178e0: 6175 6c74 2069 6e64 6578 2068 6572 652e  ault index here.
-000178f0: 204f 6e6c 7920 6120 7375 6273 6574 206d   Only a subset m
-00017900: 6967 6874 2062 6520 7570 6461 7465 2068  ight be update h
-00017910: 6572 6529 0a20 2020 2020 2020 2023 2063  ere).        # c
-00017920: 6865 636b 2077 6974 6869 6e20 696d 6167  heck within imag
-00017930: 6520 6974 656d 7320 2d3e 2068 6561 6465  e items -> heade
-00017940: 720a 2020 2020 2020 2020 6865 6164 6572  r.        header
-00017950: 5570 6461 7465 203d 2063 6f70 792e 6465  Update = copy.de
-00017960: 6570 636f 7079 2863 6f6e 7374 4461 7461  epcopy(constData
-00017970: 290a 2020 2020 2020 2020 6865 6164 6572  ).        header
-00017980: 5570 6461 7465 6454 6573 7420 3d20 636f  UpdatedTest = co
-00017990: 7079 2e64 6565 7063 6f70 7928 6865 6164  py.deepcopy(head
-000179a0: 6572 290a 2020 2020 2020 2020 6d69 7174  er).        miqt
-000179b0: 632e 7265 6375 7273 6976 656c 7955 7064  c.recursivelyUpd
-000179c0: 6174 6544 6963 7473 2868 6561 6465 7255  ateDicts(headerU
-000179d0: 7064 6174 6564 5465 7374 2c68 6561 6465  pdatedTest,heade
-000179e0: 7255 7064 6174 6529 0a20 2020 2020 2020  rUpdate).       
-000179f0: 2075 7064 6174 6544 6966 6620 3d20 4465   updateDiff = De
-00017a00: 6570 4469 6666 2868 6561 6465 722c 6865  epDiff(header,he
-00017a10: 6164 6572 5570 6461 7465 6454 6573 7429  aderUpdatedTest)
-00017a20: 0a20 2020 2020 2020 2023 2063 6865 636b  .        # check
-00017a30: 2069 6620 6865 6164 6572 5570 6461 7465   if headerUpdate
-00017a40: 2077 6f75 6c64 206f 7665 7277 7269 7465   would overwrite
-00017a50: 2061 6e79 7468 696e 6720 6672 6f6d 2063   anything from c
-00017a60: 7572 7265 6e74 2068 6561 6465 7220 2873  urrent header (s
-00017a70: 686f 756c 6420 6e6f 7420 6861 7070 656e  hould not happen
-00017a80: 292c 2069 6620 736f 2064 6f6e 7420 7265  ), if so dont re
-00017a90: 6d6f 7665 2066 726f 6d20 6974 656d 730a  move from items.
-00017aa0: 2020 2020 2020 2020 6966 206e 6f74 2027          if not '
-00017ab0: 7661 6c75 6573 5f63 6861 6e67 6564 2720  values_changed' 
-00017ac0: 696e 2075 7064 6174 6544 6966 6620 616e  in updateDiff an
-00017ad0: 6420 6e6f 7420 2774 7970 655f 6368 616e  d not 'type_chan
-00017ae0: 6765 7327 2069 6e20 7570 6461 7465 4469  ges' in updateDi
-00017af0: 6666 2061 6e64 206e 6f74 2027 6469 6374  ff and not 'dict
-00017b00: 696f 6e61 7279 5f69 7465 6d5f 7265 6d6f  ionary_item_remo
-00017b10: 7665 6427 2069 6e20 7570 6461 7465 4469  ved' in updateDi
-00017b20: 6666 3a0a 2020 2020 2020 2020 2020 2020  ff:.            
-00017b30: 6865 6164 6572 2e63 6c65 6172 2829 0a20  header.clear(). 
-00017b40: 2020 2020 2020 2020 2020 2068 6561 6465             heade
-00017b50: 722e 7570 6461 7465 2868 6561 6465 7255  r.update(headerU
-00017b60: 7064 6174 6564 5465 7374 290a 0a20 2020  pdatedTest)..   
-00017b70: 2020 2020 2020 2020 2023 2072 656d 6f76           # remov
-00017b80: 6520 636f 6e73 7420 7661 6c75 6573 2066  e const values f
-00017b90: 726f 6d20 6461 7461 0a20 2020 2020 2020  rom data.       
-00017ba0: 2020 2020 206d 6971 7463 2e72 6563 7572       miqtc.recur
-00017bb0: 7369 7665 4d61 6b65 4e6f 6e65 4469 6374  siveMakeNoneDict
-00017bc0: 4669 656c 6473 456d 7074 7953 7472 2863  FieldsEmptyStr(c
-00017bd0: 6f6e 7374 4461 7461 290a 2020 2020 2020  onstData).      
-00017be0: 2020 2020 2020 666f 7220 696d 6167 652c        for image,
-00017bf0: 696d 6167 655f 6461 7461 2069 6e20 6461  image_data in da
-00017c00: 7461 2e69 7465 6d73 2829 3a0a 2020 2020  ta.items():.    
-00017c10: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00017c20: 6f74 2069 7369 6e73 7461 6e63 6528 696d  ot isinstance(im
-00017c30: 6167 655f 6461 7461 2c6c 6973 7429 3a0a  age_data,list):.
-00017c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017c50: 2020 2020 696d 6167 655f 6461 7461 203d      image_data =
-00017c60: 205b 696d 6167 655f 6461 7461 5d0a 2020   [image_data].  
-00017c70: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00017c80: 7220 696d 6167 655f 7470 5f64 6174 6120  r image_tp_data 
-00017c90: 696e 2069 6d61 6765 5f64 6174 613a 0a20  in image_data:. 
-00017ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017cb0: 2020 206d 6971 7463 2e72 6563 7572 7369     miqtc.recursi
-00017cc0: 7665 6c79 5570 6461 7465 4469 6374 7328  velyUpdateDicts(
-00017cd0: 696d 6167 655f 7470 5f64 6174 612c 636f  image_tp_data,co
-00017ce0: 6e73 7444 6174 6129 2020 2020 2020 2020  nstData)        
-00017cf0: 2020 0a0a 2020 2020 2020 2020 656c 7365    ..        else
-00017d00: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
-00017d10: 7373 0a20 2020 2020 2020 2020 2020 2023  ss.            #
-00017d20: 2054 4f44 4f20 6c6f 673f 0a20 2020 2020   TODO log?.     
-00017d30: 0a0a 2020 2020 6465 6620 696e 7465 726d  ..    def interm
-00017d40: 6564 6961 7465 4e61 7646 696c 6545 7869  ediateNavFileExi
-00017d50: 7374 7328 7365 6c66 293a 0a20 2020 2020  sts(self):.     
-00017d60: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
-00017d70: 6973 7473 2873 656c 662e 6765 745f 696e  ists(self.get_in
-00017d80: 745f 6e61 765f 6669 6c65 2829 293a 0a20  t_nav_file()):. 
-00017d90: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00017da0: 6e20 5472 7565 0a20 2020 2020 2020 2065  n True.        e
-00017db0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00017dc0: 2072 6574 7572 6e20 4661 6c73 650a 0a0a   return False...
-00017dd0: 2020 2020 6465 6620 616c 6c4e 6176 4669      def allNavFi
-00017de0: 656c 6473 496e 4865 6164 6572 2873 656c  eldsInHeader(sel
-00017df0: 6629 3a0a 2020 2020 2020 2020 666f 7220  f):.        for 
-00017e00: 6669 656c 6420 696e 2073 656c 662e 7265  field in self.re
-00017e10: 714e 6176 4669 656c 6473 3a0a 2020 2020  qNavFields:.    
-00017e20: 2020 2020 2020 2020 2320 6d75 6c74 6970          # multip
-00017e30: 6c65 206f 7074 696f 6e73 0a20 2020 2020  le options.     
-00017e40: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00017e50: 616e 6365 2866 6965 6c64 2c6c 6973 7429  ance(field,list)
-00017e60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00017e70: 2020 7661 6c69 6420 3d20 4661 6c73 650a    valid = False.
-00017e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e90: 666f 7220 7375 6266 6965 6c64 2069 6e20  for subfield in 
-00017ea0: 6669 656c 643a 0a20 2020 2020 2020 2020  field:.         
-00017eb0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00017ec0: 6c66 2e68 6561 6465 7246 6965 6c64 4669  lf.headerFieldFi
-00017ed0: 6c6c 6564 2873 7562 6669 656c 6429 3a0a  lled(subfield):.
-00017ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ef0: 2020 2020 2020 2020 7661 6c69 6420 3d20          valid = 
-00017f00: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00017f10: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-00017f20: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
-00017f30: 2020 2069 6620 6e6f 7420 7661 6c69 643a     if not valid:
-00017f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017f50: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00017f60: 650a 2020 2020 2020 2020 2020 2020 2320  e.            # 
-00017f70: 7369 6e67 6c65 206f 7074 696f 6e0a 2020  single option.  
-00017f80: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00017f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017fa0: 6966 206e 6f74 2073 656c 662e 6865 6164  if not self.head
-00017fb0: 6572 4669 656c 6446 696c 6c65 6428 6669  erFieldFilled(fi
-00017fc0: 656c 6429 3a0a 2020 2020 2020 2020 2020  eld):.          
-00017fd0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00017fe0: 2046 616c 7365 0a20 2020 2020 2020 2072   False.        r
-00017ff0: 6574 7572 6e20 5472 7565 0a0a 2020 2020  eturn True..    
-00018000: 6465 6620 6865 6164 6572 4669 656c 6446  def headerFieldF
-00018010: 696c 6c65 6428 7365 6c66 2c66 6965 6c64  illed(self,field
-00018020: 3a73 7472 293a 0a20 2020 2020 2020 2069  :str):.        i
-00018030: 6620 7365 6c66 2e66 696e 6454 6d70 4669  f self.findTmpFi
-00018040: 656c 6432 2866 6965 6c64 2920 3d3d 2022  eld2(field) == "
-00018050: 223a 0a20 2020 2020 2020 2020 2020 2072  ":.            r
-00018060: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
-00018070: 2020 2020 7265 7475 726e 2054 7275 650a      return True.
-00018080: 0a20 2020 2064 6566 2063 6f6e 7665 7274  .    def convert
-00018090: 546f 4465 6661 756c 7444 6174 6554 696d  ToDefaultDateTim
-000180a0: 6546 6f72 6d61 7428 7365 6c66 2c69 6664  eFormat(self,ifd
-000180b0: 6f29 3a0a 2020 2020 2020 2020 2222 2220  o):.        """ 
-000180c0: 4368 6563 6b73 2069 6620 616c 6c20 6974  Checks if all it
-000180d0: 656d 7327 2027 696d 6167 652d 6461 7465  ems' 'image-date
-000180e0: 7469 6d65 2720 6669 656c 6473 206d 6174  time' fields mat
-000180f0: 6368 2064 6566 6175 6c74 2064 6174 6574  ch default datet
-00018100: 696d 6520 666f 726d 6174 206f 7220 6120  ime format or a 
-00018110: 6375 7374 6f6d 206f 6e65 2064 6566 696e  custom one defin
-00018120: 6564 2069 6e20 2769 6d61 6765 2d64 6174  ed in 'image-dat
-00018130: 6574 696d 652d 666f 726d 6174 270a 2020  etime-format'.  
-00018140: 2020 2020 2020 2020 2020 616e 6420 636f            and co
-00018150: 6e76 6572 7473 2074 6f20 6465 6661 756c  nverts to defaul
-00018160: 7420 666f 726d 6174 2e20 5468 726f 7773  t format. Throws
-00018170: 2065 7863 6570 7469 6f6e 2069 6620 6461   exception if da
-00018180: 7465 7469 6d65 2063 616e 6e6f 7420 6265  tetime cannot be
-00018190: 2070 6172 7365 6420 2222 220a 2020 2020   parsed """.    
-000181a0: 2020 2020 6375 7374 6f6d 4461 7465 5469      customDateTi
-000181b0: 6d65 466f 726d 6174 466f 756e 6420 3d20  meFormatFound = 
-000181c0: 4661 6c73 650a 2020 2020 2020 2020 6865  False.        he
-000181d0: 6164 6572 4375 7374 6f6d 4461 7465 5469  aderCustomDateTi
-000181e0: 6d65 466f 726d 6174 203d 2066 696e 6446  meFormat = findF
-000181f0: 6965 6c64 2869 6664 6f5b 7365 6c66 2e69  ield(ifdo[self.i
-00018200: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
-00018210: 5d2c 2769 6d61 6765 2d64 6174 6574 696d  ],'image-datetim
-00018220: 652d 666f 726d 6174 2729 0a20 2020 2020  e-format').     
-00018230: 2020 2069 6620 6865 6164 6572 4375 7374     if headerCust
-00018240: 6f6d 4461 7465 5469 6d65 466f 726d 6174  omDateTimeFormat
-00018250: 2021 3d20 2222 3a0a 2020 2020 2020 2020   != "":.        
-00018260: 2020 2020 6966 646f 5b73 656c 662e 696d      ifdo[self.im
-00018270: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
-00018280: 5b27 696d 6167 652d 6461 7465 7469 6d65  ['image-datetime
-00018290: 2d66 6f72 6d61 7427 5d20 3d20 2222 2023  -format'] = "" #
-000182a0: 2072 656d 6f76 6520 6375 7374 6f6d 2066   remove custom f
-000182b0: 6f72 6d61 740a 2020 2020 2020 2020 2020  ormat.          
-000182c0: 2020 6375 7374 6f6d 4461 7465 5469 6d65    customDateTime
-000182d0: 466f 726d 6174 466f 756e 6420 3d20 5472  FormatFound = Tr
-000182e0: 7565 0a20 2020 2020 2020 2070 726f 6720  ue.        prog 
-000182f0: 3d20 6d69 7174 632e 5072 696e 744b 6e6f  = miqtc.PrintKno
-00018300: 776e 5072 6f67 7265 7373 4d73 6728 2243  wnProgressMsg("C
-00018310: 6865 636b 696e 6720 6461 7465 7469 6d65  hecking datetime
-00018320: 2066 6f72 6d61 7422 2c20 6c65 6e28 6966   format", len(if
-00018330: 646f 5b73 656c 662e 696d 6167 6553 6574  do[self.imageSet
-00018340: 4974 656d 734b 6579 5d29 2c6d 6f64 756c  ItemsKey]),modul
-00018350: 6f3d 3129 0a20 2020 2020 2020 2066 6f72  o=1).        for
-00018360: 2066 696c 652c 6974 656d 2069 6e20 6966   file,item in if
-00018370: 646f 5b73 656c 662e 696d 6167 6553 6574  do[self.imageSet
-00018380: 4974 656d 734b 6579 5d2e 6974 656d 7328  ItemsKey].items(
-00018390: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
-000183a0: 726f 672e 7072 6f67 7265 7373 2829 0a20  rog.progress(). 
-000183b0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-000183c0: 7420 6973 696e 7374 616e 6365 2869 7465  t isinstance(ite
-000183d0: 6d2c 6c69 7374 293a 0a20 2020 2020 2020  m,list):.       
-000183e0: 2020 2020 2020 2020 2020 2020 2069 7465               ite
-000183f0: 6d20 3d20 5b69 7465 6d5d 0a20 2020 2020  m = [item].     
-00018400: 2020 2020 2020 2073 7562 4974 656d 4465         subItemDe
-00018410: 6661 756c 7420 3d20 6974 656d 5b30 5d0a  fault = item[0].
-00018420: 2020 2020 2020 2020 2020 2020 6974 656d              item
-00018430: 4375 7374 6f6d 4461 7465 5469 6d65 466f  CustomDateTimeFo
-00018440: 726d 6174 203d 2022 220a 2020 2020 2020  rmat = "".      
-00018450: 2020 2020 2020 6966 2027 696d 6167 652d        if 'image-
-00018460: 6461 7465 7469 6d65 2d66 6f72 6d61 7427  datetime-format'
-00018470: 2069 6e20 7375 6249 7465 6d44 6566 6175   in subItemDefau
-00018480: 6c74 3a0a 2020 2020 2020 2020 2020 2020  lt:.            
-00018490: 2020 2020 6974 656d 4375 7374 6f6d 4461      itemCustomDa
-000184a0: 7465 5469 6d65 466f 726d 6174 203d 2073  teTimeFormat = s
-000184b0: 7562 4974 656d 4465 6661 756c 745b 2769  ubItemDefault['i
-000184c0: 6d61 6765 2d64 6174 6574 696d 652d 666f  mage-datetime-fo
-000184d0: 726d 6174 275d 0a20 2020 2020 2020 2020  rmat'].         
-000184e0: 2020 2020 2020 2073 7562 4974 656d 4465         subItemDe
-000184f0: 6661 756c 745b 2769 6d61 6765 2d64 6174  fault['image-dat
-00018500: 6574 696d 652d 666f 726d 6174 275d 203d  etime-format'] =
-00018510: 2022 2220 2320 7265 6d6f 7665 2063 7573   "" # remove cus
-00018520: 746f 6d20 666f 726d 6174 0a20 2020 2020  tom format.     
-00018530: 2020 2020 2020 2020 2020 2063 7573 746f             custo
-00018540: 6d44 6174 6554 696d 6546 6f72 6d61 7446  mDateTimeFormatF
-00018550: 6f75 6e64 203d 2054 7275 650a 2020 2020  ound = True.    
-00018560: 2020 2020 2020 2020 666f 7220 7375 6249          for subI
-00018570: 7465 6d20 696e 2069 7465 6d3a 0a20 2020  tem in item:.   
-00018580: 2020 2020 2020 2020 2020 2020 2074 7279               try
-00018590: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000185a0: 2020 2020 2020 666f 726d 6174 203d 206d        format = m
-000185b0: 6971 7476 2e64 6174 655f 666f 726d 6174  iqtv.date_format
-000185c0: 735b 276d 6172 6971 7427 5d0a 2020 2020  s['mariqt'].    
-000185d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000185e0: 6461 7465 7469 6d65 2e64 6174 6574 696d  datetime.datetim
-000185f0: 652e 7374 7270 7469 6d65 2873 7562 4974  e.strptime(subIt
-00018600: 656d 5b27 696d 6167 652d 6461 7465 7469  em['image-dateti
-00018610: 6d65 275d 2c66 6f72 6d61 7429 0a20 2020  me'],format).   
-00018620: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-00018630: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
-00018640: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-00018650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018660: 2020 2020 2020 666f 726d 6174 203d 2068        format = h
-00018670: 6561 6465 7243 7573 746f 6d44 6174 6554  eaderCustomDateT
-00018680: 696d 6546 6f72 6d61 740a 2020 2020 2020  imeFormat.      
-00018690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000186a0: 2020 6474 203d 2064 6174 6574 696d 652e    dt = datetime.
-000186b0: 6461 7465 7469 6d65 2e73 7472 7074 696d  datetime.strptim
-000186c0: 6528 7375 6249 7465 6d5b 2769 6d61 6765  e(subItem['image
-000186d0: 2d64 6174 6574 696d 6527 5d2c 666f 726d  -datetime'],form
-000186e0: 6174 290a 2020 2020 2020 2020 2020 2020  at).            
-000186f0: 2020 2020 2020 2020 2020 2020 7375 6249              subI
-00018700: 7465 6d5b 2769 6d61 6765 2d64 6174 6574  tem['image-datet
-00018710: 696d 6527 5d20 3d20 6461 7465 7469 6d65  ime'] = datetime
-00018720: 2e64 6174 6574 696d 652e 7374 7266 7469  .datetime.strfti
-00018730: 6d65 2864 742c 6d69 7174 762e 6461 7465  me(dt,miqtv.date
-00018740: 5f66 6f72 6d61 7473 5b27 6d61 7269 7174  _formats['mariqt
-00018750: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
-00018760: 2020 2020 2020 2020 6578 6365 7074 3a0a          except:.
-00018770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018780: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00018790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000187a0: 2020 2020 2020 2020 2066 6f72 6d61 7420           format 
-000187b0: 3d20 6974 656d 4375 7374 6f6d 4461 7465  = itemCustomDate
-000187c0: 5469 6d65 466f 726d 6174 0a20 2020 2020  TimeFormat.     
-000187d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000187e0: 2020 2020 2020 2064 7420 3d20 6461 7465         dt = date
-000187f0: 7469 6d65 2e64 6174 6574 696d 652e 7374  time.datetime.st
-00018800: 7270 7469 6d65 2873 7562 4974 656d 5b27  rptime(subItem['
-00018810: 696d 6167 652d 6461 7465 7469 6d65 275d  image-datetime']
-00018820: 2c66 6f72 6d61 7429 0a20 2020 2020 2020  ,format).       
-00018830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018840: 2020 2020 2073 7562 4974 656d 5b27 696d       subItem['im
-00018850: 6167 652d 6461 7465 7469 6d65 275d 203d  age-datetime'] =
-00018860: 2064 6174 6574 696d 652e 6461 7465 7469   datetime.dateti
-00018870: 6d65 2e73 7472 6674 696d 6528 6474 2c6d  me.strftime(dt,m
-00018880: 6971 7476 2e64 6174 655f 666f 726d 6174  iqtv.date_format
-00018890: 735b 276d 6172 6971 7427 5d29 0a20 2020  s['mariqt']).   
-000188a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000188b0: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
-000188c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000188d0: 2020 2020 2020 2020 2070 726f 672e 636c           prog.cl
-000188e0: 6561 7228 290a 2020 2020 2020 2020 2020  ear().          
-000188f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018900: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
-00018910: 646f 4578 6365 7074 696f 6e28 2749 6e76  doException('Inv
-00018920: 616c 6964 2064 6174 6574 696d 6520 7661  alid datetime va
-00018930: 6c75 6527 2c73 7562 4974 656d 5b27 696d  lue',subItem['im
-00018940: 6167 652d 6461 7465 7469 6d65 275d 2c20  age-datetime'], 
-00018950: 2264 6f65 7320 6e6f 7420 6d61 7463 6820  "does not match 
-00018960: 666f 726d 6174 2064 6566 6175 6c74 206f  format default o
-00018970: 7220 6375 7374 6f6d 2066 6f72 6d61 7422  r custom format"
-00018980: 290a 2020 2020 2020 2020 6966 2063 7573  ).        if cus
-00018990: 746f 6d44 6174 6554 696d 6546 6f72 6d61  tomDateTimeForma
-000189a0: 7446 6f75 6e64 3a0a 2020 2020 2020 2020  tFound:.        
-000189b0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-000189c0: 6728 2243 7573 746f 6d20 6461 7465 7469  g("Custom dateti
-000189d0: 6d65 2066 6f72 6d61 7473 2066 6f75 6e64  me formats found
-000189e0: 2e20 5468 6579 2077 696c 6c20 6265 2072  . They will be r
-000189f0: 6570 6c61 6365 6420 6279 2074 6865 2064  eplaced by the d
-00018a00: 6566 6175 6c74 2066 6f72 6d61 742e 2229  efault format.")
-00018a10: 2020 200a 2020 2020 2020 2020 7072 6f67     .        prog
-00018a20: 2e63 6c65 6172 2829 2020 2020 0a0a 0a20  .clear()    ... 
-00018a30: 2020 2064 6566 205f 5f69 6e69 7449 6e74     def __initInt
-00018a40: 6572 6d65 6469 6174 6546 696c 6573 2873  ermediateFiles(s
-00018a50: 656c 6629 3a0a 2020 2020 2020 2020 7365  elf):.        se
-00018a60: 6c66 2e69 6e74 6572 6d65 6469 6174 6546  lf.intermediateF
-00018a70: 696c 6573 4465 665f 636f 7265 203d 207b  ilesDef_core = {
-00018a80: 0a20 2020 2020 2020 2020 2020 2027 6861  .            'ha
-00018a90: 7368 6573 273a 207b 0a20 2020 2020 2020  shes': {.       
-00018aa0: 2020 2020 2020 2020 2027 6372 6561 7469           'creati
-00018ab0: 6f6e 4663 7427 3a20 2763 7265 6174 6549  onFct': 'createI
-00018ac0: 6d61 6765 5348 4132 3536 4669 6c65 2829  mageSHA256File()
-00018ad0: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-00018ae0: 2020 2027 7375 6666 6978 273a 2027 5f69     'suffix': '_i
-00018af0: 6d61 6765 2d68 6173 6865 732e 7478 7427  mage-hashes.txt'
-00018b00: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00018b10: 2020 2763 6f6c 7327 3a20 5b6d 6971 7476    'cols': [miqtv
-00018b20: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00018b30: 6971 7427 5d5b 2768 6173 6827 5d5d 2c0a  iqt']['hash']],.
-00018b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018b50: 276f 7074 696f 6e61 6c27 3a20 5b5d 7d2c  'optional': []},
-00018b60: 0a20 2020 2020 2020 2020 2020 2027 7575  .            'uu
-00018b70: 6964 7327 3a20 7b0a 2020 2020 2020 2020  ids': {.        
-00018b80: 2020 2020 2020 2020 2763 7265 6174 696f          'creatio
-00018b90: 6e46 6374 273a 2027 6372 6561 7465 5555  nFct': 'createUU
-00018ba0: 4944 4669 6c65 2829 272c 0a20 2020 2020  IDFile()',.     
-00018bb0: 2020 2020 2020 2020 2020 2027 7375 6666             'suff
-00018bc0: 6978 273a 2027 5f69 6d61 6765 2d75 7569  ix': '_image-uui
-00018bd0: 6473 2e74 7874 272c 0a20 2020 2020 2020  ds.txt',.       
-00018be0: 2020 2020 2020 2020 2027 636f 6c73 273a           'cols':
-00018bf0: 205b 6d69 7174 762e 636f 6c5f 6865 6164   [miqtv.col_head
-00018c00: 6572 5b27 6d61 7269 7174 275d 5b27 7575  er['mariqt']['uu
-00018c10: 6964 275d 5d2c 0a20 2020 2020 2020 2020  id']],.         
-00018c20: 2020 2020 2020 2027 6f70 7469 6f6e 616c         'optional
-00018c30: 273a 205b 5d7d 2c0a 2020 2020 2020 2020  ': []},.        
-00018c40: 2020 2020 2764 6174 6574 696d 6527 3a20      'datetime': 
-00018c50: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-00018c60: 2020 2763 7265 6174 696f 6e46 6374 273a    'creationFct':
-00018c70: 2027 6372 6561 7465 5374 6172 7454 696d   'createStartTim
-00018c80: 6546 696c 6528 2927 2c0a 2020 2020 2020  eFile()',.      
-00018c90: 2020 2020 2020 2020 2020 2773 7566 6669            'suffi
-00018ca0: 7827 3a20 275f 696d 6167 652d 7374 6172  x': '_image-star
-00018cb0: 742d 7469 6d65 732e 7478 7427 2c0a 2020  t-times.txt',.  
-00018cc0: 2020 2020 2020 2020 2020 2020 2020 2763                'c
-00018cd0: 6f6c 7327 3a20 5b6d 6971 7476 2e63 6f6c  ols': [miqtv.col
-00018ce0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00018cf0: 5d5b 2775 7463 275d 5d2c 0a20 2020 2020  ]['utc']],.     
-00018d00: 2020 2020 2020 2020 2020 2027 6f70 7469             'opti
-00018d10: 6f6e 616c 273a 205b 5d7d 2c0a 2020 2020  onal': []},.    
-00018d20: 2020 2020 2020 2020 276e 6176 6967 6174          'navigat
-00018d30: 696f 6e27 3a20 7b0a 2020 2020 2020 2020  ion': {.        
-00018d40: 2020 2020 2020 2020 2763 7265 6174 696f          'creatio
-00018d50: 6e46 6374 273a 2027 6372 6561 7465 496d  nFct': 'createIm
-00018d60: 6167 654e 6176 6967 6174 696f 6e46 696c  ageNavigationFil
-00018d70: 6528 2927 2c0a 2020 2020 2020 2020 2020  e()',.          
-00018d80: 2020 2020 2020 2773 7566 6669 7827 3a20        'suffix': 
-00018d90: 275f 696d 6167 652d 6e61 7669 6761 7469  '_image-navigati
-00018da0: 6f6e 2e74 7874 272c 0a20 2020 2020 2020  on.txt',.       
-00018db0: 2020 2020 2020 2020 2027 636f 6c73 273a           'cols':
-00018dc0: 205b 6d69 7174 762e 636f 6c5f 6865 6164   [miqtv.col_head
-00018dd0: 6572 5b27 6d61 7269 7174 275d 5b27 7574  er['mariqt']['ut
-00018de0: 6327 5d5d 2c0a 2020 2020 2020 2020 2020  c']],.          
-00018df0: 2020 2020 2020 276f 7074 696f 6e61 6c27        'optional'
-00018e00: 3a20 5b6d 6971 7476 2e63 6f6c 5f68 6561  : [miqtv.col_hea
-00018e10: 6465 725b 276d 6172 6971 7427 5d5b 276c  der['mariqt']['l
-00018e20: 6f6e 275d 2c20 6d69 7174 762e 636f 6c5f  on'], miqtv.col_
-00018e30: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-00018e40: 5b27 6c61 7427 5d2c 6d69 7174 762e 636f  ['lat'],miqtv.co
-00018e50: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00018e60: 275d 5b27 6465 7027 5d2c 206d 6971 7476  ']['dep'], miqtv
-00018e70: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00018e80: 6971 7427 5d5b 2761 6c74 275d 2c20 6d69  iqt']['alt'], mi
-00018e90: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-00018ea0: 6d61 7269 7174 275d 5b27 6867 7427 5d2c  mariqt']['hgt'],
-00018eb0: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
-00018ec0: 725b 276d 6172 6971 7427 5d5b 2775 6e63  r['mariqt']['unc
-00018ed0: 6572 7427 5d5d 7d2c 0a20 2020 2020 2020  ert']]},.       
-00018ee0: 207d 0a0a 2020 2020 2020 2020 7365 6c66   }..        self
-00018ef0: 2e6e 6f6e 436f 7265 4669 656c 6449 6e74  .nonCoreFieldInt
-00018f00: 6572 6d65 6469 6174 6549 7465 6d49 6e66  ermediateItemInf
-00018f10: 6f46 696c 6573 203d 205b 5d0a 0a20 2020  oFiles = []..   
-00018f20: 2064 6566 205f 5f67 6574 5f69 6e74 5f66   def __get_int_f
-00018f30: 696c 655f 7072 6566 6978 2873 656c 6629  ile_prefix(self)
-00018f40: 3a0a 2020 2020 2020 2020 2222 2220 6465  :.        """ de
-00018f50: 7065 6e64 7320 6f6e 2027 696d 6167 652d  pends on 'image-
-00018f60: 6576 656e 7427 2061 6e64 2027 696d 6167  event' and 'imag
-00018f70: 652d 7365 6e73 6f72 2720 736f 2069 7420  e-sensor' so it 
-00018f80: 6361 6e20 6368 616e 6765 2064 7572 696e  can change durin
-00018f90: 6720 7570 6174 6520 2222 220a 2020 2020  g upate """.    
-00018fa0: 2020 2020 7265 7475 726e 206f 732e 7061      return os.pa
-00018fb0: 7468 2e6a 6f69 6e28 7365 6c66 2e64 6972  th.join(self.dir
-00018fc0: 2e74 6f28 7365 6c66 2e64 6972 2e64 742e  .to(self.dir.dt.
-00018fd0: 696e 7465 726d 6564 6961 7465 292c 2073  intermediate), s
-00018fe0: 656c 662e 6669 6e64 546d 7046 6965 6c64  elf.findTmpField
-00018ff0: 2827 696d 6167 652d 7365 742d 6e61 6d65  ('image-set-name
-00019000: 2729 290a 0a20 2020 2064 6566 2067 6574  '))..    def get
-00019010: 5f69 6e74 5f68 6173 685f 6669 6c65 2873  _int_hash_file(s
-00019020: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
-00019030: 7475 726e 2073 656c 662e 5f5f 6765 745f  turn self.__get_
-00019040: 696e 745f 6669 6c65 5f70 7265 6669 7828  int_file_prefix(
-00019050: 2920 2b20 7365 6c66 2e69 6e74 6572 6d65  ) + self.interme
-00019060: 6469 6174 6546 696c 6573 4465 665f 636f  diateFilesDef_co
-00019070: 7265 5b27 6861 7368 6573 275d 5b27 7375  re['hashes']['su
-00019080: 6666 6978 275d 0a0a 2020 2020 6465 6620  ffix']..    def 
-00019090: 6765 745f 696e 745f 7575 6964 5f66 696c  get_int_uuid_fil
-000190a0: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
-000190b0: 2072 6574 7572 6e20 7365 6c66 2e5f 5f67   return self.__g
-000190c0: 6574 5f69 6e74 5f66 696c 655f 7072 6566  et_int_file_pref
-000190d0: 6978 2829 202b 2073 656c 662e 696e 7465  ix() + self.inte
-000190e0: 726d 6564 6961 7465 4669 6c65 7344 6566  rmediateFilesDef
-000190f0: 5f63 6f72 655b 2775 7569 6473 275d 5b27  _core['uuids']['
-00019100: 7375 6666 6978 275d 0a0a 2020 2020 6465  suffix']..    de
-00019110: 6620 6765 745f 696e 745f 7374 6172 7454  f get_int_startT
-00019120: 696d 6573 5f66 696c 6528 7365 6c66 293a  imes_file(self):
-00019130: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00019140: 7365 6c66 2e5f 5f67 6574 5f69 6e74 5f66  self.__get_int_f
-00019150: 696c 655f 7072 6566 6978 2829 202b 2073  ile_prefix() + s
-00019160: 656c 662e 696e 7465 726d 6564 6961 7465  elf.intermediate
-00019170: 4669 6c65 7344 6566 5f63 6f72 655b 2764  FilesDef_core['d
-00019180: 6174 6574 696d 6527 5d5b 2773 7566 6669  atetime']['suffi
-00019190: 7827 5d0a 0a20 2020 2064 6566 2067 6574  x']..    def get
-000191a0: 5f69 6e74 5f6e 6176 5f66 696c 6528 7365  _int_nav_file(se
-000191b0: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
-000191c0: 7572 6e20 7365 6c66 2e5f 5f67 6574 5f69  urn self.__get_i
-000191d0: 6e74 5f66 696c 655f 7072 6566 6978 2829  nt_file_prefix()
-000191e0: 202b 2073 656c 662e 696e 7465 726d 6564   + self.intermed
-000191f0: 6961 7465 4669 6c65 7344 6566 5f63 6f72  iateFilesDef_cor
-00019200: 655b 276e 6176 6967 6174 696f 6e27 5d5b  e['navigation'][
-00019210: 2773 7566 6669 7827 5d0a 0a              'suffix']..
+00015800: 2020 2020 2020 2020 2020 2020 5b5b 666c              [[fl
+00015810: 6f61 7428 642e 6c6f 6e29 2c20 666c 6f61  oat(d.lon), floa
+00015820: 7428 642e 6c61 7429 5d20 666f 7220 6420  t(d.lat)] for d 
+00015830: 696e 2069 6d61 6765 5f64 7473 5b66 696c  in image_dts[fil
+00015840: 655d 5d0a 2020 2020 2020 2020 2020 2020  e]].            
+00015850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015860: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00015870: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00015880: 2054 7275 6520 696e 205b 6d61 7468 2e69   True in [math.i
+00015890: 736e 616e 2878 2920 666f 7220 7820 696e  snan(x) for x in
+000158a0: 205b 6974 656d 2066 6f72 2073 7562 6c69   [item for subli
+000158b0: 7374 2069 6e20 6765 6f6d 6574 7279 5b27  st in geometry['
+000158c0: 636f 6f72 6469 6e61 7465 7327 5d20 666f  coordinates'] fo
+000158d0: 7220 6974 656d 2069 6e20 7375 626c 6973  r item in sublis
+000158e0: 745d 5d3a 0a20 2020 2020 2020 2020 2020  t]]:.           
+000158f0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00015900: 7469 6e75 650a 0a20 2020 2020 2020 2020  tinue..         
+00015910: 2020 2020 2020 2067 656f 6a73 6f6e 5b27         geojson['
+00015920: 6665 6174 7572 6573 275d 2e61 7070 656e  features'].appen
+00015930: 6428 7b27 7479 7065 273a 2027 4665 6174  d({'type': 'Feat
+00015940: 7572 6527 2c20 2770 726f 7065 7274 6965  ure', 'propertie
+00015950: 7327 3a20 7b27 6964 273a 2066 696c 657d  s': {'id': file}
+00015960: 2c20 2767 656f 6d65 7472 7927 3a20 6765  , 'geometry': ge
+00015970: 6f6d 6574 7279 207d 290a 2020 2020 2020  ometry }).      
+00015980: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+00015990: 2020 2020 2020 206f 203d 206f 7065 6e28         o = open(
+000159a0: 7365 6c66 2e67 6574 5f69 6e74 5f6e 6176  self.get_int_nav
+000159b0: 5f66 696c 6528 292e 7265 706c 6163 6528  _file().replace(
+000159c0: 222e 7478 7422 2c20 222e 6765 6f6a 736f  ".txt", ".geojso
+000159d0: 6e22 292c 0a20 2020 2020 2020 2020 2020  n"),.           
+000159e0: 2020 2020 2020 2020 2020 2277 222c 2065            "w", e
+000159f0: 7272 6f72 733d 2269 676e 6f72 6522 2c20  rrors="ignore", 
+00015a00: 656e 636f 6469 6e67 3d27 7574 662d 3827  encoding='utf-8'
+00015a10: 290a 2020 2020 2020 2020 2020 2020 6a73  ).            js
+00015a20: 6f6e 2e64 756d 7028 6765 6f6a 736f 6e2c  on.dump(geojson,
+00015a30: 206f 2c20 656e 7375 7265 5f61 7363 6969   o, ensure_ascii
+00015a40: 3d46 616c 7365 2c20 696e 6465 6e74 3d34  =False, indent=4
+00015a50: 290a 2020 2020 2020 2020 2020 2020 6f2e  ).            o.
+00015a60: 636c 6f73 6528 290a 0a20 2020 2020 2020  close()..       
+00015a70: 2020 2020 2073 656c 662e 7072 6f76 2e61       self.prov.a
+00015a80: 6464 4172 6775 6d65 6e74 2822 696e 7075  ddArgument("inpu
+00015a90: 744e 6176 6967 6174 696f 6e46 696c 6522  tNavigationFile"
+00015aa0: 2c6e 6176 5f70 6174 682c 6f76 6572 7772  ,nav_path,overwr
+00015ab0: 6974 653d 5472 7565 290a 2020 2020 2020  ite=True).      
+00015ac0: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
+00015ad0: 6c6f 6728 2270 6172 7365 6420 6672 6f6d  log("parsed from
+00015ae0: 2069 6e70 7574 4e61 7669 6761 7469 6f6e   inputNavigation
+00015af0: 4669 6c65 3a20 2220 2b20 7374 7228 6e61  File: " + str(na
+00015b00: 765f 6865 6164 6572 292c 646f 6e74 5368  v_header),dontSh
+00015b10: 6f77 3d54 7275 6529 0a20 2020 2020 2020  ow=True).       
+00015b20: 2020 2020 2073 2e73 746f 7028 290a 2020       s.stop().  
+00015b30: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00015b40: 2054 7275 652c 2022 4e61 7669 6761 7469   True, "Navigati
+00015b50: 6f6e 2064 6174 6120 6372 6561 7465 6422  on data created"
+00015b60: 202b 2072 6574 7572 6e4d 7367 0a20 2020   + returnMsg.   
+00015b70: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00015b80: 2020 2020 2020 2073 2e73 746f 7028 290a         s.stop().
+00015b90: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00015ba0: 726e 2046 616c 7365 2c20 224e 6f20 696d  rn False, "No im
+00015bb0: 6167 6520 636f 6f72 6469 6e61 7465 7320  age coordinates 
+00015bc0: 666f 756e 6422 202b 2072 6574 7572 6e4d  found" + returnM
+00015bd0: 7367 0a0a 0a20 2020 2064 6566 2063 7265  sg...    def cre
+00015be0: 6174 6549 6d61 6765 5348 4132 3536 4669  ateImageSHA256Fi
+00015bf0: 6c65 2873 656c 662c 7265 5265 6164 416c  le(self,reReadAl
+00015c00: 6c3d 5472 7565 293a 0a20 2020 2020 2020  l=True):.       
+00015c10: 2022 2222 2043 7265 6174 6573 2069 6e20   """ Creates in 
+00015c20: 2f69 6e74 6572 6d65 6469 6174 6520 6120  /intermediate a 
+00015c30: 7465 7874 2066 696c 6520 636f 6e74 6169  text file contai
+00015c40: 6e69 6e67 2070 6572 2069 6d61 6765 2069  ning per image i
+00015c50: 7473 2053 4841 3235 3620 6861 7368 2e0a  ts SHA256 hash..
+00015c60: 2020 2020 2020 2020 2020 2020 4966 2072              If r
+00015c70: 6552 6561 6441 6c6c 2069 7320 5472 7565  eReadAll is True
+00015c80: 2061 6c6c 2069 6d61 6765 7327 2068 6173   all images' has
+00015c90: 6865 7320 6172 6520 6465 7465 726d 696e  hes are determin
+00015ca0: 6564 2e20 4f74 6865 7277 6973 6520 6f6e  ed. Otherwise on
+00015cb0: 6c79 2066 6f72 2074 686f 7365 2066 696c  ly for those fil
+00015cc0: 6573 0a20 2020 2020 2020 2020 2020 2077  es.            w
+00015cd0: 6869 6368 2061 7265 206e 6f74 2079 6574  hich are not yet
+00015ce0: 2069 6e20 7468 6520 696e 7465 726d 6564   in the intermed
+00015cf0: 6961 7465 2066 696c 6520 636f 6e74 6169  iate file contai
+00015d00: 6e69 6e67 2074 6865 2069 6d61 6765 2068  ning the image h
+00015d10: 6173 6865 7320 2022 2222 0a20 2020 2020  ashes  """.     
+00015d20: 2020 2068 6173 6865 7320 3d20 7b7d 0a20     hashes = {}. 
+00015d30: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
+00015d40: 682e 6578 6973 7473 2873 656c 662e 6765  h.exists(self.ge
+00015d50: 745f 696e 745f 6861 7368 5f66 696c 6528  t_int_hash_file(
+00015d60: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+00015d70: 6861 7368 6573 203d 206d 6971 7466 2e74  hashes = miqtf.t
+00015d80: 6162 4669 6c65 4461 7461 2873 656c 662e  abFileData(self.
+00015d90: 6765 745f 696e 745f 6861 7368 5f66 696c  get_int_hash_fil
+00015da0: 6528 292c 205b 6d69 7174 762e 636f 6c5f  e(), [miqtv.col_
+00015db0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+00015dc0: 5b27 696d 6727 5d2c 206d 6971 7476 2e63  ['img'], miqtv.c
+00015dd0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+00015de0: 7427 5d5b 2768 6173 6827 5d5d 2c20 6b65  t']['hash']], ke
+00015df0: 795f 636f 6c3d 6d69 7174 762e 636f 6c5f  y_col=miqtv.col_
+00015e00: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+00015e10: 5b27 696d 6727 5d29 0a0a 2020 2020 2020  ['img'])..      
+00015e20: 2020 696d 6167 6573 496e 5261 7720 3d20    imagesInRaw = 
+00015e30: 7365 6c66 2e69 6d61 6765 7349 6e49 6d61  self.imagesInIma
+00015e40: 6765 7344 6972 2829 0a20 2020 2020 2020  gesDir().       
+00015e50: 2069 6620 6c65 6e28 696d 6167 6573 496e   if len(imagesIn
+00015e60: 5261 7729 203e 2030 3a0a 0a20 2020 2020  Raw) > 0:..     
+00015e70: 2020 2020 2020 2061 6464 6564 5f68 6173         added_has
+00015e80: 6865 7320 3d20 300a 2020 2020 2020 2020  hes = 0.        
+00015e90: 2020 2020 7072 6f67 203d 206d 6971 7463      prog = miqtc
+00015ea0: 2e50 7269 6e74 4b6e 6f77 6e50 726f 6772  .PrintKnownProgr
+00015eb0: 6573 734d 7367 2822 4368 6563 6b69 6e67  essMsg("Checking
+00015ec0: 2068 6173 6865 7322 2c20 6c65 6e28 696d   hashes", len(im
+00015ed0: 6167 6573 496e 5261 7729 2c6d 6f64 756c  agesInRaw),modul
+00015ee0: 6f3d 3529 0a20 2020 2020 2020 2020 2020  o=5).           
+00015ef0: 2066 6f72 2066 696c 6520 696e 2069 6d61   for file in ima
+00015f00: 6765 7349 6e52 6177 3a0a 2020 2020 2020  gesInRaw:.      
+00015f10: 2020 2020 2020 2020 2020 7072 6f67 2e70            prog.p
+00015f20: 726f 6772 6573 7328 290a 0a20 2020 2020  rogress()..     
+00015f30: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00015f40: 7420 7365 6c66 2e5f 5f61 6c6c 5555 4944  t self.__allUUID
+00015f50: 7343 6865 636b 6564 2061 6e64 206e 6f74  sChecked and not
+00015f60: 206d 6971 7469 2e69 6d61 6765 436f 6e74   miqti.imageCont
+00015f70: 6169 6e73 5661 6c69 6455 5549 4428 6669  ainsValidUUID(fi
+00015f80: 6c65 295b 305d 3a0a 2020 2020 2020 2020  le)[0]:.        
+00015f90: 2020 2020 2020 2020 2020 2020 2320 7265              # re
+00015fa0: 6d6f 7665 2066 726f 6d20 7575 6964 2066  move from uuid f
+00015fb0: 696c 650a 2020 2020 2020 2020 2020 2020  ile.            
+00015fc0: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+00015fd0: 7468 2e65 7869 7374 7328 7365 6c66 2e67  th.exists(self.g
+00015fe0: 6574 5f69 6e74 5f75 7569 645f 6669 6c65  et_int_uuid_file
+00015ff0: 2829 293a 0a20 2020 2020 2020 2020 2020  ()):.           
+00016000: 2020 2020 2020 2020 2020 2020 2072 6573               res
+00016010: 203d 206f 7065 6e28 7365 6c66 2e67 6574   = open(self.get
+00016020: 5f69 6e74 5f75 7569 645f 6669 6c65 2829  _int_uuid_file()
+00016030: 2c20 2272 2229 0a20 2020 2020 2020 2020  , "r").         
+00016040: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00016050: 696e 6573 203d 2072 6573 2e72 6561 646c  ines = res.readl
+00016060: 696e 6573 2829 0a20 2020 2020 2020 2020  ines().         
+00016070: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00016080: 6573 2e63 6c6f 7365 2829 0a20 2020 2020  es.close().     
+00016090: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000160a0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000160b0: 2020 2020 2020 2020 2020 2020 206c 696e               lin
+000160c0: 6573 203d 205b 5d0a 2020 2020 2020 2020  es = [].        
+000160d0: 2020 2020 2020 2020 2020 2020 6920 3d20              i = 
+000160e0: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
+000160f0: 2020 2020 2020 6c69 6e65 4e72 203d 2069        lineNr = i
+00016100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016110: 2020 2020 2066 6f72 206c 696e 6520 696e       for line in
+00016120: 206c 696e 6573 3a0a 2020 2020 2020 2020   lines:.        
+00016130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016140: 6966 206f 732e 7061 7468 2e62 6173 656e  if os.path.basen
+00016150: 616d 6528 6669 6c65 2920 696e 206c 696e  ame(file) in lin
+00016160: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00016170: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00016180: 696e 654e 7220 3d20 690a 2020 2020 2020  ineNr = i.      
+00016190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000161a0: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+000161b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000161c0: 2020 2020 6920 2b3d 2031 0a20 2020 2020      i += 1.     
+000161d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000161e0: 6620 6c69 6e65 4e72 2021 3d20 303a 0a20  f lineNr != 0:. 
+000161f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016200: 2020 2020 2020 2064 656c 206c 696e 6573         del lines
+00016210: 5b6c 696e 654e 725d 0a20 2020 2020 2020  [lineNr].       
+00016220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016230: 2072 6573 203d 206f 7065 6e28 7365 6c66   res = open(self
+00016240: 2e67 6574 5f69 6e74 5f75 7569 645f 6669  .get_int_uuid_fi
+00016250: 6c65 2829 2c20 2277 2229 0a20 2020 2020  le(), "w").     
+00016260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016270: 2020 2072 6573 2e77 7269 7465 6c69 6e65     res.writeline
+00016280: 7328 6c69 6e65 7329 0a20 2020 2020 2020  s(lines).       
+00016290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000162a0: 2072 6573 2e63 6c6f 7365 2829 0a20 2020   res.close().   
+000162b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000162c0: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
+000162d0: 2820 2246 696c 6520 2220 2b20 6669 6c65  ( "File " + file
+000162e0: 202b 2022 2064 6f65 7320 6e6f 7420 636f   + " does not co
+000162f0: 7461 696e 2061 2076 616c 6964 2055 5549  tain a valid UUI
+00016300: 442e 2052 756e 2063 7265 6174 6555 5549  D. Run createUUI
+00016310: 4446 696c 6528 2920 6669 7273 7421 2229  DFile() first!")
+00016320: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00016330: 2020 6669 6c65 5f6e 616d 6520 3d20 6f73    file_name = os
+00016340: 2e70 6174 682e 6261 7365 6e61 6d65 2866  .path.basename(f
+00016350: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
+00016360: 2020 2020 2069 6620 6e6f 7420 7265 5265       if not reRe
+00016370: 6164 416c 6c20 616e 6420 6669 6c65 5f6e  adAll and file_n
+00016380: 616d 6520 696e 2068 6173 6865 733a 0a20  ame in hashes:. 
+00016390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000163a0: 2020 2068 6173 6865 735b 6669 6c65 5f6e     hashes[file_n
+000163b0: 616d 655d 203d 2068 6173 6865 735b 6669  ame] = hashes[fi
+000163c0: 6c65 5f6e 616d 655d 5b6d 6971 7476 2e63  le_name][miqtv.c
+000163d0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+000163e0: 7427 5d5b 2768 6173 6827 5d5d 0a20 2020  t']['hash']].   
+000163f0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00016400: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00016410: 2020 2020 2020 2068 6173 6865 735b 6669         hashes[fi
+00016420: 6c65 5f6e 616d 655d 203d 206d 6971 7463  le_name] = miqtc
+00016430: 2e73 6861 3235 3648 6173 6846 696c 6528  .sha256HashFile(
+00016440: 6669 6c65 290a 2020 2020 2020 2020 2020  file).          
+00016450: 2020 2020 2020 2020 2020 6164 6465 645f            added_
+00016460: 6861 7368 6573 202b 3d20 310a 2020 2020  hashes += 1.    
+00016470: 2020 2020 2020 2020 7072 6f67 2e63 6c65          prog.cle
+00016480: 6172 2829 0a0a 2020 2020 2020 2020 2020  ar()..          
+00016490: 2020 6966 2072 6552 6561 6441 6c6c 206f    if reReadAll o
+000164a0: 7220 6164 6465 645f 6861 7368 6573 203e  r added_hashes >
+000164b0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+000164c0: 2020 2020 6861 7368 5f66 696c 6520 3d20      hash_file = 
+000164d0: 6f70 656e 2873 656c 662e 6765 745f 696e  open(self.get_in
+000164e0: 745f 6861 7368 5f66 696c 6528 292c 2022  t_hash_file(), "
+000164f0: 7722 290a 2020 2020 2020 2020 2020 2020  w").            
+00016500: 2020 2020 6861 7368 5f66 696c 652e 7772      hash_file.wr
+00016510: 6974 6528 206d 6971 7476 2e63 6f6c 5f68  ite( miqtv.col_h
+00016520: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00016530: 2769 6d67 275d 2b22 5c74 222b 6d69 7174  'img']+"\t"+miqt
+00016540: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+00016550: 7269 7174 275d 5b27 6861 7368 275d 2b22  riqt']['hash']+"
+00016560: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
+00016570: 2020 2020 2066 6f72 2066 696c 655f 6e61       for file_na
+00016580: 6d65 2069 6e20 6861 7368 6573 3a0a 2020  me in hashes:.  
+00016590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000165a0: 2020 6861 7368 5f66 696c 652e 7772 6974    hash_file.writ
+000165b0: 6528 6669 6c65 5f6e 616d 652b 225c 7422  e(file_name+"\t"
+000165c0: 2b68 6173 6865 735b 6669 6c65 5f6e 616d  +hashes[file_nam
+000165d0: 655d 2b22 5c6e 2229 0a0a 2020 2020 2020  e]+"\n")..      
+000165e0: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
+000165f0: 696c 652e 636c 6f73 6528 290a 2020 2020  ile.close().    
+00016600: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00016610: 726e 2054 7275 652c 2022 4164 6465 6420  rn True, "Added 
+00016620: 222b 7374 7228 6164 6465 645f 6861 7368  "+str(added_hash
+00016630: 6573 292b 2220 6861 7368 6573 2074 6f20  es)+" hashes to 
+00016640: 6861 7368 2066 696c 6522 0a20 2020 2020  hash file".     
+00016650: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00016660: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00016670: 7572 6e20 5472 7565 2c20 2241 6c6c 2068  urn True, "All h
+00016680: 6173 6865 7320 6578 6973 7422 0a0a 2020  ashes exist"..  
+00016690: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000166a0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+000166b0: 616c 7365 2c20 224e 6f20 696d 6167 6573  alse, "No images
+000166c0: 2066 6f75 6e64 2074 6f20 6861 7368 220a   found to hash".
+000166d0: 0a0a 2020 2020 6465 6620 6372 6561 7465  ..    def create
+000166e0: 5374 6172 7454 696d 6546 696c 6528 7365  StartTimeFile(se
+000166f0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+00016700: 2043 7265 6174 6573 2069 6e20 2f69 6e74   Creates in /int
+00016710: 6572 6d65 6469 6174 6520 6120 7465 7874  ermediate a text
+00016720: 2066 696c 6520 636f 6e74 6169 6e69 6e67   file containing
+00016730: 2070 6572 2069 6d61 6765 2069 7473 2073   per image its s
+00016740: 7461 7274 2074 696d 6520 7061 7273 6564  tart time parsed
+00016750: 2066 726f 6d20 7468 6520 6669 6c65 206e   from the file n
+00016760: 616d 6520 2222 220a 0a20 2020 2020 2020  ame """..       
+00016770: 2073 203d 206d 6971 7463 2e50 7269 6e74   s = miqtc.Print
+00016780: 4c6f 6164 696e 674d 7367 2822 4372 6561  LoadingMsg("Crea
+00016790: 7469 6e67 2069 6e74 6572 6d65 6469 6174  ting intermediat
+000167a0: 6520 7374 6172 7474 696d 6520 6669 6c65  e starttime file
+000167b0: 2022 290a 2020 2020 2020 2020 696d 6167   ").        imag
+000167c0: 6573 496e 5261 7720 3d20 7365 6c66 2e69  esInRaw = self.i
+000167d0: 6d61 6765 7349 6e49 6d61 6765 7344 6972  magesInImagesDir
+000167e0: 536f 7274 6564 4c69 7374 2829 0a20 2020  SortedList().   
+000167f0: 2020 2020 2069 6620 6c65 6e28 696d 6167       if len(imag
+00016800: 6573 496e 5261 7729 203e 2030 3a0a 0a20  esInRaw) > 0:.. 
+00016810: 2020 2020 2020 2020 2020 206f 203d 206f             o = o
+00016820: 7065 6e28 7365 6c66 2e67 6574 5f69 6e74  pen(self.get_int
+00016830: 5f73 7461 7274 5469 6d65 735f 6669 6c65  _startTimes_file
+00016840: 2829 2c20 2277 2229 0a20 2020 2020 2020  (), "w").       
+00016850: 2020 2020 206f 2e77 7269 7465 286d 6971       o.write(miq
+00016860: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+00016870: 6172 6971 7427 5d5b 2769 6d67 275d 202b  ariqt']['img'] +
+00016880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016890: 2020 2020 2022 5c74 222b 6d69 7174 762e       "\t"+miqtv.
+000168a0: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+000168b0: 7174 275d 5b27 7574 6327 5d2b 225c 6e22  qt']['utc']+"\n"
+000168c0: 290a 0a20 2020 2020 2020 2020 2020 2066  )..            f
+000168d0: 6f72 2066 696c 6520 696e 2069 6d61 6765  or file in image
+000168e0: 7349 6e52 6177 3a0a 2020 2020 2020 2020  sInRaw:.        
+000168f0: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
+00016900: 6520 3d20 6f73 2e70 6174 682e 6261 7365  e = os.path.base
+00016910: 6e61 6d65 2866 696c 6529 0a0a 2020 2020  name(file)..    
+00016920: 2020 2020 2020 2020 2020 2020 6474 203d              dt =
+00016930: 206d 6971 7463 2e70 6172 7365 4669 6c65   miqtc.parseFile
+00016940: 4461 7465 5469 6d65 4173 5554 4328 6669  DateTimeAsUTC(fi
+00016950: 6c65 5f6e 616d 6529 0a20 2020 2020 2020  le_name).       
+00016960: 2020 2020 2020 2020 206f 2e77 7269 7465           o.write
+00016970: 2866 696c 655f 6e61 6d65 2b22 5c74 2220  (file_name+"\t" 
+00016980: 2b20 6474 2e73 7472 6674 696d 6528 6d69  + dt.strftime(mi
+00016990: 7174 762e 6461 7465 5f66 6f72 6d61 7473  qtv.date_formats
+000169a0: 5b27 6d61 7269 7174 275d 292b 225c 6e22  ['mariqt'])+"\n"
+000169b0: 290a 0a20 2020 2020 2020 2020 2020 206f  )..            o
+000169c0: 2e63 6c6f 7365 2829 0a20 2020 2020 2020  .close().       
+000169d0: 2020 2020 2073 2e73 746f 7028 290a 2020       s.stop().  
+000169e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000169f0: 2054 7275 652c 2022 4372 6561 7465 6420   True, "Created 
+00016a00: 7374 6172 7420 7469 6d65 2066 696c 6522  start time file"
+00016a10: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00016a20: 2020 2020 2020 2020 2020 2073 2e73 746f             s.sto
+00016a30: 7028 290a 2020 2020 2020 2020 2020 2020  p().            
+00016a40: 7265 7475 726e 2046 616c 7365 2c20 224e  return False, "N
+00016a50: 6f20 696d 6167 6573 2066 6f75 6e64 2074  o images found t
+00016a60: 6f20 7265 6164 2073 7461 7274 2074 696d  o read start tim
+00016a70: 6573 220a 0a0a 2020 2020 6465 6620 6372  es"...    def cr
+00016a80: 6561 7465 4163 7175 6973 6974 696f 6e53  eateAcquisitionS
+00016a90: 6574 7469 6e67 7345 5849 4646 696c 6528  ettingsEXIFFile(
+00016aa0: 7365 6c66 2c6f 7665 7272 6964 653d 4661  self,override=Fa
+00016ab0: 6c73 6529 3a0a 2020 2020 2020 2020 2222  lse):.        ""
+00016ac0: 2220 4372 6561 7465 7320 696e 202f 696e  " Creates in /in
+00016ad0: 7465 726d 6564 6961 7465 2061 2074 6578  termediate a tex
+00016ae0: 7420 6669 6c65 2063 6f6e 7461 696e 696e  t file containin
+00016af0: 6720 7065 7220 696d 6167 6520 6120 6469  g per image a di
+00016b00: 6374 206f 6620 6578 6966 2074 6167 7320  ct of exif tags 
+00016b10: 616e 6420 7468 6569 7220 7661 6c75 6573  and their values
+00016b20: 2070 6172 7365 6420 6672 6f6d 2074 6865   parsed from the
+00016b30: 2069 6d61 6765 2022 2222 0a0a 2020 2020   image """..    
+00016b40: 2020 2020 696e 745f 6163 7175 6973 6974      int_acquisit
+00016b50: 696f 6e53 6574 7469 6e67 5f66 696c 6520  ionSetting_file 
+00016b60: 3d20 7365 6c66 2e5f 5f67 6574 5f69 6e74  = self.__get_int
+00016b70: 5f66 696c 655f 7072 6566 6978 2829 202b  _file_prefix() +
+00016b80: 2027 5f69 6d61 6765 2d61 6371 7569 7369   '_image-acquisi
+00016b90: 7469 6f6e 2d73 6574 7469 6e67 732e 7478  tion-settings.tx
+00016ba0: 7427 0a20 2020 2020 2020 2068 6561 6465  t'.        heade
+00016bb0: 7220 3d20 7b20 206d 6971 7476 2e63 6f6c  r = {  miqtv.col
+00016bc0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00016bd0: 5d5b 2769 6d67 275d 3a20 206d 6971 7476  ]['img']:  miqtv
+00016be0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+00016bf0: 6971 7427 5d5b 2769 6d67 275d 2c0a 2020  iqt']['img'],.  
+00016c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c10: 2020 6d69 7174 762e 636f 6c5f 6865 6164    miqtv.col_head
+00016c20: 6572 5b27 6d61 7269 7174 275d 5b27 6163  er['mariqt']['ac
+00016c30: 7175 6927 5d3a 6d69 7174 762e 636f 6c5f  qui']:miqtv.col_
+00016c40: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+00016c50: 5b27 6163 7175 6927 5d7d 0a20 2020 2020  ['acqui']}.     
+00016c60: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
+00016c70: 6973 7473 2869 6e74 5f61 6371 7569 7369  ists(int_acquisi
+00016c80: 7469 6f6e 5365 7474 696e 675f 6669 6c65  tionSetting_file
+00016c90: 2920 616e 6420 6e6f 7420 6f76 6572 7269  ) and not overri
+00016ca0: 6465 3a0a 2020 2020 2020 2020 2020 2020  de:.            
+00016cb0: 7365 6c66 2e61 6464 4974 656d 496e 666f  self.addItemInfo
+00016cc0: 5461 6246 696c 6528 696e 745f 6163 7175  TabFile(int_acqu
+00016cd0: 6973 6974 696f 6e53 6574 7469 6e67 5f66  isitionSetting_f
+00016ce0: 696c 652c 225c 7422 2c68 6561 6465 7229  ile,"\t",header)
+00016cf0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00016d00: 7572 6e20 5472 7565 2c20 2252 6573 756c  urn True, "Resul
+00016d10: 7420 6669 6c65 2065 7869 7374 7322 0a0a  t file exists"..
+00016d20: 2020 2020 2020 2020 696d 6167 6573 496e          imagesIn
+00016d30: 5261 7720 3d20 7365 6c66 2e69 6d61 6765  Raw = self.image
+00016d40: 7349 6e49 6d61 6765 7344 6972 536f 7274  sInImagesDirSort
+00016d50: 6564 4c69 7374 2829 0a20 2020 2020 2020  edList().       
+00016d60: 2069 6620 6c65 6e28 696d 6167 6573 496e   if len(imagesIn
+00016d70: 5261 7729 203e 2030 3a0a 0a20 2020 2020  Raw) > 0:..     
+00016d80: 2020 2020 2020 206f 203d 206f 7065 6e28         o = open(
+00016d90: 696e 745f 6163 7175 6973 6974 696f 6e53  int_acquisitionS
+00016da0: 6574 7469 6e67 5f66 696c 652c 2022 7722  etting_file, "w"
+00016db0: 290a 2020 2020 2020 2020 2020 2020 6f2e  ).            o.
+00016dc0: 7772 6974 6528 6d69 7174 762e 636f 6c5f  write(miqtv.col_
+00016dd0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+00016de0: 5b27 696d 6727 5d20 2b20 225c 7422 2b6d  ['img'] + "\t"+m
+00016df0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+00016e00: 276d 6172 6971 7427 5d5b 2761 6371 7569  'mariqt']['acqui
+00016e10: 275d 2b22 5c6e 2229 0a20 0a20 2020 2020  ']+"\n"). .     
+00016e20: 2020 2020 2020 2069 6d61 6765 7345 7869         imagesExi
+00016e30: 6673 203d 206d 6971 7469 2e67 6574 496d  fs = miqti.getIm
+00016e40: 6167 6573 416c 6c45 7869 6656 616c 7565  agesAllExifValue
+00016e50: 7328 696d 6167 6573 496e 5261 772c 7365  s(imagesInRaw,se
+00016e60: 6c66 2e70 726f 7629 0a20 2020 2020 2020  lf.prov).       
+00016e70: 2020 2020 2066 6f72 2066 696c 6520 696e       for file in
+00016e80: 2069 6d61 6765 7345 7869 6673 3a0a 2020   imagesExifs:.  
+00016e90: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00016ea0: 6c65 5f6e 616d 6520 3d20 6f73 2e70 6174  le_name = os.pat
+00016eb0: 682e 6261 7365 6e61 6d65 2866 696c 6529  h.basename(file)
+00016ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016ed0: 206f 2e77 7269 7465 2866 696c 655f 6e61   o.write(file_na
+00016ee0: 6d65 2b22 5c74 222b 7374 7228 696d 6167  me+"\t"+str(imag
+00016ef0: 6573 4578 6966 735b 6669 6c65 5d29 2b22  esExifs[file])+"
+00016f00: 5c6e 2229 0a0a 2020 2020 2020 2020 2020  \n")..          
+00016f10: 2020 6f2e 636c 6f73 6528 290a 0a20 2020    o.close()..   
+00016f20: 2020 2020 2020 2020 2073 656c 662e 6164           self.ad
+00016f30: 6449 7465 6d49 6e66 6f54 6162 4669 6c65  dItemInfoTabFile
+00016f40: 2869 6e74 5f61 6371 7569 7369 7469 6f6e  (int_acquisition
+00016f50: 5365 7474 696e 675f 6669 6c65 2c22 5c74  Setting_file,"\t
+00016f60: 222c 6865 6164 6572 290a 2020 2020 2020  ",header).      
+00016f70: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+00016f80: 652c 2022 4372 6561 7465 6420 6163 7175  e, "Created acqu
+00016f90: 6973 6974 696f 6e20 7365 7474 696e 6773  isition settings
+00016fa0: 2066 696c 6522 0a20 2020 2020 2020 2065   file".        e
+00016fb0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00016fc0: 2072 6574 7572 6e20 4661 6c73 652c 2022   return False, "
+00016fd0: 4e6f 2069 6d61 6765 7320 666f 756e 6422  No images found"
+00016fe0: 0a0a 0a20 2020 2064 6566 2069 6d61 6765  ...    def image
+00016ff0: 7349 6e49 6d61 6765 7344 6972 2873 656c  sInImagesDir(sel
+00017000: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+00017010: 726e 2063 6f70 792e 6465 6570 636f 7079  rn copy.deepcopy
+00017020: 2873 656c 662e 5f69 6d61 6765 7349 6e49  (self._imagesInI
+00017030: 6d61 6765 7344 6972 290a 0a20 2020 2064  magesDir)..    d
+00017040: 6566 2069 6d61 6765 7349 6e49 6d61 6765  ef imagesInImage
+00017050: 7344 6972 536f 7274 6564 4c69 7374 2873  sDirSortedList(s
+00017060: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
+00017070: 7475 726e 2063 6f70 792e 6465 6570 636f  turn copy.deepco
+00017080: 7079 2873 656c 662e 5f69 6d61 6765 7349  py(self._imagesI
+00017090: 6e49 6d61 6765 7344 6972 536f 7274 6564  nImagesDirSorted
+000170a0: 4c69 7374 290a 0a0a 2020 2020 6465 6620  List)...    def 
+000170b0: 7061 7273 6549 7465 6d44 6174 6166 726f  parseItemDatafro
+000170c0: 6d54 6162 4669 6c65 4461 7461 2873 656c  mTabFileData(sel
+000170d0: 662c 2069 7465 6d73 3a20 6469 6374 2c20  f, items: dict, 
+000170e0: 6669 6c65 3a20 7374 722c 2063 6f6c 733a  file: str, cols:
+000170f0: 206c 6973 742c 206f 7074 696f 6e61 6c3a   list, optional:
+00017100: 206c 6973 7420 3d20 5b5d 293a 0a20 2020   list = []):.   
+00017110: 2020 2020 2022 2222 2070 6172 7365 7320       """ parses 
+00017120: 6461 7461 2066 726f 6d20 636f 6c75 6d6e  data from column
+00017130: 7320 696e 2063 6f6c 7320 616e 6420 7772  s in cols and wr
+00017140: 6974 6573 2069 6e66 6f20 746f 2069 7465  ites info to ite
+00017150: 6d73 2e20 436f 6c75 6d6e 2027 696d 6167  ms. Column 'imag
+00017160: 652d 6669 6c65 6e61 6d65 2720 6d75 7374  e-filename' must
+00017170: 2062 6520 696e 2066 696c 6520 616e 6420   be in file and 
+00017180: 646f 6573 206e 6f74 206e 6565 6420 746f  does not need to
+00017190: 2062 6520 7061 7373 6564 2069 6e20 636f   be passed in co
+000171a0: 6c73 2e20 0a20 2020 2020 2020 2020 2020  ls. .           
+000171b0: 2046 696c 6520 6d75 7374 2062 6520 7461   File must be ta
+000171c0: 6220 7365 7061 7261 7465 6420 616e 6420  b separated and 
+000171d0: 636f 6c75 6d6e 7320 6e61 6d65 7320 6d75  columns names mu
+000171e0: 7374 2065 7175 616c 2069 7465 6d20 6669  st equal item fi
+000171f0: 656c 6420 6e61 6d65 7322 2222 0a20 2020  eld names""".   
+00017200: 2020 2020 2074 6d70 5f64 6174 6120 3d20       tmp_data = 
+00017210: 6d69 7174 662e 7461 6246 696c 6544 6174  miqtf.tabFileDat
+00017220: 6128 6669 6c65 2c20 636f 6c73 2b5b 2769  a(file, cols+['i
+00017230: 6d61 6765 2d66 696c 656e 616d 6527 5d2b  mage-filename']+
+00017240: 6f70 7469 6f6e 616c 2c20 6b65 795f 636f  optional, key_co
+00017250: 6c3d 2769 6d61 6765 2d66 696c 656e 616d  l='image-filenam
+00017260: 6527 2c20 6f70 7469 6f6e 616c 3d6f 7074  e', optional=opt
+00017270: 696f 6e61 6c2c 636f 6e76 6572 743d 5472  ional,convert=Tr
+00017280: 7565 290a 2020 2020 2020 2020 7365 6c66  ue).        self
+00017290: 2e77 7269 7465 5061 7273 6564 4461 7461  .writeParsedData
+000172a0: 546f 4974 656d 7328 746d 705f 6461 7461  ToItems(tmp_data
+000172b0: 2c69 7465 6d73 2c73 656c 662e 6966 646f  ,items,self.ifdo
+000172c0: 5f74 6d70 5b6d 6971 7476 2e69 6d61 6765  _tmp[miqtv.image
+000172d0: 5f73 6574 5f68 6561 6465 725f 6b65 795d  _set_header_key]
+000172e0: 290a 0a0a 2020 2020 6465 6620 7072 6173  )...    def pras
+000172f0: 6549 7465 6d44 6174 6146 726f 6d46 696c  eItemDataFromFil
+00017300: 6528 7365 6c66 2c69 7465 6d73 3a64 6963  e(self,items:dic
+00017310: 742c 6669 6c65 3a73 7472 2c73 6570 6172  t,file:str,separ
+00017320: 6174 6f72 3a73 7472 2c68 6561 6465 723a  ator:str,header:
+00017330: 6469 6374 293a 0a20 2020 2020 2020 2022  dict):.        "
+00017340: 2222 2070 6172 7365 7320 6461 7461 2066  "" parses data f
+00017350: 726f 6d20 6672 6f6d 2066 696c 6520 746f  rom from file to
+00017360: 2069 7465 6d73 2e20 6865 6164 6572 2064   items. header d
+00017370: 6963 7420 6d75 7374 2062 6520 6f66 2073  ict must be of s
+00017380: 7472 7563 7475 7265 3a20 7b3c 6974 656d  tructure: {<item
+00017390: 2d66 6965 6c64 2d6e 616d 653e 3a3c 636f  -field-name>:<co
+000173a0: 6c75 6d6e 2d6e 616d 653e 7d0a 2020 2020  lumn-name>}.    
+000173b0: 2020 2020 2020 2020 616e 6420 6d75 7374          and must
+000173c0: 2063 6f6e 7461 696e 2065 6e74 7279 2027   contain entry '
+000173d0: 696d 6167 652d 6669 6c65 6e61 6d65 2720  image-filename' 
+000173e0: 2222 220a 2020 2020 2020 2020 6966 206e  """.        if n
+000173f0: 6f74 2027 696d 6167 652d 6669 6c65 6e61  ot 'image-filena
+00017400: 6d65 2720 696e 2068 6561 6465 723a 0a20  me' in header:. 
+00017410: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00017420: 2045 7863 6570 7469 6f6e 2822 6865 6164   Exception("head
+00017430: 6572 2064 6f65 7320 6e6f 7420 636f 6e74  er does not cont
+00017440: 6169 6e20 2769 6d61 6765 2d66 696c 656e  ain 'image-filen
+00017450: 616d 6527 2229 0a20 2020 2020 2020 200a  ame'").        .
+00017460: 2020 2020 2020 2020 746d 705f 6461 7461          tmp_data
+00017470: 203d 206d 6971 7466 2e74 6162 4669 6c65   = miqtf.tabFile
+00017480: 4461 7461 2866 696c 652c 2068 6561 6465  Data(file, heade
+00017490: 722c 636f 6c5f 7365 7061 7261 746f 723d  r,col_separator=
+000174a0: 7365 7061 7261 746f 722c 206b 6579 5f63  separator, key_c
+000174b0: 6f6c 3d27 696d 6167 652d 6669 6c65 6e61  ol='image-filena
+000174c0: 6d65 272c 636f 6e76 6572 743d 5472 7565  me',convert=True
+000174d0: 290a 2020 2020 2020 2020 7365 6c66 2e77  ).        self.w
+000174e0: 7269 7465 5061 7273 6564 4461 7461 546f  riteParsedDataTo
+000174f0: 4974 656d 7328 746d 705f 6461 7461 2c69  Items(tmp_data,i
+00017500: 7465 6d73 2c73 656c 662e 6966 646f 5f74  tems,self.ifdo_t
+00017510: 6d70 5b6d 6971 7476 2e69 6d61 6765 5f73  mp[miqtv.image_s
+00017520: 6574 5f68 6561 6465 725f 6b65 795d 290a  et_header_key]).
+00017530: 0a0a 2020 2020 6465 6620 7772 6974 6550  ..    def writeP
+00017540: 6172 7365 6444 6174 6154 6f49 7465 6d73  arsedDataToItems
+00017550: 2873 656c 662c 6461 7461 3a64 6963 742c  (self,data:dict,
+00017560: 6974 656d 733a 6469 6374 2c68 6561 6465  items:dict,heade
+00017570: 723a 6469 6374 293a 0a0a 2020 2020 2020  r:dict):..      
+00017580: 2020 2320 6576 616c 2073 7472 696e 6773    # eval strings
+00017590: 2061 7320 6469 6374 206f 7220 6c69 7374   as dict or list
+000175a0: 0a20 2020 2020 2020 206d 6971 7463 2e72  .        miqtc.r
+000175b0: 6563 7572 7369 7665 4576 616c 2864 6174  ecursiveEval(dat
+000175c0: 6129 0a0a 2020 2020 2020 2020 2320 706f  a)..        # po
+000175d0: 7465 6e74 6169 6c6c 7920 7265 6d6f 7665  tentailly remove
+000175e0: 2063 6f6e 7374 2064 6174 6120 6672 6f6d   const data from
+000175f0: 2069 7465 6d73 2061 6e64 2070 7574 2069   items and put i
+00017600: 6e20 6865 6164 6572 0a20 2020 2020 2020  n header.       
+00017610: 2073 656c 662e 6578 7472 6163 7443 6f6e   self.extractCon
+00017620: 7374 4461 7461 5661 6c75 6573 2864 6174  stDataValues(dat
+00017630: 612c 6865 6164 6572 290a 0a20 2020 2020  a,header)..     
+00017640: 2020 2064 6174 6120 3d20 6d69 7174 632e     data = miqtc.
+00017650: 7265 6375 7273 6976 656c 7952 656d 6f76  recursivelyRemov
+00017660: 6545 6d70 7479 4669 656c 6473 2864 6174  eEmptyFields(dat
+00017670: 612c 636f 6e74 656e 7432 6265 5265 6d6f  a,content2beRemo
+00017680: 7665 643d 4e6f 6e65 290a 0a20 2020 2020  ved=None)..     
+00017690: 2020 2023 2061 6464 2027 696d 6167 652d     # add 'image-
+000176a0: 6669 6c65 6e61 6d65 2720 6669 656c 640a  filename' field.
+000176b0: 2020 2020 2020 2020 666f 7220 696d 672c          for img,
+000176c0: 2065 6e74 7279 2069 6e20 6461 7461 2e69   entry in data.i
+000176d0: 7465 6d73 2829 3a0a 0a20 2020 2020 2020  tems():..       
+000176e0: 2020 2020 2023 206c 6973 740a 2020 2020       # list.    
+000176f0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00017700: 7461 6e63 6528 656e 7472 792c 6c69 7374  tance(entry,list
+00017710: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00017720: 2020 2066 6f72 206c 6973 7449 7465 6d20     for listItem 
+00017730: 696e 2065 6e74 7279 3a0a 2020 2020 2020  in entry:.      
+00017740: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+00017750: 7374 4974 656d 5b27 696d 6167 652d 6669  stItem['image-fi
+00017760: 6c65 6e61 6d65 275d 203d 2069 6d67 0a20  lename'] = img. 
+00017770: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00017780: 6973 696e 7374 616e 6365 2865 6e74 7279  isinstance(entry
+00017790: 2c64 6963 7429 3a0a 2020 2020 2020 2020  ,dict):.        
+000177a0: 2020 2020 2020 2020 656e 7472 795b 2769          entry['i
+000177b0: 6d61 6765 2d66 696c 656e 616d 6527 5d20  mage-filename'] 
+000177c0: 3d20 696d 670a 2020 2020 2020 2020 2020  = img.          
+000177d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000177e0: 2020 2020 2020 2020 7261 6973 6520 6d69          raise mi
+000177f0: 7174 632e 4966 646f 4578 6365 7074 696f  qtc.IfdoExceptio
+00017800: 6e28 2264 6174 6120 656e 7472 6965 7320  n("data entries 
+00017810: 6d75 7374 2062 6520 6469 6374 206f 7220  must be dict or 
+00017820: 6c69 7374 2069 6620 6469 6374 7322 290a  list if dicts").
+00017830: 0a20 2020 2020 2020 206d 6971 7463 2e72  .        miqtc.r
+00017840: 6563 7572 7369 7665 6c79 5570 6461 7465  ecursivelyUpdate
+00017850: 4469 6374 7328 6974 656d 732c 6461 7461  Dicts(items,data
+00017860: 290a 0a0a 2020 2020 4073 7461 7469 636d  )...    @staticm
+00017870: 6574 686f 640a 2020 2020 6465 6620 6578  ethod.    def ex
+00017880: 7472 6163 7443 6f6e 7374 4461 7461 5661  tractConstDataVa
+00017890: 6c75 6573 2864 6174 613a 6469 6374 2c68  lues(data:dict,h
+000178a0: 6561 6465 723a 6469 6374 293a 0a20 2020  eader:dict):.   
+000178b0: 2020 2020 2022 2222 2052 656d 6f76 6573       """ Removes
+000178c0: 2066 6965 6c64 7320 7468 6174 2061 7265   fields that are
+000178d0: 2063 6f6e 7374 616e 7420 666f 7220 616c   constant for al
+000178e0: 6c20 656e 7472 6965 7320 6672 6f6d 2064  l entries from d
+000178f0: 6174 6120 6469 6374 2061 6e64 2070 7574  ata dict and put
+00017900: 2074 6865 6d20 696e 2068 6561 6465 7220   them in header 
+00017910: 6469 6374 2e20 0a20 2020 2020 2020 2020  dict. .         
+00017920: 2020 2045 6163 6820 656e 7472 7920 6f66     Each entry of
+00017930: 2064 6174 6120 6d75 7374 2062 6520 6120   data must be a 
+00017940: 6469 6374 2077 6974 6820 7468 6520 7361  dict with the sa
+00017950: 6d65 2073 6574 206f 6620 6b65 7973 2e20  me set of keys. 
+00017960: 2222 220a 2020 2020 0a20 2020 2020 2020  """.    .       
+00017970: 2066 6965 6c64 7354 6f49 676e 6f72 6520   fieldsToIgnore 
+00017980: 3d20 5b27 696d 6167 652d 6461 7465 7469  = ['image-dateti
+00017990: 6d65 275d 0a20 2020 2020 2020 2063 6f6e  me'].        con
+000179a0: 7374 4461 7461 203d 207b 7d0a 2020 2020  stData = {}.    
+000179b0: 2020 2020 6669 7273 7449 6d61 6765 203d      firstImage =
+000179c0: 2054 7275 650a 2020 2020 2020 2020 666f   True.        fo
+000179d0: 7220 696d 6167 652c 696d 6167 655f 6461  r image,image_da
+000179e0: 7461 2069 6e20 6461 7461 2e69 7465 6d73  ta in data.items
+000179f0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00017a00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00017a10: 6e6f 7420 6973 696e 7374 616e 6365 2869  not isinstance(i
+00017a20: 6d61 6765 5f64 6174 612c 6c69 7374 293a  mage_data,list):
+00017a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017a40: 2069 6d61 6765 5f64 6174 6120 3d20 5b69   image_data = [i
+00017a50: 6d61 6765 5f64 6174 615d 0a0a 2020 2020  mage_data]..    
+00017a60: 2020 2020 2020 2020 6966 206e 6f74 2066          if not f
+00017a70: 6972 7374 496d 6167 6520 616e 6420 636f  irstImage and co
+00017a80: 6e73 7444 6174 6120 3d3d 207b 7d3a 0a20  nstData == {}:. 
+00017a90: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00017aa0: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
+00017ab0: 200a 2020 2020 2020 2020 2020 2020 6669   .            fi
+00017ac0: 7273 7454 696d 6550 6f69 6e74 203d 2054  rstTimePoint = T
+00017ad0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+00017ae0: 666f 7220 696d 6167 655f 7470 5f64 6174  for image_tp_dat
+00017af0: 6120 696e 2069 6d61 6765 5f64 6174 613a  a in image_data:
+00017b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017b10: 2023 2076 6572 7920 6669 7273 7420 6461   # very first da
+00017b20: 7461 2066 6f72 2063 6f6d 7061 7269 736f  ta for compariso
+00017b30: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+00017b40: 2020 6966 2066 6972 7374 496d 6167 6520    if firstImage 
+00017b50: 616e 6420 6669 7273 7454 696d 6550 6f69  and firstTimePoi
+00017b60: 6e74 3a0a 2020 2020 2020 2020 2020 2020  nt:.            
+00017b70: 2020 2020 2020 2020 636f 6e73 7444 6174          constDat
+00017b80: 6120 3d20 636f 7079 2e64 6565 7063 6f70  a = copy.deepcop
+00017b90: 7928 696d 6167 655f 7470 5f64 6174 6129  y(image_tp_data)
+00017ba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017bb0: 2020 2020 2066 6f72 2066 6965 6c64 2069       for field i
+00017bc0: 6e20 6669 656c 6473 546f 4967 6e6f 7265  n fieldsToIgnore
+00017bd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00017be0: 2020 2020 2020 2020 2020 6966 2066 6965            if fie
+00017bf0: 6c64 2069 6e20 636f 6e73 7444 6174 613a  ld in constData:
+00017c00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017c10: 2020 2020 2020 2020 2020 2020 2064 656c               del
+00017c20: 2063 6f6e 7374 4461 7461 5b66 6965 6c64   constData[field
+00017c30: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00017c40: 2020 2020 2020 6669 7273 7454 696d 6550        firstTimeP
+00017c50: 6f69 6e74 203d 2046 616c 7365 0a20 2020  oint = False.   
+00017c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c70: 2063 6f6e 7469 6e75 650a 0a20 2020 2020   continue..     
+00017c80: 2020 2020 2020 2020 2020 2063 6f6e 7374             const
+00017c90: 4461 7461 203d 206d 6971 7463 2e66 696e  Data = miqtc.fin
+00017ca0: 6443 6f6d 6d6f 6e44 6963 7445 6c65 6d65  dCommonDictEleme
+00017cb0: 6e74 7328 696d 6167 655f 7470 5f64 6174  nts(image_tp_dat
+00017cc0: 612c 636f 6e73 7444 6174 6129 0a0a 2020  a,constData)..  
+00017cd0: 2020 2020 2020 2020 2020 6669 7273 7449            firstI
+00017ce0: 6d61 6765 203d 2046 616c 7365 0a0a 2020  mage = False..  
+00017cf0: 2020 2020 2020 2320 544f 444f 2063 6865        # TODO che
+00017d00: 636b 2077 6974 6869 6e20 696d 6167 6520  ck within image 
+00017d10: 7469 6d65 7320 2d3e 2074 6f20 696d 6167  times -> to imag
+00017d20: 6520 6465 6661 756c 742e 2028 7472 6963  e default. (tric
+00017d30: 6b79 2073 696e 6365 2077 6520 646f 6e27  ky since we don'
+00017d40: 7420 6861 7665 2074 6865 2064 6166 6175  t have the dafau
+00017d50: 6c74 2069 6e64 6578 2068 6572 652e 204f  lt index here. O
+00017d60: 6e6c 7920 6120 7375 6273 6574 206d 6967  nly a subset mig
+00017d70: 6874 2062 6520 7570 6461 7465 2068 6572  ht be update her
+00017d80: 6529 0a20 2020 2020 2020 2023 2063 6865  e).        # che
+00017d90: 636b 2077 6974 6869 6e20 696d 6167 6520  ck within image 
+00017da0: 6974 656d 7320 2d3e 2068 6561 6465 720a  items -> header.
+00017db0: 2020 2020 2020 2020 6865 6164 6572 5570          headerUp
+00017dc0: 6461 7465 203d 2063 6f70 792e 6465 6570  date = copy.deep
+00017dd0: 636f 7079 2863 6f6e 7374 4461 7461 290a  copy(constData).
+00017de0: 2020 2020 2020 2020 6865 6164 6572 5570          headerUp
+00017df0: 6461 7465 6454 6573 7420 3d20 636f 7079  datedTest = copy
+00017e00: 2e64 6565 7063 6f70 7928 6865 6164 6572  .deepcopy(header
+00017e10: 290a 2020 2020 2020 2020 6d69 7174 632e  ).        miqtc.
+00017e20: 7265 6375 7273 6976 656c 7955 7064 6174  recursivelyUpdat
+00017e30: 6544 6963 7473 2868 6561 6465 7255 7064  eDicts(headerUpd
+00017e40: 6174 6564 5465 7374 2c68 6561 6465 7255  atedTest,headerU
+00017e50: 7064 6174 6529 0a20 2020 2020 2020 2075  pdate).        u
+00017e60: 7064 6174 6544 6966 6620 3d20 4465 6570  pdateDiff = Deep
+00017e70: 4469 6666 2868 6561 6465 722c 6865 6164  Diff(header,head
+00017e80: 6572 5570 6461 7465 6454 6573 7429 0a20  erUpdatedTest). 
+00017e90: 2020 2020 2020 2023 2063 6865 636b 2069         # check i
+00017ea0: 6620 6865 6164 6572 5570 6461 7465 2077  f headerUpdate w
+00017eb0: 6f75 6c64 206f 7665 7277 7269 7465 2061  ould overwrite a
+00017ec0: 6e79 7468 696e 6720 6672 6f6d 2063 7572  nything from cur
+00017ed0: 7265 6e74 2068 6561 6465 7220 2873 686f  rent header (sho
+00017ee0: 756c 6420 6e6f 7420 6861 7070 656e 292c  uld not happen),
+00017ef0: 2069 6620 736f 2064 6f6e 7420 7265 6d6f   if so dont remo
+00017f00: 7665 2066 726f 6d20 6974 656d 730a 2020  ve from items.  
+00017f10: 2020 2020 2020 6966 206e 6f74 2027 7661        if not 'va
+00017f20: 6c75 6573 5f63 6861 6e67 6564 2720 696e  lues_changed' in
+00017f30: 2075 7064 6174 6544 6966 6620 616e 6420   updateDiff and 
+00017f40: 6e6f 7420 2774 7970 655f 6368 616e 6765  not 'type_change
+00017f50: 7327 2069 6e20 7570 6461 7465 4469 6666  s' in updateDiff
+00017f60: 2061 6e64 206e 6f74 2027 6469 6374 696f   and not 'dictio
+00017f70: 6e61 7279 5f69 7465 6d5f 7265 6d6f 7665  nary_item_remove
+00017f80: 6427 2069 6e20 7570 6461 7465 4469 6666  d' in updateDiff
+00017f90: 3a0a 2020 2020 2020 2020 2020 2020 6865  :.            he
+00017fa0: 6164 6572 2e63 6c65 6172 2829 0a20 2020  ader.clear().   
+00017fb0: 2020 2020 2020 2020 2068 6561 6465 722e           header.
+00017fc0: 7570 6461 7465 2868 6561 6465 7255 7064  update(headerUpd
+00017fd0: 6174 6564 5465 7374 290a 0a20 2020 2020  atedTest)..     
+00017fe0: 2020 2020 2020 2023 2072 656d 6f76 6520         # remove 
+00017ff0: 636f 6e73 7420 7661 6c75 6573 2066 726f  const values fro
+00018000: 6d20 6461 7461 0a20 2020 2020 2020 2020  m data.         
+00018010: 2020 206d 6971 7463 2e72 6563 7572 7369     miqtc.recursi
+00018020: 7665 4d61 6b65 4e6f 6e65 4469 6374 4669  veMakeNoneDictFi
+00018030: 656c 6473 456d 7074 7953 7472 2863 6f6e  eldsEmptyStr(con
+00018040: 7374 4461 7461 290a 2020 2020 2020 2020  stData).        
+00018050: 2020 2020 666f 7220 696d 6167 652c 696d      for image,im
+00018060: 6167 655f 6461 7461 2069 6e20 6461 7461  age_data in data
+00018070: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
+00018080: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00018090: 2069 7369 6e73 7461 6e63 6528 696d 6167   isinstance(imag
+000180a0: 655f 6461 7461 2c6c 6973 7429 3a0a 2020  e_data,list):.  
+000180b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000180c0: 2020 696d 6167 655f 6461 7461 203d 205b    image_data = [
+000180d0: 696d 6167 655f 6461 7461 5d0a 2020 2020  image_data].    
+000180e0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000180f0: 696d 6167 655f 7470 5f64 6174 6120 696e  image_tp_data in
+00018100: 2069 6d61 6765 5f64 6174 613a 0a20 2020   image_data:.   
+00018110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018120: 206d 6971 7463 2e72 6563 7572 7369 7665   miqtc.recursive
+00018130: 6c79 5570 6461 7465 4469 6374 7328 696d  lyUpdateDicts(im
+00018140: 6167 655f 7470 5f64 6174 612c 636f 6e73  age_tp_data,cons
+00018150: 7444 6174 6129 2020 2020 2020 2020 2020  tData)          
+00018160: 0a0a 2020 2020 2020 2020 656c 7365 3a0a  ..        else:.
+00018170: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+00018180: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
+00018190: 4f44 4f20 6c6f 673f 0a20 2020 2020 0a0a  ODO log?.     ..
+000181a0: 2020 2020 6465 6620 696e 7465 726d 6564      def intermed
+000181b0: 6961 7465 4e61 7646 696c 6545 7869 7374  iateNavFileExist
+000181c0: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+000181d0: 2069 6620 6f73 2e70 6174 682e 6578 6973   if os.path.exis
+000181e0: 7473 2873 656c 662e 6765 745f 696e 745f  ts(self.get_int_
+000181f0: 6e61 765f 6669 6c65 2829 293a 0a20 2020  nav_file()):.   
+00018200: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00018210: 5472 7565 0a20 2020 2020 2020 2065 6c73  True.        els
+00018220: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00018230: 6574 7572 6e20 4661 6c73 650a 0a0a 2020  eturn False...  
+00018240: 2020 6465 6620 616c 6c4e 6176 4669 656c    def allNavFiel
+00018250: 6473 496e 4865 6164 6572 2873 656c 6629  dsInHeader(self)
+00018260: 3a0a 2020 2020 2020 2020 666f 7220 6669  :.        for fi
+00018270: 656c 6420 696e 2073 656c 662e 7265 714e  eld in self.reqN
+00018280: 6176 4669 656c 6473 3a0a 2020 2020 2020  avFields:.      
+00018290: 2020 2020 2020 2320 6d75 6c74 6970 6c65        # multiple
+000182a0: 206f 7074 696f 6e73 0a20 2020 2020 2020   options.       
+000182b0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+000182c0: 6365 2866 6965 6c64 2c6c 6973 7429 3a0a  ce(field,list):.
+000182d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000182e0: 7661 6c69 6420 3d20 4661 6c73 650a 2020  valid = False.  
+000182f0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00018300: 7220 7375 6266 6965 6c64 2069 6e20 6669  r subfield in fi
+00018310: 656c 643a 0a20 2020 2020 2020 2020 2020  eld:.           
+00018320: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00018330: 2e68 6561 6465 7246 6965 6c64 4669 6c6c  .headerFieldFill
+00018340: 6564 2873 7562 6669 656c 6429 3a0a 2020  ed(subfield):.  
+00018350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018360: 2020 2020 2020 7661 6c69 6420 3d20 5472        valid = Tr
+00018370: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+00018380: 2020 2020 2020 2020 2020 2062 7265 616b             break
+00018390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000183a0: 2069 6620 6e6f 7420 7661 6c69 643a 0a20   if not valid:. 
+000183b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000183c0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+000183d0: 2020 2020 2020 2020 2020 2020 2320 7369              # si
+000183e0: 6e67 6c65 206f 7074 696f 6e0a 2020 2020  ngle option.    
+000183f0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00018400: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00018410: 206e 6f74 2073 656c 662e 6865 6164 6572   not self.header
+00018420: 4669 656c 6446 696c 6c65 6428 6669 656c  FieldFilled(fiel
+00018430: 6429 3a0a 2020 2020 2020 2020 2020 2020  d):.            
+00018440: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+00018450: 616c 7365 0a20 2020 2020 2020 2072 6574  alse.        ret
+00018460: 7572 6e20 5472 7565 0a0a 2020 2020 6465  urn True..    de
+00018470: 6620 6865 6164 6572 4669 656c 6446 696c  f headerFieldFil
+00018480: 6c65 6428 7365 6c66 2c66 6965 6c64 3a73  led(self,field:s
+00018490: 7472 293a 0a20 2020 2020 2020 2069 6620  tr):.        if 
+000184a0: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
+000184b0: 6432 2866 6965 6c64 2920 3d3d 2022 223a  d2(field) == "":
+000184c0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000184d0: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
+000184e0: 2020 7265 7475 726e 2054 7275 650a 0a20    return True.. 
+000184f0: 2020 2064 6566 2063 6f6e 7665 7274 546f     def convertTo
+00018500: 4465 6661 756c 7444 6174 6554 696d 6546  DefaultDateTimeF
+00018510: 6f72 6d61 7428 7365 6c66 2c69 6664 6f29  ormat(self,ifdo)
+00018520: 3a0a 2020 2020 2020 2020 2222 2220 4368  :.        """ Ch
+00018530: 6563 6b73 2069 6620 616c 6c20 6974 656d  ecks if all item
+00018540: 7327 2027 696d 6167 652d 6461 7465 7469  s' 'image-dateti
+00018550: 6d65 2720 6669 656c 6473 206d 6174 6368  me' fields match
+00018560: 2064 6566 6175 6c74 2064 6174 6574 696d   default datetim
+00018570: 6520 666f 726d 6174 206f 7220 6120 6375  e format or a cu
+00018580: 7374 6f6d 206f 6e65 2064 6566 696e 6564  stom one defined
+00018590: 2069 6e20 2769 6d61 6765 2d64 6174 6574   in 'image-datet
+000185a0: 696d 652d 666f 726d 6174 270a 2020 2020  ime-format'.    
+000185b0: 2020 2020 2020 2020 616e 6420 636f 6e76          and conv
+000185c0: 6572 7473 2074 6f20 6465 6661 756c 7420  erts to default 
+000185d0: 666f 726d 6174 2e20 5468 726f 7773 2065  format. Throws e
+000185e0: 7863 6570 7469 6f6e 2069 6620 6461 7465  xception if date
+000185f0: 7469 6d65 2063 616e 6e6f 7420 6265 2070  time cannot be p
+00018600: 6172 7365 6420 2222 220a 2020 2020 2020  arsed """.      
+00018610: 2020 6375 7374 6f6d 4461 7465 5469 6d65    customDateTime
+00018620: 466f 726d 6174 466f 756e 6420 3d20 4661  FormatFound = Fa
+00018630: 6c73 650a 2020 2020 2020 2020 6865 6164  lse.        head
+00018640: 6572 4375 7374 6f6d 4461 7465 5469 6d65  erCustomDateTime
+00018650: 466f 726d 6174 203d 2066 696e 6446 6965  Format = findFie
+00018660: 6c64 2869 6664 6f5b 7365 6c66 2e69 6d61  ld(ifdo[self.ima
+00018670: 6765 5365 7448 6561 6465 724b 6579 5d2c  geSetHeaderKey],
+00018680: 2769 6d61 6765 2d64 6174 6574 696d 652d  'image-datetime-
+00018690: 666f 726d 6174 2729 0a20 2020 2020 2020  format').       
+000186a0: 2069 6620 6865 6164 6572 4375 7374 6f6d   if headerCustom
+000186b0: 4461 7465 5469 6d65 466f 726d 6174 2021  DateTimeFormat !
+000186c0: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
+000186d0: 2020 6966 646f 5b73 656c 662e 696d 6167    ifdo[self.imag
+000186e0: 6553 6574 4865 6164 6572 4b65 795d 5b27  eSetHeaderKey]['
+000186f0: 696d 6167 652d 6461 7465 7469 6d65 2d66  image-datetime-f
+00018700: 6f72 6d61 7427 5d20 3d20 2222 2023 2072  ormat'] = "" # r
+00018710: 656d 6f76 6520 6375 7374 6f6d 2066 6f72  emove custom for
+00018720: 6d61 740a 2020 2020 2020 2020 2020 2020  mat.            
+00018730: 6375 7374 6f6d 4461 7465 5469 6d65 466f  customDateTimeFo
+00018740: 726d 6174 466f 756e 6420 3d20 5472 7565  rmatFound = True
+00018750: 0a20 2020 2020 2020 2070 726f 6720 3d20  .        prog = 
+00018760: 6d69 7174 632e 5072 696e 744b 6e6f 776e  miqtc.PrintKnown
+00018770: 5072 6f67 7265 7373 4d73 6728 2243 6865  ProgressMsg("Che
+00018780: 636b 696e 6720 6461 7465 7469 6d65 2066  cking datetime f
+00018790: 6f72 6d61 7422 2c20 6c65 6e28 6966 646f  ormat", len(ifdo
+000187a0: 5b73 656c 662e 696d 6167 6553 6574 4974  [self.imageSetIt
+000187b0: 656d 734b 6579 5d29 2c6d 6f64 756c 6f3d  emsKey]),modulo=
+000187c0: 3129 0a20 2020 2020 2020 2066 6f72 2066  1).        for f
+000187d0: 696c 652c 6974 656d 2069 6e20 6966 646f  ile,item in ifdo
+000187e0: 5b73 656c 662e 696d 6167 6553 6574 4974  [self.imageSetIt
+000187f0: 656d 734b 6579 5d2e 6974 656d 7328 293a  emsKey].items():
+00018800: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
+00018810: 672e 7072 6f67 7265 7373 2829 0a20 2020  g.progress().   
+00018820: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00018830: 6973 696e 7374 616e 6365 2869 7465 6d2c  isinstance(item,
+00018840: 6c69 7374 293a 0a20 2020 2020 2020 2020  list):.         
+00018850: 2020 2020 2020 2020 2020 2069 7465 6d20             item 
+00018860: 3d20 5b69 7465 6d5d 0a20 2020 2020 2020  = [item].       
+00018870: 2020 2020 2073 7562 4974 656d 4465 6661       subItemDefa
+00018880: 756c 7420 3d20 6974 656d 5b30 5d0a 2020  ult = item[0].  
+00018890: 2020 2020 2020 2020 2020 6974 656d 4375            itemCu
+000188a0: 7374 6f6d 4461 7465 5469 6d65 466f 726d  stomDateTimeForm
+000188b0: 6174 203d 2022 220a 2020 2020 2020 2020  at = "".        
+000188c0: 2020 2020 6966 2027 696d 6167 652d 6461      if 'image-da
+000188d0: 7465 7469 6d65 2d66 6f72 6d61 7427 2069  tetime-format' i
+000188e0: 6e20 7375 6249 7465 6d44 6566 6175 6c74  n subItemDefault
+000188f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00018900: 2020 6974 656d 4375 7374 6f6d 4461 7465    itemCustomDate
+00018910: 5469 6d65 466f 726d 6174 203d 2073 7562  TimeFormat = sub
+00018920: 4974 656d 4465 6661 756c 745b 2769 6d61  ItemDefault['ima
+00018930: 6765 2d64 6174 6574 696d 652d 666f 726d  ge-datetime-form
+00018940: 6174 275d 0a20 2020 2020 2020 2020 2020  at'].           
+00018950: 2020 2020 2073 7562 4974 656d 4465 6661       subItemDefa
+00018960: 756c 745b 2769 6d61 6765 2d64 6174 6574  ult['image-datet
+00018970: 696d 652d 666f 726d 6174 275d 203d 2022  ime-format'] = "
+00018980: 2220 2320 7265 6d6f 7665 2063 7573 746f  " # remove custo
+00018990: 6d20 666f 726d 6174 0a20 2020 2020 2020  m format.       
+000189a0: 2020 2020 2020 2020 2063 7573 746f 6d44           customD
+000189b0: 6174 6554 696d 6546 6f72 6d61 7446 6f75  ateTimeFormatFou
+000189c0: 6e64 203d 2054 7275 650a 2020 2020 2020  nd = True.      
+000189d0: 2020 2020 2020 666f 7220 7375 6249 7465        for subIte
+000189e0: 6d20 696e 2069 7465 6d3a 0a20 2020 2020  m in item:.     
+000189f0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+00018a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018a10: 2020 2020 666f 726d 6174 203d 206d 6971      format = miq
+00018a20: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
+00018a30: 276d 6172 6971 7427 5d0a 2020 2020 2020  'mariqt'].      
+00018a40: 2020 2020 2020 2020 2020 2020 2020 6461                da
+00018a50: 7465 7469 6d65 2e64 6174 6574 696d 652e  tetime.datetime.
+00018a60: 7374 7270 7469 6d65 2873 7562 4974 656d  strptime(subItem
+00018a70: 5b27 696d 6167 652d 6461 7465 7469 6d65  ['image-datetime
+00018a80: 275d 2c66 6f72 6d61 7429 0a20 2020 2020  '],format).     
+00018a90: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00018aa0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00018ab0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00018ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ad0: 2020 2020 666f 726d 6174 203d 2068 6561      format = hea
+00018ae0: 6465 7243 7573 746f 6d44 6174 6554 696d  derCustomDateTim
+00018af0: 6546 6f72 6d61 740a 2020 2020 2020 2020  eFormat.        
+00018b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018b10: 6474 203d 2064 6174 6574 696d 652e 6461  dt = datetime.da
+00018b20: 7465 7469 6d65 2e73 7472 7074 696d 6528  tetime.strptime(
+00018b30: 7375 6249 7465 6d5b 2769 6d61 6765 2d64  subItem['image-d
+00018b40: 6174 6574 696d 6527 5d2c 666f 726d 6174  atetime'],format
+00018b50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00018b60: 2020 2020 2020 2020 2020 7375 6249 7465            subIte
+00018b70: 6d5b 2769 6d61 6765 2d64 6174 6574 696d  m['image-datetim
+00018b80: 6527 5d20 3d20 6461 7465 7469 6d65 2e64  e'] = datetime.d
+00018b90: 6174 6574 696d 652e 7374 7266 7469 6d65  atetime.strftime
+00018ba0: 2864 742c 6d69 7174 762e 6461 7465 5f66  (dt,miqtv.date_f
+00018bb0: 6f72 6d61 7473 5b27 6d61 7269 7174 275d  ormats['mariqt']
+00018bc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00018bd0: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
+00018be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018bf0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00018c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018c10: 2020 2020 2020 2066 6f72 6d61 7420 3d20         format = 
+00018c20: 6974 656d 4375 7374 6f6d 4461 7465 5469  itemCustomDateTi
+00018c30: 6d65 466f 726d 6174 0a20 2020 2020 2020  meFormat.       
+00018c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018c50: 2020 2020 2064 7420 3d20 6461 7465 7469       dt = dateti
+00018c60: 6d65 2e64 6174 6574 696d 652e 7374 7270  me.datetime.strp
+00018c70: 7469 6d65 2873 7562 4974 656d 5b27 696d  time(subItem['im
+00018c80: 6167 652d 6461 7465 7469 6d65 275d 2c66  age-datetime'],f
+00018c90: 6f72 6d61 7429 0a20 2020 2020 2020 2020  ormat).         
+00018ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018cb0: 2020 2073 7562 4974 656d 5b27 696d 6167     subItem['imag
+00018cc0: 652d 6461 7465 7469 6d65 275d 203d 2064  e-datetime'] = d
+00018cd0: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
+00018ce0: 2e73 7472 6674 696d 6528 6474 2c6d 6971  .strftime(dt,miq
+00018cf0: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
+00018d00: 276d 6172 6971 7427 5d29 0a20 2020 2020  'mariqt']).     
+00018d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d20: 2020 2065 7863 6570 743a 0a20 2020 2020     except:.     
+00018d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d40: 2020 2020 2020 2070 726f 672e 636c 6561         prog.clea
+00018d50: 7228 290a 2020 2020 2020 2020 2020 2020  r().            
+00018d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d70: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
+00018d80: 4578 6365 7074 696f 6e28 2749 6e76 616c  Exception('Inval
+00018d90: 6964 2064 6174 6574 696d 6520 7661 6c75  id datetime valu
+00018da0: 6527 2c73 7562 4974 656d 5b27 696d 6167  e',subItem['imag
+00018db0: 652d 6461 7465 7469 6d65 275d 2c20 2264  e-datetime'], "d
+00018dc0: 6f65 7320 6e6f 7420 6d61 7463 6820 666f  oes not match fo
+00018dd0: 726d 6174 2064 6566 6175 6c74 206f 7220  rmat default or 
+00018de0: 6375 7374 6f6d 2066 6f72 6d61 7422 290a  custom format").
+00018df0: 2020 2020 2020 2020 6966 2063 7573 746f          if custo
+00018e00: 6d44 6174 6554 696d 6546 6f72 6d61 7446  mDateTimeFormatF
+00018e10: 6f75 6e64 3a0a 2020 2020 2020 2020 2020  ound:.          
+00018e20: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+00018e30: 2243 7573 746f 6d20 6461 7465 7469 6d65  "Custom datetime
+00018e40: 2066 6f72 6d61 7473 2066 6f75 6e64 2e20   formats found. 
+00018e50: 5468 6579 2077 696c 6c20 6265 2072 6570  They will be rep
+00018e60: 6c61 6365 6420 6279 2074 6865 2064 6566  laced by the def
+00018e70: 6175 6c74 2066 6f72 6d61 742e 2229 2020  ault format.")  
+00018e80: 200a 2020 2020 2020 2020 7072 6f67 2e63   .        prog.c
+00018e90: 6c65 6172 2829 2020 2020 0a0a 0a20 2020  lear()    ...   
+00018ea0: 2064 6566 205f 5f69 6e69 7449 6e74 6572   def __initInter
+00018eb0: 6d65 6469 6174 6546 696c 6573 2873 656c  mediateFiles(sel
+00018ec0: 6629 3a0a 2020 2020 2020 2020 7365 6c66  f):.        self
+00018ed0: 2e69 6e74 6572 6d65 6469 6174 6546 696c  .intermediateFil
+00018ee0: 6573 4465 665f 636f 7265 203d 207b 0a20  esDef_core = {. 
+00018ef0: 2020 2020 2020 2020 2020 2027 6861 7368             'hash
+00018f00: 6573 273a 207b 0a20 2020 2020 2020 2020  es': {.         
+00018f10: 2020 2020 2020 2027 6372 6561 7469 6f6e         'creation
+00018f20: 4663 7427 3a20 2763 7265 6174 6549 6d61  Fct': 'createIma
+00018f30: 6765 5348 4132 3536 4669 6c65 2829 272c  geSHA256File()',
+00018f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018f50: 2027 7375 6666 6978 273a 2027 5f69 6d61   'suffix': '_ima
+00018f60: 6765 2d68 6173 6865 732e 7478 7427 2c0a  ge-hashes.txt',.
+00018f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018f80: 2763 6f6c 7327 3a20 5b6d 6971 7476 2e63  'cols': [miqtv.c
+00018f90: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+00018fa0: 7427 5d5b 2768 6173 6827 5d5d 2c0a 2020  t']['hash']],.  
+00018fb0: 2020 2020 2020 2020 2020 2020 2020 276f                'o
+00018fc0: 7074 696f 6e61 6c27 3a20 5b5d 7d2c 0a20  ptional': []},. 
+00018fd0: 2020 2020 2020 2020 2020 2027 7575 6964             'uuid
+00018fe0: 7327 3a20 7b0a 2020 2020 2020 2020 2020  s': {.          
+00018ff0: 2020 2020 2020 2763 7265 6174 696f 6e46        'creationF
+00019000: 6374 273a 2027 6372 6561 7465 5555 4944  ct': 'createUUID
+00019010: 4669 6c65 2829 272c 0a20 2020 2020 2020  File()',.       
+00019020: 2020 2020 2020 2020 2027 7375 6666 6978           'suffix
+00019030: 273a 2027 5f69 6d61 6765 2d75 7569 6473  ': '_image-uuids
+00019040: 2e74 7874 272c 0a20 2020 2020 2020 2020  .txt',.         
+00019050: 2020 2020 2020 2027 636f 6c73 273a 205b         'cols': [
+00019060: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00019070: 5b27 6d61 7269 7174 275d 5b27 7575 6964  ['mariqt']['uuid
+00019080: 275d 5d2c 0a20 2020 2020 2020 2020 2020  ']],.           
+00019090: 2020 2020 2027 6f70 7469 6f6e 616c 273a       'optional':
+000190a0: 205b 5d7d 2c0a 2020 2020 2020 2020 2020   []},.          
+000190b0: 2020 2764 6174 6574 696d 6527 3a20 7b0a    'datetime': {.
+000190c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000190d0: 2763 7265 6174 696f 6e46 6374 273a 2027  'creationFct': '
+000190e0: 6372 6561 7465 5374 6172 7454 696d 6546  createStartTimeF
+000190f0: 696c 6528 2927 2c0a 2020 2020 2020 2020  ile()',.        
+00019100: 2020 2020 2020 2020 2773 7566 6669 7827          'suffix'
+00019110: 3a20 275f 696d 6167 652d 7374 6172 742d  : '_image-start-
+00019120: 7469 6d65 732e 7478 7427 2c0a 2020 2020  times.txt',.    
+00019130: 2020 2020 2020 2020 2020 2020 2763 6f6c              'col
+00019140: 7327 3a20 5b6d 6971 7476 2e63 6f6c 5f68  s': [miqtv.col_h
+00019150: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00019160: 2775 7463 275d 5d2c 0a20 2020 2020 2020  'utc']],.       
+00019170: 2020 2020 2020 2020 2027 6f70 7469 6f6e           'option
+00019180: 616c 273a 205b 5d7d 2c0a 2020 2020 2020  al': []},.      
+00019190: 2020 2020 2020 276e 6176 6967 6174 696f        'navigatio
+000191a0: 6e27 3a20 7b0a 2020 2020 2020 2020 2020  n': {.          
+000191b0: 2020 2020 2020 2763 7265 6174 696f 6e46        'creationF
+000191c0: 6374 273a 2027 6372 6561 7465 496d 6167  ct': 'createImag
+000191d0: 654e 6176 6967 6174 696f 6e46 696c 6528  eNavigationFile(
+000191e0: 2927 2c0a 2020 2020 2020 2020 2020 2020  )',.            
+000191f0: 2020 2020 2773 7566 6669 7827 3a20 275f      'suffix': '_
+00019200: 696d 6167 652d 6e61 7669 6761 7469 6f6e  image-navigation
+00019210: 2e74 7874 272c 0a20 2020 2020 2020 2020  .txt',.         
+00019220: 2020 2020 2020 2027 636f 6c73 273a 205b         'cols': [
+00019230: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00019240: 5b27 6d61 7269 7174 275d 5b27 7574 6327  ['mariqt']['utc'
+00019250: 5d5d 2c0a 2020 2020 2020 2020 2020 2020  ]],.            
+00019260: 2020 2020 276f 7074 696f 6e61 6c27 3a20      'optional': 
+00019270: 5b6d 6971 7476 2e63 6f6c 5f68 6561 6465  [miqtv.col_heade
+00019280: 725b 276d 6172 6971 7427 5d5b 276c 6f6e  r['mariqt']['lon
+00019290: 275d 2c20 6d69 7174 762e 636f 6c5f 6865  '], miqtv.col_he
+000192a0: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+000192b0: 6c61 7427 5d2c 6d69 7174 762e 636f 6c5f  lat'],miqtv.col_
+000192c0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+000192d0: 5b27 6465 7027 5d2c 206d 6971 7476 2e63  ['dep'], miqtv.c
+000192e0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+000192f0: 7427 5d5b 2761 6c74 275d 2c20 6d69 7174  t']['alt'], miqt
+00019300: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+00019310: 7269 7174 275d 5b27 6867 7427 5d2c 206d  riqt']['hgt'], m
+00019320: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+00019330: 276d 6172 6971 7427 5d5b 2775 6e63 6572  'mariqt']['uncer
+00019340: 7427 5d5d 7d2c 0a20 2020 2020 2020 207d  t']]},.        }
+00019350: 0a0a 2020 2020 2020 2020 7365 6c66 2e6e  ..        self.n
+00019360: 6f6e 436f 7265 4669 656c 6449 6e74 6572  onCoreFieldInter
+00019370: 6d65 6469 6174 6549 7465 6d49 6e66 6f46  mediateItemInfoF
+00019380: 696c 6573 203d 205b 5d0a 0a20 2020 2064  iles = []..    d
+00019390: 6566 205f 5f67 6574 5f69 6e74 5f66 696c  ef __get_int_fil
+000193a0: 655f 7072 6566 6978 2873 656c 6629 3a0a  e_prefix(self):.
+000193b0: 2020 2020 2020 2020 2222 2220 6465 7065          """ depe
+000193c0: 6e64 7320 6f6e 2027 696d 6167 652d 6576  nds on 'image-ev
+000193d0: 656e 7427 2061 6e64 2027 696d 6167 652d  ent' and 'image-
+000193e0: 7365 6e73 6f72 2720 736f 2069 7420 6361  sensor' so it ca
+000193f0: 6e20 6368 616e 6765 2064 7572 696e 6720  n change during 
+00019400: 7570 6174 6520 2222 220a 2020 2020 2020  upate """.      
+00019410: 2020 7265 7475 726e 206f 732e 7061 7468    return os.path
+00019420: 2e6a 6f69 6e28 7365 6c66 2e64 6972 2e74  .join(self.dir.t
+00019430: 6f28 7365 6c66 2e64 6972 2e64 742e 696e  o(self.dir.dt.in
+00019440: 7465 726d 6564 6961 7465 292c 2073 656c  termediate), sel
+00019450: 662e 6669 6e64 546d 7046 6965 6c64 2827  f.findTmpField('
+00019460: 696d 6167 652d 7365 742d 6e61 6d65 2729  image-set-name')
+00019470: 290a 0a20 2020 2064 6566 2067 6574 5f69  )..    def get_i
+00019480: 6e74 5f68 6173 685f 6669 6c65 2873 656c  nt_hash_file(sel
+00019490: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+000194a0: 726e 2073 656c 662e 5f5f 6765 745f 696e  rn self.__get_in
+000194b0: 745f 6669 6c65 5f70 7265 6669 7828 2920  t_file_prefix() 
+000194c0: 2b20 7365 6c66 2e69 6e74 6572 6d65 6469  + self.intermedi
+000194d0: 6174 6546 696c 6573 4465 665f 636f 7265  ateFilesDef_core
+000194e0: 5b27 6861 7368 6573 275d 5b27 7375 6666  ['hashes']['suff
+000194f0: 6978 275d 0a0a 2020 2020 6465 6620 6765  ix']..    def ge
+00019500: 745f 696e 745f 7575 6964 5f66 696c 6528  t_int_uuid_file(
+00019510: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+00019520: 6574 7572 6e20 7365 6c66 2e5f 5f67 6574  eturn self.__get
+00019530: 5f69 6e74 5f66 696c 655f 7072 6566 6978  _int_file_prefix
+00019540: 2829 202b 2073 656c 662e 696e 7465 726d  () + self.interm
+00019550: 6564 6961 7465 4669 6c65 7344 6566 5f63  ediateFilesDef_c
+00019560: 6f72 655b 2775 7569 6473 275d 5b27 7375  ore['uuids']['su
+00019570: 6666 6978 275d 0a0a 2020 2020 6465 6620  ffix']..    def 
+00019580: 6765 745f 696e 745f 7374 6172 7454 696d  get_int_startTim
+00019590: 6573 5f66 696c 6528 7365 6c66 293a 0a20  es_file(self):. 
+000195a0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+000195b0: 6c66 2e5f 5f67 6574 5f69 6e74 5f66 696c  lf.__get_int_fil
+000195c0: 655f 7072 6566 6978 2829 202b 2073 656c  e_prefix() + sel
+000195d0: 662e 696e 7465 726d 6564 6961 7465 4669  f.intermediateFi
+000195e0: 6c65 7344 6566 5f63 6f72 655b 2764 6174  lesDef_core['dat
+000195f0: 6574 696d 6527 5d5b 2773 7566 6669 7827  etime']['suffix'
+00019600: 5d0a 0a20 2020 2064 6566 2067 6574 5f69  ]..    def get_i
+00019610: 6e74 5f6e 6176 5f66 696c 6528 7365 6c66  nt_nav_file(self
+00019620: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+00019630: 6e20 7365 6c66 2e5f 5f67 6574 5f69 6e74  n self.__get_int
+00019640: 5f66 696c 655f 7072 6566 6978 2829 202b  _file_prefix() +
+00019650: 2073 656c 662e 696e 7465 726d 6564 6961   self.intermedia
+00019660: 7465 4669 6c65 7344 6566 5f63 6f72 655b  teFilesDef_core[
+00019670: 276e 6176 6967 6174 696f 6e27 5d5b 2773  'navigation']['s
+00019680: 7566 6669 7827 5d0a 0a                   uffix']..
```

## Comparing `mariqt-0.4.2.dist-info/LICENSE` & `mariqt-0.4.3.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `mariqt-0.4.2.dist-info/METADATA` & `mariqt-0.4.3.dist-info/METADATA`

 * *Files 3% similar despite different names*

```diff
@@ -1,17 +1,18 @@
 Metadata-Version: 2.1
 Name: mariqt
-Version: 0.4.2
+Version: 0.4.3
 Summary: The MareHub & Marine Imaging Community Image QA/QC and curation toolbox
 Author: Timm Schoening
 Author-email: tschoening@geomar.de
 Classifier: Programming Language :: Python :: 3
 Classifier: License :: OSI Approved :: GNU General Public License v3 (GPLv3)
 Classifier: Operating System :: OS Independent
 License-File: LICENSE
+License-File: AUTHORS.md
 Requires-Dist: requests
 Requires-Dist: numpy
 Requires-Dist: pyyaml
 Requires-Dist: pymap3d
 Requires-Dist: utm
 Requires-Dist: markdown
 Requires-Dist: python-xmp-toolkit
```

## Comparing `mariqt-0.4.2.dist-info/RECORD` & `mariqt-0.4.3.dist-info/RECORD`

 * *Files 10% similar despite different names*

```diff
@@ -1,27 +1,28 @@
 mariqt/converters.py,sha256=kYxAx41oKGLgywxYnnE5qqxDXzror4YvRKg_F5HgXpA,5876
-mariqt/core.py,sha256=WFFoMuY2WSCtKvY5_UGMxWi1A_Y02jhUjq0YIG26cgI,12316
+mariqt/core.py,sha256=4oPtRw4YdG5Zgd_gBBX3ZIEB2XMVkt2dmXC81ZyfzoE,12721
 mariqt/directories.py,sha256=ZRJmUxFO5oD4JCECorwr3DYQel-U57GsrgfLutzT2hU,8485
 mariqt/equipment.py,sha256=WgZ2NfRqbHFHNpbcnTfRk8waOCQn9fDgdr4JTZR9wPk,465
 mariqt/files.py,sha256=uoCYyh_OXK6N9sWY4OmjN0tNuIc3OYwxaHBkIx6KjNw,16541
 mariqt/geo.py,sha256=BeQQ6oEGXqBFAeEQbVoJXMdDQRpJafTq9MjmhMNPiWA,27845
 mariqt/image.py,sha256=BnEV2aB5yey-W4sNw3ScC_iz4tIVEQvsUSYKQlmS0TU,23283
 mariqt/misc.py,sha256=O5SkQD423OqVICpOvib1Cgqb13C4cvPzPS3v1CR2AK8,3064
 mariqt/navigation.py,sha256=kYKHzibCKJNtXlDaIqzqZ7rmvjzFvpCUnFfz6yR7QJI,40059
 mariqt/provenance.py,sha256=daR6sIK6tSFaBsanKvIuFyjR78NNOTzd4N3AdQRxdFw,7345
 mariqt/reports.py,sha256=YP03HvFe0BG0y4efvQhRpeGifijqqPpCB_gg4qX-MVw,22316
 mariqt/settings.py,sha256=49X8uYtY7aO56cikCziiupzR5fpBhy5UXJ5hoMKao-c,4294
 mariqt/tests.py,sha256=DpIET7AZQ4OELXRQr-9_sApyJnB8y9MLX2zymGcZ_xQ,13762
 mariqt/variables.py,sha256=KByRNcM3emwzrSsv6jBdBckacMMqn8w-RhXYSqaeRVg,30040
-mariqt/version.py,sha256=ZQn_AcWYegaUtOl4-txMtrEFR2pE4wBpoPlmrITggnY,21
+mariqt/version.py,sha256=udnlByVnFcZDwWir50pEbTU0bIwgBrpNtAiVExFEzu0,21
 mariqt/sources/dship.py,sha256=5PxhsraSImnSchTG0h0HlLHorJQZPSDSOzspRGhD6bg,12135
 mariqt/sources/dship_settings.py,sha256=VoLc-YMD4Elwz0YpCFMy8mz0QQnKI0AJHPUHzQX9kJg,4586
 mariqt/sources/elements.py,sha256=5Cgchy_MJq4CiLVi2xqpxlOGqL5-PKl426XnzoCIEVI,2177
-mariqt/sources/ifdo.py,sha256=6sgXzzvcUTMj5MKl7amNda73FOgnAil9baBGd7BbyCg,102939
+mariqt/sources/ifdo.py,sha256=FhH__lNznafI1nSiJMsSnZ7Yg59EaCYaXz5qkgPT3tI,104073
 mariqt/sources/ofop.py,sha256=mSMZLvWszr_Yfd7rDf_4V4jIz3DMQh7Qe7eHLUnMOK8,5533
 mariqt/sources/svgs.py,sha256=T089b6F0wYLbUZQ8XhvCqqNmZqrvyTpx3kqRojlg_pM,650149
 mariqt/sources/underway.py,sha256=mIweaYmKbxPvmZHSFd3k5JY4mnFZ-7X3u_MdCPNjQL0,3728
-mariqt-0.4.2.dist-info/LICENSE,sha256=-MKfBTtig35o5_D2OxsbEq-rOcOx7S4Wd3WsEedeV8o,35140
-mariqt-0.4.2.dist-info/METADATA,sha256=pkpzYnEIL1wWkqgKZEz9gCg61RZtkK2J0q4n-fNubc0,1108
-mariqt-0.4.2.dist-info/WHEEL,sha256=a-zpFRIJzOq5QfuhBzbhiA1eHTzNCJn8OdRvhdNX0Rk,110
-mariqt-0.4.2.dist-info/top_level.txt,sha256=tdkmp0KxobBWy4IKaBeGYtc2HjD0OpeWrGNe21Q8Tfo,7
-mariqt-0.4.2.dist-info/RECORD,,
+mariqt-0.4.3.dist-info/AUTHORS.md,sha256=_mki0OpAav0xO0ztc3R5aVhIpmexyqWmY1mAXBoOxMU,162
+mariqt-0.4.3.dist-info/LICENSE,sha256=-MKfBTtig35o5_D2OxsbEq-rOcOx7S4Wd3WsEedeV8o,35140
+mariqt-0.4.3.dist-info/METADATA,sha256=q04UYcDP-5XSb8PkLa3x5mey3QrC3v2rhMA1xqODRFU,1133
+mariqt-0.4.3.dist-info/WHEEL,sha256=a-zpFRIJzOq5QfuhBzbhiA1eHTzNCJn8OdRvhdNX0Rk,110
+mariqt-0.4.3.dist-info/top_level.txt,sha256=tdkmp0KxobBWy4IKaBeGYtc2HjD0OpeWrGNe21Q8Tfo,7
+mariqt-0.4.3.dist-info/RECORD,,
```

